var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(R,D,Gb){R!=Array.prototype&&R!=Object.prototype&&(R[D]=Gb.value)};$jscomp.getGlobal=function(R){return"undefined"!=typeof window&&window===R?R:"undefined"!=typeof global&&null!=global?global:R};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(R,D,Gb,xa){if(D){Gb=$jscomp.global;R=R.split(".");for(xa=0;xa<R.length-1;xa++){var Na=R[xa];Na in Gb||(Gb[Na]={});Gb=Gb[Na]}R=R[R.length-1];xa=Gb[R];D=D(xa);D!=xa&&null!=D&&$jscomp.defineProperty(Gb,R,{configurable:!0,writable:!0,value:D})}};
$jscomp.polyfill("Array.prototype.fill",function(R){return R?R:function(D,R,xa){var Gb=this.length||0;0>R&&(R=Math.max(0,Gb+R));if(null==xa||xa>Gb)xa=Gb;xa=Number(xa);0>xa&&(xa=Math.max(0,Gb+xa));for(R=Number(R||0);R<xa;R++)this[R]=D;return this}},"es6","es3");$jscomp.findInternal=function(R,D,Gb){R instanceof String&&(R=String(R));for(var xa=R.length,Na=0;Na<xa;Na++){var M=R[Na];if(D.call(Gb,M,Na,R))return{i:Na,v:M}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(R){return R?R:function(D,R){return $jscomp.findInternal(this,D,R).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(R){return $jscomp.SYMBOL_PREFIX+(R||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var R=$jscomp.global.Symbol.iterator;R||(R=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[R]&&$jscomp.defineProperty(Array.prototype,R,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(R){var D=0;return $jscomp.iteratorPrototype(function(){return D<R.length?{done:!1,value:R[D++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(R){$jscomp.initSymbolIterator();R={next:R};R[$jscomp.global.Symbol.iterator]=function(){return this};return R};$jscomp.iteratorFromArray=function(R,D){$jscomp.initSymbolIterator();R instanceof String&&(R+="");var Gb=0,xa={next:function(){if(Gb<R.length){var Na=Gb++;return{value:D(Na,R[Na]),done:!1}}xa.next=function(){return{done:!0,value:void 0}};return xa.next()}};xa[Symbol.iterator]=function(){return xa};return xa};
$jscomp.polyfill("Array.prototype.values",function(R){return R?R:function(){return $jscomp.iteratorFromArray(this,function(D,R){return R})}},"es6","es3");
$jscomp.polyfill("String.fromCodePoint",function(R){return R?R:function(D){for(var R="",xa=0;xa<arguments.length;xa++){var Na=Number(arguments[xa]);if(0>Na||1114111<Na||Na!==Math.floor(Na))throw new RangeError("invalid_code_point "+Na);65535>=Na?R+=String.fromCharCode(Na):(Na-=65536,R+=String.fromCharCode(Na>>>10&1023|55296),R+=String.fromCharCode(Na&1023|56320))}return R}},"es6","es3");
$jscomp.polyfill("Array.prototype.keys",function(R){return R?R:function(){return $jscomp.iteratorFromArray(this,function(D){return D})}},"es6","es3");$jscomp.checkStringArgs=function(R,D,Gb){if(null==R)throw new TypeError("The 'this' value for String.prototype."+Gb+" must not be null or undefined");if(D instanceof RegExp)throw new TypeError("First argument to String.prototype."+Gb+" must not be a regular expression");return R+""};
$jscomp.polyfill("String.prototype.startsWith",function(R){return R?R:function(D,R){var xa=$jscomp.checkStringArgs(this,D,"startsWith");D+="";var Na=xa.length,M=D.length;R=Math.max(0,Math.min(R|0,xa.length));for(var v=0;v<M&&R<Na;)if(xa[R++]!=D[v++])return!1;return v>=M}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(R){return R?R:function(D,R){var xa=$jscomp.checkStringArgs(this,D,"endsWith");D+="";void 0===R&&(R=xa.length);R=Math.max(0,Math.min(R|0,xa.length));for(var Na=D.length;0<Na&&0<R;)if(xa[--R]!=D[--Na])return!1;return 0>=Na}},"es6","es3");
(function(R){function D(a,b){a=Object.create(a);for(var c in b)a[c]=b[c];b.toString!==Object.prototype.toString&&(a.toString=b.toString);return a}function Gb(a){var b=null;null==b&&(b=Re.AsObject);b=(new th(a,b)).o;a=sa.field(b,"type");b=sa.field(b,"data");switch(a){case "AddBuilding":return Ac.AddBuilding(b);case "AddPlayer":return Ac.AddPlayer(b);case "Ping":return Ac.Ping;case "UpdatePlayers":return Ac.UpdatePlayers(b);default:throw t.thrown("unknown packet type");}}function xa(a,b){a=(new ne([K[a.__enum__].__constructs__[a._hx_index]._hx_name,
b])).o.getBytes();Se.instance.game.ws.send(a)}function Na(a){return a instanceof Array?new td(a):a.iterator()}function M(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=R.$haxeUID++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=b.bind(a),a.hx__closures__[b.__id__]=c);return c}var v=function(){return ka.__string_rec(this,"")},K=K||{},z,oe=function(a,b){this.r=new RegExp(a,b.split("u").join(""))};oe.__name__="EReg";oe.prototype={match:function(a){this.r.global&&
(this.r.lastIndex=0);this.r.m=this.r.exec(a);this.r.s=a;return null!=this.r.m},matched:function(a){if(null!=this.r.m&&0<=a&&a<this.r.m.length)return this.r.m[a];throw t.thrown("EReg::matched");},matchedPos:function(){if(null==this.r.m)throw t.thrown("No string matched");return{pos:this.r.m.index,len:this.r.m[0].length}},matchSub:function(a,b,c){null==c&&(c=-1);if(this.r.global){if(this.r.lastIndex=b,this.r.m=this.r.exec(0>c?a:F.substr(a,0,b+c)),c=null!=this.r.m)this.r.s=a}else if(c=this.match(0>c?
F.substr(a,b,null):F.substr(a,b,c)))this.r.s=a,this.r.m.index+=b;return c},split:function(a){return a.replace(this.r,"#__delim__#").split("#__delim__#")},__class__:oe};var F=function(){};F.__name__="HxOverrides";F.cca=function(a,b){a=a.charCodeAt(b);if(a==a)return a};F.substr=function(a,b,c){if(null==c)c=a.length;else if(0>c)if(0==b)c=a.length+c;else return"";return a.substr(b,c)};F.remove=function(a,b){b=a.indexOf(b);if(-1==b)return!1;a.splice(b,1);return!0};F.now=function(){return Date.now()};var Te=
function(){};Te.__name__="Lambda";Te.array=function(a){var b=[];for(a=Na(a);a.hasNext();){var c=a.next();b.push(c)}return b};Te.count=function(a,b){var c=0;if(null==b)for(b=Na(a);b.hasNext();)b.next(),++c;else for(a=Na(a);a.hasNext();){var d=a.next();b(d)&&++c}return c};var Se=function(){$a.trace("Bundle loaded.",{fileName:"src/client/src/Main.hx",lineNumber:12,className:"Main",methodName:"new"});this.game=new uh;new vg};Se.__name__="Main";Se.main=function(){Se.instance=new Se};Se.prototype={__class__:Se};
Math.__name__="Math";var sa=function(){};sa.__name__="Reflect";sa.field=function(a,b){try{return a[b]}catch(c){return null}};sa.fields=function(a){var b=[];if(null!=a){var c=Object.prototype.hasOwnProperty,d;for(d in a)"__id__"!=d&&"hx__closures__"!=d&&c.call(a,d)&&b.push(d)}return b};sa.isFunction=function(a){return"function"==typeof a?!(a.__name__||a.__ename__):!1};sa.compare=function(a,b){return a==b?0:a>b?1:-1};sa.isEnumValue=function(a){return null!=a?null!=a.__enum__:!1};sa.deleteField=function(a,
b){if(!Object.prototype.hasOwnProperty.call(a,b))return!1;delete a[b];return!0};sa.copy=function(a){if(null==a)return null;for(var b={},c=0,d=sa.fields(a);c<d.length;){var e=d[c];++c;b[e]=sa.field(a,e)}return b};var y=function(){};y.__name__="Std";y.string=function(a){return ka.__string_rec(a,"")};y.parseInt=function(a){a=parseInt(a);return isNaN(a)?null:a};y.random=function(a){return 0>=a?0:Math.floor(Math.random()*a)};var Lc=function(){this.b=""};Lc.__name__="StringBuf";Lc.prototype={__class__:Lc};
var X=function(){};X.__name__="StringTools";X.startsWith=function(a,b){return a.length>=b.length?0==a.lastIndexOf(b,0):!1};X.endsWith=function(a,b){var c=b.length,d=a.length;return d>=c?a.indexOf(b,d-c)==d-c:!1};X.isSpace=function(a,b){a=F.cca(a,b);return 8<a&&14>a?!0:32==a};X.ltrim=function(a){for(var b=a.length,c=0;c<b&&X.isSpace(a,c);)++c;return 0<c?F.substr(a,c,b-c):a};X.rtrim=function(a){for(var b=a.length,c=0;c<b&&X.isSpace(a,b-c-1);)++c;return 0<c?F.substr(a,0,b-c):a};X.trim=function(a){return X.ltrim(X.rtrim(a))};
X.replace=function(a,b,c){return a.split(b).join(c)};X.hex=function(a,b){var c="";do c="0123456789ABCDEF".charAt(a&15)+c,a>>>=4;while(0<a);if(null!=b)for(;c.length<b;)c="0"+c;return c};var db=K.ValueType={__ename__:!0,__constructs__:null,TNull:{_hx_name:"TNull",_hx_index:0,__enum__:"ValueType",toString:v},TInt:{_hx_name:"TInt",_hx_index:1,__enum__:"ValueType",toString:v},TFloat:{_hx_name:"TFloat",_hx_index:2,__enum__:"ValueType",toString:v},TBool:{_hx_name:"TBool",_hx_index:3,__enum__:"ValueType",
toString:v},TObject:{_hx_name:"TObject",_hx_index:4,__enum__:"ValueType",toString:v},TFunction:{_hx_name:"TFunction",_hx_index:5,__enum__:"ValueType",toString:v},TClass:(z=function(a){return{_hx_index:6,c:a,__enum__:"ValueType",toString:v}},z._hx_name="TClass",z.__params__=["c"],z),TEnum:(z=function(a){return{_hx_index:7,e:a,__enum__:"ValueType",toString:v}},z._hx_name="TEnum",z.__params__=["e"],z),TUnknown:{_hx_name:"TUnknown",_hx_index:8,__enum__:"ValueType",toString:v}};db.__constructs__=[db.TNull,
db.TInt,db.TFloat,db.TBool,db.TObject,db.TFunction,db.TClass,db.TEnum,db.TUnknown];db.__empty_constructs__=[db.TNull,db.TInt,db.TFloat,db.TBool,db.TObject,db.TFunction,db.TUnknown];var da=function(){};da.__name__="Type";da.createInstance=function(a,b){return new (Function.prototype.bind.apply(a,[null].concat(b)))};da.createEnum=function(a,b,c){var d=sa.field(a,b);if(null==d)throw t.thrown("No such constructor "+b);if(sa.isFunction(d)){if(null==c)throw t.thrown("Constructor "+b+" need parameters");
return d.apply(a,c)}if(null!=c&&0!=c.length)throw t.thrown("Constructor "+b+" does not need parameters");return d};da.createEnumIndex=function(a,b,c){var d=a.__constructs__[b];d=null==d?null:d._hx_name;if(null==d)throw t.thrown(b+" is not a valid enum constructor index");return da.createEnum(a,d,c)};da.typeof=function(a){switch(typeof a){case "boolean":return db.TBool;case "function":return a.__name__||a.__ename__?db.TObject:db.TFunction;case "number":return Math.ceil(a)==a%2147483648?db.TInt:db.TFloat;
case "object":if(null==a)return db.TNull;var b=a.__enum__;if(null!=b)return db.TEnum(K[b]);a=ka.getClass(a);return null!=a?db.TClass(a):db.TObject;case "string":return db.TClass(String);case "undefined":return db.TNull;default:return db.TUnknown}};da.enumEq=function(a,b){if(a==b)return!0;try{var c=a.__enum__;if(null==c||c!=b.__enum__||a._hx_index!=b._hx_index)return!1;var d=K[c].__constructs__[a._hx_index].__params__;for(c=0;c<d.length;){var e=d[c];++c;if(!da.enumEq(a[e],b[e]))return!1}}catch(f){return!1}return!0};
da.enumParameters=function(a){var b=K[a.__enum__].__constructs__[a._hx_index].__params__;if(null!=b){for(var c=[],d=0;d<b.length;){var e=b[d];++d;c.push(a[e])}return c}return[]};var uh=function(){this.ws=new vh("ws://localhost:5000");this.ws.set_binaryType("arraybuffer");this.ws.set_onopen(M(this,this.onopen));this.ws.set_onmessage(M(this,this.onmessage));this.ws.set_onerror(M(this,this.onerror));this.ws.set_onclose(M(this,this.onclose))};uh.__name__="classes.Game";uh.prototype={onopen:function(){$a.trace("WS OPENED",
{fileName:"src/client/src/classes/Game.hx",lineNumber:29,className:"classes.Game",methodName:"onopen"});xa(Vc.Spawn,["ok"]);xa(Vc.Spawn,["ok"]);xa(Vc.Spawn,["ok"]);xa(Vc.Spawn,["ok"]);xa(Vc.Spawn,["ok"])},onerror:function(a){},onclose:function(){},onmessage:function(a){switch(a._hx_index){case 0:3==Gb(a.content)._hx_index?this.Packets_Ping():$a.trace("unknown packet inbound!!",{fileName:"src/client/src/classes/Game.hx",lineNumber:56,className:"classes.Game",methodName:"onmessage"});break;case 1:$a.trace("waht????"+
a.content,{fileName:"src/client/src/classes/Game.hx",lineNumber:60,className:"classes.Game",methodName:"onmessage"})}},Packets_Ping:function(){$a.trace("WOAHHHHHHHHH PING PACKET SO COOL!!!",{fileName:"src/client/src/classes/Game.hx",lineNumber:66,className:"classes.Game",methodName:"Packets_Ping"})},__class__:uh};var pe=function(){};pe.__name__="h3d.IDrawable";pe.__isInterface__=!0;pe.prototype={__class__:pe};var ud=function(){var a=this,b=ja.CURRENT;null!=b?(this.engine=b,b.onReady=M(this,this.setup),
qe.delay(M(this,this.setup),0)):la.start(function(){b=new ja;a.engine=b;b.onReady=M(a,a.setup);b.init()})};ud.__name__="hxd.App";ud.__interfaces__=[pe];ud.staticHandler=function(){};ud.prototype={onResize:function(){},setScene:function(a,b){null==b&&(b=!0);var c=a instanceof Od?a:null,d=a instanceof Ue?a:null;null!=c?(this.sevents.removeScene(this.s2d),this.sevents.addScene(a,0)):null!=d&&(this.sevents.removeScene(this.s3d),this.sevents.addScene(a));if(b)if(null!=c)this.s2d.dispose();else if(null!=
d)this.s3d.dispose();else throw t.thrown("Can't dispose previous scene");null!=c&&(this.s2d=c);null!=d&&(this.s3d=d)},setCurrent:function(){var a=this;this.engine=ja.CURRENT;this.isDisposed=!1;this.engine.onReady=ud.staticHandler;this.engine.onContextLost=M(this,this.onContextLost);this.engine.onResized=function(){null!=a.s2d&&(a.s2d.checkResize(),a.onResize())};la.setLoop(M(this,this.mainLoop))},onContextLost:function(){if(null!=this.s3d)this.s3d.onContextLost()},setScene2D:function(a,b){null==b&&
(b=!0);this.sevents.removeScene(this.s2d);this.sevents.addScene(a,0);b&&this.s2d.dispose();this.s2d=a;a.mark=M(this,this.mark)},setScene3D:function(a,b){null==b&&(b=!0);this.sevents.removeScene(this.s3d);this.sevents.addScene(a);b&&this.s3d.dispose();this.s3d=a},render:function(a){this.s3d.render(a);this.s2d.render(a)},mark:function(a){this.s3d.mark(a)},setup:function(){var a=this,b=!1;this.engine.onReady=ud.staticHandler;this.engine.onContextLost=M(this,this.onContextLost);this.engine.onResized=
function(){if(null!=a.s2d&&(a.s2d.checkResize(),b))a.onResize()};this.s3d=new Ue;this.s2d=new Od;this.s2d.mark=M(this,this.mark);this.sevents=new wh;this.sevents.addScene(this.s2d);this.sevents.addScene(this.s3d);this.loadAssets(function(){b=!0;a.init();ea.skip();a.mainLoop();la.setLoop(M(a,a.mainLoop));H.initialize()})},dispose:function(){this.engine.onResized=ud.staticHandler;this.engine.onContextLost=ud.staticHandler;this.isDisposed=!0;null!=this.s2d&&this.s2d.dispose();null!=this.s3d&&this.s3d.dispose();
null!=this.sevents&&this.sevents.dispose()},loadAssets:function(a){a()},init:function(){},mainLoop:function(){ea.update();this.sevents.checkEvents();if(!this.isDisposed&&(this.update(ea.dt),!this.isDisposed)){var a=ea.dt;null!=this.s2d&&this.s2d.setElapsedTime(a);null!=this.s3d&&this.s3d.setElapsedTime(a);this.engine.render(this)}},update:function(a){},__class__:ud};var vg=function(){ud.call(this);this.camera=new xh};vg.__name__="classes.Render";vg.__super__=ud;vg.prototype=D(ud.prototype,{init:function(){this.background=
new Ve(this.s2d);this.renderBackground();this.grid=new Ve(this.s2d);this.renderGridLines()},update:function(a){var b=this.lastFrameCall;this.delta=(null!=b?b:a)-a;this.lastFrameCall=a;H.isDown(87)&&(this.camera.y-=50);H.isDown(83)&&(this.camera.y+=50);H.isDown(65)&&(this.camera.x-=50);H.isDown(68)&&(this.camera.x+=50);a=this.background;a.posChanged=!0;a.x=-this.camera.x;a=this.background;a.posChanged=!0;a.y=-this.camera.y;a=this.grid;a.posChanged=!0;a.x=-this.camera.x;a=this.grid;a.posChanged=!0;
a.y=-this.camera.y},renderPlayers:function(){},renderBackground:function(){this.background.clear();this.background.beginFill(16579837);this.background.drawRect(0,0,dc.MapSize,dc.SnowBiomeY);this.background.endFill();this.background.beginFill(7856737);this.background.drawRect(0,dc.SnowBiomeY,dc.MapSize,dc.MapSize-dc.SnowBiomeY);this.background.endFill();this.background.beginFill(2298960,.3);this.background.drawRect(0,0,dc.MapSize,dc.MapSize);this.background.endFill()},renderGridLines:function(){this.grid.clear();
this.grid.lineStyle(4,0,.06);for(var a=0;a<dc.MapSize;){var b=this.grid;b.flush();b.addVertex(0,a,b.curR,b.curG,b.curB,b.curA,0*b.ma+a*b.mc+b.mx,0*b.mb+a*b.md+b.my);b=this.grid;var c=dc.MapSize;b.addVertex(c,a,b.curR,b.curG,b.curB,b.curA,c*b.ma+a*b.mc+b.mx,c*b.mb+a*b.md+b.my);a+=dc.GridBoxSize}for(a=0;a<dc.MapSize;)b=this.grid,b.flush(),b.addVertex(a,0,b.curR,b.curG,b.curB,b.curA,a*b.ma+0*b.mc+b.mx,a*b.mb+0*b.md+b.my),b=this.grid,c=dc.MapSize,b.addVertex(a,c,b.curR,b.curG,b.curB,b.curA,a*b.ma+c*b.mc+
b.mx,a*b.mb+c*b.md+b.my),a+=dc.GridBoxSize},lerp:function(a,b,c){return a+(b-a)*c},__class__:vg});var xh=function(){this.x=-260;this.y=160};xh.__name__="classes.Camera";xh.prototype={__class__:xh};var Wc=K["format.gif.Block"]={__ename__:!0,__constructs__:null,BFrame:(z=function(a){return{_hx_index:0,frame:a,__enum__:"format.gif.Block",toString:v}},z._hx_name="BFrame",z.__params__=["frame"],z),BExtension:(z=function(a){return{_hx_index:1,extension:a,__enum__:"format.gif.Block",toString:v}},z._hx_name=
"BExtension",z.__params__=["extension"],z),BEOF:{_hx_name:"BEOF",_hx_index:2,__enum__:"format.gif.Block",toString:v}};Wc.__constructs__=[Wc.BFrame,Wc.BExtension,Wc.BEOF];Wc.__empty_constructs__=[Wc.BEOF];var Xc=K["format.gif.Extension"]={__ename__:!0,__constructs__:null,EGraphicControl:(z=function(a){return{_hx_index:0,gce:a,__enum__:"format.gif.Extension",toString:v}},z._hx_name="EGraphicControl",z.__params__=["gce"],z),EComment:(z=function(a){return{_hx_index:1,text:a,__enum__:"format.gif.Extension",
toString:v}},z._hx_name="EComment",z.__params__=["text"],z),EText:(z=function(a){return{_hx_index:2,pte:a,__enum__:"format.gif.Extension",toString:v}},z._hx_name="EText",z.__params__=["pte"],z),EApplicationExtension:(z=function(a){return{_hx_index:3,ext:a,__enum__:"format.gif.Extension",toString:v}},z._hx_name="EApplicationExtension",z.__params__=["ext"],z),EUnknown:(z=function(a,b){return{_hx_index:4,id:a,data:b,__enum__:"format.gif.Extension",toString:v}},z._hx_name="EUnknown",z.__params__=["id",
"data"],z)};Xc.__constructs__=[Xc.EGraphicControl,Xc.EComment,Xc.EText,Xc.EApplicationExtension,Xc.EUnknown];Xc.__empty_constructs__=[];var Lf=K["format.gif.ApplicationExtension"]={__ename__:!0,__constructs__:null,AENetscapeLooping:(z=function(a){return{_hx_index:0,loops:a,__enum__:"format.gif.ApplicationExtension",toString:v}},z._hx_name="AENetscapeLooping",z.__params__=["loops"],z),AEUnknown:(z=function(a,b,c){return{_hx_index:1,name:a,version:b,data:c,__enum__:"format.gif.ApplicationExtension",
toString:v}},z._hx_name="AEUnknown",z.__params__=["name","version","data"],z)};Lf.__constructs__=[Lf.AENetscapeLooping,Lf.AEUnknown];Lf.__empty_constructs__=[];var be=K["format.gif.Version"]={__ename__:!0,__constructs__:null,GIF87a:{_hx_name:"GIF87a",_hx_index:0,__enum__:"format.gif.Version",toString:v},GIF89a:{_hx_name:"GIF89a",_hx_index:1,__enum__:"format.gif.Version",toString:v},Unknown:(z=function(a){return{_hx_index:2,version:a,__enum__:"format.gif.Version",toString:v}},z._hx_name="Unknown",
z.__params__=["version"],z)};be.__constructs__=[be.GIF87a,be.GIF89a,be.Unknown];be.__empty_constructs__=[be.GIF87a,be.GIF89a];var ec=K["format.gif.DisposalMethod"]={__ename__:!0,__constructs__:null,UNSPECIFIED:{_hx_name:"UNSPECIFIED",_hx_index:0,__enum__:"format.gif.DisposalMethod",toString:v},NO_ACTION:{_hx_name:"NO_ACTION",_hx_index:1,__enum__:"format.gif.DisposalMethod",toString:v},FILL_BACKGROUND:{_hx_name:"FILL_BACKGROUND",_hx_index:2,__enum__:"format.gif.DisposalMethod",toString:v},RENDER_PREVIOUS:{_hx_name:"RENDER_PREVIOUS",
_hx_index:3,__enum__:"format.gif.DisposalMethod",toString:v},UNDEFINED:(z=function(a){return{_hx_index:4,index:a,__enum__:"format.gif.DisposalMethod",toString:v}},z._hx_name="UNDEFINED",z.__params__=["index"],z)};ec.__constructs__=[ec.UNSPECIFIED,ec.NO_ACTION,ec.FILL_BACKGROUND,ec.RENDER_PREVIOUS,ec.UNDEFINED];ec.__empty_constructs__=[ec.UNSPECIFIED,ec.NO_ACTION,ec.FILL_BACKGROUND,ec.RENDER_PREVIOUS];var yh=function(a){this.i=a;a.set_bigEndian(!1)};yh.__name__="format.gif.Reader";yh.prototype={read:function(){var a=
71;if(this.i.readByte()!=a)throw t.thrown("Invalid header");a=73;if(this.i.readByte()!=a)throw t.thrown("Invalid header");a=70;if(this.i.readByte()!=a)throw t.thrown("Invalid header");var b=this.i.readString(3);switch(b){case "87a":b=be.GIF87a;break;case "89a":b=be.GIF89a;break;default:b=be.Unknown(b)}a=this.i.readUInt16();var c=this.i.readUInt16(),d=this.i.readByte(),e=this.i.readByte(),f=this.i.readByte();c={width:a,height:c,hasGlobalColorTable:128==(d&128),colorResolution:(d&112)>>>4,sorted:8==
(d&8),globalColorTableSize:2<<(d&7),backgroundColorIndex:e,pixelAspectRatio:0!=f?(f+15)/64:1};d=null;c.hasGlobalColorTable&&(d=this.readColorTable(c.globalColorTableSize));for(e=new vd;a=this.readBlock(),e.add(a),a!=Wc.BEOF;);return{version:b,logicalScreenDescriptor:c,globalColorTable:d,blocks:e}},readBlock:function(){switch(this.i.readByte()){case 33:return this.readExtension();case 44:return this.readImage()}return Wc.BEOF},readImage:function(){var a=this.i.readUInt16(),b=this.i.readUInt16(),c=
this.i.readUInt16(),d=this.i.readUInt16(),e=this.i.readByte(),f=128==(e&128),g=64==(e&64),h=32==(e&32);e=2<<(e&7);var k=null;f&&(k=this.readColorTable(e));return Wc.BFrame({x:a,y:b,width:c,height:d,localColorTable:f,interlaced:g,sorted:h,localColorTableSize:e,pixels:this.readPixels(c,d,g),colorTable:k})},readPixels:function(a,b,c){var d,e=this.i,f=a*b,g=new S(new ArrayBuffer(f)),h=e.readByte(),k=e.readByte()-1,l=e.readByte(),m=8,p=1<<h,r=p+1,n=h+1,u=1<<n,w=u-1,I=[];for(d=0;d<p;){var q=d++;I[q]=[q]}for(var v=
[],x=p+2,y,z=q=0;q<f;){for(d=z;m<n&&0!=k;)l|=e.readByte()<<m,m+=8,--k,0==k&&(k=e.readByte());z=l&w;l>>=n;m-=n;if(z==p)v=I.slice(),x=p+2,n=h+1,u=1<<n,w=u-1;else{if(z==r)break;if(z<x)d!=p&&(y=v[d].slice(),y.push(v[z][0]),v[x++]=y);else{if(z!=x)throw t.thrown("Invalid LZW code. Excepted: "+x+", got: "+z);y=v[d].slice();y.push(y[0]);v[x++]=y}y=v[z];for(d=0;d<y.length;){var A=y[d];++d;g.b[q++]=A}x==u&&12>n&&(++n,u=1<<n,w=u-1)}}for(;0<k;)e.readByte(),--k,0==k&&(k=e.readByte());for(;q<f;)g.b[q++]=0;c&&(c=
new S(new ArrayBuffer(f)),q=this.deinterlace(g,c,8,0,0,a,b),q=this.deinterlace(g,c,8,4,q,a,b),q=this.deinterlace(g,c,4,2,q,a,b),this.deinterlace(g,c,2,1,q,a,b),g=c);return g},deinterlace:function(a,b,c,d,e,f,g){for(;d<g;)b.blit(d*f,a,e,f),e+=f,d+=c;return e},readExtension:function(){var a=this.i.readByte();switch(a){case 1:if(12!=this.i.readByte())throw t.thrown("Incorrect size of Plain Text Extension introducer block.");a=this.i.readUInt16();for(var b=this.i.readUInt16(),c=this.i.readUInt16(),d=
this.i.readUInt16(),e=this.i.readByte(),f=this.i.readByte(),g=this.i.readByte(),h=this.i.readByte(),k=new Yc,l=new S(new ArrayBuffer(255)),m=this.i.readByte();0!=m;)this.i.readBytes(l,0,m),k.writeBytes(l,0,m),m=this.i.readByte();k.flush();l=k.getBytes();k.close();return Wc.BExtension(Xc.EText({textGridX:a,textGridY:b,textGridWidth:c,textGridHeight:d,charCellWidth:e,charCellHeight:f,textForegroundColorIndex:g,textBackgroundColorIndex:h,text:l.toString()}));case 249:if(4!=this.i.readByte())throw t.thrown("Incorrect Graphic Control Extension block size!");
k=this.i.readByte();switch((k&28)>>2){case 0:l=ec.UNSPECIFIED;break;case 1:l=ec.NO_ACTION;break;case 2:l=ec.FILL_BACKGROUND;break;case 3:l=ec.RENDER_PREVIOUS;break;default:l=ec.UNDEFINED((k&28)>>2)}k=Wc.BExtension(Xc.EGraphicControl({disposalMethod:l,userInput:2==(k&2),hasTransparentColor:1==(k&1),delay:this.i.readUInt16(),transparentIndex:this.i.readByte()}));this.i.readByte();return k;case 254:k=new Yc;l=new S(new ArrayBuffer(255));for(m=this.i.readByte();0!=m;)this.i.readBytes(l,0,m),k.writeBytes(l,
0,m),m=this.i.readByte();k.flush();l=k.getBytes();k.close();return Wc.BExtension(Xc.EComment(l.toString()));case 255:return this.readApplicationExtension();default:k=new Yc;l=new S(new ArrayBuffer(255));for(m=this.i.readByte();0!=m;)this.i.readBytes(l,0,m),k.writeBytes(l,0,m),m=this.i.readByte();k.flush();l=k.getBytes();k.close();return Wc.BExtension(Xc.EUnknown(a,l))}},readApplicationExtension:function(){if(11!=this.i.readByte())throw t.thrown("Incorrect size of Application Extension introducer block.");
for(var a=this.i.readString(8),b=this.i.readString(3),c=new Yc,d=new S(new ArrayBuffer(255)),e=this.i.readByte();0!=e;)this.i.readBytes(d,0,e),c.writeBytes(d,0,e),e=this.i.readByte();c.flush();d=c.getBytes();c.close();c=d;return"NETSCAPE"==a&&"2.0"==b&&1==c.b[0]?Wc.BExtension(Xc.EApplicationExtension(Lf.AENetscapeLooping(c.b[1]|c.b[2]<<8))):Wc.BExtension(Xc.EApplicationExtension(Lf.AEUnknown(a,b,c)))},readBlocks:function(){for(var a=new Yc,b=new S(new ArrayBuffer(255)),c=this.i.readByte();0!=c;)this.i.readBytes(b,
0,c),a.writeBytes(b,0,c),c=this.i.readByte();a.flush();b=a.getBytes();a.close();return b},readColorTable:function(a){a*=3;for(var b=new S(new ArrayBuffer(a)),c=0;c<a;){var d=this.i.readByte();b.b[c]=d;d=this.i.readByte();b.b[c+1]=d;d=this.i.readByte();b.b[c+2]=d;c+=3}return b},__class__:yh};var Mc=function(){};Mc.__name__="format.gif.Tools";Mc.framesCount=function(a){var b=0;for(a=a.blocks.h;null!=a;){var c=a.item;a=a.next;0==c._hx_index&&++b}return b};Mc.frame=function(a,b){var c=0;for(a=a.blocks.h;null!=
a;){var d=a.item;a=a.next;if(0==d._hx_index){d=d.frame;if(c==b)return d;++c}}return null};Mc.graphicControl=function(a,b){var c=0,d=null;for(a=a.blocks.h;null!=a;){var e=a.item;a=a.next;switch(e._hx_index){case 0:if(c==b)return d;d=null;++c;break;case 1:e=e.extension,0==e._hx_index&&(d=e.gce)}}return null};Mc.extractBGRA=function(a,b){for(var c=null,d=0,e=a.blocks.h;null!=e;){var f=e.item;e=e.next;switch(f._hx_index){case 0:f=f.frame;if(d==b){b=new S(new ArrayBuffer(f.width*f.height*4));a=f.localColorTable?
f.colorTable:a.globalColorTable;if(null==a)throw t.thrown("Frame does not have a color table!");c=null!=c&&c.hasTransparentColor?3*c.transparentIndex:-1;e=d=0;for(var g=f.pixels.length;e<g;){var h=e++;h=3*f.pixels.b[h];b.b[d]=a.b[h+2];b.b[d+1]=a.b[h+1];b.b[d+2]=a.b[h];b.b[d+3]=c==h?0:255;d+=4}return b}++d;c=null;break;case 1:f=f.extension,0==f._hx_index&&(c=f.gce)}}return null};Mc.extractRGBA=function(a,b){for(var c=null,d=0,e=a.blocks.h;null!=e;){var f=e.item;e=e.next;switch(f._hx_index){case 0:f=
f.frame;if(d==b){b=new S(new ArrayBuffer(f.width*f.height*4));a=f.localColorTable?f.colorTable:a.globalColorTable;if(null==a)throw t.thrown("Frame does not have a color table!");c=null!=c&&c.hasTransparentColor?3*c.transparentIndex:-1;e=d=0;for(var g=f.pixels.length;e<g;){var h=e++;h=3*f.pixels.b[h];b.b[d]=a.b[h];b.b[d+1]=a.b[h+1];b.b[d+2]=a.b[h+2];b.b[d+3]=c==h?0:255;d+=4}return b}++d;c=null;break;case 1:f=f.extension,0==f._hx_index&&(c=f.gce)}}return null};Mc.extractFullBGRA=function(a,b){for(var c=
null,d=0,e=new S(new ArrayBuffer(a.logicalScreenDescriptor.width*a.logicalScreenDescriptor.height*4)),f=a.blocks.h;null!=f;){var g=f.item;f=f.next;switch(g._hx_index){case 0:g=g.frame;var h=g.localColorTable?g.colorTable:a.globalColorTable;if(null==h)throw t.thrown("Frame does not have a color table!");var k=null!=c&&c.hasTransparentColor?3*c.transparentIndex:-1,l=g.pixels,m=0,p=4*(g.y*a.logicalScreenDescriptor.width+g.x),r=4*(a.logicalScreenDescriptor.width-g.width)+4;switch((d!=b&&null!=c?c.disposalMethod:
ec.NO_ACTION)._hx_index){case 2:h=0;for(l=l.length;h<l;)h++,e.b[p]=0,e.b[p+1]=0,e.b[p+2]=0,e.b[p+3]=0,++m==g.width?(m=0,p+=r):p+=4;break;case 3:break;default:c=0;for(var n=l.length;c<n;){var u=c++;u=3*l.b[u];k!=u&&(e.b[p]=h.b[u+2],e.b[p+1]=h.b[u+1],e.b[p+2]=h.b[u],e.b[p+3]=255);++m==g.width?(m=0,p+=r):p+=4}}if(d==b)return e;++d;c=null;break;case 1:g=g.extension,0==g._hx_index&&(c=g.gce)}}return e};Mc.extractFullRGBA=function(a,b){for(var c=null,d=0,e=new S(new ArrayBuffer(a.logicalScreenDescriptor.width*
a.logicalScreenDescriptor.height*4)),f=a.blocks.h;null!=f;){var g=f.item;f=f.next;switch(g._hx_index){case 0:g=g.frame;var h=g.localColorTable?g.colorTable:a.globalColorTable;if(null==h)throw t.thrown("Frame does not have a color table!");var k=null!=c&&c.hasTransparentColor?3*c.transparentIndex:-1,l=g.pixels,m=0,p=4*(g.y*a.logicalScreenDescriptor.width+g.x),r=4*(a.logicalScreenDescriptor.width-g.width)+4;switch((d!=b&&null!=c?c.disposalMethod:ec.NO_ACTION)._hx_index){case 2:h=0;for(l=l.length;h<
l;)h++,e.b[p]=0,e.b[p+1]=0,e.b[p+2]=0,e.b[p+3]=0,++m==g.width?(m=0,p+=r):p+=4;break;case 3:break;default:c=0;for(var n=l.length;c<n;){var u=c++;u=3*l.b[u];k!=u&&(e.b[p]=h.b[u],e.b[p+1]=h.b[u+1],e.b[p+2]=h.b[u+2],e.b[p+3]=255);++m==g.width?(m=0,p+=r):p+=4}}if(d==b)return e;++d;c=null;break;case 1:g=g.extension,0==g._hx_index&&(c=g.gce)}}return e};Mc.loopCount=function(a){for(a=a.blocks.h;null!=a;){var b=a.item;a=a.next;if(1==b._hx_index&&(b=b.extension,3==b._hx_index&&(b=b.ext,0==b._hx_index)))return b.loops}return 1};
Mc.log2=function(a){return Math.log(a)/Mc.LN2};var ua=K["format.mp3.SamplingRate"]={__ename__:!0,__constructs__:null,SR_8000:{_hx_name:"SR_8000",_hx_index:0,__enum__:"format.mp3.SamplingRate",toString:v},SR_11025:{_hx_name:"SR_11025",_hx_index:1,__enum__:"format.mp3.SamplingRate",toString:v},SR_12000:{_hx_name:"SR_12000",_hx_index:2,__enum__:"format.mp3.SamplingRate",toString:v},SR_22050:{_hx_name:"SR_22050",_hx_index:3,__enum__:"format.mp3.SamplingRate",toString:v},SR_24000:{_hx_name:"SR_24000",
_hx_index:4,__enum__:"format.mp3.SamplingRate",toString:v},SR_32000:{_hx_name:"SR_32000",_hx_index:5,__enum__:"format.mp3.SamplingRate",toString:v},SR_44100:{_hx_name:"SR_44100",_hx_index:6,__enum__:"format.mp3.SamplingRate",toString:v},SR_48000:{_hx_name:"SR_48000",_hx_index:7,__enum__:"format.mp3.SamplingRate",toString:v},SR_Bad:{_hx_name:"SR_Bad",_hx_index:8,__enum__:"format.mp3.SamplingRate",toString:v}};ua.__constructs__=[ua.SR_8000,ua.SR_11025,ua.SR_12000,ua.SR_22050,ua.SR_24000,ua.SR_32000,
ua.SR_44100,ua.SR_48000,ua.SR_Bad];ua.__empty_constructs__=[ua.SR_8000,ua.SR_11025,ua.SR_12000,ua.SR_22050,ua.SR_24000,ua.SR_32000,ua.SR_44100,ua.SR_48000,ua.SR_Bad];var C=K["format.mp3.Bitrate"]={__ename__:!0,__constructs__:null,BR_8:{_hx_name:"BR_8",_hx_index:0,__enum__:"format.mp3.Bitrate",toString:v},BR_16:{_hx_name:"BR_16",_hx_index:1,__enum__:"format.mp3.Bitrate",toString:v},BR_24:{_hx_name:"BR_24",_hx_index:2,__enum__:"format.mp3.Bitrate",toString:v},BR_32:{_hx_name:"BR_32",_hx_index:3,__enum__:"format.mp3.Bitrate",
toString:v},BR_40:{_hx_name:"BR_40",_hx_index:4,__enum__:"format.mp3.Bitrate",toString:v},BR_48:{_hx_name:"BR_48",_hx_index:5,__enum__:"format.mp3.Bitrate",toString:v},BR_56:{_hx_name:"BR_56",_hx_index:6,__enum__:"format.mp3.Bitrate",toString:v},BR_64:{_hx_name:"BR_64",_hx_index:7,__enum__:"format.mp3.Bitrate",toString:v},BR_80:{_hx_name:"BR_80",_hx_index:8,__enum__:"format.mp3.Bitrate",toString:v},BR_96:{_hx_name:"BR_96",_hx_index:9,__enum__:"format.mp3.Bitrate",toString:v},BR_112:{_hx_name:"BR_112",
_hx_index:10,__enum__:"format.mp3.Bitrate",toString:v},BR_128:{_hx_name:"BR_128",_hx_index:11,__enum__:"format.mp3.Bitrate",toString:v},BR_144:{_hx_name:"BR_144",_hx_index:12,__enum__:"format.mp3.Bitrate",toString:v},BR_160:{_hx_name:"BR_160",_hx_index:13,__enum__:"format.mp3.Bitrate",toString:v},BR_176:{_hx_name:"BR_176",_hx_index:14,__enum__:"format.mp3.Bitrate",toString:v},BR_192:{_hx_name:"BR_192",_hx_index:15,__enum__:"format.mp3.Bitrate",toString:v},BR_224:{_hx_name:"BR_224",_hx_index:16,__enum__:"format.mp3.Bitrate",
toString:v},BR_256:{_hx_name:"BR_256",_hx_index:17,__enum__:"format.mp3.Bitrate",toString:v},BR_288:{_hx_name:"BR_288",_hx_index:18,__enum__:"format.mp3.Bitrate",toString:v},BR_320:{_hx_name:"BR_320",_hx_index:19,__enum__:"format.mp3.Bitrate",toString:v},BR_352:{_hx_name:"BR_352",_hx_index:20,__enum__:"format.mp3.Bitrate",toString:v},BR_384:{_hx_name:"BR_384",_hx_index:21,__enum__:"format.mp3.Bitrate",toString:v},BR_416:{_hx_name:"BR_416",_hx_index:22,__enum__:"format.mp3.Bitrate",toString:v},BR_448:{_hx_name:"BR_448",
_hx_index:23,__enum__:"format.mp3.Bitrate",toString:v},BR_Free:{_hx_name:"BR_Free",_hx_index:24,__enum__:"format.mp3.Bitrate",toString:v},BR_Bad:{_hx_name:"BR_Bad",_hx_index:25,__enum__:"format.mp3.Bitrate",toString:v}};C.__constructs__=[C.BR_8,C.BR_16,C.BR_24,C.BR_32,C.BR_40,C.BR_48,C.BR_56,C.BR_64,C.BR_80,C.BR_96,C.BR_112,C.BR_128,C.BR_144,C.BR_160,C.BR_176,C.BR_192,C.BR_224,C.BR_256,C.BR_288,C.BR_320,C.BR_352,C.BR_384,C.BR_416,C.BR_448,C.BR_Free,C.BR_Bad];C.__empty_constructs__=[C.BR_8,C.BR_16,
C.BR_24,C.BR_32,C.BR_40,C.BR_48,C.BR_56,C.BR_64,C.BR_80,C.BR_96,C.BR_112,C.BR_128,C.BR_144,C.BR_160,C.BR_176,C.BR_192,C.BR_224,C.BR_256,C.BR_288,C.BR_320,C.BR_352,C.BR_384,C.BR_416,C.BR_448,C.BR_Free,C.BR_Bad];var Oa=function(){};Oa.__name__="format.mp3.MPEG";Oa.enum2Num=function(a){switch(a._hx_index){case 0:return 3;case 1:return 2;case 2:return 0;case 3:return Oa.Reserved}};Oa.num2Enum=function(a){switch(a){case 0:return Ub.MPEG_V25;case 2:return Ub.MPEG_V2;case 3:return Ub.MPEG_V1;default:return Ub.MPEG_Reserved}};
Oa.srNum2Enum=function(a){switch(a){case 8E3:return ua.SR_8000;case 11025:return ua.SR_11025;case 12E3:return ua.SR_12000;case 22050:return ua.SR_22050;case 24E3:return ua.SR_24000;case 32E3:return ua.SR_32000;case 44100:return ua.SR_44100;case 48E3:return ua.SR_48000;default:return ua.SR_Bad}};Oa.srEnum2Num=function(a){switch(a._hx_index){case 0:return 8E3;case 1:return 11025;case 2:return 12E3;case 3:return 22050;case 4:return 24E3;case 5:return 32E3;case 6:return 44100;case 7:return 48E3;case 8:return-1}};
Oa.getBitrateIdx=function(a,b,c){b=(b==Ub.MPEG_V1?Oa.V1_Bitrates:Oa.V2_Bitrates)[Zc.enum2Num(c)];if(b[0]==a)return 0;if(b[1]==a)return 1;if(b[2]==a)return 2;if(b[3]==a)return 3;if(b[4]==a)return 4;if(b[5]==a)return 5;if(b[6]==a)return 6;if(b[7]==a)return 7;if(b[8]==a)return 8;if(b[9]==a)return 9;if(b[10]==a)return 10;if(b[11]==a)return 11;if(b[12]==a)return 12;if(b[13]==a)return 13;if(b[14]==a)return 14;if(b[15]==a)return 15;throw t.thrown("Bitrate index not found");};Oa.getSamplingRateIdx=function(a,
b){b=Oa.SamplingRates[Oa.enum2Num(b)];if(b[0]==a)return 0;if(b[1]==a)return 1;if(b[2]==a)return 2;if(b[3]==a)return 3;throw t.thrown("Sampling rate index not found");};Oa.bitrateEnum2Num=function(a){switch(a._hx_index){case 0:return 8;case 1:return 16;case 2:return 24;case 3:return 32;case 4:return 40;case 5:return 48;case 6:return 56;case 7:return 64;case 8:return 80;case 9:return 96;case 10:return 112;case 11:return 128;case 12:return 144;case 13:return 160;case 14:return 176;case 15:return 192;
case 16:return 224;case 17:return 256;case 18:return 288;case 19:return 320;case 20:return 352;case 21:return 384;case 22:return 416;case 23:return 448;case 24:return 0;case 25:return-1}};Oa.bitrateNum2Enum=function(a){switch(a){case 0:return C.BR_Free;case 8:return C.BR_8;case 16:return C.BR_16;case 24:return C.BR_24;case 32:return C.BR_32;case 40:return C.BR_40;case 48:return C.BR_48;case 56:return C.BR_56;case 64:return C.BR_64;case 80:return C.BR_80;case 96:return C.BR_96;case 112:return C.BR_112;
case 128:return C.BR_128;case 144:return C.BR_144;case 160:return C.BR_160;case 176:return C.BR_176;case 192:return C.BR_192;case 224:return C.BR_224;case 256:return C.BR_256;case 288:return C.BR_288;case 320:return C.BR_320;case 352:return C.BR_352;case 384:return C.BR_384;case 416:return C.BR_416;case 448:return C.BR_448;default:return C.BR_Bad}};var Zc=function(){};Zc.__name__="format.mp3.CLayer";Zc.enum2Num=function(a){switch(a._hx_index){case 0:return Zc.LReserved;case 1:return Zc.LLayer3;case 2:return Zc.LLayer2;
case 3:return Zc.LLayer1}};Zc.num2Enum=function(a){switch(a){case 1:return $c.Layer3;case 2:return $c.Layer2;case 3:return $c.Layer1;default:return $c.LayerReserved}};var hf=function(){};hf.__name__="format.mp3.CChannelMode";hf.enum2Num=function(a){switch(a._hx_index){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3}};hf.num2Enum=function(a){switch(a){case 0:return ad.Stereo;case 1:return ad.JointStereo;case 2:return ad.DualChannel;case 3:return ad.Mono;default:throw t.thrown("assert");
}};var jf=function(){};jf.__name__="format.mp3.CEmphasis";jf.enum2Num=function(a){switch(a._hx_index){case 0:return 0;case 1:return 1;case 2:return 3;case 3:return 2}};jf.num2Enum=function(a){switch(a){case 0:return bd.NoEmphasis;case 1:return bd.Ms50_15;case 2:return bd.InvalidEmphasis;case 3:return bd.CCIT_J17;default:throw t.thrown("assert");}};var Ub=K["format.mp3.MPEGVersion"]={__ename__:!0,__constructs__:null,MPEG_V1:{_hx_name:"MPEG_V1",_hx_index:0,__enum__:"format.mp3.MPEGVersion",toString:v},
MPEG_V2:{_hx_name:"MPEG_V2",_hx_index:1,__enum__:"format.mp3.MPEGVersion",toString:v},MPEG_V25:{_hx_name:"MPEG_V25",_hx_index:2,__enum__:"format.mp3.MPEGVersion",toString:v},MPEG_Reserved:{_hx_name:"MPEG_Reserved",_hx_index:3,__enum__:"format.mp3.MPEGVersion",toString:v}};Ub.__constructs__=[Ub.MPEG_V1,Ub.MPEG_V2,Ub.MPEG_V25,Ub.MPEG_Reserved];Ub.__empty_constructs__=[Ub.MPEG_V1,Ub.MPEG_V2,Ub.MPEG_V25,Ub.MPEG_Reserved];var $c=K["format.mp3.Layer"]={__ename__:!0,__constructs__:null,LayerReserved:{_hx_name:"LayerReserved",
_hx_index:0,__enum__:"format.mp3.Layer",toString:v},Layer3:{_hx_name:"Layer3",_hx_index:1,__enum__:"format.mp3.Layer",toString:v},Layer2:{_hx_name:"Layer2",_hx_index:2,__enum__:"format.mp3.Layer",toString:v},Layer1:{_hx_name:"Layer1",_hx_index:3,__enum__:"format.mp3.Layer",toString:v}};$c.__constructs__=[$c.LayerReserved,$c.Layer3,$c.Layer2,$c.Layer1];$c.__empty_constructs__=[$c.LayerReserved,$c.Layer3,$c.Layer2,$c.Layer1];var ad=K["format.mp3.ChannelMode"]={__ename__:!0,__constructs__:null,Stereo:{_hx_name:"Stereo",
_hx_index:0,__enum__:"format.mp3.ChannelMode",toString:v},JointStereo:{_hx_name:"JointStereo",_hx_index:1,__enum__:"format.mp3.ChannelMode",toString:v},DualChannel:{_hx_name:"DualChannel",_hx_index:2,__enum__:"format.mp3.ChannelMode",toString:v},Mono:{_hx_name:"Mono",_hx_index:3,__enum__:"format.mp3.ChannelMode",toString:v}};ad.__constructs__=[ad.Stereo,ad.JointStereo,ad.DualChannel,ad.Mono];ad.__empty_constructs__=[ad.Stereo,ad.JointStereo,ad.DualChannel,ad.Mono];var bd=K["format.mp3.Emphasis"]=
{__ename__:!0,__constructs__:null,NoEmphasis:{_hx_name:"NoEmphasis",_hx_index:0,__enum__:"format.mp3.Emphasis",toString:v},Ms50_15:{_hx_name:"Ms50_15",_hx_index:1,__enum__:"format.mp3.Emphasis",toString:v},CCIT_J17:{_hx_name:"CCIT_J17",_hx_index:2,__enum__:"format.mp3.Emphasis",toString:v},InvalidEmphasis:{_hx_name:"InvalidEmphasis",_hx_index:3,__enum__:"format.mp3.Emphasis",toString:v}};bd.__constructs__=[bd.NoEmphasis,bd.Ms50_15,bd.CCIT_J17,bd.InvalidEmphasis];bd.__empty_constructs__=[bd.NoEmphasis,
bd.Ms50_15,bd.CCIT_J17,bd.InvalidEmphasis];var cd=K["format.mp3.FrameType"]={__ename__:!0,__constructs__:null,FT_MP3:{_hx_name:"FT_MP3",_hx_index:0,__enum__:"format.mp3.FrameType",toString:v},FT_NONE:{_hx_name:"FT_NONE",_hx_index:1,__enum__:"format.mp3.FrameType",toString:v}};cd.__constructs__=[cd.FT_MP3,cd.FT_NONE];cd.__empty_constructs__=[cd.FT_MP3,cd.FT_NONE];var Ah=function(a){this.i=a;a.set_bigEndian(!0);this.bits=new zh(a);this.sampleSize=this.samples=0;this.any_read=!1};Ah.__name__="format.mp3.Reader";
Ah.prototype={skipID3v2:function(){this.id3v2_version=this.i.readUInt16();this.id3v2_flags=this.i.readByte();var a=this.i.readByte()&127;a=a<<7|this.i.readByte()&127;a=a<<7|this.i.readByte()&127;a=a<<7|this.i.readByte()&127;this.id3v2_data=this.i.read(a)},seekFrame:function(){try{for(var a;;)if(a=this.i.readByte(),this.any_read||(this.any_read=!0,73==a&&(a=this.i.readByte(),68==a&&(a=this.i.readByte(),51==a&&this.skipID3v2()))),255==a&&(this.bits.nbits=0,a=this.bits.readBits(3),7==a))return cd.FT_MP3}catch(b){if(t.caught(b).unwrap()instanceof
dd)return cd.FT_NONE;throw b;}},readFrames:function(){for(var a=[],b;;){b=this.seekFrame();if(b==cd.FT_NONE)break;switch(b._hx_index){case 0:b=this.readFrame(),null!=b&&a.push(b)}}return a},readFrameHeader:function(){var a=this.bits.readBits(2),b=this.bits.readBits(2),c=!this.bits.readBit();if(a==Oa.Reserved||b==Zc.LReserved)return null;var d=this.bits.readBits(4);d=uc.getBitrate(a,b,d);var e=this.bits.readBits(2);e=uc.getSamplingRate(a,e);var f=this.bits.readBit(),g=this.bits.readBit();if(d==C.BR_Bad||
d==C.BR_Free||e==ua.SR_Bad)return null;var h=this.bits.readBits(2),k=this.bits.readBit(),l=this.bits.readBit(),m=this.bits.readBit(),p=this.bits.readBit(),r=this.bits.readBits(2),n=0;c&&(n=this.i.readUInt16());return{version:Oa.num2Enum(a),layer:Zc.num2Enum(b),hasCrc:c,crc16:n,bitrate:d,samplingRate:e,isPadded:f,privateBit:g,channelMode:hf.num2Enum(h),isIntensityStereo:k,isMSStereo:l,isCopyrighted:m,isOriginal:p,emphasis:jf.num2Enum(r)}},readFrame:function(){var a=this.readFrameHeader();if(null==
a||uc.isInvalidFrameHeader(a))return null;try{var b=this.i.read(uc.getSampleDataSizeHdr(a));this.samples+=uc.getSampleCountHdr(a);this.sampleSize+=b.length;return{header:a,data:b}}catch(c){if(t.caught(c).unwrap()instanceof dd)return null;throw c;}},read:function(){return{frames:this.readFrames(),sampleCount:this.samples,sampleSize:this.sampleSize,id3v2:null==this.id3v2_data?null:{versionBytes:this.id3v2_version,flagByte:this.id3v2_flags,data:this.id3v2_data}}},__class__:Ah};var uc=function(){};uc.__name__=
"format.mp3.Tools";uc.getBitrate=function(a,b,c){return a==Oa.Reserved||b==Zc.LReserved?C.BR_Bad:(3==a?Oa.V1_Bitrates:Oa.V2_Bitrates)[b][c]};uc.getSamplingRate=function(a,b){return Oa.SamplingRates[a][b]};uc.isInvalidFrameHeader=function(a){return a.version!=Ub.MPEG_Reserved&&a.layer!=$c.LayerReserved&&a.bitrate!=C.BR_Bad&&a.bitrate!=C.BR_Free?a.samplingRate==ua.SR_Bad:!0};uc.getSampleDataSize=function(a,b,c,d,e){return((3==a?144:72)*b*1E3/c|0)+(d?1:0)-(e?2:0)-4};uc.getSampleDataSizeHdr=function(a){return uc.getSampleDataSize(Oa.enum2Num(a.version),
Oa.bitrateEnum2Num(a.bitrate),Oa.srEnum2Num(a.samplingRate),a.isPadded,a.hasCrc)};uc.getSampleCount=function(a){return 3==a?1152:576};uc.getSampleCountHdr=function(a){return uc.getSampleCount(Oa.enum2Num(a.version))};uc.getFrameInfo=function(a){return y.string(a.header.version)+", "+y.string(a.header.layer)+", "+y.string(a.header.channelMode)+", "+y.string(a.header.samplingRate)+" Hz, "+y.string(a.header.bitrate)+" kbps Emphasis: "+y.string(a.header.emphasis)+", "+(a.header.hasCrc?"(CRC) ":"")+(a.header.isPadded?
"(Padded) ":"")+(a.header.isIntensityStereo?"(Intensity Stereo) ":"")+(a.header.isMSStereo?"(MS Stereo) ":"")+(a.header.isCopyrighted?"(Copyrighted) ":"")+(a.header.isOriginal?"(Original) ":"")};var Bc=K["format.png.Color"]={__ename__:!0,__constructs__:null,ColGrey:(z=function(a){return{_hx_index:0,alpha:a,__enum__:"format.png.Color",toString:v}},z._hx_name="ColGrey",z.__params__=["alpha"],z),ColTrue:(z=function(a){return{_hx_index:1,alpha:a,__enum__:"format.png.Color",toString:v}},z._hx_name="ColTrue",
z.__params__=["alpha"],z),ColIndexed:{_hx_name:"ColIndexed",_hx_index:2,__enum__:"format.png.Color",toString:v}};Bc.__constructs__=[Bc.ColGrey,Bc.ColTrue,Bc.ColIndexed];Bc.__empty_constructs__=[Bc.ColIndexed];var Va=K["format.png.Chunk"]={__ename__:!0,__constructs__:null,CEnd:{_hx_name:"CEnd",_hx_index:0,__enum__:"format.png.Chunk",toString:v},CHeader:(z=function(a){return{_hx_index:1,h:a,__enum__:"format.png.Chunk",toString:v}},z._hx_name="CHeader",z.__params__=["h"],z),CData:(z=function(a){return{_hx_index:2,
b:a,__enum__:"format.png.Chunk",toString:v}},z._hx_name="CData",z.__params__=["b"],z),CPalette:(z=function(a){return{_hx_index:3,b:a,__enum__:"format.png.Chunk",toString:v}},z._hx_name="CPalette",z.__params__=["b"],z),CUnknown:(z=function(a,b){return{_hx_index:4,id:a,data:b,__enum__:"format.png.Chunk",toString:v}},z._hx_name="CUnknown",z.__params__=["id","data"],z)};Va.__constructs__=[Va.CEnd,Va.CHeader,Va.CData,Va.CPalette,Va.CUnknown];Va.__empty_constructs__=[Va.CEnd];var Bh=function(a){this.i=
a;a.set_bigEndian(!0);this.checkCRC=!0};Bh.__name__="format.png.Reader";Bh.prototype={read:function(){var a=137;if(this.i.readByte()!=a)throw t.thrown("Invalid header");a=80;if(this.i.readByte()!=a)throw t.thrown("Invalid header");a=78;if(this.i.readByte()!=a)throw t.thrown("Invalid header");a=71;if(this.i.readByte()!=a)throw t.thrown("Invalid header");a=13;if(this.i.readByte()!=a)throw t.thrown("Invalid header");a=10;if(this.i.readByte()!=a)throw t.thrown("Invalid header");a=26;if(this.i.readByte()!=
a)throw t.thrown("Invalid header");a=10;if(this.i.readByte()!=a)throw t.thrown("Invalid header");for(a=new vd;;){var b=this.readChunk();a.add(b);if(b==Va.CEnd)break}return a},readHeader:function(a){a.set_bigEndian(!0);var b=a.readInt32(),c=a.readInt32(),d=a.readByte(),e=a.readByte();switch(e){case 0:e=Bc.ColGrey(!1);break;case 2:e=Bc.ColTrue(!1);break;case 3:e=Bc.ColIndexed;break;case 4:e=Bc.ColGrey(!0);break;case 6:e=Bc.ColTrue(!0);break;default:throw t.thrown("Unknown color model "+e+":"+d);}var f=
a.readByte(),g=a.readByte();if(0!=f||0!=g)throw t.thrown("Invalid header");a=a.readByte();if(0!=a&&1!=a)throw t.thrown("Invalid header");return{width:b,height:c,colbits:d,color:e,interlaced:1==a}},readChunk:function(){var a=this.i.readInt32(),b=this.i.readString(4);a=this.i.read(a);var c=this.i.readInt32();if(this.checkCRC){var d=-1;var e=(d^F.cca(b,0))&255;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&
1)&-306674912;e=e>>>1^-(e&1)&-306674912;d=d>>>8^e>>>1^-(e&1)&-306674912;e=(d^F.cca(b,1))&255;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;d=d>>>8^e>>>1^-(e&1)&-306674912;e=(d^F.cca(b,2))&255;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;
d=d>>>8^e>>>1^-(e&1)&-306674912;e=(d^F.cca(b,3))&255;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;d=d>>>8^e>>>1^-(e&1)&-306674912;for(var f=a.b.bufferValue,g=0,h=a.length;g<h;)e=g++,e=(d^f.bytes[e])&255,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>
1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,d=d>>>8^e;if((d^-1)!=c)throw t.thrown("CRC check failure");}switch(b){case "IDAT":return Va.CData(a);case "IEND":return Va.CEnd;case "IHDR":return Va.CHeader(this.readHeader(new Vb(a)));case "PLTE":return Va.CPalette(a);default:return Va.CUnknown(b,a)}},__class__:Bh};var Hb=function(){};Hb.__name__="format.png.Tools";Hb.getHeader=function(a){for(a=a.h;null!=a;){var b=a.item;a=a.next;if(1==b._hx_index)return b.h}throw t.thrown("Header not found");};Hb.getPalette=
function(a){for(a=a.h;null!=a;){var b=a.item;a=a.next;if(3==b._hx_index)return b.b}return null};Hb.filter=function(a,b,c,d,e,f,g){null==g&&(g=4);var h=0==c?0:a.b[f-d];a=0==b||0==c?0:a.b[f-d-g];d=e+h-a;b=d-e;0>b&&(b=-b);c=d-h;0>c&&(c=-c);d-=a;0>d&&(d=-d);return b<=c&&b<=d?e:c<=d?h:a};Hb.reverseBytes=function(a){for(var b=0,c=0,d=a.length>>2;c<d;){c++;var e=a.b[b],f=a.b[b+1],g=a.b[b+2],h=a.b[b+3];a.b[b++]=h;a.b[b++]=g;a.b[b++]=f;a.b[b++]=e}};Hb.extractGrey=function(a){var b=Hb.getHeader(a),c=new S(new ArrayBuffer(b.width*
b.height)),d=null,e=null;for(a=a.h;null!=a;){var f=a.item;a=a.next;var g=f;if(2==g._hx_index){var h=g.b;null!=e?e.add(h):null==d?d=h:(e=new Id,e.add(d),e.add(h),d=null)}}null!=e&&(d=e.getBytes());if(null==d)throw t.thrown("Data not found");d=wg.run(d);a=e=0;var k=b.color;if(0==k._hx_index){k=k.alpha;if(8!=b.colbits)throw t.thrown("Unsupported color mode");f=b.width;if(d.length<b.height*((k?2:1)*f+1))throw t.thrown("Not enough data");var l=k?2:1;k=0;for(b=b.height;k<b;){var m=k++;h=d.b[e++];switch(h){case 0:h=
0;for(m=f;h<m;)h++,g=d.b[e],e+=l,c.b[a++]=g;break;case 1:m=h=0;for(g=f;m<g;)m++,h+=d.b[e],e+=l,c.b[a++]=h;break;case 2:h=0==m?0:f;m=0;for(g=f;m<g;){m++;var p=d.b[e]+c.b[a-h];e+=l;c.b[a++]=p}break;case 3:h=0;m=0==m?0:f;g=0;for(p=f;g<p;)g++,h=d.b[e]+(h+c.b[a-m]>>1)&255,e+=l,c.b[a++]=h;break;case 4:p=f;for(var r=0,n=0,u=f;n<u;){g=n++;var w=1;null==w&&(w=4);h=0==m?0:c.b[a-p];g=0==g||0==m?0:c.b[a-p-w];var I=r+h-g;w=I-r;0>w&&(w=-w);var q=I-h;0>q&&(q=-q);I-=g;0>I&&(I=-I);r=(w<=q&&w<=I?r:q<=I?h:g)+d.b[e]&
255;e+=l;c.b[a++]=r}break;default:throw t.thrown("Invalid filter "+h);}}}else throw t.thrown("Unsupported color mode");return c};Hb.extract32=function(a,b,c){var d,e,f,g,h,k,l,m,p,r,n,u,w=Hb.getHeader(a),I=null==b?new S(new ArrayBuffer(w.width*w.height*4)):b,q=null,v=null;for(k=a.h;null!=k;){var x=k.item;k=k.next;var y=x;if(2==y._hx_index){var z=y.b;null!=v?v.add(z):null==q?q=z:(v=new Id,v.add(q),v.add(z),q=null)}}null!=v&&(q=v.getBytes());if(null==q)throw t.thrown("Data not found");q=wg.run(q);var A=
e=0,eb=0;c&&(eb=8*-w.width,A=4*(w.height-1)*w.width);var B=c?-1:1;var Jd=w.color;switch(Jd._hx_index){case 0:var ab=Jd.alpha;if(8!=w.colbits)throw t.thrown("Unsupported color mode");var C=w.width;var E=(ab?2:1)*C+1;if(q.length<w.height*E)throw t.thrown("Not enough data");var H=-1;if(!ab)for(k=a.h;null!=k;){x=k.item;k=k.next;var G=x;if(4==G._hx_index&&"tRNS"==G.id){var J=G.data;2<=J.length&&(H=J.b[1]);break}}var D=0;for(d=w.height;D<d;){var F=D++;var M=q.b[e++];switch(M){case 0:if(ab){var K=0;for(h=
C;K<h;){K++;var N=q.b[e++];I.b[A++]=N;I.b[A++]=N;I.b[A++]=N;I.b[A++]=q.b[e++]}}else{var Q=0;for(g=C;Q<g;){Q++;var P=q.b[e++];I.b[A++]=P;I.b[A++]=P;I.b[A++]=P;I.b[A++]=P==H?0:255}}break;case 1:var L=0;var O=0;if(ab){var R=0;for(f=C;R<f;)R++,L+=q.b[e++],I.b[A++]=L,I.b[A++]=L,I.b[A++]=L,O+=q.b[e++],I.b[A++]=O}else{var U=0;for(u=C;U<u;){var V=U++;L+=q.b[e++];I.b[A++]=L;I.b[A++]=L;I.b[A++]=L;I.b[A++]=L==H?0:255}}break;case 2:E=0==F?0:4*C*B;if(ab){var T=0;for(n=C;T<n;){T++;var W=q.b[e++]+I.b[A-E];I.b[A++]=
W;I.b[A++]=W;I.b[A++]=W;var X=q.b[e++]+I.b[A-E];I.b[A++]=X}}else{var aa=0;for(r=C;aa<r;){aa++;var ea=q.b[e++]+I.b[A-E];I.b[A++]=ea;I.b[A++]=ea;I.b[A++]=ea;I.b[A++]=ea==H?0:255}}break;case 3:var ba=0,ia=0;var Z=0==F?0:4*C*B;if(ab){var ca=0;for(p=C;ca<p;)ca++,ba=q.b[e++]+(ba+I.b[A-Z]>>1)&255,I.b[A++]=ba,I.b[A++]=ba,I.b[A++]=ba,ia=q.b[e++]+(ia+I.b[A-Z]>>1)&255,I.b[A++]=ia}else{var ka=0;for(m=C;ka<m;)ka++,ba=q.b[e++]+(ba+I.b[A-Z]>>1)&255,I.b[A++]=ba,I.b[A++]=ba,I.b[A++]=ba,I.b[A++]=ba==H?0:255}break;
case 4:var Y=4*C*B;var fa=0,ma=0;if(ab){var na=0;for(l=C;na<l;){var oa=na++;z=0==F?0:I.b[A-Y];y=0==oa||0==F?0:I.b[A-Y-4];var la=fa+z-y;var ha=la-fa;0>ha&&(ha=-ha);var da=la-z;0>da&&(da=-da);var ja=la-y;0>ja&&(ja=-ja);var ya=e++;fa=(ha<=da&&ha<=ja?fa:da<=ja?z:y)+q.b[ya]&255;I.b[A++]=fa;I.b[A++]=fa;I.b[A++]=fa;var ta=0==F?0:I.b[A-Y];var pa=0==oa||0==F?0:I.b[A-Y-4];var ra=ma+ta-pa;var sa=ra-ma;0>sa&&(sa=-sa);var qa=ra-ta;0>qa&&(qa=-qa);var ua=ra-pa;0>ua&&(ua=-ua);var Ba=e++;ma=(sa<=qa&&sa<=ua?ma:qa<=
ua?ta:pa)+q.b[Ba]&255;I.b[A++]=ma}}else{var Ea=0;for(var Ha=C;Ea<Ha;){var Da=Ea++;var Aa=0==F?0:I.b[A-Y];var wa=0==Da||0==F?0:I.b[A-Y-4];var xa=fa+Aa-wa;var za=xa-fa;0>za&&(za=-za);var va=xa-Aa;0>va&&(va=-va);var Ca=xa-wa;0>Ca&&(Ca=-Ca);var La=e++;fa=(za<=va&&za<=Ca?fa:va<=Ca?Aa:wa)+q.b[La]&255;I.b[A++]=fa;I.b[A++]=fa;I.b[A++]=fa;I.b[A++]=fa==H?0:255}}break;default:throw t.thrown("Invalid filter "+M);}A+=eb}break;case 1:ab=Jd.alpha;if(8!=w.colbits)throw t.thrown("Unsupported color mode");C=w.width;
E=(ab?4:3)*C+1;if(q.length<w.height*E)throw t.thrown("Not enough data");var Ga=-1,Fa=-1,Ia=-1;if(!ab)for(k=a.h;null!=k;)if(x=k.item,k=k.next,G=x,4==G._hx_index&&"tRNS"==G.id){J=G.data;6<=J.length&&(Ga=J.b[1],Fa=J.b[3],Ia=J.b[5]);break}var jb=0,Bb=0,Cb=0;Jd=O=0;for(D=w.height;Jd<D;){F=Jd++;M=q.b[e++];switch(M){case 0:if(ab)for(d=0,K=C;d<K;)d++,I.b[A++]=q.b[e+2],I.b[A++]=q.b[e+1],I.b[A++]=q.b[e],I.b[A++]=q.b[e+3],e+=4;else for(h=0,Q=C;h<Q;)h++,Cb=q.b[e+2],I.b[A++]=Cb,Bb=q.b[e+1],I.b[A++]=Bb,jb=q.b[e],
I.b[A++]=jb,I.b[A++]=jb==Ga&&Bb==Fa&&Cb==Ia?0:255,e+=3;break;case 1:jb=Bb=Cb=O=0;if(ab)for(g=0,R=C;g<R;)g++,Cb+=q.b[e+2],I.b[A++]=Cb,Bb+=q.b[e+1],I.b[A++]=Bb,jb+=q.b[e],I.b[A++]=jb,O+=q.b[e+3],I.b[A++]=O,e+=4;else for(f=0,U=C;f<U;)V=f++,Cb+=q.b[e+2],I.b[A++]=Cb,Bb+=q.b[e+1],I.b[A++]=Bb,jb+=q.b[e],I.b[A++]=jb,I.b[A++]=jb==Ga&&Bb==Fa&&Cb==Ia?0:255,e+=3;break;case 2:E=0==F?0:4*C*B;if(ab)for(u=0,T=C;u<T;)u++,I.b[A]=q.b[e+2]+I.b[A-E],++A,I.b[A]=q.b[e+1]+I.b[A-E],++A,I.b[A]=q.b[e]+I.b[A-E],++A,I.b[A]=q.b[e+
3]+I.b[A-E],++A,e+=4;else for(n=0,aa=C;n<aa;)n++,Cb=q.b[e+2]+I.b[A-E],I.b[A]=Cb,++A,Bb=q.b[e+1]+I.b[A-E],I.b[A]=Bb,++A,jb=q.b[e]+I.b[A-E],I.b[A]=jb,++A,I.b[A++]=jb==Ga&&Bb==Fa&&Cb==Ia?0:255,e+=3;break;case 3:jb=Bb=Cb=O=0;Z=0==F?0:4*C*B;if(ab)for(r=0,ca=C;r<ca;)r++,Cb=q.b[e+2]+(Cb+I.b[A-Z]>>1)&255,I.b[A++]=Cb,Bb=q.b[e+1]+(Bb+I.b[A-Z]>>1)&255,I.b[A++]=Bb,jb=q.b[e]+(jb+I.b[A-Z]>>1)&255,I.b[A++]=jb,O=q.b[e+3]+(O+I.b[A-Z]>>1)&255,I.b[A++]=O,e+=4;else for(p=0,ka=C;p<ka;)p++,Cb=q.b[e+2]+(Cb+I.b[A-Z]>>1)&
255,I.b[A++]=Cb,Bb=q.b[e+1]+(Bb+I.b[A-Z]>>1)&255,I.b[A++]=Bb,jb=q.b[e]+(jb+I.b[A-Z]>>1)&255,I.b[A++]=jb,I.b[A++]=jb==Ga&&Bb==Fa&&Cb==Ia?0:255,e+=3;break;case 4:Y=4*C*B;jb=Bb=Cb=O=0;if(ab)for(m=0,na=C;m<na;){oa=m++;z=0==F?0:I.b[A-Y];y=0==oa||0==F?0:I.b[A-Y-4];la=Cb+z-y;ha=la-Cb;0>ha&&(ha=-ha);da=la-z;0>da&&(da=-da);ja=la-y;0>ja&&(ja=-ja);Cb=(ha<=da&&ha<=ja?Cb:da<=ja?z:y)+q.b[e+2]&255;I.b[A++]=Cb;ta=0==F?0:I.b[A-Y];pa=0==oa||0==F?0:I.b[A-Y-4];ra=Bb+ta-pa;sa=ra-Bb;0>sa&&(sa=-sa);qa=ra-ta;0>qa&&(qa=-qa);
ua=ra-pa;0>ua&&(ua=-ua);Bb=(sa<=qa&&sa<=ua?Bb:qa<=ua?ta:pa)+q.b[e+1]&255;I.b[A++]=Bb;Aa=0==F?0:I.b[A-Y];wa=0==oa||0==F?0:I.b[A-Y-4];xa=jb+Aa-wa;za=xa-jb;0>za&&(za=-za);va=xa-Aa;0>va&&(va=-va);Ca=xa-wa;0>Ca&&(Ca=-Ca);jb=(za<=va&&za<=Ca?jb:va<=Ca?Aa:wa)+q.b[e]&255;I.b[A++]=jb;var Ma=0==F?0:I.b[A-Y];var Ja=0==oa||0==F?0:I.b[A-Y-4];var Ra=O+Ma-Ja,Na=Ra-O;0>Na&&(Na=-Na);var Pa=Ra-Ma;0>Pa&&(Pa=-Pa);var Sa=Ra-Ja;0>Sa&&(Sa=-Sa);O=(Na<=Pa&&Na<=Sa?O:Pa<=Sa?Ma:Ja)+q.b[e+3]&255;I.b[A++]=O;e+=4}else for(l=0,Ea=
C;l<Ea;){Da=l++;var Ua=0==F?0:I.b[A-Y],$a=0==Da||0==F?0:I.b[A-Y-4],Za=Cb+Ua-$a,Oa=Za-Cb;0>Oa&&(Oa=-Oa);var Xa=Za-Ua;0>Xa&&(Xa=-Xa);var Wa=Za-$a;0>Wa&&(Wa=-Wa);Cb=(Oa<=Xa&&Oa<=Wa?Cb:Xa<=Wa?Ua:$a)+q.b[e+2]&255;I.b[A++]=Cb;var Ka=0==F?0:I.b[A-Y],Ya=0==Da||0==F?0:I.b[A-Y-4],fb=Bb+Ka-Ya,cb=fb-Bb;0>cb&&(cb=-cb);var db=fb-Ka;0>db&&(db=-db);var Va=fb-Ya;0>Va&&(Va=-Va);Bb=(cb<=db&&cb<=Va?Bb:db<=Va?Ka:Ya)+q.b[e+1]&255;I.b[A++]=Bb;var kb=0==F?0:I.b[A-Y],lb=0==Da||0==F?0:I.b[A-Y-4],nb=jb+kb-lb,bb=nb-jb;0>bb&&
(bb=-bb);var Qa=nb-kb;0>Qa&&(Qa=-Qa);var hb=nb-lb;0>hb&&(hb=-hb);jb=(bb<=Qa&&bb<=hb?jb:Qa<=hb?kb:lb)+q.b[e]&255;I.b[A++]=jb;I.b[A++]=jb==Ga&&Bb==Fa&&Cb==Ia?0:255;e+=3}break;default:throw t.thrown("Invalid filter "+M);}A+=eb}break;case 2:var gb=Hb.getPalette(a);if(null==gb)throw t.thrown("PNG Palette is missing");ab=null;for(k=a.h;null!=k;)if(x=k.item,k=k.next,G=x,4==G._hx_index&&"tRNS"==G.id){ab=J=G.data;break}if(null!=ab&&ab.length<1<<w.colbits){var rb=new S(new ArrayBuffer(1<<w.colbits));rb.blit(0,
ab,0,ab.length);rb.fill(ab.length,rb.length-ab.length,255);ab=rb}C=w.width;E=Math.ceil(C*w.colbits/8)+1;if(q.length<w.height*E)throw t.thrown("Not enough data");var ob=E-1;Jd=0;for(D=w.height;Jd<D;)if(F=Jd++,M=q.b[e++],0==M)e+=ob;else switch(M){case 1:d=y=0;for(K=C;d<K;)d++,N=q.b[e],y+=N,q.b[e++]=y&255;break;case 2:E=0==F?0:ob+1;h=0;for(Q=C;h<Q;)h++,P=q.b[e],q.b[e]=P+q.b[e-E],++e;break;case 3:pa=0;Z=0==F?0:ob+1;g=0;for(R=C;g<R;)g++,W=q.b[e],pa=W+(pa+q.b[e-Z]>>1)&255,q.b[e++]=pa;break;case 4:Y=ob+
1;f=wa=0;for(U=C;f<U;){V=f++;ea=q.b[e];var Ta=1;null==Ta&&(Ta=4);z=0==F?0:q.b[e-Y];Ja=0==V||0==F?0:q.b[e-Y-Ta];la=wa+z-Ja;ha=la-wa;0>ha&&(ha=-ha);da=la-z;0>da&&(da=-da);ja=la-Ja;0>ja&&(ja=-ja);wa=(ha<=da&&ha<=ja?wa:da<=ja?z:Ja)+ea&255;q.b[e++]=wa}break;default:throw t.thrown("Invalid filter "+M);}e=0;if(8==w.colbits)for(Jd=0,D=w.height;Jd<D;){F=Jd++;++e;d=0;for(K=w.width;d<K;)d++,y=q.b[e++],I.b[A++]=gb.b[3*y+2],I.b[A++]=gb.b[3*y+1],I.b[A++]=gb.b[3*y],I.b[A++]=null!=ab?ab.b[y]:255;A+=eb}else if(8>
w.colbits){var qb=w.colbits,ib=(1<<qb)-1;Jd=0;for(D=w.height;Jd<D;){F=Jd++;++e;var tb=0,mb=0;d=0;for(K=w.width;d<K;)d++,mb<qb&&(tb=tb<<8|q.b[e++],mb+=8),y=tb>>>mb-qb&ib,mb-=qb,I.b[A++]=gb.b[3*y+2],I.b[A++]=gb.b[3*y+1],I.b[A++]=gb.b[3*y],I.b[A++]=null!=ab?ab.b[y]:255;A+=eb}}else throw t.thrown(w.colbits+" indexed bits per pixel not supported");}return I};Hb.extract=function(a,b,c){null==c&&(c=!1);var d=Hb.getHeader(a),e=!1;var f=d.color;switch(f._hx_index){case 0:var g=f.alpha;var h=(e=g)?2:1;break;
case 1:h=(e=g=f.alpha)?4:3;break;case 2:throw t.thrown("assert");}c&&e&&(c=!1);e=d.colbits>>3;g=c?h+1:h;null==b&&(b=new S(new ArrayBuffer(g*e*d.width*d.height)));var k=null;f=null;for(a=a.h;null!=a;){var l=a.item;a=a.next;var m=l;if(2==m._hx_index){var p=m.b;null!=f?f.add(p):null==k?k=p:(f=new Id,f.add(k),f.add(p),k=null)}}null!=f&&(k=f.getBytes());if(null==k)throw t.thrown("Data not found");k=wg.run(k);a=l=0;var r=d.width,n=h*e,u=g*e*r,w=g*e;if(k.length<d.height*(n*r+1))throw t.thrown("Not enough data");
f=[];h=0;for(m=n;h<m;)h++,f.push(0);var I=f;f=0;for(h=d.height;f<h;){var q=f++,v=k.b[l++];if(0!=v&&2!=v){m=0;for(var x=n;m<x;)p=m++,I[p]=0}switch(v){case 0:p=0;for(q=r;p<q;){p++;m=0;for(v=n;m<v;)m++,b.b[a++]=k.b[l++];c&&(b.b[a++]=255,2==e&&(b.b[a++]=255))}break;case 1:p=0;for(q=r;p<q;){p++;m=0;for(v=n;m<v;)x=m++,I[x]+=k.b[l++],b.b[a++]=I[x];c&&(b.b[a++]=255,2==e&&(b.b[a++]=255))}break;case 2:p=0==q?0:u;q=0;for(m=r;q<m;){q++;v=0;for(x=n;v<x;){v++;var y=k.b[l++]+b.b[a-p];b.b[a++]=y}c&&(b.b[a++]=255,
2==e&&(b.b[a++]=255))}break;case 3:p=0==q?0:u;q=0;for(m=r;q<m;){q++;v=0;for(x=n;v<x;)y=v++,I[y]=k.b[l++]+(I[y]+b.b[a-p]>>1)&255,b.b[a++]=I[y];c&&(b.b[a++]=255,2==e&&(b.b[a++]=255))}break;case 4:v=0;for(x=r;v<x;){y=v++;for(var z=0,A=n;z<A;){var eb=z++,B=I[eb];p=0==q?0:b.b[a-u];m=0==y||0==q?0:b.b[a-u-w];var C=B+p-m,ab=C-B;0>ab&&(ab=-ab);var E=C-p;0>E&&(E=-E);C-=m;0>C&&(C=-C);var G=l++;I[eb]=(ab<=E&&ab<=C?B:E<=C?p:m)+k.b[G]&255;b.b[a++]=I[eb]}c&&(b.b[a++]=255,2==e&&(b.b[a++]=255))}break;default:throw t.thrown("Invalid filter "+
v);}}if(16==d.colbits)for(f=a=0,h=d.height*r*g;f<h;)f++,c=b.b[a],p=b.b[a+1],b.b[a++]=p,b.b[a++]=c;return b};Hb.buildGrey=function(a,b,c,d){null==d&&(d=9);for(var e=new S(new ArrayBuffer(a*b+b)),f=0,g=0,h=0;h<b;){h++;for(var k=e.b[f++]=0,l=a;k<l;)k++,e.b[f++]=c.b[g++]}c=new vd;c.add(Va.CHeader({width:a,height:b,colbits:8,color:Bc.ColGrey(!1),interlaced:!1}));c.add(Va.CData(We.run(e,d)));c.add(Va.CEnd);return c};Hb.buildIndexed=function(a,b,c,d,e){null==e&&(e=9);for(var f=new S(new ArrayBuffer(a*b+
b)),g=0,h=0,k=0;k<b;){k++;for(var l=f.b[g++]=0,m=a;l<m;)l++,f.b[g++]=c.b[h++]}c=new vd;c.add(Va.CHeader({width:a,height:b,colbits:8,color:Bc.ColIndexed,interlaced:!1}));c.add(Va.CPalette(d));c.add(Va.CData(We.run(f,e)));c.add(Va.CEnd);return c};Hb.buildRGB=function(a,b,c,d){null==d&&(d=9);for(var e=new S(new ArrayBuffer(a*b*3+b)),f=0,g=0,h=0;h<b;){h++;for(var k=e.b[f++]=0,l=a;k<l;)k++,e.b[f++]=c.b[g+2],e.b[f++]=c.b[g+1],e.b[f++]=c.b[g],g+=3}c=new vd;c.add(Va.CHeader({width:a,height:b,colbits:8,color:Bc.ColTrue(!1),
interlaced:!1}));c.add(Va.CData(We.run(e,d)));c.add(Va.CEnd);return c};Hb.build32ARGB=function(a,b,c,d){null==d&&(d=9);for(var e=new S(new ArrayBuffer(a*b*4+b)),f=0,g=0,h=0;h<b;){h++;for(var k=e.b[f++]=0,l=a;k<l;)k++,e.b[f++]=c.b[g+1],e.b[f++]=c.b[g+2],e.b[f++]=c.b[g+3],e.b[f++]=c.b[g],g+=4}c=new vd;c.add(Va.CHeader({width:a,height:b,colbits:8,color:Bc.ColTrue(!0),interlaced:!1}));c.add(Va.CData(We.run(e,d)));c.add(Va.CEnd);return c};Hb.build32BGRA=function(a,b,c,d){null==d&&(d=9);for(var e=new S(new ArrayBuffer(a*
b*4+b)),f=0,g=0,h=0;h<b;){h++;for(var k=e.b[f++]=0,l=a;k<l;)k++,e.b[f++]=c.b[g+2],e.b[f++]=c.b[g+1],e.b[f++]=c.b[g],e.b[f++]=c.b[g+3],g+=4}c=new vd;c.add(Va.CHeader({width:a,height:b,colbits:8,color:Bc.ColTrue(!0),interlaced:!1}));c.add(Va.CData(We.run(e,d)));c.add(Va.CEnd);return c};var Ch=function(a){this.o=a;a.set_bigEndian(!0)};Ch.__name__="format.png.Writer";Ch.prototype={write:function(a){this.o.writeByte(137);this.o.writeByte(80);this.o.writeByte(78);this.o.writeByte(71);this.o.writeByte(13);
this.o.writeByte(10);this.o.writeByte(26);this.o.writeByte(10);for(a=a.h;null!=a;){var b=a.item;a=a.next;switch(b._hx_index){case 0:this.writeChunk("IEND",new S(new ArrayBuffer(0)));break;case 1:var c=b.h;b=new Yc;b.set_bigEndian(!0);b.writeInt32(c.width);b.writeInt32(c.height);b.writeByte(c.colbits);var d=c.color;switch(d._hx_index){case 0:var e=d.alpha?4:0;break;case 1:e=d.alpha?6:2;break;case 2:e=3}b.writeByte(e);b.writeByte(0);b.writeByte(0);b.writeByte(c.interlaced?1:0);this.writeChunk("IHDR",
b.getBytes());break;case 2:this.writeChunk("IDAT",b.b);break;case 3:this.writeChunk("PLTE",b.b);break;case 4:this.writeChunk(b.id,b.data)}}},writeChunk:function(a,b){this.o.writeInt32(b.length);this.o.writeString(a);this.o.write(b);var c=-1;var d=(c^F.cca(a,0))&255;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;c=c>>>8^d>>>1^-(d&1)&-306674912;d=(c^F.cca(a,1))&255;
d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;c=c>>>8^d>>>1^-(d&1)&-306674912;d=(c^F.cca(a,2))&255;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;c=c>>>8^d>>>1^-(d&1)&-306674912;d=(c^F.cca(a,3))&255;d=d>>>1^-(d&1)&-306674912;d=d>>>
1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;c=c>>>8^d>>>1^-(d&1)&-306674912;a=b.b.bufferValue;var e=0;for(b=b.length;e<b;)d=e++,d=(c^a.bytes[d])&255,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,c=c>>>8^d;this.o.writeInt32(c^-1)},__class__:Ch};
var fc=K["format.tga.ImageOrigin"]={__ename__:!0,__constructs__:null,BottomLeft:{_hx_name:"BottomLeft",_hx_index:0,__enum__:"format.tga.ImageOrigin",toString:v},BottomRight:{_hx_name:"BottomRight",_hx_index:1,__enum__:"format.tga.ImageOrigin",toString:v},TopLeft:{_hx_name:"TopLeft",_hx_index:2,__enum__:"format.tga.ImageOrigin",toString:v},TopRight:{_hx_name:"TopRight",_hx_index:3,__enum__:"format.tga.ImageOrigin",toString:v}};fc.__constructs__=[fc.BottomLeft,fc.BottomRight,fc.TopLeft,fc.TopRight];
fc.__empty_constructs__=[fc.BottomLeft,fc.BottomRight,fc.TopLeft,fc.TopRight];var tb=K["format.tga.ImageType"]={__ename__:!0,__constructs__:null,NoImage:{_hx_name:"NoImage",_hx_index:0,__enum__:"format.tga.ImageType",toString:v},UncompressedColorMapped:{_hx_name:"UncompressedColorMapped",_hx_index:1,__enum__:"format.tga.ImageType",toString:v},UncompressedTrueColor:{_hx_name:"UncompressedTrueColor",_hx_index:2,__enum__:"format.tga.ImageType",toString:v},UncompressedBlackAndWhite:{_hx_name:"UncompressedBlackAndWhite",
_hx_index:3,__enum__:"format.tga.ImageType",toString:v},RunLengthColorMapped:{_hx_name:"RunLengthColorMapped",_hx_index:4,__enum__:"format.tga.ImageType",toString:v},RunLengthTrueColor:{_hx_name:"RunLengthTrueColor",_hx_index:5,__enum__:"format.tga.ImageType",toString:v},RunLengthBlackAndWhite:{_hx_name:"RunLengthBlackAndWhite",_hx_index:6,__enum__:"format.tga.ImageType",toString:v},Unknown:(z=function(a){return{_hx_index:7,type:a,__enum__:"format.tga.ImageType",toString:v}},z._hx_name="Unknown",
z.__params__=["type"],z)};tb.__constructs__=[tb.NoImage,tb.UncompressedColorMapped,tb.UncompressedTrueColor,tb.UncompressedBlackAndWhite,tb.RunLengthColorMapped,tb.RunLengthTrueColor,tb.RunLengthBlackAndWhite,tb.Unknown];tb.__empty_constructs__=[tb.NoImage,tb.UncompressedColorMapped,tb.UncompressedTrueColor,tb.UncompressedBlackAndWhite,tb.RunLengthColorMapped,tb.RunLengthTrueColor,tb.RunLengthBlackAndWhite];var Dh=function(a){this.i=a;a.set_bigEndian(!1)};Dh.__name__="format.tga.Reader";Dh.prototype=
{read:function(){var a=this.i.readByte(),b=this.readHeader();a=0==a?"":this.i.readString(a);var c=this.readColorMapData(b);return{header:b,imageId:a,colorMapData:c,imageData:this.readImageData(b,c),developerData:null}},readHeader:function(){var a=this.i.readByte();var b=this.i.readByte();switch(b){case 0:b=tb.NoImage;break;case 1:b=tb.UncompressedColorMapped;break;case 2:b=tb.UncompressedTrueColor;break;case 3:b=tb.UncompressedBlackAndWhite;break;case 9:b=tb.RunLengthColorMapped;break;case 10:b=tb.RunLengthTrueColor;
break;case 11:b=tb.RunLengthBlackAndWhite;break;default:b=tb.Unknown(b)}var c=this.i.readInt16(),d=this.i.readInt16(),e=this.i.readByte(),f=this.i.readInt16(),g=this.i.readInt16(),h=this.i.readInt16(),k=this.i.readInt16(),l=this.i.readByte(),m=this.i.readByte();switch(m&48){case 16:var p=fc.BottomRight;break;case 32:p=fc.TopLeft;break;case 48:p=fc.TopRight;break;default:p=fc.BottomLeft}return{colorMapType:a,imageType:b,colorMapFirstIndex:c,colorMapLength:d,colorMapEntrySize:e,xOrigin:f,yOrigin:g,
width:h,height:k,bitsPerPixel:l,alphaChannelBits:m&15,imageOrigin:p}},readColorMapData:function(a){return 0==a.colorMapType?null:this.readPixels(a.colorMapEntrySize,a.colorMapLength,a.alphaChannelBits,!1)},readImageData:function(a,b){switch(a.imageType._hx_index){case 0:return null;case 1:return this.readIndexes(a.bitsPerPixel,a.width*a.height,b,a.colorMapFirstIndex,!1);case 2:return this.readPixels(a.bitsPerPixel,a.width*a.height,a.alphaChannelBits,!1);case 3:return this.readMono(a.bitsPerPixel,
a.width*a.height,a.alphaChannelBits,!1);case 4:return this.readIndexes(a.bitsPerPixel,a.width*a.height,b,a.colorMapFirstIndex,!0);case 5:return this.readPixels(a.bitsPerPixel,a.width*a.height,a.alphaChannelBits,!0);case 6:return this.readMono(a.bitsPerPixel,a.width*a.height,a.alphaChannelBits,!0);default:throw t.thrown("Unsupported image data type!");}},readPixels:function(a,b,c,d){var e=Array(b);c=0!=c;switch(a){case 8:var f=(z=this.i,M(z,z.readByte));a=M(this,this.parsePixel1);break;case 16:f=(z=
this.i,M(z,z.readUInt16));a=M(this,this.parsePixel2);break;case 24:f=(z=this.i,M(z,z.readUInt24));a=M(this,this.parsePixel3);break;case 32:f=(z=this.i,M(z,z.readInt32));a=M(this,this.parsePixel4);break;default:throw t.thrown("Unsupported bits per pixels amount!");}if(d)for(d=0;d<b;){var g=this.i.readByte();if(0!=(g&128)){g&=127;for(var h=a(f(),c);0<=g;)e[d++]=h,--g}else for(g&=127;0<=g;)e[d++]=a(f(),c),--g}else for(g=0;g<b;)d=g++,e[d]=a(f(),c);return e},readMono:function(a,b,c,d){var e=Array(b);c=
0!=c;switch(a){case 8:var f=(z=this.i,M(z,z.readByte));a=M(this,this.parsePixel1);break;case 16:f=(z=this.i,M(z,z.readUInt16));a=M(this,this.parsePixelGreyAlpha);break;default:throw t.thrown("Unsupported bits per pixels amount!");}if(d)for(d=0;d<b;){var g=this.i.readByte();if(0!=(g&128)){g&=127;for(var h=a(f(),c);0<=g;)e[d++]=h,--g}else for(g&=127;0<=g;)e[d++]=a(f(),c),--g}else for(g=0;g<b;)d=g++,e[d]=a(f(),c);return e},readIndexes:function(a,b,c,d,e){var f=Array(b);switch(a){case 8:a=(z=this.i,M(z,
z.readByte));break;case 16:a=(z=this.i,M(z,z.readUInt16));break;case 24:a=(z=this.i,M(z,z.readUInt24));break;case 32:a=(z=this.i,M(z,z.readInt32));break;default:throw t.thrown("Unsupported bits per pixels amount!");}if(e){e=0;for(var g;e<b;)if(g=this.i.readByte(),0!=(g&128)){g&=127;for(var h=c[d+a()];0<=g;)f[e++]=h,--g}else for(g&=127;0<=g;)f[e++]=c[d+a()],--g}else for(g=0;g<b;)e=g++,f[e]=c[d+a()];return f},parsePixel1:function(a,b){return a<<16|a<<8|a},parsePixelGreyAlpha:function(a,b){return(b?
(a&65280)<<16:0)|this.parsePixel1(a&255,!1)},parsePixel2:function(a,b){return(b?1==(a&32768)?-16777216:0:0)|(((a&31744)>>10)/31*255|0)<<16|(((a&992)>>5)/31*255|0)<<8|(a&31)/31*255|0},parsePixel3:function(a,b){return a},parsePixel4:function(a,b){return a},__class__:Dh};var zh=function(a){this.i=a;this.bits=this.nbits=0};zh.__name__="format.tools.BitsInput";zh.prototype={readBits:function(a){if(this.nbits>=a){var b=this.nbits-a;var c=this.bits>>>b&(1<<a)-1;this.nbits=b;return c}c=this.i.readByte();
if(24<=this.nbits){if(31<a)throw t.thrown("Bits error");b=8+this.nbits-a;a=this.bits&(1<<this.nbits)-1;this.bits=c;this.nbits=b;return a<<8-b|c<<b}this.bits=this.bits<<8|c;this.nbits+=8;return this.readBits(a)},readBit:function(){0==this.nbits&&(this.bits=this.i.readByte(),this.nbits=8);this.nbits--;return 1==(this.bits>>>this.nbits&1)},reset:function(){this.nbits=0},__class__:zh};var We=function(){};We.__name__="format.tools.Deflate";We.run=function(a,b){null==b&&(b=9);return Eh.run(a,b)};var wg=
function(){};wg.__name__="format.tools.Inflate";wg.run=function(a){return Fh.run(a)};var xg=K["format.wav.WAVEFormat"]={__ename__:!0,__constructs__:null,WF_PCM:{_hx_name:"WF_PCM",_hx_index:0,__enum__:"format.wav.WAVEFormat",toString:v}};xg.__constructs__=[xg.WF_PCM];xg.__empty_constructs__=[xg.WF_PCM];var Gh=function(a){this.i=a;a.set_bigEndian(!1)};Gh.__name__="format.wav.Reader";Gh.prototype={readInt:function(){return this.i.readInt32()},read:function(){if("RIFF"!=this.i.readString(4))throw t.thrown("RIFF header expected");
this.i.readInt32();if("WAVE"!=this.i.readString(4))throw t.thrown("WAVE signature not found");var a=this.i.readString(4);a:for(;"fmt "!=a;)switch(a){case "JUNK":a=this.i.readInt32();this.i.read(a);a=this.i.readString(4);break;case "bext":a=this.i.readInt32();this.i.read(a);a=this.i.readString(4);break;default:break a}if("fmt "!=a)throw t.thrown("unsupported wave chunk "+a);var b=this.i.readInt32();switch(this.i.readUInt16()){case 1:case 3:a=xg.WF_PCM;break;default:throw t.thrown("only PCM (uncompressed) WAV files are supported");
}var c=this.i.readUInt16(),d=this.i.readInt32(),e=this.i.readInt32(),f=this.i.readUInt16(),g=this.i.readUInt16();16<b&&this.i.read(b-16);for(b=this.i.readString(4);"data"!=b;)this.i.read(this.i.readInt32()),b=this.i.readString(4);if("data"!=b)throw t.thrown("expected data subchunk");var h=this.i.readInt32();try{var k=this.i.read(h)}catch(u){if(t.caught(u).unwrap()instanceof dd)throw t.thrown("Invalid chunk data length");throw u;}h=[];try{for(;;)if(b=this.i.readString(4),"cue "==b){this.i.readInt32();
for(var l=0,m=this.i.readInt32();l<m;){l++;var p=this.i.readInt32();this.i.readInt32();this.i.readString(4);this.i.readInt32();this.i.readInt32();var r=this.i.readInt32();h.push({id:p,sampleOffset:r})}}else{var n=this.i.readInt32();if(0>n)break;this.i.read(n)}}catch(u){if(!(t.caught(u).unwrap()instanceof dd))throw u;}return{header:{format:a,channels:c,samplingRate:d,byteRate:e,blockAlign:f,bitsPerSample:g},data:k,cuePoints:h}},__class__:Gh};var Da=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=
a;this.y=b};Da.__name__="h2d.col.PointImpl";Da.prototype={distanceSq:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},distance:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},toString:function(){return"{"+T.fmt(this.x)+","+T.fmt(this.y)+"}"},sub:function(a){var b=this.x-a.x;a=this.y-a.y;null==a&&(a=0);null==b&&(b=0);return new Da(b,a)},add:function(a){var b=this.x+a.x;a=this.y+a.y;null==a&&(a=0);null==b&&(b=0);return new Da(b,a)},scaled:function(a){var b=this.x*a;a*=
this.y;null==a&&(a=0);null==b&&(b=0);return new Da(b,a)},equals:function(a){return this.x==a.x?this.y==a.y:!1},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.x*this.x+this.y*this.y;a=1E-20>a?0:1/Math.sqrt(a);this.x*=a;this.y*=a},normalized:function(){var a=this.x*this.x+this.y*this.y;a=1E-20>a?0:1/Math.sqrt(a);var b=this.x*a;a*=this.y;null==a&&(a=
0);null==b&&(b=0);return new Da(b,a)},set:function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b},load:function(a){this.x=a.x;this.y=a.y},scale:function(a){this.x*=a;this.y*=a},clone:function(){var a=this.x,b=this.y;null==b&&(b=0);null==a&&(a=0);return new Da(a,b)},cross:function(a){return this.x*a.y-this.y*a.x},lerp:function(a,b,c){var d=a.x;this.x=d+c*(b.x-d);d=a.y;this.y=d+c*(b.y-d)},transform:function(a){var b=a.b*this.x+a.d*this.y+a.y;this.x=a.a*this.x+a.c*this.y+a.x;this.y=b},transformed:function(a){var b=
a.a*this.x+a.c*this.y+a.x;a=a.b*this.x+a.d*this.y+a.y;null==a&&(a=0);null==b&&(b=0);return new Da(b,a)},transform2x2:function(a){var b=a.b*this.x+a.d*this.y;this.x=a.a*this.x+a.c*this.y;this.y=b},transformed2x2:function(a){var b=a.a*this.x+a.c*this.y;a=a.b*this.x+a.d*this.y;null==a&&(a=0);null==b&&(b=0);return new Da(b,a)},toIPoint:function(a){null==a&&(a=1);return new V(Math.round(this.x*a),Math.round(this.y*a))},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.x*a+this.y*b;this.x=this.x*
b-this.y*a;this.y=c},__class__:Da};var Pa=function(a){this.blendMode=ya.Alpha;this.alpha=1;this.visible=!0;this.rotation=0;this.scaleX=this.scaleY=1;this.x=this.y=0;this.matA=1;this.matC=this.matB=0;this.matD=1;this.absY=this.absX=0;this.posChanged=null!=a;this.children=[];null!=a&&a.addChild(this)};Pa.__name__="h2d.Object";Pa.prototype={getBounds:function(a,b){null==b?b=new Db:(b.xMin=1E20,b.yMin=1E20,b.xMax=-1E20,b.yMax=-1E20);null!=a&&a.syncPos();a!=this&&this.syncPos();this.getBoundsRec(a,b,!1);
if(b.xMax<=b.xMin||b.yMax<=b.yMin)this.addBounds(a,b,-1,-1,2,2),b.xMax=b.xMin=.5*(b.xMax+b.xMin),b.yMax=b.yMin=.5*(b.yMax+b.yMin);return b},getSize:function(a){null==a?a=new Db:(a.xMin=1E20,a.yMin=1E20,a.xMax=-1E20,a.yMax=-1E20);this.syncPos();this.getBoundsRec(this.parent,a,!0);if(a.xMax<=a.xMin||a.yMax<=a.yMin)this.addBounds(this.parent,a,-1,-1,2,2),a.xMax=a.xMin=.5*(a.xMax+a.xMin),a.yMax=a.yMin=.5*(a.yMax+a.yMin);var b=-this.x,c=-this.y;a.xMin+=b;a.xMax+=b;a.yMin+=c;a.yMax+=c;return a},getAbsPos:function(){this.syncPos();
var a=new Nc;a.a=this.matA;a.b=this.matB;a.c=this.matC;a.d=this.matD;a.x=this.absX;a.y=this.absY;return a},contains:function(a){for(;null!=a;)if(a=a.parent,a==this)return!0;return!1},find:function(a){var b=a(this);if(null!=b)return b;for(var c=0,d=this.children;c<d.length;)if(b=d[c],++c,b=b.find(a),null!=b)return b;return null},findAll:function(a,b){null==b&&(b=[]);var c=a(this);null!=c&&b.push(c);c=0;for(var d=this.children;c<d.length;){var e=d[c];++c;e.findAll(a,b)}return b},set_filter:function(a){null!=
this.filter&&this.allocated&&this.filter.unbind(this);this.filter=a;null!=a&&this.allocated&&a.bind(this);return a},getBoundsRec:function(a,b,c){var d;if(this.posChanged){this.calcAbsPos();var e=0;for(d=this.children;e<d.length;){var f=d[e];++e;f.posChanged=!0}this.posChanged=!1}f=this.children.length;if(0==f)b.xMin=1E20,b.yMin=1E20,b.xMax=-1E20,b.yMax=-1E20;else if(1==f)f=this.children[0],f.visible?f.getBoundsRec(a,b,c):(b.xMin=1E20,b.yMin=1E20,b.xMax=-1E20,b.yMax=-1E20);else{var g=Infinity,h=Infinity,
k=-Infinity,l=-Infinity;e=0;for(d=this.children;e<d.length;)f=d[e],++e,f.visible&&(f.getBoundsRec(a,b,c),b.xMin<g&&(g=b.xMin),b.yMin<h&&(h=b.yMin),b.xMax>k&&(k=b.xMax),b.yMax>l&&(l=b.yMax));b.xMin=g;b.yMin=h;b.xMax=k;b.yMax=l}},addBounds:function(a,b,c,d,e,f){if(!(0>=e||0>=f))if(null==a){var g=c*this.matA+d*this.matC+this.absX;var h=c*this.matB+d*this.matD+this.absY;g<b.xMin&&(b.xMin=g);g>b.xMax&&(b.xMax=g);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=(c+e)*this.matA+d*this.matC+this.absX;h=(c+e)*
this.matB+d*this.matD+this.absY;g<b.xMin&&(b.xMin=g);g>b.xMax&&(b.xMax=g);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=c*this.matA+(d+f)*this.matC+this.absX;h=c*this.matB+(d+f)*this.matD+this.absY;g<b.xMin&&(b.xMin=g);g>b.xMax&&(b.xMax=g);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=(c+e)*this.matA+(d+f)*this.matC+this.absX;h=(c+e)*this.matB+(d+f)*this.matD+this.absY;g<b.xMin&&(b.xMin=g);g>b.xMax&&(b.xMax=g);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h)}else if(a==this)b.xMin>c&&(b.xMin=c),b.yMin>d&&(b.yMin=
d),b.xMax<c+e&&(b.xMax=c+e),b.yMax<d+f&&(b.yMax=d+f);else{var k=a.matA*a.matD-a.matB*a.matC;if(0!=k){var l=1/k;k=a.matD*l;var m=-a.matB*l,p=-a.matC*l;l*=a.matA;var r=this.absX-a.absX;a=this.absY-a.absY;g=c*this.matA+d*this.matC+r;h=c*this.matB+d*this.matD+a;var n=g*k+h*p;h=g*m+h*l;n<b.xMin&&(b.xMin=n);n>b.xMax&&(b.xMax=n);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=(c+e)*this.matA+d*this.matC+r;h=(c+e)*this.matB+d*this.matD+a;n=g*k+h*p;h=g*m+h*l;n<b.xMin&&(b.xMin=n);n>b.xMax&&(b.xMax=n);h<b.yMin&&
(b.yMin=h);h>b.yMax&&(b.yMax=h);g=c*this.matA+(d+f)*this.matC+r;h=c*this.matB+(d+f)*this.matD+a;n=g*k+h*p;h=g*m+h*l;n<b.xMin&&(b.xMin=n);n>b.xMax&&(b.xMax=n);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=(c+e)*this.matA+(d+f)*this.matC+r;h=(c+e)*this.matB+(d+f)*this.matD+a;n=g*k+h*p;h=g*m+h*l;n<b.xMin&&(b.xMin=n);n>b.xMax&&(b.xMax=n);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h)}}},getObjectsCount:function(){for(var a=0,b=0,c=this.children;b<c.length;){var d=c[b];++b;a+=d.getObjectsCount()+1}return a},
localToGlobal:function(a){this.syncPos();null==a&&(a=new Da(0,0));var b=a.x*this.matB+a.y*this.matD+this.absY;a.x=a.x*this.matA+a.y*this.matC+this.absX;a.y=b;return a},globalToLocal:function(a){this.syncPos();a.x-=this.absX;a.y-=this.absY;var b=1/(this.matA*this.matD-this.matB*this.matC),c=(-a.x*this.matB+a.y*this.matA)*b;a.x=(a.x*this.matD-a.y*this.matC)*b;a.y=c;return a},getScene:function(){for(var a=this;null!=a.parent;)a=a.parent;return a instanceof Od?a:null},set_visible:function(a){if(this.visible==
a)return a;this.visible=a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);return a},addChild:function(a){this.addChildAt(a,this.children.length)},addChildAt:function(a,b){0>b&&(b=0);b>this.children.length&&(b=this.children.length);for(var c=this;null!=c;){if(c==a)throw t.thrown("Recursive addChild");c=c.parent}null!=a.parent&&(c=a.allocated,a.allocated=!1,a.parent.removeChild(a),a.allocated=c);this.children.splice(b,0,a);if(!this.allocated&&a.allocated)a.onRemove();a.parent=
this;a.parentContainer=this.parentContainer;a.posChanged=!0;if(this.allocated)if(a.allocated)a.onHierarchyMoved(!0);else a.onAdd();null!=this.parentContainer&&this.parentContainer.contentChanged(this)},onContentChanged:function(){null!=this.parentContainer&&this.parentContainer.contentChanged(this)},onHierarchyMoved:function(a){for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d.onHierarchyMoved(a)}},onAdd:function(){this.allocated=!0;null!=this.filter&&this.filter.bind(this);for(var a=0,b=
this.children;a<b.length;){var c=b[a];++a;c.onAdd()}},onRemove:function(){this.allocated=!1;null!=this.filter&&this.filter.unbind(this);for(var a=this.children.length-1;0<=a;){var b=this.children[a--];if(null!=b)b.onRemove()}},getMatrix:function(a){a.a=this.matA;a.b=this.matB;a.c=this.matC;a.d=this.matD;a.x=this.absX;a.y=this.absY},removeChild:function(a){if(F.remove(this.children,a)){if(a.allocated)a.onRemove();a.parent=null;null!=a.parentContainer&&a.setParentContainer(null);a.posChanged=!0;null!=
this.parentContainer&&this.parentContainer.contentChanged(this)}},setParentContainer:function(a){this.parentContainer=a;for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d.setParentContainer(a)}},removeChildren:function(){for(;0<this.children.length;)this.removeChild(this.getChildAt(0))},remove:function(){null!=this.parent&&this.parent.removeChild(this)},drawTo:function(a){var b=this.getScene(),c=null==b;null==b&&(b=new Od);b.drawImplTo(this,[a]);c&&(b.dispose(),this.onRemove())},drawToTextures:function(a,
b){var c=this.getScene(),d=null==c;null==c&&(c=new Od);c.drawImplTo(this,a,b);d&&(c.dispose(),this.onRemove())},draw:function(a){},sync:function(a){var b=this.posChanged;b&&(this.calcAbsPos(),this.posChanged=!1);this.lastFrame=a.frame;for(var c=0,d=this.children.length;c<d;){var e=this.children[c];if(null==e)break;e.lastFrame!=a.frame&&(b&&(e.posChanged=!0),e.sync(a));this.children[c]!=e?(c=0,d=this.children.length):++c}},syncPos:function(){null!=this.parent&&this.parent.syncPos();if(this.posChanged){this.calcAbsPos();
for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;c.posChanged=!0}this.posChanged=!1}},calcAbsPos:function(){if(null==this.parent){if(0==this.rotation)this.matA=this.scaleX,this.matC=this.matB=0,this.matD=this.scaleY;else{var a=Math.cos(this.rotation);var b=Math.sin(this.rotation);this.matA=this.scaleX*a;this.matB=this.scaleX*b;this.matC=this.scaleY*-b;this.matD=this.scaleY*a}this.absX=this.x;this.absY=this.y}else{if(0==this.rotation)this.matA=this.scaleX*this.parent.matA,this.matB=this.scaleX*
this.parent.matB,this.matC=this.scaleY*this.parent.matC,this.matD=this.scaleY*this.parent.matD;else{a=Math.cos(this.rotation);b=Math.sin(this.rotation);var c=this.scaleX*a,d=this.scaleX*b;b=this.scaleY*-b;a*=this.scaleY;this.matA=c*this.parent.matA+d*this.parent.matC;this.matB=c*this.parent.matB+d*this.parent.matD;this.matC=b*this.parent.matA+a*this.parent.matC;this.matD=b*this.parent.matB+a*this.parent.matD}this.absX=this.x*this.parent.matA+this.y*this.parent.matC+this.parent.absX;this.absY=this.x*
this.parent.matB+this.y*this.parent.matD+this.parent.absY}},emitTile:function(a,b){null==Pa.nullDrawable&&(Pa.nullDrawable=new ed(null));Pa.nullDrawable.smooth=null!=this.filter&&this.filter.smooth?!0:null;Pa.nullDrawable.absX=this.absX;Pa.nullDrawable.absY=this.absY;Pa.nullDrawable.matA=this.matA;Pa.nullDrawable.matB=this.matB;Pa.nullDrawable.matC=this.matC;Pa.nullDrawable.matD=this.matD;a.drawTile(Pa.nullDrawable,b)},clipBounds:function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);var e=a.tmpBounds;if(null!=
a.inFilter){var f=a.baseShader.filterMatrixA__;var g=a.baseShader.filterMatrixB__;var h=this.matA*f.x+this.matB*f.y;var k=this.matA*g.x+this.matB*g.y;var l=this.matC*f.x+this.matD*f.y;var m=this.matC*g.x+this.matD*g.y;f=this.absX*f.x+this.absY*f.y+f.z;var p=this.absX*g.x+this.absY*g.y+g.z;g=(h*a.viewA+k*a.viewC)/c;h=(h*a.viewB+k*a.viewD)/d;c=(l*a.viewA+m*a.viewC)/c;d=(l*a.viewB+m*a.viewD)/d;l=f*a.viewA+p*a.viewC+a.viewX;a=f*a.viewB+p*a.viewD+a.viewY}else g=(this.matA*a.viewA+this.matB*a.viewC)/c,
h=(this.matA*a.viewB+this.matB*a.viewD)/d,c=(this.matC*a.viewA+this.matD*a.viewC)/c,d=(this.matC*a.viewB+this.matD*a.viewD)/d,l=this.absX*a.viewA+this.absY*a.viewC+a.viewX,a=this.absX*a.viewB+this.absY*a.viewD+a.viewY;e.xMin=1E20;e.yMin=1E20;e.xMax=-1E20;e.yMax=-1E20;var r=b.xMin,n=b.yMin;f=r*g+n*c+l;r=r*h+n*d+a;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);r<e.yMin&&(e.yMin=r);r>e.yMax&&(e.yMax=r);r=b.xMax;n=b.yMin;f=r*g+n*c+l;r=r*h+n*d+a;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);r<e.yMin&&(e.yMin=r);
r>e.yMax&&(e.yMax=r);r=b.xMin;n=b.yMax;f=r*g+n*c+l;r=r*h+n*d+a;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);r<e.yMin&&(e.yMin=r);r>e.yMax&&(e.yMax=r);r=b.xMax;n=b.yMax;f=r*g+n*c+l;r=r*h+n*d+a;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);r<e.yMin&&(e.yMin=r);r>e.yMax&&(e.yMax=r);-1>e.xMin&&(e.xMin=-1);-1>e.yMin&&(e.yMin=-1);1<e.xMax&&(e.xMax=1);1<e.yMax&&(e.yMax=1);m=1/(g*d-h*c);p=e.xMin;k=e.yMin;var u=e.xMax,w=e.yMax;e.xMin=1E20;e.yMin=1E20;e.xMax=-1E20;e.yMax=-1E20;r=p-l;n=k-a;f=(r*d-n*c)*m;r=(-r*h+n*
g)*m;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);r<e.yMin&&(e.yMin=r);r>e.yMax&&(e.yMax=r);r=u-l;n=k-a;f=(r*d-n*c)*m;r=(-r*h+n*g)*m;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);r<e.yMin&&(e.yMin=r);r>e.yMax&&(e.yMax=r);r=p-l;n=w-a;f=(r*d-n*c)*m;r=(-r*h+n*g)*m;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);r<e.yMin&&(e.yMin=r);r>e.yMax&&(e.yMax=r);r=u-l;n=w-a;f=(r*d-n*c)*m;r=(-r*h+n*g)*m;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);r<e.yMin&&(e.yMin=r);r>e.yMax&&(e.yMax=r);g=b.xMin;h=e.xMin;b.xMin=g<h?h:g;g=b.yMin;
h=e.yMin;b.yMin=g<h?h:g;g=b.xMax;h=e.xMax;b.xMax=g>h?h:g;g=b.yMax;h=e.yMax;b.yMax=g>h?h:g},drawFilters:function(a){if(a.pushFilter(this)){var b=a.tmpBounds,c=new Db;this.filter.sync(a,this);if(this.filter.useScreenResolution){var d=a.scene;var e=d.viewportScaleX*this.filter.resolutionScale;d=d.viewportScaleY*this.filter.resolutionScale}else d=e=this.filter.resolutionScale;if(this.filter.autoBounds){var f=this.filter.boundsExtend;0<=f&&(this.getBounds(this,b),b.xMin=b.xMin*e-f,b.yMin=b.yMin*d-f,b.xMax=
b.xMax*e+f,b.yMax=b.yMax*d+f,b.xMin<c.xMin&&(c.xMin=b.xMin),b.xMax>c.xMax&&(c.xMax=b.xMax),b.yMin<c.yMin&&(c.yMin=b.yMin),b.yMax>c.yMax&&(c.yMax=b.yMax))}else{var g=f=Pa.tmpPoint;var h=e;var k=d;null==k&&(k=0);null==h&&(h=0);g.x=h;g.y=k;this.filter.getBounds(this,b,f);b.xMin<c.xMin&&(c.xMin=b.xMin);b.xMax>c.xMax&&(c.xMax=b.xMax);b.yMin<c.yMin&&(c.yMin=b.yMin);b.yMax>c.yMax&&(c.yMax=b.yMax);e=f.x;d=f.y}a.setFilterScale(e,d);this.clipBounds(a,c,e,d);b=Math.floor(c.xMin+1E-10);f=Math.floor(c.yMin+1E-10);
var l=Math.ceil(c.xMax-b-1E-10),m=Math.ceil(c.yMax-f-1E-10);if(0>=l||0>=m||c.xMax<c.xMin)a.popFilter();else{c=a.textures.allocTarget("filterTemp",l,m,!1);a.pushTarget(c,b,f,l,m);a.engine.clear(0);l=a.globalAlpha;m=a.baseShader;g=m.filterMatrixA__;h=g.x;k=g.y;var p=g.z;null==p&&(p=0);null==k&&(k=0);null==h&&(h=0);var r=h;g=k;var n=p;null==n&&(n=0);null==g&&(g=0);null==r&&(r=0);var u=r,w=g,I=n;g=m.filterMatrixB__;h=g.x;k=g.y;p=g.z;null==p&&(p=0);null==k&&(k=0);null==h&&(h=0);r=h;g=k;n=p;null==n&&(n=
0);null==g&&(g=0);null==r&&(r=0);var q=g;g=1/(this.matA*this.matD-this.matB*this.matC);h=this.matD*g*e;var v=-this.matB*g*d;k=-this.matC*g*e;var t=this.matA*g*d;p=-(this.absX*h+this.absY*k);var x=-(this.absX*v+this.absY*t);g=m.filterMatrixA__;null==p&&(p=0);null==k&&(k=0);null==h&&(h=0);g.x=h;g.y=k;g.z=p;g=m.filterMatrixB__;h=v;k=t;p=x;null==p&&(p=0);null==k&&(k=0);null==h&&(h=0);g.x=h;g.y=k;g.z=p;a.globalAlpha=1;this.drawContent(a);c=rb.fromTexture(c);c.dx=b/e;c.dy=f/d;g=c;c=this.filter.draw(a,c);
null!=c&&(c!=g&&(c.dx=(c.dx+b)/e,c.dy=(c.dy+f)/d),c.width/=e,c.height/=d);g=m.filterMatrixA__;g.x=u;g.y=w;g.z=I;g=m.filterMatrixB__;g.x=r;g.y=q;g.z=n;a.popTarget();a.popFilter();a.globalAlpha=l;null!=c&&this.drawFiltered(a,c)}}},drawFiltered:function(a,b){var c=a.globalAlpha;a.currentBlend=null;a.inFilterBlend=this.blendMode;a.globalAlpha*=this.alpha;this.emitTile(a,b);a.globalAlpha=c;a.inFilterBlend=null;a.currentBlend=null},drawRec:function(a){if(this.visible){if(this.posChanged){this.calcAbsPos();
for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d.posChanged=!0}this.posChanged=!1}null!=this.filter&&this.filter.get_enable()?this.drawFilters(a):(b=a.globalAlpha,a.globalAlpha*=this.alpha,this.drawContent(a),a.globalAlpha=b)}},drawContent:function(a){if(a.front2back){for(var b=this.children.length;0<b--;)this.children[b].drawRec(a);this.draw(a)}else{this.draw(a);b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d.drawRec(a)}}},set_x:function(a){this.posChanged=!0;return this.x=a},
set_y:function(a){this.posChanged=!0;return this.y=a},set_scaleX:function(a){this.posChanged=!0;return this.scaleX=a},set_scaleY:function(a){this.posChanged=!0;return this.scaleY=a},set_rotation:function(a){this.posChanged=!0;return this.rotation=a},move:function(a,b){var c=this.x+(a*Math.cos(this.rotation)-b*Math.sin(this.rotation));this.posChanged=!0;this.x=c;c=this.y+(a*Math.sin(this.rotation)+b*Math.cos(this.rotation));this.posChanged=!0;this.y=c},setPosition:function(a,b){this.posChanged=!0;
this.x=a;this.posChanged=!0;this.y=b},rotate:function(a){this.posChanged=!0;this.rotation+=a},scale:function(a){this.scaleX*=a;this.posChanged=!0;this.scaleY*=a},setScale:function(a){this.scaleX=a;this.posChanged=!0;this.scaleY=a},getChildAt:function(a){return this.children[a]},getChildIndex:function(a){for(var b=0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==a)return d}return-1},getObjectByName:function(a){if(this.name==a)return this;for(var b=0,c=this.children;b<c.length;){var d=
c[b];++b;d=d.getObjectByName(a);if(null!=d)return d}return null},get_numChildren:function(){return this.children.length},iterator:function(){return new yg(this.children)},toString:function(){var a=ka.getClass(this).__name__;return null==this.name?a:this.name+"("+a+")"},contentChanged:function(a){},constraintSize:function(a,b){},__class__:Pa};var ed=function(a){Pa.call(this,a);var b=a=1,c=1,d=1;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.color=new O(a,b,c,d)};ed.__name__="h2d.Drawable";
ed.__super__=Pa;ed.prototype=D(Pa.prototype,{set_tileWrap:function(a){return this.tileWrap=a},get_colorAdd:function(){var a=this.getShader(Pd);return null==a?null:a.color__},set_colorAdd:function(a){var b=this.getShader(Pd);null==b?null!=a&&(b=this.addShader(new Pd),b.color__=a):null==a?this.removeShader(b):b.color__=a;return a},drawFiltered:function(a,b){var c=this.shaders;this.shaders=null;Pa.prototype.drawFiltered.call(this,a,b);this.shaders=c},set_colorKey:function(a){var b=this.getShader(ce);
if(null==b)null!=a&&this.addShader(new ce(-16777216|a));else if(null==a)this.removeShader(b);else{b=b.colorKey__;var c=-16777216|a;b.x=(c>>16&255)/255;b.y=(c>>8&255)/255;b.z=(c&255)/255;b.w=(c>>>24)/255}return this.colorKey=a},adjustColor:function(a){if(null==a)this.set_colorMatrix(null);else{var b=this.get_colorMatrix();null==b&&(b=new ca,this.set_colorMatrix(b));b.identity();b.adjustColor(a)}},get_colorMatrix:function(){var a=this.getShader(de);return null==a?null:a.matrix__},set_colorMatrix:function(a){var b=
this.getShader(de);null==b?null!=a&&(b=this.addShader(new de),b.matrix__=a):null==a?this.removeShader(b):b.matrix__=a;return a},getShader:function(a){if(null!=this.shaders)for(var b=this.shaders;null!=b;){var c=b.s;b=b.next;c=ka.__downcastCheck(c,a)?c:null;if(null!=c)return c}return null},getShaders:function(){return new re(this.shaders,null)},addShader:function(a){if(null==a)throw t.thrown("Can't add null shader");this.shaders=Eb.addSort(a,this.shaders);return a},removeShader:function(a){for(var b=
null,c=this.shaders;null!=c;){if(c.s==a)return null==b?this.shaders=c.next:b.next=c.next,!0;b=c;c=c.next}return!1},emitTile:function(a,b){null==b&&(b=new rb(null,0,0,5,5));a.drawTile(this,b)},__class__:ed});var zg=function(a,b){ed.call(this,b);this.set_tile(a)};zg.__name__="h2d.Bitmap";zg.__super__=ed;zg.prototype=D(ed.prototype,{getBoundsRec:function(a,b,c){ed.prototype.getBoundsRec.call(this,a,b,c);null!=this.tile&&(null==this.width&&null==this.height?this.addBounds(a,b,this.tile.dx,this.tile.dy,
this.tile.width,this.tile.height):this.addBounds(a,b,this.tile.dx,this.tile.dy,null!=this.width?this.width:this.tile.width*this.height/this.tile.height,null!=this.height?this.height:this.tile.height*this.width/this.tile.width))},set_width:function(a){if(this.width==a)return a;this.width=a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);return a},set_height:function(a){if(this.height==a)return a;this.height=a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);
return a},set_tile:function(a){if(this.tile==a)return a;this.tile=a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);return a},draw:function(a){if(null==this.width&&null==this.height)this.emitTile(a,this.tile);else{null==this.tile&&this.set_tile(rb.fromColor(16711935));var b=this.tile.width,c=this.tile.height;this.tile.width=null!=this.width?this.width:b*this.height/c;this.tile.height=null!=this.height?this.height:c*this.width/b;this.emitTile(a,this.tile);this.tile.width=b;this.tile.height=
c}},__class__:zg});var ya=K["h2d.BlendMode"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h2d.BlendMode",toString:v},Alpha:{_hx_name:"Alpha",_hx_index:1,__enum__:"h2d.BlendMode",toString:v},Add:{_hx_name:"Add",_hx_index:2,__enum__:"h2d.BlendMode",toString:v},AlphaAdd:{_hx_name:"AlphaAdd",_hx_index:3,__enum__:"h2d.BlendMode",toString:v},SoftAdd:{_hx_name:"SoftAdd",_hx_index:4,__enum__:"h2d.BlendMode",toString:v},Multiply:{_hx_name:"Multiply",_hx_index:5,__enum__:"h2d.BlendMode",
toString:v},AlphaMultiply:{_hx_name:"AlphaMultiply",_hx_index:6,__enum__:"h2d.BlendMode",toString:v},Erase:{_hx_name:"Erase",_hx_index:7,__enum__:"h2d.BlendMode",toString:v},Screen:{_hx_name:"Screen",_hx_index:8,__enum__:"h2d.BlendMode",toString:v},Sub:{_hx_name:"Sub",_hx_index:9,__enum__:"h2d.BlendMode",toString:v},Max:{_hx_name:"Max",_hx_index:10,__enum__:"h2d.BlendMode",toString:v},Min:{_hx_name:"Min",_hx_index:11,__enum__:"h2d.BlendMode",toString:v}};ya.__constructs__=[ya.None,ya.Alpha,ya.Add,
ya.AlphaAdd,ya.SoftAdd,ya.Multiply,ya.AlphaMultiply,ya.Erase,ya.Screen,ya.Sub,ya.Max,ya.Min];ya.__empty_constructs__=[ya.None,ya.Alpha,ya.Add,ya.AlphaAdd,ya.SoftAdd,ya.Multiply,ya.AlphaMultiply,ya.Erase,ya.Screen,ya.Sub,ya.Max,ya.Min];var Hh=function(a){this.followRotation=!1;this.posChanged=!0;this.x=0;this.posChanged=!0;this.y=0;this.scaleY=this.scaleX=1;this.posChanged=!0;this.anchorX=this.rotation=0;this.posChanged=!0;this.viewY=this.viewX=this.anchorY=0;this.viewH=this.viewW=1;this.visible=!0;
null!=a&&a.addCamera(this)};Hh.__name__="h2d.Camera";Hh.prototype={remove:function(){null!=this.scene&&this.scene.removeCamera(this)},layerVisible:function(a){return!0},enter:function(a){a.pushCamera(this);if(this.clipViewport){var b=a.inFilter;a.inFilter=null;a.pushRenderZone(this.viewX*this.scene.width,this.viewY*this.scene.height,this.viewW*this.scene.width,this.viewH*this.scene.height);a.inFilter=b}},exit:function(a){if(this.clipViewport){var b=a.inFilter;a.inFilter=null;a.popRenderZone();a.inFilter=
b}a.popCamera()},sync:function(a,b){null==b&&(b=!1);null!=this.scene&&(null!=this.follow&&(this.posChanged=!0,this.x=this.follow.absX,this.posChanged=!0,this.y=this.follow.absY,this.followRotation&&(this.posChanged=!0,this.rotation=-this.follow.rotation)),this.posChanged||b)&&(0==this.rotation?(this.matA=this.scaleX,this.matC=this.matB=0,this.matD=this.scaleY):(a=Math.cos(this.rotation),b=Math.sin(this.rotation),this.matA=this.scaleX*a,this.matB=this.scaleX*b,this.matC=this.scaleY*-b,this.matD=this.scaleY*
a),this.absX=Math.round(-(this.x*this.matA+this.y*this.matC)+this.scene.width*this.anchorX*this.viewW+this.scene.width*this.viewX),this.absY=Math.round(-(this.x*this.matB+this.y*this.matD)+this.scene.height*this.anchorY*this.viewH+this.scene.height*this.viewY),this.invDet=1/(this.matA*this.matD-this.matB*this.matC),this.posChanged=!1)},setScale:function(a,b){this.scaleX=a;this.posChanged=!0;this.scaleY=b},scale:function(a,b){this.scaleX*=a;this.posChanged=!0;this.scaleY*=b},setPosition:function(a,
b){this.posChanged=!0;this.x=a;this.posChanged=!0;this.y=b},move:function(a,b){this.posChanged=!0;this.x+=a;this.posChanged=!0;this.y+=b},rotate:function(a){this.posChanged=!0;this.rotation+=a},setAnchor:function(a,b){this.anchorX=a;this.posChanged=!0;this.anchorY=b},setViewport:function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");
this.posChanged=!0;this.viewX=Math.floor(a)/this.scene.width;if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");this.posChanged=!0;this.viewY=Math.floor(b)/this.scene.height;a=0==c?this.scene.width:c;if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");this.posChanged=!0;this.viewW=Math.ceil(a)/this.scene.width;a=0==d?this.scene.height:d;if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");
this.posChanged=!0;this.viewH=Math.ceil(a)/this.scene.height},setRawViewport:function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=0);null==a&&(a=0);this.viewX=a;this.viewY=b;this.viewW=c;this.viewH=d;this.posChanged=!0},screenXToCamera:function(a,b){return(((a-this.scene.offsetX)/this.scene.viewportScaleX-this.absX)*this.matD-((b-this.scene.offsetY)/this.scene.viewportScaleY-this.absY)*this.matC)*this.invDet},screenYToCamera:function(a,b){return(-((a-this.scene.offsetX)/this.scene.viewportScaleX-
this.absX)*this.matB+((b-this.scene.offsetY)/this.scene.viewportScaleY-this.absY)*this.matA)*this.invDet},cameraXToScreen:function(a,b){return(a*this.matA+b*this.matC+this.absX)*this.scene.viewportScaleX+this.scene.offsetX},cameraYToScreen:function(a,b){return(a*this.matB+b*this.matD+this.absY)*this.scene.viewportScaleY+this.scene.offsetY},sceneXToCamera:function(a,b){return((a-this.absX)*this.matD-(b-this.absY)*this.matC)*this.invDet},sceneYToCamera:function(a,b){return(-(a-this.absX)*this.matB+
(b-this.absY)*this.matA)*this.invDet},cameraXToScene:function(a,b){return a*this.matA+b*this.matC+this.absX},cameraYToScene:function(a,b){return a*this.matB+b*this.matD+this.absY},eventToCamera:function(a){var b=(a.relX-this.scene.offsetX)/this.scene.viewportScaleX-this.absX,c=(a.relY-this.scene.offsetY)/this.scene.viewportScaleY-this.absY;a.relX=(b*this.matD-c*this.matC)*this.invDet;a.relY=(-b*this.matB+c*this.matA)*this.invDet},screenToCamera:function(a){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");
var b=(a.x-this.scene.offsetX)/this.scene.viewportScaleX-this.absX,c=(a.y-this.scene.offsetY)/this.scene.viewportScaleY-this.absY;a.x=(b*this.matD-c*this.matC)*this.invDet;a.y=(-b*this.matB+c*this.matA)*this.invDet},cameraToScreen:function(a){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");var b=a.x,c=a.y;a.x=(b*this.matA+c*this.matC+this.absX)*this.scene.viewportScaleX+this.scene.offsetX;a.y=(b*this.matB+c*this.matD+this.absY)*this.scene.viewportScaleY+
this.scene.offsetY},sceneToCamera:function(a){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");var b=a.x-this.absX,c=a.y-this.absY;a.x=(b*this.matD-c*this.matC)*this.invDet;a.y=(-b*this.matB+c*this.matA)*this.invDet},cameraToScene:function(a){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");var b=a.x,c=a.y;a.x=b*this.matA+c*this.matC+this.absX;a.y=b*this.matB+c*this.matD+this.absY},checkScene:function(){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");
},set_x:function(a){this.posChanged=!0;return this.x=a},set_y:function(a){this.posChanged=!0;return this.y=a},set_scaleX:function(a){this.posChanged=!0;return this.scaleX=a},set_scaleY:function(a){this.posChanged=!0;return this.scaleY=a},set_rotation:function(a){this.posChanged=!0;return this.rotation=a},get_viewportX:function(){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");return this.viewX*this.scene.width},set_viewportX:function(a){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");
this.posChanged=!0;this.viewX=Math.floor(a)/this.scene.width;return a},get_viewportY:function(){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");return this.viewY*this.scene.height},set_viewportY:function(a){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");this.posChanged=!0;this.viewY=Math.floor(a)/this.scene.height;return a},get_viewportWidth:function(){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");
return this.viewW*this.scene.width},set_viewportWidth:function(a){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");this.posChanged=!0;this.viewW=Math.ceil(a)/this.scene.width;return a},get_viewportHeight:function(){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");return this.viewH*this.scene.height},set_viewportHeight:function(a){if(null==this.scene)throw t.thrown("This method requires Camera to be added to the Scene");
this.posChanged=!0;this.viewH=Math.ceil(a)/this.scene.height;return a},set_anchorX:function(a){this.posChanged=!0;return this.anchorX=a},set_anchorY:function(a){this.posChanged=!0;return this.anchorY=a},__class__:Hh};var Mf=function(){};Mf.__name__="h2d.GPoint";Mf.prototype={load:function(a,b,c,d,e,f){this.x=a;this.y=b;this.r=c;this.g=d;this.b=e;this.a=f},__class__:Mf};var bb=function(){this.refCount=0;this.forcedLod=-1};bb.__name__="h3d.prim.Primitive";bb.prototype={triCount:function(){return null!=
this.indexes?this.indexes.vertices/3|0:null==this.buffer?0:this.buffer.vertices/3|0},vertexCount:function(){return 0},getCollider:function(){throw t.thrown("not implemented for "+y.string(this));},getBounds:function(){throw t.thrown("not implemented for "+y.string(this));},incref:function(){this.refCount++},decref:function(){this.refCount--;0>=this.refCount&&(this.refCount=0,this.dispose())},alloc:function(a){throw t.thrown("not implemented");},selectMaterial:function(a,b){},getMaterialIndexes:function(a,
b){null==b&&(b=0);return 0!=b?{start:0,count:0}:{start:this.getMaterialIndexStart(a,b),count:this.getMaterialIndexCount(a,b)}},getMaterialIndexStart:function(a,b){return 0},getMaterialIndexCount:function(a,b){return null==this.indexes?3*this.triCount():this.indexes.vertices},buildNormalsDisplay:function(){throw t.thrown("not implemented for "+y.string(this));},render:function(a){null!=this.buffer&&null!=this.buffer.vbuf||this.alloc(a);if(null==this.indexes){var b=this.buffer;a.renderBuffer(b,a.mem.getTriIndexes(b.vertices),
3,0,-1)}else a.renderIndexed(this.buffer,this.indexes)},dispose:function(){null!=this.buffer&&(this.buffer.dispose(),this.buffer=null);null!=this.indexes&&(this.indexes.dispose(),this.indexes=null)},toString:function(){return ka.getClass(this).__name__.split(".").pop()},lodCount:function(){return 1},screenRatioToLod:function(a){return 0},__class__:bb};var Bg=function(){bb.call(this);this.buffers=[];this.state=new Ag;this.allocPos=Oc.make()};Bg.__name__="h2d._Graphics.GraphicsContent";Bg.__super__=
bb;Bg.prototype=D(bb.prototype,{addIndex:function(a){this.index.push(a);a=this.state;a.tail.count+=1;a.totalCount+=1;this.indexDirty=!0},add:function(a,b,c,d,e,f,g,h){var k=this.tmp;if(k.pos==k.array.length){var l=k.array.length<<1;128>l&&(l=128);l=new Float32Array(l);l.set(k.array);k.array=l}k.array[k.pos++]=a;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=b;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<
1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=c;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=d;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=e;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=f;k=this.tmp;
k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=g;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=h;this.bufferDirty=!0},setTile:function(a){null!=a&&this.state.setTexture(a.innerTex)},next:function(){if(32768>this.tmp.pos>>3)return!1;this.buffers.push({buf:this.tmp,idx:this.index,vbuf:null,ibuf:null,state:this.state});this.tmp=wd._new(0);
this.index=[];var a=this.state.tail.texture;this.state=new Ag;this.state.setTexture(a);bb.prototype.dispose.call(this);return!0},alloc:function(a){if(!(0>=this.index.length)){a=Zb.get();this.buffer=a.ofFloats(this.tmp,N.get_XY_UV_RGBA());this.buffer.allocPos=this.allocPos;this.indexes=a.ofIndexes(this.index);for(var b=0,c=this.buffers;b<c.length;){var d=c[b];++b;if(null==d.vbuf||null==d.vbuf.vbuf)d.vbuf=a.ofFloats(d.buf,N.get_XY_UV_RGBA());if(null==d.ibuf||null==d.ibuf.vbuf)d.ibuf=a.ofIndexes(d.idx)}this.indexDirty=
this.bufferDirty=!1}},doRender:function(a){if(0!=this.index.length){this.flush();for(var b=0,c=this.buffers;b<c.length;){var d=c[b];++b;d.state.drawIndexed(a,d.vbuf,d.ibuf)}this.state.drawIndexed(a,this.buffer,this.indexes)}},flush:function(){if(null==this.buffer||null==this.buffer.vbuf)this.alloc(ja.CURRENT);else{var a=Zb.get();this.bufferDirty&&(a.disposeBuffer(this.buffer),this.buffer=a.ofFloats(this.tmp,N.get_XY_UV_RGBA()),this.bufferDirty=!1);this.indexDirty&&(a.disposeIndexBuffer(this.indexes),
this.indexes=a.ofIndexes(this.index),this.indexDirty=!1)}},dispose:function(){for(var a=0,b=this.buffers;a<b.length;){var c=b[a];++a;null!=c.vbuf&&Zb.get().disposeBuffer(c.vbuf);null!=c.ibuf&&Zb.get().disposeIndexBuffer(c.ibuf);c.vbuf=null;c.ibuf=null;c.state.clear()}null!=this.buffer&&(Zb.get().disposeBuffer(this.buffer),this.buffer=null);null!=this.indexes&&(Zb.get().disposeIndexBuffer(this.indexes),this.indexes=null);this.state.clear();bb.prototype.dispose.call(this)},clear:function(){this.dispose();
this.tmp=wd._new(0);this.index=[];this.buffers=[]},__class__:Bg});var Ve=function(a){this.bevel=.25;this.mx=this.my=0;this.md=1;this.mb=this.mc=0;this.ma=1;ed.call(this,a);this.content=new Bg;this.tile=rb.fromColor(16777215);this.clear()};Ve.__name__="h2d.Graphics";Ve.__super__=ed;Ve.prototype=D(ed.prototype,{onRemove:function(){ed.prototype.onRemove.call(this);this.clear()},clear:function(){this.content.clear();this.tmpPoints=[];this.lineSize=this.pindex=0;this.yMin=this.xMin=Infinity;this.xMax=
this.yMax=-Infinity;this.yMinSize=this.xMinSize=Infinity;this.xMaxSize=this.yMaxSize=-Infinity},getBoundsRec:function(a,b,c){ed.prototype.getBoundsRec.call(this,a,b,c);null!=this.tile&&(c?this.addBounds(a,b,this.xMinSize,this.yMinSize,this.xMaxSize-this.xMinSize,this.yMaxSize-this.yMinSize):this.addBounds(a,b,this.xMin,this.yMin,this.xMax-this.xMin,this.yMax-this.yMin))},isConvex:function(a){for(var b=!0,c=!1,d=0,e=a.length;d<e;){var f=d++,g=a[f],h=a[(f+1)%a.length];f=a[(f+2)%a.length];g=0<(h.x-g.x)*
(f.y-g.y)-(h.y-g.y)*(f.x-g.x);if(b)b=!1,c=g;else if(c!=g)return!1}return!0},flushLine:function(a){var b=this.tmpPoints,c=b.length-1,d=b[c],e=b[0];this.content.setTile(rb.fromColor(16777215));var f=e.x==d.x&&e.y==d.y,g=b.length;if(f)e!=d&&(--g,--c,d=b[c]);else{var h=b[c-1];null==h&&(h=e);var k=new Mf;k.load(2*d.x-h.x,2*d.y-h.y,0,0,0,0);b.push(k);var l=b[1];null==l&&(l=e);k=new Mf;k.load(2*e.x-l.x,2*e.y-l.y,0,0,0,0);d=k}for(var m=0,p=g;m<p;){var r=m++,n=b[(r+1)%b.length],u=d.y-e.y,w=e.x-d.x,I=1/Math.sqrt(u*
u+w*w),q=e.y-n.y,v=n.x-e.x,t=1/Math.sqrt(q*q+v*v),x=u*I+q*t,y=w*I+v*t,z=1/Math.sqrt(x*x+y*y);x*=z;y*=z;var A=x*u*I+y*w*I;.1>A&&(A=.1);var B=.5*this.lineSize/A;x*=B;y*=B;if(A>this.bevel){var C=this.content,ab=e.x+x,E=e.y+y,G=e.r,H=e.g,D=e.b,J=e.a,F=C.tmp;if(F.pos==F.array.length){var M=F.array.length<<1;128>M&&(M=128);var K=new Float32Array(M);K.set(F.array);F.array=K}F.array[F.pos++]=ab;var O=C.tmp;if(O.pos==O.array.length){var N=O.array.length<<1;128>N&&(N=128);var Q=new Float32Array(N);Q.set(O.array);
O.array=Q}O.array[O.pos++]=E;var L=C.tmp;if(L.pos==L.array.length){var P=L.array.length<<1;128>P&&(P=128);var R=new Float32Array(P);R.set(L.array);L.array=R}L.array[L.pos++]=0;var U=C.tmp;if(U.pos==U.array.length){var S=U.array.length<<1;128>S&&(S=128);var V=new Float32Array(S);V.set(U.array);U.array=V}U.array[U.pos++]=0;var T=C.tmp;if(T.pos==T.array.length){var W=T.array.length<<1;128>W&&(W=128);var Y=new Float32Array(W);Y.set(T.array);T.array=Y}T.array[T.pos++]=G;var X=C.tmp;if(X.pos==X.array.length){var Z=
X.array.length<<1;128>Z&&(Z=128);var ba=new Float32Array(Z);ba.set(X.array);X.array=ba}X.array[X.pos++]=H;var aa=C.tmp;if(aa.pos==aa.array.length){var ea=aa.array.length<<1;128>ea&&(ea=128);var fa=new Float32Array(ea);fa.set(aa.array);aa.array=fa}aa.array[aa.pos++]=D;var ca=C.tmp;if(ca.pos==ca.array.length){var ha=ca.array.length<<1;128>ha&&(ha=128);var ia=new Float32Array(ha);ia.set(ca.array);ca.array=ia}ca.array[ca.pos++]=J;C.bufferDirty=!0;var da=this.content,ka=e.x-x,ja=e.y-y,la=e.r,ma=e.g,oa=
e.b,na=e.a,pa=da.tmp;if(pa.pos==pa.array.length){var sa=pa.array.length<<1;128>sa&&(sa=128);var ta=new Float32Array(sa);ta.set(pa.array);pa.array=ta}pa.array[pa.pos++]=ka;var qa=da.tmp;if(qa.pos==qa.array.length){var ua=qa.array.length<<1;128>ua&&(ua=128);var wa=new Float32Array(ua);wa.set(qa.array);qa.array=wa}qa.array[qa.pos++]=ja;var ra=da.tmp;if(ra.pos==ra.array.length){var ya=ra.array.length<<1;128>ya&&(ya=128);var za=new Float32Array(ya);za.set(ra.array);ra.array=za}ra.array[ra.pos++]=0;var va=
da.tmp;if(va.pos==va.array.length){var Aa=va.array.length<<1;128>Aa&&(Aa=128);var Ca=new Float32Array(Aa);Ca.set(va.array);va.array=Ca}va.array[va.pos++]=0;var xa=da.tmp;if(xa.pos==xa.array.length){var Da=xa.array.length<<1;128>Da&&(Da=128);var Ea=new Float32Array(Da);Ea.set(xa.array);xa.array=Ea}xa.array[xa.pos++]=la;var Ba=da.tmp;if(Ba.pos==Ba.array.length){var Ha=Ba.array.length<<1;128>Ha&&(Ha=128);var Ga=new Float32Array(Ha);Ga.set(Ba.array);Ba.array=Ga}Ba.array[Ba.pos++]=ma;var Fa=da.tmp;if(Fa.pos==
Fa.array.length){var Ia=Fa.array.length<<1;128>Ia&&(Ia=128);var Ja=new Float32Array(Ia);Ja.set(Fa.array);Fa.array=Ja}Fa.array[Fa.pos++]=oa;var jb=da.tmp;if(jb.pos==jb.array.length){var La=jb.array.length<<1;128>La&&(La=128);var Na=new Float32Array(La);Na.set(jb.array);jb.array=Na}jb.array[jb.pos++]=na;da.bufferDirty=!0;var Pa=r==c?a:this.pindex+2;if(r<g-1||f){var Sa=this.content;Sa.index.push(this.pindex);var Ma=Sa.state;Ma.tail.count+=1;Ma.totalCount+=1;Sa.indexDirty=!0;var Ra=this.content;Ra.index.push(this.pindex+
1);var Oa=Ra.state;Oa.tail.count+=1;Oa.totalCount+=1;Ra.indexDirty=!0;var Xa=this.content;Xa.index.push(Pa);var Ua=Xa.state;Ua.tail.count+=1;Ua.totalCount+=1;Xa.indexDirty=!0;var $a=this.content;$a.index.push(this.pindex+1);var Wa=$a.state;Wa.tail.count+=1;Wa.totalCount+=1;$a.indexDirty=!0;var cb=this.content;cb.index.push(Pa);var Za=cb.state;Za.tail.count+=1;Za.totalCount+=1;cb.indexDirty=!0;var db=this.content;db.index.push(Pa+1);var Va=db.state;Va.tail.count+=1;Va.totalCount+=1;db.indexDirty=!0}this.pindex+=
2}else{var gb=(n.x-e.x)*x+(n.y-e.y)*y,Ka=-y,Ya=x,fb=.5*this.lineSize/(Ka*u*I+Ya*w*I);Ka*=fb;Ya*=fb;var bb=r==c?a:this.pindex+3;if(0<gb){var Qa=this.content,hb=e.x+x,kb=e.y+y,lb=e.r,nb=e.g,ob=e.b,qb=e.a,Ta=Qa.tmp;if(Ta.pos==Ta.array.length){var mb=Ta.array.length<<1;128>mb&&(mb=128);var tb=new Float32Array(mb);tb.set(Ta.array);Ta.array=tb}Ta.array[Ta.pos++]=hb;var ib=Qa.tmp;if(ib.pos==ib.array.length){var yb=ib.array.length<<1;128>yb&&(yb=128);var Eb=new Float32Array(yb);Eb.set(ib.array);ib.array=
Eb}ib.array[ib.pos++]=kb;var pb=Qa.tmp;if(pb.pos==pb.array.length){var Ab=pb.array.length<<1;128>Ab&&(Ab=128);var Gb=new Float32Array(Ab);Gb.set(pb.array);pb.array=Gb}pb.array[pb.pos++]=0;var sb=Qa.tmp;if(sb.pos==sb.array.length){var Hb=sb.array.length<<1;128>Hb&&(Hb=128);var Mb=new Float32Array(Hb);Mb.set(sb.array);sb.array=Mb}sb.array[sb.pos++]=0;var ub=Qa.tmp;if(ub.pos==ub.array.length){var Ib=ub.array.length<<1;128>Ib&&(Ib=128);var Ob=new Float32Array(Ib);Ob.set(ub.array);ub.array=Ob}ub.array[ub.pos++]=
lb;var vb=Qa.tmp;if(vb.pos==vb.array.length){var Kb=vb.array.length<<1;128>Kb&&(Kb=128);var Pb=new Float32Array(Kb);Pb.set(vb.array);vb.array=Pb}vb.array[vb.pos++]=nb;var wb=Qa.tmp;if(wb.pos==wb.array.length){var Lb=wb.array.length<<1;128>Lb&&(Lb=128);var Sb=new Float32Array(Lb);Sb.set(wb.array);wb.array=Sb}wb.array[wb.pos++]=ob;var xb=Qa.tmp;if(xb.pos==xb.array.length){var Tb=xb.array.length<<1;128>Tb&&(Tb=128);var Xb=new Float32Array(Tb);Xb.set(xb.array);xb.array=Xb}xb.array[xb.pos++]=qb;Qa.bufferDirty=
!0;var zb=this.content,gc=e.x-Ka,hc=e.y-Ya,ic=e.r,jc=e.g,kc=e.b,mc=e.a,Fb=zb.tmp;if(Fb.pos==Fb.array.length){var Yb=Fb.array.length<<1;128>Yb&&(Yb=128);var cc=new Float32Array(Yb);cc.set(Fb.array);Fb.array=cc}Fb.array[Fb.pos++]=gc;var Db=zb.tmp;if(Db.pos==Db.array.length){var Zb=Db.array.length<<1;128>Zb&&(Zb=128);var nc=new Float32Array(Zb);nc.set(Db.array);Db.array=nc}Db.array[Db.pos++]=hc;var Jb=zb.tmp;if(Jb.pos==Jb.array.length){var ec=Jb.array.length<<1;128>ec&&(ec=128);var sc=new Float32Array(ec);
sc.set(Jb.array);Jb.array=sc}Jb.array[Jb.pos++]=0;var Nb=zb.tmp;if(Nb.pos==Nb.array.length){var pc=Nb.array.length<<1;128>pc&&(pc=128);var vc=new Float32Array(pc);vc.set(Nb.array);Nb.array=vc}Nb.array[Nb.pos++]=0;var Rb=zb.tmp;if(Rb.pos==Rb.array.length){var tc=Rb.array.length<<1;128>tc&&(tc=128);var yc=new Float32Array(tc);yc.set(Rb.array);Rb.array=yc}Rb.array[Rb.pos++]=ic;var Ub=zb.tmp;if(Ub.pos==Ub.array.length){var uc=Ub.array.length<<1;128>uc&&(uc=128);var Bc=new Float32Array(uc);Bc.set(Ub.array);
Ub.array=Bc}Ub.array[Ub.pos++]=jc;var Vb=zb.tmp;if(Vb.pos==Vb.array.length){var wc=Vb.array.length<<1;128>wc&&(wc=128);var Cc=new Float32Array(wc);Cc.set(Vb.array);Vb.array=Cc}Vb.array[Vb.pos++]=kc;var Wb=zb.tmp;if(Wb.pos==Wb.array.length){var zc=Wb.array.length<<1;128>zc&&(zc=128);var Jc=new Float32Array(zc);Jc.set(Wb.array);Wb.array=Jc}Wb.array[Wb.pos++]=mc;zb.bufferDirty=!0;var Qb=this.content,Wc=e.x+Ka,Zc=e.y+Ya,$c=e.r,ad=e.g,dd=e.b,ed=e.a,$b=Qb.tmp;if($b.pos==$b.array.length){var Ec=$b.array.length<<
1;128>Ec&&(Ec=128);var Qc=new Float32Array(Ec);Qc.set($b.array);$b.array=Qc}$b.array[$b.pos++]=Wc;var ac=Qb.tmp;if(ac.pos==ac.array.length){var Hc=ac.array.length<<1;128>Hc&&(Hc=128);var Sc=new Float32Array(Hc);Sc.set(ac.array);ac.array=Sc}ac.array[ac.pos++]=Zc;var bc=Qb.tmp;if(bc.pos==bc.array.length){var Kc=bc.array.length<<1;128>Kc&&(Kc=128);var Vc=new Float32Array(Kc);Vc.set(bc.array);bc.array=Vc}bc.array[bc.pos++]=0;var dc=Qb.tmp;if(dc.pos==dc.array.length){var Mc=dc.array.length<<1;128>Mc&&
(Mc=128);var bd=new Float32Array(Mc);bd.set(dc.array);dc.array=bd}dc.array[dc.pos++]=0;var fc=Qb.tmp;if(fc.pos==fc.array.length){var Oc=fc.array.length<<1;128>Oc&&(Oc=128);var ld=new Float32Array(Oc);ld.set(fc.array);fc.array=ld}fc.array[fc.pos++]=$c;var oc=Qb.tmp;if(oc.pos==oc.array.length){var Tc=oc.array.length<<1;128>Tc&&(Tc=128);var qd=new Float32Array(Tc);qd.set(oc.array);oc.array=qd}oc.array[oc.pos++]=ad;var qc=Qb.tmp;if(qc.pos==qc.array.length){var Xc=qc.array.length<<1;128>Xc&&(Xc=128);var vd=
new Float32Array(Xc);vd.set(qc.array);qc.array=vd}qc.array[qc.pos++]=dd;var rc=Qb.tmp;if(rc.pos==rc.array.length){var fd=rc.array.length<<1;128>fd&&(fd=128);var Ad=new Float32Array(fd);Ad.set(rc.array);rc.array=Ad}rc.array[rc.pos++]=ed;Qb.bufferDirty=!0;var nd=this.content;nd.index.push(this.pindex);var Rc=nd.state;Rc.tail.count+=1;Rc.totalCount+=1;nd.indexDirty=!0;var pd=this.content;pd.index.push(bb);var Uc=pd.state;Uc.tail.count+=1;Uc.totalCount+=1;pd.indexDirty=!0;var ud=this.content;ud.index.push(this.pindex+
2);var Yc=ud.state;Yc.tail.count+=1;Yc.totalCount+=1;ud.indexDirty=!0;var wd=this.content;wd.index.push(this.pindex+2);var gd=wd.state;gd.tail.count+=1;gd.totalCount+=1;wd.indexDirty=!0;var xd=this.content;xd.index.push(bb);var id=xd.state;id.tail.count+=1;id.totalCount+=1;xd.indexDirty=!0;var yd=this.content;yd.index.push(bb+1);var jd=yd.state;jd.tail.count+=1;jd.totalCount+=1;yd.indexDirty=!0}else{var lc=this.content,Td=e.x+Ka,Ud=e.y+Ya,Vd=e.r,Xd=e.g,Zd=e.b,$d=e.a,Ac=lc.tmp;if(Ac.pos==Ac.array.length){var Id=
Ac.array.length<<1;128>Id&&(Id=128);var Qd=new Float32Array(Id);Qd.set(Ac.array);Ac.array=Qd}Ac.array[Ac.pos++]=Td;var Dc=lc.tmp;if(Dc.pos==Dc.array.length){var Kd=Dc.array.length<<1;128>Kd&&(Kd=128);var Sd=new Float32Array(Kd);Sd.set(Dc.array);Dc.array=Sd}Dc.array[Dc.pos++]=Ud;var Fc=lc.tmp;if(Fc.pos==Fc.array.length){var Ld=Fc.array.length<<1;128>Ld&&(Ld=128);var Wd=new Float32Array(Ld);Wd.set(Fc.array);Fc.array=Wd}Fc.array[Fc.pos++]=0;var Gc=lc.tmp;if(Gc.pos==Gc.array.length){var Md=Gc.array.length<<
1;128>Md&&(Md=128);var Yd=new Float32Array(Md);Yd.set(Gc.array);Gc.array=Yd}Gc.array[Gc.pos++]=0;var Ic=lc.tmp;if(Ic.pos==Ic.array.length){var Nd=Ic.array.length<<1;128>Nd&&(Nd=128);var ae=new Float32Array(Nd);ae.set(Ic.array);Ic.array=ae}Ic.array[Ic.pos++]=Vd;var Lc=lc.tmp;if(Lc.pos==Lc.array.length){var Od=Lc.array.length<<1;128>Od&&(Od=128);var be=new Float32Array(Od);be.set(Lc.array);Lc.array=be}Lc.array[Lc.pos++]=Xd;var Nc=lc.tmp;if(Nc.pos==Nc.array.length){var Pd=Nc.array.length<<1;128>Pd&&
(Pd=128);var de=new Float32Array(Pd);de.set(Nc.array);Nc.array=de}Nc.array[Nc.pos++]=Zd;var Pc=lc.tmp;if(Pc.pos==Pc.array.length){var Rd=Pc.array.length<<1;128>Rd&&(Rd=128);var fe=new Float32Array(Rd);fe.set(Pc.array);Pc.array=fe}Pc.array[Pc.pos++]=$d;lc.bufferDirty=!0;var xc=this.content,Ge=e.x-x,Je=e.y-y,Ke=e.r,Ne=e.g,Oe=e.b,Ue=e.a,cd=xc.tmp;if(cd.pos==cd.array.length){var ce=cd.array.length<<1;128>ce&&(ce=128);var se=new Float32Array(ce);se.set(cd.array);cd.array=se}cd.array[cd.pos++]=Ge;var hd=
xc.tmp;if(hd.pos==hd.array.length){var ee=hd.array.length<<1;128>ee&&(ee=128);var ve=new Float32Array(ee);ve.set(hd.array);hd.array=ve}hd.array[hd.pos++]=Je;var kd=xc.tmp;if(kd.pos==kd.array.length){var ge=kd.array.length<<1;128>ge&&(ge=128);var ye=new Float32Array(ge);ye.set(kd.array);kd.array=ye}kd.array[kd.pos++]=0;var md=xc.tmp;if(md.pos==md.array.length){var he=md.array.length<<1;128>he&&(he=128);var Be=new Float32Array(he);Be.set(md.array);md.array=Be}md.array[md.pos++]=0;var od=xc.tmp;if(od.pos==
od.array.length){var ie=od.array.length<<1;128>ie&&(ie=128);var He=new Float32Array(ie);He.set(od.array);od.array=He}od.array[od.pos++]=Ke;var rd=xc.tmp;if(rd.pos==rd.array.length){var je=rd.array.length<<1;128>je&&(je=128);var Pe=new Float32Array(je);Pe.set(rd.array);rd.array=Pe}rd.array[rd.pos++]=Ne;var sd=xc.tmp;if(sd.pos==sd.array.length){var ne=sd.array.length<<1;128>ne&&(ne=128);var Se=new Float32Array(ne);Se.set(sd.array);sd.array=Se}sd.array[sd.pos++]=Oe;var td=xc.tmp;if(td.pos==td.array.length){var qe=
td.array.length<<1;128>qe&&(qe=128);var Ve=new Float32Array(qe);Ve.set(td.array);td.array=Ve}td.array[td.pos++]=Ue;xc.bufferDirty=!0;var of=this.content,hf=e.x-Ka,jf=e.y-Ya,kf=e.r,lf=e.g,mf=e.b,nf=e.a,zd=of.tmp;if(zd.pos==zd.array.length){var xe=zd.array.length<<1;128>xe&&(xe=128);var $e=new Float32Array(xe);$e.set(zd.array);zd.array=$e}zd.array[zd.pos++]=hf;var Bd=of.tmp;if(Bd.pos==Bd.array.length){var ze=Bd.array.length<<1;128>ze&&(ze=128);var af=new Float32Array(ze);af.set(Bd.array);Bd.array=af}Bd.array[Bd.pos++]=
jf;var Cd=of.tmp;if(Cd.pos==Cd.array.length){var Ae=Cd.array.length<<1;128>Ae&&(Ae=128);var bf=new Float32Array(Ae);bf.set(Cd.array);Cd.array=bf}Cd.array[Cd.pos++]=0;var Dd=of.tmp;if(Dd.pos==Dd.array.length){var Ce=Dd.array.length<<1;128>Ce&&(Ce=128);var cf=new Float32Array(Ce);cf.set(Dd.array);Dd.array=cf}Dd.array[Dd.pos++]=0;var Ed=of.tmp;if(Ed.pos==Ed.array.length){var De=Ed.array.length<<1;128>De&&(De=128);var df=new Float32Array(De);df.set(Ed.array);Ed.array=df}Ed.array[Ed.pos++]=kf;var Fd=of.tmp;
if(Fd.pos==Fd.array.length){var Ee=Fd.array.length<<1;128>Ee&&(Ee=128);var ef=new Float32Array(Ee);ef.set(Fd.array);Fd.array=ef}Fd.array[Fd.pos++]=lf;var Gd=of.tmp;if(Gd.pos==Gd.array.length){var Fe=Gd.array.length<<1;128>Fe&&(Fe=128);var ff=new Float32Array(Fe);ff.set(Gd.array);Gd.array=ff}Gd.array[Gd.pos++]=mf;var Hd=of.tmp;if(Hd.pos==Hd.array.length){var Ie=Hd.array.length<<1;128>Ie&&(Ie=128);var gf=new Float32Array(Ie);gf.set(Hd.array);Hd.array=gf}Hd.array[Hd.pos++]=nf;of.bufferDirty=!0;var Le=
this.content;Le.index.push(this.pindex+1);var ke=Le.state;ke.tail.count+=1;ke.totalCount+=1;Le.indexDirty=!0;var Me=this.content;Me.index.push(bb);var le=Me.state;le.tail.count+=1;le.totalCount+=1;Me.indexDirty=!0;var Qe=this.content;Qe.index.push(this.pindex+2);var me=Qe.state;me.tail.count+=1;me.totalCount+=1;Qe.indexDirty=!0;var Re=this.content;Re.index.push(this.pindex+1);var oe=Re.state;oe.tail.count+=1;oe.totalCount+=1;Re.indexDirty=!0;var Te=this.content;Te.index.push(bb);var pe=Te.state;pe.tail.count+=
1;pe.totalCount+=1;Te.indexDirty=!0;var We=this.content;We.index.push(bb+1);var re=We.state;re.tail.count+=1;re.totalCount+=1;We.indexDirty=!0}var Xe=this.content;Xe.index.push(this.pindex);var te=Xe.state;te.tail.count+=1;te.totalCount+=1;Xe.indexDirty=!0;var Ye=this.content;Ye.index.push(this.pindex+1);var ue=Ye.state;ue.tail.count+=1;ue.totalCount+=1;Ye.indexDirty=!0;var Ze=this.content;Ze.index.push(this.pindex+2);var we=Ze.state;we.tail.count+=1;we.totalCount+=1;Ze.indexDirty=!0;this.pindex+=
3}d=e;e=n}this.content.setTile(this.tile)},flushFill:function(a){if(!(3>this.tmpPoints.length)){var b=this.tmpPoints;var c=b[0];var d=b[b.length-1];var e=null;var f=c.x-d.x;1E-9>(0>f?-f:f)?(f=c.y-d.y,f=1E-9>(0>f?-f:f)):f=!1;f&&(e=b.pop());if(this.isConvex(b))for(f=1,c=b.length-1;f<c;){d=f++;var g=this.content;g.index.push(a);var h=g.state;h.tail.count+=1;h.totalCount+=1;g.indexDirty=!0;h=this.content;h.index.push(a+d);g=h.state;g.tail.count+=1;g.totalCount+=1;h.indexDirty=!0;h=this.content;h.index.push(a+
d+1);d=h.state;d.tail.count+=1;d.totalCount+=1;h.indexDirty=!0}else for(c=Ve.EARCUT,null==c&&(c=new Cg,Ve.EARCUT=c),f=0,c=c.triangulate_h2d_GPoint(b);f<c.length;)d=c[f],++f,g=this.content,g.index.push(d+a),h=g.state,h.tail.count+=1,h.totalCount+=1,g.indexDirty=!0;null!=e&&b.push(e)}},flush:function(){0!=this.tmpPoints.length&&(this.doFill&&(this.flushFill(this.pindex),this.pindex+=this.tmpPoints.length,this.content.next()&&(this.pindex=0)),0<this.lineSize&&(this.flushLine(this.pindex),this.content.next()&&
(this.pindex=0)),this.tmpPoints=[])},beginFill:function(a,b){null==b&&(b=1);null==a&&(a=0);this.flush();this.tile=rb.fromColor(16777215);this.content.setTile(this.tile);null==b&&(b=1);this.curA=b;this.curR=(a>>16&255)/255;this.curG=(a>>8&255)/255;this.curB=(a&255)/255;this.doFill=!0},beginTileFill:function(a,b,c,d,e){null==e&&(e=this.tile);if(null==e)throw t.thrown("Tile not specified");this.flush();this.tile=e;this.content.setTile(e);this.curB=this.curG=this.curR=this.curA=1;this.doFill=!0;null==
a&&(a=0);null==b&&(b=0);null==c&&(c=1);null==d&&(d=1);a-=e.x;b-=e.y;e=e.innerTex;var f=1/e.height;this.ma=1/e.width/c;this.mc=this.mb=0;this.md=f/d;this.mx=-a*this.ma;this.my=-b*this.md},drawTile:function(a,b,c){this.beginTileFill(a,b,null,null,c);this.drawRect(a,b,c.width,c.height);this.endFill()},lineStyle:function(a,b,c){null==c&&(c=1);null==b&&(b=0);null==a&&(a=0);this.flush();this.lineSize=a;this.lineA=c;this.lineR=(b>>16&255)/255;this.lineG=(b>>8&255)/255;this.lineB=(b&255)/255},moveTo:function(a,
b){this.flush();this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my)},endFill:function(){this.flush();this.doFill=!1},setColor:function(a,b){null==b&&(b=1);this.curA=b;this.curR=(a>>16&255)/255;this.curG=(a>>8&255)/255;this.curB=(a&255)/255},drawRect:function(a,b,c,d){this.flush();this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);var e=a+c;this.addVertex(e,b,this.curR,this.curG,
this.curB,this.curA,e*this.ma+b*this.mc+this.mx,e*this.mb+b*this.md+this.my);e=a+c;c=b+d;this.addVertex(e,c,this.curR,this.curG,this.curB,this.curA,e*this.ma+c*this.mc+this.mx,e*this.mb+c*this.md+this.my);c=b+d;this.addVertex(a,c,this.curR,this.curG,this.curB,this.curA,a*this.ma+c*this.mc+this.mx,a*this.mb+c*this.md+this.my);this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);this.tmpPoints[0].x+=.01;this.tmpPoints[0].y+=.01;this.tmpPoints[1].y+=
.01;this.tmpPoints[3].x+=.01;this.tmpPoints[4].x+=.01;this.tmpPoints[4].y+=.01;this.flush()},drawRoundedRect:function(a,b,c,d,e,f){null==f&&(f=0);if(0>=e)this.drawRect(a,b,c,d);else{a+=e;b+=e;c-=2*e;d-=2*e;this.flush();0==f&&(f=1.5707963267948966*e/4,f=Math.ceil(0>f?-f:f));3>f&&(f=3);var g=1.5707963267948966/(f-1);var h=b-e;this.addVertex(a,h,this.curR,this.curG,this.curB,this.curA,a*this.ma+h*this.mc+this.mx,a*this.mb+h*this.md+this.my);var k=a+c;h=b-e;this.addVertex(k,h,this.curR,this.curG,this.curB,
this.curA,k*this.ma+h*this.mc+this.mx,k*this.mb+h*this.md+this.my);k=a+c;for(var l=0,m=f;l<m;){var p=l++;var r=p*g+4.71238898038469;p=k+Math.cos(r)*e;h=b+Math.sin(r)*e;this.addVertex(p,h,this.curR,this.curG,this.curB,this.curA,p*this.ma+h*this.mc+this.mx,p*this.mb+h*this.md+this.my)}k=a+c+e;h=b+d;this.addVertex(k,h,this.curR,this.curG,this.curB,this.curA,k*this.ma+h*this.mc+this.mx,k*this.mb+h*this.md+this.my);k=a+c;h=b+d;l=0;for(m=f;l<m;)p=l++,r=p*g,p=k+Math.cos(r)*e,c=h+Math.sin(r)*e,this.addVertex(p,
c,this.curR,this.curG,this.curB,this.curA,p*this.ma+c*this.mc+this.mx,p*this.mb+c*this.md+this.my);h=b+d+e;this.addVertex(a,h,this.curR,this.curG,this.curB,this.curA,a*this.ma+h*this.mc+this.mx,a*this.mb+h*this.md+this.my);h=b+d;l=0;for(m=f;l<m;)p=l++,r=p*g+1.5707963267948966,k=a+Math.cos(r)*e,c=h+Math.sin(r)*e,this.addVertex(k,c,this.curR,this.curG,this.curB,this.curA,k*this.ma+c*this.mc+this.mx,k*this.mb+c*this.md+this.my);k=a-e;this.addVertex(k,b,this.curR,this.curG,this.curB,this.curA,k*this.ma+
b*this.mc+this.mx,k*this.mb+b*this.md+this.my);l=0;for(m=f;l<m;)p=l++,r=p*g+3.141592653589793,k=a+Math.cos(r)*e,h=b+Math.sin(r)*e,this.addVertex(k,h,this.curR,this.curG,this.curB,this.curA,k*this.ma+h*this.mc+this.mx,k*this.mb+h*this.md+this.my);this.flush()}},drawCircle:function(a,b,c,d){null==d&&(d=0);this.flush();if(0==d){var e=6.28*c/4;d=Math.ceil(0>e?-e:e)}3>d&&(d=3);e=6.283185307179586/d;var f=0;for(d+=1;f<d;){var g=f++*e,h=a+Math.cos(g)*c;g=b+Math.sin(g)*c;this.addVertex(h,g,this.curR,this.curG,
this.curB,this.curA,h*this.ma+g*this.mc+this.mx,h*this.mb+g*this.md+this.my)}this.flush()},drawEllipse:function(a,b,c,d,e,f){null==f&&(f=0);null==e&&(e=0);this.flush();if(0==f){var g=6.28*d/4;f=Math.ceil(0>g?-g:g)}3>f&&(f=3);g=6.283185307179586/f;var h=0;for(f+=1;h<f;){var k=h++*g;var l=Math.cos(k)*Math.cos(e)*c-Math.sin(k)*Math.sin(e)*d;k=Math.cos(e)*Math.sin(k)*d+Math.cos(k)*Math.sin(e)*c;l=a+l;k=b+k;this.addVertex(l,k,this.curR,this.curG,this.curB,this.curA,l*this.ma+k*this.mc+this.mx,l*this.mb+
k*this.md+this.my)}this.flush()},drawPie:function(a,b,c,d,e,f){null==f&&(f=0);if(6.283185307179586<=(0>e?-e:e))this.drawCircle(a,b,c,f);else{this.flush();this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);if(0==f){var g=c*e/4;f=Math.ceil(0>g?-g:g)}3>f&&(f=3);e/=f-1;for(g=0;g<f;){var h=g++*e+d,k=a+Math.cos(h)*c;h=b+Math.sin(h)*c;this.addVertex(k,h,this.curR,this.curG,this.curB,this.curA,k*this.ma+h*this.mc+this.mx,k*this.mb+h*this.md+
this.my)}this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);this.flush()}},drawPieInner:function(a,b,c,d,e,f,g){null==g&&(g=0);this.flush();6.284185307179587<=(0>f?-f:f)&&(f=6.284185307179587);var h=Math.sin(e),k=Math.cos(e+f),l=Math.sin(e+f);var m=a+Math.cos(e)*d;var p=b+h*d;this.addVertex(m,p,this.curR,this.curG,this.curB,this.curA,m*this.ma+p*this.mc+this.mx,m*this.mb+p*this.md+this.my);0==g&&(g=c*f/4,g=Math.ceil(0>g?-g:g));3>g&&
(g=3);f/=g-1;h=0;for(var r=g;h<r;)m=h++,p=m*f+e,m=a+Math.cos(p)*c,p=b+Math.sin(p)*c,this.addVertex(m,p,this.curR,this.curG,this.curB,this.curA,m*this.ma+p*this.mc+this.mx,m*this.mb+p*this.md+this.my);m=a+k*d;p=b+l*d;this.addVertex(m,p,this.curR,this.curG,this.curB,this.curA,m*this.ma+p*this.mc+this.mx,m*this.mb+p*this.md+this.my);h=0;for(r=g;h<r;)m=h++,p=(g-1-m)*f+e,m=a+Math.cos(p)*d,p=b+Math.sin(p)*d,this.addVertex(m,p,this.curR,this.curG,this.curB,this.curA,m*this.ma+p*this.mc+this.mx,m*this.mb+
p*this.md+this.my);this.flush()},drawRectanglePie:function(a,b,c,d,e,f,g){null==g&&(g=0);if(6.283185307179586<=(0>f?-f:f))this.drawRect(a-c/2,b-d/2,c,d);else{this.flush();this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);if(0==g){var h=(c<d?d:c)*f/4;g=Math.ceil(0>h?-h:h)}3>g&&(g=3);f/=g-1;h=Math.sqrt(2);for(var k=0;k<g;){var l=k++*f+e,m=Math.cos(l)*(c/2+1)*h,p=Math.sin(l)*(d/2+1)*h;(0>m?-m:m)>=c/2&&(m=0>Math.cos(l)?c/2*-1:c/2);(0>p?
-p:p)>=d/2&&(p=0>Math.sin(l)?d/2*-1:d/2);l=a+m;p=b+p;this.addVertex(l,p,this.curR,this.curG,this.curB,this.curA,l*this.ma+p*this.mc+this.mx,l*this.mb+p*this.md+this.my)}this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);this.flush()}},curveTo:function(a,b,c,d){var e=0==this.tmpPoints.length?0:this.tmpPoints[this.tmpPoints.length-1].x,f=0==this.tmpPoints.length?0:this.tmpPoints[this.tmpPoints.length-1].y;this.cubicCurveTo(e+.6666666666666666*
(a-e),f+.6666666666666666*(b-f),c+.6666666666666666*(a-c),d+.6666666666666666*(b-d),c,d)},cubicCurveTo:function(a,b,c,d,e,f,g){null==g&&(g=40);for(var h=0==this.tmpPoints.length?0:this.tmpPoints[this.tmpPoints.length-1].x,k=0==this.tmpPoints.length?0:this.tmpPoints[this.tmpPoints.length-1].y,l=a-h,m=b-k,p=c-a,r=d-b,n=e-c,u=f-d,w=1/g,I=1;I<g;){var q=I++*w,v=h+q*l,t=k+q*m,x=a+q*p,y=b+q*r;v+=q*(x-v);t+=q*(y-t);x=v+q*(x+q*(c+q*n-x)-v);q=t+q*(y+q*(d+q*u-y)-t);this.addVertex(x,q,this.curR,this.curG,this.curB,
this.curA,x*this.ma+q*this.mc+this.mx,x*this.mb+q*this.md+this.my)}this.addVertex(e,f,this.curR,this.curG,this.curB,this.curA,e*this.ma+f*this.mc+this.mx,e*this.mb+f*this.md+this.my)},lineTo:function(a,b){this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my)},addVertex:function(a,b,c,d,e,f,g,h){null==h&&(h=0);null==g&&(g=0);var k=this.lineSize/2;a-k<this.xMin&&(this.xMin=a-k);b-k<this.yMin&&(this.yMin=b-k);a+k>this.xMax&&(this.xMax=a+k);
b+k>this.yMax&&(this.yMax=b+k);a<this.xMinSize&&(this.xMinSize=a);b<this.yMinSize&&(this.yMinSize=b);a>this.xMaxSize&&(this.xMaxSize=a);b>this.yMaxSize&&(this.yMaxSize=b);if(this.doFill){k=this.content;var l=k.tmp;if(l.pos==l.array.length){var m=l.array.length<<1;128>m&&(m=128);m=new Float32Array(m);m.set(l.array);l.array=m}l.array[l.pos++]=a;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=b;l=k.tmp;l.pos==l.array.length&&
(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=g;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=h;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=c;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=
d;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=e;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=f;k.bufferDirty=!0}c=new Mf;c.load(a,b,this.lineR,this.lineG,this.lineB,this.lineA);this.tmpPoints.push(c)},draw:function(a){a.beginDrawBatchState(this)&&this.content.doRender(a)},sync:function(a){ed.prototype.sync.call(this,a);this.flush();
this.content.flush()},__class__:Ve});var Nf=function(){};Nf.__name__="hxd.Interactive";Nf.__isInterface__=!0;Nf.prototype={__class__:Nf};var Of=function(a,b,c,d){this.shapeX=this.shapeY=0;this.mouseDownButton=this.lastClickFrame=-1;this.cancelEvents=this.propagateEvents=this.enableRightButton=this.allowMultiClick=!1;this.cursor=vc.Button;Pa.call(this,c);this.width=a;this.height=b;this.shape=d};Of.__name__="h2d.Interactive";Of.__interfaces__=[Nf];Of.__super__=Pa;Of.prototype=D(Pa.prototype,{onAdd:function(){this.scene=
this.getScene();null!=this.scene&&this.scene.addEventTarget(this);Pa.prototype.onAdd.call(this)},draw:function(a){this.maskedBounds=a.getCurrentRenderZone(this.maskedBounds);null!=this.backgroundColor&&this.emitTile(a,rb.fromColor(this.backgroundColor,this.width|0,this.height|0,(this.backgroundColor>>>24)/255))},getBoundsRec:function(a,b,c){Pa.prototype.getBoundsRec.call(this,a,b,c);(null!=this.backgroundColor||c)&&this.addBounds(a,b,0,0,this.width|0,this.height|0)},onHierarchyMoved:function(a){Pa.prototype.onHierarchyMoved.call(this,
a);null!=this.scene&&(this.scene.removeEventTarget(this),this.scene=this.getScene(),null!=this.scene&&this.scene.addEventTarget(this))},onRemove:function(){null!=this.scene&&(this.scene.removeEventTarget(this,!0),this.scene=null);Pa.prototype.onRemove.call(this)},checkBounds:function(a){switch(a.kind._hx_index){case 4:case 6:case 7:case 10:return!1;default:return!0}},preventClick:function(){this.mouseDownButton=-1},getInteractiveScene:function(){return this.scene},handleEvent:function(a){if(null!=
this.maskedBounds&&this.checkBounds(a)){var b=a.relX,c=a.relY;null==c&&(c=0);null==b&&(b=0);b=new Da(b,c);this.localToGlobal(b);if(b.x<this.maskedBounds.xMin||b.y<this.maskedBounds.yMin||b.x>this.maskedBounds.xMax||b.y>this.maskedBounds.yMax){a.cancel=!0;return}}if(null==this.shape&&this.isEllipse&&this.checkBounds(a)&&(c=.5*this.width,b=.5*this.height,c=(a.relX-c)/c,b=(a.relY-b)/b,1<c*c+b*b)){a.cancel=!0;return}this.propagateEvents&&(a.propagate=!0);this.cancelEvents&&(a.cancel=!0);switch(a.kind._hx_index){case 0:if(this.enableRightButton||
0==a.button)this.mouseDownButton=a.button,this.onPush(a),a.cancel&&(this.mouseDownButton=-1);break;case 1:if(this.enableRightButton||0==a.button)this.onRelease(a),b=ea.frameCount,this.mouseDownButton!=a.button||this.lastClickFrame==b&&!this.allowMultiClick||(this.onClick(a),this.lastClickFrame=b);this.mouseDownButton=-1;break;case 2:this.onMove(a);break;case 3:this.onOver(a);break;case 4:this.onOut(a);break;case 5:a.propagate=!0;this.onWheel(a);break;case 6:this.onFocus(a);break;case 7:this.onFocusLost(a);
break;case 8:this.onKeyDown(a);break;case 9:this.onKeyUp(a);break;case 10:if(this.enableRightButton||0==a.button)if(this.onRelease(a),this.mouseDownButton==a.button)this.onReleaseOutside(a);this.mouseDownButton=-1;break;case 11:this.onTextInput(a);break;case 12:this.onCheck(a)}},calcAbsPos:function(){Pa.prototype.calcAbsPos.call(this);this.invDet=1/(this.matA*this.matD-this.matB*this.matC)},set_cursor:function(a){this.cursor=a;null!=this.scene&&null!=this.scene.events&&this.scene.events.updateCursor(this);
return a},eventToLocal:function(a){var b=a.relX-this.absX,c=a.relY-this.absY;a.relX=(b*this.matD-c*this.matC)*this.invDet;a.relY=(-b*this.matB+c*this.matA)*this.invDet},startCapture:function(a,b,c){var d=this;this.scene.startCapture(function(b){var c=b.relX,e=b.relY;d.eventToLocal(b);a(b);b.relX=c;b.relY=e},b,c)},stopCapture:function(){this.scene.stopCapture()},startDrag:function(a,b){this.startCapture(a,b)},stopDrag:function(){this.stopCapture()},focus:function(){null!=this.scene&&null!=this.scene.events&&
this.scene.events.focus(this)},blur:function(){this.hasFocus()&&this.scene.events.blur()},isOver:function(){return null!=this.scene&&null!=this.scene.events?-1!=this.scene.events.overList.indexOf(this):!1},hasFocus:function(){return null!=this.scene&&null!=this.scene.events?this.scene.events.currentFocus==this:!1},onOver:function(a){},onOut:function(a){},onPush:function(a){},onRelease:function(a){},onReleaseOutside:function(a){},onClick:function(a){},onMove:function(a){},onWheel:function(a){},onFocus:function(a){},
onFocusLost:function(a){},onKeyUp:function(a){},onKeyDown:function(a){},onCheck:function(a){},onTextInput:function(a){},__class__:Of});var Pc=function(a){Pa.call(this,a);this.layersIndexes=[];this.layerCount=0};Pc.__name__="h2d.Layers";Pc.__super__=Pa;Pc.prototype=D(Pa.prototype,{addChild:function(a){this.add(a,-1)},add:function(a,b,c){null==c&&(c=-1);null==b&&(b=-1);if(a.parent==this){var d=a.allocated;a.allocated=!1;this.removeChild(a);a.allocated=d}for(-1==b&&(b=0==this.layerCount?0:this.layerCount-
1);b>=this.layerCount;)this.layersIndexes[this.layerCount++]=this.children.length;-1!=c?0==b?(d=this.layersIndexes[b],c=c>d?d:c,Pa.prototype.addChildAt.call(this,a,0<c?c:0)):0>c?Pa.prototype.addChildAt.call(this,a,this.layersIndexes[b-1]):(c=this.layersIndexes[b-1]+c,d=this.layersIndexes[b],Pa.prototype.addChildAt.call(this,a,c>d?d:c)):Pa.prototype.addChildAt.call(this,a,this.layersIndexes[b]);a=b;for(b=this.layerCount;a<b;)c=a++,this.layersIndexes[c]++},addChildAt:function(a,b){this.add(a,-1,b)},
removeChild:function(a){for(var b=0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==a){this.children.splice(d,1);if(a.allocated)a.onRemove();a.parent=null;a.posChanged=!0;null!=a.parentContainer&&a.setParentContainer(null);for(a=this.layerCount-1;0<=a&&this.layersIndexes[a]>d;)this.layersIndexes[a]--,--a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);break}}},under:function(a){for(var b=0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==a){c=b=0;for(var e=
this.layersIndexes;c<e.length;){var f=e[c];++c;if(f>d)break;else b=f}for(;d>b;)this.children[d]=this.children[d-1],--d;this.children[b]=a;if(a.allocated)a.onHierarchyMoved(!1);break}}},over:function(a){for(var b=0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==a){c=0;for(var e=this.layersIndexes;c<e.length;)if(b=e[c],++c,b>d){for(c=b-1;d<c;)e=d++,this.children[e]=this.children[e+1];this.children[b-1]=a;if(a.allocated)a.onHierarchyMoved(!1);break}break}}},getLayer:function(a){a=a>=this.layerCount?
[]:this.children.slice(0==a?0:this.layersIndexes[a-1],this.layersIndexes[a]);return new yg(a)},getChildAtLayer:function(a,b){-1==b&&(b=0==this.layerCount?0:this.layerCount-1);return b>=this.layerCount||0>a||a>=this.layersIndexes[b]?null:0==b?this.children[a]:this.children[this.layersIndexes[b-1]+a]},getChildLayer:function(a){if(a.parent!=this)return-1;a=this.children.indexOf(a);for(var b=0,c=this.layerCount;b<c;){var d=b++;if(this.layersIndexes[d]>a)return d}return-1},getChildIndexInLayer:function(a){if(a.parent!=
this)return-1;a=this.children.indexOf(a);if(a<this.layersIndexes[0])return a;for(var b=1,c=this.layerCount;b<c;){var d=b++;if(this.layersIndexes[d]>a)return a-this.layersIndexes[d-1]}return-1},drawLayer:function(a,b){var c;if(!(b>=this.layerCount)){var d=a.globalAlpha;a.globalAlpha*=this.alpha;var e=0==b?0:this.layersIndexes[b-1];b=this.layersIndexes[b];if(a.front2back){var f=e;for(c=b;f<c;)e=f++,this.children[b-1-e].drawRec(a)}else for(f=e,c=b;f<c;)e=f++,this.children[e].drawRec(a);a.globalAlpha=
d}},ysort:function(a){if(!(a>=this.layerCount)){var b=0==a?0:this.layersIndexes[a-1];a=this.layersIndexes[a];if(b!=a)for(var c=b,d=this.children[c++].y;c<a;){var e=this.children[c];if(e.y<d){for(var f=c-1;f>=b;){var g=this.children[f];if(e.y>=g.y)break;this.children[f+1]=g;--f}this.children[f+1]=e;if(e.allocated)e.onHierarchyMoved(!1)}else d=e.y;++c}}},__class__:Pc});var Qa=function(){this.shaderBuffers=new Ih;this.engine=ja.CURRENT;this.time=this.frame=0;this.elapsedTime=1/la.getDefaultFrameRate();
this.textures=new rc;this.globals=new za};Qa.__name__="h3d.impl.RenderContext";Qa.get=function(){return Qa.inst};Qa.getType=function(a){var b=Qa.inst;return ka.__downcastCheck(b,a)?b:null};Qa.prototype={setCurrent:function(){Qa.inst=this},clearCurrent:function(){if(Qa.inst==this)Qa.inst=null;else throw t.thrown("Context has changed");},dispose:function(){this.textures.dispose()},fillRec:function(a,b,c,d){var e;switch(b._hx_index){case 1:return c[d]=a,1;case 3:return c[d]=a,1;case 5:var f=b.size;if(4==
f)return c[d++]=a.x,c[d++]=a.y,c[d++]=a.z,c[d++]=a.w,4;var g=f;c[d++]=a.x;c[d++]=a.y;3==g&&(c[d++]=a.z);return g;case 6:var h=a;c[d++]=h._11;c[d++]=h._21;c[d++]=h._31;c[d++]=0;c[d++]=h._12;c[d++]=h._22;c[d++]=h._32;c[d++]=0;c[d++]=h._13;c[d++]=h._23;c[d++]=h._33;c[d++]=0;return 12;case 7:return h=a,c[d++]=h._11,c[d++]=h._21,c[d++]=h._31,c[d++]=h._41,c[d++]=h._12,c[d++]=h._22,c[d++]=h._32,c[d++]=h._42,c[d++]=h._13,c[d++]=h._23,c[d++]=h._33,c[d++]=h._43,c[d++]=h._14,c[d++]=h._24,c[d++]=h._34,c[d++]=
h._44,16;case 8:return h=a,c[d++]=h._11,c[d++]=h._21,c[d++]=h._31,c[d++]=h._41,c[d++]=h._12,c[d++]=h._22,c[d++]=h._32,c[d++]=h._42,c[d++]=h._13,c[d++]=h._23,c[d++]=h._33,c[d++]=h._43,12;case 13:b=b.vl;for(f=h=0;f<b.length;)g=b[f],++f,h+=this.fillRec(sa.field(a,g.name),g.type,c,d+h);return h;case 15:f=b.t;var k=b.size;switch(f._hx_index){case 3:if(0==k._hx_index){b=k.v;h=a.length<b?a.length:b;f=0;for(k=h;f<k;)g=f++,c[d++]=a[g];return b}throw t.thrown("assert "+y.string(b));case 5:if(4==f.size)if(1==
f.t._hx_index){if(0==k._hx_index){b=k.v;f=0;for(k=b;f<k;){g=f++;g=a[g];if(null==g)break;c[d++]=g.x;c[d++]=g.y;c[d++]=g.z;c[d++]=g.w}return 4*b}}else{if(0==k._hx_index){h=f;b=k.v;f=e=0;for(k=b;f<k;){g=f++;g=a[g];if(null==g)break;e=this.fillRec(g,h,c,d);d+=e}return b*e}}else if(0==k._hx_index){h=f;b=k.v;f=e=0;for(k=b;f<k;){g=f++;g=a[g];if(null==g)break;e=this.fillRec(g,h,c,d);d+=e}return b*e}throw t.thrown("assert "+y.string(b));case 8:if(0==k._hx_index){b=k.v;f=0;for(k=b;f<k;){g=f++;h=a[g];if(null==
h)break;c[d++]=h._11;c[d++]=h._21;c[d++]=h._31;c[d++]=h._41;c[d++]=h._12;c[d++]=h._22;c[d++]=h._32;c[d++]=h._42;c[d++]=h._13;c[d++]=h._23;c[d++]=h._33;c[d++]=h._43}return 12*b}throw t.thrown("assert "+y.string(b));default:if(0==k._hx_index){h=f;b=k.v;f=e=0;for(k=b;f<k;){g=f++;g=a[g];if(null==g)break;e=this.fillRec(g,h,c,d);d+=e}return b*e}throw t.thrown("assert "+y.string(b));}default:throw t.thrown("assert "+y.string(b));}},shaderInfo:function(a,b){for(b=b.split(".").pop();null!=a;){for(var c=0,
d=a.s.instance.shader.vars;c<d.length;){var e=d[c];++c;if(e.name==b)return a.s.toString()}a=a.next}return"(not found)"},getPtr:function(a){return a},getParamValue:function(a,b,c){null==c&&(c=!1);if(null!=a.perObjectGlobal){var d=this.globals.map.h[a.perObjectGlobal.gid];if(null==d)throw t.thrown("Missing global value "+a.perObjectGlobal.path+" for shader "+this.shaderInfo(b,a.perObjectGlobal.path));return 17==a.type._hx_index?d.texture:d}for(d=a.instance;0<--d;)b=b.next;d=b.s.getParamValue(a.index);
if(null==d&&!c)throw t.thrown("Missing param value "+y.string(b.s)+"."+a.name);return d},fillGlobals:function(a,b){var c;var d=b.vertex.globals;for(c=a.vertex.globals;null!=d;){var e=this.globals.map.h[d.gid];if(null==e)throw t.thrown("Missing global value "+d.path);this.fillRec(e,d.type,c,d.pos);d=d.next}if(null!=b.fragment)for(d=b.fragment.globals,c=a.fragment.globals;null!=d;){e=this.globals.map.h[d.gid];if(null==e)throw t.thrown("Missing global value "+d.path);this.fillRec(e,d.type,c,d.pos);d=
d.next}},fillParams:function(a,b,c,d){var e;null==d&&(d=!1);var f=-1;var g=null;var h=a.vertex;var k=b.vertex;var l=k.params;for(e=h.params;null!=l;){if(null==l.perObjectGlobal){switch(l.type._hx_index){case 1:case 3:var m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;e[l.pos]=m.getParamFloatValue(l.index);l=l.next;continue}m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m)throw t.thrown("Missing param value "+y.string(g)+"."+
l.name);}else if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw t.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));var p=l.type;m=(p=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m)throw t.thrown("Missing param value "+y.string(c.s)+"."+l.name);}this.fillRec(m,l.type,e,l.pos);l=l.next}e=0;for(l=k.textures;null!=
l;){p=!Qa.STRICT;null==p&&(p=!1);if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw t.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;m=(p=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m&&!p)throw t.thrown("Missing param value "+y.string(c.s)+"."+l.name);}if(0>l.pos){var r=m;var n=0;for(p=-l.pos;n<
p;)m=n++,h.tex[e++]=r[m]}else h.tex[e++]=m;l=l.next}l=k.buffers;for(k=0;null!=l;){p=!Qa.STRICT;null==p&&(p=!1);if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw t.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;e=(e=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m&&!p)throw t.thrown("Missing param value "+
y.string(c.s)+"."+l.name);e=m}h.buffers[k++]=e;l=l.next}if(null!=b.fragment){h=a.fragment;k=b.fragment;l=k.params;for(e=h.params;null!=l;){if(null==l.perObjectGlobal){switch(l.type._hx_index){case 1:case 3:m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;e[l.pos]=m.getParamFloatValue(l.index);l=l.next;continue}m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m)throw t.thrown("Missing param value "+y.string(g)+"."+l.name);}else if(null!=
l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw t.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;m=(p=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m)throw t.thrown("Missing param value "+y.string(c.s)+"."+l.name);}this.fillRec(m,l.type,e,l.pos);l=l.next}e=0;for(l=k.textures;null!=l;){p=!Qa.STRICT;
null==p&&(p=!1);if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw t.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;m=(p=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m&&!p)throw t.thrown("Missing param value "+y.string(c.s)+"."+l.name);}if(0>l.pos)for(r=m,n=0,p=-l.pos;n<p;)m=n++,h.tex[e++]=
r[m];else h.tex[e++]=m;l=l.next}l=k.buffers;for(k=0;null!=l;){p=!Qa.STRICT;null==p&&(p=!1);if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw t.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;e=(e=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m&&!p)throw t.thrown("Missing param value "+y.string(c.s)+
"."+l.name);e=m}h.buffers[k++]=e;l=l.next}}},__class__:Qa};var Qf=function(a){this.renderZoneIndex=0;this.renderZoneStack=[];this.currentCamera=null;this.tmpBounds=new Db;this.defaultSmooth=!1;this.globalAlpha=1;Qa.call(this);this.scene=a;this.bufPos=0;this.output=new Pf;this.pass=new ba("",null);this.pass.depth(!0,ob.Always);this.pass.set_culling(gc.None);this.baseShader=new kf;this.baseShader.setPriority(100);this.baseShader.zValue__=0;this.baseShaderList=new Eb(this.baseShader);this.targetsStack=
[];this.targetsStackIndex=0;this.cameraStack=[];this.cameraStackIndex=0;this.filterStack=[];this.filterStackIndex=0};Qf.__name__="h2d.RenderContext";Qf.__super__=Qa;Qf.prototype=D(Qa.prototype,{dispose:function(){Qa.prototype.dispose.call(this);null!=this.fixedBuffer&&this.fixedBuffer.dispose()},hasBuffering:function(){return!1},begin:function(){this.currentObj=this.texture=null;this.stride=this.bufPos=0;this.viewA=this.scene.viewportA;this.viewC=this.viewB=0;this.viewD=this.scene.viewportD;this.viewX=
this.scene.viewportX;this.viewY=this.scene.viewportY;this.setCurrent();this.targetFlipY=this.engine.driver.hasFeature(Ia.BottomLeftCoords)?-1:1;this.baseFlipY=null!=this.engine.getCurrentTarget()?this.targetFlipY:1;this.inFilter=null;this.globals.set("time",this.time);this.globals.set("global.time",this.time);var a=this.baseShader;a.constModified=!0;a.pixelAlign__=!1;a=this.baseShader.halfPixelInverse__;var b=.5/this.engine.width,c=.5/this.engine.height;null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=
0;a=this.baseShader.viewportA__;b=this.scene.viewportA;c=0;var d=this.scene.viewportX;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a=this.baseShader.viewportB__;b=0;c=this.scene.viewportD*-this.baseFlipY;d=this.scene.viewportY*-this.baseFlipY;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a=this.baseShader.filterMatrixA__;b=1;d=c=0;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a=this.baseShader.filterMatrixB__;b=0;c=1;d=0;null==d&&(d=0);null==c&&
(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;this.baseShaderList.next=null;this.initShaders(this.baseShaderList);this.engine.selectMaterial(this.pass);this.textures.begin()},allocTarget:function(a,b){null==b&&(b=!1);a=this.textures.allocTarget(a,this.scene.width,this.scene.height,!1);a.set_filter(b?fd.Linear:fd.Nearest);return a},clear:function(a){this.engine.clear(a)},initShaders:function(a){this.needInitShaders=!1;this.currentShaders=a;this.compiledShader=this.output.compileShaders(this.globals,a);a=
this.shaderBuffers;var b=this.compiledShader;a.vertex.grow(b.vertex);null!=b.fragment&&a.fragment.grow(b.fragment);this.fillGlobals(a,this.compiledShader);this.engine.selectShader(this.compiledShader);this.engine.uploadShaderBuffers(a,0)},end:function(){this.currentObj=this.texture=null;this.baseShaderList.next=null;this.clearCurrent();if(0!=this.targetsStackIndex)throw t.thrown("Missing popTarget()");if(0!=this.cameraStackIndex)throw t.thrown("Missing popCamera()");},pushCamera:function(a){var b=
this.cameraStack[this.cameraStackIndex++];null==b&&(b={va:0,vb:0,vc:0,vd:0,vx:0,vy:0,camera:null},this.cameraStack.push(b));var c=this.viewA,d=this.viewB,e=this.viewC,f=this.viewD;b.va=c;b.vb=d;b.vc=e;b.vd=f;b.vx=this.viewX;b.vy=this.viewY;b.camera=this.currentCamera;this.currentCamera=a;this.viewA=a.matA*c+a.matB*e;this.viewB=a.matA*d+a.matB*f;this.viewC=a.matC*c+a.matD*e;this.viewD=a.matC*d+a.matD*f;this.viewX=a.absX*c+a.absY*e+this.viewX;this.viewY=a.absX*d+a.absY*f+this.viewY;a=null!=this.curTarget?
-this.targetFlipY:-this.baseFlipY;b=this.baseShader.viewportA__;c=this.viewA;d=this.viewC;e=this.viewX;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.baseShader.viewportB__;c=this.viewB*a;d=this.viewD*a;e=this.viewY*a;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e},popCamera:function(){if(0==this.cameraStackIndex)throw t.thrown("Too many popCamera()");var a=this.cameraStack[--this.cameraStackIndex];this.viewA=a.va;this.viewB=a.vb;this.viewC=a.vc;this.viewD=a.vd;
this.viewX=a.vx;this.viewY=a.vy;this.currentCamera=a.camera;a.camera=null;a=null!=this.curTarget?-this.targetFlipY:-this.baseFlipY;var b=this.baseShader.viewportA__,c=this.viewA,d=this.viewC,e=this.viewX;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.baseShader.viewportB__;c=this.viewB*a;d=this.viewD*a;e=this.viewY*a;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e},pushFilter:function(a){if(0==this.filterStack.length&&null!=this.onEnterFilter&&!this.onEnterFilter(a))return!1;
this.inFilter=this.filterStack[this.filterStackIndex++];null==this.inFilter&&(this.inFilter={spr:null,scaleX:1,scaleY:1},this.filterStack.push(this.inFilter));this.inFilter.spr=a;this.inFilter.scaleX=1;this.inFilter.scaleY=1;return!0},setFilterScale:function(a,b){null!=this.inFilter&&(this.inFilter.scaleX=a,this.inFilter.scaleY=b)},getFilterScale:function(a){null==a&&(a=new Da(0,0));if(null!=this.inFilter){var b=a;var c=this.inFilter.scaleX;var d=this.inFilter.scaleY}else b=a,d=c=1;null==d&&(d=0);
null==c&&(c=0);b.x=c;b.y=d;return a},popFilter:function(){this.inFilter.spr=null;this.filterStackIndex--;if(0<this.filterStackIndex)this.inFilter=this.filterStack[this.filterStackIndex-1];else if(this.inFilter=null,null!=this.onLeaveFilter)this.onLeaveFilter(this.filterStack[this.filterStackIndex].spr)},pushTarget:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=-1);null==c&&(c=0);null==b&&(b=0);this.engine.pushTarget(a);this.initShaders(this.baseShaderList);var f=this.targetsStack[this.targetsStackIndex++];
null==f&&(f={t:null,va:0,vb:0,vc:0,vd:0,vx:0,vy:0,hasRZ:!1,rzX:0,rzY:0,rzW:0,rzH:0},this.targetsStack.push(f));f.t=this.curTarget;f.va=this.viewA;f.vb=this.viewB;f.vc=this.viewC;f.vd=this.viewD;f.vx=this.viewX;f.vy=this.viewY;f.hasRZ=this.hasRenderZone;f.rzX=this.renderX;f.rzY=this.renderY;f.rzW=this.renderW;f.rzH=this.renderH;0>d&&(d=null==a?this.scene.width:a.width);0>e&&(e=null==a?this.scene.height:a.height);this.viewA=2/d;this.viewC=this.viewB=0;this.viewD=2/e;this.viewX=-1-b*this.viewA;this.viewY=
-1-c*this.viewD;b=this.baseShader.halfPixelInverse__;c=.5/(null==a?this.engine.width:a.width);d=.5/(null==a?this.engine.height:a.height);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=0;b=this.baseShader.viewportA__;c=this.viewA;d=this.viewC;e=this.viewX;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.baseShader.viewportB__;c=this.viewB*-this.targetFlipY;d=this.viewD*-this.targetFlipY;e=this.viewY*-this.targetFlipY;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=
e;this.curTarget=a;this.currentBlend=null;this.hasRenderZone&&(this.hasRenderZone=!1,this.engine.setRenderZone())},pushTargets:function(a){this.pushTarget(a[0]);1<a.length&&(this.engine.popTarget(),this.engine.pushTargets(a))},popTarget:function(){if(0>=this.targetsStackIndex)throw t.thrown("Too many popTarget()");this.engine.popTarget();var a=this.targetsStack[--this.targetsStackIndex],b=this.curTarget=a.t;this.viewA=a.va;this.viewB=a.vb;this.viewC=a.vc;this.viewD=a.vd;this.viewX=a.vx;this.viewY=
a.vy;var c=null==b?-this.baseFlipY:-this.targetFlipY;this.initShaders(this.baseShaderList);var d=this.baseShader.halfPixelInverse__,e=.5/(null==b?this.engine.width:b.width);b=.5/(null==b?this.engine.height:b.height);null==b&&(b=0);null==e&&(e=0);d.x=e;d.y=b;d.z=0;d=this.baseShader.viewportA__;e=this.viewA;b=this.viewC;var f=this.viewX;null==f&&(f=0);null==b&&(b=0);null==e&&(e=0);d.x=e;d.y=b;d.z=f;d=this.baseShader.viewportB__;e=this.viewB*c;b=this.viewD*c;f=this.viewY*c;null==f&&(f=0);null==b&&(b=
0);null==e&&(e=0);d.x=e;d.y=b;d.z=f;a.hasRZ&&this.setRZ(a.rzX,a.rzY,a.rzW,a.rzH)},pushRenderZone:function(a,b,c,d){var e=this.renderZoneStack[this.renderZoneIndex++];null==e?(e={hasRZ:this.hasRenderZone,x:this.renderX,y:this.renderY,w:this.renderW,h:this.renderH},this.renderZoneStack[this.renderZoneIndex-1]=e):this.hasRenderZone?(e.hasRZ=!0,e.x=this.renderX,e.y=this.renderY,e.w=this.renderW,e.h=this.renderH):e.hasRZ=!1;this.setRZ(a,b,c,d)},popRenderZone:function(){if(0==this.renderZoneIndex)throw t.thrown("Too many popRenderZone()");
var a=this.renderZoneStack[--this.renderZoneIndex];a.hasRZ?this.setRZ(a.x,a.y,a.w,a.h):(this.hasRenderZone=!1,this.engine.setRenderZone())},getCurrentRenderZone:function(a){if(!this.hasRenderZone)return null;null==a&&(a=new Db);var b=this.renderX,c=this.renderY;a.xMin=b;a.yMin=c;a.xMax=b+this.renderW;a.yMax=c+this.renderH;return a},clipRenderZone:function(a,b,c,d){this.hasRenderZone?(c=Math.min(a+c,this.renderX+this.renderW),d=Math.min(b+d,this.renderY+this.renderH),a=Math.max(a,this.renderX),b=Math.max(b,
this.renderY),c<a&&(c=a),d<b&&(d=b),this.pushRenderZone(a,b,c-a,d-b)):this.pushRenderZone(a,b,c,d)},setRZ:function(a,b,c,d){this.hasRenderZone=!0;this.renderX=a;this.renderY=b;this.renderW=c;this.renderH=d;var e=this.scene.viewportA*this.engine.width/2,f=this.scene.viewportD*this.engine.height/2;if(null!=this.inFilter){var g=this.baseShader.filterMatrixA__,h=this.baseShader.filterMatrixB__;c=a+c;var k=b+d,l=a*g.x+b*g.y+g.z;d=a*h.x+b*h.y+h.z;g=c*g.x+k*g.y+g.z;h=c*h.x+k*h.y+h.z;a=l;b=d;c=g-l;d=h-d}this.engine.setRenderZone(a*
e+this.engine.width/2*(this.scene.viewportX+1)+1E-10|0,b*f+this.engine.height/2*(this.scene.viewportY+1)+1E-10|0,c*e+1E-10|0,d*f+1E-10|0)},clearRZ:function(){this.hasRenderZone=!1;this.engine.setRenderZone()},setRenderZone:function(a,b,c,d){this.pushRenderZone(a,b,c,d)},clearRenderZone:function(){this.popRenderZone()},drawLayer:function(a){this.scene.drawLayer(this,a)},drawScene:function(){this.scene.drawRec(this)},flush:function(){},_flush:function(){if(0!=this.bufPos){this.beforeDraw();var a=this.bufPos/
this.stride|0,b=new hc(a,N.get_XY_UV_RGBA(),[Ja.Dynamic]);b.uploadFloats(this.buffer,0,a);a=this.engine;a.renderBuffer(b,a.mem.getQuadIndexes(b.vertices),2,0,-1);b.dispose();this.bufPos=0;this.texture=null}},beforeDraw:function(){null==this.texture&&(this.texture=W.fromColor(16711935));this.baseShader.texture__=this.texture;this.texture.set_filter((null==this.currentObj.smooth?this.defaultSmooth:this.currentObj.smooth)?fd.Linear:fd.Nearest);this.texture.set_wrap(!this.currentObj.tileWrap||null!=this.currentObj.filter&&
null==this.inFilter?Qd.Clamp:Qd.Repeat);var a=this.currentObj.blendMode;null!=this.inFilter&&this.inFilter.spr==this.currentObj&&a==ya.Erase&&(a=ya.Add);null!=this.inFilterBlend&&(a=this.inFilterBlend);a!=this.currentBlend&&(this.currentBlend=a,this.pass.setBlendMode(a),a==ya.Alpha||a==ya.Add)&&(this.pass.set_blendAlphaSrc(Y.One),null!=this.inFilterBlend&&this.pass.set_blendSrc(Y.One));a=this.shaderBuffers;this.fillParams(a,this.compiledShader,this.currentShaders);this.engine.selectMaterial(this.pass);
this.engine.uploadShaderBuffers(a,1);this.engine.uploadShaderBuffers(a,2);this.engine.uploadShaderBuffers(a,3)},setupColor:function(a){if(null!=this.inFilter&&this.inFilter.spr==a){var b=this.baseShader.color__;var c=a.color.x;var d=a.color.y;var e=a.color.z;a=a.color.w}else null!=this.inFilterBlend?(b=this.baseShader.color__,a=e=d=c=this.globalAlpha):(b=this.baseShader.color__,c=a.color.x,d=a.color.y,e=a.color.z,a=a.color.w*this.globalAlpha);null==a&&(a=1);null==e&&(e=0);null==d&&(d=0);null==c&&
(c=0);b.x=c;b.y=d;b.z=e;b.w=a},beginDrawBatchState:function(a){if(!this.beginDraw(a,null,!0))return!1;if(null!=this.inFilter&&this.inFilter.spr==a){var b=this.baseShader.color__;var c=a.color.x;var d=a.color.y;var e=a.color.z;var f=a.color.w}else null!=this.inFilterBlend?(b=this.baseShader.color__,f=e=d=c=this.globalAlpha):(b=this.baseShader.color__,c=a.color.x,d=a.color.y,e=a.color.z,f=a.color.w*this.globalAlpha);null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;
b=this.baseShader.absoluteMatrixA__;c=a.matA;d=a.matC;e=a.absX;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.baseShader.absoluteMatrixB__;c=a.matB;d=a.matD;e=a.absY;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;return!0},swapTexture:function(a){this.texture=a;this.beforeDraw()},beginDrawObject:function(a,b){if(!this.beginDraw(a,b,!0))return!1;if(null!=this.inFilter&&this.inFilter.spr==a){var c=this.baseShader.color__;var d=a.color.x;var e=a.color.y;var f=a.color.z;
b=a.color.w}else null!=this.inFilterBlend?(c=this.baseShader.color__,b=f=e=d=this.globalAlpha):(c=this.baseShader.color__,d=a.color.x,e=a.color.y,f=a.color.z,b=a.color.w*this.globalAlpha);null==b&&(b=1);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c.w=b;c=this.baseShader.absoluteMatrixA__;d=a.matA;e=a.matC;f=a.absX;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c=this.baseShader.absoluteMatrixB__;d=a.matB;e=a.matD;f=a.absY;null==f&&(f=0);null==e&&(e=0);null==d&&(d=
0);c.x=d;c.y=e;c.z=f;this.beforeDraw();return!0},beginDrawBatch:function(a,b){return this.beginDraw(a,b,!1)},drawTile:function(a,b){if(null!=this.inFilter){var c=this.baseShader.filterMatrixA__;var d=this.baseShader.filterMatrixB__;var e=a.matA*c.x+a.matB*c.y;var f=a.matA*d.x+a.matB*d.y;var g=a.matC*c.x+a.matD*c.y;var h=a.matC*d.x+a.matD*d.y;c=a.absX*c.x+a.absY*c.y+c.z;var k=a.absX*d.x+a.absY*d.y+d.z;d=e*this.viewA+f*this.viewC;e=e*this.viewB+f*this.viewD;f=g*this.viewA+h*this.viewC;g=g*this.viewB+
h*this.viewD;h=c*this.viewA+k*this.viewC+this.viewX;c=c*this.viewB+k*this.viewD+this.viewY}else d=a.matA*this.viewA+a.matB*this.viewC,e=a.matA*this.viewB+a.matB*this.viewD,f=a.matC*this.viewA+a.matD*this.viewC,g=a.matC*this.viewB+a.matD*this.viewD,h=a.absX*this.viewA+a.absY*this.viewC+this.viewX,c=a.absX*this.viewB+a.absY*this.viewD+this.viewY;if(0==e&&0==f){k=b.dx+.5*b.width;e=b.dy+.5*b.height;var l=0>d?-d:d;f=0>g?-g:g;f=1.5*(b.width>b.height?b.width:b.height)*(l<f?f:l);d=h+k*d;g=c+e*g;if(-1>d+f||
1<d-f||-1>g+f||1<g-f)return!1}else{var m=1E20,p=1E20,r=-1E20,n=-1E20,u=b.dx*d+b.dy*f;k=b.dx*e+b.dy*g;u<m&&(m=u);u>r&&(r=u);k<p&&(p=k);k>n&&(n=k);l=b.width;u=(l+b.dx)*d+b.dy*f;k=(l+b.dx)*e+b.dy*g;u<m&&(m=u);u>r&&(r=u);k<p&&(p=k);k>n&&(n=k);k=b.height;u=b.dx*d+(k+b.dy)*f;k=b.dx*e+(k+b.dy)*g;u<m&&(m=u);u>r&&(r=u);k<p&&(p=k);k>n&&(n=k);l=b.width;k=b.height;u=(l+b.dx)*d+(k+b.dy)*f;k=(l+b.dx)*e+(k+b.dy)*g;u<m&&(m=u);u>r&&(r=u);k<p&&(p=k);k>n&&(n=k);if(-1>h+r||-1>c+n||1<h+m||1<c+p)return!1}if(!this.beginDraw(a,
b.innerTex,!0,!0))return!1;null!=this.inFilter&&this.inFilter.spr==a?(d=this.baseShader.color__,l=a.color.x,k=a.color.y,h=a.color.z,g=a.color.w):null!=this.inFilterBlend?(d=this.baseShader.color__,g=h=k=l=this.globalAlpha):(d=this.baseShader.color__,l=a.color.x,k=a.color.y,h=a.color.z,g=a.color.w*this.globalAlpha);null==g&&(g=1);null==h&&(h=0);null==k&&(k=0);null==l&&(l=0);d.x=l;d.y=k;d.z=h;d.w=g;d=this.baseShader.absoluteMatrixA__;l=b.width*a.matA;k=b.height*a.matC;h=a.absX+b.dx*a.matA+b.dy*a.matC;
null==h&&(h=0);null==k&&(k=0);null==l&&(l=0);d.x=l;d.y=k;d.z=h;d=this.baseShader.absoluteMatrixB__;l=b.width*a.matB;k=b.height*a.matD;h=a.absY+b.dx*a.matB+b.dy*a.matD;null==h&&(h=0);null==k&&(k=0);null==l&&(l=0);d.x=l;d.y=k;d.z=h;d=this.baseShader.uvPos__;l=b.u;k=b.v;h=b.u2-b.u;g=b.v2-b.v;null==g&&(g=1);null==h&&(h=0);null==k&&(k=0);null==l&&(l=0);d.x=l;d.y=k;d.z=h;d.w=g;this.beforeDraw();if(null==this.fixedBuffer||null==this.fixedBuffer.vbuf)this.fixedBuffer=new hc(4,N.get_XY_UV_RGBA()),a=wd._new(0),
b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),
a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),
a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,this.fixedBuffer.uploadFloats(a,0,4);d=this.engine;f=this.fixedBuffer;d.renderBuffer(f,d.mem.getQuadIndexes(f.vertices),2,0,-1);return!0},beginDraw:function(a,b,c,d){null==d&&(d=!1);if(null!=this.onBeginDraw&&!this.onBeginDraw(a))return!1;for(var e=this.needInitShaders,f=!1,g=a.shaders,h=this.currentShaders.next;null!=g&&null!=h;){var k=g.s,l=h.s;g=g.next;h=h.next;var m=l.instance;k!=l&&(f=!0);k.updateConstants(this.globals);k.instance!=m&&(e=!0)}if(null!=
g||null!=h||this.baseShader.isRelative__!=c||this.baseShader.hasUVPos__!=d||this.baseShader.killAlpha__!=this.killAlpha)e=!0;if(e)e=this.baseShader,e.constModified=!0,e.hasUVPos__=d,e=this.baseShader,e.constModified=!0,e.isRelative__=c,e=this.baseShader,e.constModified=!0,e.killAlpha__=this.killAlpha,this.baseShader.updateConstants(this.globals),this.baseShaderList.next=a.shaders,this.initShaders(this.baseShaderList);else if(f){if(this.currentShaders!=this.baseShaderList)throw t.thrown("!");this.currentShaders.next=
a.shaders}this.texture=b;this.stride=8;this.currentObj=a;return!0},setCurrent:function(){Qa.prototype.setCurrent.call(this);this.needInitShaders=!0},__class__:Qf});var wc=K["h2d.ScaleModeAlign"]={__ename__:!0,__constructs__:null,Left:{_hx_name:"Left",_hx_index:0,__enum__:"h2d.ScaleModeAlign",toString:v},Right:{_hx_name:"Right",_hx_index:1,__enum__:"h2d.ScaleModeAlign",toString:v},Center:{_hx_name:"Center",_hx_index:2,__enum__:"h2d.ScaleModeAlign",toString:v},Top:{_hx_name:"Top",_hx_index:3,__enum__:"h2d.ScaleModeAlign",
toString:v},Bottom:{_hx_name:"Bottom",_hx_index:4,__enum__:"h2d.ScaleModeAlign",toString:v}};wc.__constructs__=[wc.Left,wc.Right,wc.Center,wc.Top,wc.Bottom];wc.__empty_constructs__=[wc.Left,wc.Right,wc.Center,wc.Top,wc.Bottom];var gd=K["h2d.ScaleMode"]={__ename__:!0,__constructs__:null,Resize:{_hx_name:"Resize",_hx_index:0,__enum__:"h2d.ScaleMode",toString:v},Stretch:(z=function(a,b){return{_hx_index:1,width:a,height:b,__enum__:"h2d.ScaleMode",toString:v}},z._hx_name="Stretch",z.__params__=["width",
"height"],z),LetterBox:(z=function(a,b,c,d,e){return{_hx_index:2,width:a,height:b,integerScale:c,horizontalAlign:d,verticalAlign:e,__enum__:"h2d.ScaleMode",toString:v}},z._hx_name="LetterBox",z.__params__=["width","height","integerScale","horizontalAlign","verticalAlign"],z),Fixed:(z=function(a,b,c,d,e){return{_hx_index:3,width:a,height:b,zoom:c,horizontalAlign:d,verticalAlign:e,__enum__:"h2d.ScaleMode",toString:v}},z._hx_name="Fixed",z.__params__=["width","height","zoom","horizontalAlign","verticalAlign"],
z),Zoom:(z=function(a){return{_hx_index:4,level:a,__enum__:"h2d.ScaleMode",toString:v}},z._hx_name="Zoom",z.__params__=["level"],z),AutoZoom:(z=function(a,b,c){return{_hx_index:5,minWidth:a,minHeight:b,integerScaling:c,__enum__:"h2d.ScaleMode",toString:v}},z._hx_name="AutoZoom",z.__params__=["minWidth","minHeight","integerScaling"],z)};gd.__constructs__=[gd.Resize,gd.Stretch,gd.LetterBox,gd.Fixed,gd.Zoom,gd.AutoZoom];gd.__empty_constructs__=[gd.Resize];var Rf=function(){};Rf.__name__="hxd.InteractiveScene";
Rf.__isInterface__=!0;Rf.prototype={__class__:Rf};var Od=function(){this.scaleMode=gd.Resize;Pc.call(this,null);var a=ja.CURRENT;this.ctx=new Qf(this);this._cameras=[];new Hh(this);this.set_interactiveCamera(this._cameras[0]);this.width=a.width;this.height=a.height;this.viewportA=2/a.width;this.viewportD=2/a.height;this.viewportY=this.viewportX=-1;this.viewportScaleY=this.viewportScaleX=1;this.offsetY=this.offsetX=0;this.interactive=[];this.eventListeners=[];this.shapePoint=new Da(0,0);this.window=
ic.getInstance();this.posChanged=!0};Od.__name__="h2d.Scene";Od.__interfaces__=[Rf,pe];Od.__super__=Pc;Od.prototype=D(Pc.prototype,{get_defaultSmooth:function(){return this.ctx.defaultSmooth},set_defaultSmooth:function(a){return this.ctx.defaultSmooth=a},setEvents:function(a){this.events=a},get_zoom:function(){var a=this.scaleMode;return 4==a._hx_index?a.level|0:0},set_zoom:function(a){this.set_scaleMode(gd.Zoom(a));return a},set_scaleMode:function(a){this.scaleMode=a;this.checkResize();return a},
get_renderer:function(){return this.ctx},set_renderer:function(a){return this.ctx=a},get_camera:function(){return this._cameras[0]},get_cameras:function(){return this._cameras},set_interactiveCamera:function(a){if(null==a)throw t.thrown("Interactive cammera cannot be null!");a.scene!=this&&this.addCamera(a);return this.interactiveCamera=a},addCamera:function(a,b){null!=a.scene&&a.scene.removeCamera(a);a.scene=this;a.posChanged=!0;null!=b?this._cameras.splice(b,0,a):this._cameras.push(a)},removeCamera:function(a){if(a==
this.interactiveCamera)throw t.thrown("Current interactive Camera cannot be removed from camera list!");a.scene=null;F.remove(this._cameras,a)},setFixedSize:function(a,b){this.set_scaleMode(gd.Stretch(a,b))},checkResize:function(){var a=ja.CURRENT;if(null!=a){var b=this.scaleMode;switch(b._hx_index){case 0:var c=a.width;a=a.height;if(c!=this.width||a!=this.height)this.width=c,this.height=a,this.posChanged=!0;this.viewportScaleY=this.viewportScaleX=1;this.viewportA=2/this.width;this.viewportD=2/this.height;
this.viewportY=this.viewportX=-1;break;case 1:var d=b.width,e=b.height;if(d!=this.width||e!=this.height)this.width=d,this.height=e,this.posChanged=!0;this.viewportScaleX=a.width/d;this.viewportScaleY=a.height/e;this.viewportA=2/this.width;this.viewportD=2/this.height;this.viewportY=this.viewportX=-1;break;case 2:d=b.width;e=b.height;c=b.integerScale;var f=b.horizontalAlign;b=b.verticalAlign;if(d!=this.width||e!=this.height)this.width=d,this.height=e,this.posChanged=!0;var g=a.width/d;e=a.height/e;
g=g>e?e:g;c&&(g|=0,0==g&&(g=1));c=f;f=b;this.viewportA=2*g/a.width;this.viewportD=2*g/a.height;this.viewportScaleY=this.viewportScaleX=g;null==c&&(c=wc.Center);switch(c._hx_index){case 0:this.viewportX=-1;this.offsetX=0;break;case 1:this.viewportX=1-this.width*this.viewportA;this.offsetX=a.width-this.width*g;break;default:this.viewportX=Math.floor((a.width-this.width*g)/(2*g))*this.viewportA-1,this.offsetX=Math.floor((a.width-this.width*g)/2)}null==f&&(f=wc.Center);switch(f._hx_index){case 3:this.viewportY=
-1;this.offsetY=0;break;case 4:this.viewportY=1-this.height*this.viewportD;this.offsetY=a.height-this.height*g;break;default:this.viewportY=Math.floor((a.height-this.height*g)/(2*g))*this.viewportD-1,this.offsetY=Math.floor((a.height-this.height*g)/2)}break;case 3:d=b.width;e=b.height;g=b.zoom;f=b.horizontalAlign;b=b.verticalAlign;if(d!=this.width||e!=this.height)this.width=d,this.height=e,this.posChanged=!0;c=f;f=b;this.viewportA=2*g/a.width;this.viewportD=2*g/a.height;this.viewportScaleY=this.viewportScaleX=
g;null==c&&(c=wc.Center);switch(c._hx_index){case 0:this.viewportX=-1;this.offsetX=0;break;case 1:this.viewportX=1-this.width*this.viewportA;this.offsetX=a.width-this.width*g;break;default:this.viewportX=Math.floor((a.width-this.width*g)/(2*g))*this.viewportA-1,this.offsetX=Math.floor((a.width-this.width*g)/2)}null==f&&(f=wc.Center);switch(f._hx_index){case 3:this.viewportY=-1;this.offsetY=0;break;case 4:this.viewportY=1-this.height*this.viewportD;this.offsetY=a.height-this.height*g;break;default:this.viewportY=
Math.floor((a.height-this.height*g)/(2*g))*this.viewportD-1,this.offsetY=Math.floor((a.height-this.height*g)/2)}break;case 4:g=b.level;c=Math.ceil(a.width/g);a=Math.ceil(a.height/g);if(c!=this.width||a!=this.height)this.width=c,this.height=a,this.posChanged=!0;this.viewportScaleY=this.viewportScaleX=g;this.viewportA=2/this.width;this.viewportD=2/this.height;this.viewportY=this.viewportX=-1;break;case 5:f=b.minHeight;c=b.integerScaling;g=a.width/b.minWidth;e=a.height/f;g=g>e?e:g;c&&(g|=0,0==g&&(g=
1));c=Math.ceil(a.width/g);a=Math.ceil(a.height/g);if(c!=this.width||a!=this.height)this.width=c,this.height=a,this.posChanged=!0;this.viewportScaleY=this.viewportScaleX=g;this.viewportA=2/this.width;this.viewportD=2/this.height;this.viewportY=this.viewportX=-1}}},screenXToViewport:function(a){var b=this.interactiveCamera;a=this.window.get_mouseX();var c=this.window.get_mouseY();return(((a-b.scene.offsetX)/b.scene.viewportScaleX-b.absX)*b.matD-((c-b.scene.offsetY)/b.scene.viewportScaleY-b.absY)*b.matC)*
b.invDet},screenYToViewport:function(a){var b=this.interactiveCamera,c=this.window.get_mouseX();a=this.window.get_mouseY();return(-((c-b.scene.offsetX)/b.scene.viewportScaleX-b.absX)*b.matB+((a-b.scene.offsetY)/b.scene.viewportScaleY-b.absY)*b.matA)*b.invDet},get_mouseX:function(){this.syncPos();this.window.get_mouseX();var a=this.interactiveCamera;var b=this.window.get_mouseX();var c=this.window.get_mouseY(),d=(((b-a.scene.offsetX)/a.scene.viewportScaleX-a.absX)*a.matD-((c-a.scene.offsetY)/a.scene.viewportScaleY-
a.absY)*a.matC)*a.invDet-this.absX;if(0==this.matC)return d/this.matA;this.window.get_mouseY();a=this.interactiveCamera;b=this.window.get_mouseX();c=this.window.get_mouseY();return(d*this.matD-((-((b-a.scene.offsetX)/a.scene.viewportScaleX-a.absX)*a.matB+((c-a.scene.offsetY)/a.scene.viewportScaleY-a.absY)*a.matA)*a.invDet-this.absY)*this.matC)/(this.matA*this.matD-this.matB*this.matC)},get_mouseY:function(){this.syncPos();this.window.get_mouseY();var a=this.interactiveCamera,b=this.window.get_mouseX();
var c=this.window.get_mouseY();var d=(-((b-a.scene.offsetX)/a.scene.viewportScaleX-a.absX)*a.matB+((c-a.scene.offsetY)/a.scene.viewportScaleY-a.absY)*a.matA)*a.invDet-this.absY;if(0==this.matB)return d/this.matD;this.window.get_mouseX();a=this.interactiveCamera;b=this.window.get_mouseX();c=this.window.get_mouseY();return(d*this.matA-((((b-a.scene.offsetX)/a.scene.viewportScaleX-a.absX)*a.matD-((c-a.scene.offsetY)/a.scene.viewportScaleY-a.absY)*a.matC)*a.invDet-this.absX)*this.matB)/(this.matA*this.matD-
this.matB*this.matC)},dispatchListeners:function(a){this.screenToViewport(a);for(var b=0,c=this.eventListeners;b<c.length;){var d=c[b];++b;d(a);if(!a.propagate)break}},isInteractiveVisible:function(a){for(;a!=this;){if(null==a||!a.visible)return!1;a=a.parent}return!0},getInteractive:function(a,b){for(var c=this.shapePoint,d=0,e=this.interactive;d<e.length;){var f=e[d];++d;f.posChanged&&f.syncPos();var g=a-f.absX,h=b-f.absY,k=(g*f.matD-h*f.matC)*f.invDet;h=(h*f.matA-g*f.matB)*f.invDet;if(null!=f.shape){if(g=
c,k+=f.shapeX,h+=f.shapeY,null==h&&(h=0),null==k&&(k=0),g.x=k,g.y=h,!f.shape.contains(c))continue}else if(0>h||0>k||k>=f.width||h>=f.height)continue;k=!0;for(g=f;null!=g;){if(!g.visible){k=!1;break}g=g.parent}if(k)return f}return null},screenToViewport:function(a){this.interactiveCamera.eventToCamera(a)},dispatchEvent:function(a,b){this.screenToViewport(a);var c=a.relX-b.absX,d=a.relY-b.absY,e=(d*b.matA-c*b.matB)*b.invDet;a.relX=(c*b.matD-d*b.matC)*b.invDet;a.relY=e;b.handleEvent(a)},handleEvent:function(a,
b){this.screenToViewport(a);var c=a.relX,d=a.relY;if(0>c||0>d||c>=this.width||d>=this.height)return null;var e=null==b?0:this.interactive.indexOf(b)+1;b=this.shapePoint;for(var f=this.interactive.length;e<f;){var g=e++;g=this.interactive[g];if(null==g)break;if(0!=g.invDet){var h=c-g.absX,k=d-g.absY,l=(h*g.matD-k*g.matC)*g.invDet;h=(k*g.matA-h*g.matB)*g.invDet;if(null!=g.shape){k=b;var m=l+g.shapeX,p=h+g.shapeY;null==p&&(p=0);null==m&&(m=0);k.x=m;k.y=p;if(!g.shape.contains(b))continue}else if(0>h||
0>l||l>=g.width||h>=g.height)continue;k=!0;for(m=g;null!=m;){if(!m.visible){k=!1;break}m=m.parent}if(k)if(a.relX=l,a.relY=h,g.handleEvent(a),a.cancel)a.cancel=!1,a.propagate=!1;else return g}}return null},addEventListener:function(a){this.eventListeners.push(a)},removeEventListener:function(a){for(var b=0,c=this.eventListeners;b<c.length;){var d=c[b];++b;if(d==a)return F.remove(this.eventListeners,d),!0}return!1},startCapture:function(a,b,c){var d=this;this.events.startCapture(function(b){d.screenToViewport(b);
a(b)},b,c)},stopCapture:function(){this.events.stopCapture()},startDrag:function(a,b,c){this.startCapture(a,b,null!=c?c.touchId:null)},stopDrag:function(){this.stopCapture()},getFocus:function(){if(null==this.events)return null;var a=this.events.getFocus();if(null==a)return null;a=a instanceof Of?a:null;return null==a?null:this.interactive[this.interactive.indexOf(a)]},addEventTarget:function(a){var b;var c=a;for(b=0;null!=c;)c=c.parent,++b;for(var d=b,e=0,f=this.interactive.length;e<f;){var g=e++;
c=a;var h=this.interactive[g],k=d,l=h;for(b=0;null!=l;)l=l.parent,++b;var m=b;l=c;for(b=h;k>m;)c=l,l=l.parent,--k;for(;m>k;)h=b,b=b.parent,--m;for(;l!=b;)c=l,l=l.parent,h=b,b=b.parent;k=-1;m=0;for(var p=l.children.length;m<p;){var r=m++;if(l.children[r]==c){k=r;break}}c=k;l=-1;k=0;for(m=b.children.length;k<m;)if(p=k++,b.children[p]==h){l=p;break}if(c>l){this.interactive.splice(g,0,a);return}}this.interactive.push(a)},removeEventTarget:function(a,b){null==b&&(b=!1);F.remove(this.interactive,a);if(b&&
null!=this.events)this.events.onRemove(a)},dispose:function(){if(this.allocated)this.onRemove();this.ctx.dispose()},setElapsedTime:function(a){this.ctx.elapsedTime=a},drawImplTo:function(a,b,c){for(var d=0;d<b.length;){var e=b[d];++d;if(0==(e.flags&1<<P.Target._hx_index))throw t.thrown("Can only draw to texture created with Target flag");}this.ctx.engine=ja.CURRENT;d=this.ctx.engine.backgroundColor;e=this.ctx.engine.inRender;this.ctx.engine.backgroundColor=null;this.ctx.globalAlpha=this.alpha;var f=
Qa.get();e?0==this.ctx.targetFlipY&&this.ctx.begin():(this.ctx.engine.begin(),this.ctx.begin());this.ctx.pushTargets(b);null!=c&&this.ctx.output.setOutput(c);a.drawRec(this.ctx);null!=c&&this.ctx.output.setOutput();this.ctx.popTarget();this.ctx.engine.backgroundColor=d;e||(this.ctx.end(),this.ctx.engine.end());null!=f&&f.setCurrent()},syncOnly:function(a){var b=ja.CURRENT;this.setElapsedTime(a);this.ctx.engine=b;this.ctx.frame++;this.ctx.time+=this.ctx.elapsedTime;this.ctx.globalAlpha=this.alpha;
this.sync(this.ctx)},render:function(a){this.ctx.engine=a;this.ctx.frame++;this.ctx.time+=this.ctx.elapsedTime;this.ctx.globalAlpha=this.alpha;this.mark("s2d");this.sync(this.ctx);0!=this.children.length&&(this.ctx.begin(),this.ctx.drawScene(),this.ctx.end());this.mark("vsync")},mark:function(a){},sync:function(a){var b=this.posChanged;if(!this.allocated)this.onAdd();Pc.prototype.sync.call(this,a);for(var c=0,d=this._cameras;c<d.length;){var e=d[c];++c;e.sync(a,b)}},clipBounds:function(a,b,c,d){null==
d&&(d=1);null==c&&(c=1);if(null!=a.inFilter){var e=a.baseShader.filterMatrixA__;var f=a.baseShader.filterMatrixB__;var g=this.matA*e.x+this.matB*e.y;var h=this.matA*f.x+this.matB*f.y;var k=this.matC*e.x+this.matD*e.y;var l=this.matC*f.x+this.matD*f.y;e=this.absX*e.x+this.absY*e.y+e.z;var m=this.absX*f.x+this.absY*f.y+f.z;f=(g*a.viewA+h*a.viewC)/c;g=(g*a.viewB+h*a.viewD)/d;c=(k*a.viewA+l*a.viewC)/c;d=(k*a.viewB+l*a.viewD)/d;k=e*a.viewA+m*a.viewC+a.viewX;a=e*a.viewB+m*a.viewD+a.viewY}else f=(this.matA*
a.viewA+this.matB*a.viewC)/c,g=(this.matA*a.viewB+this.matB*a.viewD)/d,c=(this.matC*a.viewA+this.matD*a.viewC)/c,d=(this.matC*a.viewB+this.matD*a.viewD)/d,k=this.absX*a.viewA+this.absY*a.viewC+a.viewX,a=this.absX*a.viewB+this.absY*a.viewD+a.viewY;e=1/(f*d-g*c);b.xMin=((-1-k)*d+(a+1)*c)*e;b.yMin=((k+1)*g+(-1-a)*f)*e;b.xMax=((1-k)*d+(a-1)*c)*e;b.yMax=((k-1)*g+(1-a)*f)*e},drawContent:function(a){var b;if(a.front2back){var c=0;for(b=this._cameras;c<b.length;){var d=b[c];++c;if(d.visible){var e=this.children.length;
var f=this.layerCount;for(d.enter(a);0<f--;){var g=0==f?0:this.layersIndexes[f-1];if(d.layerVisible(f))for(;e>=g;)this.children[e--].drawRec(a);else e=g-1}d.exit(a)}}this.draw(a)}else for(this.draw(a),c=0,b=this._cameras;c<b.length;)if(d=b[c],++c,d.visible){f=e=0;for(d.enter(a);f<this.layerCount;)if(g=this.layersIndexes[f++],d.layerVisible(f-1))for(;e<g;)this.children[e++].drawRec(a);else e=g;d.exit(a)}},onAdd:function(){this.checkResize();Pc.prototype.onAdd.call(this);this.window.addResizeEvent(M(this,
this.checkResize))},onRemove:function(){Pc.prototype.onRemove.call(this);this.window.removeResizeEvent(M(this,this.checkResize))},captureBitmap:function(a){var b=ja.CURRENT;if(null==a){var c=new W(this.width,this.height,[P.Target]);a=new rb(c,0,0,this.width,this.height)}c=a.innerTex;b.begin();b.pushTarget(c);b.setRenderZone(a.x|0,a.y|0,Math.ceil(a.width),Math.ceil(a.height));var d=this.width,e=this.height,f=this.viewportA,g=this.viewportD,h=this.viewportX,k=this.viewportY;this.width=c.width;this.height=
c.height;this.viewportA=2/this.width;this.viewportD=2/this.height;this.viewportY=this.viewportX=-1;this.posChanged=!0;this.render(b);b.popTarget();this.width=d;this.height=e;this.viewportA=f;this.viewportD=g;this.viewportX=h;this.viewportY=k;this.posChanged=!0;b.setRenderZone();b.end();return new zg(a)},__class__:Od});var rb=function(a,b,c,d,e,f,g){null==g&&(g=0);null==f&&(f=0);this.innerTex=a;this.x=b;this.y=c;this.width=d;this.height=e;this.dx=f;this.dy=g;null!=a&&this.setTexture(a)};rb.__name__=
"h2d.Tile";rb.fromColor=function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=1);a=new rb(W.fromColor(a,d),0,0,1,1);a.width=b;a.height=c;return a};rb.fromBitmap=function(a){var b=W.fromBitmap(a);return new rb(b,0,0,a.ctx.canvas.width,a.ctx.canvas.height)};rb.autoCut=function(a,b,c){a.lock();null==c&&(c=b);for(var d=a.getPixel(a.ctx.canvas.width-1,a.ctx.canvas.height-1),e=[],f=1,g=1;f<a.ctx.canvas.width;)f<<=1;for(;g<a.ctx.canvas.height;)g<<=1;f=new W(f,g);g=0;for(var h=a.ctx.canvas.height/c|
0;g<h;){var k=g++,l=[];e[k]=l;for(var m=0,p=a.ctx.canvas.width/b|0;m<p;){var r=m++,n=rb.isEmpty(a,r*b,k*c,b,c,d);if(null==n)break;l.push(new rb(f,r*b+n.dx,k*c+n.dy,n.w,n.h,n.dx,n.dy))}}a.unlock();b=new rb(f,0,0,a.ctx.canvas.width,a.ctx.canvas.height);b.upload(a);return{main:b,tiles:e}};rb.fromTexture=function(a){return new rb(a,0,0,a.width,a.height)};rb.fromPixels=function(a){var b=a.makeSquare(!0),c=W.fromPixels(b,W.nativeFormat);b!=a&&b.dispose();return new rb(c,0,0,a.width,a.height)};rb.isEmpty=
function(a,b,c,d,e,f){for(var g=!0,h=d,k=e,l=0,m=0,p=0;p<d;)for(var r=p++,n=0,u=e;n<u;){var w=n++,I=a.getPixel(r+b,w+c);0==(I&-16777216)?0!=I&&a.setPixel(r+b,w+c,0):(I!=f&&(g=!1,r<h&&(h=r),w<k&&(k=w),r>l&&(l=r),w>m&&(m=w)),I==f&&0!=I&&a.setPixel(r+b,w+c,0))}return g?null:{dx:h,dy:k,w:l-h+1,h:m-k+1}};rb.prototype={get_ix:function(){return Math.floor(this.x)},get_iy:function(){return Math.floor(this.y)},get_iwidth:function(){return Math.ceil(this.width+this.x)-Math.floor(this.x)},get_iheight:function(){return Math.ceil(this.height+
this.y)-Math.floor(this.y)},getTexture:function(){return this.innerTex},isDisposed:function(){if(null!=this.innerTex){var a=this.innerTex;return null==a.t?a.isDepth()?!0:null==a.realloc:!1}return!0},setTexture:function(a){this.innerTex=a;null!=a&&(this.u=this.x/a.width,this.v=this.y/a.height,this.u2=(this.x+this.width)/a.width,this.v2=(this.y+this.height)/a.height)},switchTexture:function(a){this.setTexture(a.innerTex)},sub:function(a,b,c,d,e,f){null==f&&(f=0);null==e&&(e=0);return new rb(this.innerTex,
this.x+a,this.y+b,c,d,e,f)},center:function(){return this.sub(0,0,this.width,this.height,-(.5*this.width),-(.5*this.height))},setCenterRatio:function(a,b){null==b&&(b=.5);null==a&&(a=.5);this.dx=-(a*this.width);this.dy=-(b*this.height)},flipX:function(){var a=this.u;this.u=this.u2;this.u2=a;this.dx=-this.dx-this.width},flipY:function(){var a=this.v;this.v=this.v2;this.v2=a;this.dy=-this.dy-this.height},setPosition:function(a,b){this.x=a;this.y=b;var c=this.innerTex;null!=c&&(this.u=a/c.width,this.v=
b/c.height,this.u2=(a+this.width)/c.width,this.v2=(b+this.height)/c.height)},setSize:function(a,b){this.width=a;this.height=b;var c=this.innerTex;null!=c&&(this.u2=(this.x+a)/c.width,this.v2=(this.y+b)/c.height)},scaleToSize:function(a,b){this.width=a;this.height=b},scrollDiscrete:function(a,b){var c=this.innerTex;this.u+=a/c.width;this.v-=b/c.height;this.u2+=a/c.width;this.v2-=b/c.height;this.x=this.u*c.width;this.y=this.v*c.height},dispose:function(){null!=this.innerTex&&this.innerTex.dispose();
this.innerTex=null},clone:function(){var a=new rb(null,this.x,this.y,this.width,this.height,this.dx,this.dy);a.innerTex=this.innerTex;a.u=this.u;a.u2=this.u2;a.v=this.v;a.v2=this.v2;return a},get_xFlip:function(){return this.u2<this.u},get_yFlip:function(){return this.v2<this.v},set_xFlip:function(a){a!=this.get_xFlip()&&this.flipX();return a},set_yFlip:function(a){a!=this.get_yFlip()&&this.flipY();return a},split:function(a,b,c){var d;null==c&&(c=!1);null==b&&(b=!1);null==a&&(a=0);var e=[];if(b)for(0==
a&&(a=this.height/this.width|0),c=c?this.height/a:this.height/a|0,b=0,d=a;b<d;)a=b++,e.push(this.sub(0,a*c,this.width,c));else for(0==a&&(a=this.width/this.height|0),c=c?this.width/a:this.width/a|0,b=0,d=a;b<d;)a=b++,e.push(this.sub(a*c,0,c,this.height));return e},gridFlatten:function(a,b,c){null==c&&(c=0);null==b&&(b=0);for(var d=[],e=0,f=this.height/a|0;e<f;)for(var g=e++,h=0,k=this.width/a|0;h<k;){var l=h++;d.push(this.sub(l*a,g*a,a,a,b,c))}return d},grid:function(a,b,c){null==c&&(c=0);null==b&&
(b=0);for(var d=[],e=0,f=this.width/a|0;e<f;){for(var g=e++,h=[],k=0,l=this.height/a|0;k<l;){var m=k++;h.push(this.sub(g*a,m*a,a,a,b,c))}d.push(h)}return d},toString:function(){return"Tile("+this.x+","+this.y+","+this.width+"x"+this.height+(0!=this.dx||0!=this.dy?","+this.dx+":"+this.dy:"")+")"},upload:function(a){this.innerTex.uploadBitmap(a)},__class__:rb};var se=function(){};se.__name__="h2d.col.Collider";se.prototype={__class__:se};var Db=function(){this.yMin=this.xMin=1E20;this.yMax=this.xMax=
-1E20};Db.__name__="h2d.col.Bounds";Db.fromValues=function(a,b,c,d){var e=new Db;e.xMin=a;e.yMin=b;e.xMax=a+c;e.yMax=b+d;return e};Db.fromPoints=function(a,b){var c=new Db;c.xMin=a.x;c.yMin=a.y;c.xMax=b.x;c.yMax=b.y;return c};Db.__super__=se;Db.prototype=D(se.prototype,{toIBounds:function(a){null==a&&(a=1);var b=Math.floor(this.xMin*a),c=Math.floor(this.yMin*a),d=Math.ceil(this.xMax*a)-b;a=Math.ceil(this.yMax*a)-c;var e=new xd;e.xMin=b;e.yMin=c;e.xMax=b+d;e.yMax=c+a;return e},intersects:function(a){return!(this.xMin>
a.xMax||this.yMin>a.yMax||this.xMax<a.xMin||this.yMax<a.yMin)},collideBounds:function(a){return!(this.xMin>a.xMax||this.yMin>a.yMax||this.xMax<a.xMin||this.yMax<a.yMin)},collideCircle:function(a){if(a.x<this.xMin-a.ray||a.x>this.xMax+a.ray||a.y<this.yMin-a.ray||a.y>this.yMax+a.ray)return!1;if(a.x<this.xMin&&a.y<this.yMin){var b=a.x-this.xMin;var c=a.y-this.yMin;c=b*b+c*c>a.ray*a.ray}else c=!1;if(c)return!1;a.x>this.xMax&&a.y<this.yMin?(b=a.x-this.xMax,c=a.y-this.yMin,c=b*b+c*c>a.ray*a.ray):c=!1;if(c)return!1;
a.x<this.xMin&&a.y>this.yMax?(b=a.x-this.xMin,c=a.y-this.yMax,c=b*b+c*c>a.ray*a.ray):c=!1;if(c)return!1;a.x>this.xMax&&a.y>this.yMax?(b=a.x-this.xMax,c=a.y-this.yMax,c=b*b+c*c>a.ray*a.ray):c=!1;return c?!1:!0},contains:function(a){return a.x>=this.xMin&&a.x<this.xMax&&a.y>=this.yMin?a.y<this.yMax:!1},rayIntersection:function(a){var b=(this.xMin-a.px)/a.lx,c=(this.yMin-a.py)/a.ly,d=(this.xMax-a.px)/a.lx,e=(this.yMax-a.py)/a.ly;a=b>d?d:b;var f=c>e?e:c;b=b<d?d:b;c=c<e?e:c;a=a<f?f:a;return(b>c?c:b)<a?
-1:a},distanceSq:function(a){var b=a.x<this.xMin?this.xMin-a.x:a.x>this.xMax?a.x-this.xMax:0;a=a.y<this.yMin?this.yMin-a.y:a.y>this.yMax?a.y-this.yMax:0;return b*b+a*a},distance:function(a){var b=a.x<this.xMin?this.xMin-a.x:a.x>this.xMax?a.x-this.xMax:0;a=a.y<this.yMin?this.yMin-a.y:a.y>this.yMax?a.y-this.yMax:0;return Math.sqrt(b*b+a*a)},addBounds:function(a){a.xMin<this.xMin&&(this.xMin=a.xMin);a.xMax>this.xMax&&(this.xMax=a.xMax);a.yMin<this.yMin&&(this.yMin=a.yMin);a.yMax>this.yMax&&(this.yMax=
a.yMax)},addPoint:function(a){a.x<this.xMin&&(this.xMin=a.x);a.x>this.xMax&&(this.xMax=a.x);a.y<this.yMin&&(this.yMin=a.y);a.y>this.yMax&&(this.yMax=a.y)},addPos:function(a,b){a<this.xMin&&(this.xMin=a);a>this.xMax&&(this.xMax=a);b<this.yMin&&(this.yMin=b);b>this.yMax&&(this.yMax=b)},set:function(a,b,c,d){this.xMin=a;this.yMin=b;this.xMax=a+c;this.yMax=b+d},setMin:function(a){this.xMin=a.x;this.yMin=a.y},setMax:function(a){this.xMax=a.x;this.yMax=a.y},doIntersect:function(a){var b=this.xMin,c=a.xMin;
this.xMin=b<c?c:b;b=this.yMin;c=a.yMin;this.yMin=b<c?c:b;b=this.xMax;c=a.xMax;this.xMax=b>c?c:b;b=this.yMax;c=a.yMax;this.yMax=b>c?c:b},doUnion:function(a){var b=this.xMin,c=a.xMin;this.xMin=b>c?c:b;b=this.yMin;c=a.yMin;this.yMin=b>c?c:b;b=this.xMax;c=a.xMax;this.xMax=b<c?c:b;b=this.yMax;c=a.yMax;this.yMax=b<c?c:b},intersection:function(a){var b=new Db,c=this.xMin,d=a.xMin;b.xMin=c<d?d:c;c=this.yMin;d=a.yMin;b.yMin=c<d?d:c;c=this.xMax;d=a.xMax;b.xMax=c>d?d:c;c=this.yMax;d=a.yMax;b.yMax=c>d?d:c;b.xMax<
b.xMin&&(b.xMax=b.xMin);b.yMax<b.yMin&&(b.yMax=b.yMin);return b},union:function(a){var b=new Db,c=this.xMin,d=a.xMin;b.xMin=c>d?d:c;c=this.yMin;d=a.yMin;b.yMin=c>d?d:c;c=this.xMax;d=a.xMax;b.xMax=c<d?d:c;c=this.yMax;d=a.yMax;b.yMax=c<d?d:c;return b},load:function(a){this.xMin=a.xMin;this.yMin=a.yMin;this.xMax=a.xMax;this.yMax=a.yMax},scalePivot:function(a){this.xMin*=a;this.yMin*=a;this.xMax*=a;this.yMax*=a},scaleCenter:function(a){var b=.5*(this.xMax-this.xMin)*a;a*=.5*(this.yMax-this.yMin);var c=
.5*(this.xMax+this.xMin),d=.5*(this.yMax+this.yMin);this.xMin=c-b;this.yMin=d-a;this.xMax=c+b;this.yMax=d+a},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.xMin,d=this.yMin,e=this.xMax,f=this.yMax;this.yMin=this.xMin=1E20;this.yMax=this.xMax=-1E20;var g=c*b-d*a,h=c*a+d*b;g<this.xMin&&(this.xMin=g);g>this.xMax&&(this.xMax=g);h<this.yMin&&(this.yMin=h);h>this.yMax&&(this.yMax=h);g=e*b-d*a;h=e*a+d*b;g<this.xMin&&(this.xMin=g);g>this.xMax&&(this.xMax=g);h<this.yMin&&(this.yMin=h);h>this.yMax&&
(this.yMax=h);g=c*b-f*a;h=c*a+f*b;g<this.xMin&&(this.xMin=g);g>this.xMax&&(this.xMax=g);h<this.yMin&&(this.yMin=h);h>this.yMax&&(this.yMax=h);g=e*b-f*a;h=e*a+f*b;g<this.xMin&&(this.xMin=g);g>this.xMax&&(this.xMax=g);h<this.yMin&&(this.yMin=h);h>this.yMax&&(this.yMax=h)},offset:function(a,b){this.xMin+=a;this.xMax+=a;this.yMin+=b;this.yMax+=b},getMin:function(){var a=this.xMin,b=this.yMin;null==b&&(b=0);null==a&&(a=0);return new Da(a,b)},getCenter:function(){var a=.5*(this.xMin+this.xMax),b=.5*(this.yMin+
this.yMax);null==b&&(b=0);null==a&&(a=0);return new Da(a,b)},getSize:function(){var a=this.xMax-this.xMin,b=this.yMax-this.yMin;null==b&&(b=0);null==a&&(a=0);return new Da(a,b)},getMax:function(){var a=this.xMax,b=this.yMax;null==b&&(b=0);null==a&&(a=0);return new Da(a,b)},isEmpty:function(){return this.xMax<=this.xMin?!0:this.yMax<=this.yMin},empty:function(){this.yMin=this.xMin=1E20;this.yMax=this.xMax=-1E20},all:function(){this.yMin=this.xMin=-1E20;this.yMax=this.xMax=1E20},clone:function(){var a=
new Db;a.xMin=this.xMin;a.yMin=this.yMin;a.xMax=this.xMax;a.yMax=this.yMax;return a},get_x:function(){return this.xMin},get_y:function(){return this.yMin},set_x:function(a){this.xMax+=a-this.xMin;return this.xMin=a},set_y:function(a){this.yMax+=a-this.yMin;return this.yMin=a},get_width:function(){return this.xMax-this.xMin},get_height:function(){return this.yMax-this.yMin},set_width:function(a){this.xMax=this.xMin+a;return a},set_height:function(a){this.yMax=this.yMin+a;return a},toString:function(){var a=
this.xMin,b=this.yMin;null==b&&(b=0);null==a&&(a=0);var c="{"+y.string(new Da(a,b))+",";a=this.xMax-this.xMin;b=this.yMax-this.yMin;null==b&&(b=0);null==a&&(a=0);return c+y.string(new Da(a,b))+"}"},toCircle:function(){var a=this.xMax-this.xMin,b=this.yMax-this.yMin;return new Dg(.5*(this.xMin+this.xMax),.5*(this.yMin+this.yMax),.5*Math.sqrt(a*a+b*b))},__class__:Db});var Dg=function(a,b,c){this.x=a;this.y=b;this.ray=c};Dg.__name__="h2d.col.Circle";Dg.__super__=se;Dg.prototype=D(se.prototype,{distanceSq:function(a){var b=
a.x-this.x;a=a.y-this.y;b=b*b+a*a-this.ray*this.ray;return 0>b?0:b},side:function(a){var b=a.x-this.x;a=a.y-this.y;return this.ray*this.ray-(b*b+a*a)},collideCircle:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c<(this.ray+a.ray)*(this.ray+a.ray)},collideBounds:function(a){if(this.x<a.xMin-this.ray||this.x>a.xMax+this.ray||this.y<a.yMin-this.ray||this.y>a.yMax+this.ray)return!1;if(this.x<a.xMin&&this.y<a.yMin){var b=this.x-a.xMin;var c=this.y-a.yMin;c=b*b+c*c>this.ray*this.ray}else c=!1;
if(c)return!1;this.x>a.xMax&&this.y<a.yMin?(b=this.x-a.xMax,c=this.y-a.yMin,c=b*b+c*c>this.ray*this.ray):c=!1;if(c)return!1;this.x<a.xMin&&this.y>a.yMax?(b=this.x-a.xMin,c=this.y-a.yMax,c=b*b+c*c>this.ray*this.ray):c=!1;if(c)return!1;this.x>a.xMax&&this.y>a.yMax?(b=this.x-a.xMax,c=this.y-a.yMax,c=b*b+c*c>this.ray*this.ray):c=!1;return c?!1:!0},lineIntersect:function(a,b){var c=b.x-a.x;b=b.y-a.y;var d=c*c+b*b;if(1E-8>d)return null;var e=2*(c*(a.x-this.x)+b*(a.y-this.y));var f=a.x-this.x;var g=a.y-
this.y;g=e*e-4*d*(f*f+g*g-this.ray*this.ray);if(0>g)return null;if(0==g)return e=-e/(2*d),d=a.x+e*c,f=a.y+e*b,null==f&&(f=0),null==d&&(d=0),[new Da(d,f)];f=(-e-Math.sqrt(g))/(2*d);e=(-e+Math.sqrt(g))/(2*d);d=a.x+f*c;f=a.y+f*b;null==f&&(f=0);null==d&&(d=0);g=new Da(d,f);d=a.x+e*c;f=a.y+e*b;null==f&&(f=0);null==d&&(d=0);return[g,new Da(d,f)]},toString:function(){return"{"+T.fmt(this.x)+","+T.fmt(this.y)+","+T.fmt(this.ray)+"}"},contains:function(a){var b=a.x-this.x;a=a.y-this.y;b=b*b+a*a-this.ray*this.ray;
return 0==(0>b?0:b)},__class__:Dg});var xd=function(){this.yMin=this.xMin=2147483647;this.yMax=this.xMax=-2147483648};xd.__name__="h2d.col.IBounds";xd.fromValues=function(a,b,c,d){var e=new xd;e.xMin=a;e.yMin=b;e.xMax=a+c;e.yMax=b+d;return e};xd.fromPoints=function(a,b){var c=new xd;c.xMin=a.x;c.yMin=a.y;c.xMax=b.x;c.yMax=b.y;return c};xd.prototype={toBounds:function(a){null==a&&(a=1);var b=this.xMin*a,c=this.yMin*a,d=(this.xMax-this.xMin)*a;a*=this.yMax-this.yMin;var e=new Db;e.xMin=b;e.yMin=c;e.xMax=
b+d;e.yMax=c+a;return e},intersects:function(a){return!(this.xMin>a.xMax||this.yMin>a.yMax||this.xMax<a.xMin||this.yMax<a.yMin)},contains:function(a){return a.x>=this.xMin&&a.x<this.xMax&&a.y>=this.yMin?a.y<this.yMax:!1},addBounds:function(a){a.xMin<this.xMin&&(this.xMin=a.xMin);a.xMax>this.xMax&&(this.xMax=a.xMax);a.yMin<this.yMin&&(this.yMin=a.yMin);a.yMax>this.yMax&&(this.yMax=a.yMax)},addPoint:function(a){a.x<this.xMin&&(this.xMin=a.x);a.x>this.xMax&&(this.xMax=a.x);a.y<this.yMin&&(this.yMin=
a.y);a.y>this.yMax&&(this.yMax=a.y)},addPos:function(a,b){a<this.xMin&&(this.xMin=a);a>this.xMax&&(this.xMax=a);b<this.yMin&&(this.yMin=b);b>this.yMax&&(this.yMax=b)},set:function(a,b,c,d){this.xMin=a;this.yMin=b;this.xMax=a+c;this.yMax=b+d},setMin:function(a){this.xMin=a.x;this.yMin=a.y},setMax:function(a){this.xMax=a.x;this.yMax=a.y},doIntersect:function(a){var b=this.xMin,c=a.xMin;this.xMin=b<c?c:b;b=this.yMin;c=a.yMin;this.yMin=b<c?c:b;b=this.xMax;c=a.xMax;this.xMax=b>c?c:b;b=this.yMax;c=a.yMax;
this.yMax=b>c?c:b},doUnion:function(a){var b=this.xMin,c=a.xMin;this.xMin=b>c?c:b;b=this.yMin;c=a.yMin;this.yMin=b>c?c:b;b=this.xMax;c=a.xMax;this.xMax=b<c?c:b;b=this.yMax;c=a.yMax;this.yMax=b<c?c:b},intersection:function(a){var b=new xd,c=this.xMin,d=a.xMin;b.xMin=c<d?d:c;c=this.yMin;d=a.yMin;b.yMin=c<d?d:c;c=this.xMax;d=a.xMax;b.xMax=c>d?d:c;c=this.yMax;d=a.yMax;b.yMax=c>d?d:c;b.xMax<b.xMin&&(b.xMax=b.xMin);b.yMax<b.yMin&&(b.yMax=b.yMin);return b},union:function(a){var b=new xd,c=this.xMin,d=a.xMin;
b.xMin=c>d?d:c;c=this.yMin;d=a.yMin;b.yMin=c>d?d:c;c=this.xMax;d=a.xMax;b.xMax=c<d?d:c;c=this.yMax;d=a.yMax;b.yMax=c<d?d:c;return b},load:function(a){this.xMin=a.xMin;this.yMin=a.yMin;this.xMax=a.xMax;this.yMax=a.yMax},offset:function(a,b){this.xMin+=a;this.xMax+=a;this.yMin+=b;this.yMax+=b},getMin:function(){return new V(this.xMin,this.yMin)},getCenter:function(){return new V(this.xMin+this.xMax>>1,this.yMin+this.yMax>>1)},getSize:function(){return new V(this.xMax-this.xMin,this.yMax-this.yMin)},
getMax:function(){return new V(this.xMax,this.yMax)},isEmpty:function(){return this.xMax>this.xMin?this.yMax<=this.yMin:!0},empty:function(){this.yMin=this.xMin=2147483647;this.yMax=this.xMax=-2147483648},all:function(){this.yMin=this.xMin=-2147483648;this.yMax=this.xMax=2147483647},clone:function(){var a=new xd;a.xMin=this.xMin;a.yMin=this.yMin;a.xMax=this.xMax;a.yMax=this.yMax;return a},get_x:function(){return this.xMin},get_y:function(){return this.yMin},set_x:function(a){this.xMax+=a-this.xMin;
return this.xMin=a},set_y:function(a){this.yMax+=a-this.yMin;return this.yMin=a},get_width:function(){return this.xMax-this.xMin},get_height:function(){return this.yMax-this.yMin},set_width:function(a){this.xMax=this.xMin+a;return a},set_height:function(a){this.yMax=this.yMin+a;return a},toString:function(){return"{"+y.string(new V(this.xMin,this.yMin))+","+y.string(new V(this.xMax-this.xMin,this.yMax-this.yMin))+"}"},__class__:xd};var V=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=
b};V.__name__="h2d.col.IPoint";V.prototype={load:function(a){this.x=a.x;this.y=a.y},scale:function(a){this.x*=a;this.y*=a},scaled:function(a){return new V(this.x*a,this.y*a)},distanceSq:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},distance:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},toString:function(){return"{"+this.x+","+this.y+"}"},sub:function(a){return new V(this.x-a.x,this.y-a.y)},add:function(a){return new V(this.x+a.x,this.y+a.y)},equals:function(a){return this.x==
a.x?this.y==a.y:!1},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},set:function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b},clone:function(){return new V(this.x,this.y)},cross:function(a){return this.x*a.y-this.y*a.x},toPoint:function(a){null==a&&(a=1);var b=this.x*a;a*=this.y;null==a&&(a=0);null==b&&(b=0);return new Da(b,a)},__class__:V};var Xe=K["h2d.col.OffsetKind"]=
{__ename__:!0,__constructs__:null,Square:{_hx_name:"Square",_hx_index:0,__enum__:"h2d.col.OffsetKind",toString:v},Miter:{_hx_name:"Miter",_hx_index:1,__enum__:"h2d.col.OffsetKind",toString:v},Round:(z=function(a){return{_hx_index:2,arc:a,__enum__:"h2d.col.OffsetKind",toString:v}},z._hx_name="Round",z.__params__=["arc"],z)};Xe.__constructs__=[Xe.Square,Xe.Miter,Xe.Round];Xe.__empty_constructs__=[Xe.Square,Xe.Miter];var hd={get_length:function(a){return a.length},get_points:function(a){return a},_new:function(a){return null==
a?[]:a},iterator:function(a){return new Jh(a)},toPolygon:function(a,b){null==b&&(b=1);for(var c=[],d=0;d<a.length;){var e=a[d];++d;var f=b;null==f&&(f=1);var g=e.x*f;e=e.y*f;null==e&&(e=0);null==g&&(g=0);c.push(new Da(g,e))}return c},getBounds:function(a,b){null==b&&(b=new xd);for(var c=0;c<a.length;){var d=a[c];++c;d.x<b.xMin&&(b.xMin=d.x);d.x>b.xMax&&(b.xMax=d.x);d.y<b.yMin&&(b.yMin=d.y);d.y>b.yMax&&(b.yMax=d.y)}return b},union:function(a,b,c){null==c&&(c=!0);var d=new pb;c||(d.resultKind=sc.NoHoles);
d.addPolygon(a,Wa.Clip);d.addPolygon(b,Wa.Clip);return d.execute(Lb.Union,wa.NonZero,wa.NonZero)},intersection:function(a,b,c){null==c&&(c=!0);return hd.clipperOp(a,b,Lb.Intersection,c)},subtraction:function(a,b,c){null==c&&(c=!0);return hd.clipperOp(a,b,Lb.Difference,c)},offset:function(a,b,c,d){null==d&&(d=!0);var e=new Kh;switch(c._hx_index){case 0:e.addPolygon(a,id.Square,Xa.ClosedPol);break;case 1:e.addPolygon(a,id.Miter,Xa.ClosedPol);break;case 2:e.ArcTolerance=c.arc,e.addPolygon(a,id.Round,
Xa.ClosedPol)}d||(e.resultKind=sc.NoHoles);return e.execute(b)},clipperOp:function(a,b,c,d){var e=new pb;d||(e.resultKind=sc.NoHoles);e.addPolygon(a,Wa.Subject);e.addPolygon(b,Wa.Clip);return e.execute(c,wa.NonZero,wa.NonZero)},convexHull:function(a){var b,c=a.length;if(3>c)throw t.thrown("convexHull() needs at least 3 points");var d=0,e=a[d].x;var f=1;for(b=a.length;f<b;){var g=f++;var h=a[g].x;h<e&&(d=g,e=h)}e=[];h=d;do{e.push(a[h]);var k=(h+1)%c;f=0;for(b=c;f<b;){g=f++;var l=a[g],m=a[h],p=a[k];
0>(m.x-l.x)*(p.y-l.y)-(m.y-l.y)*(p.x-l.x)&&(k=g)}h=k}while(h!=d);return e},isClockwise:function(a){for(var b=0,c=a[a.length-1],d=0;d<a.length;){var e=a[d];++d;b+=(e.x-c.x)*(e.y+c.y);c=e}return 0>b},area:function(a){for(var b=0,c=a[a.length-1],d=0;d<a.length;){var e=a[d];++d;b+=c.x*e.y-e.x*c.y;c=e}return.5*(0>b?-b:b)},side:function(a,b,c,d){return(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x)},isConvex:function(a){for(var b=a[a.length-2],c=a[a.length-1],d=a[0],e=0<(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x),
f=1,g=a.length;f<g;){var h=f++;b=c;c=d;d=a[h];if(0<(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x)!=e)return!1}return!0},reverse:function(a){a.reverse()},contains:function(a,b,c){var d;null==c&&(c=!1);if(c){var e=a[a.length-1];c=0;for(d=a;c<d.length;){a=d[c];++c;if(0>(a.x-e.x)*(b.y-e.y)-(a.y-e.y)*(b.x-e.x))return!1;e=a}return!0}var f=0;e=a[a.length-1];c=0;for(d=a;c<d.length;)a=d[c],++c,a.y<=b.y?e.y>b.y&&0<(e.x-a.x)*(b.y-a.y)-(e.y-a.y)*(b.x-a.x)&&++f:e.y<=b.y&&0>(e.x-a.x)*(b.y-a.y)-(e.y-a.y)*(b.x-a.x)&&--f,
e=a;return 0!=f},optimize:function(a,b){var c=[];hd.optimizeRec(a,0,a.length,c,b);return c},optimizeRec:function(a,b,c,d,e){for(var f=0,g=a[b],h=a[c-1],k=b+1,l=c-1;k<l;){var m=k++,p=a[m],r=h.x-g.x,n=h.y-g.y,u=(p.x-g.x)*r+(p.y-g.y)*n,w=r*r+n*n,I=-1;0!=w&&(I=u/w);0>I?(r=g.x,n=g.y):1<I?(r=h.x,n=h.y):(r=g.x+I*r,n=g.y+I*n);I=p.x-r;p=p.y-n;p=I*I+p*p;p>f&&(b=m,f=p)}f>=e?(hd.optimizeRec(a,0,b,d,e),d.pop(),hd.optimizeRec(a,b,c,d,e)):(d.push(a[b]),d.push(a[c-1]))}},Nc=function(){this.a=1;this.c=this.b=0;this.d=
1;this.y=this.x=0};Nc.__name__="h2d.col.Matrix";Nc.prototype={identity:function(){this.a=1;this.c=this.b=0;this.d=1;this.y=this.x=0},initTranslate:function(a,b){this.a=1;this.c=this.b=0;this.d=1;this.x=a;this.y=b},initScale:function(a,b){this.a=a;this.c=this.b=0;this.d=b;this.y=this.x=0},initRotate:function(a){var b=Math.cos(a);a=Math.sin(a);this.a=b;this.b=a;this.c=-a;this.d=b;this.y=this.x=0},initSkew:function(a,b){a=Math.tan(a);b=Math.tan(b);this.a=1;this.b=b;this.c=a;this.d=1;this.y=this.x=0},
invert:function(){this.inverse(this)},getDeterminant:function(){return this.a*this.d-this.b*this.c},inverse:function(a){var b=a.a,c=a.b,d=a.c,e=a.d,f=a.x,g=a.y;a=1/(a.a*a.d-a.b*a.c);this.a=e*a;this.b=-c*a;this.c=-d*a;this.d=b*a;this.x=(-f*e+d*g)*a;this.y=(f*c-b*g)*a},transform:function(a){var b=a.x*this.a+a.y*this.c+this.x;a=a.x*this.b+a.y*this.d+this.y;null==a&&(a=0);null==b&&(b=0);return new Da(b,a)},translate:function(a,b){this.x+=a;this.y+=b},translateX:function(a){this.x+=a},translateY:function(a){this.y+=
a},prependTranslate:function(a,b){this.x+=this.a*a+this.c*b;this.y+=this.b*a+this.d*b},prependTranslateX:function(a){this.x+=this.a*a},prependTranslateY:function(a){this.y+=this.d*a},multiply:function(a,b){var c=a.a,d=a.b,e=a.c,f=a.d,g=a.x;a=a.y;var h=b.a,k=b.b,l=b.c,m=b.d,p=b.x;b=b.y;this.a=c*h+d*l;this.b=c*k+d*m;this.c=e*h+f*l;this.d=e*k+f*m;this.x=g*h+a*l+p;this.y=g*k+a*m+b},getScale:function(){var a=new Da(0,0);a.x=Math.sqrt(this.a*this.a+this.b*this.b);a.y=Math.sqrt(this.c*this.c+this.d*this.d);
0>this.a*this.d-this.b*this.c&&(a.x*=-1,a.y*=-1);return a},scale:function(a,b){this.a*=a;this.c*=a;this.x*=a;this.b*=b;this.d*=b;this.y*=b},scaleX:function(a){this.a*=a;this.c*=a;this.x*=a},scaleY:function(a){this.b*=a;this.d*=a;this.y*=a},rotate:function(a){var b=Nc.tmp,c=Math.cos(a);a=Math.sin(a);b.a=c;b.b=a;b.c=-a;b.d=c;b.x=0;b.y=0;this.multiply(this,Nc.tmp)},skew:function(a,b){var c=this.a,d=this.b,e=this.c,f=this.d,g=this.x,h=this.y;b=Math.tan(b);a=Math.tan(a);this.a=c+d*a;this.b=c*b+d;this.c=
e+f*a;this.d=e*b+f;this.x=g+h*a;this.y=g*b+h},skewX:function(a){a=Math.tan(a);this.a+=this.b*a;this.c+=this.d*a;this.x+=this.y*a},skewY:function(a){a=Math.tan(a);this.b=this.a*a+this.b;this.d=this.c*a+this.d;this.y=this.x*a+this.y},clone:function(){var a=new Nc;a.a=this.a;a.b=this.b;a.c=this.c;a.d=this.d;a.x=this.x;a.y=this.y;return a},getPosition:function(a){null==a&&(a=new Da(0,0));var b=a,c=this.x,d=this.y;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;return a},toString:function(){return"MAT=[\n  [ "+
T.fmt(this.a)+", "+T.fmt(this.b)+" ]\n  [ "+T.fmt(this.c)+", "+T.fmt(this.d)+" ]\n  [ "+T.fmt(this.x)+", "+T.fmt(this.y)+" ]\n]"},__class__:Nc};var yd={get_length:function(a){return a.length},get_points:function(a){return a},_new:function(a){return null==a?[]:a},iterator:function(a){return new Lh(a)},fastTriangulate:function(a){return(new Cg).triangulate_anon_y_Float_x_Float(a)},toSegments:function(a){for(var b=[],c=a[a.length-1],d=0;d<a.length;){var e=a[d];++d;c=new Mh(c,e);b.push(c);c=e}return b},
toIPolygon:function(a,b){null==b&&(b=1);for(var c=[],d=0;d<a.length;){var e=a[d];++d;var f=b;null==f&&(f=1);c.push(new V(Math.round(e.x*f),Math.round(e.y*f)))}return c},getBounds:function(a,b){null==b&&(b=new Db);for(var c=0;c<a.length;){var d=a[c];++c;d.x<b.xMin&&(b.xMin=d.x);d.x>b.xMax&&(b.xMax=d.x);d.y<b.yMin&&(b.yMin=d.y);d.y>b.yMax&&(b.yMax=d.y)}return b},getCollider:function(a,b){null==b&&(b=!1);return new Sf([a],b)},xSort:function(a,b,c){return b.x==c.x?b.y<c.y?-1:1:b.x<c.x?-1:1},convexHull:function(a){var b=
a.length;if(3>a.length)return a;a.sort(function(a,b){return a.x==b.x?a.y<b.y?-1:1:a.x<b.x?-1:1});var c=[],d=0;for(b=0;b<a.length;){var e=a[b];for(++b;;){if(2<=d){var f=c[d-2];var g=c[d-1];g=0>=(g.x-f.x)*(e.y-f.y)-(g.y-f.y)*(e.x-f.x)}else g=!1;if(!g)break;--d}c[d++]=e}var h=a.length-2;for(b=d+1;0<=h;){for(e=a[h];;){d>=b?(f=c[d-2],g=c[d-1],g=0>=(g.x-f.x)*(e.y-f.y)-(g.y-f.y)*(e.x-f.x)):g=!1;if(!g)break;--d}c[d++]=e;--h}for(;c.length>=d;)c.pop();return c},isClockwise:function(a){for(var b=0,c=a[a.length-
1],d=0;d<a.length;){var e=a[d];++d;b+=(e.x-c.x)*(e.y+c.y);c=e}return 0>b},area:function(a){for(var b=0,c=a[a.length-1],d=0;d<a.length;){var e=a[d];++d;b+=e.x*c.y-c.x*e.y;c=e}return.5*(0>b?-b:b)},centroid:function(a){for(var b=0,c=0,d=0,e=a[a.length-1],f=0;f<a.length;){var g=a[f];++f;var h=e.x*g.y-g.x*e.y;c+=(e.x+g.x)*h;d+=(e.y+g.y)*h;b+=h;e=g}b*=.5;a=1/(6*b)*c;b=1/(6*b)*d;null==b&&(b=0);null==a&&(a=0);return new Da(a,b)},side:function(a,b,c,d){return(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x)},isConvex:function(a){if(4>
a.length)return!0;for(var b=a[a.length-2],c=a[a.length-1],d=a[0],e=0<(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x),f=1,g=a.length;f<g;){var h=f++;b=c;c=d;d=a[h];if(0<(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x)!=e)return!1}return!0},reverse:function(a){a.reverse()},transform:function(a,b){for(var c=0,d=a.length;c<d;){var e=c++;e=a[e];var f=b.b*e.x+b.d*e.y+b.y;e.x=b.a*e.x+b.c*e.y+b.x;e.y=f}},transformed:function(a,b){for(var c=a.slice(),d=0,e=c.length;d<e;){var f=d++;a=c[f];var g=b.a*a.x+b.c*a.y+b.x;a=b.b*a.x+
b.d*a.y+b.y;null==a&&(a=0);null==g&&(g=0);c[f]=new Da(g,a)}return null==c?[]:c},contains:function(a,b,c){var d;null==c&&(c=!1);if(c){var e=a[a.length-1];c=0;for(d=a;c<d.length;){a=d[c];++c;if(0>(a.x-e.x)*(b.y-e.y)-(a.y-e.y)*(b.x-e.x))return!1;e=a}return!0}var f=0;e=a[a.length-1];c=0;for(d=a;c<d.length;)a=d[c],++c,a.y<=b.y?e.y>b.y&&0<(e.x-a.x)*(b.y-a.y)-(e.y-a.y)*(b.x-a.x)&&++f:e.y<=b.y&&0>(e.x-a.x)*(b.y-a.y)-(e.y-a.y)*(b.x-a.x)&&--f,e=a;return 0!=f},findClosestPoint:function(a,b,c){var d=null;c*=
c;for(var e=0;e<a.length;){var f=a[e];++e;var g=f,h=g.x-b.x;g=g.y-b.y;h=h*h+g*g;h<c&&(d=f,c=h)}return d},projectPoint:function(a,b,c){var d;var e=a[a.length-1];var f=d=0;null==f&&(f=0);null==d&&(d=0);var g=d,h=f;null==c&&(c=new Da(0,0));for(var k=1E10,l=0;l<a.length;){var m=a[l];++l;f=e;e=m;d=f.x;f=f.y;var p=e.x-d;e=e.y-f;var r=p*p+e*e,n=1/r,u=c,w=(b.x-d)*p+(b.y-f)*e;null==u&&(u=new Da(0,0));0>w?(e=u,null==f&&(f=0),null==d&&(d=0),e.x=d,e.y=f):(w>r?(d+=p,f+=e):(r=w*n,d+=r*p,f+=r*e),null==f&&(f=0),
null==d&&(d=0),u.x=d,u.y=f);d=c;f=d.x-b.x;d=d.y-b.y;f=f*f+d*d;f<k&&(g=c.x,h=c.y,k=f);e=m}e=c;e.x=g;e.y=h;return c},distance:function(a,b,c){return Math.sqrt(yd.distanceSq(a,b,c))},distanceSq:function(a,b,c){for(var d=a[a.length-1],e=1E10,f=0;f<a.length;){var g=a[f];++f;var h=g,k=d.x;d=d.y;var l=h.x-k;h=h.y-d;var m=l*l+h*h,p=1/m;if(null==c||0>l*(b.y-d)-h*(b.x-k)==c){var r=b.x-k,n=b.y-d,u=r*l+n*h;0>u?d=r*r+n*n:(u>m?(k=b.x-(k+l),d=b.y-(d+h)):(m=u*p,k=k+m*l-b.x,d=d+m*h-b.y),d=k*k+d*d);d<e&&(e=d)}d=g}return 1E10==
e?0:e},rayIntersection:function(a,b,c,d){null==d&&(d=!1);for(var e=-1,f=a[a.length-1],g=0;g<a.length;){var h=a[g];++g;if(!(0<(b.lx*(f.y-b.py)-b.ly*(f.x-b.px))*(b.lx*(h.y-b.py)-b.ly*(h.x-b.px)))){var k=(b.lx*(f.y-b.py)-b.ly*(f.x-b.px))/(b.ly*(h.x-f.x)-b.lx*(h.y-f.y)),l=f.x+k*(h.x-f.x)-b.px;f=f.y+k*(h.y-f.y)-b.py;null==f&&(f=0);null==l&&(l=0);null==f&&(f=0);null==l&&(l=0);if(d){var m=b.lx;k=b.ly;null==k&&(k=0);null==m&&(m=0);null==k&&(k=0);null==m&&(m=0);k=0<m*l+k*f}else k=!0;if(k&&(l=l*l+f*f,l<e||
0>e)){if(!c)return Math.sqrt(l);e=l}}f=h}return 0>e?e:Math.sqrt(e)},orientation:function(a,b,c,d){a=(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x);return 0==a?0:0<a?1:-1},onSegment:function(a,b,c,d){a=b.x;var e=c.x;if(d.x>(a<e?e:a))return!1;a=b.x;e=c.x;if(d.x<(a>e?e:a))return!1;a=b.y;e=c.y;if(d.y>(a<e?e:a))return!1;a=b.y;e=c.y;return d.y<(a>e?e:a)?!1:!0},intersect:function(a,b,c,d,e){var f=(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x);var g=0==f?0:0<f?1:-1;f=(c.x-b.x)*(e.y-b.y)-(c.y-b.y)*(e.x-b.x);var h=0==f?
0:0<f?1:-1;f=(e.x-d.x)*(b.y-d.y)-(e.y-d.y)*(b.x-d.x);a=0==f?0:0<f?1:-1;f=(e.x-d.x)*(c.y-d.y)-(e.y-d.y)*(c.x-d.x);f=0==f?0:0<f?1:-1;if(g!=h&&a!=f)return!0;if(0==g){var k=b.x;g=c.x;d.x>(k<g?g:k)?g=!1:(k=b.x,g=c.x,d.x<(k>g?g:k)?g=!1:(k=b.y,g=c.y,d.y>(k<g?g:k)?g=!1:(k=b.y,g=c.y,g=d.y<(k>g?g:k)?!1:!0)))}else g=!1;g?h=!0:0==h?(k=b.x,g=c.x,e.x>(k<g?g:k)?h=!1:(k=b.x,g=c.x,e.x<(k>g?g:k)?h=!1:(k=b.y,g=c.y,e.y>(k<g?g:k)?h=!1:(k=b.y,g=c.y,h=e.y<(k>g?g:k)?!1:!0)))):h=!1;h?b=!0:0==a?(k=d.x,g=e.x,b.x>(k<g?g:k)?
b=!1:(k=d.x,g=e.x,b.x<(k>g?g:k)?b=!1:(k=d.y,g=e.y,b.y>(k<g?g:k)?b=!1:(k=d.y,g=e.y,b=b.y<(k>g?g:k)?!1:!0)))):b=!1;b?c=!0:0==f?(k=d.x,g=e.x,c.x>(k<g?g:k)?c=!1:(k=d.x,g=e.x,c.x<(k>g?g:k)?c=!1:(k=d.y,g=e.y,c.y>(k<g?g:k)?c=!1:(k=d.y,g=e.y,c=c.y<(k>g?g:k)?!1:!0)))):c=!1;return c?!0:!1},getIntersectionPoint:function(a,b,c,d,e){if(!yd.intersect(a,b,c,d,e))return null;a=c.y-b.y;c=b.x-c.x;b=a*b.x+c*b.y;var f=e.y-d.y;e=d.x-e.x;d=f*d.x+e*d.y;var g=a*e-f*c;if(0==g)return null;c=(e*b-c*d)/g;a=(a*d-f*b)/g;null==
a&&(a=0);null==c&&(c=0);return new Da(c,a)},selfIntersecting:function(a){if(4>a.length)return!1;for(var b=0,c=a.length-2;b<c;){var d=b++,e=a[d],f=a[d+1];d+=2;for(var g=a.length;d<g;){var h=d++,k=a[h];h=a[(h+1)%a.length];if(h!=e&&yd.intersect(a,e,f,k,h))return!0}}return!1},optimize:function(a,b){var c=[];yd.optimizeRec(a,0,a.length-1,c,b);return c},optimizeRec:function(a,b,c,d,e){for(var f=0,g=a[b],h=a[c],k=0,l=b+1;l<c;){var m=l++,p=a[m],r=h.x-g.x,n=h.y-g.y,u=(p.x-g.x)*r+(p.y-g.y)*n,w=r*r+n*n,I=-1;
0!=w&&(I=u/w);0>I?(r=g.x,n=g.y):1<I?(r=h.x,n=h.y):(r=g.x+I*r,n=g.y+I*n);I=p.x-r;p=p.y-n;p=I*I+p*p;p>f&&(k=m,f=p)}f>=e*e?(yd.optimizeRec(a,b,k,d,e),d.pop(),yd.optimizeRec(a,k,c,d,e)):(d.push(a[b]),d.push(a[c]))},makeCircle:function(a,b,c,d){null==d&&(d=0);if(0==d){var e=6.28*c/4;d=Math.ceil(0>e?-e:e)}3>d&&(d=3);e=6.283185307179586/d;for(var f=[],g=0;g<d;){var h=g++*e,k=Math.cos(h)*c+a;h=Math.sin(h)*c+b;null==h&&(h=0);null==k&&(k=0);f.push(new Da(k,h))}return null==f?[]:f}},Sf=function(a,b){null==b&&
(b=!1);this.polygons=a;this.isConvex=b};Sf.__name__="h2d.col.PolygonCollider";Sf.__super__=se;Sf.prototype=D(se.prototype,{contains:function(a){return null==this.polygons?!1:bj.contains(this.polygons,a,this.isConvex)},collideCircle:function(a){throw t.thrown("Not implemented");},collideBounds:function(a){throw t.thrown("Not implemented");},__class__:Sf});var bj={get_length:function(a){return a.length},get_polygons:function(a){return a},_new:function(a){return null==a?[]:a},iterator:function(a){return new Nh(a)},
toIPolygons:function(a,b){null==b&&(b=1);for(var c=[],d=0;d<a.length;){var e=a[d];++d;c.push(yd.toIPolygon(e,b))}return c},getBounds:function(a,b){null==b&&(b=new Db);for(var c=0;c<a.length;){var d=a[c];++c;yd.getBounds(d,b)}return b},getCollider:function(a,b){null==b&&(b=!1);return new Sf(a,b)},contains:function(a,b,c){null==c&&(c=!1);for(var d=0;d<a.length;){var e=a[d];++d;if(yd.contains(e,b,c))return!0}return!1},optimize:function(a,b){for(var c=[],d=0;d<a.length;){var e=a[d];++d;c.push(yd.optimize(e,
b))}return c}},Mh=function(a,b){this.x=a.x;this.y=a.y;this.dx=b.x-this.x;this.dy=b.y-this.y;this.lenSq=this.dx*this.dx+this.dy*this.dy;this.invLenSq=1/this.lenSq};Mh.__name__="h2d.col.Segment";Mh.prototype={setPoints:function(a,b){this.x=a.x;this.y=a.y;this.dx=b.x-this.x;this.dy=b.y-this.y;this.lenSq=this.dx*this.dx+this.dy*this.dy;this.invLenSq=1/this.lenSq},side:function(a){return this.dx*(a.y-this.y)-this.dy*(a.x-this.x)},distanceSq:function(a){var b=a.x-this.x,c=a.y-this.y,d=b*this.dx+c*this.dy;
if(0>d)return b*b+c*c;if(d>this.lenSq)return b=a.x-(this.x+this.dx),a=a.y-(this.y+this.dy),b*b+a*a;c=d*this.invLenSq;b=this.x+c*this.dx-a.x;a=this.y+c*this.dy-a.y;return b*b+a*a},distance:function(a){var b=a.x-this.x,c=a.y-this.y,d=b*this.dx+c*this.dy;0>d?a=b*b+c*c:(d>this.lenSq?(b=a.x-(this.x+this.dx),a=a.y-(this.y+this.dy)):(c=d*this.invLenSq,b=this.x+c*this.dx-a.x,a=this.y+c*this.dy-a.y),a=b*b+a*a);return Math.sqrt(a)},project:function(a,b){a=(a.x-this.x)*this.dx+(a.y-this.y)*this.dy;null==b&&
(b=new Da(0,0));if(0>a){var c=b;a=this.x;var d=this.y}else a>this.lenSq?(c=b,a=this.x+this.dx,d=this.y+this.dy):(d=a*this.invLenSq,c=b,a=this.x+d*this.dx,d=this.y+d*this.dy);null==d&&(d=0);null==a&&(a=0);c.x=a;c.y=d;return b},lineIntersection:function(a,b){var c=this.x,d=this.y;null==d&&(d=0);null==c&&(c=0);null==d&&(d=0);null==c&&(c=0);var e=c,f=d;c=this.x+this.dx;d=this.y+this.dy;null==d&&(d=0);null==c&&(c=0);null==d&&(d=0);null==c&&(c=0);if(0<(a.lx*(f-a.py)-a.ly*(e-a.px))*(a.lx*(d-a.py)-a.ly*(c-
a.px)))return null;a=(a.lx*(this.y-a.py)-a.ly*(this.x-a.px))/(a.ly*this.dx-a.lx*this.dy);if(0>a||1<a)return null;null==b&&(b=new Da(0,0));b.x=this.x+a*this.dx;b.y=this.y+a*this.dy;return b},__class__:Mh};var Ag=function(){this.head=this.tail=new Eg(null);this.totalCount=0};Ag.__name__="h2d.impl.BatchDrawState";Ag.prototype={setTile:function(a){null!=a&&this.setTexture(a.innerTex)},setTexture:function(a){if(null!=a)if(null==this.tail.texture)this.tail.texture=a;else if(this.tail.texture!=a){var b=
this.tail;0==b.count?b.set(a):null==b.next?b.next=this.tail=new Eg(a):this.tail=b.next.set(a)}},add:function(a){this.tail.count+=a;this.totalCount+=a},clear:function(){var a=this.head;do a.texture=null,a=a.next;while(null!=a);this.tail=this.head;this.totalCount=this.tail.count=0},drawQuads:function(a,b,c,d){null==d&&(d=-1);null==c&&(c=0);var e=this.head,f=this.tail.next,g=a.engine;if(0==c&&-1==d){do{a.texture=e.texture;a.beforeDraw();var h=e.count>>1;var k=c;var l=h;null==l&&(l=-1);null==k&&(k=0);
g.renderBuffer(b,g.mem.getQuadIndexes(b.vertices),2,k,l);c+=h;e=e.next}while(e!=f)}else{-1==d&&(d=(this.totalCount>>1)-c);var m=0;do{h=e.count>>1;if(m+h>=c){l=c>=m?c:m;var p=d>h?h:d;a.texture=e.texture;a.beforeDraw();k=l;l=p;null==l&&(l=-1);null==k&&(k=0);g.renderBuffer(b,g.mem.getQuadIndexes(b.vertices),2,k,l);d-=p;if(0==d)break}m+=h;e=e.next}while(e!=f)}},drawIndexed:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=0);var f=this.head,g=this.tail.next,h=a.engine;if(0==d&&-1==e){do{a.texture=f.texture;
a.beforeDraw();var k=f.count/3|0;h.renderIndexed(b,c,d,k);d+=k;f=f.next}while(f!=g)}else{-1==e&&(e=this.totalCount/3|0);var l=0;do{k=f.count/3|0;if(l+k>=d){var m=d>=l?d:l,p=e>k?k:e;a.texture=f.texture;a.beforeDraw();h.renderIndexed(b,c,m,p);e-=p;if(0==e)break}l+=k;f=f.next}while(f!=g)}},get_currentTexture:function(){return this.tail.texture},__class__:Ag};var Eg=function(a){this.texture=a;this.count=0};Eg.__name__="h2d.impl._BatchDrawState.StateEntry";Eg.prototype={set:function(a){this.texture=a;
this.count=0;return this},__class__:Eg};var Ja=K["h3d.BufferFlag"]={__ename__:!0,__constructs__:null,Dynamic:{_hx_name:"Dynamic",_hx_index:0,__enum__:"h3d.BufferFlag",toString:v},NoAlloc:{_hx_name:"NoAlloc",_hx_index:1,__enum__:"h3d.BufferFlag",toString:v},UniformBuffer:{_hx_name:"UniformBuffer",_hx_index:2,__enum__:"h3d.BufferFlag",toString:v},ReadWriteBuffer:{_hx_name:"ReadWriteBuffer",_hx_index:3,__enum__:"h3d.BufferFlag",toString:v},IndexBuffer:{_hx_name:"IndexBuffer",_hx_index:4,__enum__:"h3d.BufferFlag",
toString:v}};Ja.__constructs__=[Ja.Dynamic,Ja.NoAlloc,Ja.UniformBuffer,Ja.ReadWriteBuffer,Ja.IndexBuffer];Ja.__empty_constructs__=[Ja.Dynamic,Ja.NoAlloc,Ja.UniformBuffer,Ja.ReadWriteBuffer,Ja.IndexBuffer];var hc=function(a,b,c){this.id=hc.GUID++;this.vertices=a;this.format=b;this.flags=0;this.allocPos=Oc.make();if(null!=c)for(a=0;a<c.length;)b=c[a],++a,this.flags|=1<<b._hx_index;this.engine=ja.CURRENT;0==(this.flags&1<<Ja.NoAlloc._hx_index)&&this.engine.mem.allocBuffer(this)};hc.__name__="h3d.Buffer";
hc.ofFloats=function(a,b,c){var d=Math.ceil(a.pos/b.stride);b=new hc(d,b,c);b.uploadFloats(a,0,d);return b};hc.ofSubFloats=function(a,b,c,d){c=new hc(b,c,d);c.uploadFloats(a,0,b);return c};hc.prototype={getMemSize:function(){return this.vertices*this.format.strideBytes},isDisposed:function(){return null==this.vbuf},dispose:function(){null!=this.vbuf&&(this.engine.mem.freeBuffer(this),this.vbuf=null)},uploadFloats:function(a,b,c,d){null==d&&(d=0);if(0>d||0>c||d+c>this.vertices)throw t.thrown("Invalid vertices count");
if(0!=c)if(this.format.hasLowPrecision){d=new S(new ArrayBuffer(c*this.format.strideBytes));for(var e=0,f,g=this.format.inputs,h=0;h<c;)for(h++,f=0;f<g.length;){var k=g[f++],l=k.type,m=l==ka.__cast(9,jc)?1:l;l=0;switch(k.precision){case 0:for(var p=0;p<m;)p++,d.setFloat(e+l,a.array[b++]),l+=4;break;case 1:for(p=0;p<m;){p++;var r=N.float32to16(a.array[b++]);d.setUInt16(e+l,r);l+=2}break;case 2:for(p=0;p<m;)p++,r=N.float32toU8(a.array[b++]),d.b[e+l]=r,++l;break;case 3:for(p=0;p<m;)p++,r=N.float32toS8(a.array[b++]),
d.b[e+l]=r,++l}l=k.type;e+=(l==ka.__cast(9,jc)?1:l)*$b.SIZES[k.precision];0!=(e&3)&&(e+=4-(e&3))}this.uploadBytes(d,0,c)}else this.engine.driver.uploadBufferData(this,d,c,a,b)},uploadBytes:function(a,b,c){if(0>c||c>this.vertices)throw t.thrown("Invalid vertices count");0!=c&&this.engine.driver.uploadBufferBytes(this,0,c,a,b)},readBytes:function(a,b,c,d){null==d&&(d=0);if(0>d||0>c||d+c>this.vertices)throw t.thrown("Invalid vertices count");this.engine.driver.readBufferBytes(this,d,c,a,b)},__class__:hc};
var Tf=function(a,b,c,d,e,f){null==f&&(f=!1);null==e&&(e=4E3);null==d&&(d=.02);null==c&&(c=1.333333);null==b&&(b=1);null==a&&(a=25);this.viewX=this.viewY=this.jitterOffsetX=this.jitterOffsetY=0;this.fovY=a;this.zoom=b;this.screenRatio=c;this.zNear=d;this.zFar=e;this.rightHanded=f;a=2;b=3;c=4;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.pos=new G(a,b,c);b=a=0;c=1;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.up=new G(a,b,c);c=b=a=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.target=
new G(a,b,c);this.m=new ca;this.mcam=new ca;this.mproj=new ca;this.frustum=new Fg;this.update()};Tf.__name__="h3d.Camera";Tf.prototype={setFovX:function(a,b){var c=Math.PI/180;this.fovY=2*Math.atan(Math.tan(.5*a*c)/b)/c},getFovX:function(){var a=Math.PI/180;return 2*Math.atan(Math.tan(.5*this.fovY*a)*this.screenRatio)/a},clone:function(){var a=new Tf(this.fovY,this.zoom,this.screenRatio,this.zNear,this.zFar,this.rightHanded),b=this.pos,c=b.x,d=b.y;b=b.z;null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);
a.pos=new G(c,d,b);b=this.up;c=b.x;d=b.y;b=b.z;null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.up=new G(c,d,b);b=this.target;c=b.x;d=b.y;b=b.z;null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.target=new G(c,d,b);a.update();return a},getInverseViewProj:function(){null==this.minv&&(this.minv=new ca);this.needInv&&(this.minv.initInverse(this.m),this.needInv=!1);return this.minv},getInverseProj:function(){null==this.mprojInv&&(this.mprojInv=new ca,this.mprojInv._44=0);0==this.mprojInv._44&&this.mprojInv.initInverse(this.mproj);
return this.mprojInv},getInverseView:function(){null==this.mcamInv&&(this.mcamInv=new ca,this.mcamInv._44=0);0==this.mcamInv._44&&this.mcamInv.initInverse(this.mcam);return this.mcamInv},calcDirections:function(){var a=this.target,b=this.pos,c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;b=d;var f=e,g=a*a+b*b+f*f;g=1E-20>g?0:1/Math.sqrt(g);c=a*g;d=b*g;e=f*g;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==
d&&(d=0);null==c&&(c=0);a=c;b=d;f=e;g=this.up;c=g.y*f-g.z*b;d=g.z*a-g.x*f;e=g.x*b-g.y*a;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var h=e;g=c*c+d*d+h*h;g=1E-20>g?0:1/Math.sqrt(g);c*=g;d*=g;e=h*g;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=c;h=d;var k=e;c=b*k-f*h;d=f*g-a*k;e=a*h-b*g;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);this.directions._11=a;this.directions._12=
b;this.directions._13=f;this.directions._21=g;this.directions._22=h;this.directions._23=k;this.directions._31=c;this.directions._32=d;this.directions._33=e;this.directions._44=1},getForward:function(){var a=new G(0,0,0);null==this.directions&&(this.directions=new ca,this.directions._44=0);0==this.directions._44&&this.calcDirections();a.x=this.directions._11;a.y=this.directions._12;a.z=this.directions._13;return a},getRight:function(){var a=new G(0,0,0);null==this.directions&&(this.directions=new ca,
this.directions._44=0);0==this.directions._44&&this.calcDirections();a.x=this.directions._21;a.y=this.directions._22;a.z=this.directions._23;return a},getUp:function(){var a=new G(0,0,0);null==this.directions&&(this.directions=new ca,this.directions._44=0);0==this.directions._44&&this.calcDirections();a.x=this.directions._31;a.y=this.directions._32;a.z=this.directions._33;return a},setCubeMap:function(a,b){var c=0,d=0,e=0;switch(a){case 0:c=1;a=this.up;var f=0;var g=1;var h=0;null==h&&(h=0);null==
g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 1:c=-1;a=this.up;f=0;g=1;h=0;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 2:d=1;a=this.up;g=f=0;h=-1;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 3:d=-1;a=this.up;g=f=0;h=1;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 4:e=1;a=this.up;f=0;g=1;h=0;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 5:e=-1,a=this.up,f=0,g=1,h=0,null==h&&(h=
0),null==g&&(g=0),null==f&&(f=0),a.x=f,a.y=g,a.z=h}null!=b&&(a=this.pos,a.x=b.x,a.y=b.y,a.z=b.z);a=this.target;f=this.pos.x+c;g=this.pos.y+d;h=this.pos.z+e;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h},unproject:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);c=new G(a,b,c);a=this.getInverseViewProj();b=c.x*a._12+c.y*a._22+c.z*a._32+a._42;var d=c.x*a._13+c.y*a._23+c.z*a._33+a._43,e=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=(c.x*a._11+c.y*a._21+c.z*a._31+a._41)*e;c.y=
b*e;c.z=d*e;return c},rayFromScreen:function(a,b,c,d){null==d&&(d=-1);null==c&&(c=-1);var e=ja.CURRENT;0>c&&(c=e.width);0>d&&(d=e.height);a=2*(a/c-.5);d=2*(.5-b/d);b=this.unproject(a,d,0);d=this.unproject(a,d,1);a=new Mb;a.px=b.x;a.py=b.y;a.pz=b.z;a.lx=d.x-b.x;a.ly=d.y-b.y;a.lz=d.z-b.z;a.normalize();return a},update:function(){if(null!=this.follow){var a=this.follow.pos.localToGlobal(),b=this.follow.target.localToGlobal(),c=this.pos,d=a.x,e=a.y;a=a.z;null==a&&(a=0);null==e&&(e=0);null==d&&(d=0);c.x=
d;c.y=e;c.z=a;c=this.target;d=b.x;e=b.y;a=b.z;null==a&&(a=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=a;if(null!=this.follow.pos.name)for(b=this.follow.pos;null!=b;){if(null!=b.currentAnimation&&(c=b.currentAnimation.getPropValue(this.follow.pos.name,"FOVY"),null!=c)){this.fovY=c;break}b=b.parent}}this.makeCameraMatrix(this.mcam);this.makeFrustumMatrix(this.mproj);this.m.multiply(this.mcam,this.mproj);this.needInv=!0;null!=this.mcamInv&&(this.mcamInv._44=0);null!=this.mprojInv&&(this.mprojInv._44=
0);null!=this.directions&&(this.directions._44=0);this.frustum.loadMatrix(this.m)},getFrustumCorners:function(a,b){null==b&&(b=0);null==a&&(a=1);return[this.unproject(-1,1,b),this.unproject(1,1,b),this.unproject(1,-1,b),this.unproject(-1,-1,b),this.unproject(-1,1,a),this.unproject(1,1,a),this.unproject(1,-1,a),this.unproject(-1,-1,a)]},lostUp:function(){var a=this.pos,b=a.x,c=a.y;a=a.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);var d=c,e=a;null==e&&(e=0);null==d&&(d=0);null==b&&(b=0);c=b;a=d;b=
e;d=c*c+a*a+b*b;d=1E-20>d?0:1/Math.sqrt(d);e=this.up;return.999<Math.abs(c*d*e.x+a*d*e.y+b*d*e.z)},getViewDirection:function(a,b,c){null==c&&(c=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a=c=new G(a,b,c);b=this.mcam;var d=a.x*b._12+a.y*b._22+a.z*b._32,e=a.x*b._13+a.y*b._23+a.z*b._33;a.x=a.x*b._11+a.y*b._21+a.z*b._31;a.y=d;a.z=e;a=c;b=a.x*a.x+a.y*a.y+a.z*a.z;b=1E-20>b?0:1/Math.sqrt(b);a.x*=b;a.y*=b;a.z*=b;return c},movePosAxis:function(a,b,c){null==c&&(c=0);null==c&&(c=0);null==b&&(b=0);null==
a&&(a=0);var d=c;null==d&&(d=0);null==b&&(b=0);null==a&&(a=0);c=a;a=b;b=d;d=this.mcam;var e=c*d._12+a*d._22+b*d._32,f=c*d._13+a*d._23+b*d._33;this.pos.x+=c*d._11+a*d._21+b*d._31;this.pos.y+=e;this.pos.z+=f},moveTargetAxis:function(a,b,c){null==c&&(c=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=c;null==d&&(d=0);null==b&&(b=0);null==a&&(a=0);c=a;a=b;b=d;d=this.mcam;var e=c*d._12+a*d._22+b*d._32,f=c*d._13+a*d._23+b*d._33;this.target.x+=c*d._11+a*d._21+b*d._31;this.target.y+=e;this.target.z+=
f},forward:function(a){null==a&&(a=1);var b=1-.025*a;a=this.pos;var c=this.target.x+(this.pos.x-this.target.x)*b,d=this.target.y+(this.pos.y-this.target.y)*b;b=this.target.z+(this.pos.z-this.target.z)*b;null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d;a.z=b},backward:function(a){null==a&&(a=1);var b=1+.025*a;a=this.pos;var c=this.target.x+(this.pos.x-this.target.x)*b,d=this.target.y+(this.pos.y-this.target.y)*b;b=this.target.z+(this.pos.z-this.target.z)*b;null==b&&(b=0);null==d&&(d=0);null==
c&&(c=0);a.x=c;a.y=d;a.z=b},makeCameraMatrix:function(a){var b=this.target,c=this.pos,d=b.x-c.x,e=b.y-c.y;c=b.z-c.z;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);var f=e;null==c&&(c=0);null==f&&(f=0);null==d&&(d=0);b=d;var g=f,h=c;this.rightHanded&&(b*=-1,g*=-1,h*=-1);c=b*b+g*g+h*h;c=1E-20>c?0:1/Math.sqrt(c);b*=c;g*=c;h*=c;var k=this.up;d=k.y*h-k.z*g;e=k.z*b-k.x*h;c=k.x*g-k.y*b;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);f=e;null==c&&(c=0);null==f&&(f=0);null==d&&(d=0);k=d;var l=f,m=c;c=k*k+l*l+m*
m;c=1E-20>c?0:1/Math.sqrt(c);k*=c;l*=c;m*=c;0==Math.sqrt(k*k+l*l+m*m)&&(k=g,l=h,m=b);d=g*m-h*l;e=h*k-b*m;c=b*l-g*k;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);f=e;null==c&&(c=0);null==f&&(f=0);null==d&&(d=0);e=d;d=f;f=c;a._11=k;a._12=e;a._13=b;a._14=0;a._21=l;a._22=d;a._23=g;a._24=0;a._31=m;a._32=f;a._33=h;a._34=0;c=this.pos;a._41=-(k*c.x+l*c.y+m*c.z);c=this.pos;a._42=-(e*c.x+d*c.y+f*c.z);c=this.pos;a._43=-(b*c.x+g*c.y+h*c.z);a._44=1},setTransform:function(a){var b=this.pos,c=a._41,d=a._42,e=a._43;
null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.target;e=this.pos;a=a.getDirection();c=e.x+a.x;d=e.y+a.y;e=e.z+a.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e},makeFrustumMatrix:function(a){a.zero();var b=this.orthoBounds;if(null!=b){var c=1/(b.xMax-b.xMin),d=1/(b.yMax-b.yMin),e=1/(b.zMax-b.zMin);a._11=2*c;a._22=2*d;a._33=e;a._41=-(b.xMin+b.xMax)*c;a._42=-(b.yMin+b.yMax)*d;a._43=-b.zMin*e;a._44=1}else b=this.zoom/
Math.tan(Math.atan(Math.tan(Math.PI/180*this.fovY*.5)*this.screenRatio)),a._11=b,a._22=b*this.screenRatio,a._33=this.zFar/(this.zFar-this.zNear),a._34=1,a._43=-(this.zNear*this.zFar)/(this.zFar-this.zNear),a._31=this.jitterOffsetX,a._32=this.jitterOffsetY;a._11+=this.viewX*a._14;a._21+=this.viewX*a._24;a._31+=this.viewX*a._34;a._41+=this.viewX*a._44;a._12+=this.viewY*a._14;a._22+=this.viewY*a._24;a._32+=this.viewY*a._34;a._42+=this.viewY*a._44;this.rightHanded&&(a._33*=-1,a._34*=-1)},projectInline:function(a,
b,c,d,e,f){null==f&&(f=!0);var g=new G(0,0,0),h=g;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);h.x=a;h.y=b;h.z=c;h=g;c=this.m;a=h.x*c._12+h.y*c._22+h.z*c._32+c._42;b=h.x*c._13+h.y*c._23+h.z*c._33+c._43;var k=1/(h.x*c._14+h.y*c._24+h.z*c._34+c._44);h.x=(h.x*c._11+h.y*c._21+h.z*c._31+c._41)*k;h.y=a*k;h.z=b*k;g.x=.5*(g.x+1)*d;g.y=.5*(-g.y+1)*e;f&&(g.x=Math.round(g.x),g.y=Math.round(g.y));return g},project:function(a,b,c,d,e,f,g){null==f&&(f=!0);null==g&&(g=new G(0,0,0));var h=g;null==c&&(c=0);null==
b&&(b=0);null==a&&(a=0);h.x=a;h.y=b;h.z=c;h=g;c=this.m;a=h.x*c._12+h.y*c._22+h.z*c._32+c._42;b=h.x*c._13+h.y*c._23+h.z*c._33+c._43;var k=1/(h.x*c._14+h.y*c._24+h.z*c._34+c._44);h.x=(h.x*c._11+h.y*c._21+h.z*c._31+c._41)*k;h.y=a*k;h.z=b*k;g.x=.5*(g.x+1)*d;g.y=.5*(-g.y+1)*e;f&&(g.x=Math.round(g.x),g.y=Math.round(g.y));return g},distanceToDepth:function(a){var b=this.zNear,c=this.zFar;null==c&&(c=1);null==b&&(b=0);return((this.zFar+this.zNear-2*this.zNear*this.zFar/(a<b?b:a>c?c:a))/(this.zFar-this.zNear)+
1)/2},depthToDistance:function(a){var b=0,c=1;null==c&&(c=1);null==b&&(b=0);return((a<b?b:a>c?c:a)*this.zFar-this.zNear*this.zFar)/(this.zFar-this.zNear)},load:function(a){var b=this.pos,c=a.pos;b.x=c.x;b.y=c.y;b.z=c.z;b=this.target;c=a.target;b.x=c.x;b.y=c.y;b.z=c.z;b=this.up;c=a.up;b.x=c.x;b.y=c.y;b.z=c.z;null!=a.orthoBounds?(this.orthoBounds=new Ka,this.orthoBounds.load(a.orthoBounds)):this.orthoBounds=null;this.fovY=a.fovY;this.screenRatio=a.screenRatio;this.zoom=a.zoom;this.zNear=a.zNear;this.zFar=
a.zFar;this.follow=null!=a.follow?{pos:a.follow.pos,target:a.follow.target}:null;this.viewX=a.viewX;this.viewY=a.viewY;this.update()},__class__:Tf};var Oh=function(a,b,c,d,e){this.t=a;this.next=b;this.layer=c;this.mipLevel=d;this.depthBinding=e};Oh.__name__="h3d._Engine.TargetTmp";Oh.prototype={__class__:Oh};var kc=K["h3d.DepthBinding"]={__ename__:!0,__constructs__:null,ReadWrite:{_hx_name:"ReadWrite",_hx_index:0,__enum__:"h3d.DepthBinding",toString:v},ReadOnly:{_hx_name:"ReadOnly",_hx_index:1,__enum__:"h3d.DepthBinding",
toString:v},DepthOnly:{_hx_name:"DepthOnly",_hx_index:2,__enum__:"h3d.DepthBinding",toString:v},NotBound:{_hx_name:"NotBound",_hx_index:3,__enum__:"h3d.DepthBinding",toString:v}};kc.__constructs__=[kc.ReadWrite,kc.ReadOnly,kc.DepthOnly,kc.NotBound];kc.__empty_constructs__=[kc.ReadWrite,kc.ReadOnly,kc.DepthOnly,kc.NotBound];var ja=function(){this.resCache=new Cc;this.inRender=this.ready=!1;this.textureColorCache=new Fa;this.tmpVector=new O(0,0,0,1);this.backgroundColor=-16777216;this.hardware=!ja.SOFTWARE_DRIVER;
this.antiAlias=ja.ANTIALIASING;this.autoResize=!0;this.set_fullScreen(!la.getValue(Rd.IsWindowed));this.window=ic.getInstance();this.realFps=la.getDefaultFrameRate();this.lastTime=F.now()/1E3;this.window.addResizeEvent(M(this,this.onWindowResize));ja.CURRENT=this;this.window.setCurrent();this.driver=te.get_supported()?new oa(this.antiAlias):new Gg};ja.__name__="h3d.Engine";ja.getCurrent=function(){return ja.CURRENT};ja.prototype={setDriver:function(a){this.driver=a;null!=this.mem&&(this.mem.driver=
a)},setCurrent:function(){ja.CURRENT=this;this.window.setCurrent()},init:function(){this.driver.init(M(this,this.onCreate),!this.hardware)},driverName:function(a){null==a&&(a=!1);return this.driver.getDriverName(a)},selectShader:function(a){this.needFlushTarget&&this.doFlushTarget();this.driver.selectShader(a)&&this.shaderSwitches++},selectMaterial:function(a){this.driver.selectMaterial(a)},uploadShaderBuffers:function(a,b){this.driver.uploadShaderBuffers(a,b)},selectBuffer:function(a){if(null==a.vbuf)return!1;
this.needFlushTarget&&this.doFlushTarget();this.driver.selectBuffer(a);return!0},renderTriBuffer:function(a,b,c){null==c&&(c=-1);null==b&&(b=0);this.renderBuffer(a,this.mem.getTriIndexes(a.vertices),3,b,c)},renderQuadBuffer:function(a,b,c){null==c&&(c=-1);null==b&&(b=0);this.renderBuffer(a,this.mem.getQuadIndexes(a.vertices),2,b,c)},renderBuffer:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=0);if(null!=b.vbuf){c=a.vertices/c|0;0>e&&(e=c-d);if(0>d||0>e||d+e>c)throw t.thrown("Invalid vertices count");
0<e&&this.selectBuffer(a)&&(this.driver.draw(b,3*d,e),this.drawTriangles+=e,this.drawCalls++)}},renderIndexed:function(a,b,c,d){null==d&&(d=-1);null==c&&(c=0);if(null!=b.vbuf){var e=b.vertices/3|0;0>d&&(d=e-c);0<d&&this.selectBuffer(a)&&(this.driver.draw(b,3*c,d),this.drawTriangles+=d,this.drawCalls++)}},renderMultiBuffers:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=0);var f=c.vertices/3|0;0>=f||(this.needFlushTarget&&this.doFlushTarget(),this.driver.selectMultiBuffers(a,b),null!=c.vbuf&&(0>e&&
(e=f-d),0<e&&(this.driver.draw(c,3*d,e),this.drawTriangles+=e,this.drawCalls++)))},renderInstanced:function(a,b){null!=a.vbuf&&0<b.commandCount&&(this.driver.drawInstanced(a,b),this.drawTriangles+=b.triCount,this.drawCalls++)},set_debug:function(a){this.debug=a;this.driver.setDebug(this.debug);return a},onCreate:function(a){ja.CURRENT=this;this.window.setCurrent();this.autoResize&&(this.width=this.window.get_width(),this.height=this.window.get_height());a?(Zb.get().onContextLost(),this.mem.onContextLost()):
(this.mem=new lf(this.driver),this.mem.init(),this.nullTexture=new W(0,0,[P.NoAlloc]));this.hardware=this.driver.hasFeature(Ia.HardwareAccelerated);this.set_debug(this.debug);this.set_fullScreen(this.fullScreen);this.resize(this.width,this.height);if(a)this.onContextLost();else this.onReady();this.ready=!0},onContextLost:function(){},onReady:function(){},onWindowResize:function(){if(this.autoResize&&!this.driver.isDisposed()){var a=this.window.get_width(),b=this.window.get_height();a==this.width&&
b==this.height||this.resize(a,b);this.onResized()}},set_fullScreen:function(a){this.fullScreen=a;null!=this.mem&&la.getValue(Rd.IsWindowed)&&this.window.set_displayMode(a?Rb.Borderless:Rb.Windowed);return a},onResized:function(){},resize:function(a,b){32>a&&(a=32);32>b&&(b=32);this.width=a;this.height=b;this.driver.isDisposed()||this.driver.resize(a,b)},begin:function(){if(this.driver.isDisposed())return!1;this.inRender=!0;this.dispatches=this.drawCalls=this.shaderSwitches=this.drawTriangles=0;this.targetStack=
null;this.needFlushTarget=null!=this.currentTargetTex;this.driver.begin(ea.frameCount);null!=this.backgroundColor&&this.clear(this.backgroundColor,1,0);return!0},hasFeature:function(a){return this.driver.hasFeature(a)},end:function(){this.inRender=!1;this.driver.end()},getCurrentTarget:function(){return null==this.targetStack?null:this.targetStack.t==this.nullTexture?this.targetStack.textures[0]:this.targetStack.t},pushTarget:function(a,b,c,d){null==d&&(d=kc.ReadWrite);null==c&&(c=0);null==b&&(b=
0);var e=this.targetTmp;null==e?e=new Oh(a,this.targetStack,b,c,d):(this.targetTmp=e.next,e.t=a,e.next=this.targetStack,e.mipLevel=c,e.layer=b,e.depthBinding=d);this.targetStack=e;this.updateNeedFlush()},updateNeedFlush:function(){var a=this.targetStack;this.needFlushTarget=null==a?null!=this.currentTargetTex:this.currentTargetTex!=a.t||this.currentTargetLayer!=a.layer||this.currentTargetMip!=a.mipLevel||null!=a.textures||this.currentDepthBinding!=a.depthBinding},pushTargets:function(a,b){null==b&&
(b=kc.ReadWrite);this.pushTarget(this.nullTexture,null,null,b);this.targetStack.textures=a;this.needFlushTarget=!0},pushDepth:function(a){this.pushTarget(a,null,null,kc.DepthOnly)},popTarget:function(){var a=this.targetStack;if(null==a)throw t.thrown("popTarget() with no matching pushTarget()");this.targetStack=a.next;this.updateNeedFlush();a.t=null;a.textures=null;a.next=this.targetTmp;this.targetTmp=a},flushTarget:function(){this.needFlushTarget&&this.doFlushTarget()},doFlushTarget:function(){var a=
this.targetStack;null==a?(this.driver.setRenderTarget(null),this.currentTargetTex=null):(a.depthBinding==kc.DepthOnly?this.driver.setDepth(a.t):null!=a.textures?this.driver.setRenderTargets(a.textures,a.depthBinding):this.driver.setRenderTarget(a.t,a.layer,a.mipLevel,a.depthBinding),this.currentTargetTex=a.t,this.currentTargetLayer=a.layer,this.currentTargetMip=a.mipLevel,this.currentDepthBinding=a.depthBinding);this.needFlushTarget=!1},clearF:function(a,b,c){this.needFlushTarget&&this.doFlushTarget();
this.driver.clear(a,b,c)},clear:function(a,b,c){if(null!=a){var d=this.tmpVector;d.x=(a>>16&255)/255;d.y=(a>>8&255)/255;d.z=(a&255)/255;d.w=(a>>>24)/255}this.needFlushTarget&&this.doFlushTarget();this.driver.clear(null==a?null:this.tmpVector,b,c)},setRenderZone:function(a,b,c,d){null==d&&(d=-1);null==c&&(c=-1);null==b&&(b=0);null==a&&(a=0);this.needFlushTarget&&this.doFlushTarget();this.driver.setRenderZone(a,b,c,d)},render:function(a){if(!this.begin())return!1;a.render(this);this.end();var b=F.now()/
1E3-this.lastTime;this.lastTime+=b;0<b&&(a=1/b,a>2*this.realFps?a=2*this.realFps:a<.5*this.realFps&&(a=.5*this.realFps),b/=.5,.3<b&&(b=.3),this.realFps=this.realFps*(1-b)+a*b);return!0},onTextureBiasChanged:function(a){if(!a.isDepth())throw t.thrown("Can change texture bias on depth buffer only");this.driver.onTextureBiasChanged(a)},dispose:function(){this.driver.dispose();this.window.removeResizeEvent(M(this,this.onWindowResize));null!=this.mem&&this.mem.dispose()},get_fps:function(){return Math.ceil(100*
this.realFps)/100},__class__:ja};var jd={_new:function(a,b){null==b&&(b=!1);return new hc(a,b?N.get_INDEX32():N.get_INDEX16(),[Ja.IndexBuffer])},uploadIndexes:function(a,b,c,d,e){null==e&&(e=0);if(0>e||0>d||e+d>a.vertices)throw t.thrown("Invalid indices count");if(1!=a.format.inputs[0].precision)throw t.thrown("Can't upload indexes on a 32-bit buffer");0!=d&&ja.CURRENT.driver.uploadIndexData(a,e,d,b,c)},get_count:function(a){return a.vertices},alloc:function(a,b,c){null==c&&(c=-1);0>c&&(c=a.length);
b=jd._new(c);jd.uploadIndexes(b,a,0,c);return b}},ca=function(){};ca.__name__="h3d.MatrixImpl";ca.prototype={get_tx:function(){return this._41},get_ty:function(){return this._42},get_tz:function(){return this._43},set_tx:function(a){return this._41=a},set_ty:function(a){return this._42=a},set_tz:function(a){return this._43=a},equal:function(a){return this._11==a._11&&this._12==a._12&&this._13==a._13&&this._14==a._14&&this._21==a._21&&this._22==a._22&&this._23==a._23&&this._24==a._24&&this._31==a._31&&
this._32==a._32&&this._33==a._33&&this._34==a._34&&this._41==a._41&&this._42==a._42&&this._43==a._43?this._44==a._44:!1},zero:function(){this._44=this._43=this._42=this._41=this._34=this._33=this._32=this._31=this._24=this._23=this._22=this._21=this._14=this._13=this._12=this._11=0},identity:function(){this._11=1;this._21=this._14=this._13=this._12=0;this._22=1;this._32=this._31=this._24=this._23=0;this._33=1;this._43=this._42=this._41=this._34=0;this._44=1},isIdentity:function(){return 0!=this._41||
0!=this._42||0!=this._43||1!=this._11||1!=this._22||1!=this._33||0!=this._12||0!=this._13||0!=this._14||0!=this._21||0!=this._23||0!=this._24||0!=this._31||0!=this._32||0!=this._34?!1:1==this._44},isIdentityEpsilon:function(a){var b=this._41;(0>b?-b:b)>a?b=!0:(b=this._42,b=(0>b?-b:b)>a);b?b=!0:(b=this._43,b=(0>b?-b:b)>a);if(b)return!1;b=this._11-1;(0>b?-b:b)>a?b=!0:(b=this._22-1,b=(0>b?-b:b)>a);b?b=!0:(b=this._33-1,b=(0>b?-b:b)>a);if(b)return!1;b=this._12;(0>b?-b:b)>a?b=!0:(b=this._13,b=(0>b?-b:b)>
a);b?b=!0:(b=this._14,b=(0>b?-b:b)>a);if(b)return!1;b=this._21;(0>b?-b:b)>a?b=!0:(b=this._23,b=(0>b?-b:b)>a);b?b=!0:(b=this._24,b=(0>b?-b:b)>a);if(b)return!1;b=this._31;(0>b?-b:b)>a?b=!0:(b=this._32,b=(0>b?-b:b)>a);b?b=!0:(b=this._34,b=(0>b?-b:b)>a);if(b)return!1;b=this._44-1;return(0>b?-b:b)<=a},initRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this._11=1;this._21=this._14=this._13=this._12=0;this._22=b;this._23=a;this._31=this._24=0;this._32=-a;this._33=b;this._43=this._42=this._41=this._34=
0;this._44=1},initRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this._11=b;this._12=0;this._13=-a;this._21=this._14=0;this._22=1;this._24=this._23=0;this._31=a;this._32=0;this._33=b;this._43=this._42=this._41=this._34=0;this._44=1},initRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this._11=b;this._12=a;this._14=this._13=0;this._21=-a;this._22=b;this._32=this._31=this._24=this._23=0;this._33=1;this._43=this._42=this._41=this._34=0;this._44=1},initTranslation:function(a,b,c){null==c&&
(c=0);null==b&&(b=0);null==a&&(a=0);this._11=1;this._21=this._14=this._13=this._12=0;this._22=1;this._32=this._31=this._24=this._23=0;this._33=1;this._34=0;this._41=a;this._42=b;this._43=c;this._44=1},initScale:function(a,b,c){null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);this._11=a;this._21=this._14=this._13=this._12=0;this._22=b;this._32=this._31=this._24=this._23=0;this._33=c;this._43=this._42=this._41=this._34=0;this._44=1},initRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-
c,e=-a.x,f=-a.y;a=-a.z;var g=1/Math.sqrt(e*e+f*f+a*a);e*=g;f*=g;a*=g;g=e*d;var h=a*d;this._11=c+e*g;this._12=f*g-a*b;this._13=e*h+f*b;this._14=0;this._21=f*g+a*b;this._22=c+f*f*d;this._23=f*h-e*b;this._24=0;this._31=e*h-f*b;this._32=f*h+e*b;this._33=c+a*h;this._43=this._42=this._41=this._34=0;this._44=1},initRotation:function(a,b,c){var d=Math.cos(a);a=Math.sin(a);var e=Math.cos(b);b=Math.sin(b);var f=Math.cos(c);c=Math.sin(c);var g=d*b,h=a*b;this._11=e*f;this._12=e*c;this._13=-b;this._14=0;this._21=
h*f-d*c;this._22=h*c+d*f;this._23=a*e;this._24=0;this._31=g*f+a*c;this._32=g*c-a*f;this._33=d*e;this._43=this._42=this._41=this._34=0;this._44=1},translate:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this._11+=a*this._14;this._12+=b*this._14;this._13+=c*this._14;this._21+=a*this._24;this._22+=b*this._24;this._23+=c*this._24;this._31+=a*this._34;this._32+=b*this._34;this._33+=c*this._34;this._41+=a*this._44;this._42+=b*this._44;this._43+=c*this._44},scale:function(a,b,c){null==c&&
(c=1);null==b&&(b=1);null==a&&(a=1);this._11*=a;this._21*=a;this._31*=a;this._41*=a;this._12*=b;this._22*=b;this._32*=b;this._42*=b;this._13*=c;this._23*=c;this._33*=c;this._43*=c},rotate:function(a,b,c){var d=ca.tmp;d.initRotation(a,b,c);this.multiply(this,d)},rotateAxis:function(a,b){var c=ca.tmp;c.initRotationAxis(a,b);this.multiply(this,c)},getPosition:function(){var a=new G(0,0,0),b=this._41,c=this._42,d=this._43;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;return a},setPosition:function(a){this._41=
a.x;this._42=a.y;this._43=a.z},prependTranslation:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=this._12*a+this._22*b+this._32*c+this._42,e=this._13*a+this._23*b+this._33*c+this._43,f=this._14*a+this._24*b+this._34*c+this._44;this._41=this._11*a+this._21*b+this._31*c+this._41;this._42=d;this._43=e;this._44=f},getScale:function(){var a=new G(0,0,0);a.x=Math.sqrt(this._11*this._11+this._12*this._12+this._13*this._13);a.y=Math.sqrt(this._21*this._21+this._22*this._22+this._23*this._23);
a.z=Math.sqrt(this._31*this._31+this._32*this._32+this._33*this._33);0>this._11*(this._22*this._33-this._23*this._32)+this._12*(this._23*this._31-this._21*this._33)+this._13*(this._21*this._32-this._22*this._31)&&(a.x*=-1,a.y*=-1,a.z*=-1);return a},prependRotation:function(a,b,c){var d=ca.tmp;d.initRotation(a,b,c);this.multiply(d,this)},prependRotationAxis:function(a,b){var c=ca.tmp;c.initRotationAxis(a,b);this.multiply(c,this)},prependScale:function(a,b,c){null==c&&(c=1);null==b&&(b=1);null==a&&
(a=1);var d=ca.tmp;d.initScale(a,b,c);this.multiply(d,this)},multiply3x4:function(a,b){var c=a._11,d=a._12,e=a._13,f=a._21,g=a._22,h=a._23,k=a._31,l=a._32,m=a._33,p=a._41,r=a._42;a=a._43;var n=b._11,u=b._12,w=b._13,I=b._21,q=b._22,v=b._23,t=b._31,x=b._32,y=b._33,z=b._41,A=b._42;b=b._43;this._11=c*n+d*I+e*t;this._12=c*u+d*q+e*x;this._13=c*w+d*v+e*y;this._14=0;this._21=f*n+g*I+h*t;this._22=f*u+g*q+h*x;this._23=f*w+g*v+h*y;this._24=0;this._31=k*n+l*I+m*t;this._32=k*u+l*q+m*x;this._33=k*w+l*v+m*y;this._34=
0;this._41=p*n+r*I+a*t+z;this._42=p*u+r*q+a*x+A;this._43=p*w+r*v+a*y+b;this._44=1},multiply3x4inline:function(a,b){var c=a._11,d=a._12,e=a._13,f=a._21,g=a._22,h=a._23,k=a._31,l=a._32,m=a._33,p=a._41,r=a._42;a=a._43;var n=b._11,u=b._12,w=b._13,I=b._21,q=b._22,v=b._23,t=b._31,x=b._32,y=b._33,z=b._41,A=b._42;b=b._43;this._11=c*n+d*I+e*t;this._12=c*u+d*q+e*x;this._13=c*w+d*v+e*y;this._14=0;this._21=f*n+g*I+h*t;this._22=f*u+g*q+h*x;this._23=f*w+g*v+h*y;this._24=0;this._31=k*n+l*I+m*t;this._32=k*u+l*q+
m*x;this._33=k*w+l*v+m*y;this._34=0;this._41=p*n+r*I+a*t+z;this._42=p*u+r*q+a*x+A;this._43=p*w+r*v+a*y+b;this._44=1},multiply:function(a,b){var c=a._11,d=a._12,e=a._13,f=a._14,g=a._21,h=a._22,k=a._23,l=a._24,m=a._31,p=a._32,r=a._33,n=a._34,u=a._41,w=a._42,I=a._43;a=a._44;var q=b._11,v=b._12,t=b._13,x=b._14,y=b._21,z=b._22,A=b._23,B=b._24,C=b._31,ab=b._32,E=b._33,G=b._34,F=b._41,H=b._42,D=b._43;b=b._44;this._11=c*q+d*y+e*C+f*F;this._12=c*v+d*z+e*ab+f*H;this._13=c*t+d*A+e*E+f*D;this._14=c*x+d*B+e*G+
f*b;this._21=g*q+h*y+k*C+l*F;this._22=g*v+h*z+k*ab+l*H;this._23=g*t+h*A+k*E+l*D;this._24=g*x+h*B+k*G+l*b;this._31=m*q+p*y+r*C+n*F;this._32=m*v+p*z+r*ab+n*H;this._33=m*t+p*A+r*E+n*D;this._34=m*x+p*B+r*G+n*b;this._41=u*q+w*y+I*C+a*F;this._42=u*v+w*z+I*ab+a*H;this._43=u*t+w*A+I*E+a*D;this._44=u*x+w*B+I*G+a*b},multiplyValue:function(a){this._11*=a;this._12*=a;this._13*=a;this._14*=a;this._21*=a;this._22*=a;this._23*=a;this._24*=a;this._31*=a;this._32*=a;this._33*=a;this._34*=a;this._41*=a;this._42*=a;
this._43*=a;this._44*=a},invert:function(){this.initInverse(this)},getInverse:function(a){null==a&&(a=new ca);a.initInverse(this);return a},getDeterminant:function(){return this._11*(this._22*this._33-this._23*this._32)+this._12*(this._23*this._31-this._21*this._33)+this._13*(this._21*this._32-this._22*this._31)},inverse3x4:function(a){var b=a._11,c=a._12,d=a._13,e=a._21,f=a._22,g=a._23,h=a._31,k=a._32,l=a._33,m=a._41,p=a._42;a=a._43;this._11=f*l-g*k;this._12=d*k-c*l;this._13=c*g-d*f;this._14=0;this._21=
g*h-e*l;this._22=b*l-d*h;this._23=d*e-b*g;this._24=0;this._31=e*k-f*h;this._32=c*h-b*k;this._33=b*f-c*e;this._34=0;this._41=-e*k*a+e*l*p+h*f*a-h*g*p-m*f*l+m*g*k;this._42=b*k*a-b*l*p-h*c*a+h*d*p+m*c*l-m*d*k;this._43=-b*f*a+b*g*p+e*c*a-e*d*p-m*c*g+m*d*f;this._44=1;b=b*this._11+c*this._21+d*this._31;1E-10>(0>b?-b:b)?this.zero():(b=1/b,this._11*=b,this._12*=b,this._13*=b,this._21*=b,this._22*=b,this._23*=b,this._31*=b,this._32*=b,this._33*=b,this._41*=b,this._42*=b,this._43*=b)},initInverse:function(a){var b=
a._11,c=a._12,d=a._13,e=a._14,f=a._21,g=a._22,h=a._23,k=a._24,l=a._31,m=a._32,p=a._33,r=a._34,n=a._41,u=a._42,w=a._43;a=a._44;this._11=g*p*a-g*r*w-m*h*a+m*k*w+u*h*r-u*k*p;this._12=-c*p*a+c*r*w+m*d*a-m*e*w-u*d*r+u*e*p;this._13=c*h*a-c*k*w-g*d*a+g*e*w+u*d*k-u*e*h;this._14=-c*h*r+c*k*p+g*d*r-g*e*p-m*d*k+m*e*h;this._21=-f*p*a+f*r*w+l*h*a-l*k*w-n*h*r+n*k*p;this._22=b*p*a-b*r*w-l*d*a+l*e*w+n*d*r-n*e*p;this._23=-b*h*a+b*k*w+f*d*a-f*e*w-n*d*k+n*e*h;this._24=b*h*r-b*k*p-f*d*r+f*e*p+l*d*k-l*e*h;this._31=f*
m*a-f*r*u-l*g*a+l*k*u+n*g*r-n*k*m;this._32=-b*m*a+b*r*u+l*c*a-l*e*u-n*c*r+n*e*m;this._33=b*g*a-b*k*u-f*c*a+f*e*u+n*c*k-n*e*g;this._34=-b*g*r+b*k*m+f*c*r-f*e*m-l*c*k+l*e*g;this._41=-f*m*w+f*p*u+l*g*w-l*h*u-n*g*p+n*h*m;this._42=b*m*w-b*p*u-l*c*w+l*d*u+n*c*p-n*d*m;this._43=-b*g*w+b*h*u+f*c*w-f*d*u-n*c*h+n*d*g;this._44=b*g*p-b*h*m-f*c*p+f*d*m+l*c*h-l*d*g;b=b*this._11+c*this._21+d*this._31+e*this._41;1E-10>(0>b?-b:b)?this.zero():(b=1/b,this._11*=b,this._12*=b,this._13*=b,this._14*=b,this._21*=b,this._22*=
b,this._23*=b,this._24*=b,this._31*=b,this._32*=b,this._33*=b,this._34*=b,this._41*=b,this._42*=b,this._43*=b,this._44*=b)},initInverse3x3:function(a){var b=a._11,c=a._12,d=a._13,e=a._21,f=a._22,g=a._23,h=a._31,k=a._32;a=a._33;this._11=f*a-k*g;this._12=-c*a+k*d;this._13=c*g-f*d;this._21=-e*a+h*g;this._22=b*a-h*d;this._23=-b*g+e*d;this._31=e*k-h*f;this._32=-b*k+h*c;this._33=b*f-e*c;b=b*this._11+c*this._21+d*this._31;1E-10>(0>b?-b:b)?this.zero():(b=1/b,this._11*=b,this._12*=b,this._13*=b,this._14=0,
this._21*=b,this._22*=b,this._23*=b,this._24=0,this._31*=b,this._32*=b,this._33*=b,this._43=this._42=this._41=this._34=0,this._44=1)},front:function(){var a=this._11,b=this._12,c=this._13;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a=new G(a,b,c);b=a.x*a.x+a.y*a.y+a.z*a.z;b=1E-20>b?0:1/Math.sqrt(b);a.x*=b;a.y*=b;a.z*=b;return a},right:function(){var a=this._21,b=this._22,c=this._23;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a=new G(a,b,c);b=a.x*a.x+a.y*a.y+a.z*a.z;b=1E-20>b?0:1/Math.sqrt(b);a.x*=
b;a.y*=b;a.z*=b;return a},up:function(){var a=this._31,b=this._32,c=this._33;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a=new G(a,b,c);b=a.x*a.x+a.y*a.y+a.z*a.z;b=1E-20>b?0:1/Math.sqrt(b);a.x*=b;a.y*=b;a.z*=b;return a},transpose:function(){var a=this._12;this._12=this._21;this._21=a;a=this._13;this._13=this._31;this._31=a;a=this._14;this._14=this._41;this._41=a;a=this._23;this._23=this._32;this._32=a;a=this._24;this._24=this._42;this._42=a;a=this._34;this._34=this._43;this._43=a},clone:function(){var a=
new ca;a._11=this._11;a._12=this._12;a._13=this._13;a._14=this._14;a._21=this._21;a._22=this._22;a._23=this._23;a._24=this._24;a._31=this._31;a._32=this._32;a._33=this._33;a._34=this._34;a._41=this._41;a._42=this._42;a._43=this._43;a._44=this._44;return a},load:function(a){this._11=a._11;this._12=a._12;this._13=a._13;this._14=a._14;this._21=a._21;this._22=a._22;this._23=a._23;this._24=a._24;this._31=a._31;this._32=a._32;this._33=a._33;this._34=a._34;this._41=a._41;this._42=a._42;this._43=a._43;this._44=
a._44},loadValues:function(a){this._11=a[0];this._12=a[1];this._13=a[2];this._14=a[3];this._21=a[4];this._22=a[5];this._23=a[6];this._24=a[7];this._31=a[8];this._32=a[9];this._33=a[10];this._34=a[11];this._41=a[12];this._42=a[13];this._43=a[14];this._44=a[15]},getFloats:function(){return[this._11,this._12,this._13,this._14,this._21,this._22,this._23,this._24,this._31,this._32,this._33,this._34,this._41,this._42,this._43,this._44]},getDirection:function(){var a=new Dc;a.initRotateMatrix(this);a.normalize();
var b=1-2*(a.y*a.y+a.z*a.z),c=2*(a.x*a.y+a.z*a.w);a=2*(a.x*a.z-a.y*a.w);null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},getEulerAngles:function(){var a=this.clone();var b=Math.sqrt(this._11*this._11+this._12*this._12+this._13*this._13);var c=Math.sqrt(this._21*this._21+this._22*this._22+this._23*this._23);var d=Math.sqrt(this._31*this._31+this._32*this._32+this._33*this._33);0>this._11*(this._22*this._33-this._23*this._32)+this._12*(this._23*this._31-this._21*this._33)+this._13*
(this._21*this._32-this._22*this._31)&&(b*=-1,c*=-1,d*=-1);a.prependScale(1/b,1/c,1/d);var e=Math.sqrt(a._11*a._11+a._12*a._12);if(.01<e){var f=Math.atan2(a._23,a._33);d=Math.atan2(-a._13,e);c=Math.atan2(a._12,a._11);null==c&&(c=0);null==d&&(d=0);null==f&&(f=0);b=new G(f,d,c);f=Math.atan2(-a._23,-a._33);d=Math.atan2(-a._13,-e);c=Math.atan2(-a._12,-a._11);null==c&&(c=0);null==d&&(d=0);null==f&&(f=0);a=new G(f,d,c);return b.x*b.x+b.y*b.y+b.z*b.z<a.x*a.x+a.y*a.y+a.z*a.z?b:a}f=Math.atan2(-a._32,a._22);
d=Math.atan2(-a._13,e);c=0;null==c&&(c=0);null==d&&(d=0);null==f&&(f=0);return new G(f,d,c)},toString:function(){return"MAT=[\n  [ "+T.fmt(this._11)+", "+T.fmt(this._12)+", "+T.fmt(this._13)+", "+T.fmt(this._14)+" ]\n  [ "+T.fmt(this._21)+", "+T.fmt(this._22)+", "+T.fmt(this._23)+", "+T.fmt(this._24)+" ]\n  [ "+T.fmt(this._31)+", "+T.fmt(this._32)+", "+T.fmt(this._33)+", "+T.fmt(this._34)+" ]\n  [ "+T.fmt(this._41)+", "+T.fmt(this._42)+", "+T.fmt(this._43)+", "+T.fmt(this._44)+" ]\n]"},colorHue:function(a){if(0!=
a){var b=Math.cos(-a);a=Math.sin(-a);var c=(1-b)/3,d=ca.tmp;d._11=b+c;d._12=c-.5773502691896257*a;d._13=c+.5773502691896257*a;d._21=c+.5773502691896257*a;d._22=b+c;d._23=c-.5773502691896257*a;d._31=c-.5773502691896257*a;d._32=c+.5773502691896257*a;d._33=b+c;d._34=0;d._41=0;d._42=0;d._43=0;this.multiply3x4(this,d)}},colorSaturate:function(a){++a;var b=1-a,c=.212671*b,d=.71516*b;b*=.072169;var e=ca.tmp;e._11=c+a;e._12=c;e._13=c;e._21=d;e._22=d+a;e._23=d;e._31=b;e._32=b;e._33=b+a;e._41=0;e._42=0;e._43=
0;this.multiply3x4(this,e)},colorContrast:function(a){var b=ca.tmp,c=a+1;b._11=c;b._12=0;b._13=0;b._21=0;b._22=c;b._23=0;b._31=0;b._32=0;b._33=c;b._41=.5*-a;b._42=.5*-a;b._43=.5*-a;this.multiply3x4(this,b)},colorLightness:function(a){this._41+=a;this._42+=a;this._43+=a},colorGain:function(a,b){var c=ca.tmp;c._11=1-b;c._12=0;c._13=0;c._21=0;c._22=1-b;c._23=0;c._31=0;c._32=0;c._33=1-b;c._41=(a>>16&255)/255*b;c._42=(a>>8&255)/255*b;c._43=(a&255)/255*b;this.multiply3x4(this,c)},colorBits:function(a,b){var c=
0,d=0,e=0,f=0,g=0,h=0,k=0,l=0,m=0;1==(a&1)&&(c=1);a>>=1;1==(a&1)&&(d=1);a>>=1;1==(a&1)&&(e=1);a>>=1;1==(a&1)&&(f=1);a>>=1;1==(a&1)&&(g=1);a>>=1;1==(a&1)&&(h=1);a>>=1;1==(a&1)&&(k=1);a>>=1;1==(a&1)&&(l=1);1==(a>>1&1)&&(m=1);a=c+f+k;var p=d+g+l,r=e+h+m;1<a&&(c/=a,f/=a,k/=a);1<p&&(d/=p,g/=p,l/=p);1<r&&(e/=r,h/=r,m/=r);a=this._11*d+this._12*g+this._13*l;p=this._11*e+this._12*h+this._13*m;r=this._21*c+this._22*f+this._23*k;var n=this._21*d+this._22*g+this._23*l,u=this._21*e+this._22*h+this._23*m,w=this._31*
c+this._32*f+this._33*k;d=this._31*d+this._32*g+this._33*l;e=this._31*e+this._32*h+this._33*m;h=1-b;this._11=this._11*h+(this._11*c+this._12*f+this._13*k)*b;this._12=this._12*h+a*b;this._13=this._13*h+p*b;this._21=this._21*h+r*b;this._22=this._22*h+n*b;this._23=this._23*h+u*b;this._31=this._31*h+w*b;this._32=this._32*h+d*b;this._33=this._33*h+e*b},colorAdd:function(a){this._41+=(a>>16&255)/255;this._42+=(a>>8&255)/255;this._43+=(a&255)/255},colorSet:function(a,b){null==b&&(b=1);this.zero();this._44=
b;this._41+=(a>>16&255)/255;this._42+=(a>>8&255)/255;this._43+=(a&255)/255},adjustColor:function(a){null!=a.hue&&this.colorHue(a.hue);null!=a.saturation&&this.colorSaturate(a.saturation);null!=a.contrast&&this.colorContrast(a.contrast);null!=a.lightness&&this.colorLightness(a.lightness);null!=a.gain&&this.colorGain(a.gain.color,a.gain.alpha)},toMatrix2D:function(a){null==a&&(a=new Nc);a.a=this._11;a.b=this._12;a.c=this._21;a.d=this._22;a.x=this._41;a.y=this._42;return a},decomposeMatrix:function(a){this.load(a);
var b=Math.sqrt(this._11*this._11+this._12*this._12+this._13*this._13);var c=Math.sqrt(this._21*this._21+this._22*this._22+this._23*this._23);var d=Math.sqrt(this._31*this._31+this._32*this._32+this._33*this._33);0>this._11*(this._22*this._33-this._23*this._32)+this._12*(this._23*this._31-this._21*this._33)+this._13*(this._21*this._32-this._22*this._31)&&(b*=-1,c*=-1,d*=-1);this.prependScale(1/b,1/c,1/d);var e=this._11+this._22+this._33;if(0<e){var f=2*Math.sqrt(e+1);var g=1/f;e=(this._23-this._32)*
g;var h=(this._31-this._13)*g;var k=(this._12-this._21)*g;g=.25*f}else this._11>this._22&&this._11>this._33?(f=2*Math.sqrt(1+this._11-this._22-this._33),g=1/f,e=.25*f,h=(this._21+this._12)*g,k=(this._31+this._13)*g,g*=this._23-this._32):this._22>this._33?(f=2*Math.sqrt(1+this._22-this._11-this._33),g=1/f,e=(this._21+this._12)*g,h=.25*f,k=(this._32+this._23)*g,g*=this._31-this._13):(f=2*Math.sqrt(1+this._33-this._11-this._22),g=1/f,e=(this._31+this._13)*g,h=(this._32+this._23)*g,k=.25*f,g*=this._12-
this._21);this._11=b;this._12=e;this._13=h;this._14=0;this._21=k;this._22=c;this._23=g;this._32=this._31=this._24=0;this._33=d;this._34=0;this._41=a._41;this._42=a._42;this._43=a._43;this._44=1},recomposeMatrix:function(a){var b=a._11;var c=a._22;var d=a._33;var e=a._41;var f=a._42;var g=a._43;var h=a._12,k=a._13,l=a._21;a=a._23;null==a&&(a=1);null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);var m=h,p=k,r=a;a=this;null==a&&(a=new ca);k=m*m;h=m*p;var n=m*l;m*=r;var u=p*p,w=p*l;p*=r;var q=l*l;l*=r;a._11=
1-2*(u+q);a._12=2*(h+l);a._13=2*(n-p);a._14=0;a._21=2*(h-l);a._22=1-2*(k+q);a._23=2*(w+m);a._24=0;a._31=2*(n+p);a._32=2*(w-m);a._33=1-2*(k+u);a._34=0;a._41=0;a._42=0;a._43=0;a._44=1;this._11*=b;this._12*=b;this._13*=b;this._21*=c;this._22*=c;this._23*=c;this._31*=d;this._32*=d;this._33*=d;this._41=e;this._42=f;this._43=g},__class__:ca};var Nb={_new:function(){return new ca},multiplied:function(a,b){var c=new ca;c.multiply(a,b);return c},I:function(){var a=new ca;a.identity();return a},L:function(a){var b=
new ca;b.loadValues(a);return b},T:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=new ca;d.initTranslation(a,b,c);return d},R:function(a,b,c){var d=new ca;d.initRotation(a,b,c);return d},S:function(a,b,c){null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);var d=new ca;d.initScale(a,b,c);return d},lookAtXInline:function(a,b,c){var d=a,e=d.x*d.x+d.y*d.y+d.z*d.z;e=1E-20>e?0:1/Math.sqrt(e);var f=d.x*e,g=d.y*e;e*=d.z;null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);null==g&&(g=
0);null==f&&(f=0);a=f;var h=g,k=e;d=b;f=d.y*k-d.z*h;g=d.z*a-d.x*k;e=d.x*h-d.y*a;null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);b=f;d=g;var l=e;e=b*b+d*d+l*l;e=1E-20>e?0:1/Math.sqrt(e);f=b*e;g=d*e;e*=l;null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);b=f;d=g;l=e;1E-20>b*b+d*d+l*l&&(b=h,d=k,l=a);f=h*l-k*d;g=k*b-a*l;e=a*d-h*b;null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);c._11=
a;c._12=h;c._13=k;c._14=0;c._21=b;c._22=d;c._23=l;c._24=0;c._31=f;c._32=g;c._33=e;c._34=0;c._41=0;c._42=0;c._43=0;c._44=1;return c},lookAtX:function(a,b,c){var d;if(null==b){var e=d=0;var f=1;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=new G(d,e,f)}null==c&&(c=new ca);var g=a;f=g.x*g.x+g.y*g.y+g.z*g.z;f=1E-20>f?0:1/Math.sqrt(f);d=g.x*f;e=g.y*f;f*=g.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);a=d;var h=e,k=f;g=b;d=g.y*k-g.z*h;e=g.z*a-g.x*k;f=g.x*h-
g.y*a;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;g=e;var l=f;f=b*b+g*g+l*l;f=1E-20>f?0:1/Math.sqrt(f);d=b*f;e=g*f;f*=l;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;g=e;l=f;1E-20>b*b+g*g+l*l&&(b=h,g=k,l=a);d=h*l-k*g;e=k*b-a*l;f=a*g-h*b;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c._11=a;c._12=h;c._13=k;c._14=0;c._21=b;c._22=g;c._23=l;c._24=0;c._31=d;c._32=
e;c._33=f;c._34=0;c._41=0;c._42=0;c._43=0;c._44=1;return c}},Dc=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d};Dc.__name__="h3d.Quat";Dc.prototype={set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d},identity:function(){this.x=this.y=this.z=0;this.w=1},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},
load:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w},clone:function(){return new Dc(this.x,this.y,this.z,this.w)},initMoveTo:function(a,b){var c=a.x+b.x,d=a.y+b.y;b=a.z+b.z;this.x=a.y*b-a.z*d;this.y=a.z*c-a.x*b;this.z=a.x*d-a.y*c;this.w=a.x*c+a.y*d+a.z*b;this.normalize()},initNormal:function(a,b){null==b&&(b=0);var c=a.x*a.x+a.y*a.y+a.z*a.z;c=1E-20>c?0:1/Math.sqrt(c);var d=a.x*c;var e=a.y*c;c*=a.z;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);a=
d;var f=e,g=c;if(1E-20>a*a+f*f)d=1,c=e=0,null==c&&(c=0),null==e&&(e=0),null==d&&(d=0),this.initDirection(new G(d,e,c));else{d=a;e=f;c=0;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);var h=c;c=d*d+e*e+h*h;c=1E-20>c?0:1/Math.sqrt(c);d*=c;e*=c;c*=h;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);h=d;var k=e;e=c;d=f*e-g*k;e=g*h-a*e;c=a*k-f*h;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);
null==d&&(d=0);h=d;k=e;e=c;d=f*e-g*k;e=g*h-a*e;c=a*k-f*h;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);h=new G(d,e,c);0>g?(e=d=0,c=-1,null==c&&(c=0),null==e&&(e=0),null==d&&(d=0),this.initDirection(h,new G(d,e,c))):this.initDirection(h)}0!=b&&(d=new Dc,d.initRotateAxis(a,f,g,b),this.multiply(d,this))},initDirection:function(a,b){var c=a;var d=c.x;var e=c.y;var f=c.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);
null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);var g=d;a=e;var h=f;f=g*g+a*a+h*h;f=1E-20>f?0:1/Math.sqrt(f);d=g*f;e=a*f;f*=h;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);g=d;a=e;h=f;d=-a;e=g;f=0;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c=d;var k=e;var l=f;null!=b&&(c=b,d=c.y*h-c.z*a,e=c.z*g-c.x*h,f=c.x*a-c.y*g,null==f&&(f=0),null==e&&(e=0),null==d&&(d=0),null==f&&(f=0),null==e&&(e=0),null==d&&(d=0),c=d,k=e,
l=f);f=c*c+k*k+l*l;f=1E-20>f?0:1/Math.sqrt(f);c*=f;k*=f;l*=f;1E-20>c*c+k*k+l*l&&(c=a,k=h,l=g);d=a*l-h*k;e=h*c-g*l;f=g*k-a*c;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;d=g+k+f;0<d?(k=2*Math.sqrt(d+1),g=1/k,this.x=(l-e)*g,this.y=(b-h)*g,this.z=(a-c)*g,this.w=.25*k):g>k&&g>f?(k=2*Math.sqrt(1+g-k-f),g=1/k,this.x=.25*k,this.y=(c+a)*g,this.z=(b+h)*g,this.w=(l-e)*g):k>f?(k=2*Math.sqrt(1+k-g-f),g=1/k,this.x=(c+a)*g,this.y=.25*k,this.z=(e+l)*g,this.w=(b-h)*
g):(k=2*Math.sqrt(1+f-g-k),g=1/k,this.x=(b+h)*g,this.y=(e+l)*g,this.z=.25*k,this.w=(a-c)*g)},initRotateAxis:function(a,b,c,d){var e=Math.sin(d/2);d=Math.cos(d/2);this.x=a*e;this.y=b*e;this.z=c*e;this.w=d*Math.sqrt(a*a+b*b+c*c);this.normalize()},initRotateMatrix:function(a){var b=a._11+a._22+a._33;if(0<b){var c=2*Math.sqrt(b+1);b=1/c;this.x=(a._23-a._32)*b;this.y=(a._31-a._13)*b;this.z=(a._12-a._21)*b;this.w=.25*c}else a._11>a._22&&a._11>a._33?(c=2*Math.sqrt(1+a._11-a._22-a._33),b=1/c,this.x=.25*c,
this.y=(a._21+a._12)*b,this.z=(a._31+a._13)*b,this.w=(a._23-a._32)*b):a._22>a._33?(c=2*Math.sqrt(1+a._22-a._11-a._33),b=1/c,this.x=(a._21+a._12)*b,this.y=.25*c,this.z=(a._32+a._23)*b,this.w=(a._31-a._13)*b):(c=2*Math.sqrt(1+a._33-a._11-a._22),b=1/c,this.x=(a._31+a._13)*b,this.y=(a._32+a._23)*b,this.z=.25*c,this.w=(a._12-a._21)*b)},normalize:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;1E-20>a?(this.x=this.y=this.z=0,this.w=1):(a=1/Math.sqrt(a),this.x*=a,this.y*=a,this.z*=
a,this.w*=a)},initRotation:function(a,b,c){var d=Math.sin(.5*a);a=Math.cos(.5*a);var e=Math.sin(.5*b);b=Math.cos(.5*b);var f=Math.sin(.5*c);c=Math.cos(.5*c);var g=b*c,h=e*f;this.x=d*g-a*h;this.y=a*e*c+d*b*f;this.z=a*b*f-d*e*c;this.w=a*g+d*h},multiply:function(a,b){var c=a.w*b.y-a.x*b.z+a.y*b.w+a.z*b.x,d=a.w*b.z+a.x*b.y-a.y*b.x+a.z*b.w,e=a.w*b.w-a.x*b.x-a.y*b.y-a.z*b.z;this.x=a.x*b.w+a.w*b.x+a.y*b.z-a.z*b.y;this.y=c;this.z=d;this.w=e},toEuler:function(){return this.toMatrix().getEulerAngles()},lerp:function(a,
b,c,d){null==d&&(d=!1);var e=1-c;d&&0>a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w&&(c=-c);d=a.y*e+b.y*c;var f=a.z*e+b.z*c,g=a.w*e+b.w*c;this.x=a.x*e+b.x*c;this.y=d;this.z=f;this.w=g},slerp:function(a,b,c){var d=a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w;if(1<=(0>d?-d:d))this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w;else{var e=Math.acos(d),f=1/Math.sqrt(1-d*d);if(1E3<(0>f?-f:f)){var g=.5;d=!0;null==d&&(d=!1);c=1-g;d&&0>a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w&&(g=-g);d=a.y*c+b.y*g;e=a.z*c+b.z*g;f=a.w*c+b.w*g;this.x=a.x*c+b.x*g;this.y=
d;this.z=e;this.w=f}else g=Math.sin((1-c)*e)*f,c=Math.sin(c*e)*f*(0>d?-1:1),this.x=a.x*g+b.x*c,this.y=a.y*g+b.y*c,this.z=a.z*g+b.z*c,this.w=a.w*g+b.w*c}},conjugate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z},pow:function(a){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);b=1E-10<b?Math.atan2(b,this.w)/b:0;this.w=.5*Math.log(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.x*=b;this.y*=b;this.z*=b;this.x*=a;this.y*=a;this.z*=a;this.w*=a;b=Math.sqrt(this.x*this.x+
this.y*this.y+this.z*this.z);a=Math.exp(this.w);var c=1E-10<b?a*Math.sin(b)/b:0;this.w=a*Math.cos(b);this.x*=c;this.y*=c;this.z*=c},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},getDirection:function(){var a=1-2*(this.y*this.y+this.z*this.z),b=2*(this.x*this.y+this.z*this.w),c=2*(this.x*this.z-this.y*this.w);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},getUpAxis:function(){var a=
2*(this.x*this.z+this.y*this.w),b=2*(this.y*this.z-this.x*this.w),c=1-2*(this.x*this.x+this.y*this.y);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},toMatrix:function(a){null==a&&(a=new ca);var b=this.x*this.x,c=this.x*this.y,d=this.x*this.z,e=this.x*this.w,f=this.y*this.y,g=this.y*this.z,h=this.y*this.w,k=this.z*this.z,l=this.z*this.w;a._11=1-2*(f+k);a._12=2*(c+l);a._13=2*(d-h);a._14=0;a._21=2*(c-l);a._22=1-2*(b+k);a._23=2*(g+e);a._24=0;a._31=2*(d+h);a._32=2*(g-e);a._33=1-2*(b+
f);a._34=0;a._41=0;a._42=0;a._43=0;a._44=1;return a},toString:function(){return"{"+T.fmt(this.x)+","+T.fmt(this.y)+","+T.fmt(this.z)+","+T.fmt(this.w)+"}"},weightedBlend:function(a,b,c){this.w=this.z=this.y=this.x=0;var d=c.x,e=c.y,f=c.z,g=c.w;null==g&&(g=1);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);d=-d;e=-e;f=-f;for(var h=0;h<a.length;){var k=a[h];var l=h++;l=b[l];var m=d*k.w+g*k.x+e*k.z-f*k.y;var p=g*k.y-d*k.z+e*k.w+f*k.x;var r=g*k.z+d*k.y-e*k.x+f*k.w;k=g*k.w-d*k.x-e*k.y-f*k.z;0>k&&(m=-m,p=
-p,r=-r,k=-k);k*=l;m*=l;p*=l;r*=l;this.w+=k;this.x+=m;this.y+=p;this.z+=r}a=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;1E-20>a?(this.x=this.y=this.z=0,this.w=1):(a=1/Math.sqrt(a),this.x*=a,this.y*=a,this.z*=a,this.w*=a);m=c.x*this.w+c.w*this.x+c.y*this.z-c.z*this.y;p=c.w*this.y-c.x*this.z+c.y*this.w+c.z*this.x;r=c.w*this.z+c.x*this.y-c.y*this.x+c.z*this.w;k=c.w*this.w-c.x*this.x-c.y*this.y-c.z*this.z;this.x=m;this.y=p;this.z=r;this.w=k;0>this.w&&(this.x=-this.x,this.y=-this.y,this.z=
-this.z,this.w=-this.w)},__class__:Dc};var G=function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c};G.__name__="h3d.VectorImpl";G.prototype={distance:function(a){var b=a.x-this.x,c=a.y-this.y;a=a.z-this.z;return Math.sqrt(b*b+c*c+a*a)},distanceSq:function(a){var b=a.x-this.x,c=a.y-this.y;a=a.z-this.z;return b*b+c*c+a*a},sub:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},add:function(a){var b=
this.x+a.x,c=this.y+a.y;a=this.z+a.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},scaled:function(a){var b=this.x*a,c=this.y*a;a*=this.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},equals:function(a){return this.x==a.x&&this.y==a.y?this.z==a.z:!1},cross:function(a){var b=this.y*a.z-this.z*a.y,c=this.z*a.x-this.x*a.z;a=this.x*a.y-this.y*a.x;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*
a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;a=1E-20>a?0:1/Math.sqrt(a);this.x*=a;this.y*=a;this.z*=a},normalized:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;a=1E-20>a?0:1/Math.sqrt(a);var b=this.x*a,c=this.y*a;a*=this.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},packNormal:function(){this.x=
.5*this.x+.5;this.y=.5*this.y+.5;this.z=.5*this.z+.5},unpackNormal:function(){this.x=2*this.x-1;this.y=2*this.y-1;this.z=2*this.z-1},normalStrength:function(a){a=1/a;this.x*=a;this.y*=a;a=this.x*this.x+this.y*this.y+this.z*this.z;a=1E-20>a?0:1/Math.sqrt(a);this.x*=a;this.y*=a;this.z*=a},set:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c},load:function(a){this.x=a.x;this.y=a.y;this.z=a.z},scale:function(a){this.x*=a;this.y*=a;this.z*=a},lerp:function(a,b,c){var d=
a.x;this.x=d+c*(b.x-d);d=a.y;this.y=d+c*(b.y-d);d=a.z;this.z=d+c*(b.z-d)},transform:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32+a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+a._43;this.x=this.x*a._11+this.y*a._21+this.z*a._31+a._41;this.y=b;this.z=c},transformed:function(a){var b=this.x*a._11+this.y*a._21+this.z*a._31+a._41,c=this.x*a._12+this.y*a._22+this.z*a._32+a._42;a=this.x*a._13+this.y*a._23+this.z*a._33+a._43;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},transform3x3:function(a){var b=
this.x*a._12+this.y*a._22+this.z*a._32,c=this.x*a._13+this.y*a._23+this.z*a._33;this.x=this.x*a._11+this.y*a._21+this.z*a._31;this.y=b;this.z=c},transformed3x3:function(a){var b=this.x*a._11+this.y*a._21+this.z*a._31,c=this.x*a._12+this.y*a._22+this.z*a._32;a=this.x*a._13+this.y*a._23+this.z*a._33;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},clone:function(){var a=this.x,b=this.y,c=this.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},toVector4:function(){var a=
this.x,b=this.y,c=this.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new O(a,b,c,1)},to2D:function(){var a=this.x,b=this.y;null==b&&(b=0);null==a&&(a=0);return new Da(a,b)},toString:function(){return"{"+T.fmt(this.x)+","+T.fmt(this.y)+","+T.fmt(this.z)+"}"},reflect:function(a){var b=2*(this.x*a.x+this.y*a.y+this.z*a.z),c=this.x-b*a.x,d=this.y-b*a.y;a=this.z-b*a.z;null==a&&(a=0);null==d&&(d=0);null==c&&(c=0);return new G(c,d,a)},project:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32+
a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+a._43,d=1/(this.x*a._14+this.y*a._24+this.z*a._34+a._44);this.x=(this.x*a._11+this.y*a._21+this.z*a._31+a._41)*d;this.y=b*d;this.z=c*d},get_r:function(){return this.x},get_g:function(){return this.y},get_b:function(){return this.z},set_r:function(a){return this.x=a},set_g:function(a){return this.y=a},set_b:function(a){return this.z=a},setColor:function(a){this.x=(a>>16&255)/255;this.y=(a>>8&255)/255;this.z=(a&255)/255},makeColor:function(a,b,c){null==
c&&(c=.5);null==b&&(b=1);a%=6.283185307179586;a=0<=a?a:a+6.283185307179586;var d=2*c-1;b*=1-(0>d?-d:d);d=3*a/3.141592653589793%2-1;d=b*(1-(0>d?-d:d));c-=b/2;1.0471975511965976>a?(this.x=b,this.y=d,this.z=0):2.0943951023931953>a?(this.x=d,this.y=b,this.z=0):3.141592653589793>a?(this.x=0,this.y=b,this.z=d):4.1887902047863905>a?(this.x=0,this.y=d,this.z=b):5.235987755982989>a?(this.x=d,this.y=0,this.z=b):(this.x=b,this.y=0,this.z=d);this.x+=c;this.y+=c;this.z+=c},toColor:function(){var a=this.x,b=this.y,
c=this.z;return-16777216|(255*(0>a?0:1<a?1:a)+.499|0)<<16|(255*(0>b?0:1<b?1:b)+.499|0)<<8|255*(0>c?0:1<c?1:c)+.499|0},toColorHSL:function(){var a=this.x,b=this.y;a=a<b?b:a;b=this.z;var c=a<b?b:a;a=this.x;b=this.y;a=a>b?b:a;b=this.z;a=a>b?b:a;b=(c+a)/2;if(c==a)c=a=0;else{var d=c-a;a=.5<b?d/(2-c-a):d/(c+a);c=c==this.x?(this.y-this.z)/d+(this.y<this.z?6:0):c==this.y?(this.z-this.x)/d+2:(this.x-this.y)/d+4;c*=1.0471975511965976}null==b&&(b=0);null==a&&(a=0);null==c&&(c=0);return new G(c,a,b)},toColorHSV:function(){var a=
this.x,b=this.y;a=a<b?b:a;b=this.z;var c=a<b?b:a;a=this.x;b=this.y;a=a>b?b:a;b=this.z;b=a>b?b:a;c==b?a=b=0:(a=c-b,b=1<c+b?a/(2-c-b):a/(c+b),a=c==this.x?(this.y-this.z)/a+(this.y<this.z?6:0):c==this.y?(this.z-this.x)/a+2:(this.x-this.y)/a+4,a*=1.0471975511965976);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},__class__:G};var O=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d};O.__name__="h3d.Vector4Impl";O.prototype=
{dot4:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},dot3:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},scale3:function(a){this.x*=a;this.y*=a;this.z*=a},scale4:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a},sub:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;a=this.w-a.w;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new O(b,c,d,a)},add:function(a){var b=this.x+a.x,c=this.y+a.y,d=this.z+a.z;a=this.w+a.w;null==a&&(a=1);null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);return new O(b,c,d,a)},equals:function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z?this.w==a.w:!1},cross:function(a){var b=this.y*a.z-this.z*a.y,c=this.z*a.x-this.x*a.z;a=this.x*a.y-this.y*a.x;var d=1;null==d&&(d=1);null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new O(b,c,a,d)},set:function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d},load:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w},lerp:function(a,
b,c){var d=a.x;this.x=d+c*(b.x-d);d=a.y;this.y=d+c*(b.y-d);d=a.z;this.z=d+c*(b.z-d);d=a.w;this.w=d+c*(b.w-d)},transform:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32+this.w*a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43,d=this.x*a._14+this.y*a._24+this.z*a._34+this.w*a._44;this.x=this.x*a._11+this.y*a._21+this.z*a._31+this.w*a._41;this.y=b;this.z=c;this.w=d},transformed:function(a){var b=this.x*a._11+this.y*a._21+this.z*a._31+this.w*a._41,c=this.x*a._12+this.y*a._22+this.z*
a._32+this.w*a._42,d=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43;a=this.x*a._14+this.y*a._24+this.z*a._34+this.w*a._44;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new O(b,c,d,a)},transform3x4:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32+this.w*a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43;this.x=this.x*a._11+this.y*a._21+this.z*a._31+this.w*a._41;this.y=b;this.z=c},transformed3x4:function(a){var b=this.x*a._11+this.y*a._21+this.z*a._31+this.w*
a._41,c=this.x*a._12+this.y*a._22+this.z*a._32+this.w*a._42;a=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new O(b,c,a,1)},transform3x3:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32,c=this.x*a._13+this.y*a._23+this.z*a._33;this.x=this.x*a._11+this.y*a._21+this.z*a._31;this.y=b;this.z=c},transformed3x3:function(a){var b=this.x*a._11+this.y*a._21+this.z*a._31,c=this.x*a._12+this.y*a._22+this.z*a._32;a=this.x*a._13+this.y*a._23+this.z*
a._33;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new O(b,c,a,1)},clone:function(){var a=this.x,b=this.y,c=this.z,d=this.w;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new O(a,b,c,d)},toVector:function(){var a=this.x,b=this.y,c=this.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},toString:function(){return"{"+T.fmt(this.x)+","+T.fmt(this.y)+","+T.fmt(this.z)+","+T.fmt(this.w)+"}"},project:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32+this.w*
a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43,d=1/(this.x*a._14+this.y*a._24+this.z*a._34+this.w*a._44);this.x=(this.x*a._11+this.y*a._21+this.z*a._31+this.w*a._41)*d;this.y=b*d;this.z=c*d;this.w=1},get_r:function(){return this.x},get_g:function(){return this.y},get_b:function(){return this.z},get_a:function(){return this.w},set_r:function(a){return this.x=a},set_g:function(a){return this.y=a},set_b:function(a){return this.z=a},set_a:function(a){return this.w=a},setColor:function(a){this.x=
(a>>16&255)/255;this.y=(a>>8&255)/255;this.z=(a&255)/255;this.w=(a>>>24)/255},makeColor:function(a,b,c){null==c&&(c=.5);null==b&&(b=1);a%=6.283185307179586;a=0<=a?a:a+6.283185307179586;var d=2*c-1;b*=1-(0>d?-d:d);d=3*a/3.141592653589793%2-1;d=b*(1-(0>d?-d:d));c-=b/2;1.0471975511965976>a?(this.x=b,this.y=d,this.z=0):2.0943951023931953>a?(this.x=d,this.y=b,this.z=0):3.141592653589793>a?(this.x=0,this.y=b,this.z=d):4.1887902047863905>a?(this.x=0,this.y=d,this.z=b):5.235987755982989>a?(this.x=d,this.y=
0,this.z=b):(this.x=b,this.y=0,this.z=d);this.x+=c;this.y+=c;this.z+=c;this.w=1},toColor:function(){var a=this.w,b=this.x,c=this.y,d=this.z;return(255*(0>a?0:1<a?1:a)+.499|0)<<24|(255*(0>b?0:1<b?1:b)+.499|0)<<16|(255*(0>c?0:1<c?1:c)+.499|0)<<8|255*(0>d?0:1<d?1:d)+.499|0},toColorHSL:function(){var a=this.x,b=this.y;a=a<b?b:a;b=this.z;var c=a<b?b:a;a=this.x;b=this.y;a=a>b?b:a;b=this.z;a=a>b?b:a;b=(c+a)/2;if(c==a)c=a=0;else{var d=c-a;a=.5<b?d/(2-c-a):d/(c+a);c=c==this.x?(this.y-this.z)/d+(this.y<this.z?
6:0):c==this.y?(this.z-this.x)/d+2:(this.x-this.y)/d+4;c*=1.0471975511965976}d=this.w;null==d&&(d=1);null==b&&(b=0);null==a&&(a=0);null==c&&(c=0);return new O(c,a,b,d)},toColorHSV:function(){var a=this.x,b=this.y;a=a<b?b:a;b=this.z;var c=a<b?b:a;a=this.x;b=this.y;a=a>b?b:a;b=this.z;a=a>b?b:a;c==a?b=a=0:(b=c-a,a=1<c+a?b/(2-c-a):b/(c+a),b=c==this.x?(this.y-this.z)/b+(this.y<this.z?6:0):c==this.y?(this.z-this.x)/b+2:(this.x-this.y)/b+4,b*=1.0471975511965976);var d=this.w;null==d&&(d=1);null==c&&(c=0);
null==a&&(a=0);null==b&&(b=0);return new O(b,a,c,d)},__class__:O};var mf=function(a){this.objectName=a};mf.__name__="h3d.anim.AnimatedObject";mf.prototype={clone:function(){return new mf(this.objectName)},__class__:mf};var Ec=function(a,b,c){this.name=a;this.frameCount=b;this.sampling=c;this.objects=[];this.lastEvent=-1;this.frame=0;this.speed=1;this.loop=!0;this.pause=!1};Ec.__name__="h3d.anim.Animation";Ec.prototype={getDuration:function(){return this.frameCount/(this.sampling*this.speed)},frameToTime:function(a){return a/
(this.sampling*this.speed)},getIFrame:function(){var a=this.frame|0,b=this.endFrame();a==b&&--a;return a},unbind:function(a){for(var b=0,c=this.objects;b<c.length;){var d=c[b];++b;if(d.objectName==a){this.isSync=!1;d.targetObject=null;d.targetSkin=null;break}}},setEvents:function(a){for(var b=[],c=0,d=this.frameCount;c<d;)c++,b.push(null);this.events=b;for(a=Na(a);a.hasNext();)b=a.next(),null==this.events[b.frame]&&(this.events[b.frame]=[]),this.events[b.frame].push(b.data)},addEvent:function(a,b){null==
this.events&&(this.events=[]);null==this.events[a]?this.events[a]=[b]:this.events[a].push(b)},removeEvent:function(a,b){if(null==this.events||null==this.events[a]||-1==this.events[a].indexOf(b))throw t.thrown("Can't delete event "+b+" because it doesn't exist at frame "+a);F.remove(this.events[a],b);0==this.events[a].length&&(this.events[a]=null)},getEvents:function(){return this.events},getObjects:function(){return this.objects},getEventTime:function(a){if(null==this.events)return null;for(var b=
0,c=this.events.length;b<c;){var d=b++,e=this.events[d];if(null!=e&&0<=e.indexOf(a))return d/(this.sampling*this.speed)}return null},setFrame:function(a){this.frame=a;for(this.lastEvent=-1;0>this.frame;)this.frame+=this.frameCount;for(;this.frame>this.frameCount;)this.frame-=this.frameCount},clone:function(a){null==a&&(a=new Ec(this.name,this.frameCount,this.sampling));a.objects=this.objects;a.speed=this.speed;a.loop=this.loop;a.pause=this.pause;a.events=this.events;a.resourcePath=this.resourcePath;
return a},initInstance:function(){this.isInstance=!0},createInstance:function(a){for(var b,c=[],d=0,e=this.objects;d<e.length;)b=e[d],++d,c.push(b.clone());b=this.clone();b.objects=c;b.bind(a);b.initInstance();return b},bind:function(a){for(var b=null,c=0,d=this.objects.slice();c<d.length;){var e=d[c];++c;if(null!=b){var f=b.skinData.namedJoints.h[e.objectName];if(null!=f){e.targetSkin=b;e.targetJoint=f.index;continue}}f=a.getObjectByName(e.objectName);if(null==f)F.remove(this.objects,e);else{var g=
f instanceof Ye?f:null;null!=g?(b=g.parent,e.targetSkin=null!=b?b:g.skin,e.targetJoint=g.index):e.targetObject=f}}this.isSync=!1},getPropValue:function(a,b){return null},sync:function(a){throw t.thrown("assert");},isPlaying:function(){return this.pause?!1:1E-6<(0>this.speed?-this.speed:this.speed)},endFrame:function(){return this.frameCount},update:function(a){if(!this.isInstance)throw t.thrown("You must instantiate this animation first");if(!this.isPlaying())return 0;if(null!=this.events&&null!=
this.onEvent){var b=this.frame|0,c=this.frame+a*this.speed*this.sampling|0;c>=this.frameCount&&(c=this.frameCount-1);for(var d=c+1;b<d;)if(c=b++,c!=this.lastEvent&&(this.lastEvent=c,null!=this.events[c])){b=this.frame;d=a;a-=(c-this.frame)/(this.speed*this.sampling);this.frame=c;for(var e=0,f=this.events[c];e<f.length;){var g=f[e];++e;this.onEvent(g)}if(this.frame==c&&c==this.frameCount-1){this.frame=b;a=d;break}else return a}}if(null!=this.onAnimEnd&&(c=this.endFrame(),b=0==this.speed?0:(c-this.frame)/
(this.speed*this.sampling),b<=a&&0<b))return this.frame=c,a-=b,this.onAnimEnd(),this.frame==c&&this.isPlaying()&&(this.loop?this.frame=0:a=0),a;this.frame+=a*this.speed*this.sampling;this.frame>=this.frameCount&&(this.frame=this.loop?this.frame%this.frameCount:this.frameCount);return 0},initAndBind:function(a){this.bind(a);this.initInstance();this.pause=!0},toString:function(){return this.name},__class__:Ec};var Ea=K["h3d.anim.DataLayout"]={__ename__:!0,__constructs__:null,Position:{_hx_name:"Position",
_hx_index:0,__enum__:"h3d.anim.DataLayout",toString:v},Rotation:{_hx_name:"Rotation",_hx_index:1,__enum__:"h3d.anim.DataLayout",toString:v},Scale:{_hx_name:"Scale",_hx_index:2,__enum__:"h3d.anim.DataLayout",toString:v},UV:{_hx_name:"UV",_hx_index:3,__enum__:"h3d.anim.DataLayout",toString:v},Alpha:{_hx_name:"Alpha",_hx_index:4,__enum__:"h3d.anim.DataLayout",toString:v},Property:{_hx_name:"Property",_hx_index:5,__enum__:"h3d.anim.DataLayout",toString:v},SingleFrame:{_hx_name:"SingleFrame",_hx_index:6,
__enum__:"h3d.anim.DataLayout",toString:v}};Ea.__constructs__=[Ea.Position,Ea.Rotation,Ea.Scale,Ea.UV,Ea.Alpha,Ea.Property,Ea.SingleFrame];Ea.__empty_constructs__=[Ea.Position,Ea.Rotation,Ea.Scale,Ea.UV,Ea.Alpha,Ea.Property,Ea.SingleFrame];var Uf=function(a,b){this.objectName=a;this.dataOffset=b};Uf.__name__="h3d.anim.BufferObject";Uf.__super__=mf;Uf.prototype=D(mf.prototype,{getStride:function(){var a=0;0!=(this.layout&1<<Ea.Position._hx_index)&&(a+=3);0!=(this.layout&1<<Ea.Rotation._hx_index)&&
(a+=3);0!=(this.layout&1<<Ea.Scale._hx_index)&&(a+=3);0!=(this.layout&1<<Ea.UV._hx_index)&&(a+=2);0!=(this.layout&1<<Ea.Alpha._hx_index)&&++a;0!=(this.layout&1<<Ea.Property._hx_index)&&++a;return a},clone:function(){var a=new Uf(this.objectName,this.dataOffset);a.layout=this.layout;a.propName=this.propName;return a},__class__:Uf});var ue=function(a,b,c){Ec.call(this,a,b,c);this.syncFrame=-1};ue.__name__="h3d.anim.BufferAnimation";ue.__super__=Ec;ue.prototype=D(Ec.prototype,{setData:function(a,b){this.data=
a;this.stride=b},addObject:function(a,b){a=new Uf(a,b);this.objects.push(a);return a},getPropValue:function(a,b){for(var c=0,d=this.objects;c<d.length;){var e=d[c];++c;if(e.objectName==a&&e.propName==b)return e.propCurrentValue}return null},getFrames:function(){return this.objects},clone:function(a){null==a&&(a=new ue(this.name,this.frameCount,this.sampling));Ec.prototype.clone.call(this,a);(a instanceof ue?a:null).setData(this.data,this.stride);return a},endFrame:function(){return this.loop?this.frameCount:
this.frameCount-1},initInstance:function(){Ec.prototype.initInstance.call(this);for(var a=this.objects,b=0;b<a.length;){var c=a[b];++b;0!=(c.layout&1<<Ea.Property._hx_index)&&(c.propCurrentValue=this.data[c.dataOffset]);if(0!=(c.layout&1<<Ea.Alpha._hx_index))if(null!=c.targetObject){var d=c.targetObject;d=null==(d instanceof Ra?d:null)}else d=!0;else d=!1;if(d)throw t.thrown(c.objectName+" should be a mesh (for alpha animation)");if(0!=(c.layout&1<<Ea.Position._hx_index)||0!=(c.layout&1<<Ea.Rotation._hx_index)||
0!=(c.layout&1<<Ea.Scale._hx_index))c.matrix=new ca,c.matrix.identity(),0==(c.layout&1<<Ea.Position._hx_index)&&null!=c.targetSkin&&(d=c.targetSkin.getSkinData().allJoints[c.targetJoint].defMat,c.matrix._14=d._41,c.matrix._24=d._42,c.matrix._34=d._43)}a.sort(M(this,this.sortByFrameCountDesc))},sortByFrameCountDesc:function(a,b){return(0!=(b.layout&1<<Ea.SingleFrame._hx_index)?0:1)-(0!=(a.layout&1<<Ea.SingleFrame._hx_index)?0:1)},uvLerp:function(a,b,c){a%=1;b%=1;a<b-.5?++a:a>b+.5&&--a;return a*(1-
c)+b*c},sync:function(a){null==a&&(a=!1);if(this.frame!=this.syncFrame||a){var b=this.frame|0;var c=this.endFrame();b==c&&--b;c=b;var d=(c+1)%this.frameCount,e=this.frame-c,f=1-e;0>c?c=d=0:this.frame>=this.frameCount?c=d=this.frameCount-1:this.loop||0!=d||(d=this.frameCount-1);this.syncFrame=this.frame;a&&(this.isSync=!1);for(var g=0,h=this.objects;g<h.length;){var k=h[g];++g;if(null!=k.targetObject||null!=k.targetSkin){var l=k.layout,m=this.stride*c+k.dataOffset,p=this.stride*d+k.dataOffset;if(0!=
(l&1<<Ea.SingleFrame._hx_index)){if(this.isSync)break;m=p=k.dataOffset}var r=k.matrix;if(null!=r){var n=k.targetSkin;n=null!=n?n.skinData:null;if(null==n||n.allJoints[k.targetJoint].shouldReceiveAnimation())if(0!=(l&1<<Ea.Position._hx_index)?(r._41=this.data[m++]*f+this.data[p++]*e,r._42=this.data[m++]*f+this.data[p++]*e,r._43=this.data[m++]*f+this.data[p++]*e):(r._41=r._14,r._42=r._24,r._43=r._34),0!=(l&1<<Ea.Rotation._hx_index)){var u=this.data[m++];n=this.data[m++];var w=this.data[m++];b=1-(u*
u+n*n+w*w);b=Math.sqrt(0>b?-b:b);var q=this.data[p++],v=this.data[p++],t=this.data[p++],x=1-(q*q+v*v+t*t);x=Math.sqrt(0>x?-x:x);var y=0>u*q+n*v+w*t+b*x?-e:e;u=u*f+q*y;n=n*f+v*y;w=w*f+t*y;b=b*f+x*y;t=1/Math.sqrt(u*u+n*n+w*w+b*b);u*=t;n*=t;w*=t;b*=t;if(a)r._12=u,r._13=n,r._21=w,r._23=b,0!=(l&1<<Ea.Scale._hx_index)?(r._11=this.data[m++]*f+this.data[p++]*e,r._22=this.data[m++]*f+this.data[p++]*e,r._33=this.data[m++]*f+this.data[p++]*e):(r._11=1,r._22=1,r._33=1);else{t=u*u;x=u*n;y=u*w;u*=b;v=n*n;q=n*w;
n*=b;var z=w*w;w*=b;r._11=1-2*(v+z);r._12=2*(x+w);r._13=2*(y-n);r._21=2*(x-w);r._22=1-2*(t+z);r._23=2*(q+u);r._31=2*(y+n);r._32=2*(q-u);r._33=1-2*(t+v);0!=(l&1<<Ea.Scale._hx_index)&&(n=this.data[m++]*f+this.data[p++]*e,w=this.data[m++]*f+this.data[p++]*e,u=this.data[m++]*f+this.data[p++]*e,r._11*=n,r._12*=n,r._13*=n,r._21*=w,r._22*=w,r._23*=w,r._31*=u,r._32*=u,r._33*=u)}}else r._12=0,r._13=0,r._21=0,r._23=a?1:0,0!=(l&1<<Ea.Scale._hx_index)?(r._11=this.data[m++]*f+this.data[p++]*e,r._22=this.data[m++]*
f+this.data[p++]*e,r._33=this.data[m++]*f+this.data[p++]*e):(r._11=1,r._22=1,r._33=1);null!=k.targetSkin?(k.targetSkin.jointsData[k.targetJoint].currentRelPose=r,k.targetSkin.jointsUpdated=!0):(n=k.targetObject,n.defaultTransform=r,n.flags|=1,0!=(n.flags&131072)&&(n.flags|=262144))}0!=(l&1<<Ea.UV._hx_index)&&(n=k.targetObject.toMesh().material,r=n.passes.getShader(Kd),null==r&&(r=n.passes.addShader(new Kd),n.get_texture().set_wrap(Qd.Repeat)),n=this.data[m++],w=this.data[p++],n%=1,w%=1,n<w-.5?++n:
n>w+.5&&--n,r.uvDelta__.x=n*(1-e)+w*e,n=this.data[m++],w=this.data[p++],n%=1,w%=1,n<w-.5?++n:n>w+.5&&--n,r.uvDelta__.y=n*(1-e)+w*e);0!=(l&1<<Ea.Alpha._hx_index)&&(r=k.targetObject.toMesh().material,r.blendMode==ya.None&&r.set_blendMode(ya.Alpha),r.mshader.color__.w=this.data[m++]*f+this.data[p++]*e);0!=(l&1<<Ea.Property._hx_index)&&(k.propCurrentValue=this.data[m++]*f+this.data[p++]*e)}}a||(this.isSync=!0)}},__class__:ue});var Ph=function(){};Ph.__name__="h3d.anim.LinearFrame";Ph.prototype={toMatrix:function(){var a=
new ca;(new Dc(this.qx,this.qy,this.qz,this.qw)).toMatrix(a);a.prependScale(this.sx,this.sy,this.sz);a.translate(this.tx,this.ty,this.tz);return a},__class__:Ph};var ee=function(a){this.hasPosition=!0;this.objectName=a};ee.__name__="h3d.anim.LinearObject";ee.__super__=mf;ee.prototype=D(mf.prototype,{clone:function(){var a=new ee(this.objectName);a.hasPosition=this.hasPosition;a.hasRotation=this.hasRotation;a.hasScale=this.hasScale;a.frames=this.frames;a.alphas=this.alphas;a.uvs=this.uvs;a.propName=
this.propName;a.propValues=this.propValues;return a},__class__:ee});var Vf=function(a,b,c){Ec.call(this,a,b,c);this.syncFrame=-1};Vf.__name__="h3d.anim.LinearAnimation";Vf.__super__=Ec;Vf.prototype=D(Ec.prototype,{addCurve:function(a,b,c,d,e){a=new ee(a);a.frames=b;a.hasPosition=c;a.hasRotation=d;a.hasScale=e;this.objects.push(a)},addAlphaCurve:function(a,b){a=new ee(a);a.alphas=b;this.objects.push(a)},addUVCurve:function(a,b){a=new ee(a);a.uvs=b;this.objects.push(a)},addPropCurve:function(a,b,c){a=
new ee(a);a.propName=b;a.propValues=c;this.objects.push(a)},getPropValue:function(a,b){for(var c=0,d=this.objects;c<d.length;){var e=d[c];++c;if(e.objectName==a&&e.propName==b)return e.propCurrentValue}return null},getFrames:function(){return this.objects},clone:function(a){null==a&&(a=new Vf(this.name,this.frameCount,this.sampling));Ec.prototype.clone.call(this,a);return a},endFrame:function(){return this.loop?this.frameCount:this.frameCount-1},initInstance:function(){Ec.prototype.initInstance.call(this);
for(var a=this.objects,b=0;b<a.length;){var c=a[b];++b;if(null!=c.propValues)c.propCurrentValue=c.propValues[0];else{if(null!=c.alphas)if(null!=c.targetObject){var d=c.targetObject;d=null==(d instanceof Ra?d:null)}else d=!0;else d=!1;if(d)throw t.thrown(c.objectName+" should be a mesh (for alpha animation)");null==c.uvs&&null==c.alphas&&(c.matrix=new ca,c.matrix.identity())}}a.sort(M(this,this.sortByFrameCountDesc))},sortByFrameCountDesc:function(a,b){return(null==b.frames?10:b.frames.length)-(null==
a.frames?10:a.frames.length)},uvLerp:function(a,b,c){a%=1;b%=1;a<b-.5?++a:a>b+.5&&--a;return a*(1-c)+b*c},sync:function(a){null==a&&(a=!1);if(this.frame!=this.syncFrame||a){var b=this.frame|0;var c=this.endFrame();b==c&&--b;c=b;var d=(c+1)%this.frameCount,e=this.frame-c,f=1-e;0>c?c=d=0:this.frame>=this.frameCount?c=d=this.frameCount-1:this.loop||0!=d||(d=this.frameCount-1);this.syncFrame=this.frame;a&&(this.isSync=!1);for(var g=0,h=this.objects;g<h.length;)if(b=h[g],++g,null!=b.targetObject||null!=
b.targetSkin)if(null!=b.alphas){var k=b.targetObject.toMesh().material;k.blendMode==ya.None&&k.set_blendMode(ya.Alpha);k.mshader.color__.w=b.alphas[c]*f+b.alphas[d]*e}else if(null!=b.uvs){var l=b.targetObject.toMesh().material;k=l.passes.getShader(Kd);null==k&&(k=l.passes.addShader(new Kd),l.get_texture().set_wrap(Qd.Repeat));l=b.uvs[c<<1];var m=b.uvs[d<<1];l%=1;m%=1;l<m-.5?++l:l>m+.5&&--l;k.uvDelta__.x=l*(1-e)+m*e;l=b.uvs[c<<1|1];b=b.uvs[d<<1|1];l%=1;b%=1;l<b-.5?++l:l>b+.5&&--l;k.uvDelta__.y=l*(1-
e)+b*e}else if(null!=b.propValues)b.propCurrentValue=b.propValues[c]*f+b.propValues[d]*e;else{k=c;l=d;if(1==b.frames.length){if(this.isSync)break;k=l=0}k=b.frames[k];m=b.frames[l];l=b.matrix;l._41=k.tx*f+m.tx*e;l._42=k.ty*f+m.ty*e;l._43=k.tz*f+m.tz*e;if(b.hasRotation){var p=0>k.qx*m.qx+k.qy*m.qy+k.qz*m.qz+k.qw*m.qw?-e:e,r=k.qx*f+m.qx*p,n=k.qy*f+m.qy*p,u=k.qz*f+m.qz*p;p=k.qw*f+m.qw*p;var w=1/Math.sqrt(r*r+n*n+u*u+p*p);r*=w;n*=w;u*=w;p*=w;if(a)l._12=r,l._13=n,l._21=u,l._23=p,b.hasScale?(l._11=k.sx*
f+m.sx*e,l._22=k.sy*f+m.sy*e,l._33=k.sz*f+m.sz*e):(l._11=1,l._22=1,l._33=1);else{w=r*r;var q=r*n,v=r*u;r*=p;var t=n*n,x=n*u;n*=p;var y=u*u;u*=p;l._11=1-2*(t+y);l._12=2*(q+u);l._13=2*(v-n);l._21=2*(q-u);l._22=1-2*(w+y);l._23=2*(x+r);l._31=2*(v+n);l._32=2*(x-r);l._33=1-2*(w+t);b.hasScale&&(u=k.sx*f+m.sx*e,p=k.sy*f+m.sy*e,k=k.sz*f+m.sz*e,l._11*=u,l._12*=u,l._13*=u,l._21*=p,l._22*=p,l._23*=p,l._31*=k,l._32*=k,l._33*=k)}}else l._12=0,l._13=0,l._21=0,l._23=a?1:0,b.hasScale?(l._11=k.sx*f+m.sx*e,l._22=k.sy*
f+m.sy*e,l._33=k.sz*f+m.sz*e):(l._11=1,l._22=1,l._33=1);null!=b.targetSkin?(b.targetSkin.jointsData[b.targetJoint].currentRelPose=b.matrix,b.targetSkin.jointsUpdated=!0):(k=b.targetObject,k.defaultTransform=b.matrix,b=1,k.flags|=b,0!=(k.flags&131072)&&(k.flags|=262144))}a||(this.isSync=!0)}},__class__:Vf});var Ze=function(){this.splitIndex=this.bindIndex=-1;this.subs=[]};Ze.__name__="h3d.anim.Joint";Ze.prototype={shouldReceiveAnimation:function(){return!0},makeRuntimeData:function(){return new nf},
__class__:Ze};var Sd=function(){this.slackness=0;this.damping=this.stiffness=this.resistance=1;var a=0,b=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.lockAxis=new G(a,b,c);this.additive=!1;c=b=a=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.globalForce=new G(a,b,c);Ze.call(this)};Sd.__name__="h3d.anim.DynamicJoint";Sd.__super__=Ze;Sd.prototype=D(Ze.prototype,{shouldReceiveAnimation:function(){return this.additive},makeRuntimeData:function(){return new qa},__class__:Sd});var Qh=function(){};
Qh.__name__="h3d.anim._Skin.Permut";Qh.prototype={__class__:Qh};var Rh=function(a,b){this.j=a;this.w=b};Rh.__name__="h3d.anim._Skin.Influence";Rh.prototype={__class__:Rh};var Sh=function(a,b,c){this.name=a;this.vertexCount=b;this.bonesPerVertex=c;0<b&&(this.vertexJoints=Array(b*c),this.vertexWeights=Array(b*c),this.envelop=[])};Sh.__name__="h3d.anim.Skin";Sh.prototype={setJoints:function(a,b){this.rootJoints=b;this.allJoints=a;this.namedJoints=new Sa;for(b=0;b<a.length;){var c=a[b];++b;null!=c.name&&
(this.namedJoints.h[c.name]=c)}},addInfluence:function(a,b,c){var d=this.envelop[a];null==d&&(d=this.envelop[a]=[]);d.push(new Rh(b,c))},sortInfluences:function(a,b){return b.w>a.w?1:-1},isSplit:function(){return null!=this.splitJoints},initWeights:function(){this.boundJoints=[];for(var a=0,b=0,c=this.vertexCount;b<c;){var d=b++;d=this.envelop[d];null==d&&(d=[]);ub.sort(d,M(this,this.sortInfluences));d.length>this.bonesPerVertex&&(d=d.slice(0,this.bonesPerVertex));for(var e=0,f=0;f<d.length;){var g=
d[f];++f;e+=g.w}e=1/e;f=0;for(g=this.bonesPerVertex;f<g;){var h=f++;h=d[h];null==h?(this.vertexJoints[a]=0,this.vertexWeights[a]=0):(-1==h.j.bindIndex&&(h.j.bindIndex=this.boundJoints.length,this.boundJoints.push(h.j)),this.vertexJoints[a]=h.j.bindIndex,this.vertexWeights[a]=h.w*e);++a}}this.envelop=null},sortByBindIndex:function(a,b){return a.bindIndex-b.bindIndex},isSub:function(a,b){for(var c=0,d=b.length,e=0;e<a.length;){var f=a[e];for(++e;f!=b[c++];)if(c>=d)return!1}return!0},merge:function(a){for(var b=
0;b<a.length;){var c=a[b];++b;for(var d=0;d<a.length;){var e=a[d];++d;if(c!=e&&c.material==e.material&&this.isSub(c.joints,e.joints)){b=0;for(d=c.triangles;b<d.length;){var f=d[b];++b;e.triangles.push(f)}F.remove(a,c);return!0}}}return!1},jointsDiff:function(a,b){for(var c=0,d=0,e=0,f=a.joints.length,g=b.joints.length;d<f&&e<g;){var h=a.joints[d],k=b.joints[e];h==k?(++d,++e):(++c,h.bindIndex<k.bindIndex?++d:++e)}return c+(f-d)+(g-e)},split:function(a,b,c){var d,e,f;if(null!=this.splitJoints)return!0;
if(this.boundJoints.length<=a)return!1;this.splitJoints=[];this.triangleGroups=Array(b.length/3|0);var g=[];var h=0;for(e=b.length/3|0;h<e;){var k=h++;var l=3*k;var m=null==c?0:c[k];var p=[];for(d=0;3>d;){var r=d++;var n=b[l+r];var u=0;for(f=this.bonesPerVertex;u<f;)r=u++,r=n*this.bonesPerVertex+r,0!=this.vertexWeights[r]&&(r=this.boundJoints[this.vertexJoints[r]],r.splitIndex!=l&&(r.splitIndex=l,p.push(r)))}p.sort(M(this,this.sortByBindIndex));for(l=0;l<g.length;)if(f=g[l],++l,f.material==m&&this.isSub(p,
f.joints)){f.triangles.push(k);p=null;break}if(null!=p){for(d=0;d<g.length;)if(u=g[d],++d,u.material==m&&this.isSub(u.joints,p)){u.joints=p;u.triangles.push(k);p=null;break}null!=p&&(d=new Qh,d.joints=p,d.triangles=[k],d.material=m,g.push(d))}}for(;;){for(;this.merge(g););l=c=1E5;b=k=null;h=0;for(e=g.length;h<e;)if(r=h++,p=g[r],p.joints.length!=a)for(d=r+1,u=g.length;d<u;)r=d++,f=g[r],f.joints.length!=a&&p.material==f.material&&(r=this.jointsDiff(p,f),m=r+(p.joints.length+f.joints.length-r>>1),m>
a||m>l||m==l&&r>c||(c=r,l=m,k=p,b=f));if(null==k)break;e=k;u=b;f=0;for(l=e.joints;f<l.length;)d=l[f],++f,F.remove(u.joints,d),u.joints.push(d);u.joints.sort(M(this,this.sortByBindIndex));d=0;for(p=e.triangles;d<p.length;)h=p[d],++d,u.triangles.push(h);F.remove(g,e)}h=0;for(e=g.length;h<e;)for(r=h++,d=0,u=g[r].triangles;d<u.length;)k=u[d],++d,this.triangleGroups[k]=r;b=[];h=0;for(e=this.boundJoints;h<e.length;){r=e[h];++h;f=[];for(d=0;d<g.length;)u=g[d],++d,0<=u.joints.indexOf(r)&&f.push(u);b.push({j:r,
pl:f,priority:0})}for(;;){b.sort(function(a,b){return b.pl.length+100*b.priority-(a.pl.length+100*a.priority)});for(h=0;h<g.length;)u=g[h],++h,u.indexedJoints=[];h=!1;for(e=0;e<b.length;){r=b[e];++e;r.j.splitIndex=-1;d=0;for(u=a;d<u;){c=d++;k=!0;f=0;for(l=r.pl;f<l.length;)if(p=l[f],++f,null!=p.indexedJoints[c]){k=!1;break}if(k){r.j.splitIndex=c;d=0;for(p=r.pl;d<p.length;)f=p[d],++d,f.indexedJoints[c]=r.j;break}}if(0>r.j.splitIndex){r.priority++;if(10<r.priority)throw t.thrown("Failed to assign index while spliting skin");
h=!0;break}}if(!h)break}this.splitJoints=[];for(h=0;h<g.length;){u=g[h];++h;p=[];e=0;for(d=u.indexedJoints.length;e<d;)r=e++,r=u.indexedJoints[r],null==r&&(r=this.boundJoints[0]),p.push(r);this.splitJoints.push({material:u.material,joints:p})}h=0;for(e=this.vertexJoints.length;h<e;)r=h++,this.vertexJoints[r]=this.boundJoints[this.vertexJoints[r]].splitIndex;return!0},__class__:Sh};var Ib=function(){};Ib.__name__="h3d.col.Collider";Ib.prototype={__class__:Ib};var Ka=function(){this.xMin=1E20;this.xMax=
-1E20;this.yMin=1E20;this.yMax=-1E20;this.zMin=1E20;this.zMax=-1E20};Ka.__name__="h3d.col.Bounds";Ka.fromPoints=function(a,b){var c=new Ka;c.xMin=a.x;c.yMin=a.y;c.zMin=a.z;c.xMax=b.x;c.yMax=b.y;c.zMax=b.z;return c};Ka.fromValues=function(a,b,c,d,e,f){var g=new Ka;g.xMin=a;g.yMin=b;g.zMin=c;g.xMax=a+d;g.yMax=b+e;g.zMax=c+f;return g};Ka.__super__=Ib;Ka.prototype=D(Ib.prototype,{inFrustum:function(a,b){if(null!=b)throw t.thrown("Not implemented");return a.hasBounds(this)},inSphere:function(a){var b=
a.x,c=a.y,d=a.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;d=this.xMin;var h=a.x,k=this.xMax;h=h>k?k:h;b=d<h?h:d;d=this.yMin;h=a.y;k=this.yMax;h=h>k?k:h;c=d<h?h:d;d=this.zMin;h=a.z;k=this.zMax;h=h>k?k:h;d=d<h?h:d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b-e;f=c-f;g=d-g;return e*e+f*f+g*g<a.r*a.r},testPlane:function(a){var b=a.nx,c=a.ny,d=a.nz,e=b*(this.xMax+this.xMin)+c*(this.yMax+this.yMin)+
d*(this.zMax+this.zMin);0>b&&(b=-b);0>c&&(c=-c);0>d&&(d=-d);return e+(b*(this.xMax-this.xMin)+c*(this.yMax-this.yMin)+d*(this.zMax-this.zMin))-2*a.d},rayIntersection:function(a,b){var c=(this.xMin-a.px)/a.lx,d=(this.yMin-a.py)/a.ly,e=(this.zMin-a.pz)/a.lz,f=(this.xMax-a.px)/a.lx,g=(this.yMax-a.py)/a.ly,h=(this.zMax-a.pz)/a.lz;a=c>f?f:c;b=d>g?g:d;var k=e>h?h:e;c=c<f?f:c;d=d<g?g:d;e=e<h?h:e;d=c>d?d:c;e=d>e?e:d;d=a<b?b:a;a=d<k?k:d;return e<a?-1:a},inFrustumDetails:function(a,b){null==b&&(b=!0);var c=
1;var d=a._14+a._11;var e=a._24+a._21;var f=a._34+a._31;var g=a._44+a._41;var h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0);d=a._14-a._11;e=a._24-a._21;f=a._34-a._31;g=a._44-a._41;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+f*
(0<f?this.zMin:this.zMax);0>h+g&&(c=0);d=a._14+a._12;e=a._24+a._22;f=a._34+a._32;g=a._44+a._42;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0);d=a._14-a._12;e=a._24-a._22;f=a._34-a._32;g=a._44-a._42;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:
this.yMax)+f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0);if(b){d=a._13;e=a._23;f=a._33;g=a._43;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0);d=a._14-a._13;e=a._24-a._23;f=a._34-a._33;g=a._44-a._43;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+
f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0)}return c},transform3x3:function(a){var b=this.xMin,c=this.yMin,d=this.zMin,e=this.xMax,f=this.yMax,g=this.zMax;this.xMin=1E20;this.xMax=-1E20;this.yMin=1E20;this.yMax=-1E20;this.zMin=1E20;this.zMax=-1E20;var h=b;var k=c;var l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);var m=l;l=h*a._11+k*a._21+m*a._31;var p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&
(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=c;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=f;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*
a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=f;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=c;
l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=c;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);
k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=f;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=f;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;
p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m)},transform:function(a){var b=this.xMin,c=this.yMin,d=this.zMin,e=this.xMax,f=this.yMax,g=this.zMax;this.xMin=1E20;this.xMax=-1E20;this.yMin=1E20;this.yMax=-1E20;this.zMin=1E20;this.zMax=-1E20;if(!(e<b&&f<c&&g<d)){var h=b;var k=c;var l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=
0);var m=l;l=h*a._11+k*a._21+m*a._31+a._41;var p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=c;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<
this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=f;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=f;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+
k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=c;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);
k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=c;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=f;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;
p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=f;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=
k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m)}},collide:function(a){return!(this.xMin>a.xMax||this.yMin>a.yMax||this.zMin>a.zMax||this.xMax<a.xMin||this.yMax<a.yMin||this.zMax<a.zMin)},contains:function(a){return a.x>=this.xMin&&a.x<this.xMax&&a.y>=this.yMin&&a.y<this.yMax&&a.z>=this.zMin?a.z<this.zMax:!1},containsBounds:function(a){return this.xMin<=a.xMin&&this.yMin<=a.yMin&&this.zMin<=a.zMin&&this.xMax>=a.xMax&&this.yMax>=a.yMax?this.zMax>=a.zMax:!1},containsSphere:function(a){return this.xMin<=
a.x-a.r&&this.yMin<=a.y-a.r&&this.zMin<=a.z-a.r&&this.xMax>=a.x+a.r&&this.yMax>=a.y+a.r?this.zMax>=a.z+a.r:!1},add:function(a){a.xMin<this.xMin&&(this.xMin=a.xMin);a.xMax>this.xMax&&(this.xMax=a.xMax);a.yMin<this.yMin&&(this.yMin=a.yMin);a.yMax>this.yMax&&(this.yMax=a.yMax);a.zMin<this.zMin&&(this.zMin=a.zMin);a.zMax>this.zMax&&(this.zMax=a.zMax)},addTransform:function(a,b){var c=new Ka;c.xMin=a.xMin;c.xMax=a.xMax;c.yMin=a.yMin;c.yMax=a.yMax;c.zMin=a.zMin;c.zMax=a.zMax;c.transform(b);c.xMin<this.xMin&&
(this.xMin=c.xMin);c.xMax>this.xMax&&(this.xMax=c.xMax);c.yMin<this.yMin&&(this.yMin=c.yMin);c.yMax>this.yMax&&(this.yMax=c.yMax);c.zMin<this.zMin&&(this.zMin=c.zMin);c.zMax>this.zMax&&(this.zMax=c.zMax)},addPoint:function(a){a.x<this.xMin&&(this.xMin=a.x);a.x>this.xMax&&(this.xMax=a.x);a.y<this.yMin&&(this.yMin=a.y);a.y>this.yMax&&(this.yMax=a.y);a.z<this.zMin&&(this.zMin=a.z);a.z>this.zMax&&(this.zMax=a.z)},addPos:function(a,b,c){a<this.xMin&&(this.xMin=a);a>this.xMax&&(this.xMax=a);b<this.yMin&&
(this.yMin=b);b>this.yMax&&(this.yMax=b);c<this.zMin&&(this.zMin=c);c>this.zMax&&(this.zMax=c)},addSphere:function(a){var b=a.x,c=a.y,d=a.z;a=a.r;b-a<this.xMin&&(this.xMin=b-a);b+a>this.xMax&&(this.xMax=b+a);c-a<this.yMin&&(this.yMin=c-a);c+a>this.yMax&&(this.yMax=c+a);d-a<this.zMin&&(this.zMin=d-a);d+a>this.zMax&&(this.zMax=d+a)},addSpherePos:function(a,b,c,d){a-d<this.xMin&&(this.xMin=a-d);a+d>this.xMax&&(this.xMax=a+d);b-d<this.yMin&&(this.yMin=b-d);b+d>this.yMax&&(this.yMax=b+d);c-d<this.zMin&&
(this.zMin=c-d);c+d>this.zMax&&(this.zMax=c+d)},intersection:function(a,b){var c=a.xMin,d=b.xMin,e=c<d?d:c;c=a.yMin;d=b.yMin;var f=c<d?d:c;c=a.zMin;d=b.zMin;var g=c<d?d:c;c=a.xMax;d=b.xMax;var h=c>d?d:c;c=a.yMax;d=b.yMax;var k=c>d?d:c;c=a.zMax;d=b.zMax;this.xMin=e;this.xMax=h;this.yMin=f;this.yMax=k;this.zMin=g;this.zMax=c>d?d:c},offset:function(a,b,c){this.xMin+=a;this.xMax+=a;this.yMin+=b;this.yMax+=b;this.zMin+=c;this.zMax+=c},setMin:function(a){this.xMin=a.x;this.yMin=a.y;this.zMin=a.z},setMax:function(a){this.xMax=
a.x;this.yMax=a.y;this.zMax=a.z},load:function(a){this.xMin=a.xMin;this.xMax=a.xMax;this.yMin=a.yMin;this.yMax=a.yMax;this.zMin=a.zMin;this.zMax=a.zMax},scalePivot:function(a){this.xMin*=a;this.yMin*=a;this.zMin*=a;this.xMax*=a;this.yMax*=a;this.zMax*=a},scaleCenter:function(a){var b=.5*(this.xMax-this.xMin)*a,c=.5*(this.yMax-this.yMin)*a;a*=.5*(this.zMax-this.zMin);var d=.5*(this.xMax+this.xMin),e=.5*(this.yMax+this.yMin),f=.5*(this.zMax+this.zMin);this.xMin=d-b;this.yMin=e-c;this.zMin=f-a;this.xMax=
d+b;this.yMax=e+c;this.zMax=f+a},getMin:function(){var a=this.xMin,b=this.yMin,c=this.zMin;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},getCenter:function(){var a=.5*(this.xMin+this.xMax),b=.5*(this.yMin+this.yMax),c=.5*(this.zMin+this.zMax);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},getSize:function(){var a=this.xMax-this.xMin,b=this.yMax-this.yMin,c=this.zMax-this.zMin;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},getMax:function(){var a=
this.xMax,b=this.yMax,c=this.zMax;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},getVolume:function(){return(this.xMax-this.xMin)*(this.yMax-this.yMin)*(this.zMax-this.zMin)},get_xSize:function(){return this.xMax-this.xMin},get_ySize:function(){return this.yMax-this.yMin},get_zSize:function(){return this.zMax-this.zMin},set_xSize:function(a){this.xMax=this.xMin+a;return a},set_ySize:function(a){this.yMax=this.yMin+a;return a},set_zSize:function(a){this.zMax=this.zMin+a;return a},
isEmpty:function(){return this.xMax<this.xMin||this.yMax<this.yMin?!0:this.zMax<this.zMin},empty:function(){this.xMin=1E20;this.xMax=-1E20;this.yMin=1E20;this.yMax=-1E20;this.zMin=1E20;this.zMax=-1E20},all:function(){this.xMin=-1E20;this.xMax=1E20;this.yMin=-1E20;this.yMax=1E20;this.zMin=-1E20;this.zMax=1E20},clone:function(){var a=new Ka;a.xMin=this.xMin;a.xMax=this.xMax;a.yMin=this.yMin;a.yMax=this.yMax;a.zMin=this.zMin;a.zMax=this.zMax;return a},toString:function(){var a=this.xMin,b=this.yMin,
c=this.zMin;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d="Bounds{"+y.string(new G(a,b,c))+",";a=this.xMax-this.xMin;b=this.yMax-this.yMin;c=this.zMax-this.zMin;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return d+y.string(new G(a,b,c))+"}"},toSphere:function(){var a=this.xMax-this.xMin,b=this.yMax-this.yMin,c=this.zMax-this.zMin;return new ve(.5*(this.xMin+this.xMax),.5*(this.yMin+this.yMax),.5*(this.zMin+this.zMax),.5*Math.sqrt(a*a+b*b+c*c))},dimension:function(){var a=this.xMax-this.xMin,
b=this.yMax-this.yMin,c=this.zMax-this.zMin;b=b<c?c:b;return a<b?b:a},closestPoint:function(a){throw t.thrown("Not implemented");},makeDebugObj:function(){var a=new kd(this.xMax-this.xMin,this.yMax-this.yMin,this.zMax-this.zMin);a.translate(this.xMin,this.yMin,this.zMin);a.addNormals();return new Ra(a)},__class__:Ka});var we=function(a,b){this.a=a;this.b=b};we.__name__="h3d.col.OptimizedCollider";we.__super__=Ib;we.prototype=D(Ib.prototype,{rayIntersection:function(a,b){if(0>this.a.rayIntersection(a,
!1)){if(!this.checkInside)return-1;var c=a.px+0*a.lx,d=a.py+0*a.ly,e=a.pz+0*a.lz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);if(!this.a.contains(new G(c,d,e)))return-1}return this.b.rayIntersection(a,b)},contains:function(a){return this.a.contains(a)?this.b.contains(a):!1},inFrustum:function(a,b){return this.a.inFrustum(a,b)?this.b.inFrustum(a,b):!1},inSphere:function(a){return this.a.inSphere(a)?this.b.inSphere(a):!1},dimension:function(){return Math.max(this.a.dimension(),this.b.dimension())},
closestPoint:function(a){return this.b.closestPoint(a)},makeDebugObj:function(){var a=this.b.makeDebugObj(),b=this.a.makeDebugObj();if(null==b&&null==a)return null;var c=new Aa;null!=b&&c.addChild(b);null!=a&&c.addChild(a);return c},__class__:we});var pf=function(a){this.colliders=a};pf.__name__="h3d.col.GroupCollider";pf.__super__=Ib;pf.prototype=D(Ib.prototype,{rayIntersection:function(a,b){for(var c=-1,d=0,e=this.colliders;d<e.length;){var f=e[d];++d;f=f.rayIntersection(a,b);if(0<=f){if(!b)return f;
if(0>c||f<c)c=f}}return c},contains:function(a){for(var b=0,c=this.colliders;b<c.length;){var d=c[b];++b;if(d.contains(a))return!0}return!1},inFrustum:function(a,b){for(var c=0,d=this.colliders;c<d.length;){var e=d[c];++c;if(e.inFrustum(a,b))return!0}return!1},inSphere:function(a){for(var b=0,c=this.colliders;b<c.length;){var d=c[b];++b;if(d.inSphere(a))return!0}return!1},dimension:function(){for(var a=-Infinity,b=0,c=this.colliders;b<c.length;){var d=c[b];++b;a=Math.max(a,d.dimension())}return a},
closestPoint:function(a){for(var b=null,c=Infinity,d=0,e=this.colliders;d<e.length;){var f=e[d];++d;var g=f=f.closestPoint(a),h=a.x-g.x,k=a.y-g.y;g=a.z-g.z;h=h*h+k*k+g*g;h<c&&(b=f,c=h)}return b},makeDebugObj:function(){for(var a=null,b=0,c=this.colliders;b<c.length;){var d=c[b];++b;d=d.makeDebugObj();null!=d&&(null==a&&(a=new Aa),a.addChild(d))}return a},__class__:pf});var ld=function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c};ld.__name__="h3d.col.FPoint";ld.prototype=
{set:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c},sub:function(a){return new ld(this.x-a.x,this.y-a.y,this.z-a.z)},add:function(a){return new ld(this.x+a.x,this.y+a.y,this.z+a.z)},cross:function(a){return new ld(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},distanceSq:function(a){var b=a.x-this.x,c=a.y-this.y;a=a.z-this.z;return b*b+c*c+a*a},lengthSq:function(){return this.x*
this.x+this.y*this.y+this.z*this.z},normalized:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;a=1E-20>a?0:1/Math.sqrt(a);return new ld(this.x*a,this.y*a,this.z*a)},scaled:function(a){return new ld(this.x*a,this.y*a,this.z*a)},toString:function(){return"FPoint{"+T.fmt(this.x)+","+T.fmt(this.y)+","+T.fmt(this.z)+"}"},__class__:ld};var Fg=function(a){this.checkNearFar=!0;this.pleft=new Ya(1,0,0,0);this.pright=new Ya(1,0,0,0);this.ptop=new Ya(1,0,0,0);this.pbottom=new Ya(1,0,0,0);this.pnear=
new Ya(1,0,0,0);this.pfar=new Ya(1,0,0,0);null!=a&&this.loadMatrix(a)};Fg.__name__="h3d.col.Frustum";Fg.prototype={clone:function(){var a=new Fg,b=a.pleft,c=this.pleft;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.pright;c=this.pright;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.ptop;c=this.ptop;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.pbottom;c=this.pbottom;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.pnear;c=this.pnear;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.pfar;c=this.pfar;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;
b.d=c.d;a.checkNearFar=this.checkNearFar;return a},loadMatrix:function(a){var b=this.pleft,c=a._14+a._11,d=a._24+a._21,e=a._34+a._31,f=-(a._44+a._41);b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pright;c=a._14-a._11;d=a._24-a._21;e=a._34-a._31;f=a._41-a._44;b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.ptop;c=a._14-a._12;d=a._24-a._22;e=a._34-a._32;f=a._42-a._44;b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pbottom;c=a._14+a._12;d=a._24+a._22;e=a._34+a._32;f=-(a._44+a._42);b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pnear;c=a._13;d=a._23;e=
a._33;f=-a._43;b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pfar;c=a._14-a._13;d=a._24-a._23;e=a._34-a._33;f=a._43-a._44;b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pleft;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=this.pright;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=this.ptop;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=this.pbottom;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=this.pnear;
a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=this.pfar;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a},transform:function(a){var b=new ca;b.initInverse(a);b.transpose();a=this.pleft;var c=a.nx,d=a.ny,e=a.nz,f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;var h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;var k=f*b._13+
c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pright;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.ptop;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);
null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pbottom;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+
c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pfar;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pnear;c=a.nx;d=a.ny;e=a.nz;f=-a.d;
null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pleft;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pright;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.ptop;b=1/Math.sqrt(a.nx*
a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pbottom;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pnear;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pfar;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b},transform3x3:function(a){var b=new ca;b.initInverse3x3(a);b.transpose();a=this.pleft;var c=a.nx,d=a.ny,e=a.nz,f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);
var g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;var h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;var k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pright;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;
k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.ptop;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pbottom;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==
e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pfar;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*
b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pnear;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pleft;b=1/Math.sqrt(a.nx*
a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pright;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.ptop;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pbottom;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pnear;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pfar;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=
b},hasPoint:function(a){var b=this.pleft;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=this.pright;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=this.ptop;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=this.pbottom;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;if(this.checkNearFar){b=this.pnear;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=this.pfar;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1}return!0},hasSphere:function(a){var b=a.x;var c=a.y;var d=a.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=
0);var e=d;null==e&&(e=0);null==c&&(c=0);null==b&&(b=0);d=b;b=c;c=this.pleft;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;c=this.pright;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;c=this.ptop;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;c=this.pbottom;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;if(this.checkNearFar){c=this.pnear;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;c=this.pfar;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1}return!0},hasBounds:function(a){var b=this.pleft;var c=b.nx;var d=b.ny;var e=b.nz;var f=
c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1;b=this.pright;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1;b=this.ptop;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);
e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1;b=this.pbottom;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1;if(this.checkNearFar){b=this.pnear;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-
2*b.d)return!1;b=this.pfar;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1}return!0},hasOrientedBounds:function(a){var b=this.pleft;var c=b.nx;var d=b.ny;var e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var f=c;var g=d;var h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=
0);null==d&&(d=0);null==c&&(c=0);var k=c;var l=d;var m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var p=c;var r=d;var n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var u=c;var w=d;var q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*r+h*n;q=f*u+g*w+h*q;q=a.hx*
(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;b=this.pright;c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;r=d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==
d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);u=c;w=d;q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*r+h*n;q=f*u+g*w+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;b=this.ptop;c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=
0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;r=d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);u=c;w=d;q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*r+h*n;q=f*u+g*w+h*
q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;b=this.pbottom;c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;r=d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&
(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);u=c;w=d;q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*r+h*n;q=f*u+g*w+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;if(this.checkNearFar){b=this.pnear;c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;
h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;r=d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);u=c;w=d;q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=
f*k+g*l+h*m;n=f*p+g*r+h*n;q=f*u+g*w+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;b=this.pfar;c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;r=
d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);u=c;w=d;q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*r+h*n;q=f*u+g*w+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1}return!0},__class__:Fg};var Mb=function(){};Mb.__name__="h3d.col.Ray";Mb.fromPoints=function(a,b){var c=new Mb;c.px=a.x;
c.py=a.y;c.pz=a.z;c.lx=b.x-a.x;c.ly=b.y-a.y;c.lz=b.z-a.z;c.normalize();return c};Mb.fromValues=function(a,b,c,d,e,f){var g=new Mb;g.px=a;g.py=b;g.pz=c;g.lx=d;g.ly=e;g.lz=f;g.normalize();return g};Mb.prototype={clone:function(){var a=new Mb;a.px=this.px;a.py=this.py;a.pz=this.pz;a.lx=this.lx;a.ly=this.ly;a.lz=this.lz;return a},load:function(a){this.px=a.px;this.py=a.py;this.pz=a.pz;this.lx=a.lx;this.ly=a.ly;this.lz=a.lz},normalize:function(){var a=this.lx*this.lx+this.ly*this.ly+this.lz*this.lz;1!=
a&&(a=1E-20>a?0:1/Math.sqrt(a),this.lx*=a,this.ly*=a,this.lz*=a)},transform:function(a){var b=this.px,c=this.py,d=this.pz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=c,f=d;d=b*a._11+e*a._21+f*a._31+a._41;c=b*a._12+e*a._22+f*a._32+a._42;b=b*a._13+e*a._23+f*a._33+a._43;this.px=d;this.py=c;this.pz=b;b=this.lx;c=this.ly;d=this.lz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=c;f=d;d=b*a._11+e*a._21+f*a._31;
c=b*a._12+e*a._22+f*a._32;b=b*a._13+e*a._23+f*a._33;this.lx=d;this.ly=c;this.lz=b;this.normalize()},getPos:function(){var a=this.px,b=this.py,c=this.pz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},getDir:function(){var a=this.lx,b=this.ly,c=this.lz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},getPoint:function(a){var b=this.px+a*this.lx,c=this.py+a*this.ly;a=this.pz+a*this.lz;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},toString:function(){var a=
this.px,b=this.py,c=this.pz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d="Ray{"+y.string(new G(a,b,c))+",";a=this.lx;b=this.ly;c=this.lz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return d+y.string(new G(a,b,c))+"}"},distance:function(a){var b=this.lx*a.nx+this.ly*a.ny+this.lz*a.nz;a=a.d-(this.px*a.nx+this.py*a.ny+this.pz*a.nz);return 1E-10>(0>b?-b:b)?1E-10>(0>a?-a:a)?0:-1:a/b},intersect:function(a){var b=this.lx*a.nx+this.ly*a.ny+this.lz*a.nz;a=a.d-(this.px*a.nx+this.py*a.ny+this.pz*a.nz);
if(1E-10>(0>b?-b:b)){if(1E-10>(0>a?-a:a)){a=this.px;b=this.py;var c=this.pz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)}return null}c=a/b;a=this.px+this.lx*c;b=this.py+this.ly*c;c=this.pz+this.lz*c;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},collideFrustum:function(a){var b=this.px,c=this.py,d=this.pz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=c;null==d&&(d=0);null==e&&(e=0);null==b&&(b=0);var f=b,g=e,h=d;e=f*a._11+g*a._21+h*a._31+a._41;b=f*a._12+
g*a._22+h*a._32+a._42;d=f*a._13+g*a._23+h*a._33+a._43;c=1/(f*a._14+g*a._24+h*a._34+a._44);f=e*c;g=b*c;h=d*c;b=this.px+this.lx;c=this.py+this.ly;d=this.pz+this.lz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=c;null==d&&(d=0);null==e&&(e=0);null==b&&(b=0);c=b;var k=e,l=d;e=c*a._11+k*a._21+l*a._31+a._41;b=c*a._12+k*a._22+l*a._32+a._42;d=c*a._13+k*a._23+l*a._33+a._43;c=1/(c*a._14+k*a._24+l*a._34+a._44);e=1/(e*c-f);b=1/(b*c-g);c=1/(d*c-h);a=(-1-f)*e;f=(1-f)*e;d=(-1-g)*b;g=(1-g)*b;b=(0-h)*c;c*=1-h;k=
a>f?f:a;e=d>g?g:d;k=k<e?e:k;e=b>c?c:b;h=k<e?e:k;k=a<f?f:a;e=d<g?g:d;k=k>e?e:k;e=b<c?c:b;g=k>e?e:k;return!(0>g||h>g)},collide:function(a){var b=1/this.lx,c=1/this.ly,d=1/this.lz,e=(a.xMin-this.px)*b;b*=a.xMax-this.px;var f=(a.yMin-this.py)*c;c*=a.yMax-this.py;var g=(a.zMin-this.pz)*d,h=(a.zMax-this.pz)*d,k=e>b?b:e;a=f>c?c:f;k=k<a?a:k;a=g>h?h:g;d=k<a?a:k;k=e<b?b:e;a=f<c?c:f;k=k>a?a:k;a=g<h?h:g;a=k>a?a:k;return 0>a?!1:d>a?!1:!0},__class__:Mb};var lc=function(a,b){this.obj=a;this.collider=b};lc.__name__=
"h3d.col.ObjectCollider";lc.__super__=Ib;lc.prototype=D(Ib.prototype,{rayIntersection:function(a,b){var c=lc.TMP_RAY;lc.TMP_RAY=null;c.px=a.px;c.py=a.py;c.pz=a.pz;c.lx=a.lx;c.ly=a.ly;c.lz=a.lz;var d=this.obj.getInvPos(),e=a.px,f=a.py,g=a.pz;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var h=e;e=f;f=g;null==f&&(f=0);null==e&&(e=0);null==h&&(h=0);g=h;h=e;var k=f;e=g*d._11+h*d._21+k*d._31+d._41;f=g*d._12+h*d._22+k*d._32+d._42;g=g*d._13+h*d._23+k*d._33+d._43;a.px=e;a.py=f;a.pz=g;e=a.lx;f=a.ly;g=a.lz;
null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);h=e;e=f;f=g;null==f&&(f=0);null==e&&(e=0);null==h&&(h=0);g=h;h=e;k=f;e=g*d._11+h*d._21+k*d._31;f=g*d._12+h*d._22+k*d._32;g=g*d._13+h*d._23+k*d._33;a.lx=e;a.ly=f;a.lz=g;a.normalize();d=this.collider.rayIntersection(a,b);if(0>d)return a.px=c.px,a.py=c.py,a.pz=c.pz,a.lx=c.lx,a.ly=c.ly,a.lz=c.lz,lc.TMP_RAY=c,d;e=a.px+d*a.lx;f=a.py+d*a.ly;g=a.pz+d*a.lz;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);h=e;e=f;f=g;null==f&&(f=0);null==e&&(e=0);null==h&&(h=0);b=h;
g=e;h=f;d=this.obj.absPos;e=b*d._11+g*d._21+h*d._31+d._41;f=b*d._12+g*d._22+h*d._32+d._42;g=b*d._13+g*d._23+h*d._33+d._43;a.px=c.px;a.py=c.py;a.pz=c.pz;a.lx=c.lx;a.ly=c.ly;a.lz=c.lz;lc.TMP_RAY=c;c=e-a.px;d=f-a.py;a=g-a.pz;null==a&&(a=0);null==a&&(a=0);return Math.sqrt(c*c+d*d+a*a)},contains:function(a){var b=a,c=b.x,d=b.y,e=b.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b=d;var f=e;null==f&&(f=0);null==b&&(b=0);null==c&&(c=0);d=c;e=b;c=f;b=this.obj.getInvPos();f=a.x*b._12+a.y*b._22+a.z*b._32+b._42;
var g=a.x*b._13+a.y*b._23+a.z*b._33+b._43;a.x=a.x*b._11+a.y*b._21+a.z*b._31+b._41;a.y=f;a.z=g;f=this.collider.contains(a);b=a;b.x=d;b.y=e;b.z=c;return f},inFrustum:function(a,b){if(null==b)return this.collider.inFrustum(a,this.obj.getAbsPos());var c=lc.TMP_MAT,d=this.obj.getAbsPos(),e=b._11,f=b._12,g=b._13,h=b._21,k=b._22,l=b._23,m=b._31,p=b._32,r=b._33,n=b._41,u=b._42;b=b._43;var w=d._11,q=d._12,v=d._13,t=d._21,x=d._22,y=d._23,z=d._31,A=d._32,eb=d._33,B=d._41,C=d._42;d=d._43;c._11=e*w+f*t+g*z;c._12=
e*q+f*x+g*A;c._13=e*v+f*y+g*eb;c._14=0;c._21=h*w+k*t+l*z;c._22=h*q+k*x+l*A;c._23=h*v+k*y+l*eb;c._24=0;c._31=m*w+p*t+r*z;c._32=m*q+p*x+r*A;c._33=m*v+p*y+r*eb;c._34=0;c._41=n*w+u*t+b*z+B;c._42=n*q+u*x+b*A+C;c._43=n*v+u*y+b*eb+d;c._44=1;return this.collider.inFrustum(a,c)},inSphere:function(a){var b=this.obj.getInvPos(),c=a.x,d=a.y,e=a.z,f=a.r,g=a.x,h=a.y,k=a.z;null==k&&(k=0);null==h&&(h=0);null==g&&(g=0);var l=h;null==k&&(k=0);null==l&&(l=0);null==g&&(g=0);h=g;var m=k;k=h*b._11+l*b._21+m*b._31+b._41;
g=h*b._12+l*b._22+m*b._32+b._42;h=h*b._13+l*b._23+m*b._33+b._43;l=Math.sqrt(b._11*b._11+b._12*b._12+b._13*b._13);m=Math.sqrt(b._21*b._21+b._22*b._22+b._23*b._23);var p=Math.sqrt(b._31*b._31+b._32*b._32+b._33*b._33);0>b._11*(b._22*b._33-b._23*b._32)+b._12*(b._23*b._31-b._21*b._33)+b._13*(b._21*b._32-b._22*b._31)&&(l*=-1,m*=-1,p*=-1);a.x=k;a.y=g;a.z=h;a.r*=Math.max(Math.max(l,m),p);b=this.collider.inSphere(a);a.x=c;a.y=d;a.z=e;a.r=f;return b},dimension:function(){var a=this.obj.getAbsPos();var b=Math.sqrt(a._11*
a._11+a._12*a._12+a._13*a._13);var c=Math.sqrt(a._21*a._21+a._22*a._22+a._23*a._23);var d=Math.sqrt(a._31*a._31+a._32*a._32+a._33*a._33);0>a._11*(a._22*a._33-a._23*a._32)+a._12*(a._23*a._31-a._21*a._33)+a._13*(a._21*a._32-a._22*a._31)&&(b*=-1,c*=-1,d*=-1);return this.collider.dimension()*Math.max(Math.max(b,c),d)},closestPoint:function(a){throw t.thrown("Not implemented");},makeDebugObj:function(){var a=this.collider.makeDebugObj();null!=a&&a.set_follow(this.obj);return a},__class__:lc});var Th=function(){this.hx=
this.hy=this.hz=.5;this.zz=1;this.yz=this.zx=this.zy=0;this.yy=1;this.xy=this.xz=this.yx=0;this.xx=1;this.centerX=this.centerY=this.centerZ=0};Th.__name__="h3d.col.OrientedBounds";Th.__super__=Ib;Th.prototype=D(Ib.prototype,{setMatrix:function(a){var b=Math.sqrt(a._11*a._11+a._12*a._12+a._13*a._13);var c=Math.sqrt(a._21*a._21+a._22*a._22+a._23*a._23);var d=Math.sqrt(a._31*a._31+a._32*a._32+a._33*a._33);0>a._11*(a._22*a._33-a._23*a._32)+a._12*(a._23*a._31-a._21*a._33)+a._13*(a._21*a._32-a._22*a._31)&&
(b*=-1,c*=-1,d*=-1);var e=1/b,f=1/c,g=1/d;this.centerX=a._41;this.centerY=a._42;this.centerZ=a._43;this.hx=b/2;this.hy=c/2;this.hz=d/2;this.xx=a._11*e;this.xy=a._12*e;this.xz=a._13*e;this.yx=a._21*f;this.yy=a._22*f;this.yz=a._23*f;this.zx=a._31*g;this.zy=a._32*g;this.zz=a._33*g},setEulerAngles:function(a,b,c){var d=Math.cos(a);a=Math.sin(a);var e=Math.cos(b);b=Math.sin(b);var f=Math.cos(c);c=Math.sin(c);this.xx=e*f;this.xy=a*b*f+d*c;this.xz=-d*b*f+a*c;this.yx=-e*c;this.yy=-a*b*c+d*f;this.yz=d*b*c+
a*f;this.zx=b;this.zy=-a*e;this.zz=d*e},collideOrientedBounds:function(a){var b=this.xx,c=this.xy,d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=b,p=c,r=d;b=a.xx;c=a.xy;d=
a.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=b,u=c,w=d;b=a.yx;c=a.yy;d=a.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var q=b,v=c,t=d;b=a.zx;c=a.zy;d=a.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var x=e*n+f*u+g*w,y=e*q+f*v+g*t,z=e*b+f*c+g*d,A=h*n+k*u+l*w,eb=h*q+k*v+l*t,B=h*b+k*c+l*d;n=m*n+p*u+r*w;q=m*q+p*v+r*t;v=m*b+p*c+r*d;b=this.centerX;c=this.centerY;
d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);t=b;u=c;w=d;b=a.centerX;c=a.centerY;d=a.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b-=t;c-=u;d-=w;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b*h+c*k+d*l;m=b*m+c*p+d*r;b=b*e+c*f+d*g;c=h;d=m;e=(0>x?-x:x)+1E-10;f=(0>y?-y:y)+1E-10;g=(0>z?-z:z)+1E-10;m=(0>A?-A:A)+1E-10;p=(0>eb?-eb:eb)+1E-10;r=(0>
B?-B:B)+1E-10;h=(0>n?-n:n)+1E-10;k=(0>q?-q:q)+1E-10;l=(0>v?-v:v)+1E-10;t=this.hx;u=a.hx*e+a.hy*f+a.hz*g;w=b;if((0>w?-w:w)>t+u)return!1;t=this.hy;u=a.hx*m+a.hy*p+a.hz*r;w=c;if((0>w?-w:w)>t+u)return!1;t=this.hz;u=a.hx*h+a.hy*k+a.hz*l;w=d;if((0>w?-w:w)>t+u)return!1;t=this.hx*e+this.hy*m+this.hz*h;u=a.hx;w=b*x+c*A+d*n;if((0>w?-w:w)>t+u)return!1;t=this.hx*f+this.hy*p+this.hz*k;u=a.hy;w=b*y+c*eb+d*q;if((0>w?-w:w)>t+u)return!1;t=this.hx*g+this.hy*r+this.hz*l;u=a.hz;w=b*z+c*B+d*v;if((0>w?-w:w)>t+u)return!1;
t=this.hy*h+this.hz*m;u=a.hy*g+a.hz*f;w=d*A-c*n;if((0>w?-w:w)>t+u)return!1;t=this.hy*k+this.hz*p;u=a.hx*g+a.hz*e;w=d*eb-c*q;if((0>w?-w:w)>t+u)return!1;t=this.hy*l+this.hz*r;u=a.hx*f+a.hy*e;w=d*B-c*v;if((0>w?-w:w)>t+u)return!1;t=this.hx*h+this.hz*e;u=a.hy*r+a.hz*p;w=b*n-d*x;if((0>w?-w:w)>t+u)return!1;t=this.hx*k+this.hz*f;u=a.hx*r+a.hz*m;w=b*q-d*y;if((0>w?-w:w)>t+u)return!1;t=this.hx*l+this.hz*g;u=a.hx*p+a.hy*m;w=b*v-d*z;if((0>w?-w:w)>t+u)return!1;t=this.hx*m+this.hy*e;u=a.hy*l+a.hz*k;w=c*x-b*A;if((0>
w?-w:w)>t+u)return!1;t=this.hx*p+this.hy*f;u=a.hx*l+a.hz*h;w=c*y-b*eb;if((0>w?-w:w)>t+u)return!1;t=this.hx*r+this.hy*g;u=a.hx*k+a.hy*h;w=c*z-b*B;return(0>w?-w:w)>t+u?!1:!0},rayIntersection:function(a,b){var c=a.px-this.centerX,d=a.py-this.centerY,e=a.pz-this.centerZ;var f=c*this.xx+d*this.xy+e*this.xz;b=c*this.yx+d*this.yy+e*this.yz;c=c*this.zx+d*this.zy+e*this.zz;var g=a.lx*this.xx+a.ly*this.xy+a.lz*this.xz;d=a.lx*this.yx+a.ly*this.yy+a.lz*this.yz;a=a.lx*this.zx+a.ly*this.zy+a.lz*this.zz;e=0;var h=
Infinity;if(1E-10>(0>g?-g:g)){if(f<-this.hx||f>this.hx)return-1}else{var k=1/g;g=(-this.hx-f)*k;k*=this.hx-f;g>k&&(f=k,k=g,g=f);g>e&&(e=g);k<h&&(h=k);if(e>h)return-1}if(1E-10>(0>d?-d:d)){if(b<-this.hy||b>this.hy)return-1}else if(k=1/d,g=(-this.hy-b)*k,k*=this.hy-b,g>k&&(f=k,k=g,g=f),g>e&&(e=g),k<h&&(h=k),e>h)return-1;if(1E-10>(0>a?-a:a)){if(c<-this.hz||c>this.hz)return-1}else if(k=1/a,g=(-this.hz-c)*k,k*=this.hz-c,g>k&&(f=k,k=g,g=f),g>e&&(e=g),k<h&&(h=k),e>h)return-1;return e},contains:function(a){var b=
a.x-this.centerX;var c=a.y-this.centerY;var d=a.z-this.centerZ;a=b*this.xx+c*this.xy+d*this.xz;var e=b*this.yx+c*this.yy+d*this.yz;b=b*this.zx+c*this.zy+d*this.zz;c=this.hx;-1E-10<(0>c?-c:c)-(0>a?-a:a)?(c=this.hy,a=-1E-10<(0>c?-c:c)-(0>e?-e:e)):a=!1;return a?(c=this.hz,-1E-10<(0>c?-c:c)-(0>b?-b:b)):!1},inFrustum:function(a,b){if(null!=b)throw t.thrown("Not implemented");return a.hasOrientedBounds(this)},inSphere:function(a){var b=a.x,c=a.y,d=a.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==
d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;a=a.r*a.r;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=b,p=c,r=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=b,u=c,w=d;b=this.centerX;c=this.centerY;
d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var q=-1*this.hx;h*=q;k*=q;l*=q;q=-1*this.hy;m*=q;p*=q;r*=q;q=-1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=r;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=u*q;d+=w*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=
e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;u=c;w=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=1*this.hx;h*=q;k*=q;l*=q;q=-1*this.hy;m*=q;p*=q;r*=q;q=-1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=r;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=u*q;d+=w*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;
b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;u=c;w=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);
null==c&&(c=0);null==b&&(b=0);q=-1*this.hx;h*=q;k*=q;l*=q;q=1*this.hy;m*=q;p*=q;r*=q;q=-1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=r;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=u*q;d+=w*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&
(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;u=c;w=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=1*this.hx;
h*=q;k*=q;l*=q;q=1*this.hy;m*=q;p*=q;r*=q;q=-1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=r;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=u*q;d+=w*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==
d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;u=c;w=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=-1*this.hx;h*=q;k*=q;l*=q;q=-1*this.hy;m*=q;p*=q;
r*=q;q=1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=r;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=u*q;d+=w*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);
h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;u=c;w=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=1*this.hx;h*=q;k*=q;l*=q;q=-1*this.hy;m*=q;p*=q;r*=q;q=1*this.hz;b+=h;c+=k;d+=l;null==d&&
(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=r;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=u*q;d+=w*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;
null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;u=c;w=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=-1*this.hx;h*=q;k*=q;l*=q;q=1*this.hy;m*=q;p*=q;r*=q;q=1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==
d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=r;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=u*q;d+=w*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=
0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;u=c;w=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=1*this.hx;h*=q;k*=q;l*=q;q=1*this.hy;m*=q;p*=q;r*=q;q=1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=
m;c+=p;d+=r;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=u*q;d+=w*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;return b*b+c*c+d*d>a?!1:!0},dimension:function(){var a=this.hx,b=this.hy,c=this.hz;b=b<c?c:b;return 2*(a<b?b:a)},getVertice:function(a){var b=this.xx,c=this.xy,d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=
c,g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=b,p=c,r=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=(2*(a&1)-1)*this.hx;e*=n;f*=n;g*=n;n=(2*(a>>1&1)-1)*this.hy;h*=n;k*=n;l*=n;n=(2*(a>>
2&1)-1)*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=r*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,d)},getVertices:function(a){a=null!=a?a:[];var b=this.xx,c=this.xy,d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=this.yx;
c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=b,p=c,r=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=-1*this.hx;e*=n;f*=n;g*=n;n=-1*this.hy;h*=n;k*=n;l*=n;n=-1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=r*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new G(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==
b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=1*this.hx;e*=n;f*=n;g*=n;n=-1*this.hy;h*=n;k*=n;l*=n;n=-1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=
0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=r*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new G(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=
0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=-1*this.hx;e*=n;f*=n;g*=n;n=1*this.hy;h*=n;k*=n;l*=n;n=-1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=r*n;null==d&&(d=0);null==c&&
(c=0);null==b&&(b=0);a.push(new G(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=1*this.hx;e*=n;f*=n;g*=n;n=1*this.hy;h*=n;k*=n;l*=n;n=-1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=r*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new G(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&
(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=-1*this.hx;e*=n;f*=n;g*=n;n=-1*this.hy;
h*=n;k*=n;l*=n;n=1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=r*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new G(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);
null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=1*this.hx;e*=n;f*=n;g*=n;n=-1*this.hy;h*=n;k*=n;l*=n;n=1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=r*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new G(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=
this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=-1*this.hx;e*=n;f*=n;g*=n;n=1*this.hy;h*=n;k*=n;l*=n;n=1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&
(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=r*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new G(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=
d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=1*this.hx;e*=n;f*=n;g*=n;n=1*this.hy;h*=n;k*=n;l*=n;n=1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=r*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new G(b,c,d));return a},
closestPoint:function(a){throw t.thrown("not implemented");},testPlane:function(a){var b=a.nx,c=a.ny,d=a.nz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=b,p=c,r=d;b=this.zx;c=this.zy;
d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=b,u=c,w=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=e*h+f*k+g*l;m=e*m+f*p+g*r;n=e*n+f*u+g*w;return e*b+f*c+g*d-a.d+(this.hx*(0>h?-h:h)+this.hy*(0>m?-m:m)+this.hz*(0>n?-n:n))},makeDebugObj:function(){var a=new Td,b=this.getVertices();a.lineStyle(1,16777215,1);a.moveTo(b[0].x,b[0].y,b[0].z);a.lineTo(b[4].x,
b[4].y,b[4].z);a.moveTo(b[1].x,b[1].y,b[1].z);a.lineTo(b[5].x,b[5].y,b[5].z);a.moveTo(b[2].x,b[2].y,b[2].z);a.lineTo(b[6].x,b[6].y,b[6].z);a.moveTo(b[3].x,b[3].y,b[3].z);a.lineTo(b[7].x,b[7].y,b[7].z);a.moveTo(b[0].x,b[0].y,b[0].z);a.lineTo(b[1].x,b[1].y,b[1].z);a.lineTo(b[3].x,b[3].y,b[3].z);a.lineTo(b[2].x,b[2].y,b[2].z);a.lineTo(b[0].x,b[0].y,b[0].z);a.moveTo(b[4].x,b[4].y,b[4].z);a.lineTo(b[5].x,b[5].y,b[5].z);a.lineTo(b[7].x,b[7].y,b[7].z);a.lineTo(b[6].x,b[6].y,b[6].z);a.lineTo(b[4].x,b[4].y,
b[4].z);return a},__class__:Th});var Ya=function(a,b,c,d){this.nx=a;this.ny=b;this.nz=c;this.d=d};Ya.__name__="h3d.col.Plane";Ya.fromPoints=function(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=b.z-a.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;var g=e,h=f;d=c.x-a.x;e=c.y-a.y;f=c.z-a.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c=d;var k=e;e=f;d=g*e-h*k;e=h*c-b*e;f=b*k-g*c;null==f&&(f=0);null==e&&(e=0);null==d&&
(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;g=e;h=f;return new Ya(b,g,h,b*a.x+g*a.y+h*a.z)};Ya.fromNormalPoint=function(a,b){return new Ya(a.x,a.y,a.z,a.x*b.x+a.y*b.y+a.z*b.z)};Ya.X=function(a){null==a&&(a=0);return new Ya(1,0,0,a)};Ya.Y=function(a){null==a&&(a=0);return new Ya(0,1,0,a)};Ya.Z=function(a){null==a&&(a=0);return new Ya(0,0,1,a)};Ya.frustumLeft=function(a){return new Ya(a._14+a._11,a._24+a._21,a._34+a._31,-(a._44+a._41))};Ya.frustumRight=function(a){return new Ya(a._14-a._11,
a._24-a._21,a._34-a._31,a._41-a._44)};Ya.frustumBottom=function(a){return new Ya(a._14+a._12,a._24+a._22,a._34+a._32,-(a._44+a._42))};Ya.frustumTop=function(a){return new Ya(a._14-a._12,a._24-a._22,a._34-a._32,a._42-a._44)};Ya.frustumNear=function(a){return new Ya(a._13,a._23,a._33,-a._43)};Ya.frustumFar=function(a){return new Ya(a._14-a._13,a._24-a._23,a._34-a._33,a._43-a._44)};Ya.prototype={getNormal:function(){var a=this.nx,b=this.ny,c=this.nz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,
b,c)},getNormalDistance:function(){return this.d},load:function(a){this.nx=a.nx;this.ny=a.ny;this.nz=a.nz;this.d=a.d},transform:function(a){var b=new ca;b.initInverse(a);b.transpose();var c=this.nx,d=this.ny,e=this.nz;a=-this.d;null==a&&(a=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var f=a;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;c=d;d=e;e=f;f=a*b._12+c*b._22+d*b._32+e*b._42;var g=a*b._13+c*b._23+d*b._33+e*b._43,h=a*b._14+c*b._24+d*b._34+e*b._44;this.nx=a*b._11+c*b._21+
d*b._31+e*b._41;this.ny=f;this.nz=g;this.d=-h},transform3x3:function(a){var b=new ca;b.initInverse3x3(a);b.transpose();var c=this.nx,d=this.ny,e=this.nz;a=-this.d;null==a&&(a=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var f=a;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;c=d;d=e;e=f;f=a*b._12+c*b._22+d*b._32+e*b._42;var g=a*b._13+c*b._23+d*b._33+e*b._43,h=a*b._14+c*b._24+d*b._34+e*b._44;this.nx=a*b._11+c*b._21+d*b._31+e*b._41;this.ny=f;this.nz=g;this.d=-h},transformInverseTranspose:function(a){var b=
this.nx,c=this.ny,d=this.nz,e=-this.d;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var f=e;null==f&&(f=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;b=c;c=d;d=f;f=e*a._12+b*a._22+c*a._32+d*a._42;var g=e*a._13+b*a._23+c*a._33+d*a._43,h=e*a._14+b*a._24+c*a._34+d*a._44;this.nx=e*a._11+b*a._21+c*a._31+d*a._41;this.ny=f;this.nz=g;this.d=-h},normalize:function(){var a=1/Math.sqrt(this.nx*this.nx+this.ny*this.ny+this.nz*this.nz);this.nx*=a;this.ny*=a;this.nz*=a;this.d*=a},toString:function(){var a=
this.nx,b=this.ny,c=this.nz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return"Plane{"+y.string(new G(a,b,c))+","+T.fmt(this.d)+"}"},distance:function(a){return this.nx*a.x+this.ny*a.y+this.nz*a.z-this.d},side:function(a){return 0<=this.nx*a.x+this.ny*a.y+this.nz*a.z-this.d},project:function(a){var b=this.nx*a.x+this.ny*a.y+this.nz*a.z-this.d,c=a.x-b*this.nx,d=a.y-b*this.ny;a=a.z-b*this.nz;null==a&&(a=0);null==d&&(d=0);null==c&&(c=0);return new G(c,d,a)},projectTo:function(a,b){var c=this.nx*a.x+
this.ny*a.y+this.nz*a.z-this.d;b.x=a.x-c*this.nx;b.y=a.y-c*this.ny;b.z=a.z-c*this.nz},__class__:Ya};var fe=function(a){null==a&&(a=!1);this.next=null;this.oriented=a};fe.__name__="h3d.col.TriPlane";fe.__super__=Ib;fe.prototype=D(Ib.prototype,{init:function(a,b,c){this.p0x=a.x;this.p0y=a.y;this.p0z=a.z;var d=b.x-a.x,e=b.y-a.y,f=b.z-a.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;var g=e,h=f;d=c.x-a.x;e=c.y-a.y;f=c.z-a.z;null==f&&(f=0);null==e&&(e=0);
null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c=d;var k=e,l=f;d=g*l-h*k;e=h*c-b*l;f=b*k-g*c;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);this.d=d*a.x+e*a.y+f*a.z;this.nx=d;this.ny=e;this.nz=f;this.d1x=b;this.d1y=g;this.d1z=h;this.d2x=c;this.d2y=k;this.d2z=l;this.dot00=b*b+g*g+h*h;this.dot01=b*c+g*k+h*l;this.dot11=c*c+k*k+l*l;this.invDenom=1/(this.dot00*this.dot11-this.dot01*this.dot01)},clone:function(){var a=new fe(this.oriented);a.p0x=this.p0x;
a.p0y=this.p0y;a.p0z=this.p0z;a.d1x=this.d1x;a.d1y=this.d1y;a.d1z=this.d1z;a.d2x=this.d2x;a.d2y=this.d2y;a.d2z=this.d2z;a.dot00=this.dot00;a.dot01=this.dot01;a.dot11=this.dot11;a.invDenom=this.invDenom;a.nx=this.nx;a.ny=this.ny;a.nz=this.nz;a.d=this.d;null!=this.next&&(a.next=this.next.clone());return a},load:function(a){this.p0x=a.p0x;this.p0y=a.p0y;this.p0z=a.p0z;this.d1x=a.d1x;this.d1y=a.d1y;this.d1z=a.d1z;this.d2x=a.d2x;this.d2y=a.d2y;this.d2z=a.d2z;this.dot00=a.dot00;this.dot01=a.dot01;this.dot11=
a.dot11;this.invDenom=a.invDenom;this.nx=a.nx;this.ny=a.ny;this.nz=a.nz;this.d=a.d},transform:function(a){var b=this.p0x,c=this.p0y,d=this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=this.d1x+this.p0x;c=this.d1y+this.p0y;d=this.d1z+this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.d2x+this.p0x;c=this.d2y+this.p0y;d=this.d2z+this.p0z;null==d&&(d=0);null==c&&(c=
0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=e*a._11+f*a._21+g*a._31+a._41,p=e*a._12+f*a._22+g*a._32+a._42,r=e*a._13+f*a._23+g*a._33+a._43;e=m;f=p;g=r;m=h*a._11+k*a._21+l*a._31+a._41;p=h*a._12+k*a._22+l*a._32+a._42;r=h*a._13+k*a._23+l*a._33+a._43;h=m;k=p;l=r;m=b*a._11+c*a._21+d*a._31+a._41;p=b*a._12+c*a._22+d*a._32+a._42;r=b*a._13+c*a._23+d*a._33+a._43;this.p0x=e;this.p0y=f;this.p0z=g;b=h-e;c=k-f;d=l-g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=
0);null==b&&(b=0);a=b;h=c;k=d;b=m-e;c=p-f;d=r-g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;r=d;b=h*r-k*p;c=k*m-a*r;d=a*p-h*m;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);this.d=b*e+c*f+d*g;this.nx=b;this.ny=c;this.nz=d;this.d1x=a;this.d1y=h;this.d1z=k;this.d2x=m;this.d2y=p;this.d2z=r;this.dot00=a*a+h*h+k*k;this.dot01=a*m+h*p+k*r;this.dot11=m*m+p*p+r*r;this.invDenom=1/(this.dot00*this.dot11-this.dot01*
this.dot01)},contains:function(a){var b=a.x-this.p0x,c=a.y-this.p0y;a=a.z-this.p0z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);var d=c;null==a&&(a=0);null==d&&(d=0);null==b&&(b=0);c=b;b=d;d=a;a=this.d1x*c+this.d1y*b+this.d1z*d;b=this.d2x*c+this.d2y*b+this.d2z*d;c=(this.dot11*a-this.dot01*b)*this.invDenom;a=(this.dot00*b-this.dot01*a)*this.invDenom;return 0<=c&&0<=a?1>c+a:!1},side:function(a){return 0<=this.nx*a.x+this.ny*a.y+this.nz*a.z-this.d},inFrustum:function(a,b){throw t.thrown("Not implemented");
},inSphere:function(a){throw t.thrown("Not implemented");},closestPoint:function(a){var b=this.p0x;var c=this.p0y;var d=this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=a.x-this.p0x;c=a.y-this.p0y;d=a.z-this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b;var k=c;var l=d;var m=this.d1x*h+this.d1y*k+this.d1z*l;k=this.d2x*h+this.d2y*k+this.d2z*l;h=(this.dot11*m-this.dot01*k)*this.invDenom;
l=(this.dot00*k-this.dot01*m)*this.invDenom;if(0<=h&&0<=l&&1>h+l){b=a.x-e;c=a.y-f;d=a.z-g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;b=this.nx;c=this.ny;d=this.nz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var p=b;var r=c;var n=d;a=p*p+r*r+n*n;a=1E-20>a?0:1/Math.sqrt(a);p*=a;r*=a;n*=a;l=k*p+m*r+h*n;b=p*l;c=r*l;d=n*l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==
b&&(b=0);b=k-b;c=m-c;d=h-d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e+b;c=f+c;d=g+d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,d)}b=this.d1x;c=this.d1y;d=this.d1z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;b=this.d2x;c=this.d2y;d=this.d2z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);p=b;r=c;n=d;b=this.p0x;c=this.p0y;d=this.p0z;
null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=k;c+=m;d+=h;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var u=b,w=c,q=d;b=a.x-e;c=a.y-f;d=a.z-g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);d=(b*k+c*m+d*h)/(k*k+m*m+h*h);0>d?d=0:1<d&&(d=1);b=k*d;c=m*d;d*=h;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e+b;c=f+c;d=g+d;null==
d&&(d=0);null==c&&(c=0);null==b&&(b=0);l=new G(b,c,d);b=p-k;c=r-m;d=n-h;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;b=a.x-u;c=a.y-w;d=a.z-q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);d=(b*k+c*m+d*h)/(k*k+m*m+h*h);0>d?d=0:1<d&&(d=1);b=k*d;c=m*d;d*=h;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=u+b;c=w+c;d=q+d;null==d&&(d=0);null==c&&(c=0);null==b&&
(b=0);u=new G(b,c,d);b=a.x-e;c=a.y-f;d=a.z-g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);d=(b*p+c*r+d*n)/(p*p+r*r+n*n);0>d?d=0:1<d&&(d=1);b=p*d;c=r*d;d*=n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e+b;c=f+c;d=g+d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=new G(b,c,d);b=a.x-l.x;c=a.y-l.y;d=a.z-l.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;
g=k*k+m*m+h*h;b=a.x-u.x;c=a.y-u.y;d=a.z-u.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;f=k*k+m*m+h*h;b=a.x-e.x;c=a.y-e.y;d=a.z-e.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;a=g;g=l;f<a&&(a=f,g=u);k*k+m*m+h*h<a&&(g=e);return g},rayIntersection:function(a,b){b=a.lx*this.nx+a.ly*this.ny+a.lz*this.nz;if(0<=b&&this.oriented)return-1;b=(this.d-(a.px*this.nx+a.py*this.ny+a.pz*this.nz))/
b;if(0>b&&this.oriented)return-1;var c=a.px+a.lx*b-this.p0x,d=a.py+a.ly*b-this.p0y;a=a.pz+a.lz*b-this.p0z;null==a&&(a=0);null==d&&(d=0);null==c&&(c=0);var e=a;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;c=d;d=this.d1x*a+this.d1y*c+this.d1z*e;c=this.d2x*a+this.d2y*c+this.d2z*e;a=(this.dot11*d-this.dot01*c)*this.invDenom;d=(this.dot00*c-this.dot01*d)*this.invDenom;return 0<=a&&0<=d&&1>a+d?b:-1},isPointInTriangle:function(a,b,c){a-=this.p0x;b-=this.p0y;c-=this.p0z;null==c&&(c=0);null==b&&(b=0);
null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=c;c=this.d1x*a+this.d1y*b+this.d1z*d;a=this.d2x*a+this.d2y*b+this.d2z*d;b=(this.dot11*c-this.dot01*a)*this.invDenom;c=(this.dot00*a-this.dot01*c)*this.invDenom;return 0<=b&&0<=c?1>b+c:!1},getPoints:function(){var a=this.p0x,b=this.p0y,c=this.p0z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=new G(a,b,c);a=this.d1x+this.p0x;b=this.d1y+this.p0y;c=this.d1z+this.p0z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var e=new G(a,b,c);a=
this.d2x+this.p0x;b=this.d2y+this.p0y;c=this.d2z+this.p0z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return[d,e,new G(a,b,c)]},makeDebugObj:function(){var a=this.p0x,b=this.p0y,c=this.p0z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=new G(a,b,c);a=this.d1x;b=this.d1y;c=this.d1z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var e=a;null==c&&(c=0);null==b&&(b=0);null==e&&(e=0);var f=e,g=b,h=c;a=this.d2x;b=this.d2y;c=this.d2z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);e=a;null==c&&(c=0);null==
b&&(b=0);null==e&&(e=0);var k=b,l=c;a=f+d.x;b=g+d.y;c=h+d.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);f=new G(a,b,c);a=e+d.x;b=k+d.y;c=l+d.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);d=[d,f,new G(a,b,c)];d=new Qc(d);d.addNormals();return new Ra(d)},dimension:function(){throw t.thrown("Not implemented");},__class__:fe});var zd=function(a){null==a&&(a=!1);this.oriented=a};zd.__name__="h3d.col.Polygon";zd.fromPolygon2D=function(a,b,c){var d;null==c&&(c=!0);null==b&&(b=0);var e=new zd;if(yd.isConvex(a)){var f=
a[0];var g=0;for(d=a.length-2;g<d;){var h=g++;var k=a[h+1];var l=a[h+2];h=new fe(c);var m=f.x;var p=f.y;var r=b;null==r&&(r=0);null==p&&(p=0);null==m&&(m=0);null==r&&(r=0);null==p&&(p=0);null==m&&(m=0);var n=k.x;var u=k.y;k=b;null==k&&(k=0);null==u&&(u=0);null==n&&(n=0);null==k&&(k=0);null==u&&(u=0);null==n&&(n=0);var w=n;var q=l.x;n=l.y;l=b;null==l&&(l=0);null==n&&(n=0);null==q&&(q=0);null==l&&(l=0);null==n&&(n=0);null==q&&(q=0);var t=q;q=n;n=l;h.p0x=m;h.p0y=p;h.p0z=r;l=w-m;w=u-p;u=k-r;null==u&&
(u=0);null==w&&(w=0);null==l&&(l=0);k=w;null==u&&(u=0);null==k&&(k=0);null==l&&(l=0);w=t-m;q-=p;t=n-r;null==t&&(t=0);null==q&&(q=0);null==w&&(w=0);n=w;null==t&&(t=0);null==q&&(q=0);null==n&&(n=0);w=k*t-u*q;var v=u*n-l*t;var x=l*q-k*n;null==x&&(x=0);null==v&&(v=0);null==w&&(w=0);null==x&&(x=0);null==v&&(v=0);null==w&&(w=0);h.d=w*m+v*p+x*r;h.nx=w;h.ny=v;h.nz=x;h.d1x=l;h.d1y=k;h.d1z=u;h.d2x=n;h.d2y=q;h.d2z=t;h.dot00=l*l+k*k+u*u;h.dot01=l*n+k*q+u*t;h.dot11=n*n+q*q+t*t;h.invDenom=1/(h.dot00*h.dot11-h.dot01*
h.dot01);h.next=e.triPlanes;e.triPlanes=h}}else{var y=yd.fastTriangulate(a);g=0;for(d=y.length/3|0;g<d;)h=g++,f=a[y[3*h]],k=a[y[3*h+1]],l=a[y[3*h+2]],h=new fe(c),m=f.x,p=f.y,r=b,null==r&&(r=0),null==p&&(p=0),null==m&&(m=0),null==r&&(r=0),null==p&&(p=0),null==m&&(m=0),n=k.x,u=k.y,k=b,null==k&&(k=0),null==u&&(u=0),null==n&&(n=0),null==k&&(k=0),null==u&&(u=0),null==n&&(n=0),w=n,q=l.x,n=l.y,l=b,null==l&&(l=0),null==n&&(n=0),null==q&&(q=0),null==l&&(l=0),null==n&&(n=0),null==q&&(q=0),t=q,q=n,n=l,h.p0x=
m,h.p0y=p,h.p0z=r,l=w-m,w=u-p,u=k-r,null==u&&(u=0),null==w&&(w=0),null==l&&(l=0),k=w,null==u&&(u=0),null==k&&(k=0),null==l&&(l=0),w=t-m,q-=p,t=n-r,null==t&&(t=0),null==q&&(q=0),null==w&&(w=0),n=w,null==t&&(t=0),null==q&&(q=0),null==n&&(n=0),w=k*t-u*q,v=u*n-l*t,x=l*q-k*n,null==x&&(x=0),null==v&&(v=0),null==w&&(w=0),null==x&&(x=0),null==v&&(v=0),null==w&&(w=0),h.d=w*m+v*p+x*r,h.nx=w,h.ny=v,h.nz=x,h.d1x=l,h.d1y=k,h.d1z=u,h.d2x=n,h.d2y=q,h.d2z=t,h.dot00=l*l+k*k+u*u,h.dot01=l*n+k*q+u*t,h.dot11=n*n+q*q+
t*t,h.invDenom=1/(h.dot00*h.dot11-h.dot01*h.dot01),h.next=e.triPlanes,e.triPlanes=h}return e};zd.__super__=Ib;zd.prototype=D(Ib.prototype,{addBuffers:function(a,b,c){null==c&&(c=3);for(var d=0,e=b.length/3|0;d<e;){var f=3*d++,g=new fe(this.oriented),h=b[f]*c,k=b[f+1]*c,l=b[f+2]*c,m=a[h];f=a[h+1];h=a[h+2];null==h&&(h=0);null==f&&(f=0);null==m&&(m=0);var p=f,r=h;null==r&&(r=0);null==p&&(p=0);null==m&&(m=0);f=m;h=p;m=r;r=a[k];p=a[k+1];k=a[k+2];null==k&&(k=0);null==p&&(p=0);null==r&&(r=0);var n=k;null==
n&&(n=0);null==p&&(p=0);null==r&&(r=0);k=r;var u=n;n=a[l];r=a[l+1];l=a[l+2];null==l&&(l=0);null==r&&(r=0);null==n&&(n=0);var w=r;null==l&&(l=0);null==w&&(w=0);null==n&&(n=0);r=n;n=w;w=l;g.p0x=f;g.p0y=h;g.p0z=m;l=k-f;k=p-h;p=u-m;null==p&&(p=0);null==k&&(k=0);null==l&&(l=0);null==p&&(p=0);null==k&&(k=0);null==l&&(l=0);r-=f;n-=h;w-=m;null==w&&(w=0);null==n&&(n=0);null==r&&(r=0);null==w&&(w=0);null==n&&(n=0);null==r&&(r=0);var q=k*w-p*n,t=p*r-l*w;u=l*n-k*r;null==u&&(u=0);null==t&&(t=0);null==q&&(q=0);
null==u&&(u=0);null==t&&(t=0);null==q&&(q=0);g.d=q*f+t*h+u*m;g.nx=q;g.ny=t;g.nz=u;g.d1x=l;g.d1y=k;g.d1z=p;g.d2x=r;g.d2y=n;g.d2z=w;g.dot00=l*l+k*k+p*p;g.dot01=l*r+k*n+p*w;g.dot11=r*r+n*n+w*w;g.invDenom=1/(g.dot00*g.dot11-g.dot01*g.dot01);g.next=this.triPlanes;this.triPlanes=g}},isConvex:function(){return!0},clone:function(){var a=new zd(this.oriented),b=this.triPlanes,c=new fe(b.oriented);c.p0x=b.p0x;c.p0y=b.p0y;c.p0z=b.p0z;c.d1x=b.d1x;c.d1y=b.d1y;c.d1z=b.d1z;c.d2x=b.d2x;c.d2y=b.d2y;c.d2z=b.d2z;c.dot00=
b.dot00;c.dot01=b.dot01;c.dot11=b.dot11;c.invDenom=b.invDenom;c.nx=b.nx;c.ny=b.ny;c.nz=b.nz;c.d=b.d;if(null!=b.next){b=b.next;var d=new fe(b.oriented);d.p0x=b.p0x;d.p0y=b.p0y;d.p0z=b.p0z;d.d1x=b.d1x;d.d1y=b.d1y;d.d1z=b.d1z;d.d2x=b.d2x;d.d2y=b.d2y;d.d2z=b.d2z;d.dot00=b.dot00;d.dot01=b.dot01;d.dot11=b.dot11;d.invDenom=b.invDenom;d.nx=b.nx;d.ny=b.ny;d.nz=b.nz;d.d=b.d;null!=b.next&&(d.next=b.next.clone());c.next=d}a.triPlanes=c;return a},transform:function(a){for(var b=this.triPlanes;null!=b;)b.transform(a),
b=b.next},getPoints:function(){for(var a=[],b=this.triPlanes;null!=b;)a=a.concat(b.getPoints()),b=b.next;return a},getBounds:function(a){null==a&&(a=new Ka);a.xMin=1E20;a.xMax=-1E20;a.yMin=1E20;a.yMax=-1E20;a.zMin=1E20;a.zMax=-1E20;for(var b=this.triPlanes;null!=b;){var c=b.p0x,d=b.p0y,e=b.p0z;c<a.xMin&&(a.xMin=c);c>a.xMax&&(a.xMax=c);d<a.yMin&&(a.yMin=d);d>a.yMax&&(a.yMax=d);e<a.zMin&&(a.zMin=e);e>a.zMax&&(a.zMax=e);c=b.d1x+b.p0x;d=b.d1y+b.p0y;e=b.d1z+b.p0z;c<a.xMin&&(a.xMin=c);c>a.xMax&&(a.xMax=
c);d<a.yMin&&(a.yMin=d);d>a.yMax&&(a.yMax=d);e<a.zMin&&(a.zMin=e);e>a.zMax&&(a.zMax=e);c=b.d2x+b.p0x;d=b.d2y+b.p0y;e=b.d2z+b.p0z;c<a.xMin&&(a.xMin=c);c>a.xMax&&(a.xMax=c);d<a.yMin&&(a.yMin=d);d>a.yMax&&(a.yMax=d);e<a.zMin&&(a.zMin=e);e>a.zMax&&(a.zMax=e);b=b.next}return a},contains:function(a){if(!this.isConvex())throw t.thrown("Not implemented for concave polygon");for(var b=this.triPlanes;null!=b;){if(0<=b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=b.next}return!0},rayIntersection:function(a,b){for(var c=
this.triPlanes,d=-1;null!=c;){var e=a.lx*c.nx+a.ly*c.ny+a.lz*c.nz;if(0<=e&&c.oriented)e=-1;else if(e=(c.d-(a.px*c.nx+a.py*c.ny+a.pz*c.nz))/e,0>e&&c.oriented)e=-1;else{var f=a.px+a.lx*e-c.p0x,g=a.py+a.ly*e-c.p0y,h=a.pz+a.lz*e-c.p0z;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);var k=h;null==k&&(k=0);null==g&&(g=0);null==f&&(f=0);h=f;f=c.d1x*h+c.d1y*g+c.d1z*k;g=c.d2x*h+c.d2y*g+c.d2z*k;h=(c.dot11*f-c.dot01*g)*c.invDenom;f=(c.dot00*g-c.dot01*f)*c.invDenom;e=0<=h&&0<=f&&1>h+f?e:-1}if(0<=e){if(!b)return e;
if(0>d||e<d)d=e}c=c.next}return d},inFrustum:function(a,b){throw t.thrown("Not implemented");},inSphere:function(a){throw t.thrown("Not implemented");},closestPoint:function(a){for(var b=this.triPlanes,c=Infinity,d=null;null!=b;){var e=b.closestPoint(a),f=a,g=e.x-f.x,h=e.y-f.y;f=e.z-f.z;g=g*g+h*h+f*f;g<c&&(c=g,d=e);b=b.next}return d},dimension:function(){var a=this.getBounds(),b=a.xMax-a.xMin,c=a.yMax-a.yMin;a=a.zMax-a.zMin;c=c<a?a:c;return b<c?c:b},makeDebugObj:function(){for(var a=[],b=this.triPlanes;null!=
b;){var c=b.p0x,d=b.p0y,e=b.p0z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=new G(c,d,e);e=b.d1x;var f=b.d1y;d=b.d1z;null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);var g=d;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);d=e;e=f;f=g;var h=b.d2x,k=b.d2y;g=b.d2z;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);var l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);g=h;h=k;k=l;a.push(c);d+=c.x;e+=c.y;f+=c.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);a.push(new G(d,e,f));d=g+c.x;e=h+c.y;c=k+c.z;null==c&&(c=
0);null==e&&(e=0);null==d&&(d=0);a.push(new G(d,e,c));b=b.next}a=new Qc(a);a.addNormals();a=new Ra(a);this.oriented||a.material.passes.set_culling(gc.None);return a},__class__:zd});var xe=function(){};xe.__name__="h3d.col.PolygonBuffer";xe.__super__=Ib;xe.prototype=D(Ib.prototype,{setData:function(a,b,c,d){null==d&&(d=-1);null==c&&(c=0);this.buffer=a;this.indexes=b;this.startIndex=c;this.triCount=0<=d?d:(b.length-c)/3|0},getBounds:function(){for(var a=this.startIndex,b=new Ka,c=0,d=3*this.triCount;c<
d;){c++;var e=3*this.indexes[a++],f=this.buffer[e++],g=this.buffer[e++];e=this.buffer[e];f<b.xMin&&(b.xMin=f);f>b.xMax&&(b.xMax=f);g<b.yMin&&(b.yMin=g);g>b.yMax&&(b.yMax=g);e<b.zMin&&(b.zMin=e);e>b.zMax&&(b.zMax=e)}return b},getPoints:function(){for(var a,b=1073741824,c=-1073741824,d=this.startIndex,e=this.startIndex+3*this.triCount;d<e;)a=d++,a=this.indexes[a],a<b&&(b=a),a>c&&(c=a);c=Wi._new(c+1-b);var f=[];d=this.startIndex;for(e=this.startIndex+3*this.triCount;d<e;){a=d++;a=this.indexes[a];var g=
a-b;Wi.get(c,g)||(a*=3,f.push(new ld(this.buffer[a++],this.buffer[a++],this.buffer[a])),Wi.set(c,g))}return f},contains:function(a){var b=this.startIndex;var c=a.x;var d=a.y;var e=a.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;for(var f=d,g=e,h=0,k=this.triCount;h<k;){h++;e=3*this.indexes[b++];c=this.buffer[e++];d=this.buffer[e++];e=this.buffer[e];null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var l=3*this.indexes[b++],m=this.buffer[l++],p=this.buffer[l++];l=this.buffer[l];null==l&&(l=0);null==
p&&(p=0);null==m&&(m=0);var r=l,n=3*this.indexes[b++];l=this.buffer[n++];var u=this.buffer[n++];n=this.buffer[n];null==n&&(n=0);null==u&&(u=0);null==l&&(l=0);m-=c;p-=d;r-=e;null==r&&(r=0);null==p&&(p=0);null==m&&(m=0);l-=c;u-=d;n-=e;null==n&&(n=0);null==u&&(u=0);null==l&&(l=0);var w=n;n=p*w-r*u;r=r*l-m*w;m=m*u-p*l;null==m&&(m=0);null==r&&(r=0);null==n&&(n=0);p=n;l=r;if(p*a+l*f+m*g>=p*c+l*d+m*e)return!1}return!0},inFrustum:function(a,b){throw t.thrown("Not implemented");},inSphere:function(a){throw t.thrown("Not implemented");
},dimension:function(){var a=this.getBounds(),b=a.xMax-a.xMin,c=a.yMax-a.yMin;a=a.zMax-a.zMin;c=c<a?a:c;return b<c?c:b},isPointInTriangle:function(a,b,c){var d=b.x*a.x+b.y*a.y+b.z*a.z;a=c.x*a.x+c.y*a.y+c.z*a.z;var e=b.x*b.x+b.y*b.y+b.z*b.z;b=b.x*c.x+b.y*c.y+b.z*c.z;var f=c.x*c.x+c.y*c.y+c.z*c.z;c=1/(e*f-b*b);f=(f*d-b*a)*c;d=(e*a-b*d)*c;return 0<=f&&0<=d?1>f+d:!1},closestPointLine:function(a,b,c){var d=a.x-b.x,e=a.y-b.y;a=a.z-b.z;null==a&&(a=0);null==e&&(e=0);null==d&&(d=0);a=(d*c.x+e*c.y+a*c.z)/(c.x*
c.x+c.y*c.y+c.z*c.z);0>a?a=0:1<a&&(a=1);d=c.x*a;e=c.y*a;a*=c.z;null==a&&(a=0);null==e&&(e=0);null==d&&(d=0);return new ld(b.x+d,b.y+e,b.z+a)},closestPoint:function(a){var b=a.x;var c=a.y;var d=a.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);for(var e=b,f=c,g=d,h=Infinity,k=null,l=this.startIndex,m=0,p=this.triCount;m<p;){m++;var r=3*this.indexes[l++];b=this.buffer[r++];c=this.buffer[r++];d=this.buffer[r];null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=b,u=c,w=d,q=3*this.indexes[l++],t=this.buffer[q++],
v=this.buffer[q++],x=this.buffer[q];null==x&&(x=0);null==v&&(v=0);null==t&&(t=0);var y=t,z=v,A=x,eb=3*this.indexes[l++],B=this.buffer[eb++],C=this.buffer[eb++],ab=this.buffer[eb];null==ab&&(ab=0);null==C&&(C=0);null==B&&(B=0);var E=B,F=C,H=ab,D=null,J=y-n,M=z-u,O=A-w;null==O&&(O=0);null==M&&(M=0);null==J&&(J=0);var K=J,L=M,N=O,Q=E-n,P=F-u,U=H-w;null==U&&(U=0);null==P&&(P=0);null==Q&&(Q=0);var R=Q,S=P,T=U,V=e-n,W=f-u,X=g-w;null==X&&(X=0);null==W&&(W=0);null==V&&(V=0);var Y=V,Z=W,aa=X,ba=K*Y+L*Z+N*
aa,da=R*Y+S*Z+T*aa,ea=K*K+L*L+N*N,ca=K*R+L*S+N*T,fa=R*R+S*S+T*T,ha=1/(ea*fa-ca*ca),ia=(fa*ba-ca*da)*ha,ka=(ea*da-ca*ba)*ha;if(0<=ia&&0<=ka&&1>ia+ka){var ja=L*T-N*S,la=N*R-K*T,ma=K*S-L*R;null==ma&&(ma=0);null==la&&(la=0);null==ja&&(ja=0);var oa=ja,pa=la,qa=ma,na=oa*oa+pa*pa+qa*qa;na=1E-20>na?0:1/Math.sqrt(na);var ra=oa*na,sa=pa*na,ta=qa*na;null==ta&&(ta=0);null==sa&&(sa=0);null==ra&&(ra=0);var ua=ra,va=sa,wa=ta,xa=Y*ua+Z*va+aa*wa,ya=ua*xa,za=va*xa,Aa=wa*xa;null==Aa&&(Aa=0);null==za&&(za=0);null==ya&&
(ya=0);var Ba=Y-ya,Ca=Z-za,Da=aa-Aa;null==Da&&(Da=0);null==Ca&&(Ca=0);null==Ba&&(Ba=0);D=new ld(n+Ba,u+Ca,w+Da)}else{var Ea=e-n,Fa=f-u,Ha=g-w;null==Ha&&(Ha=0);null==Fa&&(Fa=0);null==Ea&&(Ea=0);var Ga=(Ea*K+Fa*L+Ha*N)/(K*K+L*L+N*N);0>Ga?Ga=0:1<Ga&&(Ga=1);var Ia=K*Ga,Ja=L*Ga,La=N*Ga;null==La&&(La=0);null==Ja&&(Ja=0);null==Ia&&(Ia=0);var Ma=new ld(n+Ia,u+Ja,w+La),Pa=R-K,Qa=S-L,Sa=T-N;null==Sa&&(Sa=0);null==Qa&&(Qa=0);null==Pa&&(Pa=0);var Na=Pa,Oa=Qa,Ra=Sa,Ua=e-y,Wa=f-z,Xa=g-A;null==Xa&&(Xa=0);null==
Wa&&(Wa=0);null==Ua&&(Ua=0);var Ka=(Ua*Na+Wa*Oa+Xa*Ra)/(Na*Na+Oa*Oa+Ra*Ra);0>Ka?Ka=0:1<Ka&&(Ka=1);var Ya=Na*Ka,Za=Oa*Ka,$a=Ra*Ka;null==$a&&($a=0);null==Za&&(Za=0);null==Ya&&(Ya=0);var Va=new ld(y+Ya,z+Za,A+$a),bb=e-n,cb=f-u,db=g-w;null==db&&(db=0);null==cb&&(cb=0);null==bb&&(bb=0);var Ta=(bb*R+cb*S+db*T)/(R*R+S*S+T*T);0>Ta?Ta=0:1<Ta&&(Ta=1);var fb=R*Ta,gb=S*Ta,ib=T*Ta;null==ib&&(ib=0);null==gb&&(gb=0);null==fb&&(fb=0);var hb=new ld(n+fb,u+gb,w+ib),kb=e-Ma.x,lb=f-Ma.y,mb=g-Ma.z;null==mb&&(mb=0);null==
lb&&(lb=0);null==kb&&(kb=0);var nb=kb,ob=lb,qb=mb,tb=nb*nb+ob*ob+qb*qb,pb=e-Va.x,rb=f-Va.y,sb=g-Va.z;null==sb&&(sb=0);null==rb&&(rb=0);null==pb&&(pb=0);var ub=pb,vb=rb,wb=sb,zb=ub*ub+vb*vb+wb*wb,xb=e-hb.x,yb=f-hb.y,Ab=g-hb.z;null==Ab&&(Ab=0);null==yb&&(yb=0);null==xb&&(xb=0);var Eb=xb,Fb=yb,Gb=Ab,Hb=Eb*Eb+Fb*Fb+Gb*Gb,Db=tb;D=Ma;zb<Db&&(Db=zb,D=Va);Hb<Db&&(Db=Hb,D=hb)}var Ib=D.x-e,Jb=D.y-f,Kb=D.z-g,Lb=Ib*Ib+Jb*Jb+Kb*Kb;Lb<h&&(k=D,h=Lb)}b=k.x;c=k.y;d=k.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);
return new G(b,c,d)},rayIntersection:function(a,b){var c=this.startIndex;var d=a.lx;var e=a.ly;var f=a.lz;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);var g=d,h=e,k=f;d=a.px;e=a.py;f=a.pz;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);a=d;for(var l=e,m=f,p=-1,r=0,n=this.triCount;r<n;){r++;f=3*this.indexes[c++];d=this.buffer[f++];e=this.buffer[f++];f=this.buffer[f];null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);var u=3*this.indexes[c++],w=this.buffer[u++],q=this.buffer[u++];u=this.buffer[u];null==u&&(u=
0);null==q&&(q=0);null==w&&(w=0);var t=u,v=3*this.indexes[c++];u=this.buffer[v++];var x=this.buffer[v++];v=this.buffer[v];null==v&&(v=0);null==x&&(x=0);null==u&&(u=0);w-=d;q-=e;t-=f;null==t&&(t=0);null==q&&(q=0);null==w&&(w=0);u-=d;x-=e;v-=f;null==v&&(v=0);null==x&&(x=0);null==u&&(u=0);var y=h*v-k*x,z=k*u-g*v,A=g*x-h*u;null==A&&(A=0);null==z&&(z=0);null==y&&(y=0);var eb=A;A=w*y+q*z+t*eb;if(!(1E-10>A)){A=1/A;d=a-d;e=l-e;var B=m-f;null==B&&(B=0);null==e&&(e=0);null==d&&(d=0);f=e;e=(d*y+f*z+B*eb)*A;
if(!(0>e||1<e||(y=f*t-B*q,t=B*w-d*t,f=d*q-f*w,null==f&&(f=0),null==t&&(t=0),null==y&&(y=0),d=y,w=t,q=(g*d+h*w+k*f)*A,0>q||1<e+q||(d=(u*d+x*w+v*f)*A,1E-10>d)))){if(!b)return d;if(0>p||d<p)p=d}}}return p},makeDebugObj:function(){for(var a=[],b=[],c=this.startIndex,d=0,e=this.triCount;d<e;)d++,b.push(this.indexes[c++]),b.push(this.indexes[c++]),b.push(this.indexes[c++]);for(c=0;c<this.buffer.length;){d=this.buffer[c++];e=this.buffer[c++];var f=this.buffer[c++];null==f&&(f=0);null==e&&(e=0);null==d&&
(d=0);a.push(new G(d,e,f))}a=new Qc(a,b);a.addNormals();return new Ra(a)},__class__:xe});var Hg=function(a,b){this.lastFrame=this.lastBoundsFrame=-1;this.obj=a;this.col=b;a=this.transform=new xe;var c=b.buffer,d=Array(c.length);cj.blit(c,0,d,0,c.length);a.setData(d,b.indexes,b.startIndex,b.triCount);this.currentBounds=new Ka};Hg.__name__="h3d.col.SkinCollider";Hg.__super__=Ib;Hg.prototype=D(Ib.prototype,{contains:function(a){this.checkBounds();var b=this.currentBounds;if(!(a.x>=b.xMin&&a.x<b.xMax&&
a.y>=b.yMin&&a.y<b.yMax&&a.z>=b.zMin&&a.z<b.zMax))return!1;this.applyTransform();return this.transform.contains(a)},inFrustum:function(a,b){this.checkBounds();var c=this.currentBounds;if(null!=b)throw t.thrown("Not implemented");if(!a.hasBounds(c))return!1;if(null!=b)throw t.thrown("Not implemented");this.applyTransform();return this.transform.inFrustum(a)},inSphere:function(a){this.checkBounds();var b=this.currentBounds,c=a.x,d=a.y,e=a.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);
null==d&&(d=0);null==c&&(c=0);var f=c,g=d,h=e;e=b.xMin;var k=a.x,l=b.xMax;k=k>l?l:k;c=e<k?k:e;e=b.yMin;k=a.y;l=b.yMax;k=k>l?l:k;d=e<k?k:e;e=b.zMin;k=a.z;l=b.zMax;k=k>l?l:k;e=e<k?k:e;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b=c-f;g=d-g;h=e-h;if(!(b*b+g*g+h*h<a.r*a.r))return!1;this.applyTransform();throw t.thrown("Not implemented");},rayIntersection:function(a,b){this.checkBounds();if(0>this.currentBounds.rayIntersection(a,!1))return-1;this.applyTransform();
return this.transform.rayIntersection(a,b)},dimension:function(){var a=this.currentBounds,b=a.xMax-a.xMin,c=a.yMax-a.yMin;a=a.zMax-a.zMin;c=c<a?a:c;return b<c?c:b},checkBounds:function(){if(this.obj.jointsUpdated||this.lastBoundsFrame!=this.obj.lastFrame){this.lastBoundsFrame=this.obj.lastFrame;this.obj.syncJoints();var a=this.currentBounds;a.xMin=1E20;a.xMax=-1E20;a.yMin=1E20;a.yMax=-1E20;a.zMin=1E20;a.zMax=-1E20;this.obj.addBoundsRec(this.currentBounds,null)}},applyTransform:function(){if(this.obj.jointsUpdated||
this.lastFrame!=this.obj.lastFrame){this.lastFrame=this.obj.lastFrame;this.obj.syncJoints();for(var a=0,b=0,c=this.obj.skinData.bonesPerVertex,d=0,e=this.obj.skinData.vertexCount;d<e;){d++;var f=0,g=0,h=0,k=this.col.buffer[b],l=this.col.buffer[b+1],m=this.col.buffer[b+2];null==m&&(m=0);null==l&&(l=0);null==k&&(k=0);var p=m;null==p&&(p=0);null==l&&(l=0);null==k&&(k=0);m=k;k=l;l=p;p=0;for(var r=c;p<r;){p++;var n=this.obj.skinData.vertexWeights[a];if(0==n)++a;else{var u=this.obj.skinData.vertexJoints[a++],
w=m,q=k,t=l;null==t&&(t=0);null==q&&(q=0);null==w&&(w=0);var v=t;null==v&&(v=0);null==q&&(q=0);null==w&&(w=0);t=w;w=q;q=v;u=this.obj.currentPalette[u];v=t*u._12+w*u._22+q*u._32+u._42;var x=t*u._13+w*u._23+q*u._33+u._43;t=t*u._11+w*u._21+q*u._31+u._41;w=v;q=x;f+=t*n;g+=w*n;h+=q*n}}this.transform.buffer[b++]=f;this.transform.buffer[b++]=g;this.transform.buffer[b++]=h}}},closestPoint:function(a){throw t.thrown("Not implemented");},makeDebugObj:function(){return new Ig(this)},__class__:Hg});var Aa=function(a){this.prevAbsPosFrame=
-1;this.flags=32768;this.absPos=new ca;this.absPos.identity();this.x=0;var b=1;var c=!0;this.flags=c?this.flags|b:this.flags&~b;c&&0!=(this.flags&131072)&&(this.flags|=262144);this.y=0;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.z=0;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);b=this.scaleX=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);b=this.scaleY=1;this.flags=(c=!0,this.flags|b);
c&&0!=(this.flags&131072)&&(this.flags|=262144);b=this.scaleZ=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.qRot=new Dc;b=1;this.flags=(c=null!=this.follow)?this.flags|b:this.flags&~b;c&&0!=(this.flags&131072)&&(this.flags|=262144);this.flags|=2;this.children=[];null!=a&&a.addChild(this)};Aa.__name__="h3d.scene.Object";Aa.prototype={set_cullingCollider:function(a){this.cullingCollider=a;this.flags&=-4097;return a},get_visible:function(){return 0!=(this.flags&
2)},get_allocated:function(){return 0!=(this.flags&32)},get_posChanged:function(){return 0!=(this.flags&1)},get_culled:function(){return 0!=(this.flags&4)},get_followPositionOnly:function(){return 0!=(this.flags&8)},get_lightCameraCenter:function(){return 0!=(this.flags&16)},get_alwaysSyncAnimation:function(){return 0!=(this.flags&64)},get_inheritCulled:function(){return 0!=(this.flags&128)},get_ignoreBounds:function(){return 0!=(this.flags&512)},get_ignoreCollide:function(){return 0!=(this.flags&
1024)},get_modelRoot:function(){return 0!=(this.flags&256)},get_ignoreParentTransform:function(){return 0!=(this.flags&2048)},get_cullingColliderInherited:function(){return 0!=(this.flags&4096)},get_fixedPosition:function(){return 0!=(this.flags&8192)},get_alwaysSync:function(){return 0!=(this.flags&32768)},get_drawn:function(){return 0!=(this.flags&65536)},set_posChanged:function(a){this.flags=(a=a||null!=this.follow)?this.flags|1:this.flags&-2;a&&0!=(this.flags&131072)&&(this.flags|=262144);return a},
set_culled:function(a){this.flags=a?this.flags|4:this.flags&-5;return a},set_visible:function(a){this.flags=a?this.flags|2:this.flags&-3;return a},set_allocated:function(a){this.flags=a?this.flags|32:this.flags&-33;return a},set_followPositionOnly:function(a){this.flags=a?this.flags|8:this.flags&-9;return a},set_lightCameraCenter:function(a){this.flags=a?this.flags|16:this.flags&-17;return a},set_alwaysSyncAnimation:function(a){this.flags=a?this.flags|64:this.flags&-65;return a},set_ignoreBounds:function(a){this.flags=
a?this.flags|512:this.flags&-513;return a},set_inheritCulled:function(a){this.flags=a?this.flags|128:this.flags&-129;return a},set_ignoreCollide:function(a){this.flags=a?this.flags|1024:this.flags&-1025;return a},set_modelRoot:function(a){this.flags=a?this.flags|256:this.flags&-257;return a},set_ignoreParentTransform:function(a){a!=(0!=(this.flags&2048))&&(this.flags|=1,0!=(this.flags&131072)&&(this.flags|=262144));var b=2048;this.flags=a?this.flags|b:this.flags&~b;return a},set_cullingColliderInherited:function(a){this.flags=
a?this.flags|4096:this.flags&-4097;return a},set_fixedPosition:function(a){this.flags=a?this.flags|8192:this.flags&-8193;return a},set_alwaysSync:function(a){this.flags=a?this.flags|32768:this.flags&-32769;return a},set_drawn:function(a){this.flags=a?this.flags|65536:this.flags&-65537;return a},playAnimation:function(a){return this.currentAnimation=a.createInstance(this)},switchToAnimation:function(a){return this.currentAnimation=a},stopAnimation:function(a){null==a&&(a=!1);this.currentAnimation=
null;if(a){a=0;for(var b=this.children;a<b.length;){var c=b[a];++a;c.stopAnimation(!0)}}},applyAnimationTransform:function(a){null==a&&(a=!0);if(null!=this.defaultTransform){var b=this.defaultTransform;var c=Math.sqrt(b._11*b._11+b._12*b._12+b._13*b._13);var d=Math.sqrt(b._21*b._21+b._22*b._22+b._23*b._23);var e=Math.sqrt(b._31*b._31+b._32*b._32+b._33*b._33);0>b._11*(b._22*b._33-b._23*b._32)+b._12*(b._23*b._31-b._21*b._33)+b._13*(b._21*b._32-b._22*b._31)&&(c*=-1,d*=-1,e*=-1);this.scaleX=c;b=1;this.flags=
(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleY=d;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleZ=e;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.qRot.initRotateMatrix(this.defaultTransform);this.x=d=this.defaultTransform._41;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.y=d=this.defaultTransform._42;b=1;this.flags=(c=!0,this.flags|b);c&&
0!=(this.flags&131072)&&(this.flags|=262144);this.z=d=this.defaultTransform._43;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.defaultTransform=null;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144)}if(a)for(d=0,e=this.children;d<e.length;)a=e[d],++d,a.applyAnimationTransform()},getObjectsCount:function(){for(var a=0,b=0,c=this.children;b<c.length;){var d=c[b];++b;a+=d.getObjectsCount()+1}return a},getMaterialByName:function(a){for(var b=
0,c=this.children;b<c.length;){var d=c[b];++b;d=d.getMaterialByName(a);if(null!=d)return d}return null},contains:function(a){for(;null!=a;)if(a=a.parent,a==this)return!0;return!1},find:function(a){var b=a(this);if(null!=b)return b;for(var c=0,d=this.children;c<d.length;)if(b=d[c],++c,b=b.find(a),null!=b)return b;return null},findAll:function(a,b){null==b&&(b=[]);var c=a(this);null!=c&&b.push(c);c=0;for(var d=this.children;c<d.length;){var e=d[c];++c;e.findAll(a,b)}return b},getMaterials:function(a,
b){null==b&&(b=!0);null==a&&(a=[]);if(b){b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d.getMaterials(a)}}return a},localToGlobal:function(a){this.syncPos();null==a&&(a=new G(0,0,0));var b=this.absPos,c=a.x*b._12+a.y*b._22+a.z*b._32+b._42,d=a.x*b._13+a.y*b._23+a.z*b._33+b._43;a.x=a.x*b._11+a.y*b._21+a.z*b._31+b._41;a.y=c;a.z=d;return a},globalToLocal:function(a){var b=this.getInvPos(),c=a.x*b._12+a.y*b._22+a.z*b._32+b._42,d=a.x*b._13+a.y*b._23+a.z*b._33+b._43;a.x=a.x*b._11+a.y*b._21+a.z*
b._31+b._41;a.y=c;a.z=d;return a},getInvPos:function(){this.syncPos();null==this.invPos&&(this.invPos=new ca,this.invPos._44=0);0==this.invPos._44&&this.invPos.inverse3x4(this.absPos);return this.invPos},getBounds:function(a,b){null==a&&(a=new Ka);null!=this.parent&&this.parent!=b&&this.parent.syncPos();this.addBoundsRec(a,null==b?null:b.getInvPos());return a},addBoundsRec:function(a,b){var c;if(0!=(this.flags&1)){var d=0;for(c=this.children;d<c.length;){var e=c[d];++d;var f=1;var g=!0;e.flags=g?
e.flags|f:e.flags&~f;g&&0!=(e.flags&131072)&&(e.flags|=262144)}f=1;this.flags=(g=null!=this.follow)?this.flags|f:this.flags&~f;g&&0!=(this.flags&131072)&&(this.flags|=262144);this.calcAbsPos()}d=0;for(c=this.children;d<c.length;)e=c[d],++d,e.addBoundsRec(a,b)},getMeshes:function(a){null==a&&(a=[]);var b=this instanceof Ra?this:null;null!=b&&a.push(b);b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d.getMeshes(a)}return a},getMeshByName:function(a){a=this.getObjectByName(a);return a instanceof
Ra?a:null},getObjectByName:function(a){if(this.name==a)return this;for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d=d.getObjectByName(a);if(null!=d)return d}return null},clone:function(a){null==a&&(a=new Aa);var b=this.x;a.x=b;b=1;var c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.y;a.y=b;b=1;c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.z;a.z=b;b=1;c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=
262144);b=this.scaleX;a.scaleX=b;b=1;c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.scaleY;a.scaleY=b;b=1;c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.scaleZ;a.scaleZ=b;b=1;c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=a.qRot;c=this.qRot;b.x=c.x;b.y=c.y;b.z=c.z;b.w=c.w;a.name=this.name;a.set_follow(this.follow);c=0!=(this.flags&8);b=8;a.flags=c?a.flags|b:a.flags&~b;c=0!=(this.flags&2);b=
2;a.flags=c?a.flags|b:a.flags&~b;null!=this.defaultTransform&&(b=this.defaultTransform.clone(),a.defaultTransform=b,b=1,c=!0,a.flags=c?a.flags|b:a.flags&~b,c&&0!=(a.flags&131072)&&(a.flags|=262144));b=0;for(c=this.children;b<c.length;){var d=c[b];++b;d=d.clone();d.parent=a;a.children.push(d)}return a},addChild:function(a){this.addChildAt(a,this.children.length)},addChildAt:function(a,b){var c;0>b&&(b=0);b>this.children.length&&(b=this.children.length);for(c=this;null!=c;){if(c==a)throw t.thrown("Recursive addChild");
c=c.parent}if(null!=a.parent){var d=0!=(a.flags&32);a.flags&=-33;a.parent.removeChild(a);c=32;a.flags=d?a.flags|c:a.flags&~c}this.children.splice(b,0,a);if(0==(this.flags&32)&&0!=(a.flags&32))a.onRemove();a.parent=this;a.flags|=1;0!=(a.flags&131072)&&(a.flags|=262144);if(0!=(this.flags&32))if(0==(a.flags&32))a.onAdd();else a.onParentChanged()},iterVisibleMeshes:function(a){if(0!=(this.flags&2)&&(0==(this.flags&4)||0==(this.flags&128))){if(0==(this.flags&4)){var b=this instanceof Ra?this:null;null!=
b&&a(b)}b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d.iterVisibleMeshes(a)}}},onParentChanged:function(){for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;c.onParentChanged()}},onAdd:function(){this.flags|=32;for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;c.onAdd()}},onRemove:function(){this.flags&=-33;for(var a=this.children.length-1;0<=a;)this.children[a--].onRemove()},removeChild:function(a){if(F.remove(this.children,a)){if(0!=(a.flags&32))a.onRemove();a.parent=null;
a.flags|=1;0!=(a.flags&131072)&&(a.flags|=262144)}},removeChildren:function(){for(;0<this.children.length;)this.removeChild(this.children[0])},remove:function(){null!=this.parent&&this.parent.removeChild(this)},getScene:function(){for(var a=this;null!=a.parent;)a=a.parent;return a instanceof Ue?a:null},getAbsPos:function(){this.syncPos();return this.absPos},getRelPos:function(a){if(null==a)return this.getAbsPos();this.syncPos();var b=new ca;b.multiply(this.absPos,a.getInvPos());return b},isMesh:function(){return null!=
(this instanceof Ra?this:null)},toMesh:function(){var a=this instanceof Ra?this:null;if(null!=a)return a;throw t.thrown(y.string(this)+" is not a Mesh");},getCollider:function(){if(0!=(this.flags&1024))return null;var a=[],b=this.getGlobalCollider();null!=b&&a.push(b);b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d=d.getCollider();if(null!=d){var e=d instanceof pf?d:null;if(null!=e)for(d=0,e=e.colliders;d<e.length;){var f=e[d];++d;a.push(f)}else a.push(d)}}return 0==a.length?null:1==a.length?
a[0]:new pf(a)},getGlobalCollider:function(){if(0!=(this.flags&1024))return null;var a=this.getLocalCollider();return null==a?null:new lc(this,a)},getLocalCollider:function(){return null},draw:function(a){},set_follow:function(a){this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return this.follow=a},computeVelocity:function(){return-1!=this.prevAbsPosFrame},calcPrevAbsPos:function(){this.computeVelocity()?this.prevAbsPosFrame<ea.frameCount&&(this.prevAbsPosFrame=ea.frameCount,null==this.prevAbsPos?
this.prevAbsPos=this.absPos.clone():this.prevAbsPos.load(this.absPos)):this.prevAbsPos=null},calcAbsPos:function(){var a;this.calcPrevAbsPos();this.qRot.toMatrix(this.absPos);this.absPos._11*=this.scaleX;this.absPos._12*=this.scaleX;this.absPos._13*=this.scaleX;this.absPos._21*=this.scaleY;this.absPos._22*=this.scaleY;this.absPos._23*=this.scaleY;this.absPos._31*=this.scaleZ;this.absPos._32*=this.scaleZ;this.absPos._33*=this.scaleZ;this.absPos._41=this.x;this.absPos._42=this.y;this.absPos._43=this.z;
if(null!=this.follow)if(this.follow.syncPos(),0!=(this.flags&8)){var b=a=this.absPos;var c=this.parent.absPos;var d=b._11;var e=b._12;var f=b._13;var g=b._21;var h=b._22;var k=b._23;var l=b._31;var m=b._32;var p=b._33;var r=b._41;var n=b._42;var u=b._43;var w=c._11;var q=c._12;var t=c._13;var v=c._21;var x=c._22;var y=c._23;var z=c._31;var A=c._32;var eb=c._33;var B=c._41;b=c._42;c=c._43;a._11=d*w+e*v+f*z;a._12=d*q+e*x+f*A;a._13=d*t+e*y+f*eb;a._14=0;a._21=g*w+h*v+k*z;a._22=g*q+h*x+k*A;a._23=g*t+h*
y+k*eb;a._24=0;a._31=l*w+m*v+p*z;a._32=l*q+m*x+p*A;a._33=l*t+m*y+p*eb;a._34=0;a._41=r*w+n*v+u*z+B;a._42=r*q+n*x+u*A+b;a._43=r*t+n*y+u*eb+c;a._44=1;this.absPos._41=this.x+this.follow.absPos._41;this.absPos._42=this.y+this.follow.absPos._42;this.absPos._43=this.z+this.follow.absPos._43}else this.absPos.multiply3x4(this.absPos,this.follow.absPos);else null!=this.parent&&0==(this.flags&2048)&&(b=a=this.absPos,c=this.parent.absPos,d=b._11,e=b._12,f=b._13,g=b._21,h=b._22,k=b._23,l=b._31,m=b._32,p=b._33,
r=b._41,n=b._42,u=b._43,w=c._11,q=c._12,t=c._13,v=c._21,x=c._22,y=c._23,z=c._31,A=c._32,eb=c._33,B=c._41,b=c._42,c=c._43,a._11=d*w+e*v+f*z,a._12=d*q+e*x+f*A,a._13=d*t+e*y+f*eb,a._14=0,a._21=g*w+h*v+k*z,a._22=g*q+h*x+k*A,a._23=g*t+h*y+k*eb,a._24=0,a._31=l*w+m*v+p*z,a._32=l*q+m*x+p*A,a._33=l*t+m*y+p*eb,a._34=0,a._41=r*w+n*v+u*z+B,a._42=r*q+n*x+u*A+b,a._43=r*t+n*y+u*eb+c,a._44=1);null!=this.defaultTransform&&(a=this.absPos,b=this.defaultTransform,c=this.absPos,d=b._11,e=b._12,f=b._13,g=b._21,h=b._22,
k=b._23,l=b._31,m=b._32,p=b._33,r=b._41,n=b._42,u=b._43,w=c._11,q=c._12,t=c._13,v=c._21,x=c._22,y=c._23,z=c._31,A=c._32,eb=c._33,B=c._41,b=c._42,c=c._43,a._11=d*w+e*v+f*z,a._12=d*q+e*x+f*A,a._13=d*t+e*y+f*eb,a._14=0,a._21=g*w+h*v+k*z,a._22=g*q+h*x+k*A,a._23=g*t+h*y+k*eb,a._24=0,a._31=l*w+m*v+p*z,a._32=l*q+m*x+p*A,a._33=l*t+m*y+p*eb,a._34=0,a._41=r*w+n*v+u*z+B,a._42=r*q+n*x+u*A+b,a._43=r*t+n*y+u*eb+c,a._44=1);null!=this.invPos&&(this.invPos._44=0)},sync:function(a){},syncRec:function(a){var b;if(null!=
this.currentAnimation){var c=this.parent;for(b=a.elapsedTime;0<b&&null!=this.currentAnimation;)b=this.currentAnimation.update(b);null!=this.currentAnimation&&(a.visibleFlag&&0!=(this.flags&2)&&0==(this.flags&4)||0!=(this.flags&64))&&this.currentAnimation.sync();if(null==this.parent&&null!=c)return}if(0!=(this.flags&32768)||0==(this.flags&4)&&0!=(this.flags&2)&&a.visibleFlag){c=a.visibleFlag;if(0==(this.flags&2)||0!=(this.flags&4)&&0!=(this.flags&128))a.visibleFlag=!1;null==a.cullingCollider||null!=
this.cullingCollider&&0==(this.flags&4096)?0!=(this.flags&4096)&&this.set_cullingCollider(null):(this.set_cullingCollider(a.cullingCollider),this.flags|=4096);var d=a.cullingCollider;0!=(this.flags&128)&&(a.cullingCollider=this.cullingCollider);var e=0!=(this.flags&1);e&&this.calcAbsPos();if(0!=(this.flags&8192)){if(0!=(this.flags&16384)&&!e&&!a.wasContextLost){a.visibleFlag=c;a.cullingCollider=d;return}this.flags|=16384}this.flags&=-262145;this.flags|=131072;this.sync(a);this.flags&=-131073;e=e||
0!=(this.flags&262144);0!=(this.flags&262144)&&this.calcAbsPos();var f=1;this.flags=(b=null!=this.follow)?this.flags|f:this.flags&~f;b&&0!=(this.flags&131072)&&(this.flags|=262144);this.lastFrame=a.frame;for(var g=0,h=this.children.length;g<h;){var k=this.children[g];if(null==k)break;k.lastFrame!=a.frame&&(e&&(f=1,b=!0,k.flags=b?k.flags|f:k.flags&~f,b&&0!=(k.flags&131072)&&(k.flags|=262144)),k.syncRec(a));this.children[g]!=k?(g=0,h=this.children.length):++g}a.visibleFlag=c;a.cullingCollider=d}},syncPos:function(){var a;
null!=this.parent&&this.parent.syncPos();if(0!=(this.flags&1)){var b=1;this.flags=(a=null!=this.follow)?this.flags|b:this.flags&~b;a&&0!=(this.flags&131072)&&(this.flags|=262144);this.calcAbsPos();for(var c=0,d=this.children;c<d.length;){var e=d[c];++c;b=1;a=!0;e.flags=a?e.flags|b:e.flags&~b;a&&0!=(e.flags&131072)&&(e.flags|=262144)}}},emit:function(a){},emitRec:function(a){var b,c;if(0!=(this.flags&2)&&(0==(this.flags&4)||0==(this.flags&128)||a.computingStatic)){if(0!=(this.flags&1)){null!=this.currentAnimation&&
this.currentAnimation.sync();var d=1;this.flags=(b=null!=this.follow)?this.flags|d:this.flags&~d;b&&0!=(this.flags&131072)&&(this.flags|=262144);this.calcAbsPos();var e=0;for(c=this.children;e<c.length;){var f=c[e];++e;d=1;b=!0;f.flags=b?f.flags|d:f.flags&~d;b&&0!=(f.flags&131072)&&(f.flags|=262144)}}d=a.forcedScreenRatio;0!=(this.flags&65536)&&a.computeVelocity&&0==(this.flags&8192)&&0==(this.flags&4)?this.computeVelocity()||(this.prevAbsPosFrame=0):this.prevAbsPosFrame=-1;this.calcPrevAbsPos();
if(0==(this.flags&4)||a.computingStatic)this.emit(a),this.flags&=-65537;e=0;for(c=this.children;e<c.length;)f=c[e],++e,f.emitRec(a);a.forcedScreenRatio=d}},set_x:function(a){this.x=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},set_y:function(a){this.y=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},set_z:function(a){this.z=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},set_scaleX:function(a){this.scaleX=a;this.flags|=1;0!=(this.flags&
131072)&&(this.flags|=262144);return a},set_scaleY:function(a){this.scaleY=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},set_scaleZ:function(a){this.scaleZ=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},set_defaultTransform:function(a){this.defaultTransform=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},setPosition:function(a,b,c){this.x=a;a=1;var d=!0;this.flags=d?this.flags|a:this.flags&~a;d&&0!=(this.flags&131072)&&(this.flags|=
262144);this.y=b;a=1;this.flags=(d=!0,this.flags|a);d&&0!=(this.flags&131072)&&(this.flags|=262144);this.z=c;a=1;this.flags=(d=!0,this.flags|a);d&&0!=(this.flags&131072)&&(this.flags|=262144);a=1;this.flags=(d=!0,this.flags|a);d&&0!=(this.flags&131072)&&(this.flags|=262144)},setTransform:function(a){var b;var c=Math.sqrt(a._11*a._11+a._12*a._12+a._13*a._13);var d=Math.sqrt(a._21*a._21+a._22*a._22+a._23*a._23);var e=Math.sqrt(a._31*a._31+a._32*a._32+a._33*a._33);0>a._11*(a._22*a._33-a._23*a._32)+a._12*
(a._23*a._31-a._21*a._33)+a._13*(a._21*a._32-a._22*a._31)&&(c*=-1,d*=-1,e*=-1);this.x=b=a._41;b=1;var f=!0;this.flags=f?this.flags|b:this.flags&~b;f&&0!=(this.flags&131072)&&(this.flags|=262144);this.y=b=a._42;b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);this.z=b=a._43;b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleX=c;b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleY=d;
b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleZ=e;b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);Aa.tmpMat.load(a);Aa.tmpMat.prependScale(1/c,1/d,1/e);this.qRot.initRotateMatrix(Aa.tmpMat);b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144)},getTransform:function(a){null==a&&(a=new ca);a.initScale(this.scaleX,this.scaleY,this.scaleZ);this.qRot.toMatrix(Aa.tmpMat);a.multiply3x4(a,Aa.tmpMat);
a._41=this.x;a._42=this.y;a._43=this.z;return a},rotate:function(a,b,c,d){null==d&&(d=new Dc);d.initRotation(a,b,c);this.qRot.multiply(d,this.qRot);this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},setRotation:function(a,b,c){this.qRot.initRotation(a,b,c);this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},setRotationAxis:function(a,b,c,d){this.qRot.initRotateAxis(a,b,c,d);this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},setDirection:function(a,b){this.qRot.initDirection(a,
b);this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},getLocalDirection:function(){var a=this.qRot,b=1-2*(a.y*a.y+a.z*a.z),c=2*(a.x*a.y+a.z*a.w);a=2*(a.x*a.z-a.y*a.w);null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,a)},getRotationQuat:function(){return this.qRot},setRotationQuat:function(a){this.qRot=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},scale:function(a){var b;this.scaleX=b=this.scaleX*a;b=1;var c=!0;this.flags=c?this.flags|b:this.flags&~b;c&&0!=(this.flags&
131072)&&(this.flags|=262144);this.scaleY=b=this.scaleY*a;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleZ=b=this.scaleZ*a;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144)},setScale:function(a){this.scaleX=a;var b=1;var c=!0;this.flags=c?this.flags|b:this.flags&~b;c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleY=a;b=1;this.flags=
(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleZ=a;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144)},toString:function(){return ka.getClass(this).__name__.split(".").pop()+(null==this.name?"":"("+this.name+")")},getChildAt:function(a){return this.children[a]},getChildIndex:function(a){for(var b=0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==
a)return d}return-1},get_numChildren:function(){return this.children.length},iterator:function(){return new Uh(this.children)},__class__:Aa};var Ig=function(a){this.boxes=[];Aa.call(this,null);this.col=a;this.skin=a.obj;this.box=new qf(16777215,a.currentBounds);this.addChild(this.box);1!=(0!=(this.flags&2048))&&(this.flags|=1,0!=(this.flags&131072)&&(this.flags|=262144));this.flags|=2048;this.createJoints()};Ig.__name__="h3d.col.SkinColliderDebugObj";Ig.__super__=Aa;Ig.prototype=D(Aa.prototype,{createJoints:function(){for(var a=
this.skin.getSkinData().allJoints,b=0;b<a.length;){var c=a[b];++b;var d=new Ka;d.xMin=-1;d.yMin=-1;d.zMin=-1;d.xMax=1;d.yMax=1;d.zMax=1;d=new qf(10526880,d,null,this);if(null!=c.offsets){var e=d.bounds;e.xMin=1E20;e.xMax=-1E20;e.yMin=1E20;e.yMax=-1E20;e.zMin=1E20;e.zMax=-1E20;var f=c.offsets,g=f.xMin;e=f.yMin;var h=f.zMin;null==h&&(h=0);null==e&&(e=0);null==g&&(g=0);f=e;null==h&&(h=0);null==f&&(f=0);null==g&&(g=0);e=d.bounds;var k=c.offsetRay;g-k<e.xMin&&(e.xMin=g-k);g+k>e.xMax&&(e.xMax=g+k);f-k<
e.yMin&&(e.yMin=f-k);f+k>e.yMax&&(e.yMax=f+k);h-k<e.zMin&&(e.zMin=h-k);h+k>e.zMax&&(e.zMax=h+k);f=c.offsets;g=f.xMax;e=f.yMax;h=f.zMax;null==h&&(h=0);null==e&&(e=0);null==g&&(g=0);f=e;null==h&&(h=0);null==f&&(f=0);null==g&&(g=0);e=d.bounds;c=c.offsetRay;g-c<e.xMin&&(e.xMin=g-c);g+c>e.xMax&&(e.xMax=g+c);f-c<e.yMin&&(e.yMin=f-c);f+c>e.yMax&&(e.yMax=f+c);h-c<e.zMin&&(e.zMin=h-c);h+c>e.zMax&&(e.zMax=h+c)}else c=d.bounds,c.xMin=1E20,c.xMax=-1E20,c.yMin=1E20,c.yMax=-1E20,c.zMin=1E20,c.zMax=-1E20,c=d.bounds,
-.1<c.xMin&&(c.xMin=-.1),.1>c.xMax&&(c.xMax=.1),-.1<c.yMin&&(c.yMin=-.1),.1>c.yMax&&(c.yMax=.1),-.1<c.zMin&&(c.zMin=-.1),.1>c.zMax&&(c.zMax=.1);this.boxes.push(d)}},updateJoints:function(){for(var a=0,b=this.boxes.length;a<b;){var c=a++,d=this.skin.skinData.allJoints[c];c=this.boxes[c];null!=d.offsets?c.setTransform(this.skin.currentPalette[d.bindIndex]):c.setTransform(this.skin.jointsData[d.index].currentAbsPose)}},sync:function(a){this.col.checkBounds();this.updateJoints()},__class__:Ig});var ve=
function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.r=d};ve.__name__="h3d.col.Sphere";ve.__super__=Ib;ve.prototype=D(Ib.prototype,{load:function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.r=d},getCenter:function(){var a=this.x,b=this.y,c=this.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)},distance:function(a){var b=
a.x-this.x,c=a.y-this.y;a=a.z-this.z;b=b*b+c*c+a*a-this.r*this.r;return 0>b?-Math.sqrt(-b):Math.sqrt(b)},distanceSq:function(a){var b=a.x-this.x,c=a.y-this.y;a=a.z-this.z;return b*b+c*c+a*a-this.r*this.r},contains:function(a){var b=a.x-this.x,c=a.y-this.y;a=a.z-this.z;return 0>b*b+c*c+a*a-this.r*this.r},rayIntersection:function(a,b){b=a.px-this.x;var c=a.py-this.y,d=a.pz-this.z;a=b*a.lx+c*a.ly+d*a.lz;b=b*b+c*c+d*d-this.r*this.r;if(0<b&&0<a)return-1;b=a*a-b;if(0>b)return-1;a=-a-Math.sqrt(b);return 0>
a?0:a},inFrustum:function(a,b){return null!=b?this.inFrustumMatrix(a,b):a.hasSphere(this)},inFrustumMatrix:function(a,b){var c=this.x,d=this.y,e=this.z,f=this.r,g=this.x,h=this.y,k=this.z;null==k&&(k=0);null==h&&(h=0);null==g&&(g=0);var l=k;null==l&&(l=0);null==h&&(h=0);null==g&&(g=0);k=g;g=h;h=l;l=k*b._12+g*b._22+h*b._32+b._42;var m=k*b._13+g*b._23+h*b._33+b._43;this.x=k*b._11+g*b._21+h*b._31+b._41;this.y=l;this.z=m;k=Math.sqrt(b._11*b._11+b._12*b._12+b._13*b._13);g=Math.sqrt(b._21*b._21+b._22*b._22+
b._23*b._23);h=Math.sqrt(b._31*b._31+b._32*b._32+b._33*b._33);0>b._11*(b._22*b._33-b._23*b._32)+b._12*(b._23*b._31-b._21*b._33)+b._13*(b._21*b._32-b._22*b._31)&&(k*=-1,g*=-1,h*=-1);this.r*=Math.abs(Math.max(Math.max(k,g),h));a=a.hasSphere(this);this.x=c;this.y=d;this.z=e;this.r=f;return a},transform:function(a){var b=Math.sqrt(a._11*a._11+a._12*a._12+a._13*a._13);var c=Math.sqrt(a._21*a._21+a._22*a._22+a._23*a._23);var d=Math.sqrt(a._31*a._31+a._32*a._32+a._33*a._33);0>a._11*(a._22*a._33-a._23*a._32)+
a._12*(a._23*a._31-a._21*a._33)+a._13*(a._21*a._32-a._22*a._31)&&(b*=-1,c*=-1,d*=-1);var e=0>b?-b:b;b=c;c=0>b?-b:b;e=e<c?c:e;b=d;c=0>b?-b:b;this.r*=e<c?c:e;c=this.x;b=this.y;d=this.z;null==d&&(d=0);null==b&&(b=0);null==c&&(c=0);e=d;null==e&&(e=0);null==b&&(b=0);null==c&&(c=0);d=c;c=b;b=e;e=d*a._12+c*a._22+b*a._32+a._42;var f=d*a._13+c*a._23+b*a._33+a._43;this.x=d*a._11+c*a._21+b*a._31+a._41;this.y=e;this.z=f},inSphere:function(a){var b=this.x,c=this.y,d=this.z;null==d&&(d=0);null==c&&(c=0);null==
b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=a.x;c=a.y;d=a.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b-e;f=c-f;g=d-g;return e*e+f*f+g*g<(a.r+this.r)*(a.r+this.r)},toString:function(){var a=this.x,b=this.y,c=this.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return"Sphere{"+y.string(new G(a,b,c))+","+T.fmt(this.r)+"}"},dimension:function(){return this.r},closestPoint:function(a){var b=this.x,c=this.y,d=this.z;null==d&&
(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=a.x-b;c=a.y-c;d=a.z-d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a=b*b+c*c+d*d;a=1E-20>a?0:1/Math.sqrt(a);b*=a;c*=a;d*=a;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a=this.r;b*=a;c*=a;d*=a;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a=b;var e=c,f=d;b=this.x;c=this.y;d=this.z;null==
d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=a+b;c=e+c;d=f+d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new G(b,c,d)},clone:function(){var a=new ve;a.x=this.x;a.y=this.y;a.z=this.z;a.r=this.r;return a},makeDebugObj:function(){var a=ge.defaultUnitSphere();a=new Ra(a);var b=this.r;var c=a.scaleX*b;a.scaleX=c;c=1;var d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);c=a.scaleY*b;a.scaleY=c;c=1;d=!0;a.flags=d?a.flags|c:a.flags&
~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);c=a.scaleZ*b;a.scaleZ=c;c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.y;var e=this.z;a.x=this.x;c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);a.y=b;c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);a.z=e;c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&
(a.flags|=262144);c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);return a},__class__:ve});var Ia=K["h3d.impl.Feature"]={__ename__:!0,__constructs__:null,StandardDerivatives:{_hx_name:"StandardDerivatives",_hx_index:0,__enum__:"h3d.impl.Feature",toString:v},FloatTextures:{_hx_name:"FloatTextures",_hx_index:1,__enum__:"h3d.impl.Feature",toString:v},AllocDepthBuffer:{_hx_name:"AllocDepthBuffer",_hx_index:2,__enum__:"h3d.impl.Feature",toString:v},HardwareAccelerated:{_hx_name:"HardwareAccelerated",
_hx_index:3,__enum__:"h3d.impl.Feature",toString:v},MultipleRenderTargets:{_hx_name:"MultipleRenderTargets",_hx_index:4,__enum__:"h3d.impl.Feature",toString:v},Queries:{_hx_name:"Queries",_hx_index:5,__enum__:"h3d.impl.Feature",toString:v},SRGBTextures:{_hx_name:"SRGBTextures",_hx_index:6,__enum__:"h3d.impl.Feature",toString:v},ShaderModel3:{_hx_name:"ShaderModel3",_hx_index:7,__enum__:"h3d.impl.Feature",toString:v},BottomLeftCoords:{_hx_name:"BottomLeftCoords",_hx_index:8,__enum__:"h3d.impl.Feature",
toString:v},Wireframe:{_hx_name:"Wireframe",_hx_index:9,__enum__:"h3d.impl.Feature",toString:v},InstancedRendering:{_hx_name:"InstancedRendering",_hx_index:10,__enum__:"h3d.impl.Feature",toString:v}};Ia.__constructs__=[Ia.StandardDerivatives,Ia.FloatTextures,Ia.AllocDepthBuffer,Ia.HardwareAccelerated,Ia.MultipleRenderTargets,Ia.Queries,Ia.SRGBTextures,Ia.ShaderModel3,Ia.BottomLeftCoords,Ia.Wireframe,Ia.InstancedRendering];Ia.__empty_constructs__=[Ia.StandardDerivatives,Ia.FloatTextures,Ia.AllocDepthBuffer,
Ia.HardwareAccelerated,Ia.MultipleRenderTargets,Ia.Queries,Ia.SRGBTextures,Ia.ShaderModel3,Ia.BottomLeftCoords,Ia.Wireframe,Ia.InstancedRendering];var Wf=K["h3d.impl.QueryKind"]={__ename__:!0,__constructs__:null,TimeStamp:{_hx_name:"TimeStamp",_hx_index:0,__enum__:"h3d.impl.QueryKind",toString:v},Samples:{_hx_name:"Samples",_hx_index:1,__enum__:"h3d.impl.QueryKind",toString:v}};Wf.__constructs__=[Wf.TimeStamp,Wf.Samples];Wf.__empty_constructs__=[Wf.TimeStamp,Wf.Samples];var Xf=K["h3d.impl.RenderFlag"]=
{__ename__:!0,__constructs__:null,CameraHandness:{_hx_name:"CameraHandness",_hx_index:0,__enum__:"h3d.impl.RenderFlag",toString:v}};Xf.__constructs__=[Xf.CameraHandness];Xf.__empty_constructs__=[Xf.CameraHandness];var Ud=function(){this.shaderCache=Ud.SHADER_CACHE};Ud.__name__="h3d.impl.Driver";Ud.setShaderCache=function(a){Ud.SHADER_CACHE=a};Ud.prototype={hasFeature:function(a){return!1},setRenderFlag:function(a,b){},isSupportedFormat:function(a){return!1},isDisposed:function(){return!0},dispose:function(){},
begin:function(a){},log:function(a){},generateMipMaps:function(a){throw t.thrown("Mipmaps auto generation is not supported on this platform");},getNativeShaderCode:function(a){return null},logImpl:function(a){},clear:function(a,b,c){},captureRenderBuffer:function(a){},capturePixels:function(a,b,c,d){throw t.thrown("Can't capture pixels on this platform");},getDriverName:function(a){return"Not available"},init:function(a,b){},resize:function(a,b){},selectShader:function(a){return!1},selectMaterial:function(a){},
uploadShaderBuffers:function(a,b){},selectBuffer:function(a){},selectMultiBuffers:function(a,b){},draw:function(a,b,c){},drawInstanced:function(a,b){},setRenderZone:function(a,b,c,d){},setRenderTarget:function(a,b,c,d){},setRenderTargets:function(a,b){},setDepth:function(a){},allocDepthBuffer:function(a){return null},disposeDepthBuffer:function(a){},getDefaultDepthBuffer:function(){return null},present:function(){},end:function(){},setDebug:function(a){},allocTexture:function(a){return null},allocBuffer:function(a){return null},
allocInstanceBuffer:function(a,b){},uploadInstanceBufferBytes:function(a,b,c,d,e){},disposeTexture:function(a){},disposeBuffer:function(a){},disposeInstanceBuffer:function(a){},uploadIndexData:function(a,b,c,d,e){},uploadBufferData:function(a,b,c,d,e){},uploadBufferBytes:function(a,b,c,d,e){},uploadTextureBitmap:function(a,b,c,d){},uploadTexturePixels:function(a,b,c,d){},readBufferBytes:function(a,b,c,d,e){},onTextureBiasChanged:function(a){},copyTexture:function(a,b){return!1},allocQuery:function(a){return null},
deleteQuery:function(a){},beginQuery:function(a){},endQuery:function(a){},queryResultAvailable:function(a){return!0},queryResult:function(a){return 0},computeDispatch:function(a,b,c){throw t.thrown("Compute shaders are not implemented on this platform");},__class__:Ud};var Vh=function(a,b,c){this.s=a;this.kind=b;this.shader=c};Vh.__name__="h3d.impl._GlDriver.CompiledShader";Vh.prototype={__class__:Vh};var Wh=function(){};Wh.__name__="h3d.impl._GlDriver.CompiledAttribute";Wh.prototype={__class__:Wh};
var Xh=function(){};Xh.__name__="h3d.impl._GlDriver.CompiledProgram";Xh.prototype={__class__:Xh};var oa=function(a){null==a&&(a=0);this.features=new $e;this.maxCompressedTexturesSupport=0;this.rightHanded=this.hasMultiIndirect=!1;this.firstShader=!0;this.boundTextures=[];this.curTargets=[];var b=[];b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);
b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);this.currentDivisor=b;this.curColorMask=-1;this.lastActiveIndex=0;this.curStEnabled=!1;this.curMatBits=this.curStOpBits=this.curStMaskBits=-1;this.maxIdxCurAttribs=0;this.curAttribs=[];Ud.call(this);this.canvas=ic.getInstance().canvas;a={alpha:!1,stencil:!0,antialias:0<a};oa.ALLOW_WEBGL2&&(this.gl=this.canvas.getContext("webgl2",a));null==this.gl&&(this.gl=Xi.getContextWebGL(this.canvas,a));
if(null==this.gl)throw t.thrown("Could not acquire GL context");"undefined"!=typeof WebGLDebugUtils&&(this.gl=WebGLDebugUtils.makeDebugContext(this.gl),this.glDebug=!0);this.commonFB=this.gl.createFramebuffer();this.programs=new Fa;this.defStencil=new pa;this.frame=ea.frameCount;a=this.gl.getParameter(7938);b=new oe("ES ([0-9]+\\.[0-9]+)","");b.match(a)&&(this.glES=parseFloat(b.matched(1)));b=new oe("[0-9]+\\.[0-9]+","");a=this.gl.getParameter(35724);b.match(a)&&(this.glES=parseFloat(b.matched(0)),
this.shaderVersion=Math.round(100*parseFloat(b.matched(0))));this.drawMode=4;this.makeFeatures();this.hasFeature(Ia.InstancedRendering)&&3>this.glES&&(a=this.gl.getExtension("ANGLE_instanced_arrays"),this.gl.vertexAttribDivisor=M(a,a.vertexAttribDivisorANGLE),this.gl.drawElementsInstanced=M(a,a.drawElementsInstancedANGLE));Ob.UNROLL_LOOPS=!this.hasFeature(Ia.ShaderModel3);this.gl.pixelStorei(3333,1);this.gl.pixelStorei(3317,1)};oa.__name__="h3d.impl.GlDriver";oa.__super__=Ud;oa.prototype=D(Ud.prototype,
{setRenderFlag:function(a,b){this.rightHanded=0<b},logImpl:function(a){console.log(a)},setDebug:function(a){this.debug=a},begin:function(a){this.frame=a;this.resetStream();this.gl.useProgram(null);this.curBuffer=this.curShader=null},makeCompiler:function(){var a=new mc;a.glES=this.glES;a.version=this.shaderVersion;a.intelDriverFix=this.isIntelGpu;return a},getNativeShaderCode:function(a){if(a.mode==Fb.Compute){var b=a.vertex.data;return this.makeCompiler().run(b)}b=a.vertex.data;var c="// vertex:\n"+
this.makeCompiler().run(b)+"// fragment:\n";b=a.fragment.data;return c+this.makeCompiler().run(b)},getDriverName:function(a){var b=this.gl.getParameter(7937);b=a?b+(" GLv"+y.string(this.gl.getParameter(7938))):b.split("/").shift();b=b.split("WebGL ").join("");return"OpenGL "+b},compileShader:function(a,b){switch(b.kind._hx_index){case 0:var c=35633;break;case 1:c=35632;break;case 4:throw t.thrown("Compute shader is not supported");default:throw t.thrown("assert");}c=this.gl.createShader(c);null==
b.code&&(b.code=a.run(b.data),b.data.funs=null);this.gl.shaderSource(c,b.code);this.gl.compileShader(c);if(1!=this.gl.getShaderParameter(c,35713)){a=this.gl.getShaderInfoLog(c);c=y.parseInt(F.substr(a,9,null));c=null==c?null:b.code.split("\n")[c-1];c=null==c?"":"("+X.trim(c)+")";b=b.code.split("\n");for(var d=0,e=b.length;d<e;){var f=d++;b[f]=f+1+"\t"+b[f]}throw t.thrown("An error occurred compiling the shaders: "+a+c+"\n\n"+b.join("\n"));}return new Vh(c,b.kind,b)},initShader:function(a,b,c,d){switch(b.kind._hx_index){case 0:var e=
"vertex";break;case 1:e="fragment";break;default:e="compute"}b.globals=this.gl.getUniformLocation(a.p,e+"Globals");b.params=this.gl.getUniformLocation(a.p,e+"Params");b.textures=[];var f=0;var g=null;for(var h=0,k="",l=c.textures;null!=l;){var m=l.type;var p=1;switch(m._hx_index){case 15:var r=m.size;0==r._hx_index&&(r=r.v,m=m.t,p=r);break;case 17:m=x.TSampler(Ta.T2D,!1)}if(null==g||!da.enumEq(m,g)){g=m;switch(m._hx_index){case 10:r=m.dim;f=m.isArray;switch(r._hx_index){case 1:h=f?35866:3553;break;
case 2:if(0==f)h=32879;else throw t.thrown("Texture not supported "+y.string(m));break;case 3:if(0==f)h=34067;else throw t.thrown("Texture not supported "+y.string(m));break;default:throw t.thrown("Texture not supported "+y.string(m));}k="Textures"+(r==Ta.T2D?"":F.substr(K[r.__enum__].__constructs__[r._hx_index]._hx_name,1,null))+(f?"Array":"");break;case 11:throw t.thrown("Texture not supported "+y.string(m));default:throw t.thrown("Unsupported texture type "+y.string(m));}f=0}m=0;for(r=p;m<r;){m++;
p=this.gl.getUniformLocation(a.p,e+k+"["+f+"]");if(null==p)throw t.thrown("Texture "+d.spec.instances[l.instance].shader.data.name+"."+l.name+" is missing from generated shader");b.textures.push({u:p,t:g,mode:h});++f}l=l.next}if(0<c.bufferCount){b.bufferTypes=[];for(e=b.shader.buffers;null!=e;){r=e.type;if(16==r._hx_index)r=r.kind;else throw t.thrown("assert");b.bufferTypes.push(r);e=e.next}r=[];e=0;for(m=c.bufferCount;e<m;){g=e++;switch(b.bufferTypes[g]._hx_index){case 0:g=this.gl.getUniformBlockIndex(a.p,
(c.kind==Ca.Vertex?"vertex_":"")+"uniform_buffer"+g);break;case 1:throw t.thrown("Storage buffer not supported in WebGL");case 2:throw t.thrown("RW buffer not supported in WebGL");default:throw t.thrown("assert");}r.push(g)}b.buffers=r;h=0;b.kind==Ca.Fragment&&(h=d.vertex.bufferCount);r=0;for(e=c.bufferCount;r<e;)switch(g=r++,b.bufferTypes[g]._hx_index){case 0:this.gl.uniformBlockBinding(a.p,b.buffers[g],g+h);break;case 1:case 2:break;default:throw t.thrown("assert");}}},selectShader:function(a){var b=
this.programs.h[a.id];if(null==b){b=new Xh;var c=this.makeCompiler();b.vertex=this.compileShader(c,a.vertex);null!=a.fragment&&(b.fragment=this.compileShader(c,a.fragment));b.p=this.gl.createProgram();this.gl.attachShader(b.p,b.vertex.s);null!=b.fragment&&this.gl.attachShader(b.p,b.fragment.s);var d=null;try{this.gl.linkProgram(b.p),1!=this.gl.getProgramParameter(b.p,35714)&&(d=this.gl.getProgramInfoLog(b.p))}catch(r){throw a=t.caught(r).unwrap(),t.thrown("Shader linkage error: "+y.string(a)+" ("+
this.getDriverName(!1)+")");}this.gl.deleteShader(b.vertex.s);null!=b.fragment&&this.gl.deleteShader(b.fragment.s);if(null!=d)throw this.gl.deleteProgram(b.p),t.thrown("Program linkage failure: "+d+"\nVertex=\n"+a.vertex.code+(null==a.fragment?"":"\n\nFragment=\n"+a.fragment.code));this.firstShader=!1;this.initShader(b,b.vertex,a.vertex,a);null!=b.fragment&&this.initShader(b,b.fragment,a.fragment,a);b.attribs=[];b.hasAttribIndex=0;d=[];for(var e=0,f=a.vertex.data.vars;e<f.length;){var g=f[e];++e;
if(1==g.kind._hx_index){var h=Vd.fromHXSL(g.type),k=this.gl.getAttribLocation(b.p,c.varNames.h.hasOwnProperty(g.id)?c.varNames.h[g.id]:g.name);if(!(0>k)){if(32<=k)throw t.thrown("assert");var l=new Wh;l.type=5126;l.index=k;l.size=h==ka.__cast(9,jc)?1:h;k=g.type;9==k._hx_index&&(k=k.size,l.type=5120,l.size=k);l.divisor=0;if(null!=g.qualifiers){k=0;for(var m=g.qualifiers;k<m.length;){var p=m[k];++k;9==p._hx_index&&(l.divisor=p.v)}}b.attribs.push(l);b.hasAttribIndex|=1<<l.index;d.push(new va(g.name,
h,0))}}}b.format=N.make(d);this.programs.h[a.id]=b}if(this.curShader==b)return!1;this.setProgram(b);return!0},setProgram:function(a){this.gl.useProgram(a.p);for(var b=0,c=a.attribs;b<c.length;){var d=c[b];++b;this.curAttribs[d.index]||(this.gl.enableVertexAttribArray(d.index),this.curAttribs[d.index]=!0,this.maxIdxCurAttribs<d.index&&(this.maxIdxCurAttribs=d.index))}var e=0;b=0;for(c=this.maxIdxCurAttribs+1;b<c;)d=b++,this.curAttribs[d]&&0==(a.hasAttribIndex&1<<d)?(this.gl.disableVertexAttribArray(d),
this.curAttribs[d]=!1):this.curAttribs[d]&&(e=d);this.maxIdxCurAttribs=e;this.curShader=a;this.curBuffer=null;b=0;for(c=this.boundTextures.length;b<c;)d=b++,this.boundTextures[d]=null},uploadShaderBuffers:function(a,b){this.uploadBuffer(a,this.curShader.vertex,a.vertex,b);null!=this.curShader.fragment&&this.uploadBuffer(a,this.curShader.fragment,a.fragment,b)},uploadBuffer:function(a,b,c,d){switch(d){case 0:null!=b.globals&&(c=c.globals.subarray(0,4*b.shader.globalsSize),this.gl.uniform4fv(b.globals,
c));break;case 1:null!=b.params&&(c=c.params.subarray(0,4*b.shader.paramsSize),this.gl.uniform4fv(b.params,c));break;case 2:var e=0;for(d=b.textures.length;e<d;){var f=e++;var g=c.tex[f],h=b.textures[f];if(null==g||null==g.t&&(g.isDepth()||null==g.realloc))if(g=h.t,10==g._hx_index){var k=g.isArray;if(3==g.dim._hx_index)if(0==k)g=W.defaultCubeTexture();else throw t.thrown("Missing texture");else if(0==k)g=Ad.loadingTextureColor,g=W.fromColor(g,(g>>>24)/255);else throw t.thrown("Missing texture");}else throw t.thrown("Missing texture");
if(null!=g&&null==g.t&&null!=g.realloc&&(k=this.curShader,g.alloc(),g.realloc(),this.curShader!=k)){this.setProgram(k);this.uploadShaderBuffers(a,0);this.uploadShaderBuffers(a,1);this.uploadShaderBuffers(a,2);return}g.set_lastFrame(this.frame);if(null!=h.u){f=b.kind==Ca.Fragment?this.curShader.vertex.textures.length+f:f;if(this.boundTextures[f]!=g.t){this.boundTextures[f]=g.t;k=this.getBindType(g);if(k!=h.mode)throw t.thrown("Texture format mismatch: "+y.string(g)+" should be "+y.string(h.t));this.gl.activeTexture(33984+
f);this.gl.uniform1i(h.u,f);this.gl.bindTexture(k,g.t.t);this.lastActiveIndex=f}k=g.mipMap._hx_index;var l=g.filter._hx_index;f=g.wrap._hx_index;var m=k|l<<3|f<<6;m!=g.t.bits&&(g.t.bits=m,l=oa.TFILTERS[k][l],k=h.mode,this.gl.texParameteri(k,10240,l[0]),this.gl.texParameteri(k,10241,l[1]),this.gl.texParameteri(k,34892,0),f=oa.TWRAP[f],this.gl.texParameteri(k,10242,f),this.gl.texParameteri(k,10243,f));g.t.startMip!=g.startingMip&&(this.gl.texParameteri(h.mode,33084,g.startingMip),g.t.startMip=g.startingMip)}}break;
case 3:if(null!=b.buffers)for(a=0,b.kind==Ca.Fragment&&null!=this.curShader.vertex.buffers&&(a=this.curShader.vertex.buffers.length),e=0,d=b.buffers.length;e<d;)switch(f=e++,b.bufferTypes[f]._hx_index){case 0:this.gl.bindBufferBase(35345,f+a,c.buffers[f].vbuf);break;case 1:this.gl.bindBufferBase(37074,f+a,c.buffers[f].vbuf);break;case 2:if(0==(c.buffers[f].flags&1<<Ja.ReadWriteBuffer._hx_index))throw t.thrown("Buffer was allocated without ReadWriteBuffer flag");this.gl.bindBufferBase(37074,f+a,c.buffers[f].vbuf);
break;default:throw t.thrown("assert");}}},selectMaterial:function(a){var b=a.bits;if(null==this.curTarget==this.rightHanded)switch(a.culling._hx_index){case 1:b=b&-4|2;break;case 2:b=b&-4|1}this.selectMaterialBits(b);if(this.curColorMask!=a.colorMask){b=a.colorMask;this.gl.colorMask(0!=(b&1),0!=(b&2),0!=(b&4),0!=(b&8));if(0<b>>4)throw t.thrown("GL ColorMaski support requires hlsdl 1.14+");this.curColorMask=b}b=this.defStencil;null==a.stencil?this.curStEnabled&&(this.gl.disable(2960),this.curStEnabled=
!1):(b=a.stencil,this.curStEnabled||(this.gl.enable(2960),this.curStEnabled=!0));this.selectStencilBits(b.opBits,b.maskBits)},selectMaterialBits:function(a){var b=a^this.curMatBits;0>this.curMatBits&&(b=-1);if(0!=b){this.drawMode=0!=(a&268435456)?3:4;if(0!=(b&3)){var c=a&3;0==c?this.gl.disable(2884):((0>this.curMatBits||0==(this.curMatBits&3))&&this.gl.enable(2884),this.gl.cullFace(oa.FACES[c]))}if(0!=(b&4194240)){c=a>>6&15;var d=a>>10&15,e=a>>14&15,f=a>>18&15;c==e&&d==f?0==c&&1==d?this.gl.disable(3042):
((0>this.curMatBits||0==(this.curMatBits>>6&15)&&1==(this.curMatBits>>10&15))&&this.gl.enable(3042),this.gl.blendFunc(oa.BLEND[c],oa.BLEND[d])):((0>this.curMatBits||0==(this.curMatBits>>6&15)&&1==(this.curMatBits>>10&15))&&this.gl.enable(3042),this.gl.blendFuncSeparate(oa.BLEND[c],oa.BLEND[d],oa.BLEND[e],oa.BLEND[f]))}0!=(b&264241152)&&(c=a>>22&7,d=a>>25&7,c==d?this.gl.blendEquation(oa.OP[c]):this.gl.blendEquationSeparate(oa.OP[c],oa.OP[d]));0!=(b&4)&&this.gl.depthMask(0!=(a>>2&1));0!=(b&56)&&(b=
a>>3&7,0==b?this.gl.disable(2929):((0>this.curMatBits||0==(this.curMatBits>>3&7))&&this.gl.enable(2929),this.gl.depthFunc(oa.COMPARE[b])));this.curMatBits=a}},selectStencilBits:function(a,b){var c=a^this.curStOpBits,d=b^this.curStMaskBits;0!=(c|d)&&(0!=(c&4088)&&this.gl.stencilOpSeparate(oa.FACES[2],oa.STENCIL_OP[a>>6&7],oa.STENCIL_OP[a>>9&7],oa.STENCIL_OP[a>>3&7]),0!=(c&16744448)&&this.gl.stencilOpSeparate(oa.FACES[1],oa.STENCIL_OP[a>>18&7],oa.STENCIL_OP[a>>21&7],oa.STENCIL_OP[a>>15&7]),0!=(c&7|
d&16711935)&&this.gl.stencilFuncSeparate(oa.FACES[2],oa.COMPARE[a&7],b>>16&255,b&255),0!=(c&28672|d&16711935)&&this.gl.stencilFuncSeparate(oa.FACES[1],oa.COMPARE[a>>12&7],b>>16&255,b&255),0!=(d&65280)&&(c=b>>8&255,this.gl.stencilMaskSeparate(oa.FACES[2],c),this.gl.stencilMaskSeparate(oa.FACES[1],c)),this.curStOpBits=a,this.curStMaskBits=b)},clear:function(a,b,c){var d=0;null!=a&&(this.gl.colorMask(!0,!0,!0,!0),this.curColorMask=15,this.gl.clearColor(a.x,a.y,a.z,a.w),d|=16384);null!=b&&(this.gl.depthMask(!0),
0<=this.curMatBits&&(this.curMatBits|=4),this.gl.clearDepth(b),d|=256);null!=c&&(this.selectStencilBits(this.defStencil.opBits,this.defStencil.maskBits),this.gl.clearStencil(c),d|=1024);0!=d&&this.gl.clear(d);null!=this.curTarget&&(this.curTarget.flags|=1<<P.WasCleared._hx_index)},resize:function(a,b){if(""==this.canvas.style.width){var c=a/window.devicePixelRatio|0;this.canvas.style.width=c+"px";c=b/window.devicePixelRatio|0;this.canvas.style.height=c+"px"}this.canvas.width=a;this.canvas.height=
b;this.bufferWidth=a;this.bufferHeight=b;this.gl.viewport(0,0,a,b);null!=this.defaultDepth&&(this.disposeDepthBuffer(this.defaultDepth),this.defaultDepth.width=this.bufferWidth,this.defaultDepth.height=this.bufferHeight,this.defaultDepth.t=this.allocDepthBuffer(this.defaultDepth))},getChannels:function(a){switch(a.internalFmt){case 6407:return 6407;case 6408:return 6408;case 32857:return 6408;case 6403:case 33321:case 33322:case 33325:case 33326:return 6403;case 33319:case 33323:case 33324:case 33327:case 33328:return 33319;
case 34836:case 34842:return 6408;case 35898:return 6407;case 35904:case 35905:return 6407;case 32859:case 33777:case 33778:case 33779:case 36492:return 6408;case 32852:case 34837:case 34843:case 36495:return 6407;default:throw t.thrown("Invalid format "+a.internalFmt);}},isSupportedFormat:function(a){switch(a._hx_index){case 2:return!0;case 3:case 4:return this.hasFeature(Ia.FloatTextures);case 14:case 15:return this.hasFeature(Ia.SRGBTextures);case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 16:case 17:return 3<=
this.glES;case 22:return a.v<=this.maxCompressedTexturesSupport;default:return!1}},getBindType:function(a){return 0!=(a.flags&1<<P.Is3D._hx_index)?32879:0!=(a.flags&1<<P.Cube._hx_index)?34067:0!=(a.flags&1<<P.IsArray._hx_index)?35866:3553},allocTexture:function(a){oa.outOfMemoryCheck&&this.gl.getError();var b=this.gl.createTexture();var c=this.getBindType(a);b={t:b,width:a.width,height:a.height,internalFmt:6408,pixelFmt:5121,bits:-1,bind:c,bias:0,startMip:a.startingMip};var d=a.format;switch(d._hx_index){case 1:b.internalFmt=
32856;break;case 2:break;case 3:if(this.hasFeature(Ia.FloatTextures))b.pixelFmt=5131,b.internalFmt=34842;else throw t.thrown("Unsupported texture format "+y.string(a.format));break;case 4:if(this.hasFeature(Ia.FloatTextures))b.internalFmt=34836,b.pixelFmt=5126;else throw t.thrown("Unsupported texture format "+y.string(a.format));break;case 5:b.internalFmt=33321;break;case 6:b.internalFmt=33325;b.pixelFmt=5131;break;case 7:b.internalFmt=33326;b.pixelFmt=5126;break;case 8:b.internalFmt=33323;break;
case 9:b.internalFmt=33327;b.pixelFmt=5131;break;case 10:b.internalFmt=33328;b.pixelFmt=5126;break;case 11:b.internalFmt=6407;break;case 12:b.internalFmt=34843;b.pixelFmt=5131;break;case 13:b.internalFmt=34837;b.pixelFmt=5126;break;case 14:b.internalFmt=35905;break;case 16:b.internalFmt=32857;b.pixelFmt=33640;break;case 17:b.internalFmt=35898;b.pixelFmt=35899;break;case 18:b.internalFmt=33322;b.pixelFmt=5123;break;case 19:b.internalFmt=33324;b.pixelFmt=5123;break;case 20:b.internalFmt=32852;b.pixelFmt=
5123;break;case 21:b.internalFmt=32859;b.pixelFmt=5123;break;case 22:d=d.v;if(d<=this.maxCompressedTexturesSupport){if(0!=(a.width&3)||0!=(a.height&3))throw t.thrown("Compressed texture "+y.string(a)+" has size "+a.width+"x"+a.height+" - must be a multiple of 4");switch(d){case 1:b.internalFmt=33777;break;case 2:b.internalFmt=33778;break;case 3:b.internalFmt=33779;break;case 6:b.internalFmt=36495;break;case 7:b.internalFmt=36492;break;default:throw t.thrown("Unsupported texture format "+y.string(a.format));
}}else throw t.thrown("Unsupported texture format "+y.string(a.format));break;default:throw t.thrown("Unsupported texture format "+y.string(a.format));}if(5123==b.pixelFmt&&!this.has16Bits)throw t.thrown("16 bit textures requires EXT_texture_norm16 extension");a.set_lastFrame(this.frame);a.flags&=-1-(1<<P.WasCleared._hx_index);this.gl.bindTexture(c,b.t);d=!1;this.gl.texParameteri(c,33084,a.startingMip);this.gl.texParameteri(c,33085,a.get_mipLevels()-1);var e=6408==b.internalFmt?32856:b.internalFmt;
0==(a.flags&1<<P.IsArray._hx_index)&&0==(a.flags&1<<P.Is3D._hx_index)||0!=(a.flags&1<<P.Cube._hx_index)?this.gl.texStorage2D(c,a.get_mipLevels(),e,b.width,b.height):this.gl.texStorage3D(c,a.get_mipLevels(),e,b.width,b.height,a.get_layerCount());if(oa.outOfMemoryCheck)if(c=this.gl.getError(),1285==c)d=!0;else if(0!=c)throw t.thrown("Failed to alloc texture "+y.string(a.format)+"(error "+c+")");this.restoreBind();return d?(this.gl.deleteTexture(b.t),null):b},restoreBind:function(){var a=this.boundTextures[this.lastActiveIndex];
null==a?this.gl.bindTexture(3553,null):this.gl.bindTexture(a.bind,a.t)},allocDepthBuffer:function(a){var b={t:this.gl.createTexture(),width:a.width,height:a.height,internalFmt:6408,pixelFmt:5121,bits:-1,bind:3553,bias:0,startMip:0},c=6402;switch(a.format._hx_index){case 23:b.internalFmt=33189;break;case 24:if(3<=this.glES)b.internalFmt=6402;else throw t.thrown("Unsupported depth format "+y.string(a.format));break;case 25:b.internalFmt=35056;b.pixelFmt=34042;c=34041;break;case 26:b.internalFmt=36012;
break;default:throw t.thrown("Unsupported depth format "+y.string(a.format));}a.set_lastFrame(this.frame);a.flags&=-1-(1<<P.WasCleared._hx_index);this.gl.bindTexture(b.bind,b.t);this.gl.texParameteri(b.bind,10241,9728);this.gl.texParameteri(b.bind,10240,9728);this.gl.texParameteri(b.bind,10242,33071);this.gl.texParameteri(b.bind,10243,33071);this.gl.texImage2D(b.bind,0,b.internalFmt,b.width,b.height,0,c,b.pixelFmt,null);this.restoreBind();return b},disposeDepthBuffer:function(a){null!=a.t&&null!=
a.t.t&&(this.gl.deleteTexture(a.t.t),a.t=null)},getDefaultDepthBuffer:function(){if(null!=this.defaultDepth)return this.defaultDepth;this.defaultDepth=new W(0,0,null,J.Depth24Stencil8);this.defaultDepth.name="defaultDepthBuffer";this.defaultDepth.width=this.bufferWidth;this.defaultDepth.height=this.bufferHeight;this.defaultDepth.t=this.allocDepthBuffer(this.defaultDepth);return this.defaultDepth},discardError:function(){oa.outOfMemoryCheck&&this.gl.getError()},allocBuffer:function(a){oa.outOfMemoryCheck&&
this.gl.getError();var b=this.gl.createBuffer(),c=0!=(a.flags&1<<Ja.IndexBuffer._hx_index)?34963:34962;this.gl.bindBuffer(c,b);if(0==a.vertices*a.format.stride)throw t.thrown("assert");this.gl.bufferData(c,a.vertices*a.format.strideBytes,0!=(a.flags&1<<Ja.Dynamic._hx_index)?35048:35044);var d=oa.outOfMemoryCheck&&1285==this.gl.getError();this.gl.bindBuffer(c,null);0!=(a.flags&1<<Ja.IndexBuffer._hx_index)&&(this.curIndexBuffer=null);return d?(this.gl.deleteBuffer(b),null):b},disposeTexture:function(a){var b=
a.t;if(null!=b){a.t=null;a=0;for(var c=this.boundTextures.length;a<c;){var d=a++;this.boundTextures[d]==b&&(this.boundTextures[d]=null)}this.gl.deleteTexture(b.t)}},disposeBuffer:function(a){this.gl.deleteBuffer(a.vbuf)},generateMipMaps:function(a){var b=this.getBindType(a);this.gl.bindTexture(b,a.t.t);this.gl.generateMipmap(b);this.restoreBind()},uploadTextureBitmap:function(a,b,c,d){a.format!=J.RGBA||1!=a.get_layerCount()?(b=b.getPixels(),this.uploadTexturePixels(a,b,c,d),b.dispose()):(d=b.ctx,
this.gl.bindTexture(3553,a.t.t),this.gl.texSubImage2D(3553,c,0,0,this.getChannels(a.t),a.t.pixelFmt,d.getImageData(0,0,b.ctx.canvas.width,b.ctx.canvas.height)),this.restoreBind())},resetStream:function(){},streamData:function(a,b,c){return a},uploadTexturePixels:function(a,b,c,d){var e=3553;0!=(a.flags&1<<P.Cube._hx_index)&&(e=oa.CUBE_FACES[d]);0!=(a.flags&1<<P.IsArray._hx_index)?e=35866:0!=(a.flags&1<<P.Is3D._hx_index)&&(e=32879);var f=this.getBindType(a);this.gl.bindTexture(f,a.t.t);b.convert(a.format);
f=b.dataSize;switch(a.format._hx_index){case 4:case 7:case 10:case 13:f=new Float32Array(b.bytes.b.buffer,b.offset,f>>2);break;case 16:case 17:f=new Uint32Array(b.bytes.b.buffer,b.offset,f>>2);break;case 3:case 6:case 9:case 12:case 18:case 19:case 20:case 21:f=new Uint16Array(b.bytes.b.buffer,b.offset,f>>1);break;default:f=new Uint8Array(b.bytes.b.buffer,b.offset,f)}22==a.format._hx_index?0!=(a.flags&1<<P.IsArray._hx_index)||0!=(a.flags&1<<P.Is3D._hx_index)?this.gl.compressedTexSubImage3D(e,c,0,
0,d,b.width,b.height,1,a.t.internalFmt,f):this.gl.compressedTexSubImage2D(e,c,0,0,b.width,b.height,a.t.internalFmt,f):0!=(a.flags&1<<P.IsArray._hx_index)||0!=(a.flags&1<<P.Is3D._hx_index)?this.gl.texSubImage3D(e,c,0,0,d,b.width,b.height,1,this.getChannels(a.t),a.t.pixelFmt,f):this.gl.texSubImage2D(e,c,0,0,b.width,b.height,this.getChannels(a.t),a.t.pixelFmt,f);a.flags|=1<<P.WasCleared._hx_index;this.restoreBind()},uploadBufferData:function(a,b,c,d,e){var f=a.format.strideBytes;this.gl.bindBuffer(34962,
a.vbuf);a=new Float32Array(d.array.buffer,4*e,c*f>>2);this.gl.bufferSubData(34962,b*f,a);this.gl.bindBuffer(34962,null)},uploadBufferBytes:function(a,b,c,d,e){var f=a.format.strideBytes,g=0!=(a.flags&1<<Ja.IndexBuffer._hx_index)?34963:34962;this.gl.bindBuffer(g,a.vbuf);c=new Uint8Array(d.b.bufferValue,e,c*f);this.gl.bufferSubData(g,b*f,c);this.gl.bindBuffer(g,null);0!=(a.flags&1<<Ja.IndexBuffer._hx_index)&&(this.curIndexBuffer=null)},readBufferBytes:function(a,b,c,d,e){var f=a.format.strideBytes;
c*=f;var g=0!=(a.flags&1<<Ja.IndexBuffer._hx_index)?34963:34962;this.gl.bindBuffer(g,a.vbuf);this.gl.getBufferSubData(g,b*f,d.b,e,c);this.gl.bindBuffer(g,null)},uploadIndexData:function(a,b,c,d,e){var f=a.format.strideBytes>>1;this.gl.bindBuffer(34963,a.vbuf);a=new Uint16Array(d);c=new Uint16Array(a.buffer,e<<f,c);this.gl.bufferSubData(34963,b<<f,c);this.gl.bindBuffer(34963,null);this.curIndexBuffer=null},updateDivisor:function(a){this.currentDivisor[a.index]!=a.divisor&&(this.currentDivisor[a.index]=
a.divisor,this.gl.vertexAttribDivisor(a.index,a.divisor))},selectBuffer:function(a){if(a!=this.curBuffer){if(null==this.curShader)throw t.thrown("No shader selected");this.gl.bindBuffer(34962,a.vbuf);this.curBuffer=a;var b=a.format.strideBytes;a=a.format.resolveMapping(this.curShader.format);for(var c=0,d=this.curShader.attribs;c<d.length;){var e=d[c],f=c++;f=a[f];var g=!1,h=this.gl,k=e.index,l=e.size;switch(f&7){case 0:var m=e.type;break;case 1:m=5131;break;case 2:g=!0;m=5121;break;case 3:g=!0,m=
5120}h.vertexAttribPointer(k,l,m,g,b,f>>16);this.currentDivisor[e.index]!=e.divisor&&(this.currentDivisor[e.index]=e.divisor,this.gl.vertexAttribDivisor(e.index,e.divisor))}}},selectMultiBuffers:function(a,b){var c=this.curShader.format,d=a.mappings[c.uid];null==d&&(d=a.makeMapping(c));a=d;c=0;for(d=this.curShader.attribs;c<d.length;){var e=d[c],f=c++;f=a[f];var g=b[f>>3&255];this.curBuffer!=g&&(this.gl.bindBuffer(34962,g.vbuf),this.curBuffer=g);var h=!1,k=this.gl,l=e.index,m=e.size;switch(f&7){case 0:var p=
e.type;break;case 1:p=5131;break;case 2:h=!0;p=5121;break;case 3:h=!0,p=5120}k.vertexAttribPointer(l,m,p,h,g.format.strideBytes,f>>16);this.currentDivisor[e.index]!=e.divisor&&(this.currentDivisor[e.index]=e.divisor,this.gl.vertexAttribDivisor(e.index,e.divisor))}},draw:function(a,b,c){a!=this.curIndexBuffer&&(this.curIndexBuffer=a,this.gl.bindBuffer(34963,a.vbuf));4==a.format.strideBytes?this.gl.drawElements(this.drawMode,3*c,5125,4*b):this.gl.drawElements(this.drawMode,3*c,5123,2*b)},allocInstanceBuffer:function(a,
b){for(var c=[],d=0,e=a.commandCount;d<e;){var f=20*d++,g=b.getInt32(f),h=b.getInt32(f+4),k=b.getInt32(f+8),l=b.getInt32(f+12);f=b.getInt32(f+16);if(0!=l||0!=f)throw t.thrown("baseVertex and baseInstance must be zero on this platform");c.push(g);c.push(k);c.push(h)}a.data=c},uploadInstanceBufferBytes:function(a,b,c,d,e){a=new Uint8Array(d.b.bufferValue,e,20*c);this.gl.bufferSubData(34962,20*b,a);this.gl.bindBuffer(34962,null)},disposeInstanceBuffer:function(a){a.data=null},drawInstanced:function(a,
b){a!=this.curIndexBuffer&&(this.curIndexBuffer=a,this.gl.bindBuffer(34963,a.vbuf));if(4==a.format.strideBytes){a=5125;var c=4}else a=5123,c=2;var d=b.data;if(null!=d)for(var e=b=0,f=d.length/3|0;e<f;)e++,this.gl.drawElementsInstanced(this.drawMode,d[b++],a,d[b++]*c,d[b++]);else this.gl.drawElementsInstanced(this.drawMode,b.indexCount,a,b.startIndex*c,b.commandCount)},end:function(){},present:function(){},isDisposed:function(){return this.gl.isContextLost()},setRenderZone:function(a,b,c,d){0==a&&
0==b&&0>c&&0>d?this.gl.disable(3089):(this.gl.enable(3089),null==this.curTarget&&(b=this.bufferHeight-(b+d)),this.gl.scissor(a,b,c,d))},setDrawBuffers:function(a){3<=this.glES?this.gl.drawBuffers(oa.CBUFFERS[a]):null!=this.mrtExt&&this.mrtExt.drawBuffersWEBGL(oa.CBUFFERS[a])},unbindTargets:function(){if(null!=this.curTarget&&1<this.numTargets){for(;1<this.numTargets;)this.gl.framebufferTexture2D(36160,36064+--this.numTargets,3553,null,0),this.curTargets[this.numTargets]=null;this.setDrawBuffers(1)}},
capturePixels:function(a,b,c,d){if(null!=d){d.xMax>a.width&&(d.xMax=a.width);d.yMax>a.height&&(d.yMax=a.height);0>d.xMin&&(d.xMin=0);0>d.yMin&&(d.yMin=0);var e=d.xMax-d.xMin;var f=d.yMax-d.yMin;var g=d.xMin;d=d.yMin}else e=a.width,f=a.height,d=g=0;e>>=c;f>>=c;0==e&&(e=1);0==f&&(f=1);var h=ta.alloc(e,f,a.format),k=this.curTarget,l=this.numTargets,m=this.curTargetLayer,p=this.curTargetMip;if(1<l){var r=this.numTargets=1;for(f=l;r<f;)e=r++,this.curTargets[e]==a&&this.gl.framebufferTexture2D(36160,36064+
e,3553,null,0)}this.setRenderTarget(a,b,c);this.captureSubRenderBuffer(h,g,d);this.setRenderTarget(k,m,p);if(1<l){r=1;for(f=l;r<f;)e=r++,this.curTargets[e]==a&&this.gl.framebufferTexture2D(36160,36064+e,3553,a.t.t,0);this.setDrawBuffers(l);this.numTargets=l}return h},setRenderTarget:function(a,b,c,d){null==d&&(d=kc.ReadWrite);null==c&&(c=0);null==b&&(b=0);this.unbindTargets();this.curTarget=a;if(null==a)this.gl.bindFramebuffer(36160,null),this.gl.viewport(0,0,this.bufferWidth,this.bufferHeight);else{if(null!=
a.depthBuffer&&(a.depthBuffer.width!=a.width||a.depthBuffer.height!=a.height))throw t.thrown("Invalid depth buffer size : does not match render target size");if(0<c&&1==this.glES)throw t.thrown("Cannot render to mipLevel in WebGL1, use upload() instead");null==a.t&&a.alloc();if(0!=(a.flags&1<<P.MipMapped._hx_index)&&0==(a.flags&1<<P.WasCleared._hx_index)){var e=this.getBindType(a);this.gl.bindTexture(e,a.t.t);this.gl.generateMipmap(e);this.restoreBind()}a.set_lastFrame(this.frame);this.curTargetLayer=
b;this.curTargetMip=c;this.gl.bindFramebuffer(36160,this.commonFB);0!=(a.flags&1<<P.IsArray._hx_index)?this.gl.framebufferTextureLayer(36160,36064,a.t.t,c,b):this.gl.framebufferTexture2D(36160,36064,0!=(a.flags&1<<P.Cube._hx_index)?oa.CUBE_FACES[b]:3553,a.t.t,c);this.setPolygonOffset(a.depthBuffer);this.setDepthClamp(a.depthBuffer);null!=a.depthBuffer&&d!=kc.NotBound?a.depthBuffer.hasStencil()&&a.depthBuffer.format==J.Depth24Stencil8?this.gl.framebufferTexture2D(36160,33306,3553,a.depthBuffer.t.t,
0):(this.gl.framebufferTexture2D(36160,33306,3553,null,0),this.gl.framebufferTexture2D(36160,36096,3553,a.depthBuffer.t.t,0),this.gl.framebufferTexture2D(36160,36128,3553,a.depthBuffer.hasStencil()?a.depthBuffer.t.t:null,0)):(this.gl.framebufferTexture2D(36160,33306,3553,null,0),this.gl.framebufferTexture2D(36160,36096,3553,null,0),this.gl.framebufferTexture2D(36160,36128,3553,null,0));b=a.width>>c;0==b&&(b=1);c=a.height>>c;0==c&&(c=1);this.gl.viewport(0,0,b,c);c=0;for(b=this.boundTextures.length;c<
b;)d=c++,this.boundTextures[d]=null;0==(a.flags&1<<P.WasCleared._hx_index)&&(a.flags|=1<<P.WasCleared._hx_index,this.clear(oa.BLACK));if(this.glDebug&&(a=this.gl.checkFramebufferStatus(36160),36053!=a))throw t.thrown("Invalid frame buffer: "+a);}},setRenderTargets:function(a,b){null==b&&(b=kc.ReadWrite);this.unbindTargets();this.setRenderTarget(a[0],null,null,b);if(!(2>a.length)){this.numTargets=a.length;b=!1;for(var c=1,d=a.length;c<d;){var e=c++,f=a[e];null==f.t&&f.alloc();this.gl.framebufferTexture2D(36160,
36064+e,3553,f.t.t,0);this.curTargets[e]=f;f.set_lastFrame(this.frame);0==(f.flags&1<<P.WasCleared._hx_index)&&(f.flags|=1<<P.WasCleared._hx_index,b=!0)}this.setDrawBuffers(a.length);b&&this.clear(oa.BLACK)}},setDepth:function(a){this.unbindTargets();this.curTarget=a;a.set_lastFrame(this.frame);this.curTargetMip=this.curTargetLayer=0;this.gl.bindFramebuffer(36160,this.commonFB);this.gl.framebufferTexture2D(36160,36064,3553,null,0);this.setPolygonOffset(a);this.setDepthClamp(a);a.hasStencil()&&a.format==
J.Depth24Stencil8?this.gl.framebufferTexture2D(36160,33306,3553,a.t.t,0):(this.gl.framebufferTexture2D(36160,33306,3553,null,0),this.gl.framebufferTexture2D(36160,36096,3553,a.t.t,0),this.gl.framebufferTexture2D(36160,36128,3553,a.hasStencil()?a.t.t:null,0));var b=a.width;0==b&&(b=1);a=a.height;0==a&&(a=1);this.gl.viewport(0,0,b,a);b=0;for(a=this.boundTextures.length;b<a;){var c=b++;this.boundTextures[c]=null}if(this.glDebug&&(b=this.gl.checkFramebufferStatus(36160),36053!=b))throw t.thrown("Invalid frame buffer: "+
b);},onTextureBiasChanged:function(a){this.setPolygonOffset(a)},setPolygonOffset:function(a){null==a||0==a.depthBias&&0==a.slopeScaledBias?this.gl.disable(32823):(this.gl.enable(32823),this.gl.polygonOffset(a.slopeScaledBias,a.depthBias))},setDepthClamp:function(a){},init:function(a,b){null==b&&(b=!1);if("complete"==window.document.readyState)qe.delay(function(){a(!1)},1);else{var c=null;c=function(){window.removeEventListener("load",c);a(!1)};window.addEventListener("load",c)}},hasFeature:function(a){return this.features.get(a)},
makeFeatures:function(){for(var a=0,b=Ia.__empty_constructs__.slice();a<b.length;){var c=b[a];++a;this.features.set(c,this.checkFeature(c))}null!=this.gl.getExtension("WEBGL_compressed_texture_s3tc")&&(this.maxCompressedTexturesSupport=3,null!=this.gl.getExtension("EXT_texture_compression_bptc")&&(this.maxCompressedTexturesSupport=7));3>this.glES&&this.gl.getExtension("WEBGL_depth_texture");this.has16Bits=null!=this.gl.getExtension("EXT_texture_norm16")},checkFeature:function(a){switch(a._hx_index){case 0:return 3<=
this.glES?!0:null!=this.gl.getExtension("OES_standard_derivatives");case 1:return 3<=this.glES?null!=this.gl.getExtension("EXT_color_buffer_float")?null!=this.gl.getExtension("OES_texture_float_linear"):!1:null!=this.gl.getExtension("OES_texture_float")&&null!=this.gl.getExtension("OES_texture_float_linear")&&null!=this.gl.getExtension("OES_texture_half_float")?null!=this.gl.getExtension("OES_texture_half_float_linear"):!1;case 4:return 3<=this.glES?!0:null==this.mrtExt?null!=(this.mrtExt=this.gl.getExtension("WEBGL_draw_buffers")):
!0;case 6:return 3<=this.glES?!0:null!=this.gl.getExtension("EXT_sRGB");case 7:return 3<=this.glES?!0:!1;case 2:case 3:case 8:case 9:return!0;case 10:return 3<=this.glES?!0:null!=this.gl.getExtension("ANGLE_instanced_arrays");default:return!1}},uploadTextureVideoElement:function(a,b,c,d){var e=0!=(a.flags&1<<P.Cube._hx_index),f=this.getBindType(a);if(0!=(a.flags&1<<P.IsArray._hx_index))throw t.thrown("TODO:texImage3D");d=e?oa.CUBE_FACES[d]:3553;this.gl.bindTexture(f,a.t.t);this.gl.texSubImage2D(d,
c,0,0,b.videoWidth,b.videoHeight,this.getChannels(a.t),a.t.pixelFmt,b);this.restoreBind()},captureRenderBuffer:function(a){this.captureSubRenderBuffer(a,0,0)},captureSubRenderBuffer:function(a,b,c){if(null==this.curTarget)throw t.thrown("Can't capture main render buffer in GL");this.gl.getError();var d=a.bytes.b;switch(this.curTarget.format._hx_index){case 4:case 7:case 10:case 13:d=new Float32Array(d.buffer);break;case 16:case 17:d=new Uint32Array(d.buffer);break;case 3:case 6:case 9:case 12:case 18:case 19:case 20:case 21:d=
new Uint16Array(d.buffer)}this.gl.readPixels(b,c,a.width,a.height,this.getChannels(this.curTarget.t),this.curTarget.t.pixelFmt,d);b=this.gl.getError();if(0!=b)throw t.thrown("Failed to capture pixels (error "+b+")");a.set_innerFormat(this.curTarget.format)},__class__:oa});var lf=function(a){this.lastAutoDispose=0;this.autoDisposeCooldown=60;this.usedMemory=this.texMemory=0;this.driver=a};lf.__name__="h3d.impl.MemoryManager";lf.enableTrackAlloc=function(a){Oc.ENABLED=null!=a?a:!0};lf.prototype={init:function(){this.textures=
[];this.buffers=[];this.initIndexes()},initIndexes:function(){for(var a,b=[],c=0;65532>c;)a=c++,b.push(a);this.triIndexes16=jd.alloc(b);b=[];for(c=0;10922>c;)a=c++,a<<=2,b.push(a),b.push(a+1),b.push(a+2),b.push(a+2),b.push(a+1),b.push(a+3);b.push(65532);this.quadIndexes16=jd.alloc(b)},garbage:function(){},getTriIndexes:function(a){if(65532>=a)return this.triIndexes16;if(null==this.triIndexes32||this.triIndexes32.vertices<a){for(var b=131072;b<a;)b<<=1;a=new S(new ArrayBuffer(b<<2));for(var c=0,d=
b;c<d;){var e=c++;a.setInt32(e<<2,e)}null!=this.triIndexes32&&this.triIndexes32.dispose();this.triIndexes32=jd._new(b,!0);this.triIndexes32.uploadBytes(a,0,b)}return this.triIndexes32},getQuadIndexes:function(a){var b=6*(a+3>>2);if(65532>=b)return this.quadIndexes16;if(null==this.quadIndexes32||this.quadIndexes32.vertices<a){for(a=131072;a<b;)a<<=1;b=new S(new ArrayBuffer(a<<2));for(var c=0,d=0,e=a/6|0;d<e;){var f=d++<<2;b.setInt32(c++<<2,f);b.setInt32(c++<<2,f+1);b.setInt32(c++<<2,f+2);b.setInt32(c++<<
2,f+2);b.setInt32(c++<<2,f+1);b.setInt32(c++<<2,f+3)}null!=this.quadIndexes32&&this.quadIndexes32.dispose();this.quadIndexes32=jd._new(a,!0);this.quadIndexes32.uploadBytes(b,0,a)}return this.quadIndexes32},allocBuffer:function(a){if(null==a.vbuf){var b=a.vertices*a.format.strideBytes;if(0!=b){for(;4294967296<this.usedMemory+b||null==(a.vbuf=this.driver.allocBuffer(a));){if(this.driver.isDisposed())return;var c=this.usedMemory;this.garbage();if(this.usedMemory==c)throw t.thrown("Memory full ("+Math.ceil(c/
1024)+" KB,"+this.buffers.length+" buffers)");}this.usedMemory+=b;this.buffers.push(a)}}},freeBuffer:function(a){null!=a.vbuf&&(this.driver.disposeBuffer(a),a.vbuf=null,F.remove(this.buffers,a)&&(this.usedMemory-=a.vertices*a.format.strideBytes))},memSize:function(a){if(0!=(a.flags&1<<P.AsyncLoading._hx_index)&&0!=(a.flags&1<<P.Loading._hx_index))return 4;var b=ta.calcDataSize(a.width,a.height,a.format);if(0<a.get_mipLevels())for(var c=1,d=a.get_mipLevels();c<d;){var e=c++,f=a.width>>e;0==f&&(f=1);
e=a.height>>e;0==e&&(e=1);b+=ta.calcDataSize(f,e,a.format)}return b*a.get_layerCount()},cleanTextures:function(a){null==a&&(a=!0);this.textures.sort(M(this,this.sortByLRU));for(var b=0,c=this.textures;b<c.length;){var d=c[b];++b;if(null!=d.realloc&&(null!=d.t||!d.isDepth()&&null!=d.realloc)&&(a||d._lastFrame<ea.frameCount-3600)&&d._lastFrame!=W.PREVENT_AUTO_DISPOSE)return d.dispose(),!0}return!1},sortByLRU:function(a,b){return a._lastFrame-b._lastFrame},deleteTexture:function(a){F.remove(this.textures,
a)&&(this.driver.disposeTexture(a),this.texMemory-=this.memSize(a))},allocTexture:function(a){for(;;){var b=!0;ea.frameCount>this.lastAutoDispose+this.autoDisposeCooldown&&(b=this.cleanTextures(!1),this.lastAutoDispose=ea.frameCount);a.t=a.isDepth()?this.driver.allocDepthBuffer(a):this.driver.allocTexture(a);if(null!=a.t)break;if(this.driver.isDisposed())return;for(;this.cleanTextures(!1););if(!b&&!this.cleanTextures(!0))throw t.thrown("Maximum texture memory reached");}this.textures.push(a);this.texMemory+=
this.memSize(a)},onContextLost:function(){this.dispose();this.initIndexes()},dispose:function(){null!=this.triIndexes16&&this.triIndexes16.dispose();null!=this.quadIndexes16&&this.quadIndexes16.dispose();null!=this.triIndexes32&&this.triIndexes32.dispose();null!=this.quadIndexes32&&this.quadIndexes32.dispose();this.quadIndexes32=this.triIndexes32=this.quadIndexes16=this.triIndexes16=null;for(var a=0,b=this.textures.slice();a<b.length;){var c=b[a];++a;c.dispose()}a=0;for(b=this.buffers.slice();a<b.length;)c=
b[a],++a,c.dispose();this.buffers=[];this.textures=[];this.texMemory=this.usedMemory=0},stats:function(){for(var a=0,b=0,c=this.buffers;b<c.length;){var d=c[b];++b;a+=d.vertices*d.format.strideBytes}return{bufferCount:this.buffers.length,bufferMemory:a,totalMemory:this.usedMemory+this.texMemory,textureCount:this.textures.length,textureMemory:this.texMemory}},allocStats:function(){for(var a,b,c,d,e,f=Object.create(null),g=[],h=0,k=this.textures;h<k.length;)if(a=k[h],++h,null!=a.allocPos){e="$"+a.allocPos.position;
d=f[e];null==d&&(d={position:a.allocPos.position,count:0,size:0,tex:!0,stacks:[]},f[e]=d,g.push(d));d.count++;e=this.memSize(a);d.size+=e;var l=a.name;d=d.stacks;c=a.allocPos.stack.join("\n");for(b=0;b<d.length;)a=d[b],++b,a.stack==c&&(a.size+=e,a.count++,a.stats.push({name:l,size:e}),c=null);null!=c&&d.push({stats:[{name:l,size:e}],stack:c,count:1,size:e})}h=0;for(k=this.buffers;h<k.length;)if(l=k[h],++h,null!=l.allocPos){e=l.allocPos.position;d=f[e];null==d&&(d={position:e,count:0,size:0,tex:!1,
stacks:[]},f[e]=d,g.push(d));d.count++;e=l.vertices*l.format.stride*4;d.size+=e;d=d.stacks;c=l.allocPos.stack.join("\n");for(b=0;b<d.length;)a=d[b],++b,a.stack==c&&(a.size+=e,a.count++,a.stats.push({name:"buffer",size:e}),c=null);null!=c&&d.push({stats:[{name:"buffer",size:e}],stack:c,count:1,size:e})}g.sort(function(a,b){return b.size-a.size});return g},__class__:lf};var Gg=function(){Ud.call(this)};Gg.__name__="h3d.impl.NullDriver";Gg.__super__=Ud;Gg.prototype=D(Ud.prototype,{hasFeature:function(a){return!0},
isSupportedFormat:function(a){return!0},logImpl:function(a){$a.trace(a,{fileName:"h3d/impl/NullDriver.hx",lineNumber:23,className:"h3d.impl.NullDriver",methodName:"logImpl"})},isDisposed:function(){return!1},getDriverName:function(a){return"NullDriver"},init:function(a,b){a(!1)},selectShader:function(a){if(this.cur==a)return!1;this.cur=a;return!0},allocTexture:function(a){return{}},allocBuffer:function(a){return{}},__class__:Gg});var nc=K["h3d.impl.Step"]={__ename__:!0,__constructs__:null,MainDraw:{_hx_name:"MainDraw",
_hx_index:0,__enum__:"h3d.impl.Step",toString:v},Decals:{_hx_name:"Decals",_hx_index:1,__enum__:"h3d.impl.Step",toString:v},Shadows:{_hx_name:"Shadows",_hx_index:2,__enum__:"h3d.impl.Step",toString:v},Lighting:{_hx_name:"Lighting",_hx_index:3,__enum__:"h3d.impl.Step",toString:v},Forward:{_hx_name:"Forward",_hx_index:4,__enum__:"h3d.impl.Step",toString:v},BeforeTonemapping:{_hx_name:"BeforeTonemapping",_hx_index:5,__enum__:"h3d.impl.Step",toString:v},AfterTonemapping:{_hx_name:"AfterTonemapping",_hx_index:6,
__enum__:"h3d.impl.Step",toString:v},Overlay:{_hx_name:"Overlay",_hx_index:7,__enum__:"h3d.impl.Step",toString:v},Custom:(z=function(a){return{_hx_index:8,name:a,__enum__:"h3d.impl.Step",toString:v}},z._hx_name="Custom",z.__params__=["name"],z)};nc.__constructs__=[nc.MainDraw,nc.Decals,nc.Shadows,nc.Lighting,nc.Forward,nc.BeforeTonemapping,nc.AfterTonemapping,nc.Overlay,nc.Custom];nc.__empty_constructs__=[nc.MainDraw,nc.Decals,nc.Shadows,nc.Lighting,nc.Forward,nc.BeforeTonemapping,nc.AfterTonemapping,
nc.Overlay];var rc=function(){this.position=0;this.cache=[];this.defaultFormat=W.nativeFormat;this.defaultDepthBuffer=W.getDefaultDepth();if(0>rc.checkFlags){for(var a=0,b=[P.Cube,P.MipMapped,P.ManualMipMapGen,P.Dynamic,P.IsArray],c=0;c<b.length;){var d=b[c];++c;a|=1<<d._hx_index}rc.checkFlags=a}};rc.__name__="h3d.impl.TextureCache";rc.prototype={get:function(a){null==a&&(a=0);return this.cache[a]},getNamed:function(a){for(var b=0,c=this.position;b<c;){var d=b++;if(this.cache[d].name==a)return this.cache[d]}return null},
set:function(a,b){this.cache[b]=a},begin:function(){for(;this.cache.length>this.position;){var a=this.cache.pop();null!=a&&a.dispose()}this.position=0},matchTargetFlags:function(a,b){var c=0;if(null!=b)for(var d=0;d<b.length;){var e=b[d];++d;c|=1<<e._hx_index}return(a.flags&rc.checkFlags)==(c&rc.checkFlags)},lookupTarget:function(a,b,c,d,e){for(var f=this.cache[this.position],g=this.position+1,h=this.cache.length;g<h;){var k=g++,l=this.cache[k];if(null!=l&&(null!=l.t||!l.isDepth()&&null!=l.realloc)&&
l.width==b&&l.height==c&&l.format==d){var m=0;if(null!=e)for(var p=0;p<e.length;){var r=e[p];++p;m|=1<<r._hx_index}if((l.flags&rc.checkFlags)==(m&rc.checkFlags))return this.cache[this.position]=l,this.cache[k]=f,l}}null!=f&&f.name==a&&(f.dispose(),f=null);null==e&&(e=[]);-1==e.indexOf(P.Target)&&e.push(P.Target);a=new W(b,c,e,d);a.realloc=function(){};null!=f?this.cache.splice(this.position,0,a):this.cache[this.position]=a;return a},allocTarget:function(a,b,c,d,e,f){null==d&&(d=!0);var g=this.cache[this.position];
null==e&&(e=this.defaultFormat);if(null==g||null==g.t&&(g.isDepth()||null==g.realloc)||g.width!=b||g.height!=c||g.format!=e)var h=!0;else{h=0;if(null!=f)for(var k=0;k<f.length;){var l=f[k];++k;h|=1<<l._hx_index}h=(g.flags&rc.checkFlags)!=(h&rc.checkFlags)}h&&(g=this.lookupTarget(a,b,c,e,f));g.depthBuffer=d?this.defaultDepthBuffer:null;g.setName(a);this.position++;return g},allocTargetScale:function(a,b,c,d){null==c&&(c=!0);var e=ja.CURRENT;return this.allocTarget(a,Math.ceil(e.width*b),Math.ceil(e.height*
b),c,d)},allocTileTarget:function(a,b,c,d){null==c&&(c=!1);return this.allocTarget(a,Math.ceil(b.width+b.x)-Math.floor(b.x),Math.ceil(b.height+b.y)-Math.floor(b.y),c,d)},dispose:function(){for(var a=0,b=this.cache;a<b.length;){var c=b[a];++a;c.dispose()}this.cache=[]},__class__:rc};var rf=function(){};rf.__name__="hxd.impl.AnyProps";rf.prototype={set_props:function(a){this.props=a;this.refreshProps();return a},setDefaultProps:function(a){this.set_props(this.getDefaultProps(a))},getDefaultProps:function(a){return{}},
refreshProps:function(){},__class__:rf};var ye=function(a){null!=a&&this.addPass(new ba("default",null)).addShader(a)};ye.__name__="h3d.mat.BaseMaterial";ye.__super__=rf;ye.prototype=D(rf.prototype,{addPass:function(a){for(var b=null,c=this.passes;null!=c;)b=c,c=c.nextPass;null==b?this.passes=a:b.nextPass=a;a.nextPass=null;return a},removePass:function(a){for(var b=null,c=this.passes;null!=c;){if(c==a)return null==b?this.passes=a.nextPass:b.nextPass=a.nextPass,a.nextPass=null,!0;b=c;c=c.nextPass}return!1},
get_mainPass:function(){return this.passes},getPasses:function(){for(var a=this.passes,b=[];null!=a;)b.push(a),a=a.nextPass;return b},getPass:function(a){for(var b=this.passes;null!=b;){if(b.name==a)return b;b=b.nextPass}return null},allocPass:function(a,b){null==b&&(b=!0);var c=this.getPass(a);if(null!=c)return c;c=new ba(a,null,b?this.passes:null);b&&null!=this.passes&&c.set_batchMode(this.passes.batchMode);this.addPass(c);return c},clone:function(a){null==a&&(a=new ye);a.passes.load(this.passes);
a.name=this.name;a.set_props(this.props);return a},__class__:ye});var gc=K["h3d.mat.Face"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h3d.mat.Face",toString:v},Back:{_hx_name:"Back",_hx_index:1,__enum__:"h3d.mat.Face",toString:v},Front:{_hx_name:"Front",_hx_index:2,__enum__:"h3d.mat.Face",toString:v},Both:{_hx_name:"Both",_hx_index:3,__enum__:"h3d.mat.Face",toString:v}};gc.__constructs__=[gc.None,gc.Back,gc.Front,gc.Both];gc.__empty_constructs__=[gc.None,gc.Back,
gc.Front,gc.Both];var Y=K["h3d.mat.Blend"]={__ename__:!0,__constructs__:null,One:{_hx_name:"One",_hx_index:0,__enum__:"h3d.mat.Blend",toString:v},Zero:{_hx_name:"Zero",_hx_index:1,__enum__:"h3d.mat.Blend",toString:v},SrcAlpha:{_hx_name:"SrcAlpha",_hx_index:2,__enum__:"h3d.mat.Blend",toString:v},SrcColor:{_hx_name:"SrcColor",_hx_index:3,__enum__:"h3d.mat.Blend",toString:v},DstAlpha:{_hx_name:"DstAlpha",_hx_index:4,__enum__:"h3d.mat.Blend",toString:v},DstColor:{_hx_name:"DstColor",_hx_index:5,__enum__:"h3d.mat.Blend",
toString:v},OneMinusSrcAlpha:{_hx_name:"OneMinusSrcAlpha",_hx_index:6,__enum__:"h3d.mat.Blend",toString:v},OneMinusSrcColor:{_hx_name:"OneMinusSrcColor",_hx_index:7,__enum__:"h3d.mat.Blend",toString:v},OneMinusDstAlpha:{_hx_name:"OneMinusDstAlpha",_hx_index:8,__enum__:"h3d.mat.Blend",toString:v},OneMinusDstColor:{_hx_name:"OneMinusDstColor",_hx_index:9,__enum__:"h3d.mat.Blend",toString:v},ConstantColor:{_hx_name:"ConstantColor",_hx_index:10,__enum__:"h3d.mat.Blend",toString:v},ConstantAlpha:{_hx_name:"ConstantAlpha",
_hx_index:11,__enum__:"h3d.mat.Blend",toString:v},OneMinusConstantColor:{_hx_name:"OneMinusConstantColor",_hx_index:12,__enum__:"h3d.mat.Blend",toString:v},OneMinusConstantAlpha:{_hx_name:"OneMinusConstantAlpha",_hx_index:13,__enum__:"h3d.mat.Blend",toString:v},SrcAlphaSaturate:{_hx_name:"SrcAlphaSaturate",_hx_index:14,__enum__:"h3d.mat.Blend",toString:v}};Y.__constructs__=[Y.One,Y.Zero,Y.SrcAlpha,Y.SrcColor,Y.DstAlpha,Y.DstColor,Y.OneMinusSrcAlpha,Y.OneMinusSrcColor,Y.OneMinusDstAlpha,Y.OneMinusDstColor,
Y.ConstantColor,Y.ConstantAlpha,Y.OneMinusConstantColor,Y.OneMinusConstantAlpha,Y.SrcAlphaSaturate];Y.__empty_constructs__=[Y.One,Y.Zero,Y.SrcAlpha,Y.SrcColor,Y.DstAlpha,Y.DstColor,Y.OneMinusSrcAlpha,Y.OneMinusSrcColor,Y.OneMinusDstAlpha,Y.OneMinusDstColor,Y.ConstantColor,Y.ConstantAlpha,Y.OneMinusConstantColor,Y.OneMinusConstantAlpha,Y.SrcAlphaSaturate];var ob=K["h3d.mat.Compare"]={__ename__:!0,__constructs__:null,Always:{_hx_name:"Always",_hx_index:0,__enum__:"h3d.mat.Compare",toString:v},Never:{_hx_name:"Never",
_hx_index:1,__enum__:"h3d.mat.Compare",toString:v},Equal:{_hx_name:"Equal",_hx_index:2,__enum__:"h3d.mat.Compare",toString:v},NotEqual:{_hx_name:"NotEqual",_hx_index:3,__enum__:"h3d.mat.Compare",toString:v},Greater:{_hx_name:"Greater",_hx_index:4,__enum__:"h3d.mat.Compare",toString:v},GreaterEqual:{_hx_name:"GreaterEqual",_hx_index:5,__enum__:"h3d.mat.Compare",toString:v},Less:{_hx_name:"Less",_hx_index:6,__enum__:"h3d.mat.Compare",toString:v},LessEqual:{_hx_name:"LessEqual",_hx_index:7,__enum__:"h3d.mat.Compare",
toString:v}};ob.__constructs__=[ob.Always,ob.Never,ob.Equal,ob.NotEqual,ob.Greater,ob.GreaterEqual,ob.Less,ob.LessEqual];ob.__empty_constructs__=[ob.Always,ob.Never,ob.Equal,ob.NotEqual,ob.Greater,ob.GreaterEqual,ob.Less,ob.LessEqual];var qb=K["h3d.mat.StencilOp"]={__ename__:!0,__constructs__:null,Keep:{_hx_name:"Keep",_hx_index:0,__enum__:"h3d.mat.StencilOp",toString:v},Zero:{_hx_name:"Zero",_hx_index:1,__enum__:"h3d.mat.StencilOp",toString:v},Replace:{_hx_name:"Replace",_hx_index:2,__enum__:"h3d.mat.StencilOp",
toString:v},Increment:{_hx_name:"Increment",_hx_index:3,__enum__:"h3d.mat.StencilOp",toString:v},IncrementWrap:{_hx_name:"IncrementWrap",_hx_index:4,__enum__:"h3d.mat.StencilOp",toString:v},Decrement:{_hx_name:"Decrement",_hx_index:5,__enum__:"h3d.mat.StencilOp",toString:v},DecrementWrap:{_hx_name:"DecrementWrap",_hx_index:6,__enum__:"h3d.mat.StencilOp",toString:v},Invert:{_hx_name:"Invert",_hx_index:7,__enum__:"h3d.mat.StencilOp",toString:v}};qb.__constructs__=[qb.Keep,qb.Zero,qb.Replace,qb.Increment,
qb.IncrementWrap,qb.Decrement,qb.DecrementWrap,qb.Invert];qb.__empty_constructs__=[qb.Keep,qb.Zero,qb.Replace,qb.Increment,qb.IncrementWrap,qb.Decrement,qb.DecrementWrap,qb.Invert];var Fc=K["h3d.mat.MipMap"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h3d.mat.MipMap",toString:v},Nearest:{_hx_name:"Nearest",_hx_index:1,__enum__:"h3d.mat.MipMap",toString:v},Linear:{_hx_name:"Linear",_hx_index:2,__enum__:"h3d.mat.MipMap",toString:v}};Fc.__constructs__=[Fc.None,Fc.Nearest,
Fc.Linear];Fc.__empty_constructs__=[Fc.None,Fc.Nearest,Fc.Linear];var fd=K["h3d.mat.Filter"]={__ename__:!0,__constructs__:null,Nearest:{_hx_name:"Nearest",_hx_index:0,__enum__:"h3d.mat.Filter",toString:v},Linear:{_hx_name:"Linear",_hx_index:1,__enum__:"h3d.mat.Filter",toString:v}};fd.__constructs__=[fd.Nearest,fd.Linear];fd.__empty_constructs__=[fd.Nearest,fd.Linear];var Qd=K["h3d.mat.Wrap"]={__ename__:!0,__constructs__:null,Clamp:{_hx_name:"Clamp",_hx_index:0,__enum__:"h3d.mat.Wrap",toString:v},
Repeat:{_hx_name:"Repeat",_hx_index:1,__enum__:"h3d.mat.Wrap",toString:v}};Qd.__constructs__=[Qd.Clamp,Qd.Repeat];Qd.__empty_constructs__=[Qd.Clamp,Qd.Repeat];var vb=K["h3d.mat.Operation"]={__ename__:!0,__constructs__:null,Add:{_hx_name:"Add",_hx_index:0,__enum__:"h3d.mat.Operation",toString:v},Sub:{_hx_name:"Sub",_hx_index:1,__enum__:"h3d.mat.Operation",toString:v},ReverseSub:{_hx_name:"ReverseSub",_hx_index:2,__enum__:"h3d.mat.Operation",toString:v},Min:{_hx_name:"Min",_hx_index:3,__enum__:"h3d.mat.Operation",
toString:v},Max:{_hx_name:"Max",_hx_index:4,__enum__:"h3d.mat.Operation",toString:v}};vb.__constructs__=[vb.Add,vb.Sub,vb.ReverseSub,vb.Min,vb.Max];vb.__empty_constructs__=[vb.Add,vb.Sub,vb.ReverseSub,vb.Min,vb.Max];var P=K["h3d.mat.TextureFlags"]={__ename__:!0,__constructs__:null,Target:{_hx_name:"Target",_hx_index:0,__enum__:"h3d.mat.TextureFlags",toString:v},Cube:{_hx_name:"Cube",_hx_index:1,__enum__:"h3d.mat.TextureFlags",toString:v},MipMapped:{_hx_name:"MipMapped",_hx_index:2,__enum__:"h3d.mat.TextureFlags",
toString:v},ManualMipMapGen:{_hx_name:"ManualMipMapGen",_hx_index:3,__enum__:"h3d.mat.TextureFlags",toString:v},IsNPOT:{_hx_name:"IsNPOT",_hx_index:4,__enum__:"h3d.mat.TextureFlags",toString:v},NoAlloc:{_hx_name:"NoAlloc",_hx_index:5,__enum__:"h3d.mat.TextureFlags",toString:v},Dynamic:{_hx_name:"Dynamic",_hx_index:6,__enum__:"h3d.mat.TextureFlags",toString:v},AlphaPremultiplied:{_hx_name:"AlphaPremultiplied",_hx_index:7,__enum__:"h3d.mat.TextureFlags",toString:v},WasCleared:{_hx_name:"WasCleared",
_hx_index:8,__enum__:"h3d.mat.TextureFlags",toString:v},Loading:{_hx_name:"Loading",_hx_index:9,__enum__:"h3d.mat.TextureFlags",toString:v},Serialize:{_hx_name:"Serialize",_hx_index:10,__enum__:"h3d.mat.TextureFlags",toString:v},IsArray:{_hx_name:"IsArray",_hx_index:11,__enum__:"h3d.mat.TextureFlags",toString:v},AsyncLoading:{_hx_name:"AsyncLoading",_hx_index:12,__enum__:"h3d.mat.TextureFlags",toString:v},LazyLoading:{_hx_name:"LazyLoading",_hx_index:13,__enum__:"h3d.mat.TextureFlags",toString:v},
Writable:{_hx_name:"Writable",_hx_index:14,__enum__:"h3d.mat.TextureFlags",toString:v},Is3D:{_hx_name:"Is3D",_hx_index:15,__enum__:"h3d.mat.TextureFlags",toString:v}};P.__constructs__=[P.Target,P.Cube,P.MipMapped,P.ManualMipMapGen,P.IsNPOT,P.NoAlloc,P.Dynamic,P.AlphaPremultiplied,P.WasCleared,P.Loading,P.Serialize,P.IsArray,P.AsyncLoading,P.LazyLoading,P.Writable,P.Is3D];P.__empty_constructs__=[P.Target,P.Cube,P.MipMapped,P.ManualMipMapGen,P.IsNPOT,P.NoAlloc,P.Dynamic,P.AlphaPremultiplied,P.WasCleared,
P.Loading,P.Serialize,P.IsArray,P.AsyncLoading,P.LazyLoading,P.Writable,P.Is3D];var Ad=function(){};Ad.__name__="h3d.mat.Defaults";Ad.get_shadowShader=function(){var a=Ad.shadowShader;null==a&&(a=new sf,Ad.set_shadowShader(a),Ad.shadowShader.setPriority(-1));return a};Ad.set_shadowShader=function(a){return Ad.shadowShader=a};Ad.makeVolumeDecal=function(a){return new Bd(a.xMax-a.xMin,a.yMax-a.yMin)};var tf=function(a){this.mshader=new ze;this.set_blendMode(ya.None);ye.call(this,this.mshader);this.set_texture(a)};
tf.__name__="h3d.mat.Material";tf.create=function(a){var b=Ld.current.createMaterial();b.set_texture(a);b.set_props(b.getDefaultProps());return b};tf.__super__=ye;tf.prototype=D(ye.prototype,{get_specularPower:function(){return this.mshader.specularPower__},set_specularPower:function(a){return this.mshader.specularPower__=a},get_specularAmount:function(){return this.mshader.specularAmount__},set_specularAmount:function(a){return this.mshader.specularAmount__=a},get_color:function(){return this.mshader.color__},
set_color:function(a){return this.mshader.color__=a},get_shadows:function(){return this.castShadows?this.receiveShadows:!1},set_shadows:function(a){this.set_castShadows(a);this.set_receiveShadows(a);return a},set_castShadows:function(a){if(this.castShadows==a)return a;null!=this.passes&&(a?this.addPass(new ba("shadow",null,this.passes)).set_isStatic(this.staticShadows):this.removePass(this.getPass("shadow")));return this.castShadows=a},set_receiveShadows:function(a){if(a==this.receiveShadows)return a;
if(null!=this.passes){var b=Ad.get_shadowShader();a?this.passes.addShader(b):this.passes.removeShader(b)}return this.receiveShadows=a},set_staticShadows:function(a){var b=this.getPass("shadow");null!=b&&b.set_isStatic(a);return this.staticShadows=a},clone:function(a){a=null==a?new tf:a;ye.prototype.clone.call(this,a);a.set_castShadows(this.castShadows);a.set_receiveShadows(this.receiveShadows);a.set_texture(this.get_texture());a.set_specularTexture(this.get_specularTexture());a.set_normalMap(this.get_normalMap());
if(null!=this.textureShader){var b=a.textureShader;b.constModified=!0;b.additive__=this.textureShader.additive__;b=a.textureShader;b.constModified=!0;b.killAlpha__=this.textureShader.killAlpha__;a.textureShader.killAlphaThreshold__=this.textureShader.killAlphaThreshold__}b=this.mshader.color__;var c=b.x,d=b.y,e=b.z;b=b.w;null==b&&(b=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=new O(c,d,e,b);a.mshader.color__=c;a.set_blendMode(this.blendMode);return a},set_blendMode:function(a){if(null!=this.passes)switch(this.passes.setBlendMode(a),
a._hx_index){case 0:this.passes.set_depthWrite(!0);this.passes.setPassName("default");break;case 1:this.passes.set_depthWrite(!0);this.passes.setPassName("alpha");break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:this.passes.set_depthWrite(!1),this.passes.setPassName("additive")}return this.blendMode=a},get_specularTexture:function(){return null==this.specularShader?null:this.specularShader.texture__},get_texture:function(){return null==this.textureShader?null:this.textureShader.texture__},
set_texture:function(a){null==a?null!=this.textureShader&&(this.passes.removeShader(this.textureShader),this.textureShader=null):(null==this.textureShader&&(this.textureShader=new af,this.passes.addShader(this.textureShader)),this.textureShader.texture__=a);return a},get_normalMap:function(){return null==this.normalShader?null:this.normalShader.texture__},set_normalMap:function(a){null==a?null!=this.normalShader&&(this.passes.removeShader(this.normalShader),this.normalShader=null):(null==this.normalShader&&
(this.normalShader=new Cd,null!=this.textureShader?this.passes.addShaderAtIndex(this.normalShader,this.passes.getShaderIndex(this.textureShader)+1):this.passes.addShader(this.normalShader)),this.normalShader.texture__=a);return a},set_specularTexture:function(a){null==a?null!=this.specularShader&&(this.passes.removeShader(this.specularShader),this.specularShader=null):(null==this.specularShader&&(this.specularShader=new Ae,this.passes.addShader(this.specularShader)),this.specularShader.texture__=
a);return a},getDefaultModelProps:function(){var a=this.getDefaultProps();switch(this.blendMode._hx_index){case 0:break;case 1:a.kind="Alpha";break;case 2:a.kind="Add";a.culling=!1;a.shadows=!1;a.light=!1;break;default:throw t.thrown("Unsupported HMD material "+y.string(this.blendMode));}return a},getDefaultProps:function(a){if(null==a)a={kind:"Opaque",shadows:!0,culling:!0,light:!0};else switch(a){case "particles3D":case "trail3D":a={kind:"Alpha",shadows:!1,culling:!1,light:!0};break;case "ui":a=
{kind:"Alpha",shadows:!1,culling:!1,light:!1};break;default:a={kind:"Opaque",shadows:!0,culling:!0,light:!0}}return a},refreshProps:function(){if(null!=this.props&&null!=this.passes){var a=this.props;switch(a.kind){case "Add":this.set_blendMode(ya.Add);break;case "Alpha":this.set_blendMode(ya.Alpha);break;case "AlphaKill":case "Hidden":case "Opaque":this.set_blendMode(ya.None);break;case "SoftAdd":this.set_blendMode(ya.SoftAdd)}var b=this.textureShader;null!=b&&(b.constModified=!0,b.killAlpha__="AlphaKill"==
a.kind,b.killAlphaThreshold__=.5);this.passes.set_culling("Hidden"==a.kind?gc.Both:a.culling?gc.Back:gc.None);this.passes.set_enableLights(a.light);a=a.shadows;this.set_castShadows(a);this.set_receiveShadows(a);this.castShadows&&this.receiveShadows&&this.getPass("shadow").set_culling(this.passes.culling)}},__class__:tf});var Yh=function(){this.db=new Sa};Yh.__name__="h3d.mat.MaterialDatabase";Yh.prototype={getFilePath:function(a){var b=a.entry.get_directory();return null==b||""==b?"materials.props":
a.entry.get_directory()+"/materials.props"},getModelData:function(a){if(null==a)return null;var b=this.db,c=a.entry.get_directory();b=b.h[c];if(null!=b)return b.v;b=this.getFilePath(a);try{var d=md.currentInstance.load(b);var e=JSON.parse(d.toText())}catch(f){if(t.caught(f).unwrap()instanceof Yf)e={};else throw f;}b=this.db;c=a.entry.get_directory();b.h[c]={v:e};return e},saveData:function(a,b){a=this.getFilePath(a);throw t.thrown("Can't save material props database "+a);},loadMatProps:function(a,
b){var c=this.getModelData(a.model);if(null==c)return c;c=c.materials;if(null==c)return c;c=sa.field(c,b.name);return null==c?c:null!=a.model&&(b=sa.field(c,a.name+"/"+a.model.entry.name),null!=b)?b:sa.field(c,a.name)},saveMatProps:function(a,b,c){b=["materials",b.name,a.name];var d=this.getModelData(a.model);if(null!=d){for(var e=d,f=[],g=0,h=b.length-1;g<h;){var k=g++,l=sa.field(d,b[k]);null==l&&(l={},d[b[k]]=l);f.push(d);d=l}g=a.props;h="modelSpec"==g.__refMode;k=b.pop();h||sa.deleteField(d,k);
l=k+"/"+(null!=a.model?a.model.entry.name:"");sa.deleteField(d,l);null==c&&(c=a.getDefaultProps());if(null==g||(null==c?"null":y.string(c))==(null==g?"null":y.string(g)))for(;0<b.length;){c=b.pop();d=f.pop();if(0!=sa.fields(sa.field(d,c)).length)break;sa.deleteField(d,c)}else d[h?l:k]=g;this.getFilePath(a.model);0==sa.fields(e).length&&(e=null);this.saveData(a.model,e)}},__class__:Yh};var Ld=function(a){null==this.database&&(this.database=new Yh);this.name=a};Ld.__name__="h3d.mat.MaterialSetup";Ld.prototype=
{createRenderer:function(){return new Jg},createLightSystem:function(){return new Kg},createMaterial:function(){return new tf},getDefaults:function(a){null==this.emptyMat&&(this.emptyMat=this.createMaterial());return this.emptyMat.getDefaultProps(a)},loadMaterialProps:function(a){return this.database.loadMatProps(a,this)},saveMaterialProps:function(a,b){this.database.saveMatProps(a,this,b)},customMeshInit:function(a){},__class__:Ld};var ba=function(a,b,c){this.bits=this.rendererFlags=this.layer=0;
this.parentPass=c;this.shaders=b;this.setPassName(a);this.set_culling(gc.Back);a=Y.One;b=Y.Zero;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.depth(!0,ob.Less);this.set_blendOp(this.set_blendAlphaOp(vb.Add));this.colorMask=15};ba.__name__="h3d.mat.Pass";ba.getEnableLights=function(a){return a&1};ba.getDynamicParameters=function(a){return a>>1&1};ba.getIsStatic=function(a){return a>>2&1};ba.getBatchMode=function(a){return a>>3&1};ba.getCulling=function(a){return a&
3};ba.getDepthWrite=function(a){return a>>2&1};ba.getDepthTest=function(a){return a>>3&7};ba.getBlendSrc=function(a){return a>>6&15};ba.getBlendDst=function(a){return a>>10&15};ba.getBlendAlphaSrc=function(a){return a>>14&15};ba.getBlendAlphaDst=function(a){return a>>18&15};ba.getBlendOp=function(a){return a>>22&7};ba.getBlendAlphaOp=function(a){return a>>25&7};ba.getWireframe=function(a){return a>>28&1};ba.getCulled=function(a){return a>>29&1};ba.getReserved=function(a){return a>>30&1};ba.prototype=
{load:function(a){this.name=a.name;this.passId=a.passId;this.bits=a.bits;this.set_enableLights(a.enableLights);this.set_dynamicParameters(a.dynamicParameters);this.set_culling(a.culling);this.set_depthWrite(a.depthWrite);this.set_depthTest(a.depthTest);this.set_blendSrc(a.blendSrc);this.set_blendDst(a.blendDst);this.set_blendOp(a.blendOp);this.set_blendAlphaSrc(a.blendAlphaSrc);this.set_blendAlphaDst(a.blendAlphaDst);this.set_blendAlphaOp(a.blendAlphaOp);this.colorMask=a.colorMask;null!=a.stencil&&
(null==this.stencil&&(this.stencil=new pa),this.stencil.load(a.stencil))},setPassName:function(a){this.name=a;this.passId=za.allocID(a)},blend:function(a,b){this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b)},setBlendMode:function(a){this.set_blendOp(vb.Add);this.set_blendAlphaOp(vb.Add);switch(a._hx_index){case 0:a=Y.One;var b=Y.Zero;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);break;case 1:a=Y.SrcAlpha;b=
Y.OneMinusSrcAlpha;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendAlphaSrc(Y.One);break;case 2:a=Y.SrcAlpha;b=Y.One;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendAlphaSrc(Y.One);break;case 3:a=Y.One;b=Y.OneMinusSrcAlpha;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);break;case 4:a=Y.OneMinusDstColor;b=Y.One;this.set_blendSrc(a);this.set_blendAlphaSrc(a);
this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendAlphaSrc(Y.One);break;case 5:a=Y.DstColor;b=Y.Zero;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendAlphaSrc(Y.One);break;case 6:a=Y.DstColor;b=Y.OneMinusSrcAlpha;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);break;case 7:a=Y.Zero;b=Y.OneMinusSrcColor;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);
break;case 8:a=Y.One;b=Y.OneMinusSrcColor;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);break;case 9:a=Y.SrcAlpha;b=Y.One;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendOp(vb.ReverseSub);this.set_blendAlphaOp(vb.ReverseSub);break;case 10:b=a=Y.One;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendAlphaOp(vb.Max);this.set_blendOp(vb.Max);
break;case 11:b=a=Y.One,this.set_blendSrc(a),this.set_blendAlphaSrc(a),this.set_blendDst(b),this.set_blendAlphaDst(b),this.set_blendAlphaOp(vb.Min),this.set_blendOp(vb.Min)}},depth:function(a,b){this.set_depthWrite(a);this.set_depthTest(b)},setColorMask:function(a,b,c,d){this.colorMask=(a?1:0)|(b?2:0)|(c?4:0)|(d?8:0)},setColorChannel:function(a){switch(a._hx_index){case 1:this.setColorMask(!0,!1,!1,!1);break;case 2:this.setColorMask(!1,!0,!1,!1);break;case 3:this.setColorMask(!1,!1,!0,!1);break;case 4:this.setColorMask(!1,
!1,!1,!0);break;default:throw t.thrown("Unsupported channel "+y.string(a));}},setColorMaski:function(a,b,c,d,e){if(8<e)throw t.thrown("Color mask i supports 8 Render target");this.colorMask|=((a?1:0)|(b?2:0)|(c?4:0)|(d?8:0))<<4*e},resetRendererFlags:function(){this.rendererFlags=0},addShader:function(a){if(null==a)return null;this.shaders=Eb.addSort(a,this.shaders);this.resetRendererFlags();return a},addSelfShader:function(a){if(null==a)return null;this.selfShadersChanged=!0;this.selfShaders=Eb.addSort(a,
this.selfShaders);this.resetRendererFlags();return a},addShaderAtIndex:function(a,b){for(var c=null,d=this.shaders;0<b&&d!=this.parentShaders;)c=d,d=d.next,--b;null==c?this.shaders=new Eb(a,d):c.next=new Eb(a,d);return a},getShaderIndex:function(a){for(var b=0,c=this.shaders;c!=this.parentShaders;){if(c.s==a)return b;c=c.next;++b}return-1},removeShader:function(a){for(var b=this.shaders,c=null,d=!1;null!=b;){if(b.s==a){this.resetRendererFlags();this.selfShadersCache==b&&(this.selfShadersCache=this.selfShadersCache.next);
null==c?this.shaders=b.next:c.next=b.next;d=!0;break}c=b;b=b.next}b=this.selfShaders;for(c=null;null!=b;){if(b.s==a)return this.resetRendererFlags(),this.selfShadersCache==b&&(this.selfShadersCache=this.selfShadersCache.next),null==c?this.selfShaders=b.next:c.next=b.next,!0;c=b;b=b.next}return d},removeShaders:function(a){for(var b=this.shaders,c=null;null!=b;)ka.__instanceof(b.s,a)?(this.resetRendererFlags(),this.selfShadersCache==b&&(this.selfShadersCache=this.selfShadersCache.next),null==c?this.shaders=
b.next:c.next=b.next):c=b,b=b.next;b=this.selfShaders;for(c=null;null!=b;)ka.__instanceof(b.s,a)?(this.resetRendererFlags(),this.selfShadersCache==b&&(this.selfShadersCache=this.selfShadersCache.next),null==c?this.selfShaders=b.next:c.next=b.next):c=b,b=b.next},getShader:function(a){var b=this._getShader(a,this.shaders);return null!=b?b:this._getShader(a,this.selfShaders)},_getShader:function(a,b){for(;null!=b&&b!=this.parentShaders;){var c=b.s;c=ka.__downcastCheck(c,a)?c:null;if(null!=c)return c;
b=b.next}return null},getShaderByName:function(a){var b=this._getShaderByName(a,this.shaders);return null!=b?b:this._getShaderByName(a,this.selfShaders)},_getShaderByName:function(a,b){for(;null!=b&&b!=this.parentShaders;){if(b.s.shader.data.name==a)return b.s;b=b.next}return null},getShaders:function(){return new re(this.shaders,this.parentShaders)},checkInfiniteLoop:function(){for(var a=[],b=this.selfShaders;null!=b;){for(var c=0;c<a.length;){var d=a[c];++c;if(d==b)throw t.thrown("infinite loop");
}a.push(b);b=b.next}},selfShadersRec:function(a){if(null==this.selfShaders)return this.shaders;if(!this.selfShadersChanged&&!a&&this.shaders==this.selfShadersCache)return this.selfShaders;a=this.selfShaders;for(var b=null;null!=a&&a!=this.selfShadersCache;)b=a,a=a.next;this.selfShadersCache=this.shaders;null!=b?b.next=this.selfShadersCache:this.selfShaders=this.shaders;return this.selfShaders},getShadersRec:function(){if(null==this.parentPass||this.parentShaders==this.parentPass.shaders)return this.selfShadersRec(!1);
for(var a=this.shaders,b=null;null!=a&&a!=this.parentShaders;)b=a,a=a.next;a!=this.parentShaders&&(b=null);this.parentShaders=this.parentPass.shaders;null==b?this.shaders=this.parentShaders:b.next=this.parentShaders;return this.selfShadersRec(!0)},clone:function(){var a=new ba(this.name,this.shaders.clone());a.selfShaders=this.selfShaders;a.bits=this.bits;a.set_enableLights(this.enableLights);null!=this.stencil&&(a.stencil=this.stencil.clone());return a},set_enableLights:function(a){this.flags=this.flags&
-2|(a?1:0);return this.enableLights=a},set_dynamicParameters:function(a){this.flags=this.flags&-3|(a?1:0)<<1;return this.dynamicParameters=a},set_isStatic:function(a){this.flags=this.flags&-5|(a?1:0)<<2;return this.isStatic=a},set_batchMode:function(a){this.flags=this.flags&-9|(a?1:0)<<3;return this.batchMode=a},set_culling:function(a){this.bits=this.bits&-4|a._hx_index;return this.culling=a},set_depthWrite:function(a){this.bits=this.bits&-5|(a?1:0)<<2;return this.depthWrite=a},set_depthTest:function(a){this.bits=
this.bits&-57|a._hx_index<<3;return this.depthTest=a},set_blendSrc:function(a){this.bits=this.bits&-961|a._hx_index<<6;return this.blendSrc=a},set_blendDst:function(a){this.bits=this.bits&-15361|a._hx_index<<10;return this.blendDst=a},set_blendAlphaSrc:function(a){this.bits=this.bits&-245761|a._hx_index<<14;return this.blendAlphaSrc=a},set_blendAlphaDst:function(a){this.bits=this.bits&-3932161|a._hx_index<<18;return this.blendAlphaDst=a},set_blendOp:function(a){this.bits=this.bits&-29360129|a._hx_index<<
22;return this.blendOp=a},set_blendAlphaOp:function(a){this.bits=this.bits&-234881025|a._hx_index<<25;return this.blendAlphaOp=a},set_wireframe:function(a){this.bits=this.bits&-268435457|(a?1:0)<<28;return this.wireframe=a},set_culled:function(a){this.bits=this.bits&-536870913|(a?1:0)<<29;return this.culled=a},set_reserved:function(a){this.bits=this.bits&-1073741825|(a?1:0)<<30;return this.reserved=a},loadFlags:function(a){this.flags=a;this.set_enableLights(0!=(this.flags&1));this.set_dynamicParameters(0!=
(this.flags>>1&1));this.set_isStatic(0!=(this.flags>>2&1));this.set_batchMode(0!=(this.flags>>3&1))},loadBits:function(a){this.bits=a;this.set_culling(da.createEnumIndex(gc,this.bits&3));this.set_depthWrite(0!=(this.bits>>2&1));this.set_depthTest(da.createEnumIndex(ob,this.bits>>3&7));this.set_blendSrc(da.createEnumIndex(Y,this.bits>>6&15));this.set_blendDst(da.createEnumIndex(Y,this.bits>>10&15));this.set_blendAlphaSrc(da.createEnumIndex(Y,this.bits>>14&15));this.set_blendAlphaDst(da.createEnumIndex(Y,
this.bits>>18&15));this.set_blendOp(da.createEnumIndex(vb,this.bits>>22&7));this.set_blendAlphaOp(da.createEnumIndex(vb,this.bits>>25&7));this.set_wireframe(0!=(this.bits>>28&1));this.set_culled(0!=(this.bits>>29&1));this.set_reserved(0!=(this.bits>>30&1))},__class__:ba};var pa=function(){this.maskBits=this.opBits=0;this.setOp(qb.Keep,qb.Keep,qb.Keep);this.setFunc(ob.Always)};pa.__name__="h3d.mat.Stencil";pa.getReadMask=function(a){return a&255};pa.getWriteMask=function(a){return a>>8&255};pa.getReference=
function(a){return a>>16&255};pa.getFrontTest=function(a){return a&7};pa.getFrontPass=function(a){return a>>3&7};pa.getFrontSTfail=function(a){return a>>6&7};pa.getFrontDPfail=function(a){return a>>9&7};pa.getBackTest=function(a){return a>>12&7};pa.getBackPass=function(a){return a>>15&7};pa.getBackSTfail=function(a){return a>>18&7};pa.getBackDPfail=function(a){return a>>21&7};pa.prototype={setFront:function(a,b,c){this.set_frontSTfail(a);this.set_frontDPfail(b);this.set_frontPass(c)},setBack:function(a,
b,c){this.set_backSTfail(a);this.set_backDPfail(b);this.set_backPass(c)},setOp:function(a,b,c){this.setFront(a,b,c);this.setBack(a,b,c)},setFunc:function(a,b,c,d){null==d&&(d=255);null==c&&(c=255);null==b&&(b=0);this.set_frontTest(this.set_backTest(a));this.set_reference(b);this.set_readMask(c);this.set_writeMask(d)},clone:function(){var a=new pa;a.opBits=this.opBits;a.maskBits=this.maskBits;return a},load:function(a){this.opBits=a.opBits;this.maskBits=a.maskBits},set_readMask:function(a){this.maskBits=
this.maskBits&-256|a&255;return this.readMask=a},set_writeMask:function(a){this.maskBits=this.maskBits&-65281|(a&255)<<8;return this.writeMask=a},set_reference:function(a){this.maskBits=this.maskBits&-16711681|(a&255)<<16;return this.reference=a},set_frontTest:function(a){this.opBits=this.opBits&-8|a._hx_index;return this.frontTest=a},set_frontPass:function(a){this.opBits=this.opBits&-57|a._hx_index<<3;return this.frontPass=a},set_frontSTfail:function(a){this.opBits=this.opBits&-449|a._hx_index<<
6;return this.frontSTfail=a},set_frontDPfail:function(a){this.opBits=this.opBits&-3585|a._hx_index<<9;return this.frontDPfail=a},set_backTest:function(a){this.opBits=this.opBits&-28673|a._hx_index<<12;return this.backTest=a},set_backPass:function(a){this.opBits=this.opBits&-229377|a._hx_index<<15;return this.backPass=a},set_backSTfail:function(a){this.opBits=this.opBits&-1835009|a._hx_index<<18;return this.backSTfail=a},set_backDPfail:function(a){this.opBits=this.opBits&-14680065|a._hx_index<<21;
return this.backDPfail=a},loadOpBits:function(a){this.opBits=a;this.set_frontTest(da.createEnumIndex(ob,this.opBits&7));this.set_frontPass(da.createEnumIndex(qb,this.opBits>>3&7));this.set_frontSTfail(da.createEnumIndex(qb,this.opBits>>6&7));this.set_frontDPfail(da.createEnumIndex(qb,this.opBits>>9&7));this.set_backTest(da.createEnumIndex(ob,this.opBits>>12&7));this.set_backPass(da.createEnumIndex(qb,this.opBits>>15&7));this.set_backSTfail(da.createEnumIndex(qb,this.opBits>>18&7));this.set_backDPfail(da.createEnumIndex(qb,
this.opBits>>21&7))},loadMaskBits:function(a){this.maskBits=a;this.set_readMask(this.maskBits&255);this.set_writeMask(this.maskBits>>8&255);this.set_reference(this.maskBits>>16&255)},__class__:pa};var J=K["hxd.PixelFormat"]={__ename__:!0,__constructs__:null,ARGB:{_hx_name:"ARGB",_hx_index:0,__enum__:"hxd.PixelFormat",toString:v},BGRA:{_hx_name:"BGRA",_hx_index:1,__enum__:"hxd.PixelFormat",toString:v},RGBA:{_hx_name:"RGBA",_hx_index:2,__enum__:"hxd.PixelFormat",toString:v},RGBA16F:{_hx_name:"RGBA16F",
_hx_index:3,__enum__:"hxd.PixelFormat",toString:v},RGBA32F:{_hx_name:"RGBA32F",_hx_index:4,__enum__:"hxd.PixelFormat",toString:v},R8:{_hx_name:"R8",_hx_index:5,__enum__:"hxd.PixelFormat",toString:v},R16F:{_hx_name:"R16F",_hx_index:6,__enum__:"hxd.PixelFormat",toString:v},R32F:{_hx_name:"R32F",_hx_index:7,__enum__:"hxd.PixelFormat",toString:v},RG8:{_hx_name:"RG8",_hx_index:8,__enum__:"hxd.PixelFormat",toString:v},RG16F:{_hx_name:"RG16F",_hx_index:9,__enum__:"hxd.PixelFormat",toString:v},RG32F:{_hx_name:"RG32F",
_hx_index:10,__enum__:"hxd.PixelFormat",toString:v},RGB8:{_hx_name:"RGB8",_hx_index:11,__enum__:"hxd.PixelFormat",toString:v},RGB16F:{_hx_name:"RGB16F",_hx_index:12,__enum__:"hxd.PixelFormat",toString:v},RGB32F:{_hx_name:"RGB32F",_hx_index:13,__enum__:"hxd.PixelFormat",toString:v},SRGB:{_hx_name:"SRGB",_hx_index:14,__enum__:"hxd.PixelFormat",toString:v},SRGB_ALPHA:{_hx_name:"SRGB_ALPHA",_hx_index:15,__enum__:"hxd.PixelFormat",toString:v},RGB10A2:{_hx_name:"RGB10A2",_hx_index:16,__enum__:"hxd.PixelFormat",
toString:v},RG11B10UF:{_hx_name:"RG11B10UF",_hx_index:17,__enum__:"hxd.PixelFormat",toString:v},R16U:{_hx_name:"R16U",_hx_index:18,__enum__:"hxd.PixelFormat",toString:v},RG16U:{_hx_name:"RG16U",_hx_index:19,__enum__:"hxd.PixelFormat",toString:v},RGB16U:{_hx_name:"RGB16U",_hx_index:20,__enum__:"hxd.PixelFormat",toString:v},RGBA16U:{_hx_name:"RGBA16U",_hx_index:21,__enum__:"hxd.PixelFormat",toString:v},S3TC:(z=function(a){return{_hx_index:22,v:a,__enum__:"hxd.PixelFormat",toString:v}},z._hx_name="S3TC",
z.__params__=["v"],z),Depth16:{_hx_name:"Depth16",_hx_index:23,__enum__:"hxd.PixelFormat",toString:v},Depth24:{_hx_name:"Depth24",_hx_index:24,__enum__:"hxd.PixelFormat",toString:v},Depth24Stencil8:{_hx_name:"Depth24Stencil8",_hx_index:25,__enum__:"hxd.PixelFormat",toString:v},Depth32:{_hx_name:"Depth32",_hx_index:26,__enum__:"hxd.PixelFormat",toString:v}};J.__constructs__=[J.ARGB,J.BGRA,J.RGBA,J.RGBA16F,J.RGBA32F,J.R8,J.R16F,J.R32F,J.RG8,J.RG16F,J.RG32F,J.RGB8,J.RGB16F,J.RGB32F,J.SRGB,J.SRGB_ALPHA,
J.RGB10A2,J.RG11B10UF,J.R16U,J.RG16U,J.RGB16U,J.RGBA16U,J.S3TC,J.Depth16,J.Depth24,J.Depth24Stencil8,J.Depth32];J.__empty_constructs__=[J.ARGB,J.BGRA,J.RGBA,J.RGBA16F,J.RGBA32F,J.R8,J.R16F,J.R32F,J.RG8,J.RG16F,J.RG32F,J.RGB8,J.RGB16F,J.RGB32F,J.SRGB,J.SRGB_ALPHA,J.RGB10A2,J.RG11B10UF,J.R16U,J.RG16U,J.RGB16U,J.RGBA16U,J.Depth16,J.Depth24,J.Depth24Stencil8,J.Depth32];var W=function(a,b,c,d){this.depthClamp=!1;this.startingMip=this.lodBias=this.depthBias=this.slopeScaledBias=0;null==d&&(d=W.nativeFormat);
this.id=++W.UID;this.format=d;this.flags=0;if(null!=c)for(d=0;d<c.length;){var e=c[d];++d;this.flags|=1<<e._hx_index}this.mem=ja.CURRENT.mem;for(d=c=1;c<a;)c<<=1;for(;d<b;)d<<=1;if(c!=a||d!=b)this.flags|=1<<P.IsNPOT._hx_index;this.width=a;this.height=b;0!=(this.flags&1<<P.MipMapped._hx_index)?this.set_mipMap(W.TRILINEAR_FILTERING_ENABLED?Fc.Linear:Fc.Nearest):this.set_mipMap(Fc.None);this.set_filter(fd.Linear);this.set_wrap(W.DEFAULT_WRAP);this.bits&=32767;this.allocPos=Oc.make();0==(this.flags&1<<
P.NoAlloc._hx_index)&&0<this.width&&this.alloc()};W.__name__="h3d.mat.Texture";W.getDefaultDepth=function(){return ja.CURRENT.driver.getDefaultDepthBuffer()};W.fromBitmap=function(a){var b=new W(a.ctx.canvas.width,a.ctx.canvas.height);b.uploadBitmap(a);return b};W.fromPixels=function(a,b){b=new W(a.width,a.height,null,null!=b?b:a.innerFormat);b.uploadPixels(a);return b};W.fromColor=function(a,b){null==b&&(b=1);var c=ja.CURRENT,d=255*b|0;0>d?d=0:255<d&&(d=255);d=a&16777215|d<<24;var e=c.textureColorCache.h[d];
if(null!=e)return e;e=new W(1,1,null);e.clear(a,b);e.realloc=function(){e.clear(a,b)};return c.textureColorCache.h[d]=e};W.genDisc=function(a,b,c){null==c&&(c=1);return W.genTexture(0,a,b,c)};W.genTexture=function(a,b,c,d){var e=ja.CURRENT;d=255*d|0;0>d?d=0:255<d&&(d=255);c=c&16777215|d<<24;d=(b<<16|a)+","+c;var f=W.genTextureKeys.h[d],g=null==f?null:e.resCache.h[f.__id__];if(null!=g)return g;null==f&&(f={},W.genTextureKeys.h[d]=f);g=new W(b,b,[P.Target]);g.realloc=function(){W.drawGenTexture(g,c,
a)};W.drawGenTexture(g,c,a);e.resCache.set(f,g);return g};W.drawGenTexture=function(a,b,c){var d=new sb(new bf),e=ja.CURRENT,f=d.shader;f.constModified=!0;f.mode__=c;f=d.shader.color__;f.x=(b>>16&255)/255;f.y=(b>>8&255)/255;f.z=(b&255)/255;f.w=(b>>>24)/255;e.pushTarget(a);d.render();e.popTarget()};W.defaultCubeTexture=function(){var a=ja.CURRENT,b=a.resCache.h[W.__id__];if(null!=b)return b;b=new W(1,1,[P.Cube]);b.clear(2105376);b.realloc=function(){b.clear(2105376)};a.resCache.set(W,b);return b};
W.genChecker=function(a){var b=ja.CURRENT,c=W.checkerTextureKeys.h[a],d=null==c?null:b.resCache.h[c.__id__];if(null!=d&&(null!=d.t||!d.isDepth()&&null!=d.realloc))return d;null==c&&(c={},W.checkerTextureKeys.h[a]=c);var e=d=new W(a,a,[P.NoAlloc]);d.realloc=function(){W.allocChecker(e,a)};b.resCache.set(c,d);return d};W.genNoise=function(a){var b=ja.CURRENT,c=W.noiseTextureKeys.h[a],d=null==c?null:b.resCache.h[c.__id__];if(null!=d&&(null!=d.t||!d.isDepth()&&null!=d.realloc))return d;null==c&&(c={},
W.noiseTextureKeys.h[a]=c);var e=d=new W(a,a,[P.NoAlloc]);d.realloc=function(){W.allocNoise(e,a)};b.resCache.set(c,d);return d};W.allocNoise=function(a,b){for(var c=new Wd(b,b),d=0;d<b;)for(var e=d++,f=0,g=b;f<g;){var h=f++,k=y.random(256);c.setPixel(e,h,-16777216|k|k<<8|k<<16)}a.uploadBitmap(c);c.ctx=null;c.pixel=null};W.allocChecker=function(a,b){var c=new Wd(b,b);c.clear(-1);for(var d=0,e=b>>1;d<e;)for(var f=d++,g=0,h=b>>1;g<h;){var k=g++;c.setPixel(f,k,-16777216);c.setPixel(f+(b>>1),k+(b>>1),
-16777216)}a.uploadBitmap(c);c.ctx=null;c.pixel=null};W.prototype={set_lastFrame:function(a){this._lastFrame!=W.PREVENT_AUTO_DISPOSE&&(this._lastFrame=a);return this._lastFrame},get_lastFrame:function(){return this._lastFrame},get_mipLevels:function(){if(0==(this.flags&1<<P.MipMapped._hx_index))return 1;if(0<this.customMipLevels)return this.customMipLevels;for(var a=1,b=this.width,c=this.height;1<=b>>a||1<=c>>a;)++a;return a},get_layerCount:function(){return 0!=(this.flags&1<<P.Cube._hx_index)?6:
1},alloc:function(){null==this.t&&this.mem.allocTexture(this)},isSRGB:function(){switch(this.format._hx_index){case 14:case 15:return!0;default:return!1}},checkAlloc:function(){null==this.t&&null!=this.realloc&&(this.alloc(),this.realloc())},clone:function(){this.checkAlloc();if(null==this.t)throw t.thrown("Can't clone disposed texture");var a=this._lastFrame;this.preventAutoDispose();var b=[],c=P.Target;0!=(this.flags&1<<c._hx_index)&&b.push(c);c=P.Cube;0!=(this.flags&1<<c._hx_index)&&b.push(c);
c=P.MipMapped;0!=(this.flags&1<<c._hx_index)&&b.push(c);c=P.IsArray;0!=(this.flags&1<<c._hx_index)&&b.push(c);b=new W(this.width,this.height,b,this.format);b.name=this.name;0!=(this.flags&1<<P.Cube._hx_index)?he.run(this,b):oc.run(this,b);this.set_lastFrame(a);return b},preventAutoDispose:function(){this.set_lastFrame(W.PREVENT_AUTO_DISPOSE)},preventForcedDispose:function(){this.set_lastFrame(W.PREVENT_FORCED_DISPOSE)},waitLoad:function(a){0==(this.flags&1<<P.Loading._hx_index)?a():(null==this.waitLoads&&
(this.waitLoads=[]),this.waitLoads.push(a))},toString:function(){var a=this.name;null==this.name&&(a="Texture_"+this.id,null!=this.allocPos&&(a+="("+this.allocPos.position+")"));return a=0!=(this.flags&1<<P.Is3D._hx_index)?a+("("+this.width+"x"+this.height+"x"+this.get_layerCount()+")"):a+("("+this.width+"x"+this.height+")")},setName:function(a){this.name=a},set_depthBias:function(a){a!=this.depthBias&&(this.depthBias=a,ja.CURRENT.onTextureBiasChanged(this));return this.depthBias},set_slopeScaledBias:function(a){a!=
this.slopeScaledBias&&(this.slopeScaledBias=a,ja.CURRENT.onTextureBiasChanged(this));return this.slopeScaledBias},set_mipMap:function(a){this.bits=this.bits&-4|a._hx_index;return this.mipMap=a},set_filter:function(a){this.bits=this.bits&-25|a._hx_index<<3;return this.filter=a},set_wrap:function(a){this.bits=this.bits&-193|a._hx_index<<6;return this.wrap=a},isDisposed:function(){return null==this.t?this.isDepth()?!0:null==this.realloc:!1},resize:function(a,b){this.dispose();for(var c=1,d=1;c<a;)c<<=
1;for(;d<b;)d<<=1;this.flags=c!=a||d!=b?this.flags|1<<P.IsNPOT._hx_index:this.flags&-1-(1<<P.IsNPOT._hx_index);this.width=a;this.height=b;0==(this.flags&1<<P.NoAlloc._hx_index)&&this.alloc()},clearF:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.alloc();if(0==(this.flags&1<<P.Target._hx_index))throw t.thrown("Texture should be target");var f=ja.CURRENT;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);d=new O(a,b,c,d);if(0>e)for(e=0,
a=this.get_layerCount();e<a;)c=e++,f.pushTarget(this,c),f.clearF(d),f.popTarget();else f.pushTarget(this,e),f.clearF(d),f.popTarget()},clear:function(a,b,c){null==c&&(c=-1);null==b&&(b=1);this.alloc();if(0!=this.width&&0!=this.height)if(1!=this.width||1!=this.height){var d=ja.CURRENT;a|=(255*(0>b?0:1<b?1:b)|0)<<24;if(0>c){var e=0;for(b=this.get_layerCount();e<b;)c=e++,d.pushTarget(this,c),d.clear(a),d.popTarget()}else d.pushTarget(this,c),d.clear(a),d.popTarget()}else{d=ta.alloc(this.width,this.height,
W.nativeFormat);var f=0,g=a&255,h=a>>8&255;a=a>>16&255;var k=255*b|0;0>k?k=0:255<k&&(k=255);switch(W.nativeFormat._hx_index){case 1:b=a;a=g;g=b;break;case 2:break;default:throw t.thrown("TODO");}e=0;for(b=this.width*this.height;e<b;)e++,d.bytes.b[f++]=a,d.bytes.b[f++]=h,d.bytes.b[f++]=g,d.bytes.b[f++]=k;if(0>c)for(e=0,b=this.get_layerCount();e<b;)c=e++,this.uploadPixels(d,0,c);else this.uploadPixels(d,0,c);d.dispose()}},checkSize:function(a,b,c){var d=this.width>>c;0==d&&(d=1);c=this.height>>c;0==
c&&(c=1);if(a!=d||b!=c)throw t.thrown("Invalid upload size : "+a+"x"+b+" should be "+d+"x"+c);},checkMipMapGen:function(a,b){0==a&&0!=(this.flags&1<<P.MipMapped._hx_index)&&0==(this.flags&1<<P.ManualMipMapGen._hx_index)&&b==this.get_layerCount()-1&&this.mem.driver.generateMipMaps(this)},uploadBitmap:function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.alloc();this.checkSize(a.ctx.canvas.width,a.ctx.canvas.height,b);this.mem.driver.uploadTextureBitmap(this,a,b,c);this.flags|=1<<P.WasCleared._hx_index;
this.checkMipMapGen(b,c)},uploadPixels:function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.alloc();this.checkSize(a.width,a.height,b);this.mem.driver.uploadTexturePixels(this,a,b,c);this.flags|=1<<P.WasCleared._hx_index;this.checkMipMapGen(b,c)},dispose:function(){null!=this.t&&this.mem.deleteTexture(this)},hasStencil:function(){return 25==this.format._hx_index?!0:!1},isDepth:function(){switch(this.format._hx_index){case 23:case 24:case 25:case 26:return!0;default:return!1}},capturePixels:function(a,
b,c){null==b&&(b=0);null==a&&(a=0);var d=this._lastFrame;this.preventAutoDispose();a=this.mem.driver.capturePixels(this,a,b,c);this.set_lastFrame(d);return a},__class__:W};var Zf=function(a,b,c,d,e){this.layers=c;null==d&&(d=[]);d.push(P.IsArray);W.call(this,a,b,d,e)};Zf.__name__="h3d.mat.TextureArray";Zf.__super__=W;Zf.prototype=D(W.prototype,{get_layerCount:function(){return this.layers},clone:function(){var a=this._lastFrame;this.preventAutoDispose();var b=new Zf(this.width,this.height,this.layers,
null,this.format);oc.run(this,b);this.set_lastFrame(a);return b},toString:function(){return W.prototype.toString.call(this)+"["+this.layers+"]"},__class__:Zf});var sb=function(a,b){this.shader=a;this.output=new Pf(b);this.pass=new ba("screenfx",new Eb(a));this.pass.set_culling(gc.None);this.pass.depth(!1,ob.Always)};sb.__name__="h3d.pass.ScreenFx";sb.run=function(a,b,c){var d=ja.CURRENT;d.pushTarget(b,c);(new sb(a)).render();d.popTarget()};sb.prototype={get_engine:function(){null==this._engine&&(this._engine=
ja.CURRENT);return this._engine},copy:function(a,b){oc.run(a,b)},addShader:function(a){return this.pass.addShader(a)},removeShader:function(a){return this.pass.removeShader(a)},getShader:function(a){return this.pass.getShader(a)},render:function(){null==this.primitive&&(this.primitive=Be.get());this.shader.flipY__=this.get_engine().driver.hasFeature(Ia.BottomLeftCoords)&&null!=this.get_engine().getCurrentTarget()?-1:1;var a=this.pass.shaders,b=Qa.get(),c=!1;null==b&&(c=!0,b=new Qa,b.setCurrent());
var d=this.output.compileShaders(b.globals,a);this.get_engine().selectMaterial(this.pass);this.get_engine().selectShader(d);var e=b.shaderBuffers;e.vertex.grow(d.vertex);null!=d.fragment&&e.fragment.grow(d.fragment);b.fillGlobals(e,d);b.fillParams(e,d,a);this.get_engine().uploadShaderBuffers(e,0);this.get_engine().uploadShaderBuffers(e,1);this.get_engine().uploadShaderBuffers(e,2);this.get_engine().uploadShaderBuffers(e,3);this.primitive.render(this.get_engine());c&&b.clearCurrent()},dispose:function(){},
__class__:sb};var $f=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=1);null==a&&(a=1);this.cubeDir=[Nb.L([0,0,-1,0,0,-1,0,0,1,0,0,0]),Nb.L([0,0,1,0,0,-1,0,0,-1,0,0,0]),Nb.L([1,0,0,0,0,0,1,0,0,1,0,0]),Nb.L([1,0,0,0,0,0,-1,0,0,-1,0,0]),Nb.L([1,0,0,0,0,-1,0,0,0,0,1,0]),Nb.L([-1,0,0,0,0,-1,0,0,0,0,-1,0])];sb.call(this,new Dd);this.set_radius(a);this.set_quality(d);this.set_gain(b);this.set_linear(c)};$f.__name__="h3d.pass.Blur";$f.__super__=sb;$f.prototype=D(sb.prototype,{set_radius:function(a){if(this.radius==
a)return a;this.values=null;return this.radius=a},set_quality:function(a){if(this.quality==a)return a;this.values=null;return this.quality=a},set_gain:function(a){if(this.gain==a)return a;this.values=null;return this.gain=a},set_linear:function(a){if(this.linear==a)return a;this.values=null;return this.linear=a},gauss:function(a,b){if(0>=b)return 0==a?1:0;b*=b;return Math.pow(2.718281828459,-(a*a)/(2*b))/Math.sqrt(2*Math.PI*b)},calcValues:function(){var a;this.values=[];this.offsets=[];var b=0,c=
this.quality;c=.7*(0>c?0:1<c?1:c)+.3;if(0<this.radius){var d=this.radius-1;var e=Math.ceil((1>d?1:d)*c/2)}else e=0;d=Math.sqrt(this.radius);var f=0;for(a=e+1;f<a;){e=f++;var g=2*e,h=0==e?0:2*e-1,k=this.gauss(g,d),l=this.gauss(h,d),m=k+l;this.values[e]=m;this.offsets[e]=0==e?0:(k*g+l*h)/(m*e*Math.sqrt(c));b+=m;0<e&&(b+=m)}for(f=.01/c*this.values[0];2<this.values.length;){e=this.values[this.values.length-1];if(e>f)break;b-=2*e;this.values.pop()}b/=this.gain;f=0;for(a=this.values.length;f<a;)e=f++,this.values[e]/=
b;if(0<this.linear)for(b=this.gain/(2*this.values.length-1),f=0,a=this.values.length;f<a;)e=f++,d=this.values[e],this.values[e]=d+this.linear*(b-d),d=this.offsets[e],this.offsets[e]=d+this.linear*((0==e?0:(2*e-.5)/(e*c))-d)},getKernelSize:function(){null==this.values&&this.calcValues();return 0>=this.radius?0:2*this.values.length-1},apply:function(a,b,c){if(0>=this.radius&&null==this.shader.fixedColor__)null!=c&&oc.run(b,c);else{null==c&&(c=b);null==this.values&&this.calcValues();var d=0!=(b.flags&
1<<P.Cube._hx_index),e=d?6:1;a=a.textures.allocTarget(b.name+"BlurTmp",b.width,b.height,!1,b.format,d?[P.Cube]:null);var f=this.shader;f.constModified=!0;f.Quality__=this.values.length;this.shader.values__=this.values;this.shader.offsets__=this.offsets;d?(this.shader.cubeTexture__=b,f=this.shader,f.constModified=!0,f.isCube__=!0):(this.shader.texture__=b,f=this.shader,f.constModified=!0,f.isCube__=!1);f=this.shader.pixel__;var g=1/b.width,h=0;null==h&&(h=0);null==g&&(g=0);f.x=g;f.y=h;g=f.z=0;for(h=
e;g<h;)f=g++,this.get_engine().pushTarget(a,f),d&&(this.shader.cubeDir__=this.cubeDir[f]),this.render(),this.get_engine().popTarget();d?this.shader.cubeTexture__=a:this.shader.texture__=a;f=this.shader.pixel__;g=0;h=1/b.height;null==h&&(h=0);null==g&&(g=0);f.x=g;f.y=h;f.z=0;b=c.depthBuffer;c.depthBuffer=null;g=0;for(h=e;g<h;)f=g++,this.get_engine().pushTarget(c,f),d&&(this.shader.cubeDir__=this.cubeDir[f]),this.render(),this.get_engine().popTarget();c.depthBuffer=b}},__class__:$f});var na=function(){this.priority=
0;this.initialize()};na.__name__="hxsl.Shader";na.prototype={initialize:function(){this.constModified=!0;if(null==this.shader){var a=ka.getClass(this);this.shader=a._SHADER;if(null==this.shader){for(var b=a;null!=b&&null==b.SRC;)b=b.__super__;if(null==b)throw t.thrown(a.__name__+" has no shader source");this.shader=b._SHADER;null==this.shader&&(this.shader=new Ob(b.SRC,b._MODULE),b._SHADER=this.shader)}}},setPriority:function(a){this.priority=a},getParamValue:function(a){throw t.thrown("assert");
},getParamFloatValue:function(a){throw t.thrown("assert");},setParamIndexValue:function(a,b){throw t.thrown("assert");},setParamIndexFloatValue:function(a,b){throw t.thrown("assert");},updateConstants:function(a){throw t.thrown("assert");},updateConstantsFinal:function(a){for(var b=this.shader.consts;null!=b;){if(0!=b.globalId){var c=a.map.h[b.globalId],d=b.v.type;switch(d._hx_index){case 1:d=c;if(0!=d>>>b.bits)throw t.thrown("Constant "+b.v.name+" is outside range ("+d+" > "+((1<<b.bits)-1)+")");
this.constBits|=d<<b.pos;break;case 2:c&&(this.constBits|=1<<b.pos);break;case 17:d=d.size;if(null==c){b=b.next;continue}var e=c.channel;if(null==c.texture)e=lb.Unknown;else if(null==e||e==lb.Unknown)switch(d){case 1:if(c.texture.format==W.nativeFormat)e=lb.PackedFloat;else throw t.thrown("Constant "+b.v.name+" does not define channel select value");break;case 3:if(c.texture.format==W.nativeFormat)e=lb.PackedNormal;else throw t.thrown("Constant "+b.v.name+" does not define channel select value");
break;default:throw t.thrown("Constant "+b.v.name+" does not define channel select value");}this.constBits|=(a.allocChannelID(c.texture)<<3|e._hx_index)<<b.pos;break;default:throw t.thrown("assert");}}b=b.next}a=this.shader;b=this.constBits;d=a.instanceCache.h[b];this.instance=null==d?a.makeInstance(b):d},clone:function(){return this},toString:function(){return ka.getClass(this).__name__},__class__:na};var fb=function(){this.flipY__=0;na.call(this)};fb.__name__="h3d.shader.ScreenShader";fb.__super__=
na;fb.prototype=D(na.prototype,{get_flipY:function(){return this.flipY__},set_flipY:function(a){return this.flipY__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.flipY__:null},getParamFloatValue:function(a){return 0==a?this.flipY__:0},setParamIndexValue:function(a,b){0==a&&(this.flipY__=b)},setParamIndexFloatValue:function(a,b){0==a&&(this.flipY__=b)},clone:function(){var a=Object.create(fb.prototype);a.shader=this.shader;
a.flipY__=this.flipY__;return a},__class__:fb});var Ce=function(){this.color__=new O(0,0,0,1);fb.call(this)};Ce.__name__="h3d.pass._Border.BorderShader";Ce.__super__=fb;Ce.prototype=D(fb.prototype,{get_color:function(){return this.color__},set_color:function(a){return this.color__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.color__}return null},getParamFloatValue:function(a){return 0==
a?this.flipY__:0},clone:function(){var a=Object.create(Ce.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.color__=this.color__;return a},__class__:Ce});var ag=function(a,b,c){null==c&&(c=1);sb.call(this,new Ce);this.width=a;this.height=b;this.size=c;a=this.shader.color__;var d=c=b=1,e=1;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e};ag.__name__="h3d.pass.Border";ag.__super__=sb;ag.prototype=D(sb.prototype,{createPrimitive:function(){var a=wd._new(0),
b=0/this.width*2-1;if(a.pos==a.array.length){var c=a.array.length<<1;128>c&&(c=128);c=new Float32Array(c);c.set(a.array);a.array=c}a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<
1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;var d=this.size;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.size;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),
c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=this.size/this.width*
2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>
c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=this.size/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height-this.size;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),
c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height-this.size;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=
b;d=this.height;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==
a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=(this.width-this.size)/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<
1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=(this.width-this.size)/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),
c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;this.primitive=new Lg({vbuf:a,format:N.make([new va("position",2,0)])},!0)},render:function(){null==this.primitive&&this.createPrimitive();sb.prototype.render.call(this)},
dispose:function(){null!=this.primitive&&this.primitive.dispose();sb.prototype.dispose.call(this)},__class__:ag});var cf=function(){this.layer__=0;fb.call(this)};cf.__name__="h3d.pass._Copy.ArrayCopyShader";cf.__super__=fb;cf.prototype=D(fb.prototype,{get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},get_layer:function(){return this.layer__},set_layer:function(a){return this.layer__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},
getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.texture__;case 2:return this.layer__}return null},getParamFloatValue:function(a){switch(a){case 0:return this.flipY__;case 2:return this.layer__}return 0},clone:function(){var a=Object.create(cf.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.texture__=this.texture__;a.layer__=this.layer__;return a},__class__:cf});var Ed=function(){sb.call(this,new cf)};Ed.__name__="h3d.pass.ArrayCopy";Ed.run=function(a,b,c,
d,e,f){var g=ja.CURRENT;if(null==c||null==a||null!=d&&d!=ya.None||null!=e||!g.driver.copyTexture(a,c)){var h=g.resCache.h[Ed.__id__];null==h&&(h=new Ed,g.resCache.set(Ed,h));h.apply(a,b,c,d,e,f)}};Ed.__super__=sb;Ed.prototype=D(sb.prototype,{apply:function(a,b,c,d,e,f){null!=c&&this.get_engine().pushTarget(c,null!=f?f:0);this.shader.texture__=a;this.shader.layer__=b;if(null!=e){null!=d&&e.setBlendMode(d);for(a=e.shaders;null!=a.next;)a=a.next;a.next=this.pass.shaders;b=this.pass;this.pass=e;this.render();
this.pass=b;a.next=null}else this.pass.setBlendMode(null==d?ya.None:d),this.render();this.shader.texture__=null;this.shader.layer__=0;null!=c&&this.get_engine().popTarget()},__class__:Ed});var De=function(){fb.call(this)};De.__name__="h3d.pass._Copy.CopyShader";De.__super__=fb;De.prototype=D(fb.prototype,{get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;
case 1:return this.texture__}return null},getParamFloatValue:function(a){return 0==a?this.flipY__:0},clone:function(){var a=Object.create(De.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.texture__=this.texture__;return a},__class__:De});var oc=function(){sb.call(this,new De)};oc.__name__="h3d.pass.Copy";oc.run=function(a,b,c,d,e){var f=ja.CURRENT;if(null==b||null==a||null!=c&&c!=ya.None||null!=d||null!=e||!f.driver.copyTexture(a,b)){var g=f.resCache.h[oc.__id__];null==g&&(g=new oc,f.resCache.set(oc,
g));g.apply(a,b,c,d,e)}};oc.__super__=sb;oc.prototype=D(sb.prototype,{apply:function(a,b,c,d,e){null!=b&&this.get_engine().pushTarget(b,null!=e?e:0,null,kc.NotBound);this.shader.texture__=a;if(null!=d){null!=c&&d.setBlendMode(c);for(a=d.shaders;null!=a.next;)a=a.next;a.next=this.pass.shaders;c=this.pass;this.pass=d;this.render();this.pass=c;a.next=null}else this.pass.setBlendMode(null==c?ya.None:c),this.render();this.shader.texture__=null;null!=b&&this.get_engine().popTarget()},__class__:oc});var df=
function(){this.mat__=new ca;fb.call(this)};df.__name__="h3d.pass._CubeCopy.CubeCopyShader";df.__super__=fb;df.prototype=D(fb.prototype,{get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},get_mat:function(){return this.mat__},set_mat:function(a){return this.mat__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.texture__;case 2:return this.mat__}return null},
getParamFloatValue:function(a){return 0==a?this.flipY__:0},clone:function(){var a=Object.create(df.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.texture__=this.texture__;a.mat__=this.mat__;return a},__class__:df});var he=function(){this.cubeDir=[Nb.L([0,0,-1,0,0,-1,0,0,1,0,0,0]),Nb.L([0,0,1,0,0,-1,0,0,-1,0,0,0]),Nb.L([1,0,0,0,0,0,1,0,0,1,0,0]),Nb.L([1,0,0,0,0,0,-1,0,0,-1,0,0]),Nb.L([1,0,0,0,0,-1,0,0,0,0,1,0]),Nb.L([-1,0,0,0,0,-1,0,0,0,0,-1,0])];sb.call(this,new df)};he.__name__="h3d.pass.CubeCopy";
he.run=function(a,b,c,d){null==d&&(d=0);var e=ja.CURRENT;if(null==b||null==a||null!=c&&c!=ya.None||0!=d||!e.driver.copyTexture(a,b)){var f=e.resCache.h[he.__id__];null==f&&(f=new he,e.resCache.set(he,f));f.apply(a,b,c,d)}};he.__super__=sb;he.prototype=D(sb.prototype,{apply:function(a,b,c,d){null==d&&(d=0);this.shader.texture__=a;null!=b&&this.get_engine().pushTarget(b,0,d);this.shader.mat__=this.cubeDir[0];this.pass.setBlendMode(null==c?ya.None:c);this.render();null!=b&&this.get_engine().popTarget();
null!=b&&this.get_engine().pushTarget(b,1,d);this.shader.mat__=this.cubeDir[1];this.pass.setBlendMode(null==c?ya.None:c);this.render();null!=b&&this.get_engine().popTarget();null!=b&&this.get_engine().pushTarget(b,2,d);this.shader.mat__=this.cubeDir[2];this.pass.setBlendMode(null==c?ya.None:c);this.render();null!=b&&this.get_engine().popTarget();null!=b&&this.get_engine().pushTarget(b,3,d);this.shader.mat__=this.cubeDir[3];this.pass.setBlendMode(null==c?ya.None:c);this.render();null!=b&&this.get_engine().popTarget();
null!=b&&this.get_engine().pushTarget(b,4,d);this.shader.mat__=this.cubeDir[4];this.pass.setBlendMode(null==c?ya.None:c);this.render();null!=b&&this.get_engine().popTarget();null!=b&&this.get_engine().pushTarget(b,5,d);this.shader.mat__=this.cubeDir[5];this.pass.setBlendMode(null==c?ya.None:c);this.render();null!=b&&this.get_engine().popTarget();this.shader.texture__=null},__class__:he});var pc=function(a,b){this.defaultSort=(z=new Zh,M(z,z.sort));this.name=a;this.output=new Pf(b)};pc.__name__="h3d.pass.Output";
pc.prototype={get_globals:function(){return this.ctx.globals},setContext:function(a){this.ctx=a},dispose:function(){},processShaders:function(a,b){for(a=this.ctx.extraShaders;null!=a;)b=this.ctx.allocShaderList(a.s,b),a=a.next;return b},setupShaders:function(a){var b=!1;for(a=a.current;null!=a;){var c=a;a=a.next;var d=c.pass.getShadersRec();d=this.processShaders(c,d);c.pass.enableLights&&null!=this.ctx.lightSystem&&(b||(this.ctx.lightSystem.initGlobals(this.ctx.globals),b=!0),d=this.ctx.lightSystem.computeLight(c.obj,
d));c.shader=this.output.compileShaders(this.ctx.globals,d,c.pass.batchMode?Fb.Batch:Fb.Default);c.shaders=d;var e=c.shader.fragment.textures;if(null!=e?15==e.type._hx_index:1)c.texture=0;else{var f=this.ctx,g=!0;null==g&&(g=!1);if(null!=e.perObjectGlobal){g=f.globals.map.h[e.perObjectGlobal.gid];if(null==g)throw t.thrown("Missing global value "+e.perObjectGlobal.path+" for shader "+f.shaderInfo(d,e.perObjectGlobal.path));e=17==e.type._hx_index?g.texture:g}else{for(f=e.instance;0<--f;)d=d.next;f=
d.s.getParamValue(e.index);if(null==f&&!g)throw t.thrown("Missing param value "+y.string(d.s)+"."+e.name);e=f}c.texture=null==e?0:e.id}}},log:function(a){},drawObject:function(a){this.ctx.drawPass=a;this.ctx.engine.selectMaterial(a.pass);a.obj.flags|=65536;a.obj.draw(this.ctx)},draw:function(a,b){if(null!=a.current){this.ctx.setupTarget();this.setupShaders(a);null==b?this.defaultSort(a):b(a);b=this.ctx.shaderBuffers;var c=null;for(a=a.current;null!=a;){var d=a;a=a.next;var e=this.ctx;var f=d.obj.prevAbsPos;
e.globals.map.h[e.globalPreviousModelView_id]=null!=f?f:d.obj.absPos;e=this.ctx;e.globals.map.h[e.globalModelView_id]=d.obj.absPos;d.shader.globals.h.hasOwnProperty(this.ctx.globalModelViewInverse_id)&&(e=this.ctx,f=d.obj.getInvPos(),e.globals.map.h[e.globalModelViewInverse_id]=f);if(c!=d.shader){c=d.shader;if(null!=pc.onShaderError)try{this.ctx.engine.selectShader(d.shader)}catch(g){e=t.caught(g).unwrap();pc.onShaderError(e,d);continue}else this.ctx.engine.selectShader(d.shader);e=d.shader;b.vertex.grow(e.vertex);
null!=e.fragment&&b.fragment.grow(e.fragment);this.ctx.fillGlobals(b,d.shader);this.ctx.engine.uploadShaderBuffers(b,0)}d.pass.dynamicParameters||(this.ctx.fillParams(b,d.shader,d.shaders),this.ctx.engine.uploadShaderBuffers(b,1),this.ctx.engine.uploadShaderBuffers(b,2),this.ctx.engine.uploadShaderBuffers(b,3));this.drawObject(d)}e=this.ctx;e.cachedPos=0;e.drawPass=null}},__class__:pc};var xc=function(a){this.pcfQuality=this.pcfScale=1;this.bias=.01;this.power=30;this.samplingKind=Gc.None;this.size=
1024;this.mode=mb.None;this.enabled=!0;this.updateStatic=!1;null==this.format&&(this.format=J.R16F);ja.CURRENT.driver.isSupportedFormat(this.format)||(this.format=W.nativeFormat);pc.call(this,"shadow",this.getOutputs());this.light=a;this.blur=new $f(5);this.blur.set_quality(.5);a=this.blur.shader;a.constModified=!0;a.isDepth__=this.format==W.nativeFormat};xc.__name__="h3d.pass.Shadows";xc.__super__=pc;xc.prototype=D(pc.prototype,{set_mode:function(a){if(a!=mb.None)throw t.thrown("Shadow mode "+y.string(a)+
" not supported for "+y.string(this.light));return this.mode=a},set_enabled:function(a){return this.enabled=a},set_size:function(a){a!=this.size&&null!=this.staticTexture&&(this.staticTexture.dispose(),this.staticTexture=null);return this.size=a},dispose:function(){pc.prototype.dispose.call(this);this.blur.dispose();null!=this.staticTexture&&this.staticTexture.dispose()},getShadowProj:function(){return this.lightCamera.m},getShadowTex:function(){return null},isUsingWorldDist:function(){return!1},
getOutputs:function(){return this.isUsingWorldDist()?[Sb.Swiz(Sb.Value("output.worldDist",1),[fa.X,fa.X,fa.X,fa.X])]:this.format==W.nativeFormat?[Sb.PackFloat(Sb.Value("output.depth"))]:[Sb.Swiz(Sb.Value("output.depth",1),[fa.X,fa.X,fa.X,fa.X])]},loadStaticData:function(a){return!1},saveStaticData:function(){return null},computeStatic:function(a){throw t.thrown("Not implemented");},needStaticUpdate:function(){switch(this.mode._hx_index){case 1:case 3:this.updateStatic=!0}},createDefaultShadowMap:function(){var a=
W.fromColor(16777215);a.name="defaultShadowMap";return a},syncEarlyExit:function(){this.syncShader(null==this.staticTexture?this.createDefaultShadowMap():this.staticTexture)},syncShader:function(a){},filterPasses:function(a){var b,c;if(this.ctx.computingStatic||this.updateStatic)switch(this.mode._hx_index){case 0:return!1;case 1:var d=c=null;var e=a.discarded;var f=a.lastDisc;for(b=a.current;null!=b;)1==b.pass.isStatic?null==c?c=d=b:d=d.next=b:null==e?e=f=b:f=f.next=b,b=b.next;null!=d&&(d.next=null);
null!=f&&(f.next=null);a.current=c;a.discarded=e;a.lastDisc=f;return!0;case 2:return!1;case 3:d=c=null;e=a.discarded;f=a.lastDisc;for(b=a.current;null!=b;)1==b.pass.isStatic?null==c?c=d=b:d=d.next=b:null==e?e=f=b:f=f.next=b,b=b.next;null!=d&&(d.next=null);null!=f&&(f.next=null);a.current=c;a.discarded=e;a.lastDisc=f;return!0}else switch(this.mode._hx_index){case 0:return!1;case 1:return this.syncEarlyExit(),!1;case 2:return!0;case 3:d=c=null;e=a.discarded;f=a.lastDisc;for(b=a.current;null!=b;)0==
b.pass.isStatic?null==c?c=d=b:d=d.next=b:null==e?e=f=b:f=f.next=b,b=b.next;null!=d&&(d.next=null);null!=f&&(f.next=null);a.current=c;a.discarded=e;a.lastDisc=f;return!0}},cullPasses:function(a,b){for(var c=null,d=!0,e=null,f=null,g=a.discarded,h=a.lastDisc,k=a.current;null!=k;){var l=k.obj.cullingCollider;null==l?l=!0:(l!=c&&(c=l,d=b(l)),l=d);l?null==e?e=f=k:f=f.next=k:null==g?g=h=k:h=h.next=k;k=k.next}null!=f&&(f.next=null);null!=h&&(h.next=null);a.current=e;a.discarded=g;a.lastDisc=h},__class__:xc});
var ef=function(a){this.maxDist=this.minDist=-1;this.autoZPlanes=!1;this.autoShrink=!0;this.mergePass=new sb(new Fd);xc.call(this,a);this.lightCamera=new Tf;this.lightCamera.orthoBounds=new Ka;this.shader=this.dshader=new Ee;this.border=new ag(this.size,this.size)};ef.__name__="h3d.pass.DirShadowMap";ef.__super__=xc;ef.prototype=D(xc.prototype,{set_mode:function(a){var b=this.dshader;b.constModified=!0;b.enable__=a!=mb.None;return this.mode=a},set_enabled:function(a){var b=this.dshader;b.constModified=
!0;b.enable__=a&&this.mode!=mb.None;return this.enabled=a},set_size:function(a){null!=this.border&&this.size!=a&&(this.border.dispose(),this.border=new ag(a,a));return xc.prototype.set_size.call(this,a)},dispose:function(){xc.prototype.dispose.call(this);null!=this.depth&&this.depth.dispose();null!=this.border&&this.border.dispose()},getShadowTex:function(){return this.dshader.shadowMap__},calcShadowBounds:function(a){var b,c=this,d=a.orthoBounds,e=-1E9,f=1E9;if(this.autoShrink){var g=new ca,h=Nb.I(),
k=this.autoZPlanes?new Ka:null;(null!=this.boundingObject?this.boundingObject:this.ctx.scene).iterVisibleMeshes(function(b){if(null!=b.primitive&&b.material.castShadows){var l=b.primitive.getBounds();if(!(l.xMin>l.xMax)){b=b.primitive instanceof Mg?h:b.getAbsPos();c.autoZPlanes&&(k.load(l),k.transform(b),k.zMax>e&&(e=k.zMax),k.zMin<f&&(f=k.zMin));g.multiply3x4(b,a.mcam);var m=l.xMin,n=l.yMin;b=l.zMin;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);var p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);
b=m;m=n;var r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMin;n=l.yMin;b=l.zMax;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=
b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMin;n=l.yMax;b=l.zMin;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMin;n=l.yMax;b=l.zMax;null==
b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMax;n=l.yMin;b=l.zMin;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+
m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMax;n=l.yMin;b=l.zMax;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=
m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMax;n=l.yMax;b=l.zMin;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMax;n=l.yMax;b=l.zMax;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==
n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r)}}})}else this.mode==mb.Dynamic&&(d.xMin=-1E20,d.xMax=1E20,d.yMin=-1E20,d.yMax=1E20,d.zMin=-1E20,d.zMax=1E20);if(this.mode==mb.Dynamic){var l=new Ka;var m=0>this.minDist?this.ctx.camera.zNear:this.minDist;var p=0>this.maxDist?this.ctx.camera.zFar:
this.maxDist;var r=m;var n=c.ctx.camera.unproject(-1,-1,c.ctx.camera.distanceToDepth(r));var u=n.x;var w=n.y;n=n.z;null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);var q=u;var t=w;var v=n;if(c.autoShrink&&c.autoZPlanes){n=c.ctx.camera.pos;u=n.x;w=n.y;n=n.z;null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);var x=n;n=new Mb;n.px=u;n.py=w;n.pz=x;n.lx=q-u;n.ly=t-w;n.lz=v-x;n.normalize();x=e;null==x&&(x=0);var y=b=0;u=1;w=
n.lx*b+n.ly*y+n.lz*u;u=x-(n.px*b+n.py*y+n.pz*u);y=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w;x=1;0<y&&y*x>r*x&&(u=n.px+y*n.lx,w=n.py+y*n.ly,n=n.pz+y*n.lz,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),q=u,t=w,v=n)}w=a.mcam;n=q*w._11+t*w._21+v*w._31+w._41;r=q*w._12+t*w._22+v*w._32+w._42;t=q*w._13+t*w._23+v*w._33+w._43;u=n;w=r;n=t;u<l.xMin&&(l.xMin=u);u>l.xMax&&(l.xMax=u);w<l.yMin&&(l.yMin=w);w>l.yMax&&(l.yMax=w);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);r=
m;n=c.ctx.camera.unproject(-1,1,c.ctx.camera.distanceToDepth(r));u=n.x;w=n.y;n=n.z;null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);q=u;t=w;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,u=n.x,w=n.y,n=n.z,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),x=n,n=new Mb,n.px=u,n.py=w,n.pz=x,n.lx=q-u,n.ly=t-w,n.lz=v-x,n.normalize(),x=e,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),y=1E-10>
(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,x=1,0<y&&y*x>r*x&&(u=n.px+y*n.lx,w=n.py+y*n.ly,n=n.pz+y*n.lz,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),q=u,t=w,v=n));w=a.mcam;n=q*w._11+t*w._21+v*w._31+w._41;r=q*w._12+t*w._22+v*w._32+w._42;t=q*w._13+t*w._23+v*w._33+w._43;u=n;w=r;n=t;u<l.xMin&&(l.xMin=u);u>l.xMax&&(l.xMax=u);w<l.yMin&&(l.yMin=w);w>l.yMax&&(l.yMax=w);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);r=m;n=c.ctx.camera.unproject(1,-1,c.ctx.camera.distanceToDepth(r));
u=n.x;w=n.y;n=n.z;null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);q=u;t=w;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,u=n.x,w=n.y,n=n.z,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),x=n,n=new Mb,n.px=u,n.py=w,n.pz=x,n.lx=q-u,n.ly=t-w,n.lz=v-x,n.normalize(),x=e,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),y=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,x=1,0<y&&y*x>r*x&&(u=n.px+
y*n.lx,w=n.py+y*n.ly,n=n.pz+y*n.lz,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),q=u,t=w,v=n));w=a.mcam;n=q*w._11+t*w._21+v*w._31+w._41;r=q*w._12+t*w._22+v*w._32+w._42;t=q*w._13+t*w._23+v*w._33+w._43;u=n;w=r;n=t;u<l.xMin&&(l.xMin=u);u>l.xMax&&(l.xMax=u);w<l.yMin&&(l.yMin=w);w>l.yMax&&(l.yMax=w);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);r=m;n=c.ctx.camera.unproject(1,1,c.ctx.camera.distanceToDepth(r));u=n.x;w=n.y;n=n.z;null==n&&(n=0);null==w&&(w=0);null==
u&&(u=0);null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);q=u;t=w;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,u=n.x,w=n.y,n=n.z,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),x=n,n=new Mb,n.px=u,n.py=w,n.pz=x,n.lx=q-u,n.ly=t-w,n.lz=v-x,n.normalize(),x=e,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),y=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,x=1,0<y&&y*x>r*x&&(u=n.px+y*n.lx,w=n.py+y*n.ly,n=n.pz+y*n.lz,null==n&&(n=0),null==
w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),q=u,t=w,v=n));w=a.mcam;n=q*w._11+t*w._21+v*w._31+w._41;r=q*w._12+t*w._22+v*w._32+w._42;t=q*w._13+t*w._23+v*w._33+w._43;u=n;w=r;n=t;u<l.xMin&&(l.xMin=u);u>l.xMax&&(l.xMax=u);w<l.yMin&&(l.yMin=w);w>l.yMax&&(l.yMax=w);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);r=p;n=c.ctx.camera.unproject(-1,-1,c.ctx.camera.distanceToDepth(r));u=n.x;w=n.y;n=n.z;null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);
q=u;t=w;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,u=n.x,w=n.y,n=n.z,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),x=n,n=new Mb,n.px=u,n.py=w,n.pz=x,n.lx=q-u,n.ly=t-w,n.lz=v-x,n.normalize(),x=f,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),y=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,x=-1,0<y&&y*x>r*x&&(u=n.px+y*n.lx,w=n.py+y*n.ly,n=n.pz+y*n.lz,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=
0),null==u&&(u=0),q=u,t=w,v=n));w=a.mcam;n=q*w._11+t*w._21+v*w._31+w._41;r=q*w._12+t*w._22+v*w._32+w._42;t=q*w._13+t*w._23+v*w._33+w._43;u=n;w=r;n=t;u<l.xMin&&(l.xMin=u);u>l.xMax&&(l.xMax=u);w<l.yMin&&(l.yMin=w);w>l.yMax&&(l.yMax=w);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);r=p;n=c.ctx.camera.unproject(-1,1,c.ctx.camera.distanceToDepth(r));u=n.x;w=n.y;n=n.z;null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);q=u;t=w;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,
u=n.x,w=n.y,n=n.z,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),x=n,n=new Mb,n.px=u,n.py=w,n.pz=x,n.lx=q-u,n.ly=t-w,n.lz=v-x,n.normalize(),x=f,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),y=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,x=-1,0<y&&y*x>r*x&&(u=n.px+y*n.lx,w=n.py+y*n.ly,n=n.pz+y*n.lz,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),q=u,t=w,v=n));w=a.mcam;n=q*w._11+t*w._21+v*
w._31+w._41;r=q*w._12+t*w._22+v*w._32+w._42;t=q*w._13+t*w._23+v*w._33+w._43;u=n;w=r;n=t;u<l.xMin&&(l.xMin=u);u>l.xMax&&(l.xMax=u);w<l.yMin&&(l.yMin=w);w>l.yMax&&(l.yMax=w);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);r=p;n=c.ctx.camera.unproject(1,-1,c.ctx.camera.distanceToDepth(r));u=n.x;w=n.y;n=n.z;null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);q=u;t=w;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,u=n.x,w=n.y,n=n.z,null==n&&(n=0),null==w&&(w=0),null==
u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),x=n,n=new Mb,n.px=u,n.py=w,n.pz=x,n.lx=q-u,n.ly=t-w,n.lz=v-x,n.normalize(),x=f,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),y=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,x=-1,0<y&&y*x>r*x&&(u=n.px+y*n.lx,w=n.py+y*n.ly,n=n.pz+y*n.lz,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),q=u,t=w,v=n));w=a.mcam;n=q*w._11+t*w._21+v*w._31+w._41;r=q*w._12+t*w._22+v*w._32+w._42;t=q*w._13+
t*w._23+v*w._33+w._43;u=n;w=r;n=t;u<l.xMin&&(l.xMin=u);u>l.xMax&&(l.xMax=u);w<l.yMin&&(l.yMin=w);w>l.yMax&&(l.yMax=w);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);r=p;n=c.ctx.camera.unproject(1,1,c.ctx.camera.distanceToDepth(r));u=n.x;w=n.y;n=n.z;null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);null==n&&(n=0);null==w&&(w=0);null==u&&(u=0);q=u;t=w;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,u=n.x,w=n.y,n=n.z,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),
x=n,n=new Mb,n.px=u,n.py=w,n.pz=x,n.lx=q-u,n.ly=t-w,n.lz=v-x,n.normalize(),x=f,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),y=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,x=-1,0<y&&y*x>r*x&&(u=n.px+y*n.lx,w=n.py+y*n.ly,n=n.pz+y*n.lz,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),q=u,t=w,v=n));w=a.mcam;n=q*w._11+t*w._21+v*w._31+w._41;r=q*w._12+t*w._22+v*w._32+w._42;t=q*w._13+t*w._23+v*w._33+w._43;u=n;w=r;n=t;u<l.xMin&&(l.xMin=u);
u>l.xMax&&(l.xMax=u);w<l.yMin&&(l.yMin=w);w>l.yMax&&(l.yMax=w);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);this.autoShrink?(l.zMin=d.zMin,d.intersection(d,l),this.autoZPlanes&&(n=a.target,x=a.pos,u=n.x-x.x,w=n.y-x.y,n=n.z-x.z,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),q=u,t=w,v=n,x=q*q+t*t+v*v,x=1E-20>x?0:1/Math.sqrt(x),u=q*x,w=t*x,n=v*x,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),p=u,m=w,l=n,v=1E9,n=d.xMin,
r=d.yMin,u=n,w=r,n=d.zMin,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),t=u,q=w,u=n,w=a.getInverseView(),n=t*w._11+q*w._21+u*w._31+w._41,r=t*w._12+q*w._22+u*w._32+w._42,t=t*w._13+q*w._23+u*w._33+w._43,u=n,w=r,n=t,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),t=u,q=w,r=n,n=new Mb,n.px=t,n.py=q,n.pz=r,n.lx=p,n.ly=m,n.lz=l,n.normalize(),x=e,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),
t=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,t<v&&(v=t),n=d.xMin,r=d.yMax,u=n,w=r,n=d.zMin,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),t=u,q=w,u=n,w=a.getInverseView(),n=t*w._11+q*w._21+u*w._31+w._41,r=t*w._12+q*w._22+u*w._32+w._42,t=t*w._13+q*w._23+u*w._33+w._43,u=n,w=r,n=t,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),t=u,q=w,r=n,n=new Mb,n.px=t,n.py=q,n.pz=r,n.lx=p,n.ly=m,n.lz=l,n.normalize(),x=e,null==x&&
(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),t=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,t<v&&(v=t),n=d.xMax,r=d.yMin,u=n,w=r,n=d.zMin,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),t=u,q=w,u=n,w=a.getInverseView(),n=t*w._11+q*w._21+u*w._31+w._41,r=t*w._12+q*w._22+u*w._32+w._42,t=t*w._13+q*w._23+u*w._33+w._43,u=n,w=r,n=t,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),t=u,q=w,r=n,n=new Mb,n.px=
t,n.py=q,n.pz=r,n.lx=p,n.ly=m,n.lz=l,n.normalize(),x=e,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),t=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,t<v&&(v=t),n=d.xMax,r=d.yMax,u=n,w=r,n=d.zMin,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),t=u,q=w,u=n,w=a.getInverseView(),n=t*w._11+q*w._21+u*w._31+w._41,r=t*w._12+q*w._22+u*w._32+w._42,t=t*w._13+q*w._23+u*w._33+w._43,u=n,w=r,n=t,null==n&&(n=0),null==w&&(w=0),null==u&&(u=0),null==
n&&(n=0),null==w&&(w=0),null==u&&(u=0),t=u,q=w,r=n,n=new Mb,n.px=t,n.py=q,n.pz=r,n.lx=p,n.ly=m,n.lz=l,n.normalize(),x=e,null==x&&(x=0),y=b=0,u=1,w=n.lx*b+n.ly*y+n.lz*u,u=x-(n.px*b+n.py*y+n.pz*u),t=1E-10>(0>w?-w:w)?1E-10>(0>u?-u:u)?0:-1:u/w,t<v&&(v=t),d.zMin+=v)):d.load(l)}d.scaleCenter(1.01)},syncShader:function(a){var b=this.dshader;b.constModified=!0;b.shadowMap__=a;b=this.dshader;b.constModified=!0;b.shadowMapChannel__=this.format==W.nativeFormat?lb.PackedFloat:lb.R;this.dshader.shadowBias__=this.bias;
this.dshader.shadowPower__=this.power;this.dshader.shadowProj__=this.getShadowProj();b=this.dshader;b.constModified=!0;b.USE_ESM__=this.samplingKind==Gc.ESM;this.dshader.shadowPower__=this.power;b=this.dshader;b.constModified=!0;b.USE_PCF__=this.samplingKind==Gc.PCF;b=this.dshader.shadowRes__;var c=a.width;a=a.height;null==a&&(a=0);null==c&&(c=0);b.x=c;b.y=a;b.z=0;this.dshader.pcfScale__=this.pcfScale;this.dshader.set_pcfQuality(this.pcfQuality)},saveStaticData:function(){if(this.mode!=mb.Mixed&&
this.mode!=mb.Static)return null;if(null==this.staticTexture)throw t.thrown("Data not computed");var a=Eh.run(this.staticTexture.capturePixels().bytes,9),b=new Id;b.addInt32(this.staticTexture.width);b.addFloat(this.lightCamera.pos.x);b.addFloat(this.lightCamera.pos.y);b.addFloat(this.lightCamera.pos.z);b.addFloat(this.lightCamera.target.x);b.addFloat(this.lightCamera.target.y);b.addFloat(this.lightCamera.target.z);b.addFloat(this.lightCamera.orthoBounds.xMin);b.addFloat(this.lightCamera.orthoBounds.yMin);
b.addFloat(this.lightCamera.orthoBounds.zMin);b.addFloat(this.lightCamera.orthoBounds.xMax);b.addFloat(this.lightCamera.orthoBounds.yMax);b.addFloat(this.lightCamera.orthoBounds.zMax);b.addInt32(a.length);b.add(a);return b.getBytes()},loadStaticData:function(a){if(this.mode!=mb.Mixed&&this.mode!=mb.Static||null==a)return!1;var b=new Vb(a);a=b.readInt32();if(a!=this.size)return!1;this.lightCamera.pos.x=b.readFloat();this.lightCamera.pos.y=b.readFloat();this.lightCamera.pos.z=b.readFloat();this.lightCamera.target.x=
b.readFloat();this.lightCamera.target.y=b.readFloat();this.lightCamera.target.z=b.readFloat();this.lightCamera.orthoBounds.xMin=b.readFloat();this.lightCamera.orthoBounds.yMin=b.readFloat();this.lightCamera.orthoBounds.zMin=b.readFloat();this.lightCamera.orthoBounds.xMax=b.readFloat();this.lightCamera.orthoBounds.yMax=b.readFloat();this.lightCamera.orthoBounds.zMax=b.readFloat();this.lightCamera.update();var c=b.readInt32();b=new ta(a,a,Fh.run(b.read(c)),this.format);null!=this.staticTexture&&this.staticTexture.dispose();
this.staticTexture=new W(a,a,[P.Target],this.format);this.staticTexture.uploadPixels(b);this.staticTexture.name="staticTexture";this.staticTexture.preventAutoDispose();this.syncShader(this.staticTexture);return!0},processShadowMap:function(a,b,c){var d=this.ctx;var e=d.globals.map.h[d.cameraViewProj_id];d=this.ctx;var f=this.getShadowProj();d.globals.map.h[d.cameraViewProj_id]=f;b.isDepth()?(this.ctx.engine.pushDepth(b),this.ctx.engine.clear(null,1)):(this.ctx.engine.pushTarget(b),this.ctx.engine.clear(16777215,
1));xc.prototype.draw.call(this,a,c);d=this.ctx.computingStatic||this.updateStatic;a=0<this.blur.radius&&(this.mode!=mb.Mixed||!d);null==this.border||a||this.border.render();this.ctx.engine.popTarget();this.mode!=mb.Mixed||d||null==this.staticTexture?d=!1:(d=this.staticTexture,d=!(null==d.t&&(d.isDepth()||null==d.realloc)));if(d){if(this.staticTexture.width!=b.width)throw t.thrown("Static shadow map doesnt match dynamic shadow map");d=this.ctx.textures.allocTarget("mergedDirShadowMap",this.size,this.size,
!1,this.format);this.mergePass.shader.texA__=b;this.mergePass.shader.texB__=this.staticTexture;this.ctx.engine.pushTarget(d);this.mergePass.render();this.ctx.engine.popTarget();b=d}a&&(b.isDepth()&&(d=this.ctx.textures.allocTarget("dirShadowMapFloat",this.size,this.size,!1,this.format),oc.run(b,d),b=d),this.blur.apply(this.ctx,b),null!=this.border&&(this.ctx.engine.pushTarget(b),this.border.render(),this.ctx.engine.popTarget()));d=this.ctx;d.globals.map.h[d.cameraViewProj_id]=e;return b},draw:function(a,
b){var c;if(this.enabled&&this.filterPasses(a)){var d=this.ctx.computingStatic||this.updateStatic;if(this.mode!=mb.Mixed||d){var e=this.ctx.camera.target;d=null==this.light?this.ctx.lightSystem.shadowLight:this.light;var f=null==d?null:d.getShadowDirection();if(null==f){d=this.lightCamera.target;var g=c=0;f=-1;null==f&&(f=0);null==g&&(g=0);null==c&&(c=0);d.x=c;d.y=g;d.z=f}else d=this.lightCamera.target,c=f.x,g=f.y,f=f.z,null==f&&(f=0),null==g&&(g=0),null==c&&(c=0),d.x=c,d.y=g,d.z=f,d=this.lightCamera.target,
g=d.x*d.x+d.y*d.y+d.z*d.z,g=1E-20>g?0:1/Math.sqrt(g),d.x*=g,d.y*=g,d.z*=g;this.lightCamera.target.x+=e.x;this.lightCamera.target.y+=e.y;this.lightCamera.target.z+=e.z;d=this.lightCamera.pos;d.x=e.x;d.y=e.y;d.z=e.z;this.lightCamera.update();d=this.lightCamera.orthoBounds;d.xMin=1E20;d.xMax=-1E20;d.yMin=1E20;d.yMax=-1E20;d.zMin=1E20;d.zMax=-1E20;null!=a.current&&this.calcShadowBounds(this.lightCamera);this.lightCamera.update()}e=null;g=!0;f=c=null;for(var h=a.discarded,k=a.lastDisc,l=a.current;null!=
l;)d=l.obj.cullingCollider,null==d?d=!0:(d!=e&&(e=d,g=d.inFrustum(this.lightCamera.frustum)),d=g),d?null==c?c=f=l:f=f.next=l:null==h?h=k=l:k=k.next=l,l=l.next;null!=f&&(f.next=null);null!=k&&(k.next=null);a.current=c;a.discarded=h;a.lastDisc=k;e=this.ctx.textures.allocTarget("dirShadowMap",this.size,this.size,!1,this.format);null!=this.depth&&this.depth.width==this.size&&this.depth.height==this.size?(d=this.depth,d=null==d.t&&(d.isDepth()||null==d.realloc)):d=!0;d&&(null!=this.depth&&this.depth.dispose(),
this.depth=new W(this.size,this.size,null,J.Depth24Stencil8),this.depth.name="dirShadowMapDepth");e.depthBuffer=this.depth;e=this.processShadowMap(a,e,b);this.syncShader(e);this.updateStatic=!1}},computeStatic:function(a){if(this.mode==mb.Static||this.mode==mb.Mixed){this.draw(a);a=this.staticTexture;this.staticTexture=this.dshader.shadowMap__.clone();this.staticTexture.name="StaticDirShadowMap";this.staticTexture.preventAutoDispose();var b=this.dshader;b.constModified=!0;b.shadowMap__=this.staticTexture;
null!=a&&a.dispose()}},drawDebug:function(){null==this.g&&(this.g=new Td(this.ctx.scene),this.g.name="frustumDebug",this.g.material.passes.setPassName("overlay"),this.g.flags|=512);this.debug&&(this.g.clear(),this.drawBounds(this.lightCamera.getInverseViewProj(),16777215))},drawBounds:function(a,b){var c=-1,d=1,e=0;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var f=new G(c,d,e);c=f;d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;var g=c.x*a._13+c.y*a._23+c.z*a._33+a._43,
h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;d=c=1;e=0;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var k=new G(c,d,e);c=k;d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;c=1;d=-1;e=0;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var l=new G(c,d,e);c=l;d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+
c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;d=c=-1;e=0;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var m=new G(c,d,e);c=m;d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;var p=[f,k,l,m];c=-1;e=d=1;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=f=new G(c,d,e);d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;
g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;e=d=c=1;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=k=new G(c,d,e);d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;c=1;d=-1;e=1;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=l=new G(c,d,e);d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;
g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;d=c=-1;e=1;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=m=new G(c,d,e);d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;a=[f,k,l,m];this.g.lineStyle(1,b);b=p[p.length-1];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);for(f=0;f<p.length;)b=
p[f],++f,this.g.lineTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);b=a[a.length-1];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);for(f=0;f<a.length;)b=a[f],++f,this.g.lineTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);b=p[0];f=a[0];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);this.g.lineTo(f.x-this.ctx.scene.x,f.y-this.ctx.scene.y,f.z-this.ctx.scene.z);b=p[1];f=a[1];this.g.moveTo(b.x-this.ctx.scene.x,
b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);this.g.lineTo(f.x-this.ctx.scene.x,f.y-this.ctx.scene.y,f.z-this.ctx.scene.z);b=p[2];f=a[2];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);this.g.lineTo(f.x-this.ctx.scene.x,f.y-this.ctx.scene.y,f.z-this.ctx.scene.z);b=p[3];f=a[3];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);this.g.lineTo(f.x-this.ctx.scene.x,f.y-this.ctx.scene.y,f.z-this.ctx.scene.z)},__class__:ef});var Ng=function(a,b){null==
a&&(a=1024);null!=b&&(this.format=b);ef.call(this,null);this.set_size(a);this.color=new G(0,0,0);this.set_mode(mb.Dynamic);this.shadowMapId=za.allocID("shadow.map");this.shadowProjId=za.allocID("shadow.proj");this.shadowColorId=za.allocID("shadow.color");this.shadowPowerId=za.allocID("shadow.power");this.shadowBiasId=za.allocID("shadow.bias")};Ng.__name__="h3d.pass.DefaultShadowMap";Ng.__super__=ef;Ng.prototype=D(ef.prototype,{draw:function(a,b){ef.prototype.draw.call(this,a,b);this.ctx.globals.map.h[this.shadowMapId]=
{texture:this.dshader.shadowMap__,channel:this.format==W.nativeFormat?lb.PackedFloat:lb.R};a=this.ctx.globals;b=this.shadowProjId;var c=this.getShadowProj();a.map.h[b]=c;this.ctx.globals.map.h[this.shadowColorId]=this.color;this.ctx.globals.map.h[this.shadowPowerId]=this.power;this.ctx.globals.map.h[this.shadowBiasId]=this.bias},__class__:Ng});var Pf=function(a){this.shaderCache=nd.get();this.currentOutput=new Eb(null);this.setOutput(a)};Pf.__name__="h3d.pass.OutputShader";Pf.prototype={setOutput:function(a){null==
a&&(a=[Sb.Value("output.color")]);this.currentOutput.s=this.shaderCache.getLinkShader(a)},compileShaders:function(a,b,c){null==c&&(c=Fb.Default);a.maxChannels=0;for(var d=b;null!=d;){var e=d.s;d=d.next;e.updateConstants(a)}this.currentOutput.next=b;e=this.shaderCache.link(this.currentOutput,c);this.currentOutput.next=null;return e},__class__:Pf};var Og=function(a){this.o=a};Og.__name__="h3d.pass.PassListIterator";Og.prototype={hasNext:function(){return null!=this.o},next:function(){var a=this.o;this.o=
this.o.next;return a},__class__:Og};var Pg=function(a){this.current=a;this.discarded=this.lastDisc=null};Pg.__name__="h3d.pass.PassList";Pg.prototype={init:function(a){this.current=a;this.discarded=this.lastDisc=null},reset:function(){null!=this.discarded&&(this.lastDisc.next=this.current,this.current=this.discarded,this.discarded=this.lastDisc=null)},count:function(){for(var a=this.current,b=0;null!=a;)++b,a=a.next;return b},save:function(){return this.lastDisc},load:function(a){this.lastDisc!=a&&
(this.lastDisc.next=this.current,null==a?(this.current=this.discarded,this.discarded=null):(this.current=a.next,a.next=null),this.lastDisc=a)},isEmpty:function(){return null==this.current},clear:function(){if(null!=this.current){null==this.discarded?this.discarded=this.current:this.lastDisc.next=this.current;for(var a=this.current;null!=a.next;)a=a.next;this.lastDisc=a;this.current=null}},sort:function(a){var b=this.current;if(null==b)a=null;else{for(var c=1,d,e,f,g,h,k,l;;){g=b;l=b=null;for(d=0;null!=
g;){++d;h=g;f=e=0;for(k=c;f<k&&(f++,++e,h=h.next,null!=h););for(f=c;0<e||0<f&&null!=h;)0==e?(k=h,h=h.next,--f):0==f||null==h||0>=a(g,h)?(k=g,g=g.next,--e):(k=h,h=h.next,--f),null!=l?l.next=k:b=k,l=k;g=h}l.next=null;if(1>=d)break;c*=2}a=b}this.current=a},filter:function(a){for(var b=null,c=null,d=this.discarded,e=this.lastDisc,f=this.current;null!=f;)a(f)?null==b?b=c=f:c=c.next=f:null==d?d=e=f:e=e.next=f,f=f.next;null!=c&&(c.next=null);null!=e&&(e.next=null);this.current=b;this.discarded=d;this.lastDisc=
e},iterator:function(){return new Og(this.current)},getFiltered:function(){return new Og(this.discarded)},__class__:Pg};var $h=function(){this.texture=0};$h.__name__="h3d.pass.PassObject";$h.prototype={__class__:$h};var mb=K["h3d.pass.RenderMode"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h3d.pass.RenderMode",toString:v},Static:{_hx_name:"Static",_hx_index:1,__enum__:"h3d.pass.RenderMode",toString:v},Dynamic:{_hx_name:"Dynamic",_hx_index:2,__enum__:"h3d.pass.RenderMode",
toString:v},Mixed:{_hx_name:"Mixed",_hx_index:3,__enum__:"h3d.pass.RenderMode",toString:v}};mb.__constructs__=[mb.None,mb.Static,mb.Dynamic,mb.Mixed];mb.__empty_constructs__=[mb.None,mb.Static,mb.Dynamic,mb.Mixed];var Gc=K["h3d.pass.ShadowSamplingKind"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h3d.pass.ShadowSamplingKind",toString:v},PCF:{_hx_name:"PCF",_hx_index:1,__enum__:"h3d.pass.ShadowSamplingKind",toString:v},ESM:{_hx_name:"ESM",_hx_index:2,__enum__:"h3d.pass.ShadowSamplingKind",
toString:v}};Gc.__constructs__=[Gc.None,Gc.PCF,Gc.ESM];Gc.__empty_constructs__=[Gc.None,Gc.PCF,Gc.ESM];var Zh=function(){this.shaderCount=this.textureCount=1;this.shaderIdMap=[];this.textureIdMap=[]};Zh.__name__="h3d.pass.SortByMaterial";Zh.prototype={sort:function(a){for(var b,c=this.shaderCount,d=this.textureCount,e=a.current;null!=e;){b=e;e=e.next;if(this.shaderIdMap[b.shader.id]<c||null==this.shaderIdMap[b.shader.id])this.shaderIdMap[b.shader.id]=this.shaderCount++;if(this.textureIdMap[b.texture]<
d||null==this.textureIdMap[b.shader.id])this.textureIdMap[b.texture]=this.textureCount++}c=a.current;if(null==c)b=null;else{d=1;for(var f,g,h,k,l;;){b=c;l=c=null;for(e=0;null!=b;){++e;h=b;g=f=0;for(k=d;g<k&&(g++,++f,h=h.next,null!=h););for(g=d;0<f||0<g&&null!=h;)0==f?(k=h,h=h.next,--g):(0!=g&&null!=h?(b.pass.layer!=h.pass.layer?k=b.pass.layer-h.pass.layer:(k=this.shaderIdMap[b.shader.id]-this.shaderIdMap[h.shader.id],k=0!=k?k:this.textureIdMap[b.texture]-this.textureIdMap[h.texture]),k=0>=k):k=!0,
k?(k=b,b=b.next,--f):(k=h,h=h.next,--g)),null!=l?l.next=k:c=k,l=k;b=h}l.next=null;if(1>=e)break;d*=2}b=c}a.current=b},__class__:Zh};var ac=function(a,b){this.isStatic=!0;this.hasTangents=!1;this.bufPos=this.idxPos=this.startIndex=0;bb.call(this);this.format=a;this.buffers=[];this.allIndexes=[];this.bounds=new Ka;this.allocator=b;if(3>a.stride)throw t.thrown("Minimum stride = 3");this.allocPos=Oc.make()};ac.__name__="h3d.prim.BigPrimitive";ac.__super__=bb;ac.prototype=D(bb.prototype,{begin:function(a,
b){var c;this.startIndex=this.bufPos/this.format.stride|0;if(65535<=this.startIndex+a){if(65535<=a)throw t.thrown("Too many vertices in begin()");this.flush()}if(null==this.tmpBuf&&(this.tmpBuf=ac.PREV_BUFFER,null==this.tmpBuf?this.tmpBuf=wd._new(0):ac.PREV_BUFFER=null,this.isStatic)){var d=this.tmpBuf;var e=d.pos;for(c=65535*this.format.stride;e<c;){e++;if(d.pos==d.array.length){var f=d.array.length<<1;128>f&&(f=128);f=new Float32Array(f);f.set(d.array);d.array=f}d.array[d.pos++]=0}}if(!this.isStatic)for(d=
this.tmpBuf,e=d.pos,c=a*this.format.stride+this.bufPos;e<c;)e++,d.pos==d.array.length&&(f=d.array.length<<1,128>f&&(f=128),f=new Float32Array(f),f.set(d.array),d.array=f),d.array[d.pos++]=0;null==this.tmpIdx&&(this.tmpIdx=ac.PREV_INDEX,null==this.tmpIdx?this.tmpIdx=[]:ac.PREV_INDEX=null);if(this.idxPos+b>this.tmpIdx.length){a=0==this.tmpIdx.length?1024:this.tmpIdx.length;for(b=this.idxPos+b;a<b;)a<<=1;for(d=this.tmpIdx;d.length<a;)d.push(0)}},addPoint:function(a,b,c){this.tmpBuf.array[this.bufPos++]=
a;this.tmpBuf.array[this.bufPos++]=b;this.tmpBuf.array[this.bufPos++]=c;var d=this.bounds;a<d.xMin&&(d.xMin=a);a>d.xMax&&(d.xMax=a);b<d.yMin&&(d.yMin=b);b>d.yMax&&(d.yMax=b);c<d.zMin&&(d.zMin=c);c>d.zMax&&(d.zMax=c)},addBounds:function(a,b,c){var d=this.bounds;a<d.xMin&&(d.xMin=a);a>d.xMax&&(d.xMax=a);b<d.yMin&&(d.yMin=b);b>d.yMax&&(d.yMax=b);c<d.zMin&&(d.zMin=c);c>d.zMax&&(d.zMax=c)},addVertexValue:function(a){this.tmpBuf.array[this.bufPos++]=a},addIndex:function(a){this.tmpIdx[this.idxPos++]=a+
this.startIndex},triCount:function(){for(var a=0,b=0,c=this.allIndexes;b<c.length;){var d=c[b];++b;a+=d.vertices}a+=this.idxPos;return a/3|0},vertexCount:function(){for(var a=0,b=0,c=this.buffers;b<c.length;){var d=c[b];++b;a+=d.vertices}return a+=this.bufPos/this.format.stride|0},flush:function(){if(null!=this.tmpBuf){if(0<this.bufPos&&0<this.idxPos){this.flushing=!0;var a=null!=this.allocator?this.allocator.ofSubFloats(this.tmpBuf,this.bufPos/this.format.stride|0,this.format):hc.ofSubFloats(this.tmpBuf,
this.bufPos/this.format.stride|0,this.format);this.buffers.push(a);var b=null!=this.allocator?this.allocator.ofIndexes(this.tmpIdx,this.idxPos):jd.alloc(this.tmpIdx,0,this.idxPos);this.allIndexes.push(b);this.flushing=!1;a.allocPos=this.allocPos;b.allocPos=this.allocPos}if(null==ac.PREV_BUFFER||ac.PREV_BUFFER.pos<this.tmpBuf.pos)ac.PREV_BUFFER=this.tmpBuf;if(null==ac.PREV_INDEX||ac.PREV_INDEX.length<this.tmpIdx.length)ac.PREV_INDEX=this.tmpIdx;this.tmpIdx=this.tmpBuf=null;this.startIndex=this.idxPos=
this.bufPos=0}},render:function(a){null!=this.tmpBuf&&this.flush();for(var b=0,c=this.buffers.length;b<c;){var d=b++;a.renderIndexed(this.buffers[d],this.allIndexes[d])}},getBounds:function(){return this.bounds},dispose:function(){this.clear()},clear:function(){if(this.flushing)throw t.thrown("Cannot clear() BigPrimitive while it's flushing");var a=this.bounds;a.xMin=1E20;a.xMax=-1E20;a.yMin=1E20;a.yMax=-1E20;a.zMin=1E20;a.zMax=-1E20;a=0;for(var b=this.buffers;a<b.length;){var c=b[a];++a;null!=this.allocator?
this.allocator.disposeBuffer(c):c.dispose()}a=0;for(b=this.allIndexes;a<b.length;)c=b[a],++a,null!=this.allocator?this.allocator.disposeIndexBuffer(c):c.dispose();this.buffers=[];this.allIndexes=[];this.idxPos=this.bufPos=0;this.tmpIdx=this.tmpBuf=null},add:function(a,b,c,d,e,f,g,h){null==h&&(h=-1);null==g&&(g=1);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);this.addSub(a,b,0,0,a.pos/(0>h?this.format.stride:h)|0,b.length/3|0,c,d,e,f,g,h)},addSub:function(a,b,c,d,e,f,g,h,k,l,m,p,r,n,
u,w){null==u&&(u=1);null==n&&(n=0);null==r&&(r=0);null==p&&(p=-1);null==m&&(m=1);null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);null==g&&(g=0);0>p&&(p=this.format.stride);if(p<this.format.stride)throw t.thrown("only stride >= "+this.format.stride+" allowed");this.begin(e,3*f);var q=this.startIndex,v=Math.cos(l),x=Math.sin(l),y=this.bufPos,z=this.tmpBuf;for(l=0;l<e;){var A=l++;A=(A+c)*p;var B=a.array[A++],C=a.array[A++],E=a.array[A++];if(null!=w){var D=B;null==E&&(E=0);null==C&&(C=0);null==D&&(D=0);
B=E;null==B&&(B=0);null==C&&(C=0);null==D&&(D=0);E=D;D=C;C=B;B=E*w._12+D*w._22+C*w._32+w._42;var F=E*w._13+D*w._23+C*w._33+w._43;E=E*w._11+D*w._21+C*w._31+w._41;D=B;C=F;z.array[y++]=E;z.array[y++]=D;z.array[y++]=C;B=this.bounds;E<B.xMin&&(B.xMin=E);E>B.xMax&&(B.xMax=E);D<B.yMin&&(B.yMin=D);D>B.yMax&&(B.yMax=D);C<B.zMin&&(B.zMin=C);C>B.zMax&&(B.zMax=C)}else D=g+(B*v-C*x)*m,C=h+(B*x+C*v)*m,E=k+E*m,z.array[y++]=D,z.array[y++]=C,z.array[y++]=E,B=this.bounds,D<B.xMin&&(B.xMin=D),D>B.xMax&&(B.xMax=D),C<
B.yMin&&(B.yMin=C),C>B.yMax&&(B.yMax=C),E<B.zMin&&(B.zMin=E),E>B.zMax&&(B.zMax=E);E=this.format.stride;if(6<=E)if(F=a.array[A++],C=a.array[A++],D=a.array[A++],null!=w){B=F;null==D&&(D=0);null==C&&(C=0);null==B&&(B=0);F=D;null==F&&(F=0);null==C&&(C=0);null==B&&(B=0);D=B;B=F;F=D*w._12+C*w._22+B*w._32;var G=D*w._13+C*w._23+B*w._33;D=D*w._11+C*w._21+B*w._31;C=F;B=G;F=D*D+C*C+B*B;F=1E-20>F?0:1/Math.sqrt(F);D*=F;C*=F;B*=F;z.array[y++]=D;z.array[y++]=C;z.array[y++]=B}else B=F*v-C*x,C=F*x+C*v,z.array[y++]=
B,z.array[y++]=C,z.array[y++]=D;if(this.hasTangents){F=a.array[A++];C=a.array[A++];D=a.array[A++];if(null!=w){B=F;null==D&&(D=0);null==C&&(C=0);null==B&&(B=0);F=D;null==F&&(F=0);null==C&&(C=0);null==B&&(B=0);D=B;B=F;F=D*D+C*C+B*B;G=D*w._12+C*w._22+B*w._32;var H=D*w._13+C*w._23+B*w._33;D=D*w._11+C*w._21+B*w._31;C=G;B=H;G=D*D+C*C+B*B;G=1E-20>G?0:1/Math.sqrt(G);D*=G;C*=G;B*=G;.5>F&&(D*=.5,C*=.5,B*=.5);z.array[y++]=D;z.array[y++]=C;z.array[y++]=B}else B=F*v-C*x,C=F*x+C*v,z.array[y++]=B,z.array[y++]=C,
z.array[y++]=D;E-=3}switch(E){case 3:case 6:continue;case 4:case 7:z.array[y++]=a.array[A++]+r;break;case 5:case 8:case 9:case 10:z.array[y++]=a.array[A++]+r;z.array[y++]=a.array[A++]+n;for(D=8;D<E;)D++,z.array[y++]=a.array[A++];break;default:for(z.array[y++]=a.array[A++]+r,z.array[y++]=a.array[A++]+n,z.array[y++]=a.array[A++]*u,z.array[y++]=a.array[A++]*u,z.array[y++]=a.array[A++]*u,D=11;D<E;)D++,z.array[y++]=a.array[A++]}}this.bufPos=y;q-=c;l=0;for(e=3*f;l<e;)A=l++,a=b[A+3*d]+q,this.tmpIdx[this.idxPos++]=
a},__class__:ac});var ai=function(a){this.shapesBytes=[];this.inputMapping=[];this.hmdModel=a;if(a.get_data().vertexFormat.hasLowPrecision)throw t.thrown("Blend shape doesn't support low precision");a.get_data();var b=a.get_data().vertexFormat;a.get_data();var c=0;var d=0;for(var e=a.lib.header.geometries;d<e.length;){var f=e[d];var g=d++;f==a.get_data()&&(c=g)}g=[];f=0;for(d=a.lib.header.shapes;f<d.length;){var h=d[f];++f;h.geom==c&&g.push(h)}this.shapes=g;this.weights=[];g=0;for(f=this.shapes.length;g<
f;)h=g++,e=this.shapes[h],d=e.vertexCount*e.vertexFormat.strideBytes,h=new S(new ArrayBuffer(d)),a.lib.resource.entry.readBytes(h,0,a.dataPosition+e.vertexPosition,d),d=a.get_data().vertexCount<<2,c=new S(new ArrayBuffer(d)),a.lib.resource.entry.readBytes(c,0,a.dataPosition+e.remapPosition,d),this.shapesBytes.push({vertexBytes:h,remapBytes:c}),this.inputMapping.push(new Sa),this.weights.push(0);d=0;for(e=b.inputs;d<e.length;)for(a=e[d++],g=0,f=this.shapes.length;g<f;){h=g++;c=b=0;for(var k=this.shapes[h].vertexFormat.inputs;c<
k.length;){var l=k[c++];l.name==a.name&&(this.inputMapping[h].h[l.name]=b);l=l.type;b+=l==ka.__cast(9,jc)?1:l}}};ai.__name__="h3d.prim.Blendshape";ai.prototype={setBlendshapeAmount:function(a,b){if(a>=this.weights.length)throw t.thrown("Blendshape at index "+a+" doesn't exist (there is only "+this.weights.length+" blendshapes).");this.weights[a]=b;this.uploadBlendshapeBytes()},getBlendshapeCount:function(){return null==this.hmdModel.lib.header.shapes?0:this.shapes.length},uploadBlendshapeBytes:function(){null!=
this.hmdModel.buffer&&null!=this.hmdModel.buffer.vbuf||this.hmdModel.alloc(ja.CURRENT);var a=65536<this.hmdModel.get_data().vertexCount,b=this.hmdModel.get_data().vertexFormat,c=this.hmdModel.get_data().vertexCount*b.strideBytes,d=new S(new ArrayBuffer(c));this.hmdModel.lib.resource.entry.readBytes(d,0,this.hmdModel.dataPosition+this.hmdModel.get_data().vertexPosition,c);var e=new S(new ArrayBuffer(d.length));e.fill(0,d.length,0);c=0;for(var f=this.shapes.length;c<f;)for(var g=c++,h=this.shapesBytes[g],
k=0,l=0;k<this.shapes[g].indexCount;){for(var m=h.remapBytes.getInt32(l<<2),p=!1;!p;){(p=0!=m>>31)&&(m^=-2147483648);for(var r=0,n=0,u=0,w=this.shapes[g].vertexFormat.inputs;u<w.length;){var q=w[u++],t=0,v=q.type;for(v=v==ka.__cast(9,jc)?1:v;t<v;){var x=t++,y=d.getFloat(m*b.stride+this.inputMapping[g].h[q.name]+x<<2),z=h.vertexBytes.getFloat(k*this.shapes[g].vertexFormat.stride+n+x<<2);y=y+this.weights[g]*(y+z-y)-y;x=m*b.stride+this.inputMapping[g].h[q.name]+x<<2;e.setFloat(x,e.getFloat(x)+y)}q=q.type;
n+=q==ka.__cast(9,jc)?1:q;++r}++l;l<this.hmdModel.get_data().vertexCount&&(m=h.remapBytes.getInt32(l<<2))}++k}b=new S(new ArrayBuffer(d.length));b.blit(0,d,0,d.length);c=0;for(f=e.length/4|0;c<f;)d=c++,b.setFloat(d<<2,b.getFloat(d<<2)+e.getFloat(d<<2));this.hmdModel.buffer.uploadBytes(b,0,this.hmdModel.get_data().vertexCount);this.hmdModel.indexCount=0;this.hmdModel.indexesTriPos=[];c=0;for(f=this.hmdModel.get_data().indexCounts;c<f.length;)d=f[c],++c,this.hmdModel.indexesTriPos.push(this.hmdModel.indexCount/
3|0),this.hmdModel.indexCount+=d;c=(a?4:2)*this.hmdModel.indexCount;b=this.hmdModel.lib.resource.entry.fetchBytes(this.hmdModel.dataPosition+this.hmdModel.get_data().indexPosition,c);this.hmdModel.indexes.uploadBytes(b,0,this.hmdModel.indexCount)},__class__:ai};var bg=function(a,b){this.hmdModel=a;this.data=b};bg.__name__="h3d.prim.Collider";bg.fromHmd=function(a){for(var b=a.lib.header,c=0,d=b.models;c<d.length;){var e=d[c];++c;if(b.geometries[e.geometry]==a.get_data())return new bg(a,b.colliders[e.collider])}return null};
bg.prototype={getBuffers:function(){for(var a=this.hmdModel.dataPosition+this.data.vertexPosition,b=this.hmdModel.dataPosition+this.data.indexPosition,c=[],d=0,e=this.data.vertexCounts.length;d<e;){var f=d++,g=this.data.vertexCounts[f],h=this.data.indexCounts[f],k=65536<g;f=12*g;var l=new S(new ArrayBuffer(f));this.hmdModel.lib.resource.entry.readBytes(l,0,a,f);var m=new Qg;m.vertexes=Array(3*g);var p=0;for(g*=3;p<g;){var r=p++;m.vertexes[r]=l.getFloat(4*r)}l=h*(k?4:2);p=new S(new ArrayBuffer(l));
this.hmdModel.lib.resource.entry.readBytes(p,0,b,l);m.indexes=Array(h);g=k?4:2;if(k)for(k=0;k<h;)r=k++,m.indexes[r]=p.getInt32(r*g);else for(k=0;k<h;)r=k++,m.indexes[r]=p.getUInt16(r*g);c.push(m);a+=f;b+=l}return c},__class__:bg};var Md=function(){bb.call(this)};Md.__name__="h3d.prim.MeshPrimitive";Md.__super__=bb;Md.prototype=D(bb.prototype,{hasInput:function(a){return null!=this.resolveBuffer(a)},resolveBuffer:function(a){if(null!=this.buffers){for(var b=0,c=this.buffers;b<c.length;){var d=c[b];
++b;if(d.format.hasInput(a))return d}return null}return null!=this.buffer&&this.buffer.format.hasInput(a)?this.buffer:null},removeBuffer:function(a){null!=this.buffers?(F.remove(this.buffers,a),a==this.buffer&&(this.buffer=this.buffers[this.buffers.length-1]),1==this.buffers.length&&(this.formats=this.buffers=null)):this.buffer==a&&(this.buffer=null)},addBuffer:function(a){if(null==this.buffer)this.buffer=a;else{if(null==this.buffers){if(a==this.buffer)throw t.thrown("Duplicate addBuffer()");this.buffers=
[this.buffer]}else if(0<=this.buffers.indexOf(a))throw t.thrown("Duplicate addBuffer()");this.buffers.unshift(a);a=[];for(var b=0,c=this.buffers;b<c.length;){var d=c[b];++b;a.push(d.format)}this.formats=Rc.make(a)}},dispose:function(){bb.prototype.dispose.call(this);if(null!=this.buffers){for(var a=0,b=this.buffers;a<b.length;){var c=b[a];++a;c.dispose()}this.formats=this.buffers=null}},render:function(a){null!=this.indexes&&null!=this.indexes.vbuf&&null!=this.buffer&&null!=this.buffer.vbuf||this.alloc(a);
null!=this.buffers?a.renderMultiBuffers(this.formats,this.buffers,this.indexes):a.renderIndexed(this.buffer,this.indexes)},__class__:Md});var Qc=function(a,b){this.translatedX=this.translatedY=this.translatedZ=0;this.scaled=1;bb.call(this);this.points=a;this.idx=b};Qc.__name__="h3d.prim.Polygon";Qc.__super__=Md;Qc.prototype=D(Md.prototype,{getBounds:function(){for(var a=new Ka,b=0,c=this.points;b<c.length;){var d=c[b];++b;d.x<a.xMin&&(a.xMin=d.x);d.x>a.xMax&&(a.xMax=d.x);d.y<a.yMin&&(a.yMin=d.y);
d.y>a.yMax&&(a.yMax=d.y);d.z<a.zMin&&(a.zMin=d.z);d.z>a.zMax&&(a.zMax=d.z)}return a},alloc:function(a){this.dispose();a=N.get_POS3D();null!=this.normals&&(a=a.append("normal",3));null!=this.tangents&&(a=a.append("tangent",3));null!=this.uvs&&(a=a.append("uv",2));null!=this.colors&&(a=a.append("color",3));for(var b=wd._new(0),c=0,d=this.points.length;c<d;){var e=c++,f=this.points[e],g=f.x;if(b.pos==b.array.length){var h=b.array.length<<1;128>h&&(h=128);h=new Float32Array(h);h.set(b.array);b.array=
h}b.array[b.pos++]=g;g=f.y;b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h);b.array[b.pos++]=g;f=f.z;b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g);b.array[b.pos++]=f;null!=this.normals&&(f=this.normals[e],g=f.x,b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h),b.array[b.pos++]=g,g=f.y,b.pos==b.array.length&&(h=b.array.length<<
1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h),b.array[b.pos++]=g,f=f.z,b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=f);null!=this.tangents&&(f=this.tangents[e],g=f.x,b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h),b.array[b.pos++]=g,g=f.y,b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h),
b.array[b.pos++]=g,f=f.z,b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=f);null!=this.uvs&&(f=this.uvs[e],g=f.u,b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h),b.array[b.pos++]=g,f=f.v,b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=f);null!=this.colors&&(e=this.colors[e],f=e.x,b.pos==b.array.length&&
(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=f,f=e.y,b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=f,e=e.z,b.pos==b.array.length&&(f=b.array.length<<1,128>f&&(f=128),f=new Float32Array(f),f.set(b.array),b.array=f),b.array[b.pos++]=e)}this.buffer=hc.ofFloats(b,a);null!=this.idx&&(this.indexes=jd.alloc(this.idx))},unindex:function(){var a;if(null!=this.idx&&this.points.length!=
this.idx.length){var b=[];var c=0;for(a=this.idx.length;c<a;){var d=c++;var e=this.points[this.idx[d]];var f=e.x;d=e.y;e=e.z;null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);b.push(new G(f,d,e))}if(null!=this.normals){var g=[];c=0;for(a=this.idx.length;c<a;)d=c++,e=this.normals[this.idx[d]],f=e.x,d=e.y,e=e.z,null==e&&(e=0),null==d&&(d=0),null==f&&(f=0),g.push(new G(f,d,e));this.normals=g}if(null!=this.tangents){g=[];c=0;for(a=this.idx.length;c<a;)d=c++,e=this.tangents[this.idx[d]],f=e.x,d=e.y,e=e.z,null==
e&&(e=0),null==d&&(d=0),null==f&&(f=0),g.push(new G(f,d,e));this.tangents=g}if(null!=this.colors){g=[];c=0;for(a=this.idx.length;c<a;)d=c++,e=this.colors[this.idx[d]],f=e.x,d=e.y,e=e.z,null==e&&(e=0),null==d&&(d=0),null==f&&(f=0),g.push(new G(f,d,e));this.colors=g}if(null!=this.uvs){g=[];c=0;for(a=this.idx.length;c<a;)d=c++,g.push(this.uvs[this.idx[d]].clone());this.uvs=g}this.points=b;this.idx=null}},translate:function(a,b,c){this.translatedX+=a;this.translatedY+=b;this.translatedZ+=c;for(var d=
0,e=this.points;d<e.length;){var f=e[d];++d;f.x+=a;f.y+=b;f.z+=c}},scale:function(a){this.scaled*=a;for(var b=0,c=this.points;b<c.length;){var d=c[b];++b;d.x*=a;d.y*=a;d.z*=a}},addNormals:function(){this.normals=[];for(var a=0,b=this.points.length;a<b;){var c=a++;this.normals[c]=new G(0,0,0)}a=c=0;for(b=this.triCount();a<b;){a++;if(null==this.idx){++c;var d=c-1;++c;var e=c-1;++c;var f=c-1}else d=this.idx[c++],e=this.idx[c++],f=this.idx[c++];var g=this.points[d],h=this.points[e],k=this.points[f],l=
h.x-g.x,m=h.y-g.y;h=h.z-g.z;null==h&&(h=0);null==m&&(m=0);null==l&&(l=0);var p=m,r=h;null==r&&(r=0);null==p&&(p=0);null==l&&(l=0);m=l;h=p;l=r;r=k.x-g.x;p=k.y-g.y;g=k.z-g.z;null==g&&(g=0);null==p&&(p=0);null==r&&(r=0);k=r;r=g;null==r&&(r=0);null==p&&(p=0);null==k&&(k=0);g=k;k=p;p=h*r-l*k;l=l*g-m*r;m=m*k-h*g;null==m&&(m=0);null==l&&(l=0);null==p&&(p=0);h=p;null==m&&(m=0);null==l&&(l=0);null==h&&(h=0);this.normals[d].x+=h;this.normals[d].y+=l;this.normals[d].z+=m;this.normals[e].x+=h;this.normals[e].y+=
l;this.normals[e].z+=m;this.normals[f].x+=h;this.normals[f].y+=l;this.normals[f].z+=m}a=0;for(b=this.normals;a<b.length;)c=b[a],++a,d=c.x*c.x+c.y*c.y+c.z*c.z,d=1E-20>d?0:1/Math.sqrt(d),c.x*=d,c.y*=d,c.z*=d},addTangents:function(){null==this.normals&&this.addNormals();null==this.uvs&&this.addUVs();this.tangents=[];for(var a=0,b=this.points.length;a<b;){var c=a++;this.tangents[c]=new G(0,0,0)}a=c=0;for(b=this.triCount();a<b;){a++;if(null==this.idx){++c;var d=c-1;++c;var e=c-1;++c;var f=c-1}else d=this.idx[c++],
e=this.idx[c++],f=this.idx[c++];var g=this.points[d],h=this.points[e],k=this.points[f];var l=this.uvs[d];var m=this.uvs[e];var p=this.uvs[f];var r=this.normals[d],n=h.x-g.x;var u=h.y-g.y;h=h.z-g.z;null==h&&(h=0);null==u&&(u=0);null==n&&(n=0);var q=u,t=h;null==t&&(t=0);null==q&&(q=0);null==n&&(n=0);u=n;h=q;n=t;t=k.x-g.x;q=k.y-g.y;g=k.z-g.z;null==g&&(g=0);null==q&&(q=0);null==t&&(t=0);k=t;t=g;null==t&&(t=0);null==q&&(q=0);null==k&&(k=0);g=k;k=q;q=t;p=p.v-l.v;u*=p;h*=p;n*=p;l=m.v-l.v;g*=l;k*=l;q*=l;
l=u-g;m=h-k;p=n-q;null==p&&(p=0);null==m&&(m=0);null==l&&(l=0);l=new G(l,m,p);u=r;p=u.y*l.z-u.z*l.y;m=u.z*l.x-u.x*l.z;l=u.x*l.y-u.y*l.x;null==l&&(l=0);null==m&&(m=0);null==p&&(p=0);u=l;null==u&&(u=0);null==m&&(m=0);null==p&&(p=0);l=p;p=l*l+m*m+u*u;p=1E-20>p?0:1/Math.sqrt(p);l*=p;m*=p;u*=p;p=m*r.z-u*r.y;u=u*r.x-l*r.z;r=l*r.y-m*r.x;null==r&&(r=0);null==u&&(u=0);null==p&&(p=0);r=l=new G(p,u,r);m=r.x*r.x+r.y*r.y+r.z*r.z;m=1E-20>m?0:1/Math.sqrt(m);r.x*=m;r.y*=m;r.z*=m;this.tangents[d].x+=l.x;this.tangents[d].y+=
l.y;this.tangents[d].z+=l.z;this.tangents[e].x+=l.x;this.tangents[e].y+=l.y;this.tangents[e].z+=l.z;this.tangents[f].x+=l.x;this.tangents[f].y+=l.y;this.tangents[f].z+=l.z}a=0;for(b=this.tangents;a<b.length;)l=b[a],++a,u=l,p=u.x*u.x+u.y*u.y+u.z*u.z,p=1E-20>p?0:1/Math.sqrt(p),u.x*=p,u.y*=p,u.z*=p},addUVs:function(){this.uvs=[];for(var a=0,b=this.points.length;a<b;){var c=a++;this.uvs[c]=new Ha(this.points[c].x,this.points[c].y)}},uvScale:function(a,b){if(null==this.uvs)throw t.thrown("Missing UVs");
for(var c=new Cc,d=0,e=this.uvs;d<e.length;){var f=e[d];++d;null==c.h.__keys__[f.__id__]&&(c.set(f,!0),f.u*=a,f.v*=b)}},triCount:function(){var a=Md.prototype.triCount.call(this);return 0!=a?a:(null==this.idx?this.points.length:this.idx.length)/3|0},vertexCount:function(){return this.points.length},getCollider:function(){for(var a=Array(3*this.points.length),b=Array(this.idx.length),c=0,d=0,e=this.points;d<e.length;){var f=e[d];++d;a[c++]=f.x;a[c++]=f.y;a[c++]=f.z}d=0;for(e=this.idx.length;d<e;)c=
d++,b[c]=this.idx[c];d=new zd;d.addBuffers(a,b);return d},render:function(a){null!=this.buffer&&null!=this.buffer.vbuf||this.alloc(a);var b=this.indexes,c=this.triCount();null==b&&(b=a.mem.getTriIndexes(3*c));null!=this.buffers?a.renderMultiBuffers(this.formats,this.buffers,b,0,c):a.renderIndexed(this.buffer,b,0,c)},__class__:Qc});var kd=function(a,b,c,d){null==d&&(d=!1);null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);this.sizeX=a;this.sizeY=b;this.sizeZ=c;var e=0,f=0,g=0;null==g&&(g=0);null==f&&(f=
0);null==e&&(e=0);var h=new G(e,f,g);e=a;g=f=0;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var k=new G(e,f,g);e=0;f=b;g=0;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var l=new G(e,f,g);f=e=0;g=c;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var m=new G(e,f,g);e=a;f=b;g=0;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var p=new G(e,f,g);e=a;f=0;g=c;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var r=new G(e,f,g);e=0;f=b;g=c;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var n=new G(e,f,g);e=a;f=b;g=c;
null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);e=[h,k,l,m,p,r,n,new G(e,f,g)];f=[];f.push(0);f.push(1);f.push(5);f.push(0);f.push(5);f.push(3);f.push(1);f.push(4);f.push(7);f.push(1);f.push(7);f.push(5);f.push(3);f.push(5);f.push(7);f.push(3);f.push(7);f.push(6);f.push(0);f.push(6);f.push(2);f.push(0);f.push(3);f.push(6);f.push(2);f.push(7);f.push(4);f.push(2);f.push(6);f.push(7);f.push(0);f.push(4);f.push(1);f.push(0);f.push(2);f.push(4);Qc.call(this,e,f);d&&this.translate(.5*-a,.5*-b,.5*-c)};kd.__name__=
"h3d.prim.Cube";kd.defaultUnitCube=function(){var a=ja.CURRENT,b=a.resCache.h[kd.__id__];if(null!=b)return b;b=new kd(1,1,1);b.translate(-.5,-.5,-.5);b.unindex();b.addNormals();b.addUniformUVs(1);b.addTangents();a.resCache.set(kd,b);return b};kd.__super__=Qc;kd.prototype=D(Qc.prototype,{addUVs:function(){this.unindex();var a=new Ha(0,1),b=new Ha(1,1),c=new Ha(0,0),d=new Ha(1,0);this.uvs=[b,a,c,b,c,d,b,a,c,b,c,d,b,a,c,b,c,d,a,d,b,a,c,d,a,d,b,a,c,d,a,d,b,a,c,d]},addUniformUVs:function(a){null==a&&(a=
1);this.unindex();this.uvs=[new Ha(a*this.sizeX,a*this.sizeZ),new Ha(0,a*this.sizeZ),new Ha(0,0),new Ha(a*this.sizeX,a*this.sizeZ),new Ha(0,0),new Ha(a*this.sizeX,0),new Ha(a*this.sizeY,a*this.sizeZ),new Ha(0,a*this.sizeZ),new Ha(0,0),new Ha(a*this.sizeY,a*this.sizeZ),new Ha(0,0),new Ha(a*this.sizeY,0),new Ha(a*this.sizeX,a*this.sizeY),new Ha(0,a*this.sizeY),new Ha(0,0),new Ha(a*this.sizeX,a*this.sizeY),new Ha(0,0),new Ha(a*this.sizeX,0),new Ha(0,a*this.sizeZ),new Ha(a*this.sizeY,0),new Ha(a*this.sizeY,
a*this.sizeZ),new Ha(0,a*this.sizeZ),new Ha(0,0),new Ha(a*this.sizeY,0),new Ha(0,a*this.sizeZ),new Ha(a*this.sizeX,0),new Ha(a*this.sizeX,a*this.sizeZ),new Ha(0,a*this.sizeZ),new Ha(0,0),new Ha(a*this.sizeX,0),new Ha(0,a*this.sizeY),new Ha(a*this.sizeX,0),new Ha(a*this.sizeX,a*this.sizeY),new Ha(0,a*this.sizeY),new Ha(0,0),new Ha(a*this.sizeX,0)]},getCollider:function(){var a=this.translatedX,b=this.translatedY,c=this.translatedZ,d=this.sizeX*this.scaled,e=this.sizeY*this.scaled,f=this.sizeZ*this.scaled,
g=new Ka;g.xMin=a;g.yMin=b;g.zMin=c;g.xMax=a+d;g.yMax=b+e;g.zMax=c+f;return g},__class__:kd});var Gd=function(a,b,c,d){this.lodConfig=null;bb.call(this);this.lods=[a];if(null!=d)for(a=0;a<d.length;){var e=d[a];++a;this.lods.push(c.header.geometries[e.geometry])}this.dataPosition=b;this.lib=c;null!=c.header.shapes&&0<c.header.shapes.length&&(this.blendshape=new ai(this));null!=c.header.colliders&&0<c.header.colliders.length&&(this.colliderData=bg.fromHmd(this))};Gd.__name__="h3d.prim.HMDModel";Gd.__super__=
Md;Gd.prototype=D(Md.prototype,{get_data:function(){return this.lods[0]},hasInput:function(a){return Md.prototype.hasInput.call(this,a)?!0:this.get_data().vertexFormat.hasInput(a)},triCount:function(){return this.get_data().get_indexCount()/3|0},vertexCount:function(){return this.get_data().vertexCount},getBounds:function(){return this.get_data().bounds},selectMaterial:function(a,b){this.curMaterial=a+b*this.get_data().indexCounts.length},getMaterialIndexStart:function(a,b){null==b&&(b=0);return 3*
this.indexesTriPos[a+b*this.get_data().indexCounts.length]},getMaterialIndexCount:function(a,b){null==b&&(b=0);return this.lods[b].indexCounts[a]},getDataBuffers:function(a,b,c){return this.lib.getBuffers(this.get_data(),a,b,c)},loadSkin:function(a){this.lib.loadSkin(this.get_data(),a)},alloc:function(a){var b,c;this.dispose();var d=0,e=this.get_data().vertexFormat;this.indexCount=0;this.indexesTriPos=[];var f=0;for(c=this.lods;f<c.length;){var g=c[f];++f;d+=g.vertexCount;var h=0;for(b=g.indexCounts;h<
b.length;)g=b[h],++h,this.indexesTriPos.push(this.indexCount/3|0),this.indexCount+=g}this.buffer=new hc(d,e);d=65536<d;this.indexes=jd._new(this.indexCount,d);for(var k=d?4:2,l=this.lib.resource.entry,m=0,p=0,r=0,n=this.lods;r<n.length;){g=n[r];b=r++;if(g.vertexFormat!=e){a="LOD"+b+" has a different vertex format, has ";d=0;for(g=g.vertexFormat.inputs;d<g.length;)k=g[d++],a+=k.name+" ";a+=", wants ";g=0;for(e=e.inputs;g<e.length;)d=e[g++],a+=d.name+" ";throw t.thrown(a);}b=g.vertexCount*e.strideBytes;
b=l.fetchBytes(this.dataPosition+g.vertexPosition,b);a.driver.uploadBufferBytes(this.buffer,m,g.vertexCount,b,0);var u=g.get_indexCount(),q=65536<g.vertexCount;b=(q?4:2)*u;var v=l.fetchBytes(this.dataPosition+g.indexPosition,b),x=d!=q?new S(new ArrayBuffer(u*k)):v;if(d)for(f=0,c=u;f<c;)b=f++,q?x.setInt32(b<<2,v.getInt32(b<<2)+m):x.setInt32(b<<2,v.getUInt16(b<<1)+m);else for(h=0,b=u;h<b;)c=h++,q?x.setUInt16(c<<1,v.getInt32(c<<2)+m):x.setUInt16(c<<1,v.getUInt16(c<<1)+m);a.driver.uploadBufferBytes(this.indexes,
p,u,x,0);m+=g.vertexCount;p+=u}null!=this.normalsRecomputed&&(e=this.normalsRecomputed,this.normalsRecomputed=null,this.recomputeNormals(e))},recomputeNormals:function(a){if(null==this.normalsRecomputed&&(null==a||!this.get_data().vertexFormat.hasInput(a))){null==a&&(a="normal");for(var b=wd._new(0),c=0,d=this.lods;c<d.length;){var e=d[c];++c;for(var f=this.lib.getBuffers(e,N.get_POS3D()),g=[],h=[],k={},l=0,m=e.vertexCount;l<m;){var p=l++,r=!1,n=f.vertexes[3*p],u=f.vertexes[3*p+1];p=f.vertexes[3*
p+2];var q=10.01*(n+u+p)|0,t=k[q];if(null==t)t=[],k[q]=t;else for(q=0;q<t.length;){var v=t[q];++q;var x=h[v];if(x.x==n&&x.y==u&&x.z==p){g.push(v);r=!0;break}}r||(g.push(h.length),t.push(h.length),r=n,null==p&&(p=0),null==u&&(u=0),null==r&&(r=0),h.push(new G(r,u,p)))}k=[];l=0;for(f=f.indexes;l<f.length;)m=f[l],++l,k.push(g[m]);h=new Qc(h,k);h.addNormals();k=f=b.pos;for(l=3*e.vertexCount;k<l;)k++,b.pos==b.array.length&&(m=b.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(b.array),b.array=
m),b.array[b.pos++]=0;l=k=0;for(e=e.vertexCount;l<e;)m=l++,m=h.normals[g[m]],b.array[f+k++]=m.x,b.array[f+k++]=m.y,b.array[f+k++]=m.z}b=hc.ofFloats(b,N.make([new va(a,3,0)]));this.addBuffer(b);this.normalsRecomputed=a}},addTangents:function(){if(!this.hasInput("tangent")){for(var a=wd._new(0),b=0,c=this.lods;b<c.length;){var d=c[b];++b;for(var e=this.lib.getBuffers(d,N.get_POS3D()),f=[],g=[],h=0,k=d.vertexCount;h<k;){var l=h++,m=!1,p=e.vertexes[3*l],r=e.vertexes[3*l+1];l=e.vertexes[3*l+2];for(var n=
0,u=g.length;n<u;){var q=n++,t=g[q];if(t.x==p&&t.y==r&&t.z==l){f.push(q);m=!0;break}}m||(f.push(g.length),m=p,null==l&&(l=0),null==r&&(r=0),null==m&&(m=0),g.push(new G(m,r,l)))}h=[];k=0;for(e=e.indexes;k<e.length;)r=e[k],++k,h.push(f[r]);g=new Qc(g,h);g.addNormals();g.addTangents();h=e=a.pos;for(k=3*d.vertexCount;h<k;)h++,a.pos==a.array.length&&(r=a.array.length<<1,128>r&&(r=128),r=new Float32Array(r),r.set(a.array),a.array=r),a.array[a.pos++]=0;k=h=0;for(d=d.vertexCount;k<d;)r=k++,r=g.tangents[f[r]],
a.array[e+h++]=r.x,a.array[e+h++]=r.y,a.array[e+h++]=r.z}a=hc.ofFloats(a,N.make([new va("tangent",3,0)]));this.addBuffer(a)}},render:function(a){if(0>this.curMaterial)Md.prototype.render.call(this,a);else{var b=this.get_data().indexCounts.length,c=this.curMaterial/this.get_data().indexCounts.length|0;null!=this.indexes&&null!=this.indexes.vbuf||this.alloc(a);null==this.buffers?a.renderIndexed(this.buffer,this.indexes,this.indexesTriPos[this.curMaterial],this.lods[c].indexCounts[this.curMaterial%b]/
3|0):a.renderMultiBuffers(this.formats,this.buffers,this.indexes,this.indexesTriPos[this.curMaterial],this.lods[c].indexCounts[this.curMaterial%b]/3|0);this.curMaterial=-1}},initCollider:function(a){var b=this.get_data().bounds,c=b.xMax-b.xMin,d=b.yMax-b.yMin,e=b.zMax-b.zMin;b=new ve(.5*(b.xMin+b.xMax),.5*(b.yMin+b.yMax),.5*(b.zMin+b.zMax),.5*Math.sqrt(c*c+d*d+e*e));if(null==this.colliderData){var f=this.lib.getBuffers(this.get_data(),N.get_POS3D());a.setData(f.vertexes,f.indexes);null==this.collider&&
(this.collider=new we(b,a))}else{c=this.colliderData.getBuffers();d=[];d.length=c.length;for(e=0;e<c.length;){f=c[e];var g=e++,h=new xe;h.source=a.source;h.setData(f.vertexes,f.indexes);d[g]=h}a=new pf(d);this.collider=new we(b,a)}},getCollider:function(){if(null!=this.collider)return this.collider;var a=new xe;a.source={entry:this.lib.resource.entry,geometryName:null};for(var b=0,c=this.lib.header.models;b<c.length;){var d=c[b];++b;if(this.lib.header.geometries[d.geometry]==this.get_data()){a.source.geometryName=
d.name;break}}this.initCollider(a);return this.collider},lodCount:function(){return this.lods.length},screenRatioToLod:function(a){var b=this.lodCount();if(0<=this.forcedLod)return a=this.forcedLod,a>b?b:a;if(1==b)return 0;var c=this.getLodConfig();if(null!=c){var d=c.length>b-1;if(d&&a<c[c.length-1])return b;var e=0,f=0;for(b=d?b-1:c.length;f<b;){d=f++;if(0==c[d])break;if(c[d]>a)++e;else break}return e}return 0},getLodConfig:function(){if(null!=this.lodConfig)return this.lodConfig;var a=this.lib.resource.entry.get_directory();
0>a.indexOf("res/")&&(a="res/"+a);return this.lodConfig=nb.current.getDefaultLodConfig(a)},__class__:Gd});var Mg=function(){bb.call(this);var a=this.bounds=new Ka;0<a.xMin&&(a.xMin=0);0>a.xMax&&(a.xMax=0);0<a.yMin&&(a.yMin=0);0>a.yMax&&(a.yMax=0);0<a.zMin&&(a.zMin=0);0>a.zMax&&(a.zMax=0);this.tmpBounds=new Ka};Mg.__name__="h3d.prim.Instanced";Mg.__super__=bb;Mg.prototype=D(bb.prototype,{setMesh:function(a){0<this.refCount&&(null!=this.primitive&&this.primitive.decref(),a.incref());this.primitive=
a;this.baseBounds=a.getBounds();null!=a.buffer&&null!=a.indexes||a.alloc(ja.CURRENT)},initBounds:function(){var a=this.bounds;a.xMin=1E20;a.xMax=-1E20;a.yMin=1E20;a.yMax=-1E20;a.zMin=1E20;a.zMax=-1E20},addInstanceBounds:function(a){this.tmpBounds.load(this.baseBounds);this.tmpBounds.transform(a);a=this.bounds;var b=this.tmpBounds;b.xMin<a.xMin&&(a.xMin=b.xMin);b.xMax>a.xMax&&(a.xMax=b.xMax);b.yMin<a.yMin&&(a.yMin=b.yMin);b.yMax>a.yMax&&(a.yMax=b.yMax);b.zMin<a.zMin&&(a.zMin=b.zMin);b.zMax>a.zMax&&
(a.zMax=b.zMax)},dispose:function(){},incref:function(){0==this.refCount&&null!=this.primitive&&this.primitive.incref();bb.prototype.incref.call(this)},decref:function(){bb.prototype.decref.call(this);0==this.refCount&&null!=this.primitive&&this.primitive.decref()},getBounds:function(){return this.bounds},screenRatioToLod:function(a){return this.primitive.screenRatioToLod(a)},setCommand:function(a,b,c){b>this.primitive.lodCount()-1?this.commands.setCommand(0,0,0):this.commands.setCommand(c,this.primitive.getMaterialIndexCount(a,
b),this.primitive.getMaterialIndexStart(a,b))},render:function(a){null!=this.primitive.buffer&&null!=this.primitive.buffer.vbuf||this.primitive.alloc(a);a.needFlushTarget&&a.doFlushTarget();null==this.primitive.buffers?a.driver.selectBuffer(this.primitive.buffer):a.driver.selectMultiBuffers(this.primitive.formats,this.primitive.buffers);var b=this.primitive.indexes;null==b&&(b=a.mem.getTriIndexes(3*this.triCount()));a.renderInstanced(b,this.commands)},__class__:Mg});var nb=function(){};nb.__name__=
"h3d.prim.ModelDatabase";nb.customizeLodConfig=function(a){return a};nb.prototype={get_baseDir:function(){return""},getFilePath:function(a){return null==a||""==a?nb.FILE_NAME:a+"/"+nb.FILE_NAME},getRootData:function(a){if(null==a)return null;var b=nb.db.h[a];if(null!=b)return b;b=this.getFilePath(a);try{var c=JSON.parse(md.currentInstance.load(b).toText())}catch(d){if(t.caught(d).unwrap()instanceof Yf)c={};else throw d;}return nb.db.h[a]=c},getModelData:function(a,b,c){b=b+"/"+c;a=this.getRootData(a);
this.cleanOldModelData(a,b);return sa.field(a,b)},saveModelData:function(a,b,c,d){var e=this.getFilePath(a);a=this.getRootData(a);b=b+"/"+c;null==d||0==sa.fields(d).length?sa.deleteField(a,b):a[b]=d;throw t.thrown("Can't save model props database "+e);},getDefaultLodConfig:function(a){a=nb.baseLodConfig;return a=nb.customizeLodConfig(a)},cleanOldModelData:function(a,b){var c=sa.field(a,nb.LOD_CONFIG);if(null!=c){for(var d=0,e=sa.fields(c);d<e.length;){var f=e[d];++d;if(!(0>b.indexOf(f))){var g={lodConfig:sa.field(c,
f)};a[b]=g;sa.deleteField(c,f);a[nb.LOD_CONFIG]=c}}null!=c&&0!=sa.fields(c).length||sa.deleteField(a,nb.LOD_CONFIG)}},loadLodConfig:function(a,b){b=sa.field(b,nb.LOD_CONFIG);null!=b&&null!=a.hmd&&(a.hmd.lodConfig=b)},loadDynamicBonesConfig:function(a,b){b=sa.field(b,nb.DYN_BONES_CONFIG);if(null!=b&&null!=a.skin){for(var c=a.skin.getSkinData(),d=0,e=c.allJoints;d<e.length;){var f=e[d];++d;a:{for(var g=0;g<b.length;){var h=b[g];++g;if(h.name==f.name)break a}h=null}if(null!=h){g=new Sd;g.index=f.index;
g.name=f.name;g.bindIndex=f.bindIndex;g.splitIndex=f.splitIndex;g.defMat=f.defMat;g.transPos=f.transPos;g.parent=f.parent;g.follow=f.follow;g.subs=f.subs;g.offsets=f.offsets;g.offsetRay=f.offsetRay;g.retargetAnim=f.retargetAnim;g.damping=h.damping;g.resistance=h.resistance;g.slackness=h.slackness;g.stiffness=h.stiffness;g.additive=h.additive;var k;if(null==h.lockAxis)var l=k=0,m=0;else k=h.lockAxis,k=null!=k?k.x:null,l=h.lockAxis,l=null!=l?l.y:null,m=h.lockAxis,m=null!=m?m.z:null;null==m&&(m=0);null==
l&&(l=0);null==k&&(k=0);k=new G(k,l,m);g.lockAxis=k;k=h.globalForce.x;l=h.globalForce.y;h=h.globalForce.z;null==h&&(h=0);null==l&&(l=0);null==k&&(k=0);g.globalForce=new G(k,l,h);c.allJoints[f.index]=g;h=f.parent;null!=h&&h.subs.push(g);h=f.parent;null!=h&&F.remove(h.subs,f);if(null!=g.subs)for(f=0,h=g.subs;f<h.length;)k=h[f],++f,k.parent=g}}a.skin.setSkinData(c)}},saveLodConfig:function(a,b){var c,d=!0,e=this.getDefaultLodConfig(a.resourceDirectory);if(null!=a.hmd.lodConfig){e.length!=a.hmd.lodConfig.length&&
(d=!1);var f=0;for(c=a.hmd.lodConfig.length;f<c;){var g=f++;if(e[g]!=a.hmd.lodConfig[g]){d=!1;break}}}if(d)sa.deleteField(b,nb.LOD_CONFIG);else{d=[];f=0;for(c=a.hmd.lodCount();f<c;)g=f++,d[g]=g>=a.hmd.lodConfig.length?0:a.hmd.lodConfig[g];b[nb.LOD_CONFIG]=d}},saveDynamicBonesConfig:function(a,b){if(null!=a.skin){var c=[],d=0;for(a=a.skin.getSkinData().allJoints;d<a.length;){var e=a[d];++d;e=e instanceof Sd?e:null;null!=e&&c.push({name:e.name,slackness:e.slackness,stiffness:e.stiffness,resistance:e.resistance,
damping:e.damping,additive:e.additive,globalForce:e.globalForce,lockAxis:e.lockAxis})}0==c.length?sa.deleteField(b,nb.DYN_BONES_CONFIG):b[nb.DYN_BONES_CONFIG]=c}},loadModelProps:function(a){var b=this.getModelData(a.resourceDirectory,a.resourceName,a.objectName);null!=b&&(this.loadLodConfig(a,b),this.loadDynamicBonesConfig(a,b))},saveModelProps:function(a){var b=this.getModelData(a.resourceDirectory,a.resourceName,a.objectName);null==b&&(b={});this.saveLodConfig(a,b);this.saveDynamicBonesConfig(a,
b);this.saveModelData(a.resourceDirectory,a.resourceName,a.objectName,b)},__class__:nb};var Be=function(){bb.call(this)};Be.__name__="h3d.prim.Plane2D";Be.get=function(){var a=ja.CURRENT,b=a.resCache.h[Be.__id__];null==b&&(b=new Be,a.resCache.set(Be,b));return b};Be.__super__=bb;Be.prototype=D(bb.prototype,{triCount:function(){return 2},vertexCount:function(){return 4},alloc:function(a){a=wd._new(0);if(a.pos==a.array.length){var b=a.array.length<<1;128>b&&(b=128);b=new Float32Array(b);b.set(a.array);
a.array=b}a.array[a.pos++]=-1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=-1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=0;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),
a.array=b);a.array[a.pos++]=-1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=0;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=0;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),
a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=-1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),
a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=0;this.buffer=hc.ofFloats(a,N.get_XY_UV())},render:function(a){null!=this.buffer&&null!=this.buffer.vbuf||
this.alloc(a);var b=this.buffer;a.renderBuffer(b,a.mem.getQuadIndexes(b.vertices),2,0,-1)},__class__:Be});var Lg=function(a,b){null==b&&(b=!1);bb.call(this);this.onContextLost=function(){return a};this.bounds=a.bounds;this.alloc(null);b||(this.onContextLost=null)};Lg.__name__="h3d.prim.RawPrimitive";Lg.__super__=bb;Lg.prototype=D(bb.prototype,{alloc:function(a){if(null==this.onContextLost)throw t.thrown("Cannot realloc "+y.string(this));a=this.onContextLost();this.buffer=hc.ofFloats(a.vbuf,a.format);
this.vcount=this.buffer.vertices;this.tcount=null!=a.ibuf?a.ibuf.length/3|0:this.vcount/3|0;null!=a.ibuf?this.indexes=jd.alloc(a.ibuf):null!=this.indexes&&(this.indexes.dispose(),this.indexes=null)},getBounds:function(){if(null==this.bounds)throw t.thrown("Bounds not defined for "+y.string(this));return this.bounds},triCount:function(){return this.tcount},vertexCount:function(){return this.vcount},__class__:Lg});var ge=function(a,b,c,d){var e;null==d&&(d=1);null==c&&(c=6);null==b&&(b=8);null==a&&
(a=1);this.ray=a;this.segsH=c;this.segsW=b;this.portion=d;for(var f=2*Math.PI/b,g=[],h=[],k=0,l=c+1;k<l;){var m=k++;var p=m/c*Math.PI*d;m=Math.sin(p);var r=Math.cos(p);var n=e=0;for(p=b+1;n<p;){n++;var u=m*Math.cos(e)*a,q=m*Math.sin(e)*a,t=r*a;null==t&&(t=0);null==q&&(q=0);null==u&&(u=0);g.push(new G(u,q,t));e+=f}}k=0;for(l=c;k<l;)for(m=k++,n=0,p=b;n<p;)if(e=n++,a=e+1+m*(b+1),f=e+m*(b+1),r=e+(m+1)*(b+1),e=e+1+(m+1)*(b+1),0!=m&&(h.push(a),h.push(f),h.push(e)),m!=c-1||1!=d)h.push(f),h.push(r),h.push(e);
Qc.call(this,g,h)};ge.__name__="h3d.prim.Sphere";ge.defaultUnitSphere=function(){var a=ja.CURRENT,b=a.resCache.h[ge.__id__];if(null!=b)return b;b=new ge(1,16,16);b.addNormals();b.addUVs();a.resCache.set(ge,b);return b};ge.__super__=Qc;ge.prototype=D(Qc.prototype,{getCollider:function(){return new ve(this.translatedX,this.translatedY,this.translatedZ,this.ray*this.scaled)},addNormals:function(){this.normals=this.points},addUVs:function(){this.uvs=[];for(var a=0,b=this.segsH+1;a<b;)for(var c=a++,d=
0,e=this.segsW+1;d<e;){var f=d++;this.uvs.push(new Ha(1-f/this.segsW,c/this.segsH))}},__class__:ge});var Ha=function(a,b){this.u=a;this.v=b};Ha.__name__="h3d.prim.UV";Ha.prototype={clone:function(){return new Ha(this.u,this.v)},toString:function(){return"{"+T.fmt(this.u)+","+T.fmt(this.v)+"}"},__class__:Ha};var Ra=function(a,b,c){this.curScreenRatio=1;this.inheritLod=!1;Aa.call(this,c);this.set_primitive(a);null==b&&(b=Ld.current.createMaterial(),b.set_props(b.getDefaultProps()));this.material=b};
Ra.__name__="h3d.scene.Mesh";Ra.screenRatio=function(a,b,c){var d=a;var e=d._41;var f=d._42;var g=d._43;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var h=e;var k=f;var l=g;d=a;a=Math.sqrt(d._11*d._11+d._12*d._12+d._13*d._13);var m=Math.sqrt(d._21*d._21+d._22*d._22+d._23*d._23);f=Math.sqrt(d._31*d._31+d._32*d._32+d._33*d._33);0>d._11*(d._22*d._33-d._23*d._32)+d._12*(d._23*d._31-d._21*d._33)+d._13*(d._21*d._32-d._22*d._31)&&(a*=-1,m*=-1,f*=-1);e=b.xMax-b.xMin;d=b.yMax-b.yMin;g=b.zMax-b.zMin;b=d<g?
g:d;d=a;a=m;g=f;f=a<g?g:a;b=(e<b?b:e)*(d<f?f:d)/2;null==c.directions&&(c.directions=new ca,c.directions._44=0);0==c.directions._44&&c.calcDirections();e=c.directions._21;f=c.directions._22;d=c.directions._23;null==c.directions&&(c.directions=new ca,c.directions._44=0);0==c.directions._44&&c.calcDirections();g=c.directions._31;m=c.directions._32;a=c.directions._33;e=g-e;f=m-f;g=a-d;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);e=m;f=a;a=e*e+f*
f+d*d;a=1E-20>a?0:1/Math.sqrt(a);e*=a;f*=a;g=d*a;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);var p=m,r=a,n=d;e=p*b;f=r*b;g=n*b;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);e=h+m;f=k+a;g=l+d;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);var u=m,q=a,t=d;e=p*b;f=r*b;g=n*b;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==
d&&(d=0);null==a&&(a=0);null==m&&(m=0);e=h-m;f=k-a;g=l-d;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);h=!1;null==h&&(h=!0);e=u;f=q;g=t;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);l=e;k=f;b=c.m;e=l*b._11+k*b._21+g*b._31+b._41;f=l*b._12+k*b._22+g*b._32+b._42;b=1/(l*b._14+k*b._24+g*b._34+b._44);l=.5*(e*b+1);k=.5*(-(f*b)+1);h&&(l=Math.round(l),k=Math.round(k));h=!1;null==h&&(h=!0);e=m;f=a;g=d;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);d=e;a=
f;m=g;b=c.m;e=d*b._11+a*b._21+m*b._31+b._41;f=d*b._12+a*b._22+m*b._32+b._42;b=1/(d*b._14+a*b._24+m*b._34+b._44);d=.5*(e*b+1);a=.5*(-(f*b)+1);h&&(d=Math.round(d),a=Math.round(a));e=d-l;g=a-k;c=e<g?g:e;return c*c};Ra.__super__=Aa;Ra.prototype=D(Aa.prototype,{getMeshMaterials:function(){return[this.material]},addBoundsRec:function(a,b){Aa.prototype.addBoundsRec.call(this,a,b);if(null!=this.primitive&&0==(this.flags&512)){var c=this.primitive.getBounds();if(null==b)var d=this.absPos;else Ra.tmpMat.multiply(this.absPos,
b),d=Ra.tmpMat;b=new Ka;b.xMin=c.xMin;b.xMax=c.xMax;b.yMin=c.yMin;b.yMax=c.yMax;b.zMin=c.zMin;b.zMax=c.zMax;b.transform(d);b.xMin<a.xMin&&(a.xMin=b.xMin);b.xMax>a.xMax&&(a.xMax=b.xMax);b.yMin<a.yMin&&(a.yMin=b.yMin);b.yMax>a.yMax&&(a.yMax=b.yMax);b.zMin<a.zMin&&(a.zMin=b.zMin);b.zMax>a.zMax&&(a.zMax=b.zMax)}},clone:function(a){a=null==a?new Ra(null,this.material):a;a.set_primitive(this.primitive);a.material=this.material.clone();Aa.prototype.clone.call(this,a);return a},getLocalCollider:function(){return this.primitive.getCollider()},
draw:function(a){this.primitive.selectMaterial(0,this.primitive.screenRatioToLod(this.curScreenRatio));this.primitive.render(a.engine)},calcScreenRatio:function(a){if(null!=this.primitive&&1!=this.primitive.lodCount())if(0<=a.forcedScreenRatio)this.curScreenRatio=a.forcedScreenRatio;else{var b=this.primitive.getBounds();null==b?this.curScreenRatio=1:(this.curScreenRatio=Ra.screenRatio(this.getAbsPos(),b,a.camera),this.inheritLod&&(a.forcedScreenRatio=this.curScreenRatio))}},emit:function(a){this.calcScreenRatio(a);
if(!(this.primitive.screenRatioToLod(this.curScreenRatio)>=this.primitive.lodCount()))for(var b=this.material.passes;null!=b;)b.culled||(a.emitPass(b,this).index=0),b=b.nextPass},getMaterialByName:function(a){return null!=this.material&&this.material.name==a?this.material:Aa.prototype.getMaterialByName.call(this,a)},getMaterials:function(a,b){null==b&&(b=!0);null==a&&(a=[]);null!=this.material&&0>a.indexOf(this.material)&&a.push(this.material);return Aa.prototype.getMaterials.call(this,a,b)},onAdd:function(){Aa.prototype.onAdd.call(this);
null!=this.primitive&&this.primitive.incref()},onRemove:function(){null!=this.primitive&&this.primitive.decref();Aa.prototype.onRemove.call(this)},set_primitive:function(a){a!=this.primitive&&0!=(this.flags&32)&&(null!=this.primitive&&this.primitive.decref(),null!=a&&a.incref());return this.primitive=a},__class__:Ra});var Td=function(a){this.curX=this.curY=this.curZ=this.curR=this.lineSize=0;this.bprim=new ac(N.get_POS3D_NORMAL_UV_RGBA());this.bprim.isStatic=!1;Ra.call(this,this.bprim,null,a);this.tmpPoints=
[];this.lineShader=new Fe;this.lineShader.setPriority(-100);a=this.material;a.set_castShadows(!1);a.set_receiveShadows(!1);this.material.passes.set_enableLights(!1);this.material.passes.addShader(this.lineShader);a=new ff;a.setPriority(-100);this.material.passes.addShader(a);this.material.passes.set_culling(gc.None)};Td.__name__="h3d.scene.Graphics";Td.__super__=Ra;Td.prototype=D(Ra.prototype,{onRemove:function(){Ra.prototype.onRemove.call(this);this.bprim.clear()},set_is3D:function(a){if(this.is3D==
a)return a;a?(this.material.set_texture(W.fromColor(-1)),this.material.passes.removeShader(this.lineShader)):(this.material.set_texture(null),this.material.passes.addShader(this.lineShader));this.bprim.clear();this.tmpPoints=[];return this.is3D=a},flushLine:function(){var a=this.tmpPoints,b=a.length-1,c=a[b],d=a[0],e=d.x==c.x&&d.y==c.y&&d.z==c.z,f=a.length;if(e)d!=c&&(--f,--b,c=a[b]);else{var g=a[b-1];null==g&&(g=d);a.push(new uf(2*c.x-g.x,2*c.y-g.y,2*c.z-g.z,0,0,0,0));g=a[1];null==g&&(g=d);c=new uf(2*
d.x-g.x,2*d.y-g.y,2*d.z-g.z,0,0,0,0)}for(var h=g=this.bprim.vertexCount(),k=0,l=0,m=f;l<m;){var p=l++,r=a[(p+1)%a.length],n=c.y-d.y,u=d.x-c.x,q=1/Math.sqrt(n*n+u*u);c=d.y-r.y;var t=r.x-d.x,v=1/Math.sqrt(c*c+t*t);c=n*q+c*v;t=u*q+t*v;v=1/Math.sqrt(c*c+t*t);c*=v;t*=v;n=.5*this.lineSize/(c*n*q+t*u*q);c*=n;t*=n;n=p<f-1||e;this.bprim.begin(2,n?6:0);u=this.bprim;u.tmpBuf.array[u.bufPos++]=d.x+c;u=this.bprim;u.tmpBuf.array[u.bufPos++]=d.y+t;u=this.bprim;u.tmpBuf.array[u.bufPos++]=d.z;u=this.bprim;u.tmpBuf.array[u.bufPos++]=
0;u=this.bprim;u.tmpBuf.array[u.bufPos++]=0;u=this.bprim;u.tmpBuf.array[u.bufPos++]=1;u=this.bprim;u.tmpBuf.array[u.bufPos++]=0;u=this.bprim;u.tmpBuf.array[u.bufPos++]=k;u=this.bprim;u.tmpBuf.array[u.bufPos++]=d.r;u=this.bprim;u.tmpBuf.array[u.bufPos++]=d.g;u=this.bprim;u.tmpBuf.array[u.bufPos++]=d.b;u=this.bprim;u.tmpBuf.array[u.bufPos++]=d.a;u=this.bprim;u.tmpBuf.array[u.bufPos++]=d.x-c;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.y-t;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.z;c=this.bprim;c.tmpBuf.array[c.bufPos++]=
0;c=this.bprim;c.tmpBuf.array[c.bufPos++]=0;c=this.bprim;c.tmpBuf.array[c.bufPos++]=1;c=this.bprim;c.tmpBuf.array[c.bufPos++]=1;c=this.bprim;c.tmpBuf.array[c.bufPos++]=k;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.r;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.g;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.b;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.a;k=1-k;n&&(p=p==b?g-h:2,n=this.bprim,n.tmpIdx[n.idxPos++]=n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=1+n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=p+
n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=p+n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=1+n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=p+1+n.startIndex);h+=2;c=d;d=r}},flush:function(){0!=this.tmpPoints.length&&this.is3D&&(this.flushLine(),this.tmpPoints=[])},sync:function(a){Ra.prototype.sync.call(this,a);this.flush();this.bprim.flush()},draw:function(a){this.flush();this.bprim.flush();Ra.prototype.draw.call(this,a)},clear:function(){this.flush();this.bprim.clear()},lineStyle:function(a,
b,c){null==c&&(c=1);null==b&&(b=0);null==a&&(a=0);this.flush();0<a&&this.lineSize!=a&&(this.lineSize=a,this.is3D||(this.lineShader.width__=this.lineSize));this.setColor(b,c)},setColorF:function(a,b,c,d){null==d&&(d=1);this.curA=d;this.curR=a;this.curG=b;this.curB=c},setColor:function(a,b){null==b&&(b=1);this.curA=b;this.curR=(a>>16&255)/255;this.curG=(a>>8&255)/255;this.curB=(a&255)/255},drawLine:function(a,b){this.moveTo(a.x,a.y,a.z);this.lineTo(b.x,b.y,b.z)},moveTo:function(a,b,c){this.is3D?(this.flush(),
this.lineTo(a,b,c)):(this.curX=a,this.curY=b,this.curZ=c)},addVertex:function(a,b,c,d,e,f,g){this.tmpPoints.push(new uf(a,b,c,d,e,f,g))},lineTo:function(a,b,c){if(this.is3D){var d=this.curX;var e=this.curY;var f=this.curZ;var g=this.bprim.bounds;d<g.xMin&&(g.xMin=d);d>g.xMax&&(g.xMax=d);e<g.yMin&&(g.yMin=e);e>g.yMax&&(g.yMax=e);f<g.zMin&&(g.zMin=f);f>g.zMax&&(g.zMax=f);g=this.bprim.bounds;a<g.xMin&&(g.xMin=a);a>g.xMax&&(g.xMax=a);b<g.yMin&&(g.yMin=b);b>g.yMax&&(g.yMax=b);c<g.zMin&&(g.zMin=c);c>g.zMax&&
(g.zMax=c);this.tmpPoints.push(new uf(a,b,c,this.curR,this.curG,this.curB,this.curA))}else{this.bprim.begin(4,6);var h=a-this.curX,k=b-this.curY,l=c-this.curZ;d=this.curX;e=this.curY;f=this.curZ;g=this.bprim.bounds;d<g.xMin&&(g.xMin=d);d>g.xMax&&(g.xMax=d);e<g.yMin&&(g.yMin=e);e>g.yMax&&(g.yMax=e);f<g.zMin&&(g.zMin=f);f>g.zMax&&(g.zMax=f);g=this.bprim.bounds;a<g.xMin&&(g.xMin=a);a>g.xMax&&(g.xMax=a);b<g.yMin&&(g.yMin=b);b>g.yMax&&(g.yMax=b);c<g.zMin&&(g.zMin=c);c>g.zMax&&(g.zMax=c);g=this.bprim;g.tmpBuf.array[g.bufPos++]=
this.curX;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curY;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curZ;g=this.bprim;g.tmpBuf.array[g.bufPos++]=h;g=this.bprim;g.tmpBuf.array[g.bufPos++]=k;g=this.bprim;g.tmpBuf.array[g.bufPos++]=l;g=this.bprim;g.tmpBuf.array[g.bufPos++]=0;g=this.bprim;g.tmpBuf.array[g.bufPos++]=0;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curR;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curG;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curB;g=this.bprim;g.tmpBuf.array[g.bufPos++]=
this.curA;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curX;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curY;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curZ;g=this.bprim;g.tmpBuf.array[g.bufPos++]=h;g=this.bprim;g.tmpBuf.array[g.bufPos++]=k;g=this.bprim;g.tmpBuf.array[g.bufPos++]=l;g=this.bprim;g.tmpBuf.array[g.bufPos++]=0;g=this.bprim;g.tmpBuf.array[g.bufPos++]=1;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curR;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curG;g=this.bprim;g.tmpBuf.array[g.bufPos++]=
this.curB;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curA;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curX;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curY;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curZ;g=this.bprim;g.tmpBuf.array[g.bufPos++]=h;g=this.bprim;g.tmpBuf.array[g.bufPos++]=k;g=this.bprim;g.tmpBuf.array[g.bufPos++]=l;g=this.bprim;g.tmpBuf.array[g.bufPos++]=1;g=this.bprim;g.tmpBuf.array[g.bufPos++]=0;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curR;g=this.bprim;g.tmpBuf.array[g.bufPos++]=
this.curG;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curB;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curA;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curX;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curY;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curZ;g=this.bprim;g.tmpBuf.array[g.bufPos++]=h;g=this.bprim;g.tmpBuf.array[g.bufPos++]=k;g=this.bprim;g.tmpBuf.array[g.bufPos++]=l;g=this.bprim;g.tmpBuf.array[g.bufPos++]=1;g=this.bprim;g.tmpBuf.array[g.bufPos++]=1;g=this.bprim;g.tmpBuf.array[g.bufPos++]=
this.curR;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curG;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curB;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curA;g=this.bprim;g.tmpIdx[g.idxPos++]=g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=1+g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=2+g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=2+g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=3+g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=1+g.startIndex;this.curX=a;this.curY=b;this.curZ=c}},__class__:Td});
var qf=function(a,b,c,d){null==c&&(c=!0);null==a&&(a=-65536);this.prevXMax=this.prevYMax=this.prevZMax=-1E9;this.prevXMin=this.prevYMin=this.prevZMin=1E9;this.thickness=1;Td.call(this,d);this.color=a;this.bounds=b;c||this.material.passes.depth(!0,ob.Always)};qf.__name__="h3d.scene.Box";qf.__super__=Td;qf.prototype=D(Td.prototype,{clone:function(a){if(null==a){var b=this.color;a=this.bounds;var c=new Ka;c.xMin=a.xMin;c.xMax=a.xMax;c.yMin=a.yMin;c.yMax=a.yMax;c.zMin=a.zMin;c.zMax=a.zMax;c=new qf(b,
c,this.material.passes.depthWrite,null)}else c=a;Td.prototype.clone.call(this,c);a=this.bounds;b=new Ka;b.xMin=a.xMin;b.xMax=a.xMax;b.yMin=a.yMin;b.yMax=a.yMax;b.zMin=a.zMin;b.zMax=a.zMax;c.bounds=b;c.prevXMin=this.prevXMin;c.prevYMin=this.prevYMin;c.prevZMin=this.prevZMin;c.prevXMax=this.prevXMax;c.prevYMax=this.prevYMax;c.prevZMax=this.prevZMax;return c},getLocalCollider:function(){return null},sync:function(a){if(null==this.bounds){if(-.5==this.prevXMin&&-.5==this.prevYMin&&-.5==this.prevZMin&&
.5==this.prevXMax&&.5==this.prevYMax&&.5==this.prevZMax)return;this.prevZMin=this.prevYMin=this.prevXMin=-.5;this.prevZMax=this.prevYMax=this.prevXMax=.5}else{if(this.prevXMin==this.bounds.xMin&&this.prevYMin==this.bounds.yMin&&this.prevZMin==this.bounds.zMin&&this.prevXMax==this.bounds.xMax&&this.prevYMax==this.bounds.yMax&&this.prevZMax==this.bounds.zMax)return;this.prevXMin=this.bounds.xMin;this.prevYMin=this.bounds.yMin;this.prevZMin=this.bounds.zMin;this.prevXMax=this.bounds.xMax;this.prevYMax=
this.bounds.yMax;this.prevZMax=this.bounds.zMax}this.clear();this.lineStyle(this.thickness,this.color);this.moveTo(this.prevXMin,this.prevYMin,this.prevZMin);this.lineTo(this.prevXMax,this.prevYMin,this.prevZMin);this.lineTo(this.prevXMax,this.prevYMax,this.prevZMin);this.lineTo(this.prevXMin,this.prevYMax,this.prevZMin);this.lineTo(this.prevXMin,this.prevYMin,this.prevZMin);this.lineTo(this.prevXMin,this.prevYMin,this.prevZMax);this.lineTo(this.prevXMax,this.prevYMin,this.prevZMax);this.lineTo(this.prevXMax,
this.prevYMax,this.prevZMax);this.lineTo(this.prevXMin,this.prevYMax,this.prevZMax);this.lineTo(this.prevXMin,this.prevYMin,this.prevZMax);this.moveTo(this.prevXMax,this.prevYMin,this.prevZMin);this.lineTo(this.prevXMax,this.prevYMin,this.prevZMax);this.moveTo(this.prevXMin,this.prevYMax,this.prevZMin);this.lineTo(this.prevXMin,this.prevYMax,this.prevZMax);this.moveTo(this.prevXMax,this.prevYMax,this.prevZMin);this.lineTo(this.prevXMax,this.prevYMax,this.prevZMax);Td.prototype.sync.call(this,a)},
__class__:qf});var uf=function(a,b,c,d,e,f,g){this.x=a;this.y=b;this.z=c;this.r=d;this.g=e;this.b=f;this.a=g};uf.__name__="h3d.scene._Graphics.GPoint";uf.prototype={__class__:uf};var vf=function(a,b){this.hitPoint=new O(0,0,0,1);this.mouseDownButton=this.lastClickFrame=-1;this.cancelEvents=this.propagateEvents=this.enableRightButton=this.allowMultiClick=this.isAbsoluteShape=this.emittedLastFrame=!1;Aa.call(this,b);this.shape=a;this.set_cursor(vc.Button)};vf.__name__="h3d.scene.Interactive";vf.__interfaces__=
[Nf];vf.setupDebugMaterial=function(a){a=a.getMaterials();for(var b=0;b<a.length;){var c=a[b];++b;ja.CURRENT.driver.hasFeature(Ia.Wireframe)&&c.passes.set_wireframe(!0);c.set_castShadows(!1);c.set_receiveShadows(!1);c.mshader.color__.w=.7;c.set_blendMode(ya.Alpha)}};vf.__super__=Aa;vf.prototype=D(Aa.prototype,{getPoint:function(a,b){var c=a.px,d=a.py,e=a.pz,f=a.lx,g=a.ly,h=a.lz,k=this.getInvPos(),l=a.px,m=a.py,p=a.pz;null==p&&(p=0);null==m&&(m=0);null==l&&(l=0);var r=l;l=m;m=p;null==m&&(m=0);null==
l&&(l=0);null==r&&(r=0);p=r;r=l;var n=m;m=p*k._11+r*k._21+n*k._31+k._41;l=p*k._12+r*k._22+n*k._32+k._42;p=p*k._13+r*k._23+n*k._33+k._43;a.px=m;a.py=l;a.pz=p;l=a.lx;m=a.ly;p=a.lz;null==p&&(p=0);null==m&&(m=0);null==l&&(l=0);r=l;l=m;m=p;null==m&&(m=0);null==l&&(l=0);null==r&&(r=0);p=r;r=l;n=m;m=p*k._11+r*k._21+n*k._31;l=p*k._12+r*k._22+n*k._32;p=p*k._13+r*k._23+n*k._33;a.lx=m;a.ly=l;a.lz=p;a.normalize();k=this.shape.rayIntersection(a,b);if(0>k)return a.px=c,a.py=d,a.pz=e,a.lx=f,a.ly=g,a.lz=h,null;l=
a.px+k*a.lx;m=a.py+k*a.ly;p=a.pz+k*a.lz;null==p&&(p=0);null==m&&(m=0);null==l&&(l=0);b=new G(l,m,p);k=this.getAbsPos();m=b.x*k._11+b.y*k._21+b.z*k._31+k._41;l=b.x*k._12+b.y*k._22+b.z*k._32+k._42;p=b.x*k._13+b.y*k._23+b.z*k._33+k._43;b.x=m;b.y=l;b.z=p;a.px=c;a.py=d;a.pz=e;a.lx=f;a.ly=g;a.lz=h;return b},get_showDebug:function(){return null!=this.debugObj},set_showDebug:function(a){if(!a){if(null!=this.debugObj){var b=this.debugObj;null!=b&&null!=b.parent&&b.parent.removeChild(b)}this.debugObj=null;
return!1}if(null!=this.debugObj)return!0;this.debugObj=this.shape.makeDebugObj();if(null!=this.debugObj){vf.setupDebugMaterial(this.debugObj);b=this.debugObj;var c=this.isAbsoluteShape;c!=(0!=(b.flags&2048))&&(b.flags|=1,0!=(b.flags&131072)&&(b.flags|=262144));a=2048;b.flags=c?b.flags|a:b.flags&~a;this.addChild(this.debugObj)}return null!=this.debugObj},onAdd:function(){this.scene=this.getScene();null!=this.scene&&this.scene.addEventTarget(this);Aa.prototype.onAdd.call(this)},onRemove:function(){null!=
this.scene&&(this.scene.removeEventTarget(this),this.scene=null);Aa.prototype.onRemove.call(this)},sync:function(a){Aa.prototype.sync.call(this,a);this.emittedLastFrame=!1},emit:function(a){Aa.prototype.emit.call(this,a);this.emittedLastFrame=!0},preventClick:function(){this.mouseDownButton=-1},getInteractiveScene:function(){return this.scene},handleEvent:function(a){this.propagateEvents&&(a.propagate=!0);this.cancelEvents&&(a.cancel=!0);switch(a.kind._hx_index){case 0:if(this.enableRightButton||
0==a.button)this.mouseDownButton=a.button,this.onPush(a),a.cancel&&(this.mouseDownButton=-1);break;case 1:if(this.enableRightButton||0==a.button){this.onRelease(a);var b=ea.frameCount;this.mouseDownButton!=a.button||this.lastClickFrame==b&&!this.allowMultiClick||(this.onClick(a),this.lastClickFrame=b)}this.mouseDownButton=-1;break;case 2:this.onMove(a);break;case 3:this.onOver(a);break;case 4:this.onOut(a);break;case 5:this.onWheel(a);break;case 6:this.onFocus(a);break;case 7:this.onFocusLost(a);
break;case 8:this.onKeyDown(a);break;case 9:this.onKeyUp(a);break;case 10:if(this.enableRightButton||0==a.button)if(this.onRelease(a),this.mouseDownButton==a.button)this.onReleaseOutside(a);this.mouseDownButton=-1;break;case 11:this.onTextInput(a);break;case 12:this.onCheck(a)}},set_cursor:function(a){this.cursor=a;null!=this.scene&&null!=this.scene.events&&this.scene.events.updateCursor(this);return a},focus:function(){null!=this.scene&&null!=this.scene.events&&this.scene.events.focus(this)},blur:function(){this.hasFocus()&&
this.scene.events.blur()},isOver:function(){return null!=this.scene&&null!=this.scene.events?-1!=this.scene.events.overList.indexOf(this):!1},hasFocus:function(){return null!=this.scene&&null!=this.scene.events?this.scene.events.currentFocus==this:!1},onOver:function(a){},onOut:function(a){},onPush:function(a){},onRelease:function(a){},onReleaseOutside:function(a){},onClick:function(a){},onMove:function(a){},onWheel:function(a){},onFocus:function(a){},onFocusLost:function(a){},onKeyUp:function(a){},
onKeyDown:function(a){},onCheck:function(a){},onTextInput:function(a){},__class__:vf});var wf=function(a,b){Aa.call(this,b);this.shader=a};wf.__name__="h3d.scene.Light";wf.__super__=Aa;wf.prototype=D(Aa.prototype,{get_color:function(){return new G(0,0,0)},set_color:function(a){return a},emit:function(a){a.emitLight(this)},getShadowDirection:function(){return null},__class__:wf});var cg=function(){this.drawPasses=0};cg.__name__="h3d.scene.LightSystem";cg.prototype={initGlobals:function(a){},initLights:function(a){this.ctx=
a;if(null==this.shadowLight||0==(this.shadowLight.flags&32))for(a=a.lights;null!=a;){if(null!=a.getShadowDirection()){this.shadowLight=a;break}a=a.next}},computeLight:function(a,b){return b},dispose:function(){},__class__:cg};var Hc=function(a,b,c){Ra.call(this,a,null==b?null:b[0],c);this.materials=null==b?[this.material]:b};Hc.__name__="h3d.scene.MultiMaterial";Hc.__super__=Ra;Hc.prototype=D(Ra.prototype,{getMeshMaterials:function(){return this.materials.slice()},clone:function(a){a=null==a?new Hc(null,
this.materials):a;a.materials=[];for(var b=0,c=this.materials;b<c.length;){var d=c[b];++b;a.materials.push(null==d?null:d.clone())}Ra.prototype.clone.call(this,a);a.material=a.materials[0];return a},emit:function(a){this.calcScreenRatio(a);if(!(this.primitive.screenRatioToLod(this.curScreenRatio)>=this.primitive.lodCount()))for(var b=0,c=this.materials.length;b<c;){var d=b++,e=this.materials[d];if(null!=e)for(null==d&&(d=0),e=e.passes;null!=e;)e.culled||(a.emitPass(e,this).index=d),e=e.nextPass}},
getMaterialByName:function(a){for(var b=0,c=this.materials;b<c.length;){var d=c[b];++b;if(null!=d&&d.name==a)return d}return Ra.prototype.getMaterialByName.call(this,a)},getMaterials:function(a,b){var c;null==b&&(b=!0);null==a&&(a=[]);var d=0;for(c=this.materials;d<c.length;){var e=c[d];++d;null!=e&&0>a.indexOf(e)&&a.push(e)}if(b)for(d=0,c=this.children;d<c.length;)b=c[d],++d,b.getMaterials(a);return a},draw:function(a){1<this.materials.length&&this.primitive.selectMaterial(a.drawPass.index,this.primitive.screenRatioToLod(this.curScreenRatio));
this.primitive.render(a.engine)},__class__:Hc});var dg=function(a){this.cameraFrustumUploaded=!1;this.cameraFrustumBuffer=null;this.tmpComputeLink=new Eb(null,null);this.forcedScreenRatio=-1;Qa.call(this);this.scene=a;this.cachedShaderList=[];this.cachedPassObjects=[];this.initGlobals()};dg.__name__="h3d.scene.RenderContext";dg.__super__=Qa;dg.prototype=D(Qa.prototype,{setCamera:function(a){this.camera=a;var b=a.mcam;this.globals.map.h[this.cameraView_id]=b;b=a.zNear;this.globals.map.h[this.cameraNear_id]=
b;b=a.zFar;this.globals.map.h[this.cameraFar_id]=b;b=a.mproj;this.globals.map.h[this.cameraProj_id]=b;b=a.pos;this.globals.map.h[this.cameraPos_id]=b;var c=a.mproj._11;var d=a.mproj._22;var e=a.mproj._33;b=a.mproj._44;null==b&&(b=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b=new O(c,d,e,b);this.globals.map.h[this.cameraProjDiag_id]=b;null==this.globals.map.h[this.cameraPreviousViewProj_id]&&(b=a.m.clone(),this.globals.map.h[this.cameraPreviousViewProj_id]=b);null==this.globals.map.h[this.cameraJitterOffsets_id]&&
(b=e=d=c=0,null==b&&(b=1),null==e&&(e=0),null==d&&(d=0),null==c&&(c=0),b=new O(c,d,e,b),this.globals.map.h[this.cameraJitterOffsets_id]=b);b=a.m;this.globals.map.h[this.cameraViewProj_id]=b;b=this.camera.getInverseViewProj();this.globals.map.h[this.cameraInverseViewProj_id]=b},setupTarget:function(){var a=this.engine.driver.hasFeature(Ia.BottomLeftCoords)&&null!=this.engine.getCurrentTarget()?-1:1;this.globals.map.h[this.cameraProjFlip_id]=a},getCurrentPixelSize:function(){var a=this.engine.getCurrentTarget(),
b=2/(null==a?this.engine.width:a.width);a=2/(null==a?this.engine.height:a.height);null==a&&(a=0);null==b&&(b=0);return new G(b,a,0)},emit:function(a,b,c){null==c&&(c=0);for(a=a.passes;null!=a;)a.culled||(this.emitPass(a,b).index=c),a=a.nextPass},start:function(){this.drawPass=null;this.passes=[];this.lights=null;this.cachedPos=0;this.visibleFlag=!0;this.forcedScreenRatio=-1;this.time+=this.elapsedTime;this.frame++;this.setCurrent();this.engine=ja.CURRENT;var a=this.time;this.globals.map.h[this.globalTime_id]=
a;a=this.getCurrentPixelSize();this.globals.map.h[this.pixelSize_id]=a;this.setCamera(this.scene.camera)},nextPass:function(){this.cachedPos=0;this.drawPass=null},getGlobal:function(a){return this.globals.get(a)},setGlobal:function(a,b){this.globals.set(a,b)},emitPass:function(a,b){0==(a.rendererFlags&1)&&this.scene.renderer.setPassFlags(a);var c=this.allocPool;null==c?(c=new $h,c.nextAlloc=this.allocFirst,this.allocFirst=c):this.allocPool=c.nextAlloc;c.pass=a;c.obj=b;this.passes.length<=a.passId&&
(this.passes.length=a.passId);c.next=this.passes[a.passId];return this.passes[a.passId]=c},allocShaderList:function(a,b){var c=this.cachedShaderList[this.cachedPos++];null==c&&(c=new Eb(null),this.cachedShaderList[this.cachedPos-1]=c);c.s=a;c.next=b;return c},computeList:function(a){if(null!=this.computeLink)throw t.thrown("Use computeDispatch to dispatch computeList");this.computeLink=a},computeDispatch:function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=1);if(0>=b||0>=c||0>=d)throw t.thrown("Can't use zero or negative work groups count");
var e=Qa.get();e!=this&&this.start();this.globals.maxChannels=0;null!=a&&(this.tmpComputeLink.s=a,this.computeLink=this.tmpComputeLink);for(a=this.computeLink;null!=a;){var f=a.s;a=a.next;f.updateConstants(this.globals)}a=nd.get().link(this.computeLink,Fb.Compute);this.engine.driver.selectShader(a);f=this.shaderBuffers;f.vertex.grow(a.vertex);null!=a.fragment&&f.fragment.grow(a.fragment);this.fillGlobals(f,a);this.engine.uploadShaderBuffers(f,0);this.fillParams(f,a,this.computeLink,!0);this.engine.uploadShaderBuffers(f,
1);this.engine.uploadShaderBuffers(f,2);this.engine.uploadShaderBuffers(f,3);this.engine.driver.computeDispatch(b,c,d);this.engine.dispatches++;this.computeLink==this.tmpComputeLink&&(this.tmpComputeLink.s=null);this.computeLink=null;e!=this&&(this.done(),null!=e&&e.setCurrent())},emitLight:function(a){a.next=this.lights;this.lights=a},getCameraFrustumBuffer:function(){null==this.cameraFrustumBuffer&&(this.cameraFrustumBuffer=Zb.get().allocBuffer(6,N.get_VEC4_DATA(),2));if(!this.cameraFrustumUploaded){var a=
new S(new ArrayBuffer(96)),b=this.camera.frustum,c=b.pleft;a.setFloat(0,c.nx);a.setFloat(4,c.ny);a.setFloat(8,c.nz);a.setFloat(12,c.d);c=b.pright;a.setFloat(16,c.nx);a.setFloat(20,c.ny);a.setFloat(24,c.nz);a.setFloat(28,c.d);c=b.ptop;a.setFloat(32,c.nx);a.setFloat(36,c.ny);a.setFloat(40,c.nz);a.setFloat(44,c.d);c=b.pbottom;a.setFloat(48,c.nx);a.setFloat(52,c.ny);a.setFloat(56,c.nz);a.setFloat(60,c.d);c=b.pfar;a.setFloat(64,c.nx);a.setFloat(68,c.ny);a.setFloat(72,c.nz);a.setFloat(76,c.d);c=b.pnear;
a.setFloat(80,c.nx);a.setFloat(84,c.ny);a.setFloat(88,c.nz);a.setFloat(92,c.d);this.cameraFrustumBuffer.uploadBytes(a,0,6);this.cameraFrustumUploaded=!0}return this.cameraFrustumBuffer},uploadParams:function(){this.fillParams(this.shaderBuffers,this.drawPass.shader,this.drawPass.shaders);this.engine.uploadShaderBuffers(this.shaderBuffers,1);this.engine.uploadShaderBuffers(this.shaderBuffers,2);this.engine.uploadShaderBuffers(this.shaderBuffers,3)},done:function(){this.drawPass=null;for(var a=this.allocFirst;null!=
a&&a!=this.allocPool;)a.obj=null,a.pass=null,a.shader=null,a.shaders=null,a.next=null,a.index=0,a.texture=0,a=a.nextAlloc;null!=this.allocPool&&(this.allocFirst=this.allocFirst.nextAlloc);this.allocPool=this.allocFirst;a=0;for(var b=this.cachedShaderList;a<b.length;){var c=b[a];++a;c.s=null;c.next=null}this.passes=[];this.lights=null;this.cameraFrustumUploaded=!1;this.globals.map.h[this.cameraPreviousViewProj_id].load(this.globals.map.h[this.cameraViewProj_id]);this.computeVelocity=!1;this.clearCurrent()},
dispose:function(){Qa.prototype.dispose.call(this);null!=this.cameraFrustumBuffer&&Zb.get().disposeBuffer(this.cameraFrustumBuffer)},get_cameraView:function(){return this.globals.map.h[this.cameraView_id]},set_cameraView:function(a){return this.globals.map.h[this.cameraView_id]=a},get_cameraNear:function(){return this.globals.map.h[this.cameraNear_id]},set_cameraNear:function(a){return this.globals.map.h[this.cameraNear_id]=a},get_cameraFar:function(){return this.globals.map.h[this.cameraFar_id]},
set_cameraFar:function(a){return this.globals.map.h[this.cameraFar_id]=a},get_cameraProj:function(){return this.globals.map.h[this.cameraProj_id]},set_cameraProj:function(a){return this.globals.map.h[this.cameraProj_id]=a},get_cameraPos:function(){return this.globals.map.h[this.cameraPos_id]},set_cameraPos:function(a){return this.globals.map.h[this.cameraPos_id]=a},get_cameraProjDiag:function(){return this.globals.map.h[this.cameraProjDiag_id]},set_cameraProjDiag:function(a){return this.globals.map.h[this.cameraProjDiag_id]=
a},get_cameraProjFlip:function(){return this.globals.map.h[this.cameraProjFlip_id]},set_cameraProjFlip:function(a){return this.globals.map.h[this.cameraProjFlip_id]=a},get_cameraViewProj:function(){return this.globals.map.h[this.cameraViewProj_id]},set_cameraViewProj:function(a){return this.globals.map.h[this.cameraViewProj_id]=a},get_cameraInverseViewProj:function(){return this.globals.map.h[this.cameraInverseViewProj_id]},set_cameraInverseViewProj:function(a){return this.globals.map.h[this.cameraInverseViewProj_id]=
a},get_cameraPreviousViewProj:function(){return this.globals.map.h[this.cameraPreviousViewProj_id]},set_cameraPreviousViewProj:function(a){return this.globals.map.h[this.cameraPreviousViewProj_id]=a},get_cameraJitterOffsets:function(){return this.globals.map.h[this.cameraJitterOffsets_id]},set_cameraJitterOffsets:function(a){return this.globals.map.h[this.cameraJitterOffsets_id]=a},get_globalTime:function(){return this.globals.map.h[this.globalTime_id]},set_globalTime:function(a){return this.globals.map.h[this.globalTime_id]=
a},get_pixelSize:function(){return this.globals.map.h[this.pixelSize_id]},set_pixelSize:function(a){return this.globals.map.h[this.pixelSize_id]=a},get_globalModelView:function(){return this.globals.map.h[this.globalModelView_id]},set_globalModelView:function(a){return this.globals.map.h[this.globalModelView_id]=a},get_globalModelViewInverse:function(){return this.globals.map.h[this.globalModelViewInverse_id]},set_globalModelViewInverse:function(a){return this.globals.map.h[this.globalModelViewInverse_id]=
a},get_globalPreviousModelView:function(){return this.globals.map.h[this.globalPreviousModelView_id]},set_globalPreviousModelView:function(a){return this.globals.map.h[this.globalPreviousModelView_id]=a},initGlobals:function(){this.cameraView_id=za.allocID("camera.view");this.cameraNear_id=za.allocID("camera.zNear");this.cameraFar_id=za.allocID("camera.zFar");this.cameraProj_id=za.allocID("camera.proj");this.cameraPos_id=za.allocID("camera.position");this.cameraProjDiag_id=za.allocID("camera.projDiag");
this.cameraProjFlip_id=za.allocID("camera.projFlip");this.cameraViewProj_id=za.allocID("camera.viewProj");this.cameraInverseViewProj_id=za.allocID("camera.inverseViewProj");this.cameraPreviousViewProj_id=za.allocID("camera.previousViewProj");this.cameraJitterOffsets_id=za.allocID("camera.jitterOffsets");this.globalTime_id=za.allocID("global.time");this.pixelSize_id=za.allocID("global.pixelSize");this.globalModelView_id=za.allocID("global.modelView");this.globalModelViewInverse_id=za.allocID("global.modelViewInverse");
this.globalPreviousModelView_id=za.allocID("global.previousModelView")},__class__:dg});var bi=function(){this.passes=new Pg};bi.__name__="h3d.scene.PassObjects";bi.prototype={__class__:bi};var xf=K["h3d.scene.RenderMode"]={__ename__:!0,__constructs__:null,Default:{_hx_name:"Default",_hx_index:0,__enum__:"h3d.scene.RenderMode",toString:v},LightProbe:{_hx_name:"LightProbe",_hx_index:1,__enum__:"h3d.scene.RenderMode",toString:v}};xf.__constructs__=[xf.Default,xf.LightProbe];xf.__empty_constructs__=[xf.Default,
xf.LightProbe];var od=function(){this.shadows=!0;this.renderMode=xf.Default;this.effects=[];this.hasSetTarget=this.debugging=!1;this.emptyPasses=new Pg;this.allPasses=[];this.passObjects=new Sa;this.set_props(this.getDefaultProps());var a=this;this.frontToBack=function(b){a.depthSort(!0,b)};var b=this;this.backToFront=function(a){b.depthSort(!1,a)}};od.__name__="h3d.scene.Renderer";od.__super__=rf;od.prototype=D(rf.prototype,{getEffect:function(a){for(var b=0,c=this.effects;b<c.length;){var d=c[b];
++b;d=ka.__downcastCheck(d,a)?d:null;if(null!=d)return d}return null},dispose:function(){for(var a=0,b=this.allPasses;a<b.length;){var c=b[a];++a;c.dispose()}a=0;for(b=this.effects;a<b.length;)c=b[a],++a,c.dispose();null!=this.ctx.lightSystem&&this.ctx.lightSystem.dispose();this.passObjects=new Sa},mark:function(a){},addShader:function(a){},getPass:function(a){for(var b=0,c=this.allPasses;b<c.length;){var d=c[b];++b;if(ka.__instanceof(d,a))return d}return null},getPassByName:function(a){for(var b=
0,c=this.allPasses;b<c.length;){var d=c[b];++b;if(d.name==a)return d}return null},hasFeature:function(a){return ja.CURRENT.driver.hasFeature(a)},getLightSystem:function(){return this.ctx.scene.lightSystem},depthSort:function(a,b){var c,d;var e=this.ctx.camera.m;for(d=b.current;null!=d;){var f=d;d=d.next;var g=f.obj.absPos._41*e._13+f.obj.absPos._42*e._23+f.obj.absPos._43*e._33+e._43;var h=f.obj.absPos._41*e._14+f.obj.absPos._42*e._24+f.obj.absPos._43*e._34+e._44;f.depth=0<h?g/h:-g/h}if(a){var k=b.current;
if(null==k)f=null;else{for(h=1;;){f=k;a=k=null;for(g=0;null!=f;){++g;e=f;var l=d=0;for(c=h;l<c&&(l++,++d,e=e.next,null!=e););for(l=h;0<d||0<l&&null!=e;)0==d?(c=e,e=e.next,--l):0==l||null==e||0>=(f.pass.layer!=e.pass.layer?f.pass.layer-e.pass.layer:f.depth==e.depth?0:f.depth>e.depth?1:-1)?(c=f,f=f.next,--d):(c=e,e=e.next,--l),null!=a?a.next=c:k=c,a=c;f=e}a.next=null;if(1>=g)break;h*=2}f=k}}else if(k=b.current,null==k)f=null;else{for(h=1;;){f=k;a=k=null;for(g=0;null!=f;){++g;e=f;l=d=0;for(c=h;l<c&&
(l++,++d,e=e.next,null!=e););for(l=h;0<d||0<l&&null!=e;)0==d?(c=e,e=e.next,--l):0==l||null==e||0>=(f.pass.layer!=e.pass.layer?f.pass.layer-e.pass.layer:f.depth==e.depth?0:f.depth<e.depth?1:-1)?(c=f,f=f.next,--d):(c=e,e=e.next,--l),null!=a?a.next=c:k=c,a=c;f=e}a.next=null;if(1>=g)break;h*=2}f=k}b.current=f},clear:function(a,b,c){this.ctx.engine.clear(a,b,c)},allocTarget:function(a,b,c,d){null==c&&(c=1);null==b&&(b=!0);return this.ctx.textures.allocTarget(a,Math.round(this.ctx.engine.width*c),Math.round(this.ctx.engine.height*
c),b,d)},copy:function(a,b,c){oc.run(a,b,c)},setTarget:function(a,b){null==b&&(b=kc.ReadWrite);this.hasSetTarget&&this.ctx.engine.popTarget();this.ctx.engine.pushTarget(a,null,null,b);this.hasSetTarget=!0},setTargets:function(a,b){null==b&&(b=kc.ReadWrite);this.hasSetTarget&&this.ctx.engine.popTarget();this.ctx.engine.pushTargets(a,b);this.hasSetTarget=!0},setDepth:function(a){this.hasSetTarget&&this.ctx.engine.popTarget();this.ctx.engine.pushDepth(a);this.hasSetTarget=!0},resetTarget:function(){this.hasSetTarget&&
(this.ctx.engine.popTarget(),this.hasSetTarget=!1)},has:function(a){return null!=this.passObjects.h[a]},setPassFlags:function(a){a.rendererFlags|=1},get:function(a){a=this.passObjects.h[a];if(null==a)return this.emptyPasses;a.rendered=!0;return a.passes},draw:function(a){this.defaultPass.draw(this.get(a))},render:function(){throw t.thrown("Not implemented");},computeStatic:function(){throw t.thrown("Not implemented");},start:function(){},startEffects:function(){for(var a=0,b=this.effects;a<b.length;){var c=
b[a];++a;c.enabled&&c.start(this)}},process:function(a){this.hasSetTarget=!1;for(var b=0,c=this.allPasses;b<c.length;){var d=c[b];++b;d.setContext(this.ctx)}for(b=0;b<a.length;)d=a[b],++b,this.passObjects.h[d.name]=d;this.ctx.textures.begin();this.ctx.computingStatic?this.computeStatic():this.render();this.resetTarget();for(b=0;b<a.length;)d=a[b],++b,this.passObjects.h[d.name]=null},computeDispatch:function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=1);this.ctx.computeDispatch(a,b,c,d)},__class__:od});
var Ue=function(a,b){null==b&&(b=!0);null==a&&(a=!0);this.prevEngine=null;this.interactiveOffset=0;this.ratioX=this.ratioY=1;this.offsetX=this.offsetY=0;Aa.call(this,null);this.window=ic.getInstance();this.eventListeners=[];this.hitInteractives=[];this.interactives=[];this.camera=new Tf;var c=ja.CURRENT;null!=c&&(this.camera.screenRatio=c.width/c.height);this.ctx=new dg(this);a&&this.set_renderer(Ld.current.createRenderer());b&&(this.lightSystem=Ld.current.createLightSystem())};Ue.__name__="h3d.scene.Scene";
Ue.__interfaces__=[Rf,pe];Ue.__super__=Aa;Ue.prototype=D(Aa.prototype,{setEvents:function(a){this.events=a},addEventListener:function(a){this.eventListeners.push(a)},removeEventListener:function(a){for(var b=0,c=this.eventListeners;b<c.length;){var d=c[b];++b;if(d==a)return F.remove(this.eventListeners,d),!0}return!1},dispatchListeners:function(a){for(var b=0,c=this.eventListeners;b<c.length;){var d=c[b];++b;d(a);if(!a.propagate)break}},set_renderer:function(a){this.renderer=a;null!=a&&(a.ctx=this.ctx);
return a},sortHitPointByCameraDistance:function(a,b){return a.hitPoint.w>b.hitPoint.w?-1:1},dispatchEvent:function(a,b){b.handleEvent(a)},isInteractiveVisible:function(a){for(;a!=this;){if(null==a||0==(a.flags&2))return!1;a=a.parent}return!0},handleEvent:function(a,b){var c;if(0==this.interactives.length)return null;if(0==this.hitInteractives.length){var d=a.relX-this.offsetX;var e=a.relY-this.offsetY;var f=this.ratioX*this.window.get_width();b=this.ratioY*this.window.get_height();var g=2*(d/f-.5);
b=2*-(e/b-.5);f=this.camera.unproject(g,b,0);b=this.camera.unproject(g,b,1);d=f.x;e=f.y;var h=f.z;null==h&&(h=0);null==e&&(e=0);null==d&&(d=0);var k=d;d=e;e=h;null==e&&(e=0);null==d&&(d=0);null==k&&(k=0);f=k;g=d;var l=e;d=b.x;e=b.y;h=b.z;null==h&&(h=0);null==e&&(e=0);null==d&&(d=0);k=d;d=e;e=h;null==e&&(e=0);null==d&&(d=0);null==k&&(k=0);var m=k,p=d,r=e;b=new Mb;b.px=f;b.py=g;b.pz=l;b.lx=m-f;b.ly=p-g;b.lz=r-l;b.normalize();0!=this.interactiveOffset&&(b.px+=b.lx*this.interactiveOffset,b.py+=b.ly*this.interactiveOffset,
b.pz+=b.lz*this.interactiveOffset);m=b.px;p=b.py;r=b.pz;var n=b.lx,u=b.ly,q=b.lz,t=-2147483648;l=0;for(g=this.interactives;l<g.length;)if(f=g[l],++l,!(f.priority<t)){for(c=f;null!=c&&0!=(c.flags&2);)c=c.parent;if(null==c){if(!f.isAbsoluteShape){c=f.getInvPos();d=b.px;e=b.py;h=b.pz;null==h&&(h=0);null==e&&(e=0);null==d&&(d=0);k=d;d=e;e=h;null==e&&(e=0);null==d&&(d=0);null==k&&(k=0);var v=e;h=k*c._11+d*c._21+v*c._31+c._41;e=k*c._12+d*c._22+v*c._32+c._42;v=k*c._13+d*c._23+v*c._33+c._43;k=h;d=e;b.px=
k;b.py=d;b.pz=v;e=b.lx;d=b.ly;k=b.lz;null==k&&(k=0);null==d&&(d=0);null==e&&(e=0);null==k&&(k=0);null==d&&(d=0);null==e&&(e=0);v=k;h=e*c._11+d*c._21+v*c._31;k=e*c._12+d*c._22+v*c._32;c=e*c._13+d*c._23+v*c._33;e=h;d=k;v=c;b.lx=e;b.ly=d;b.lz=v;b.normalize()}if(b.lx!=b.lx)b.px=m,b.py=p,b.pz=r,b.lx=n,b.ly=u,b.lz=q;else if(e=f.shape.rayIntersection(b,f.bestMatch),0>e)b.px=m,b.py=p,b.pz=r,b.lx=n,b.ly=u,b.lz=q;else{c=b.px+e*b.lx;d=b.py+e*b.ly;e=b.pz+e*b.lz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==
e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.px=m;b.py=p;b.pz=r;b.lx=n;b.ly=u;b.lz=q;f.hitPoint.x=c;f.hitPoint.y=d;f.hitPoint.z=e;if(f.priority>t){for(;0<this.hitInteractives.length;)this.hitInteractives.pop();t=f.priority}this.hitInteractives.push(f)}}}if(0==this.hitInteractives.length)return null;if(1<this.hitInteractives.length){l=0;for(g=this.hitInteractives;l<g.length;)f=g[l],++l,c=f.invPos,t=0,null==f.preciseShape&&f.bestMatch||(f.isAbsoluteShape||(d=b.px,e=b.py,h=b.pz,null==h&&(h=0),null==e&&(e=
0),null==d&&(d=0),k=d,d=e,e=h,null==e&&(e=0),null==d&&(d=0),null==k&&(k=0),v=e,h=k*c._11+d*c._21+v*c._31+c._41,e=k*c._12+d*c._22+v*c._32+c._42,v=k*c._13+d*c._23+v*c._33+c._43,k=h,d=e,b.px=k,b.py=d,b.pz=v,e=b.lx,d=b.ly,k=b.lz,null==k&&(k=0),null==d&&(d=0),null==e&&(e=0),null==k&&(k=0),null==d&&(d=0),null==e&&(e=0),v=k,h=e*c._11+d*c._21+v*c._31,k=e*c._12+d*c._22+v*c._32,c=e*c._13+d*c._23+v*c._33,e=h,d=k,v=c,b.lx=e,b.ly=d,b.lz=v,b.normalize()),c=f.preciseShape,e=(null!=c?c:f.shape).rayIntersection(b,
!0),0<e?(c=b.px+e*b.lx,d=b.py+e*b.ly,e=b.pz+e*b.lz,null==e&&(e=0),null==d&&(d=0),null==c&&(c=0),null==e&&(e=0),null==d&&(d=0),null==c&&(c=0),f.hitPoint.x=c,f.hitPoint.y=d,f.hitPoint.z=e):t=1,b.px=m,b.py=p,b.pz=r,b.lx=n,b.ly=u,b.lz=q),e=f.hitPoint,d=e.x,c=e.y,e=e.z,null==e&&(e=0),null==c&&(c=0),null==d&&(d=0),k=c,h=e,null==h&&(h=0),null==k&&(k=0),null==d&&(d=0),c=d,e=k,d=h,f.isAbsoluteShape||(k=f.absPos,h=c*k._12+e*k._22+d*k._32+1*k._42,v=c*k._13+e*k._23+d*k._33+1*k._43,c=c*k._11+e*k._21+d*k._31+1*
k._41,e=h,d=v),k=this.camera.m,d=1/(c*k._14+e*k._24+d*k._34+1*k._44)*(c*k._13+e*k._23+d*k._33+1*k._43),f.hitPoint.w=d+t;this.hitInteractives.sort(M(this,this.sortHitPointByCameraDistance))}this.hitInteractives.unshift(null)}for(;0<this.hitInteractives.length;){f=this.hitInteractives.pop();if(null==f)break;a.relX=f.hitPoint.x;a.relY=f.hitPoint.y;a.relZ=f.hitPoint.z;f.handleEvent(a);if(a.cancel)a.cancel=!1,a.propagate=!1;else{if(!a.propagate)for(;0<this.hitInteractives.length;)this.hitInteractives.pop();
return f}}return null},clone:function(a){a=null==a?new Ue:a;a.camera=this.camera.clone();Aa.prototype.clone.call(this,a);return a},dispose:function(){if(0!=(this.flags&32))this.onRemove();this.ctx.dispose();null!=this.renderer&&(this.renderer.dispose(),this.set_renderer(new od))},addEventTarget:function(a){if(0<=this.interactives.indexOf(a))throw t.thrown("assert");this.interactives.push(a)},removeEventTarget:function(a){if(F.remove(this.interactives,a)){if(null!=this.events)this.events.onRemove(a);
F.remove(this.hitInteractives,a)}},setElapsedTime:function(a){this.ctx.elapsedTime=a},syncOnly:function(a){var b=ja.CURRENT;this.setElapsedTime(a);a=b.getCurrentTarget();this.camera.screenRatio=null==a?b.width/b.height:a.width/a.height;this.camera.update();this.ctx.start();this.syncRec(this.ctx);this.ctx.done()},computeStatic:function(){var a=this.ctx.elapsedTime;this.ctx.elapsedTime=0;this.ctx.computingStatic=!0;this.render(ja.CURRENT);this.ctx.computingStatic=!1;this.ctx.elapsedTime=a},onContextLost:function(){this.ctx.wasContextLost=
!0},render:function(a){if(0==(this.flags&32))this.onAdd();var b=a.getCurrentTarget();this.camera.screenRatio=null==b?a.width/a.height:b.width/b.height;this.camera.update();this.camera.rightHanded&&a.driver.setRenderFlag(Xf.CameraHandness,1);this.ctx.start();this.renderer.start();this.renderer.startEffects();this.mark("sync");this.syncRec(this.ctx);this.mark("emit");this.emitRec(this.ctx);var c=[],d=-1;b=0;for(var e=this.ctx.passes.length;b<e;){var f=b++;var g=this.ctx.passes[f];if(null!=g){var h=
this.ctx.cachedPassObjects[++d];null==h&&(h=new bi,this.ctx.cachedPassObjects[d]=h);h.name=g.pass.name;f=h.passes;f.current=g;f.discarded=f.lastDisc=null;c.push(h)}}null!=this.lightSystem&&(this.ctx.lightSystem=this.lightSystem,this.lightSystem.initLights(this.ctx));this.renderer.process(c);this.camera.rightHanded&&a.driver.setRenderFlag(Xf.CameraHandness,0);this.ctx.done();this.ctx.wasContextLost=!1;b=0;for(e=d;b<e;)a=b++,a=this.ctx.cachedPassObjects[a],a.name=null,f=a.passes,f.current=null,f.discarded=
f.lastDisc=null},mark:function(a){this.renderer.mark(a)},setOutputTarget:function(a,b){if(null!=b){if(null!=this.prevDB)throw t.thrown("missing setOutputTarget()");a.pushTarget(b);a.width=b.width;a.height=b.height;this.prevDB=this.ctx.textures.defaultDepthBuffer;this.prevEngine=a;this.ctx.textures.defaultDepthBuffer=b.depthBuffer}else this.prevEngine.popTarget(),this.prevEngine.width=this.prevDB.width,this.prevEngine.height=this.prevDB.height,this.ctx.textures.defaultDepthBuffer=this.prevDB,this.prevEngine=
this.prevDB=null},__class__:Ue});var Ye=function(a,b){Aa.call(this,null);this.name=b.name;this.skin=a;this.lastFrame=-2;this.parent=a;this.index=b.index};Ye.__name__="h3d.scene.Joint";Ye.__super__=Aa;Ye.prototype=D(Aa.prototype,{getObjectByName:function(a){var b=this.skin.getSkinData();a=b.namedJoints.h[a];if(null==a)return null;b=b.allJoints[this.index];if(b.index!=this.index)throw t.thrown("assert");for(var c=a.parent;null!=c;){if(c==b)return a=new Ye(this.skin,a),a.parent=this,a;c=c.parent}return null},
syncPos:function(){for(var a=this.skin;null!=a;){if(0!=(a.flags&1)){this.update();break}a=a.parent}this.lastFrame!=this.skin.lastFrame&&(this.lastFrame=this.skin.lastFrame,this.absPos.load(this.skin.jointsData[this.index].currentAbsPose))},update:function(){this.skin.getAbsPos();this.skin.syncJoints();this.lastFrame=-1},__class__:Ye});var nf=function(){this.currentAbsPose=Nb.I()};nf.__name__="h3d.scene.JointData";nf.prototype={sync:function(a,b){if(null==b.follow){var c=this.currentAbsPose;var d=
this.currentRelPose;var e=b.bindIndex;null==d?d=b.defMat:b.retargetAnim&&a.enableRetargeting&&(Jb.TMP_MAT.load(d),d=Jb.TMP_MAT,d._41=b.defMat._41,d._42=b.defMat._42,d._43=b.defMat._43);if(null==b.parent){var f=c;var g=a.absPos}else f=c,g=a.jointsData[b.parent.index].currentAbsPose;var h=d._11;var k=d._12;var l=d._13;var m=d._21;var p=d._22;var r=d._23;var n=d._31;var u=d._32;var q=d._33;var t=d._41;var v=d._42;var x=d._43;var y=g._11;var z=g._12;var A=g._13;var B=g._21;var C=g._22;var D=g._23;var E=
g._31;var F=g._32;var G=g._33;var H=g._41;d=g._42;g=g._43;f._11=h*y+k*B+l*E;f._12=h*z+k*C+l*F;f._13=h*A+k*D+l*G;f._14=0;f._21=m*y+p*B+r*E;f._22=m*z+p*C+r*F;f._23=m*A+p*D+r*G;f._24=0;f._31=n*y+u*B+q*E;f._32=n*z+u*C+q*F;f._33=n*A+u*D+q*G;f._34=0;f._41=t*y+v*B+x*E+H;f._42=t*z+v*C+x*F+d;f._43=t*A+v*D+x*G+g;f._44=1;null!=this.additivePose&&(f=c,d=this.additivePose,h=d._11,k=d._12,l=d._13,m=d._21,p=d._22,r=d._23,n=d._31,u=d._32,q=d._33,t=d._41,v=d._42,x=d._43,y=c._11,z=c._12,A=c._13,B=c._21,C=c._22,D=c._23,
E=c._31,F=c._32,G=c._33,H=c._41,d=c._42,g=c._43,f._11=h*y+k*B+l*E,f._12=h*z+k*C+l*F,f._13=h*A+k*D+l*G,f._14=0,f._21=m*y+p*B+r*E,f._22=m*z+p*C+r*F,f._23=m*A+p*D+r*G,f._24=0,f._31=n*y+u*B+q*E,f._32=n*z+u*C+q*F,f._33=n*A+u*D+q*G,f._34=0,f._41=t*y+v*B+x*E+H,f._42=t*z+v*C+x*F+d,f._43=t*A+v*D+x*G+g,f._44=1);0<=e&&(f=a.currentPalette[e],d=b.transPos,h=d._11,k=d._12,l=d._13,m=d._21,p=d._22,r=d._23,n=d._31,u=d._32,q=d._33,t=d._41,v=d._42,x=d._43,y=c._11,z=c._12,A=c._13,B=c._21,C=c._22,D=c._23,E=c._31,F=c._32,
G=c._33,H=c._41,d=c._42,g=c._43,f._11=h*y+k*B+l*E,f._12=h*z+k*C+l*F,f._13=h*A+k*D+l*G,f._14=0,f._21=m*y+p*B+r*E,f._22=m*z+p*C+r*F,f._23=m*A+p*D+r*G,f._24=0,f._31=n*y+u*B+q*E,f._32=n*z+u*C+q*F,f._33=n*A+u*D+q*G,f._34=0,f._41=t*y+v*B+x*E+H,f._42=t*z+v*C+x*F+d,f._43=t*A+v*D+x*G+g,f._44=1)}},__class__:nf};var qa=function(){this.f=-1;nf.call(this);var a=0,b=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.speed=new G(a,b,c)};qa.__name__="h3d.scene.DynamicJointData";qa.__super__=nf;qa.prototype=
D(nf.prototype,{load:function(a){null!=a.currentRelPose&&(null==this.currentRelPose&&(this.currentRelPose=new ca),this.currentRelPose.load(a.currentRelPose));null!=a.currentAbsPose&&(null==this.currentAbsPose&&(this.currentAbsPose=new ca),this.currentAbsPose.load(a.currentAbsPose));null!=a.additivePose&&(null==this.additivePose&&(this.additivePose=new ca),this.additivePose.load(a.additivePose));null!=a.absPos&&(null==this.absPos&&(this.absPos=new ca),this.absPos.load(a.absPos));var b=this.speed;a=
a.speed;b.x=a.x;b.y=a.y;b.z=a.z},sync:function(a,b){nf.prototype.sync.call(this,a,b);this.f!=ea.frameCount?(this.f=ea.frameCount,null==this.initialState&&(this.initialState=new qa),this.initialState.load(this)):this.load(this.initialState);this.computeDyn(a,b);this.computeRotationDyn(a,b.parent)},computeDyn:function(a,b){var c=a.jointsData[b.index];c=c instanceof qa?c:null;var d=null==c.absPos?c.currentAbsPose:c.absPos,e=b.defMat;var f=qa.newWorldPos;var g=d;var h=g._41;var k=g._42;g=g._43;null==
g&&(g=0);null==k&&(k=0);null==h&&(h=0);f.x=h;f.y=k;f.z=g;f=qa.expectedPos;g=d;h=g._41;k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);f.x=h;f.y=k;f.z=g;var l=b.globalForce;var m=f=this.speed;g=1-b.resistance;h=l.x*g;k=l.y*g;g*=l.z;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);var p=h;var r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);h=m.x+p;k=m.y+r;g=m.z+l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);f.x=p;f.y=r;f.z=l;m=c.speed;
g=1-b.damping;m.x*=g;m.y*=g;m.z*=g;f=c.speed;f.x*f.x+f.y*f.y+f.z*f.z>Sd.SLEEP_THRESHOLD&&(m=f=qa.newWorldPos,l=c.speed,k=ea.dt,h=0,r=ea.maxDeltaTime,null==r&&(r=1),null==h&&(h=0),g=k<h?h:k>r?r:k,h=l.x*g,k=l.y*g,g*=l.z,null==g&&(g=0),null==k&&(k=0),null==h&&(h=0),p=h,r=k,l=g,null==l&&(l=0),null==r&&(r=0),null==p&&(p=0),h=m.x+p,k=m.y+r,g=m.z+l,null==g&&(g=0),null==k&&(k=0),null==h&&(h=0),p=h,r=k,l=g,null==l&&(l=0),null==r&&(r=0),null==p&&(p=0),f.x=p,f.y=r,f.z=l);f=c.speed;f.x*f.x+f.y*f.y+f.z*f.z>Sd.MAX_THRESHOLD&&
(f=qa.newWorldPos,g=c.currentAbsPose,h=g._41,k=g._42,g=g._43,null==g&&(g=0),null==k&&(k=0),null==h&&(h=0),f.x=h,f.y=k,f.z=g,d.load(c.currentAbsPose),f=c.speed,g=k=h=0,null==g&&(g=0),null==k&&(k=0),null==h&&(h=0),f.x=h,f.y=k,f.z=g);Jb.TMP_MAT.multiply(e,a.jointsData[b.parent.index].currentAbsPose);f=qa.expectedPos;g=Jb.TMP_MAT;h=g._41;k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);f.x=h;f.y=k;f.z=g;m=f=qa.newWorldPos;k=qa.expectedPos;l=b.stiffness;var n=m.x;f.x=n+l*(k.x-n);n=m.y;f.y=
n+l*(k.y-n);n=m.z;f.z=n+l*(k.z-n);m=qa.newWorldPos;f=a.jointsData[b.parent.index].currentAbsPose;h=f._41;k=f._42;g=f._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);h=m.x-h;k=m.y-k;g=m.z-g;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);m=p;var u=r,q=l;l=m*m+u*u+q*q;l=1E-20>l?0:1/Math.sqrt(l);h=m*l;k=u*l;g=q*l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);f=e;h=f._41;k=f._42;g=f._43;null==
g&&(g=0);null==k&&(k=0);null==h&&(h=0);m=h;u=k;q=g;e=Math.sqrt(m*m+u*u+q*q);f=a.jointsData[b.parent.index].currentAbsPose;n=Math.sqrt(f._11*f._11+f._12*f._12+f._13*f._13);0>f._11*(f._22*f._33-f._23*f._32)+f._12*(f._23*f._31-f._21*f._33)+f._13*(f._21*f._32-f._22*f._31)&&(n*=-1);f=qa.expectedPos;g=a.jointsData[b.parent.index].currentAbsPose;h=g._41;k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);m=h;u=k;q=g;h=p*e;k=r*e;g=l*e;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;r=k;l=g;null==
l&&(l=0);null==r&&(r=0);null==p&&(p=0);g=n;h=p*g;k=r*g;g*=l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);h=m+p;k=u+r;g=q+l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);f.x=p;f.y=r;f.z=l;f=qa.newWorldPos;m=qa.expectedPos;k=qa.newWorldPos;l=b.slackness;n=m.x;f.x=n+l*(k.x-n);n=m.y;f.y=n+l*(k.y-n);n=m.z;f.z=n+l*(k.z-n);a.jointsData[b.parent.index].currentAbsPose.getInverse(Jb.TMP_MAT);f=qa.tmpVec;
g=qa.newWorldPos;f.x=g.x;f.y=g.y;f.z=g.z;m=qa.tmpVec;k=Jb.TMP_MAT;f=m.x*k._11+m.y*k._21+m.z*k._31+k._41;e=m.x*k._12+m.y*k._22+m.z*k._32+k._42;k=m.x*k._13+m.y*k._23+m.z*k._33+k._43;m.x=f;m.y=e;m.z=k;f=qa.tmpVec2;g=c.currentAbsPose;h=g._41;k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);f.x=h;f.y=k;f.z=g;m=qa.tmpVec2;k=Jb.TMP_MAT;f=m.x*k._11+m.y*k._21+m.z*k._31+k._41;e=m.x*k._12+m.y*k._22+m.z*k._32+k._42;k=m.x*k._13+m.y*k._23+m.z*k._33+k._43;m.x=f;m.y=e;m.z=k;0<b.lockAxis.x&&(qa.tmpVec.x=
qa.tmpVec2.x);0<b.lockAxis.y&&(qa.tmpVec.y=qa.tmpVec2.y);0<b.lockAxis.z&&(qa.tmpVec.z=qa.tmpVec2.z);m=qa.tmpVec;k=a.jointsData[b.parent.index].currentAbsPose;f=m.x*k._11+m.y*k._21+m.z*k._31+k._41;e=m.x*k._12+m.y*k._22+m.z*k._32+k._42;k=m.x*k._13+m.y*k._23+m.z*k._33+k._43;m.x=f;m.y=e;m.z=k;f=qa.newWorldPos;g=qa.tmpVec;f.x=g.x;f.y=g.y;f.z=g.z;m=f=c.speed;l=qa.newWorldPos;g=d;h=g._41;k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);h=l.x-h;k=l.y-k;g=l.z-g;null==g&&(g=0);null==k&&(k=0);null==
h&&(h=0);p=h;r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);g=1/ea.dt;h=p*g;k=r*g;g*=l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);h=m.x+p;k=m.y+r;g=m.z+l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);h=.5*p;k=.5*r;g=.5*l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;r=k;l=g;null==l&&(l=0);null==r&&(r=0);null==p&&(p=0);f.x=p;f.y=r;f.z=l;f=c.currentAbsPose;g=qa.newWorldPos;f._41=
g.x;f._42=g.y;f._43=g.z;null==c.absPos&&(c.absPos=new ca);c.absPos.load(c.currentAbsPose);null==c.relPos&&(c.relPos=new ca);a.jointsData[b.parent.index].currentAbsPose.getInverse(Jb.TMP_MAT);c.relPos.multiply(c.absPos,Jb.TMP_MAT);if(0<=b.bindIndex){f=a.currentPalette[b.bindIndex];n=b.transPos;q=c.currentAbsPose;b=n._11;d=n._12;e=n._13;m=n._21;k=n._22;h=n._23;l=n._31;r=n._32;p=n._33;g=n._41;u=n._42;n=n._43;var t=q._11,v=q._12,x=q._13,y=q._21,z=q._22,A=q._23,B=q._31,C=q._32,D=q._33,E=q._41,F=q._42;
q=q._43;f._11=b*t+d*y+e*B;f._12=b*v+d*z+e*C;f._13=b*x+d*A+e*D;f._14=0;f._21=m*t+k*y+h*B;f._22=m*v+k*z+h*C;f._23=m*x+k*A+h*D;f._24=0;f._31=l*t+r*y+p*B;f._32=l*v+r*z+p*C;f._33=l*x+r*A+p*D;f._34=0;f._41=g*t+u*y+n*B+E;f._42=g*v+u*z+n*C+F;f._43=g*x+u*A+n*D+q;f._44=1}f=c.speed;0!=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z)&&(a.forceJointsUpdateOnFrame=ea.frameCount+1)},computeRotationDyn:function(a,b){if(null==b.follow){var c=a.jointsData[b.index];var d=a.jointsData[b.index];var e=d instanceof qa?d:null;if(1==b.subs.length){d=
b.subs[0];var f=d instanceof Sd?d:null;if(null==f)return;d=a.jointsData[f.index];var g=d instanceof qa?d:null;d=qa.tmpVec;var h=f.defMat;var k=h._41;f=h._42;h=h._43;null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);var l=k*k+f*f+h*h;l=1E-20>l?0:1/Math.sqrt(l);k*=l;f*=l;h*=l;null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);d.x=k;d.y=f;d.z=h;d=qa.tmpVec2;h=g.relPos;k=h._41;f=h._42;h=h._43;null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);l=k*k+f*f+h*h;l=1E-20>l?0:1/Math.sqrt(l);
k*=l;f*=l;h*=l;null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);d.x=k;d.y=f;d.z=h;qa.tmpQ.initMoveTo(qa.tmpVec,qa.tmpVec2);qa.tmpQ.toMatrix(Jb.TMP_MAT);c.currentAbsPose.multiply(Jb.TMP_MAT,c.currentAbsPose)}if(0<=b.bindIndex){d=a.currentPalette[b.bindIndex];var m=b.transPos,p=c.currentAbsPose;c=m._11;a=m._12;b=m._13;g=m._21;f=m._22;k=m._23;h=m._31;l=m._32;var r=m._33,n=m._41,q=m._42;m=m._43;var w=p._11,t=p._12,v=p._13,x=p._21,y=p._22,z=p._23,A=p._31,B=p._32,
C=p._33,D=p._41,E=p._42;p=p._43;d._11=c*w+a*x+b*A;d._12=c*t+a*y+b*B;d._13=c*v+a*z+b*C;d._14=0;d._21=g*w+f*x+k*A;d._22=g*t+f*y+k*B;d._23=g*v+f*z+k*C;d._24=0;d._31=h*w+l*x+r*A;d._32=h*t+l*y+r*B;d._33=h*v+l*z+r*C;d._34=0;d._41=n*w+q*x+m*A+D;d._42=n*t+q*y+m*B+E;d._43=n*v+q*z+m*C+p;d._44=1}null!=e&&e.absPos.load(e.currentAbsPose)}},__class__:qa});var Jb=function(a,b,c){this.enableRetargeting=this.prevEnableRetargeting=!0;this.prevJointsFrame=this.forceJointsUpdateOnFrame=-1;Hc.call(this,null,b,c);null!=
a&&this.setSkinData(a)};Jb.__name__="h3d.scene.Skin";Jb.__super__=Hc;Jb.prototype=D(Hc.prototype,{clone:function(a){a=null==a?new Jb(null,this.materials.slice()):a;Hc.prototype.clone.call(this,a);a.setSkinData(this.skinData);a.jointsData=[];for(var b=0,c=this.jointsData;b<c.length;){var d=c[b];++b;a.jointsData.push(sa.copy(d))}return a},addBoundsRec:function(a,b){var c=this.primitive;this.set_primitive(null);Hc.prototype.addBoundsRec.call(this,a,b);this.set_primitive(c);if(0==(this.flags&512)){this.syncJoints();
null==this.skinData.vertexWeights&&ka.__cast(this.primitive,Gd).loadSkin(this.skinData);var d=this.getAbsPos();c=Math.sqrt(d._11*d._11+d._12*d._12+d._13*d._13);var e=Math.sqrt(d._21*d._21+d._22*d._22+d._23*d._23);var f=Math.sqrt(d._31*d._31+d._32*d._32+d._33*d._33);0>d._11*(d._22*d._33-d._23*d._32)+d._12*(d._23*d._31-d._21*d._33)+d._13*(d._21*d._32-d._22*d._31)&&(c*=-1,e*=-1,f*=-1);c=Math.max(Math.max(c,e),f);e=0;for(f=this.skinData.allJoints;e<f.length;){var g=f[e];++e;if(!(0>g.offsetRay)){var h=
this.currentPalette[g.bindIndex];d=g.offsets;var k=d.xMin;var l=d.yMin;d=d.zMin;null==d&&(d=0);null==l&&(l=0);null==k&&(k=0);var m=d;null==m&&(m=0);null==l&&(l=0);null==k&&(k=0);d=k;k=m;if(null!=h){m=d*h._12+l*h._22+k*h._32+h._42;var p=d*h._13+l*h._23+k*h._33+h._43;d=d*h._11+l*h._21+k*h._31+h._41;l=m;k=p;null!=b&&(m=d*b._12+l*b._22+k*b._32+b._42,p=d*b._13+l*b._23+k*b._33+b._43,d=d*b._11+l*b._21+k*b._31+b._41,l=m,k=p);m=g.offsetRay*c;d-m<a.xMin&&(a.xMin=d-m);d+m>a.xMax&&(a.xMax=d+m);l-m<a.yMin&&(a.yMin=
l-m);l+m>a.yMax&&(a.yMax=l+m);k-m<a.zMin&&(a.zMin=k-m);k+m>a.zMax&&(a.zMax=k+m);l=g.offsets;k=l.xMax;d=l.yMax;l=l.zMax;null==l&&(l=0);null==d&&(d=0);null==k&&(k=0);m=d;p=l;null==p&&(p=0);null==m&&(m=0);null==k&&(k=0);d=k;l=m;k=p;m=d*h._12+l*h._22+k*h._32+h._42;p=d*h._13+l*h._23+k*h._33+h._43;d=d*h._11+l*h._21+k*h._31+h._41;l=m;k=p;null!=b&&(h=d*b._12+l*b._22+k*b._32+b._42,m=d*b._13+l*b._23+k*b._33+b._43,d=d*b._11+l*b._21+k*b._31+b._41,l=h,k=m);h=d;d=l;l=k;g=g.offsetRay*c;h-g<a.xMin&&(a.xMin=h-g);
h+g>a.xMax&&(a.xMax=h+g);d-g<a.yMin&&(a.yMin=d-g);d+g>a.yMax&&(a.yMax=d+g);l-g<a.zMin&&(a.zMin=l-g);l+g>a.zMax&&(a.zMax=l+g)}}}}},getCurrentSkeletonBounds:function(){this.syncJoints();for(var a=new Ka,b=0,c=this.skinData.allJoints;b<c.length;){var d=c[b];++b;if(!(0>d.bindIndex)){var e=this.jointsData[d.index].currentAbsPose;d=e._41;var f=e._42;e=e._43;d<a.xMin&&(a.xMin=d);d>a.xMax&&(a.xMax=d);f<a.yMin&&(a.yMin=f);f>a.yMax&&(a.yMax=f);e<a.zMin&&(a.zMin=e);e>a.zMax&&(a.zMax=e)}}return a},getObjectByName:function(a){if(null!=
this.skinData&&this.skinData.name==a)return this;var b=Hc.prototype.getObjectByName.call(this,a);return null!=b?b:null!=this.skinData&&(a=this.skinData.namedJoints.h[a],null!=a)?new Ye(this,a):null},getLocalCollider:function(){throw t.thrown("Not implemented");},getGlobalCollider:function(){var a=ka.__cast(this.primitive.getCollider(),we);ka.__cast(this.primitive,Gd).loadSkin(this.skinData);return new Hg(this,ka.__cast(a.b,xe))},calcAbsPos:function(){Hc.prototype.calcAbsPos.call(this);this.jointsUpdated=
!0},getSkinData:function(){return this.skinData},getJointRelPosition:function(a,b){null==b&&(b=!1);a=this.skinData.namedJoints.h[a];if(null==a)return null;if(b)return this.jointsData[a.index].additivePose;b=this.jointsData[a.index].currentRelPose;return null!=b?b:a.defMat},setJointRelPosition:function(a,b,c){null==c&&(c=!1);a=this.skinData.namedJoints.h[a];null!=a&&(c?this.jointsData[a.index].additivePose=b:this.jointsData[a.index].currentRelPose=b,this.jointsUpdated=!0)},setSkinData:function(a,b){null==
b&&(b=!0);this.skinData=a;this.jointsUpdated=!0;this.set_primitive(a.primitive);if(b){a=!1;var c=0;for(b=this.materials;c<b.length;){var d=b[c];++c;if(null!=d&&null!=d.get_normalMap()){a=!0;break}}b=this.skinShader=a?new ie:new Hd;b.constModified=!0;b.fourBonesByVertex__=4==this.skinData.bonesPerVertex;d=0;if(null!=this.skinData.splitJoints)for(c=0,b=this.skinData.splitJoints;c<b.length;)a=b[c],++c,a.joints.length>d&&(d=a.joints.length);else d=this.skinData.boundJoints.length;this.skinShader.MaxBones__<
d&&(b=this.skinShader,b.constModified=!0,b.MaxBones__=d);c=0;for(b=this.materials;c<b.length;)d=b[c],++c,null!=d&&(a=d.passes.getShader(ie),null!=a&&d.passes.removeShader(a),null!=d.get_normalMap()?d.passes.addShaderAtIndex(this.skinShader,d.passes.getShaderIndex(d.normalShader)+1):d.passes.addShader(this.skinShader),null!=this.skinData.splitJoints&&d.passes.set_dynamicParameters(!0))}this.jointsData=[];this.currentPalette=[];this.prevSplitPalette=this.prevPalette=null;this.paletteChanged=!0;this.makeJointsData();
c=0;for(b=this.skinData.boundJoints.length;c<b;)c++,this.currentPalette.push(Nb.I());if(null!=this.skinData.splitJoints)for(this.splitPalette=[],c=0,b=this.skinData.splitJoints;c<b.length;){var e=b[c];++c;a=this.splitPalette;d=[];var f=0;for(e=e.joints;f<e.length;){var g=e[f];++f;d.push(this.currentPalette[g.bindIndex])}a.push(d)}else this.splitPalette=null},makeJointsData:function(){for(var a=0,b=this.skinData.allJoints;a<b.length;){var c=b[a];++a;this.jointsData[c.index]=c.makeRuntimeData()}},sync:function(a){(a.visibleFlag||
0!=(this.flags&64))&&this.syncJoints()},syncJoints:function(){if(this.jointsUpdated||this.forceJointsUpdateOnFrame==ea.frameCount){if(this.computeVelocity()){this.syncPrevJoints();var a=this.skinShader;a.constModified=!0;a.calcPrevPos__=!0}else this.prevPalette=this.prevSplitPalette=null,a=this.skinShader,a.constModified=!0,a.calcPrevPos__=!1;a=this.skinShader;var b=this.computeVelocity();a.constModified=!0;a.calcPrevPos__=b;a=0;for(b=this.skinData.allJoints;a<b.length;){var c=b[a];++a;this.jointsData[c.index].sync(this,
c)}this.skinShader.bonesMatrixes__=this.currentPalette;this.jointsUpdated=!1;this.prevEnableRetargeting=this.enableRetargeting}},syncPrevJoints:function(){var a;if(this.prevJointsFrame!=ea.frameCount){this.prevJointsFrame=ea.frameCount;if(null==this.prevPalette){this.prevPalette=[];var b=0;for(a=this.currentPalette.length;b<a;)b++,this.prevPalette.push(Nb.I());if(null!=this.splitPalette)for(this.prevSplitPalette=[],b=0,a=this.skinData.splitJoints;b<a.length;){var c=a[b];++b;var d=this.prevSplitPalette,
e=[],f=0;for(c=c.joints;f<c.length;){var g=c[f];++f;e.push(this.prevPalette[g.bindIndex])}d.push(e)}}a=0;for(b=this.currentPalette;a<b.length;)d=b[a],e=a++,this.prevPalette[e].load(d);this.skinShader.prevBonesMatrixes__=this.prevPalette}},emit:function(a){var b;this.calcScreenRatio(a);this.syncJoints();if(null==this.splitPalette)Hc.prototype.emit.call(this,a);else{var c=0;for(b=this.splitPalette.length;c<b;){var d=c++;var e=this.materials[this.skinData.splitJoints[d].material];if(null!=e)for(null==
d&&(d=0),e=e.passes;null!=e;)e.culled||(a.emitPass(e,this).index=d),e=e.nextPass}}if(this.showJoints){null==this.jointsGraphics&&(this.jointsGraphics=new Td(this),this.jointsGraphics.material.passes.depth(!1,ob.Always),this.jointsGraphics.material.passes.setPassName("alpha"));for(b=this;null!=b.parent;)b=b.parent;this.jointsGraphics.set_follow(b);a=this.jointsGraphics;a.clear();c=0;for(b=this.skinData.allJoints;c<b.length;){d=b[c];++c;e=this.jointsData[d.index].currentAbsPose;var f=null==d.parent?
this.absPos:this.jointsData[d.parent.index].currentAbsPose;a.lineStyle(1,null==d.parent?-16776961:-256);a.moveTo(f._41,f._42,f._43);a.lineTo(e._41,e._42,e._43)}}else null!=this.jointsGraphics&&(b=this.jointsGraphics,null!=b&&null!=b.parent&&b.parent.removeChild(b),this.jointsGraphics=null)},draw:function(a){if(null==this.splitPalette)Hc.prototype.draw.call(this,a);else{var b=a.drawPass.index;this.skinShader.bonesMatrixes__=this.splitPalette[b];null!=this.prevSplitPalette&&(this.skinShader.prevBonesMatrixes__=
this.prevSplitPalette[b]);this.primitive.selectMaterial(b,this.primitive.screenRatioToLod(this.curScreenRatio));a.uploadParams();this.primitive.render(a.engine)}},__class__:Jb});var eg=function(a,b){this.priority=0;this.cullingDistance=-1;wf.call(this,a,b)};eg.__name__="h3d.scene.fwd.Light";eg.__super__=wf;eg.prototype=D(wf.prototype,{get_enableSpecular:function(){return!1},set_enableSpecular:function(a){if(a)throw t.thrown("Not implemented for this light");return!1},__class__:eg});var Kg=function(){this.perPixelLighting=
!0;this.maxLightsPerObject=6;this.drawPasses=0;var a=.5,b=.5,c=.5;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.ambientLight=new G(a,b,c);this.ambientShader=new Ge;this.set_additiveLighting(!0)};Kg.__name__="h3d.scene.fwd.LightSystem";Kg.__super__=cg;Kg.prototype=D(cg.prototype,{get_additiveLighting:function(){var a=this.ambientShader;return(a instanceof Ge?a:null).additive__},set_additiveLighting:function(a){var b=this.ambientShader;b=b instanceof Ge?b:null;b.constModified=!0;return b.additive__=
a},initLights:function(a){this.lightCount=0;this.ctx=a;this.cullLights();cg.prototype.initLights.call(this,a);if(this.lightCount<=this.maxLightsPerObject){var b=a.lights,c=M(this,this.sortLight);if(null==b)b=null;else for(var d=1,e,f,g,h,k,l,m;;){h=b;m=b=null;for(e=0;null!=h;){++e;k=h;g=f=0;for(l=d;g<l&&(g++,++f,k=k.next,null!=k););for(g=d;0<f||0<g&&null!=k;)0==f?(l=k,k=k.next,--g):0==g||null==k||0>=c(h,k)?(l=h,h=h.next,--f):(l=k,k=k.next,--g),null!=m?m.next=l:b=l,m=l;h=k}m.next=null;if(1>=e)break;
d*=2}a.lights=b}},initGlobals:function(a){a.set("global.ambientLight",this.ambientLight);a.set("global.perPixelLighting",this.perPixelLighting)},cullLights:function(){for(var a=this.ctx.lights,b=null,c=new ve;null!=a;){var d=a instanceof eg?a:null;null!=d&&(c.x=d.absPos._41,c.y=d.absPos._42,c.z=d.absPos._43,c.r=d.cullingDistance);null==d||0<d.cullingDistance&&!this.ctx.computingStatic&&!this.ctx.camera.frustum.hasSphere(c)?null==b?this.ctx.lights=a.next:b.next=a.next:(this.lightCount++,d.objectDistance=
0,b=a);a=a.next}},sortLight:function(a,b){var c=a.priority-b.priority;return 0!=c?-c:a.objectDistance<b.objectDistance?-1:1},computeLight:function(a,b){if(this.lightCount>this.maxLightsPerObject){for(var c=this.ctx.lights;null!=c;){var d=c instanceof eg?c:null;if(0!=(a.flags&16))var e=d.absPos._41-this.ctx.camera.target.x,f=d.absPos._42-this.ctx.camera.target.y,g=d.absPos._43-this.ctx.camera.target.z;else e=d.absPos._41-a.absPos._41,f=d.absPos._42-a.absPos._42,g=d.absPos._43-a.absPos._43;null==g&&
(g=0);d.objectDistance=e*e+f*f+g*g;c=c.next}d=this.ctx.lights;a=M(this,this.sortLight);if(null==d)d=null;else{c=1;for(var h,k,l,m;;){g=d;m=d=null;for(e=0;null!=g;){++e;k=g;h=f=0;for(l=c;h<l&&(h++,++f,k=k.next,null!=k););for(h=c;0<f||0<h&&null!=k;)0==f?(l=k,k=k.next,--h):0==h||null==k||0>=a(g,k)?(l=g,g=g.next,--f):(l=k,k=k.next,--h),null!=m?m.next=l:d=l,m=l;g=k}m.next=null;if(1>=e)break;c*=2}}this.ctx.lights=d}b=this.ctx.allocShaderList(this.ambientShader,b);d=this.ctx.lights;for(a=0;null!=d&&a++!=
this.maxLightsPerObject;)b=this.ctx.allocShaderList(d.shader,b),d=d.next;return b},__class__:Kg});var Rg=function(){this.enableSky=!1;pc.call(this,"depth",[Sb.PackFloat(Sb.Value("output.depth"))]);this.depthMapId=za.allocID("depthMap")};Rg.__name__="h3d.scene.fwd.DepthPass";Rg.__super__=pc;Rg.prototype=D(pc.prototype,{draw:function(a,b){var c=this.ctx.textures.allocTarget("depthMap",this.ctx.engine.width,this.ctx.engine.height,!0);this.ctx.engine.pushTarget(c);this.ctx.engine.clear(this.enableSky?
0:16711680,1);pc.prototype.draw.call(this,a,b);this.ctx.engine.popTarget();this.ctx.globals.map.h[this.depthMapId]={texture:c}},__class__:Rg});var Sg=function(){pc.call(this,"normal",[Sb.PackNormal(Sb.Value("output.normal"))]);this.normalMapId=za.allocID("normalMap")};Sg.__name__="h3d.scene.fwd.NormalPass";Sg.__super__=pc;Sg.prototype=D(pc.prototype,{draw:function(a,b){var c=this.ctx.textures.allocTarget("normalMap",this.ctx.engine.width,this.ctx.engine.height);this.ctx.engine.pushTarget(c);this.ctx.engine.clear(8421504,
1);pc.prototype.draw.call(this,a,b);this.ctx.engine.popTarget();this.ctx.globals.map.h[this.normalMapId]=c},__class__:Sg});var Jg=function(){this.shadow=new Ng(1024);this.normal=new Sg;this.depth=new Rg;od.call(this);this.defaultPass=new pc("default");this.allPasses=[this.defaultPass,this.depth,this.normal,this.shadow]};Jg.__name__="h3d.scene.fwd.Renderer";Jg.__super__=od;Jg.prototype=D(od.prototype,{get_def:function(){return this.defaultPass},renderPass:function(a,b,c){a.draw(b,c)},getPassByName:function(a){return"alpha"==
a||"additive"==a?this.defaultPass:od.prototype.getPassByName.call(this,a)},render:function(){this.has("shadow")&&this.renderPass(this.shadow,this.get("shadow"));this.has("depth")&&this.renderPass(this.depth,this.get("depth"));this.has("normal")&&this.renderPass(this.normal,this.get("normal"));this.renderPass(this.defaultPass,this.get("default"));this.renderPass(this.defaultPass,this.get("alpha"),this.backToFront);this.renderPass(this.defaultPass,this.get("additive"))},__class__:Jg});var Ge=function(){na.call(this)};
Ge.__name__="h3d.shader.AmbientLight";Ge.__super__=na;Ge.prototype=D(na.prototype,{get_additive:function(){return this.additive__},set_additive:function(a){this.constModified=!0;return this.additive__=a},updateConstants:function(a){this.constBits=0;this.additive__&&(this.constBits|=2);this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.additive__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.additive__=b)},setParamIndexFloatValue:function(a,
b){},clone:function(){var a=Object.create(Ge.prototype);a.shader=this.shader;a.additive__=this.additive__;return a},__class__:Ge});var kf=function(){this.viewportB__=new G(0,0,0);this.viewportA__=new G(0,0,0);this.halfPixelInverse__=new G(0,0,0);this.uvPos__=new O(0,0,0,1);this.filterMatrixB__=new G(0,0,0);this.filterMatrixA__=new G(0,0,0);this.absoluteMatrixB__=new G(0,0,0);this.absoluteMatrixA__=new G(0,0,0);this.color__=new O(0,0,0,1);this.zValue__=0;na.call(this)};kf.__name__="h3d.shader.Base2d";
kf.__super__=na;kf.prototype=D(na.prototype,{get_zValue:function(){return this.zValue__},set_zValue:function(a){return this.zValue__=a},get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},get_isRelative:function(){return this.isRelative__},set_isRelative:function(a){this.constModified=!0;return this.isRelative__=a},get_color:function(){return this.color__},set_color:function(a){return this.color__=a},get_absoluteMatrixA:function(){return this.absoluteMatrixA__},
set_absoluteMatrixA:function(a){return this.absoluteMatrixA__=a},get_absoluteMatrixB:function(){return this.absoluteMatrixB__},set_absoluteMatrixB:function(a){return this.absoluteMatrixB__=a},get_filterMatrixA:function(){return this.filterMatrixA__},set_filterMatrixA:function(a){return this.filterMatrixA__=a},get_filterMatrixB:function(){return this.filterMatrixB__},set_filterMatrixB:function(a){return this.filterMatrixB__=a},get_hasUVPos:function(){return this.hasUVPos__},set_hasUVPos:function(a){this.constModified=
!0;return this.hasUVPos__=a},get_uvPos:function(){return this.uvPos__},set_uvPos:function(a){return this.uvPos__=a},get_killAlpha:function(){return this.killAlpha__},set_killAlpha:function(a){this.constModified=!0;return this.killAlpha__=a},get_pixelAlign:function(){return this.pixelAlign__},set_pixelAlign:function(a){this.constModified=!0;return this.pixelAlign__=a},get_halfPixelInverse:function(){return this.halfPixelInverse__},set_halfPixelInverse:function(a){return this.halfPixelInverse__=a},
get_viewportA:function(){return this.viewportA__},set_viewportA:function(a){return this.viewportA__=a},get_viewportB:function(){return this.viewportB__},set_viewportB:function(a){return this.viewportB__=a},updateConstants:function(a){this.constBits=0;this.isRelative__&&(this.constBits|=1);this.hasUVPos__&&(this.constBits|=2);this.killAlpha__&&(this.constBits|=4);this.pixelAlign__&&(this.constBits|=8);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.zValue__;case 1:return this.texture__;
case 2:return this.isRelative__;case 3:return this.color__;case 4:return this.absoluteMatrixA__;case 5:return this.absoluteMatrixB__;case 6:return this.filterMatrixA__;case 7:return this.filterMatrixB__;case 8:return this.hasUVPos__;case 9:return this.uvPos__;case 10:return this.killAlpha__;case 11:return this.pixelAlign__;case 12:return this.halfPixelInverse__;case 13:return this.viewportA__;case 14:return this.viewportB__}return null},getParamFloatValue:function(a){return 0==a?this.zValue__:0},
setParamIndexValue:function(a,b){switch(a){case 0:this.zValue__=b;break;case 1:this.texture__=b;break;case 2:this.isRelative__=b;break;case 3:this.color__=b;break;case 4:this.absoluteMatrixA__=b;break;case 5:this.absoluteMatrixB__=b;break;case 6:this.filterMatrixA__=b;break;case 7:this.filterMatrixB__=b;break;case 8:this.hasUVPos__=b;break;case 9:this.uvPos__=b;break;case 10:this.killAlpha__=b;break;case 11:this.pixelAlign__=b;break;case 12:this.halfPixelInverse__=b;break;case 13:this.viewportA__=
b;break;case 14:this.viewportB__=b}},setParamIndexFloatValue:function(a,b){0==a&&(this.zValue__=b)},clone:function(){var a=Object.create(kf.prototype);a.shader=this.shader;a.zValue__=this.zValue__;a.texture__=this.texture__;a.isRelative__=this.isRelative__;a.color__=this.color__;a.absoluteMatrixA__=this.absoluteMatrixA__;a.absoluteMatrixB__=this.absoluteMatrixB__;a.filterMatrixA__=this.filterMatrixA__;a.filterMatrixB__=this.filterMatrixB__;a.hasUVPos__=this.hasUVPos__;a.uvPos__=this.uvPos__;a.killAlpha__=
this.killAlpha__;a.pixelAlign__=this.pixelAlign__;a.halfPixelInverse__=this.halfPixelInverse__;a.viewportA__=this.viewportA__;a.viewportB__=this.viewportB__;return a},__class__:kf});var ze=function(){this.specularColor__=new G(0,0,0);this.specularPower__=this.specularAmount__=0;this.color__=new O(0,0,0,1);na.call(this);var a=this.color__,b=1,c=1,d=1;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=1;a=this.specularColor__;d=c=b=1;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=
b;a.y=c;a.z=d;this.specularPower__=50;this.specularAmount__=1};ze.__name__="h3d.shader.BaseMesh";ze.__super__=na;ze.prototype=D(na.prototype,{get_color:function(){return this.color__},set_color:function(a){return this.color__=a},get_specularPower:function(){return this.specularPower__},set_specularPower:function(a){return this.specularPower__=a},get_specularAmount:function(){return this.specularAmount__},set_specularAmount:function(a){return this.specularAmount__=a},get_specularColor:function(){return this.specularColor__},
set_specularColor:function(a){return this.specularColor__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.color__;case 1:return this.specularPower__;case 2:return this.specularAmount__;case 3:return this.specularColor__}return null},getParamFloatValue:function(a){switch(a){case 1:return this.specularPower__;case 2:return this.specularAmount__}return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.color__=
b;break;case 1:this.specularPower__=b;break;case 2:this.specularAmount__=b;break;case 3:this.specularColor__=b}},setParamIndexFloatValue:function(a,b){switch(a){case 1:this.specularPower__=b;break;case 2:this.specularAmount__=b}},clone:function(){var a=Object.create(ze.prototype);a.shader=this.shader;a.color__=this.color__;a.specularPower__=this.specularPower__;a.specularAmount__=this.specularAmount__;a.specularColor__=this.specularColor__;return a},__class__:ze});var Dd=function(){this.cubeDir__=
new ca;this.depthThresholdMaxDist__=0;this.depthThreshold__=1;this.fixedColor__=new O(0,0,0,1);this.pixel__=new G(0,0,0);this.offsets__=[];this.values__=[];this.Quality__=0;this.inverseProj__=new ca;fb.call(this)};Dd.__name__="h3d.shader.Blur";Dd.__super__=fb;Dd.prototype=D(fb.prototype,{get_inverseProj:function(){return this.inverseProj__},set_inverseProj:function(a){return this.inverseProj__=a},get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},get_depthTexture:function(){return this.depthTexture__},
set_depthTexture:function(a){return this.depthTexture__=a},get_Quality:function(){return this.Quality__},set_Quality:function(a){this.constModified=!0;return this.Quality__=a},get_isDepth:function(){return this.isDepth__},set_isDepth:function(a){this.constModified=!0;return this.isDepth__=a},get_values:function(){return this.values__},set_values:function(a){return this.values__=a},get_offsets:function(){return this.offsets__},set_offsets:function(a){return this.offsets__=a},get_pixel:function(){return this.pixel__},
set_pixel:function(a){return this.pixel__=a},get_hasFixedColor:function(){return this.hasFixedColor__},set_hasFixedColor:function(a){this.constModified=!0;return this.hasFixedColor__=a},get_smoothFixedColor:function(){return this.smoothFixedColor__},set_smoothFixedColor:function(a){this.constModified=!0;return this.smoothFixedColor__=a},get_fixedColor:function(){return this.fixedColor__},set_fixedColor:function(a){return this.fixedColor__=a},get_isDepthDependant:function(){return this.isDepthDependant__},
set_isDepthDependant:function(a){this.constModified=!0;return this.isDepthDependant__=a},get_depthThreshold:function(){return this.depthThreshold__},set_depthThreshold:function(a){return this.depthThreshold__=a},get_depthThresholdMaxDist:function(){return this.depthThresholdMaxDist__},set_depthThresholdMaxDist:function(a){return this.depthThresholdMaxDist__=a},get_isCube:function(){return this.isCube__},set_isCube:function(a){this.constModified=!0;return this.isCube__=a},get_cubeTexture:function(){return this.cubeTexture__},
set_cubeTexture:function(a){return this.cubeTexture__=a},get_cubeDir:function(){return this.cubeDir__},set_cubeDir:function(a){return this.cubeDir__=a},updateConstants:function(a){this.constBits=0;var b=this.Quality__;if(0!=b>>>8)throw t.thrown("Quality is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.isDepth__&&(this.constBits|=256);this.hasFixedColor__&&(this.constBits|=512);this.smoothFixedColor__&&(this.constBits|=1024);this.isDepthDependant__&&(this.constBits|=
2048);this.isCube__&&(this.constBits|=4096);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.inverseProj__;case 2:return this.texture__;case 3:return this.depthTexture__;case 4:return this.Quality__;case 5:return this.isDepth__;case 6:return this.values__;case 7:return this.offsets__;case 8:return this.pixel__;case 9:return this.hasFixedColor__;case 10:return this.smoothFixedColor__;case 11:return this.fixedColor__;case 12:return this.isDepthDependant__;
case 13:return this.depthThreshold__;case 14:return this.depthThresholdMaxDist__;case 15:return this.isCube__;case 16:return this.cubeTexture__;case 17:return this.cubeDir__}return null},getParamFloatValue:function(a){switch(a){case 0:return this.flipY__;case 4:return this.Quality__;case 13:return this.depthThreshold__;case 14:return this.depthThresholdMaxDist__}return 0},clone:function(){var a=Object.create(Dd.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.inverseProj__=this.inverseProj__;
a.texture__=this.texture__;a.depthTexture__=this.depthTexture__;a.Quality__=this.Quality__;a.isDepth__=this.isDepth__;a.values__=this.values__;a.offsets__=this.offsets__;a.pixel__=this.pixel__;a.hasFixedColor__=this.hasFixedColor__;a.smoothFixedColor__=this.smoothFixedColor__;a.fixedColor__=this.fixedColor__;a.isDepthDependant__=this.isDepthDependant__;a.depthThreshold__=this.depthThreshold__;a.depthThresholdMaxDist__=this.depthThresholdMaxDist__;a.isCube__=this.isCube__;a.cubeTexture__=this.cubeTexture__;
a.cubeDir__=this.cubeDir__;return a},__class__:Dd});var Tg=function(){this.globals=new Float32Array(0);this.params=new Float32Array(0);this.tex=[]};Tg.__name__="h3d.shader.ShaderBuffers";Tg.prototype={grow:function(a){var b=a.globalsSize<<2,c=a.paramsSize<<2,d=a.texturesCount;a=a.bufferCount;this.globals.length<b&&(this.globals=new Float32Array(b));this.params.length<c&&(this.params=new Float32Array(c));this.tex.length<d&&(this.tex=Array(d));0<a&&(null==this.buffers||this.buffers.length<a)&&(this.buffers=
Array(a))},__class__:Tg};var Ih=function(){this.vertex=new Tg;this.fragment=new Tg};Ih.__name__="h3d.shader.Buffers";Ih.prototype={grow:function(a){this.vertex.grow(a.vertex);null!=a.fragment&&this.fragment.grow(a.fragment)},__class__:Ih};var Pd=function(a){null==a&&(a=0);this.color__=new G(0,0,0);na.call(this);var b=this.color__;b.x=(a>>16&255)/255;b.y=(a>>8&255)/255;b.z=(a&255)/255};Pd.__name__="h3d.shader.ColorAdd";Pd.__super__=na;Pd.prototype=D(na.prototype,{get_color:function(){return this.color__},
set_color:function(a){return this.color__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.color__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.color__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Pd.prototype);a.shader=this.shader;a.color__=this.color__;return a},__class__:Pd});var ce=function(a){null==a&&(a=0);this.colorKey__=new O(0,0,0,1);na.call(this);
var b=this.colorKey__;b.x=(a>>16&255)/255;b.y=(a>>8&255)/255;b.z=(a&255)/255;b.w=(a>>>24)/255};ce.__name__="h3d.shader.ColorKey";ce.__super__=na;ce.prototype=D(na.prototype,{get_colorKey:function(){return this.colorKey__},set_colorKey:function(a){return this.colorKey__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.colorKey__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.colorKey__=
b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(ce.prototype);a.shader=this.shader;a.colorKey__=this.colorKey__;return a},__class__:ce});var de=function(a){this.enabled__=!0;this.matrix__=new ca;na.call(this);null!=a?this.matrix__.loadValues(a):this.matrix__.identity()};de.__name__="h3d.shader.ColorMatrix";de.__super__=na;de.prototype=D(na.prototype,{get_matrix:function(){return this.matrix__},set_matrix:function(a){return this.matrix__=a},get_enabled:function(){return this.enabled__},
set_enabled:function(a){this.constModified=!0;return this.enabled__=a},updateConstants:function(a){this.constBits=0;this.enabled__&&(this.constBits|=1);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.matrix__;case 1:return this.enabled__}return null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.matrix__=b;break;case 1:this.enabled__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(de.prototype);
a.shader=this.shader;a.matrix__=this.matrix__;a.enabled__=this.enabled__;return a},__class__:de});var Ee=function(){this.poissonDisk__=[];this.shadowBias__=0;this.shadowProj__=new ca;this.shadowMapChannel__=lb.Unknown;this.shadowRes__=new G(0,0,0);this.shadowPower__=this.PCF_SAMPLES__=this.pcfScale__=0;na.call(this);this.set_pcfQuality(1)};Ee.__name__="h3d.shader.DirShadow";Ee.__super__=na;Ee.prototype=D(na.prototype,{set_pcfQuality:function(a){switch(a){case 2:var b=-.326;var c=-.406;null==c&&(c=
0);null==b&&(b=0);var d=new O(b,c,0,1);b=-.84;c=-.074;null==c&&(c=0);null==b&&(b=0);var e=new O(b,c,0,1);b=-.696;c=.457;null==c&&(c=0);null==b&&(b=0);var f=new O(b,c,0,1);b=-.203;c=.621;null==c&&(c=0);null==b&&(b=0);var g=new O(b,c,0,1);b=.962;c=-.195;null==c&&(c=0);null==b&&(b=0);var h=new O(b,c,0,1);b=.473;c=-.48;null==c&&(c=0);null==b&&(b=0);var k=new O(b,c,0,1);b=.519;c=.767;null==c&&(c=0);null==b&&(b=0);var l=new O(b,c,0,1);b=.185;c=-.893;null==c&&(c=0);null==b&&(b=0);var m=new O(b,c,0,1);b=
.507;c=.064;null==c&&(c=0);null==b&&(b=0);var p=new O(b,c,0,1);b=.896;c=.412;null==c&&(c=0);null==b&&(b=0);var r=new O(b,c,0,1);b=-.322;c=-.933;null==c&&(c=0);null==b&&(b=0);var n=new O(b,c,0,1);b=-.792;c=-.598;null==c&&(c=0);null==b&&(b=0);b=[d,e,f,g,h,k,l,m,p,r,n,new O(b,c,0,1)];break;case 3:b=-.613392;c=.617481;null==c&&(c=0);null==b&&(b=0);d=new O(b,c,0,1);b=.170019;c=-.040254;null==c&&(c=0);null==b&&(b=0);e=new O(b,c,0,1);b=-.299417;c=.791925;null==c&&(c=0);null==b&&(b=0);f=new O(b,c,0,1);b=
.64568;c=.49321;null==c&&(c=0);null==b&&(b=0);g=new O(b,c,0,1);b=-.651784;c=.717887;null==c&&(c=0);null==b&&(b=0);h=new O(b,c,0,1);b=.421003;c=.02707;null==c&&(c=0);null==b&&(b=0);k=new O(b,c,0,1);b=-.817194;c=-.271096;null==c&&(c=0);null==b&&(b=0);l=new O(b,c,0,1);b=-.705374;c=-.668203;null==c&&(c=0);null==b&&(b=0);m=new O(b,c,0,1);b=.97705;c=-.108615;null==c&&(c=0);null==b&&(b=0);p=new O(b,c,0,1);b=.063326;c=.142369;null==c&&(c=0);null==b&&(b=0);r=new O(b,c,0,1);b=.203528;c=.214331;null==c&&(c=
0);null==b&&(b=0);n=new O(b,c,0,1);b=-.667531;c=.32609;null==c&&(c=0);null==b&&(b=0);var q=new O(b,c,0,1);b=-.098422;c=-.295755;null==c&&(c=0);null==b&&(b=0);var w=new O(b,c,0,1);b=-.885922;c=.215369;null==c&&(c=0);null==b&&(b=0);var t=new O(b,c,0,1);b=.566637;c=.605213;null==c&&(c=0);null==b&&(b=0);var v=new O(b,c,0,1);b=.039766;c=-.3961;null==c&&(c=0);null==b&&(b=0);var x=new O(b,c,0,1);b=.751946;c=.453352;null==c&&(c=0);null==b&&(b=0);var y=new O(b,c,0,1);b=.078707;c=-.715323;null==c&&(c=0);null==
b&&(b=0);var z=new O(b,c,0,1);b=-.075838;c=-.529344;null==c&&(c=0);null==b&&(b=0);var A=new O(b,c,0,1);b=.724479;c=-.580798;null==c&&(c=0);null==b&&(b=0);var B=new O(b,c,0,1);b=.222999;c=-.215125;null==c&&(c=0);null==b&&(b=0);var C=new O(b,c,0,1);b=-.467574;c=-.405438;null==c&&(c=0);null==b&&(b=0);var D=new O(b,c,0,1);b=-.248268;c=-.814753;null==c&&(c=0);null==b&&(b=0);var E=new O(b,c,0,1);b=.354411;c=-.88757;null==c&&(c=0);null==b&&(b=0);var F=new O(b,c,0,1);b=.175817;c=.382366;null==c&&(c=0);null==
b&&(b=0);var G=new O(b,c,0,1);b=.487472;c=-.063082;null==c&&(c=0);null==b&&(b=0);var H=new O(b,c,0,1);b=-.084078;c=.898312;null==c&&(c=0);null==b&&(b=0);var J=new O(b,c,0,1);b=.488876;c=-.783441;null==c&&(c=0);null==b&&(b=0);var M=new O(b,c,0,1);b=.470016;c=.217933;null==c&&(c=0);null==b&&(b=0);var K=new O(b,c,0,1);b=-.69689;c=-.549791;null==c&&(c=0);null==b&&(b=0);var L=new O(b,c,0,1);b=-.149693;c=.605762;null==c&&(c=0);null==b&&(b=0);var N=new O(b,c,0,1);b=.034211;c=.97998;null==c&&(c=0);null==
b&&(b=0);var R=new O(b,c,0,1);b=.503098;c=-.308878;null==c&&(c=0);null==b&&(b=0);var Q=new O(b,c,0,1);b=-.016205;c=-.872921;null==c&&(c=0);null==b&&(b=0);var P=new O(b,c,0,1);b=.385784;c=-.393902;null==c&&(c=0);null==b&&(b=0);var S=new O(b,c,0,1);b=-.146886;c=-.859249;null==c&&(c=0);null==b&&(b=0);var T=new O(b,c,0,1);b=.643361;c=.164098;null==c&&(c=0);null==b&&(b=0);var U=new O(b,c,0,1);b=.634388;c=-.049471;null==c&&(c=0);null==b&&(b=0);var V=new O(b,c,0,1);b=-.688894;c=.007843;null==c&&(c=0);null==
b&&(b=0);var W=new O(b,c,0,1);b=.464034;c=-.188818;null==c&&(c=0);null==b&&(b=0);var X=new O(b,c,0,1);b=-.44084;c=.137486;null==c&&(c=0);null==b&&(b=0);var Y=new O(b,c,0,1);b=.364483;c=.511704;null==c&&(c=0);null==b&&(b=0);var Z=new O(b,c,0,1);b=.034028;c=.325968;null==c&&(c=0);null==b&&(b=0);var aa=new O(b,c,0,1);b=.099094;c=-.308023;null==c&&(c=0);null==b&&(b=0);var ba=new O(b,c,0,1);b=.69396;c=-.366253;null==c&&(c=0);null==b&&(b=0);var ca=new O(b,c,0,1);b=.678884;c=-.204688;null==c&&(c=0);null==
b&&(b=0);var da=new O(b,c,0,1);b=.001801;c=.780328;null==c&&(c=0);null==b&&(b=0);var ea=new O(b,c,0,1);b=.145177;c=-.898984;null==c&&(c=0);null==b&&(b=0);var fa=new O(b,c,0,1);b=.062655;c=-.611866;null==c&&(c=0);null==b&&(b=0);var ha=new O(b,c,0,1);b=.315226;c=-.604297;null==c&&(c=0);null==b&&(b=0);var ia=new O(b,c,0,1);b=-.780145;c=.486251;null==c&&(c=0);null==b&&(b=0);var ja=new O(b,c,0,1);b=-.371868;c=.882138;null==c&&(c=0);null==b&&(b=0);var ka=new O(b,c,0,1);b=.200476;c=.49443;null==c&&(c=0);
null==b&&(b=0);var la=new O(b,c,0,1);b=-.494552;c=-.711051;null==c&&(c=0);null==b&&(b=0);var ma=new O(b,c,0,1);b=.612476;c=.705252;null==c&&(c=0);null==b&&(b=0);var na=new O(b,c,0,1);b=-.578845;c=-.768792;null==c&&(c=0);null==b&&(b=0);var oa=new O(b,c,0,1);b=-.772454;c=-.090976;null==c&&(c=0);null==b&&(b=0);var pa=new O(b,c,0,1);b=.50444;c=.372295;null==c&&(c=0);null==b&&(b=0);var qa=new O(b,c,0,1);b=.155736;c=.065157;null==c&&(c=0);null==b&&(b=0);var ra=new O(b,c,0,1);b=.391522;c=.849605;null==c&&
(c=0);null==b&&(b=0);var sa=new O(b,c,0,1);b=-.620106;c=-.328104;null==c&&(c=0);null==b&&(b=0);var ta=new O(b,c,0,1);b=.789239;c=-.419965;null==c&&(c=0);null==b&&(b=0);var ua=new O(b,c,0,1);b=-.545396;c=.538133;null==c&&(c=0);null==b&&(b=0);var va=new O(b,c,0,1);b=-.178564;c=-.596057;null==c&&(c=0);null==b&&(b=0);b=[d,e,f,g,h,k,l,m,p,r,n,q,w,t,v,x,y,z,A,B,C,D,E,F,G,H,J,M,K,L,N,R,Q,P,S,T,U,V,W,X,Y,Z,aa,ba,ca,da,ea,fa,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,new O(b,c,0,1)];break;default:b=-.942,
c=-.399,null==c&&(c=0),null==b&&(b=0),d=new O(b,c,0,1),b=.945,c=-.768,null==c&&(c=0),null==b&&(b=0),e=new O(b,c,0,1),b=-.094,c=-.929,null==c&&(c=0),null==b&&(b=0),f=new O(b,c,0,1),b=.344,c=.293,null==c&&(c=0),null==b&&(b=0),b=[d,e,f,new O(b,c,0,1)]}this.poissonDisk__=b;this.constModified=!0;this.PCF_SAMPLES__=this.poissonDisk__.length;return a},get_enable:function(){return this.enable__},set_enable:function(a){this.constModified=!0;return this.enable__=a},get_USE_ESM:function(){return this.USE_ESM__},
set_USE_ESM:function(a){this.constModified=!0;return this.USE_ESM__=a},get_shadowPower:function(){return this.shadowPower__},set_shadowPower:function(a){return this.shadowPower__=a},get_USE_PCF:function(){return this.USE_PCF__},set_USE_PCF:function(a){this.constModified=!0;return this.USE_PCF__=a},get_PCF_SAMPLES:function(){return this.PCF_SAMPLES__},set_PCF_SAMPLES:function(a){this.constModified=!0;return this.PCF_SAMPLES__=a},get_pcfScale:function(){return this.pcfScale__},set_pcfScale:function(a){return this.pcfScale__=
a},get_shadowRes:function(){return this.shadowRes__},set_shadowRes:function(a){return this.shadowRes__=a},get_shadowMap:function(){return this.shadowMap__},set_shadowMap:function(a){this.constModified=!0;return this.shadowMap__=a},get_shadowMapChannel:function(){return this.shadowMapChannel__},set_shadowMapChannel:function(a){this.constModified=!0;return this.shadowMapChannel__=a},get_shadowProj:function(){return this.shadowProj__},set_shadowProj:function(a){return this.shadowProj__=a},get_shadowBias:function(){return this.shadowBias__},
set_shadowBias:function(a){return this.shadowBias__=a},get_poissonDisk:function(){return this.poissonDisk__},set_poissonDisk:function(a){return this.poissonDisk__=a},updateConstants:function(a){this.constBits=0;this.enable__&&(this.constBits|=1);this.USE_ESM__&&(this.constBits|=2);this.USE_PCF__&&(this.constBits|=4);var b=this.PCF_SAMPLES__;if(0!=b>>>8)throw t.thrown("PCF_SAMPLES is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b<<3;if(null==this.shadowMap__)this.shadowMapChannel__=
lb.Unknown;else if(this.shadowMapChannel__==lb.Unknown)if(this.shadowMap__.format==W.nativeFormat)this.shadowMapChannel__=lb.PackedFloat;else throw t.thrown("shadowMapChannel is not set");this.constBits|=(a.allocChannelID(this.shadowMap__)<<3|this.shadowMapChannel__._hx_index)<<11;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.enable__;case 1:return this.USE_ESM__;case 2:return this.shadowPower__;case 3:return this.USE_PCF__;case 4:return this.PCF_SAMPLES__;case 5:return this.pcfScale__;
case 6:return this.shadowRes__;case 7:return this.shadowMap__;case 8:return this.shadowProj__;case 9:return this.shadowBias__;case 10:return this.poissonDisk__}return null},getParamFloatValue:function(a){switch(a){case 2:return this.shadowPower__;case 4:return this.PCF_SAMPLES__;case 5:return this.pcfScale__;case 9:return this.shadowBias__}return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.enable__=b;break;case 1:this.USE_ESM__=b;break;case 2:this.shadowPower__=b;break;case 3:this.USE_PCF__=
b;break;case 4:this.PCF_SAMPLES__=b;break;case 5:this.pcfScale__=b;break;case 6:this.shadowRes__=b;break;case 7:this.shadowMap__=b;break;case 8:this.shadowProj__=b;break;case 9:this.shadowBias__=b;break;case 10:this.poissonDisk__=b}},setParamIndexFloatValue:function(a,b){switch(a){case 2:this.shadowPower__=b;break;case 5:this.pcfScale__=b;break;case 9:this.shadowBias__=b}},clone:function(){var a=Object.create(Ee.prototype);a.shader=this.shader;a.enable__=this.enable__;a.USE_ESM__=this.USE_ESM__;a.shadowPower__=
this.shadowPower__;a.USE_PCF__=this.USE_PCF__;a.PCF_SAMPLES__=this.PCF_SAMPLES__;a.pcfScale__=this.pcfScale__;a.shadowRes__=this.shadowRes__;a.shadowMap__=this.shadowMap__;a.shadowProj__=this.shadowProj__;a.shadowBias__=this.shadowBias__;a.poissonDisk__=this.poissonDisk__;return a},__class__:Ee});var bf=function(){this.color__=new O(0,0,0,1);this.mode__=0;fb.call(this)};bf.__name__="h3d.shader.GenTexture";bf.__super__=fb;bf.prototype=D(fb.prototype,{get_mode:function(){return this.mode__},set_mode:function(a){this.constModified=
!0;return this.mode__=a},get_color:function(){return this.color__},set_color:function(a){return this.color__=a},updateConstants:function(a){this.constBits=0;var b=this.mode__;if(0!=b>>>8)throw t.thrown("mode is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.mode__;case 2:return this.color__}return null},getParamFloatValue:function(a){switch(a){case 0:return this.flipY__;
case 1:return this.mode__}return 0},clone:function(){var a=Object.create(bf.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.mode__=this.mode__;a.color__=this.color__;return a},__class__:bf});var Fe=function(a,b){null==b&&(b=1);null==a&&(a=1.5);this.lengthScale__=this.width__=0;na.call(this);this.width__=a;this.lengthScale__=b};Fe.__name__="h3d.shader.LineShader";Fe.__super__=na;Fe.prototype=D(na.prototype,{get_lengthScale:function(){return this.lengthScale__},set_lengthScale:function(a){return this.lengthScale__=
a},get_width:function(){return this.width__},set_width:function(a){return this.width__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.lengthScale__;case 1:return this.width__}return null},getParamFloatValue:function(a){switch(a){case 0:return this.lengthScale__;case 1:return this.width__}return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.lengthScale__=b;break;case 1:this.width__=b}},setParamIndexFloatValue:function(a,
b){switch(a){case 0:this.lengthScale__=b;break;case 1:this.width__=b}},clone:function(){var a=Object.create(Fe.prototype);a.shader=this.shader;a.lengthScale__=this.lengthScale__;a.width__=this.width__;return a},__class__:Fe});var Fd=function(){fb.call(this)};Fd.__name__="h3d.shader.MinMaxShader";Fd.__super__=fb;Fd.prototype=D(fb.prototype,{get_texA:function(){return this.texA__},set_texA:function(a){return this.texA__=a},get_texB:function(){return this.texB__},set_texB:function(a){return this.texB__=
a},get_isMax:function(){return this.isMax__},set_isMax:function(a){this.constModified=!0;return this.isMax__=a},updateConstants:function(a){this.constBits=0;this.isMax__&&(this.constBits|=1);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.texA__;case 2:return this.texB__;case 3:return this.isMax__}return null},getParamFloatValue:function(a){return 0==a?this.flipY__:0},clone:function(){var a=Object.create(Fd.prototype);a.shader=this.shader;
a.flipY__=this.flipY__;a.texA__=this.texA__;a.texB__=this.texB__;a.isMax__=this.isMax__;return a},__class__:Fd});var yf=function(){this.mat__=new ca;fb.call(this)};yf.__name__="h3d.shader.CubeMinMaxShader";yf.__super__=fb;yf.prototype=D(fb.prototype,{get_texA:function(){return this.texA__},set_texA:function(a){return this.texA__=a},get_texB:function(){return this.texB__},set_texB:function(a){return this.texB__=a},get_isMax:function(){return this.isMax__},set_isMax:function(a){this.constModified=!0;
return this.isMax__=a},get_mat:function(){return this.mat__},set_mat:function(a){return this.mat__=a},updateConstants:function(a){this.constBits=0;this.isMax__&&(this.constBits|=1);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.texA__;case 2:return this.texB__;case 3:return this.isMax__;case 4:return this.mat__}return null},getParamFloatValue:function(a){return 0==a?this.flipY__:0},clone:function(){var a=Object.create(yf.prototype);
a.shader=this.shader;a.flipY__=this.flipY__;a.texA__=this.texA__;a.texB__=this.texB__;a.isMax__=this.isMax__;a.mat__=this.mat__;return a},__class__:yf});var Cd=function(a){na.call(this);this.texture__=a};Cd.__name__="h3d.shader.NormalMap";Cd.__super__=na;Cd.prototype=D(na.prototype,{get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.texture__:
null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.texture__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Cd.prototype);a.shader=this.shader;a.texture__=this.texture__;return a},__class__:Cd});var sf=function(){na.call(this)};sf.__name__="h3d.shader.Shadow";sf.__super__=na;sf.prototype=D(na.prototype,{updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return null},getParamFloatValue:function(a){return 0},
setParamIndexValue:function(a,b){},setParamIndexFloatValue:function(a,b){},__class__:sf});var fg=function(){na.call(this)};fg.__name__="h3d.shader.Utils";fg.__super__=na;fg.prototype=D(na.prototype,{updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){},setParamIndexFloatValue:function(a,b){},__class__:fg});var pd=function(){this.prevBonesMatrixes__=[];this.bonesMatrixes__=
[];this.fourBonesByVertex__=this.calcPrevPos__=!1;this.MaxBones__=0;na.call(this);this.constModified=!0;this.MaxBones__=34};pd.__name__="h3d.shader.SkinBase";pd.__super__=na;pd.prototype=D(na.prototype,{get_MaxBones:function(){return this.MaxBones__},set_MaxBones:function(a){this.constModified=!0;return this.MaxBones__=a},get_fourBonesByVertex:function(){return this.fourBonesByVertex__},set_fourBonesByVertex:function(a){this.constModified=!0;return this.fourBonesByVertex__=a},get_calcPrevPos:function(){return this.calcPrevPos__},
set_calcPrevPos:function(a){this.constModified=!0;return this.calcPrevPos__=a},get_bonesMatrixes:function(){return this.bonesMatrixes__},set_bonesMatrixes:function(a){return this.bonesMatrixes__=a},get_prevBonesMatrixes:function(){return this.prevBonesMatrixes__},set_prevBonesMatrixes:function(a){return this.prevBonesMatrixes__=a},updateConstants:function(a){this.constBits=0;var b=this.MaxBones__;if(0!=b>>>8)throw t.thrown("MaxBones is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=
b;this.fourBonesByVertex__&&(this.constBits|=256);this.calcPrevPos__&&(this.constBits|=512);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.MaxBones__;case 1:return this.fourBonesByVertex__;case 2:return this.calcPrevPos__;case 3:return this.bonesMatrixes__;case 4:return this.prevBonesMatrixes__}return null},getParamFloatValue:function(a){return 0==a?this.MaxBones__:0},setParamIndexValue:function(a,b){switch(a){case 0:this.MaxBones__=b;break;case 1:this.fourBonesByVertex__=
b;break;case 2:this.calcPrevPos__=b;break;case 3:this.bonesMatrixes__=b;break;case 4:this.prevBonesMatrixes__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(pd.prototype);a.shader=this.shader;a.MaxBones__=this.MaxBones__;a.fourBonesByVertex__=this.fourBonesByVertex__;a.calcPrevPos__=this.calcPrevPos__;a.bonesMatrixes__=this.bonesMatrixes__;a.prevBonesMatrixes__=this.prevBonesMatrixes__;return a},__class__:pd});var Hd=function(){pd.call(this)};Hd.__name__="h3d.shader.Skin";
Hd.__super__=pd;Hd.prototype=D(pd.prototype,{updateConstants:function(a){this.constBits=0;var b=this.MaxBones__;if(0!=b>>>8)throw t.thrown("MaxBones is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.fourBonesByVertex__&&(this.constBits|=256);this.calcPrevPos__&&(this.constBits|=512);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.MaxBones__;case 1:return this.fourBonesByVertex__;case 2:return this.calcPrevPos__;case 3:return this.bonesMatrixes__;
case 4:return this.prevBonesMatrixes__}return null},getParamFloatValue:function(a){return 0==a?this.MaxBones__:0},clone:function(){var a=Object.create(Hd.prototype);a.shader=this.shader;a.MaxBones__=this.MaxBones__;a.fourBonesByVertex__=this.fourBonesByVertex__;a.calcPrevPos__=this.calcPrevPos__;a.bonesMatrixes__=this.bonesMatrixes__;a.prevBonesMatrixes__=this.prevBonesMatrixes__;return a},__class__:Hd});var ie=function(){pd.call(this)};ie.__name__="h3d.shader.SkinTangent";ie.__super__=pd;ie.prototype=
D(pd.prototype,{updateConstants:function(a){this.constBits=0;var b=this.MaxBones__;if(0!=b>>>8)throw t.thrown("MaxBones is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.fourBonesByVertex__&&(this.constBits|=256);this.calcPrevPos__&&(this.constBits|=512);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.MaxBones__;case 1:return this.fourBonesByVertex__;case 2:return this.calcPrevPos__;case 3:return this.bonesMatrixes__;case 4:return this.prevBonesMatrixes__}return null},
getParamFloatValue:function(a){return 0==a?this.MaxBones__:0},clone:function(){var a=Object.create(ie.prototype);a.shader=this.shader;a.MaxBones__=this.MaxBones__;a.fourBonesByVertex__=this.fourBonesByVertex__;a.calcPrevPos__=this.calcPrevPos__;a.bonesMatrixes__=this.bonesMatrixes__;a.prevBonesMatrixes__=this.prevBonesMatrixes__;return a},__class__:ie});var Ae=function(a){na.call(this);this.texture__=a};Ae.__name__="h3d.shader.SpecularTexture";Ae.__super__=na;Ae.prototype=D(na.prototype,{get_texture:function(){return this.texture__},
set_texture:function(a){return this.texture__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.texture__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.texture__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Ae.prototype);a.shader=this.shader;a.texture__=this.texture__;return a},__class__:Ae});var af=function(a){this.killAlphaThreshold__=0;na.call(this);
this.texture__=a;this.killAlphaThreshold__=Ad.defaultKillAlphaThreshold};af.__name__="h3d.shader.Texture";af.__super__=na;af.prototype=D(na.prototype,{get_additive:function(){return this.additive__},set_additive:function(a){this.constModified=!0;return this.additive__=a},get_killAlpha:function(){return this.killAlpha__},set_killAlpha:function(a){this.constModified=!0;return this.killAlpha__=a},get_specularAlpha:function(){return this.specularAlpha__},set_specularAlpha:function(a){this.constModified=
!0;return this.specularAlpha__=a},get_killAlphaThreshold:function(){return this.killAlphaThreshold__},set_killAlphaThreshold:function(a){return this.killAlphaThreshold__=a},get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},updateConstants:function(a){this.constBits=0;this.additive__&&(this.constBits|=1);this.killAlpha__&&(this.constBits|=2);this.specularAlpha__&&(this.constBits|=4);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.additive__;
case 1:return this.killAlpha__;case 2:return this.specularAlpha__;case 3:return this.killAlphaThreshold__;case 4:return this.texture__}return null},getParamFloatValue:function(a){return 3==a?this.killAlphaThreshold__:0},setParamIndexValue:function(a,b){switch(a){case 0:this.additive__=b;break;case 1:this.killAlpha__=b;break;case 2:this.specularAlpha__=b;break;case 3:this.killAlphaThreshold__=b;break;case 4:this.texture__=b}},setParamIndexFloatValue:function(a,b){3==a&&(this.killAlphaThreshold__=b)},
clone:function(){var a=Object.create(af.prototype);a.shader=this.shader;a.additive__=this.additive__;a.killAlpha__=this.killAlpha__;a.specularAlpha__=this.specularAlpha__;a.killAlphaThreshold__=this.killAlphaThreshold__;a.texture__=this.texture__;return a},__class__:af});var Kd=function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=0);null==a&&(a=0);this.uvScale__=new G(0,0,0);this.uvDelta__=new G(0,0,0);na.call(this);var e=this.uvDelta__;null==b&&(b=0);null==a&&(a=0);e.x=a;e.y=b;e.z=0;e=this.uvScale__;
a=c;b=d;null==b&&(b=0);null==a&&(a=0);e.x=a;e.y=b;e.z=0};Kd.__name__="h3d.shader.UVDelta";Kd.__super__=na;Kd.prototype=D(na.prototype,{get_uvDelta:function(){return this.uvDelta__},set_uvDelta:function(a){return this.uvDelta__=a},get_uvScale:function(){return this.uvScale__},set_uvScale:function(a){return this.uvScale__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.uvDelta__;case 1:return this.uvScale__}return null},
getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.uvDelta__=b;break;case 1:this.uvScale__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Kd.prototype);a.shader=this.shader;a.uvDelta__=this.uvDelta__;a.uvScale__=this.uvScale__;return a},__class__:Kd});var ff=function(){na.call(this)};ff.__name__="h3d.shader.VertexColorAlpha";ff.__super__=na;ff.prototype=D(na.prototype,{get_additive:function(){return this.additive__},set_additive:function(a){this.constModified=
!0;return this.additive__=a},updateConstants:function(a){this.constBits=0;this.additive__&&(this.constBits|=1);this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.additive__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.additive__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(ff.prototype);a.shader=this.shader;a.additive__=this.additive__;return a},__class__:ff});var Bd=function(a,b){this.isCentered__=
!0;this.tangent__=new G(0,0,0);this.normal__=new G(0,0,0);this.scale__=new G(0,0,0);na.call(this);var c=this.normal__,d=0,e=0,f=1;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c=this.tangent__;d=1;f=e=0;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c=this.scale__;d=1/a;e=1/b;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=0};Bd.__name__="h3d.shader.VolumeDecal";Bd.__super__=na;Bd.prototype=D(na.prototype,{get_scale:function(){return this.scale__},set_scale:function(a){return this.scale__=
a},get_normal:function(){return this.normal__},set_normal:function(a){return this.normal__=a},get_tangent:function(){return this.tangent__},set_tangent:function(a){return this.tangent__=a},get_isCentered:function(){return this.isCentered__},set_isCentered:function(a){this.constModified=!0;return this.isCentered__=a},updateConstants:function(a){this.constBits=0;this.isCentered__&&(this.constBits|=64);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.scale__;case 1:return this.normal__;
case 2:return this.tangent__;case 3:return this.isCentered__}return null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.scale__=b;break;case 1:this.normal__=b;break;case 2:this.tangent__=b;break;case 3:this.isCentered__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Bd.prototype);a.shader=this.shader;a.scale__=this.scale__;a.normal__=this.normal__;a.tangent__=this.tangent__;a.isCentered__=this.isCentered__;return a},
__class__:Bd});var Sc=K["haxe.StackItem"]={__ename__:!0,__constructs__:null,CFunction:{_hx_name:"CFunction",_hx_index:0,__enum__:"haxe.StackItem",toString:v},Module:(z=function(a){return{_hx_index:1,m:a,__enum__:"haxe.StackItem",toString:v}},z._hx_name="Module",z.__params__=["m"],z),FilePos:(z=function(a,b,c,d){return{_hx_index:2,s:a,file:b,line:c,column:d,__enum__:"haxe.StackItem",toString:v}},z._hx_name="FilePos",z.__params__=["s","file","line","column"],z),Method:(z=function(a,b){return{_hx_index:3,
classname:a,method:b,__enum__:"haxe.StackItem",toString:v}},z._hx_name="Method",z.__params__=["classname","method"],z),LocalFunction:(z=function(a){return{_hx_index:4,v:a,__enum__:"haxe.StackItem",toString:v}},z._hx_name="LocalFunction",z.__params__=["v"],z)};Sc.__constructs__=[Sc.CFunction,Sc.Module,Sc.FilePos,Sc.Method,Sc.LocalFunction];Sc.__empty_constructs__=[Sc.CFunction];var dj={callStack:function(){return tc.toHaxe(tc.callStack())}},He=function(){};He.__name__="haxe.IMap";He.__isInterface__=
!0;He.prototype={__class__:He};var Xd=function(){};Xd.__name__="haxe.EntryPoint";Xd.processEvents=function(){for(;;){var a=Xd.pending.shift();if(null==a)break;a()}a=yc.tick();return yc.hasEvents()||0!=Xd.threadCount?a:-1};Xd.run=function(){var a=Xd.processEvents();if("undefined"!=typeof window){var b=window;b=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame;null!=b?b(Xd.run):0<=a&&setTimeout(Xd.run,1E3*a)}else 0<=a&&setTimeout(Xd.run,1E3*a)};var $i={from:function(a){a=
1<<a._hx_index;null==a&&(a=0);return a}},t=function(a,b,c){Error.call(this,a);this.message=a;this.__previousException=b;this.__nativeException=null!=c?c:this};t.__name__="haxe.Exception";t.caught=function(a){return a instanceof t?a:a instanceof Error?new t(a.message,null,a):new gg(a,null,a)};t.thrown=function(a){return a instanceof t?a.get_native():a instanceof Error?a:new gg(a)};t.__super__=Error;t.prototype=D(Error.prototype,{unwrap:function(){return this.__nativeException},toString:function(){return this.get_message()},
get_message:function(){return this.message},get_native:function(){return this.__nativeException},__class__:t});var Ug=function(a,b){this.high=a;this.low=b};Ug.__name__="haxe._Int64.___Int64";Ug.prototype={__class__:Ug};var $a=function(){};$a.__name__="haxe.Log";$a.formatOutput=function(a,b){var c=y.string(a);if(null==b)return c;var d=b.fileName+":"+b.lineNumber;if(null!=b.customParams){var e=0;for(b=b.customParams;e<b.length;)a=b[e],++e,c+=", "+y.string(a)}return d+": "+c};$a.trace=function(a,b){a=
$a.formatOutput(a,b);"undefined"!=typeof console&&null!=console.log&&console.log(a)};var ci=function(a,b){this.isBlocking=!0;this.f=a;this.priority=b;this.nextRun=-Infinity};ci.__name__="haxe.MainEvent";ci.prototype={stop:function(){null!=this.f&&(this.f=null,this.nextRun=-Infinity,null==this.prev?yc.pending=this.next:this.prev.next=this.next,null!=this.next&&(this.next.prev=this.prev))},__class__:ci};var yc=function(){};yc.__name__="haxe.MainLoop";yc.hasEvents=function(){for(var a=yc.pending;null!=
a;){if(a.isBlocking)return!0;a=a.next}return!1};yc.add=function(a,b){null==b&&(b=0);if(null==a)throw t.thrown("Event function is null");a=new ci(a,b);b=yc.pending;null!=b&&(b.prev=a);a.next=b;return yc.pending=a};yc.sortEvents=function(){var a=yc.pending;if(null!=a){for(var b=1,c,d,e,f,g,h,k;;){f=a;k=a=null;for(c=0;null!=f;){++c;g=f;e=d=0;for(h=b;e<h&&(e++,++d,g=g.next,null!=g););for(e=b;0<d||0<e&&null!=g;)0==d?(h=g,g=g.next,--e):0==e||null==g||f.priority>g.priority||f.priority==g.priority&&f.nextRun<=
g.nextRun?(h=f,f=f.next,--d):(h=g,g=g.next,--e),null!=k?k.next=h:a=h,h.prev=k,k=h;f=g}k.next=null;if(1>=c)break;b*=2}a.prev=null;yc.pending=a}};yc.tick=function(){yc.sortEvents();for(var a=yc.pending,b=F.now()/1E3,c=1E9;null!=a;){var d=a.next,e=a.nextRun-b;0>=e?(c=0,null!=a.f&&a.f()):c>e&&(c=e);a=d}return c};var tc=function(){};tc.__name__="haxe.NativeStackTrace";tc.callStack=function(){var a=Error(""),b=tc.tryHaxeStack(a);if("undefined"==typeof b){try{throw a;}catch(c){}b=a.stack}return tc.normalize(b,
2)};tc.toHaxe=function(a,b){null==b&&(b=0);if(null==a)return[];if("string"==typeof a){a=a.split("\n");"Error"==a[0]&&a.shift();for(var c=[],d=0,e=a.length;d<e;){var f=d++;if(!(b>f)){var g=a[f];f=g.match(/^    at ([$A-Za-z0-9_. ]+) \(([^)]+):([0-9]+):([0-9]+)\)$/);if(null!=f){g=f[1].split(".");"$hxClasses"==g[0]&&g.shift();var h=g.pop(),k=f[2],l=y.parseInt(f[3]);f=y.parseInt(f[4]);c.push(Sc.FilePos("Anonymous function"==h?Sc.LocalFunction():"Global code"==h?null:Sc.Method(g.join("."),h),k,l,f))}else c.push(Sc.Module(X.trim(g)))}}return c}return 0<
b&&Array.isArray(a)?a.slice(b):a};tc.tryHaxeStack=function(a){if(null==a)return[];var b=Error.prepareStackTrace;Error.prepareStackTrace=tc.prepareHxStackTrace;a=a.stack;Error.prepareStackTrace=b;return a};tc.prepareHxStackTrace=function(a,b){a=[];for(var c=0;c<b.length;){var d=b[c];++c;null!=tc.wrapCallSite&&(d=tc.wrapCallSite(d));var e=null,f=d.getFunctionName();if(null!=f){var g=f.lastIndexOf(".");0<=g?(e=f.substring(0,g),f=f.substring(g+1),e=Sc.Method(e,f)):e=Sc.Method(null,f)}f=d.getFileName();
g=null==f?-1:f.indexOf("file:");null!=tc.wrapCallSite&&0<g&&(f=f.substring(g+6));a.push(Sc.FilePos(e,f,d.getLineNumber(),d.getColumnNumber()))}return a};tc.normalize=function(a,b){null==b&&(b=0);if(Array.isArray(a)&&0<b)return a.slice(b);if("string"==typeof a){switch(a.substring(0,6)){case "Error\n":case "Error:":++b}return tc.skipLines(a,b)}return a};tc.skipLines=function(a,b,c){null==c&&(c=0);return 0<b?(c=a.indexOf("\n",c),0>c?"":tc.skipLines(a,--b,c+1)):a.substring(c)};var qe=function(a){var b=
this;this.id=setInterval(function(){b.run()},a)};qe.__name__="haxe.Timer";qe.delay=function(a,b){var c=new qe(b);c.run=function(){c.stop();a()};return c};qe.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:qe};var gg=function(a,b,c){t.call(this,String(a),b,c);this.value=a};gg.__name__="haxe.ValueException";gg.__super__=t;gg.prototype=D(t.prototype,{unwrap:function(){return this.value},__class__:gg});var zf=function(){this.a1=1;this.a2=0};
zf.__name__="haxe.crypto.Adler32";zf.read=function(a){var b=new zf,c=a.readByte(),d=a.readByte(),e=a.readByte();a=a.readByte();b.a1=e<<8|a;b.a2=c<<8|d;return b};zf.prototype={update:function(a,b,c){var d=this.a1,e=this.a2,f=b;for(b+=c;f<b;)c=f++,d=(d+a.b[c])%65521,e=(e+d)%65521;this.a1=d;this.a2=e},equals:function(a){return a.a1==this.a1?a.a2==this.a2:!1},__class__:zf};var S=function(a){this.length=a.byteLength;this.b=new Uint8Array(a);this.b.bufferValue=a;a.hxBytes=this;a.bytes=this.b};S.__name__=
"haxe.io.Bytes";S.ofString=function(a,b){if(b==Ie.RawNative){for(var c=new Uint8Array(a.length<<1),d=0,e=a.length;d<e;){var f=d++;b=a.charCodeAt(f);c[f<<1]=b&255;c[f<<1|1]=b>>8}return new S(c.buffer)}c=[];for(f=0;f<a.length;)b=a.charCodeAt(f++),55296<=b&&56319>=b&&(b=b-55232<<10|a.charCodeAt(f++)&1023),127>=b?c.push(b):(2047>=b?c.push(192|b>>6):(65535>=b?c.push(224|b>>12):(c.push(240|b>>18),c.push(128|b>>12&63)),c.push(128|b>>6&63)),c.push(128|b&63));return new S((new Uint8Array(c)).buffer)};S.ofData=
function(a){var b=a.hxBytes;return null!=b?b:new S(a)};S.prototype={blit:function(a,b,c,d){if(0>a||0>c||0>d||a+d>this.length||c+d>b.length)throw t.thrown(Kb.OutsideBounds);0==c&&d==b.b.byteLength?this.b.set(b.b,a):this.b.set(b.b.subarray(c,c+d),a)},fill:function(a,b,c){for(var d=0;d<b;)d++,this.b[a++]=c},sub:function(a,b){if(0>a||0>b||a+b>this.length)throw t.thrown(Kb.OutsideBounds);return new S(this.b.buffer.slice(a+this.b.byteOffset,a+this.b.byteOffset+b))},getFloat:function(a){null==this.data&&
(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));return this.data.getFloat32(a,!0)},setFloat:function(a,b){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));this.data.setFloat32(a,b,!0)},getUInt16:function(a){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));return this.data.getUint16(a,!0)},setUInt16:function(a,b){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,
this.b.byteLength));this.data.setUint16(a,b,!0)},getInt32:function(a){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));return this.data.getInt32(a,!0)},setInt32:function(a,b){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));this.data.setInt32(a,b,!0)},getString:function(a,b,c){if(0>a||0>b||a+b>this.length)throw t.thrown(Kb.OutsideBounds);null==c&&(c=Ie.UTF8);var d="",e=this.b,f=a;a+=b;switch(c._hx_index){case 0:for(;f<
a;){c=e[f++];if(128>c){if(0==c)break}else if(224>c)c=(c&63)<<6|e[f++]&127;else if(240>c)b=e[f++],c=(c&31)<<12|(b&127)<<6|e[f++]&127;else{b=e[f++];var g=e[f++];c=(c&15)<<18|(b&127)<<12|(g&127)<<6|e[f++]&127}d+=String.fromCodePoint(c)}break;case 1:for(;f<a;)c=e[f++]|e[f++]<<8,d+=String.fromCodePoint(c)}return d},toString:function(){return this.getString(0,this.length)},__class__:S};var Ie=K["haxe.io.Encoding"]={__ename__:!0,__constructs__:null,UTF8:{_hx_name:"UTF8",_hx_index:0,__enum__:"haxe.io.Encoding",
toString:v},RawNative:{_hx_name:"RawNative",_hx_index:1,__enum__:"haxe.io.Encoding",toString:v}};Ie.__constructs__=[Ie.UTF8,Ie.RawNative];Ie.__empty_constructs__=[Ie.UTF8,Ie.RawNative];var Yd=function(){};Yd.__name__="haxe.crypto.Base64";Yd.encode=function(a,b){null==b&&(b=!0);var c=(new Vg(Yd.BYTES)).encodeBytes(a).toString();if(b)switch(a.length%3){case 1:c+="==";break;case 2:c+="="}return c};Yd.decode=function(a,b){null==b&&(b=!0);if(b)for(;61==F.cca(a,a.length-1);)a=F.substr(a,0,-1);return(new Vg(Yd.BYTES)).decodeBytes(S.ofString(a))};
var Vg=function(a){for(var b=a.length,c=1;b>1<<c;)++c;if(8<c||b!=1<<c)throw t.thrown("BaseCode : base length must be a power of two.");this.base=a;this.nbits=c};Vg.__name__="haxe.crypto.BaseCode";Vg.prototype={encodeBytes:function(a){for(var b=this.nbits,c=this.base,d=8*a.length/b|0,e=new S(new ArrayBuffer(d+(0==8*a.length%b?0:1))),f=0,g=0,h=(1<<b)-1,k=0,l=0;l<d;){for(;g<b;)g+=8,f<<=8,f|=a.b[k++];g-=b;e.b[l++]=c.b[f>>g&h]}0<g&&(e.b[l++]=c.b[f<<b-g&h]);return e},initTable:function(){for(var a,b=[],
c=0;256>c;)a=c++,b[a]=-1;c=0;for(var d=this.base.length;c<d;)a=c++,b[this.base.b[a]]=a;this.tbl=b},decodeBytes:function(a){var b=this.nbits;null==this.tbl&&this.initTable();for(var c=this.tbl,d=a.length*b>>3,e=new S(new ArrayBuffer(d)),f=0,g=0,h=0,k=0;k<d;){for(;8>g;){g+=b;f<<=b;var l=c[a.b[h++]];if(-1==l)throw t.thrown("BaseCode : invalid encoded char");f|=l}g-=8;e.b[k++]=f>>g&255}return e},__class__:Vg};var Ic=function(){};Ic.__name__="haxe.crypto.Md5";Ic.encode=function(a){var b=new Ic;a=b.doEncode(Ic.str2blks(a));
return b.hex(a)};Ic.str2blks=function(a){var b=S.ofString(a),c=(b.length+8>>6)+1;a=[];for(var d=0,e=16*c;d<e;){var f=d++;a[f]=0}f=0;e=b.length;for(d=8*e;f<e;)a[f>>2]|=b.b[f]<<(d+f)%4*8,++f;a[f>>2]|=128<<(d+f)%4*8;f=16*c-2;a[f]=d&255;a[f]|=(d>>>8&255)<<8;a[f]|=(d>>>16&255)<<16;a[f]|=(d>>>24&255)<<24;return a};Ic.prototype={bitOR:function(a,b){return(a>>>1|b>>>1)<<1|a&1|b&1},bitXOR:function(a,b){return(a>>>1^b>>>1)<<1|a&1^b&1},bitAND:function(a,b){return(a>>>1&b>>>1)<<1|a&1&b&1},addme:function(a,b){var c=
(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535},hex:function(a){for(var b="",c=0;c<a.length;){var d=a[c];++c;b+="0123456789abcdef".charAt(d>>4&15)+"0123456789abcdef".charAt(d&15);b+="0123456789abcdef".charAt(d>>12&15)+"0123456789abcdef".charAt(d>>8&15);b+="0123456789abcdef".charAt(d>>20&15)+"0123456789abcdef".charAt(d>>16&15);b+="0123456789abcdef".charAt(d>>28&15)+"0123456789abcdef".charAt(d>>24&15)}return b},rol:function(a,b){return a<<b|a>>>32-b},cmn:function(a,b,c,d,e,f){return this.addme(this.rol(this.addme(this.addme(b,
a),this.addme(d,f)),e),c)},ff:function(a,b,c,d,e,f,g){return this.cmn(this.bitOR(this.bitAND(b,c),this.bitAND(~b,d)),a,b,e,f,g)},gg:function(a,b,c,d,e,f,g){return this.cmn(this.bitOR(this.bitAND(b,d),this.bitAND(c,~d)),a,b,e,f,g)},hh:function(a,b,c,d,e,f,g){return this.cmn(this.bitXOR(this.bitXOR(b,c),d),a,b,e,f,g)},ii:function(a,b,c,d,e,f,g){return this.cmn(this.bitXOR(c,this.bitOR(b,~d)),a,b,e,f,g)},doEncode:function(a){for(var b=1732584193,c=-271733879,d=-1732584194,e=271733878,f=0;f<a.length;){var g=
b,h=c,k=d,l=e;b=this.ff(b,c,d,e,a[f],7,-680876936);e=this.ff(e,b,c,d,a[f+1],12,-389564586);d=this.ff(d,e,b,c,a[f+2],17,606105819);c=this.ff(c,d,e,b,a[f+3],22,-1044525330);b=this.ff(b,c,d,e,a[f+4],7,-176418897);e=this.ff(e,b,c,d,a[f+5],12,1200080426);d=this.ff(d,e,b,c,a[f+6],17,-1473231341);c=this.ff(c,d,e,b,a[f+7],22,-45705983);b=this.ff(b,c,d,e,a[f+8],7,1770035416);e=this.ff(e,b,c,d,a[f+9],12,-1958414417);d=this.ff(d,e,b,c,a[f+10],17,-42063);c=this.ff(c,d,e,b,a[f+11],22,-1990404162);b=this.ff(b,
c,d,e,a[f+12],7,1804603682);e=this.ff(e,b,c,d,a[f+13],12,-40341101);d=this.ff(d,e,b,c,a[f+14],17,-1502002290);c=this.ff(c,d,e,b,a[f+15],22,1236535329);b=this.gg(b,c,d,e,a[f+1],5,-165796510);e=this.gg(e,b,c,d,a[f+6],9,-1069501632);d=this.gg(d,e,b,c,a[f+11],14,643717713);c=this.gg(c,d,e,b,a[f],20,-373897302);b=this.gg(b,c,d,e,a[f+5],5,-701558691);e=this.gg(e,b,c,d,a[f+10],9,38016083);d=this.gg(d,e,b,c,a[f+15],14,-660478335);c=this.gg(c,d,e,b,a[f+4],20,-405537848);b=this.gg(b,c,d,e,a[f+9],5,568446438);
e=this.gg(e,b,c,d,a[f+14],9,-1019803690);d=this.gg(d,e,b,c,a[f+3],14,-187363961);c=this.gg(c,d,e,b,a[f+8],20,1163531501);b=this.gg(b,c,d,e,a[f+13],5,-1444681467);e=this.gg(e,b,c,d,a[f+2],9,-51403784);d=this.gg(d,e,b,c,a[f+7],14,1735328473);c=this.gg(c,d,e,b,a[f+12],20,-1926607734);b=this.hh(b,c,d,e,a[f+5],4,-378558);e=this.hh(e,b,c,d,a[f+8],11,-2022574463);d=this.hh(d,e,b,c,a[f+11],16,1839030562);c=this.hh(c,d,e,b,a[f+14],23,-35309556);b=this.hh(b,c,d,e,a[f+1],4,-1530992060);e=this.hh(e,b,c,d,a[f+
4],11,1272893353);d=this.hh(d,e,b,c,a[f+7],16,-155497632);c=this.hh(c,d,e,b,a[f+10],23,-1094730640);b=this.hh(b,c,d,e,a[f+13],4,681279174);e=this.hh(e,b,c,d,a[f],11,-358537222);d=this.hh(d,e,b,c,a[f+3],16,-722521979);c=this.hh(c,d,e,b,a[f+6],23,76029189);b=this.hh(b,c,d,e,a[f+9],4,-640364487);e=this.hh(e,b,c,d,a[f+12],11,-421815835);d=this.hh(d,e,b,c,a[f+15],16,530742520);c=this.hh(c,d,e,b,a[f+2],23,-995338651);b=this.ii(b,c,d,e,a[f],6,-198630844);e=this.ii(e,b,c,d,a[f+7],10,1126891415);d=this.ii(d,
e,b,c,a[f+14],15,-1416354905);c=this.ii(c,d,e,b,a[f+5],21,-57434055);b=this.ii(b,c,d,e,a[f+12],6,1700485571);e=this.ii(e,b,c,d,a[f+3],10,-1894986606);d=this.ii(d,e,b,c,a[f+10],15,-1051523);c=this.ii(c,d,e,b,a[f+1],21,-2054922799);b=this.ii(b,c,d,e,a[f+8],6,1873313359);e=this.ii(e,b,c,d,a[f+15],10,-30611744);d=this.ii(d,e,b,c,a[f+6],15,-1560198380);c=this.ii(c,d,e,b,a[f+13],21,1309151649);b=this.ii(b,c,d,e,a[f+4],6,-145523070);e=this.ii(e,b,c,d,a[f+11],10,-1120210379);d=this.ii(d,e,b,c,a[f+2],15,718787259);
c=this.ii(c,d,e,b,a[f+9],21,-343485551);b=this.addme(b,g);c=this.addme(c,h);d=this.addme(d,k);e=this.addme(e,l);f+=16}return[b,c,d,e]},__class__:Ic};var ub=function(){};ub.__name__="haxe.ds.ArraySort";ub.sort=function(a,b){ub.rec(a,b,0,a.length)};ub.rec=function(a,b,c,d){var e=c+d>>1;if(12>d-c){if(!(d<=c))for(e=c+1;e<d;)for(var f=e++;f>c;){if(0>b(a[f],a[f-1]))ub.swap(a,f-1,f);else break;--f}}else ub.rec(a,b,c,e),ub.rec(a,b,e,d),ub.doMerge(a,b,c,e,d,e-c,d-e)};ub.doMerge=function(a,b,c,d,e,f,g){if(0!=
f&&0!=g)if(2==f+g)0>b(a[d],a[c])&&ub.swap(a,d,c);else{if(f>g){var h=f>>1;var k=c+h;var l=ub.lower(a,b,d,e,k);var m=l-d}else m=g>>1,l=d+m,k=ub.upper(a,b,c,d,l),h=k-c;ub.rotate(a,b,k,d,l);d=k+m;ub.doMerge(a,b,c,k,d,h,m);ub.doMerge(a,b,d,l,e,f-h,g-m)}};ub.rotate=function(a,b,c,d,e){if(c!=d&&d!=e)for(b=ub.gcd(e-c,d-c);0!=b--;){for(var f=a[c+b],g=d-c,h=c+b,k=c+b+g;k!=c+b;)a[h]=a[k],h=k,k=e-k>g?k+g:c+(g-(e-k));a[h]=f}};ub.gcd=function(a,b){for(;0!=b;){var c=a%b;a=b;b=c}return a};ub.upper=function(a,b,c,
d,e){d-=c;for(var f,g;0<d;)f=d>>1,g=c+f,0>b(a[e],a[g])?d=f:(c=g+1,d=d-f-1);return c};ub.lower=function(a,b,c,d,e){d-=c;for(var f,g;0<d;)f=d>>1,g=c+f,0>b(a[g],a[e])?(c=g+1,d=d-f-1):d=f;return c};ub.swap=function(a,b,c){var d=a[b];a[b]=a[c];a[c]=d};var hg=function(){};hg.__name__="haxe.ds.BalancedTree";hg.__interfaces__=[He];hg.prototype={set:function(a,b){this.root=this.setLoop(a,b,this.root)},get:function(a){for(var b=this.root;null!=b;){var c=this.compare(a,b.key);if(0==c)return b.value;b=0>c?b.left:
b.right}return null},keys:function(){var a=[];this.keysLoop(this.root,a);return new td(a)},setLoop:function(a,b,c){if(null==c)return new Wb(null,a,b,null);var d=this.compare(a,c.key);if(0==d)return new Wb(c.left,a,b,c.right,null==c?0:c._height);if(0>d)return a=this.setLoop(a,b,c.left),this.balance(a,c.key,c.value,c.right);a=this.setLoop(a,b,c.right);return this.balance(c.left,c.key,c.value,a)},keysLoop:function(a,b){null!=a&&(this.keysLoop(a.left,b),b.push(a.key),this.keysLoop(a.right,b))},balance:function(a,
b,c,d){var e=null==a?0:a._height;var f=null==d?0:d._height;return e>f+2?(f=a.left,e=a.right,(null==f?0:f._height)>=(null==e?0:e._height)?new Wb(a.left,a.key,a.value,new Wb(a.right,b,c,d)):new Wb(new Wb(a.left,a.key,a.value,a.right.left),a.right.key,a.right.value,new Wb(a.right.right,b,c,d))):f>e+2?(f=d.right,e=d.left,(null==f?0:f._height)>(null==e?0:e._height)?new Wb(new Wb(a,b,c,d.left),d.key,d.value,d.right):new Wb(new Wb(a,b,c,d.left.left),d.left.key,d.left.value,new Wb(d.left.right,d.key,d.value,
d.right))):new Wb(a,b,c,d,(e>f?e:f)+1)},compare:function(a,b){return sa.compare(a,b)},__class__:hg};var Wb=function(a,b,c,d,e){null==e&&(e=-1);this.left=a;this.key=b;this.value=c;this.right=d;-1==e?(a=this.left,b=this.right,a=(null==a?0:a._height)>(null==b?0:b._height)?this.left:this.right,this._height=(null==a?0:a._height)+1):this._height=e};Wb.__name__="haxe.ds.TreeNode";Wb.prototype={__class__:Wb};var $e=function(){};$e.__name__="haxe.ds.EnumValueMap";$e.__interfaces__=[He];$e.__super__=hg;$e.prototype=
D(hg.prototype,{compare:function(a,b){var c=a._hx_index-b._hx_index;if(0!=c)return c;a=da.enumParameters(a);b=da.enumParameters(b);return 0==a.length&&0==b.length?0:this.compareArgs(a,b)},compareArgs:function(a,b){var c=a.length-b.length;if(0!=c)return c;c=0;for(var d=a.length;c<d;){var e=c++;e=this.compareArg(a[e],b[e]);if(0!=e)return e}return 0},compareArg:function(a,b){return sa.isEnumValue(a)&&sa.isEnumValue(b)?this.compare(a,b):a instanceof Array&&b instanceof Array?this.compareArgs(a,b):sa.compare(a,
b)},__class__:$e});var Fa=function(){this.h={}};Fa.__name__="haxe.ds.IntMap";Fa.__interfaces__=[He];Fa.prototype={get:function(a){return this.h[a]},remove:function(a){if(!this.h.hasOwnProperty(a))return!1;delete this.h[a];return!0},keys:function(){var a=[],b;for(b in this.h)this.h.hasOwnProperty(b)&&a.push(+b);return new td(a)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var a=this.it.next();return this.ref[a]}}},__class__:Fa};
var vd=function(){this.length=0};vd.__name__="haxe.ds.List";vd.prototype={add:function(a){a=new Wg(a,null);null==this.h?this.h=a:this.q.next=a;this.q=a;this.length++},push:function(a){this.h=a=new Wg(a,this.h);null==this.q&&(this.q=a);this.length++},remove:function(a){for(var b=null,c=this.h;null!=c;){if(c.item==a)return null==b?this.h=c.next:b.next=c.next,this.q==c&&(this.q=b),this.length--,!0;b=c;c=c.next}return!1},__class__:vd};var Wg=function(a,b){this.item=a;this.next=b};Wg.__name__="haxe.ds._List.ListNode";
Wg.prototype={__class__:Wg};var Cc=function(){this.h={__keys__:{}}};Cc.__name__="haxe.ds.ObjectMap";Cc.__interfaces__=[He];Cc.prototype={set:function(a,b){var c=a.__id__;null==c&&(c=a.__id__=R.$haxeUID++);this.h[c]=b;this.h.__keys__[c]=a},get:function(a){return this.h[a.__id__]},remove:function(a){a=a.__id__;if(null==this.h.__keys__[a])return!1;delete this.h[a];delete this.h.__keys__[a];return!0},keys:function(){var a=[],b;for(b in this.h.__keys__)this.h.hasOwnProperty(b)&&a.push(this.h.__keys__[b]);
return new td(a)},__class__:Cc};var Sa=function(){this.h=Object.create(null)};Sa.__name__="haxe.ds.StringMap";Sa.__interfaces__=[He];Sa.prototype={get:function(a){return this.h[a]},keys:function(){return new di(this.h)},iterator:function(){return new ei(this.h)},__class__:Sa};var di=function(a){this.h=a;this.keys=Object.keys(a);this.length=this.keys.length;this.current=0};di.__name__="haxe.ds._StringMap.StringMapKeyIterator";di.prototype={hasNext:function(){return this.current<this.length},next:function(){return this.keys[this.current++]},
__class__:di};var ei=function(a){this.h=a;this.keys=Object.keys(a);this.length=this.keys.length;this.current=0};ei.__name__="haxe.ds._StringMap.StringMapValueIterator";ei.prototype={hasNext:function(){return this.current<this.length},next:function(){return this.h[this.keys[this.current++]]},__class__:ei};var cj={blit:function(a,b,c,d,e){var f;if(a==c)if(b<d){var g=b+e;b=d+e;for(f=0;f<e;)f++,--g,--b,a[b]=a[g]}else{if(b>d)for(g=b,b=d,f=0;f<e;)f++,a[b]=a[g],++g,++b}else for(f=0;f<e;)g=f++,c[d+g]=a[b+
g]}},Af=function(a,b,c){t.call(this,a,b);this.posInfos=null==c?{fileName:"(unknown)",lineNumber:0,className:"(unknown)",methodName:"(unknown)"}:c};Af.__name__="haxe.exceptions.PosException";Af.__super__=t;Af.prototype=D(t.prototype,{toString:function(){return""+t.prototype.toString.call(this)+" in "+this.posInfos.className+"."+this.posInfos.methodName+" at "+this.posInfos.fileName+":"+this.posInfos.lineNumber},__class__:Af});var Bf=function(a,b,c){null==a&&(a="Not implemented");Af.call(this,a,b,c)};
Bf.__name__="haxe.exceptions.NotImplementedException";Bf.__super__=Af;Bf.prototype=D(Af.prototype,{__class__:Bf});var Id=function(){this.size=this.pos=0};Id.__name__="haxe.io.BytesBuffer";Id.prototype={addByte:function(a){this.pos==this.size&&this.grow(1);this.view.setUint8(this.pos++,a)},add:function(a){this.pos+a.length>this.size&&this.grow(a.length);if(0!=this.size){var b=new Uint8Array(a.b.buffer,a.b.byteOffset,a.length);this.u8.set(b,this.pos);this.pos+=a.length}},addInt32:function(a){this.pos+
4>this.size&&this.grow(4);this.view.setInt32(this.pos,a,!0);this.pos+=4},addFloat:function(a){this.pos+4>this.size&&this.grow(4);this.view.setFloat32(this.pos,a,!0);this.pos+=4},addDouble:function(a){this.pos+8>this.size&&this.grow(8);this.view.setFloat64(this.pos,a,!0);this.pos+=8},addBytes:function(a,b,c){if(0>b||0>c||b+c>a.length)throw t.thrown(Kb.OutsideBounds);this.pos+c>this.size&&this.grow(c);0!=this.size&&(a=new Uint8Array(a.b.buffer,a.b.byteOffset+b,c),this.u8.set(a,this.pos),this.pos+=c)},
grow:function(a){var b=this.pos+a;for(a=0==this.size?16:this.size;a<b;)a=3*a>>1;b=new ArrayBuffer(a);var c=new Uint8Array(b);0<this.size&&c.set(this.u8);this.size=a;this.buffer=b;this.u8=c;this.view=new DataView(this.buffer)},getBytes:function(){if(0==this.size)return new S(new ArrayBuffer(0));var a=new S(this.buffer);a.length=this.pos;return a},__class__:Id};var Cf=function(){};Cf.__name__="haxe.io.Input";Cf.prototype={readByte:function(){throw new Bf(null,null,{fileName:"haxe/io/Input.hx",lineNumber:53,
className:"haxe.io.Input",methodName:"readByte"});},readBytes:function(a,b,c){var d=c,e=a.b;if(0>b||0>c||b+c>a.length)throw t.thrown(Kb.OutsideBounds);try{for(;0<d;)e[b]=this.readByte(),++b,--d}catch(f){if(!(t.caught(f).unwrap()instanceof dd))throw f;}return c-d},set_bigEndian:function(a){return this.bigEndian=a},readFullBytes:function(a,b,c){for(;0<c;){var d=this.readBytes(a,b,c);if(0==d)throw t.thrown(Kb.Blocked);b+=d;c-=d}},read:function(a){for(var b=new S(new ArrayBuffer(a)),c=0;0<a;){var d=this.readBytes(b,
c,a);if(0==d)throw t.thrown(Kb.Blocked);c+=d;a-=d}return b},readLine:function(){var a=new Id;try{for(;;){var b=this.readByte();if(10==b)break;a.addByte(b)}var c=a.getBytes().toString();13==F.cca(c,c.length-1)&&(c=F.substr(c,0,-1))}catch(d){if(b=t.caught(d).unwrap(),b instanceof dd){if(c=a.getBytes().toString(),0==c.length)throw t.thrown(b);}else throw d;}return c},readFloat:function(){return hb.i32ToFloat(this.readInt32())},readDouble:function(){var a=this.readInt32(),b=this.readInt32();return this.bigEndian?
hb.i64ToDouble(b,a):hb.i64ToDouble(a,b)},readInt8:function(){var a=this.readByte();return 128<=a?a-256:a},readInt16:function(){var a=this.readByte(),b=this.readByte();a=this.bigEndian?b|a<<8:a|b<<8;return 0!=(a&32768)?a-65536:a},readUInt16:function(){var a=this.readByte(),b=this.readByte();return this.bigEndian?b|a<<8:a|b<<8},readUInt24:function(){var a=this.readByte(),b=this.readByte(),c=this.readByte();return this.bigEndian?c|b<<8|a<<16:a|b<<8|c<<16},readInt32:function(){var a=this.readByte(),b=
this.readByte(),c=this.readByte(),d=this.readByte();return this.bigEndian?d|c<<8|b<<16|a<<24:a|b<<8|c<<16|d<<24},readString:function(a,b){var c=new S(new ArrayBuffer(a));this.readFullBytes(c,0,a);return c.getString(0,a,b)},__class__:Cf};var Vb=function(a,b,c){null==b&&(b=0);null==c&&(c=a.length-b);if(0>b||0>c||b+c>a.length)throw t.thrown(Kb.OutsideBounds);this.b=a.b;this.pos=b;this.totlen=this.len=c};Vb.__name__="haxe.io.BytesInput";Vb.__super__=Cf;Vb.prototype=D(Cf.prototype,{set_position:function(a){0>
a?a=0:a>this.totlen&&(a=this.totlen);this.len=this.totlen-a;return this.pos=a},readByte:function(){if(0==this.len)throw t.thrown(new dd);this.len--;return this.b[this.pos++]},readBytes:function(a,b,c){if(0>b||0>c||b+c>a.length)throw t.thrown(Kb.OutsideBounds);if(0==this.len&&0<c)throw t.thrown(new dd);this.len<c&&(c=this.len);var d=this.b;a=a.b;for(var e=0,f=c;e<f;){var g=e++;a[b+g]=d[this.pos+g]}this.pos+=c;this.len-=c;return c},__class__:Vb});var Xg=function(){};Xg.__name__="haxe.io.Output";Xg.prototype=
{writeByte:function(a){throw new Bf(null,null,{fileName:"haxe/io/Output.hx",lineNumber:47,className:"haxe.io.Output",methodName:"writeByte"});},writeBytes:function(a,b,c){if(0>b||0>c||b+c>a.length)throw t.thrown(Kb.OutsideBounds);a=a.b;for(var d=c;0<d;)this.writeByte(a[b]),++b,--d;return c},flush:function(){},close:function(){},set_bigEndian:function(a){return this.bigEndian=a},write:function(a){for(var b=a.length,c=0;0<b;){var d=this.writeBytes(a,c,b);if(0==d)throw t.thrown(Kb.Blocked);c+=d;b-=d}},
writeFullBytes:function(a,b,c){for(;0<c;){var d=this.writeBytes(a,b,c);b+=d;c-=d}},writeFloat:function(a){this.writeInt32(hb.floatToI32(a))},writeDouble:function(a){a=hb.doubleToI64(a);this.bigEndian?(this.writeInt32(a.high),this.writeInt32(a.low)):(this.writeInt32(a.low),this.writeInt32(a.high))},writeInt8:function(a){if(-128>a||128<=a)throw t.thrown(Kb.Overflow);this.writeByte(a&255)},writeInt16:function(a){if(-32768>a||32768<=a)throw t.thrown(Kb.Overflow);this.writeUInt16(a&65535)},writeUInt16:function(a){if(0>
a||65536<=a)throw t.thrown(Kb.Overflow);this.bigEndian?(this.writeByte(a>>8),this.writeByte(a&255)):(this.writeByte(a&255),this.writeByte(a>>8))},writeInt32:function(a){this.bigEndian?(this.writeByte(a>>>24),this.writeByte(a>>16&255),this.writeByte(a>>8&255),this.writeByte(a&255)):(this.writeByte(a&255),this.writeByte(a>>8&255),this.writeByte(a>>16&255),this.writeByte(a>>>24))},writeString:function(a,b){a=S.ofString(a,b);this.writeFullBytes(a,0,a.length)},__class__:Xg};var Yc=function(){this.b=new Id};
Yc.__name__="haxe.io.BytesOutput";Yc.__super__=Xg;Yc.prototype=D(Xg.prototype,{writeByte:function(a){this.b.addByte(a)},writeBytes:function(a,b,c){this.b.addBytes(a,b,c);return c},getBytes:function(){return this.b.getBytes()},__class__:Yc});var dd=function(){};dd.__name__="haxe.io.Eof";dd.prototype={toString:function(){return"Eof"},__class__:dd};var Kb=K["haxe.io.Error"]={__ename__:!0,__constructs__:null,Blocked:{_hx_name:"Blocked",_hx_index:0,__enum__:"haxe.io.Error",toString:v},Overflow:{_hx_name:"Overflow",
_hx_index:1,__enum__:"haxe.io.Error",toString:v},OutsideBounds:{_hx_name:"OutsideBounds",_hx_index:2,__enum__:"haxe.io.Error",toString:v},Custom:(z=function(a){return{_hx_index:3,e:a,__enum__:"haxe.io.Error",toString:v}},z._hx_name="Custom",z.__params__=["e"],z)};Kb.__constructs__=[Kb.Blocked,Kb.Overflow,Kb.OutsideBounds,Kb.Custom];Kb.__empty_constructs__=[Kb.Blocked,Kb.Overflow,Kb.OutsideBounds];var hb=function(){};hb.__name__="haxe.io.FPHelper";hb.i32ToFloat=function(a){hb.helper.setInt32(0,a,!0);
return hb.helper.getFloat32(0,!0)};hb.floatToI32=function(a){hb.helper.setFloat32(0,a,!0);return hb.helper.getInt32(0,!0)};hb.i64ToDouble=function(a,b){hb.helper.setInt32(0,a,!0);hb.helper.setInt32(4,b,!0);return hb.helper.getFloat64(0,!0)};hb.doubleToI64=function(a){var b=hb.i64tmp;hb.helper.setFloat64(0,a,!0);b.low=hb.helper.getInt32(0,!0);b.high=hb.helper.getInt32(4,!0);return b};var ig=function(a){switch(a){case ".":case "..":this.dir=a;this.file="";return}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");
b<c?(this.dir=F.substr(a,0,c),a=F.substr(a,c+1,null),this.backslash=!0):c<b?(this.dir=F.substr(a,0,b),a=F.substr(a,b+1,null)):this.dir=null;b=a.lastIndexOf(".");-1!=b?(this.ext=F.substr(a,b+1,null),this.file=F.substr(a,0,b)):(this.ext=null,this.file=a)};ig.__name__="haxe.io.Path";ig.extension=function(a){a=new ig(a);return null==a.ext?"":a.ext};ig.prototype={__class__:ig};var td=function(a){this.current=0;this.array=a};td.__name__="haxe.iterators.ArrayIterator";td.prototype={hasNext:function(){return this.current<
this.array.length},next:function(){return this.array[this.current++]},__class__:td};var aa=K["haxe.macro.Binop"]={__ename__:!0,__constructs__:null,OpAdd:{_hx_name:"OpAdd",_hx_index:0,__enum__:"haxe.macro.Binop",toString:v},OpMult:{_hx_name:"OpMult",_hx_index:1,__enum__:"haxe.macro.Binop",toString:v},OpDiv:{_hx_name:"OpDiv",_hx_index:2,__enum__:"haxe.macro.Binop",toString:v},OpSub:{_hx_name:"OpSub",_hx_index:3,__enum__:"haxe.macro.Binop",toString:v},OpAssign:{_hx_name:"OpAssign",_hx_index:4,__enum__:"haxe.macro.Binop",
toString:v},OpEq:{_hx_name:"OpEq",_hx_index:5,__enum__:"haxe.macro.Binop",toString:v},OpNotEq:{_hx_name:"OpNotEq",_hx_index:6,__enum__:"haxe.macro.Binop",toString:v},OpGt:{_hx_name:"OpGt",_hx_index:7,__enum__:"haxe.macro.Binop",toString:v},OpGte:{_hx_name:"OpGte",_hx_index:8,__enum__:"haxe.macro.Binop",toString:v},OpLt:{_hx_name:"OpLt",_hx_index:9,__enum__:"haxe.macro.Binop",toString:v},OpLte:{_hx_name:"OpLte",_hx_index:10,__enum__:"haxe.macro.Binop",toString:v},OpAnd:{_hx_name:"OpAnd",_hx_index:11,
__enum__:"haxe.macro.Binop",toString:v},OpOr:{_hx_name:"OpOr",_hx_index:12,__enum__:"haxe.macro.Binop",toString:v},OpXor:{_hx_name:"OpXor",_hx_index:13,__enum__:"haxe.macro.Binop",toString:v},OpBoolAnd:{_hx_name:"OpBoolAnd",_hx_index:14,__enum__:"haxe.macro.Binop",toString:v},OpBoolOr:{_hx_name:"OpBoolOr",_hx_index:15,__enum__:"haxe.macro.Binop",toString:v},OpShl:{_hx_name:"OpShl",_hx_index:16,__enum__:"haxe.macro.Binop",toString:v},OpShr:{_hx_name:"OpShr",_hx_index:17,__enum__:"haxe.macro.Binop",
toString:v},OpUShr:{_hx_name:"OpUShr",_hx_index:18,__enum__:"haxe.macro.Binop",toString:v},OpMod:{_hx_name:"OpMod",_hx_index:19,__enum__:"haxe.macro.Binop",toString:v},OpAssignOp:(z=function(a){return{_hx_index:20,op:a,__enum__:"haxe.macro.Binop",toString:v}},z._hx_name="OpAssignOp",z.__params__=["op"],z),OpInterval:{_hx_name:"OpInterval",_hx_index:21,__enum__:"haxe.macro.Binop",toString:v},OpArrow:{_hx_name:"OpArrow",_hx_index:22,__enum__:"haxe.macro.Binop",toString:v},OpIn:{_hx_name:"OpIn",_hx_index:23,
__enum__:"haxe.macro.Binop",toString:v},OpNullCoal:{_hx_name:"OpNullCoal",_hx_index:24,__enum__:"haxe.macro.Binop",toString:v}};aa.__constructs__=[aa.OpAdd,aa.OpMult,aa.OpDiv,aa.OpSub,aa.OpAssign,aa.OpEq,aa.OpNotEq,aa.OpGt,aa.OpGte,aa.OpLt,aa.OpLte,aa.OpAnd,aa.OpOr,aa.OpXor,aa.OpBoolAnd,aa.OpBoolOr,aa.OpShl,aa.OpShr,aa.OpUShr,aa.OpMod,aa.OpAssignOp,aa.OpInterval,aa.OpArrow,aa.OpIn,aa.OpNullCoal];aa.__empty_constructs__=[aa.OpAdd,aa.OpMult,aa.OpDiv,aa.OpSub,aa.OpAssign,aa.OpEq,aa.OpNotEq,aa.OpGt,aa.OpGte,
aa.OpLt,aa.OpLte,aa.OpAnd,aa.OpOr,aa.OpXor,aa.OpBoolAnd,aa.OpBoolOr,aa.OpShl,aa.OpShr,aa.OpUShr,aa.OpMod,aa.OpInterval,aa.OpArrow,aa.OpIn,aa.OpNullCoal];var zc=K["haxe.macro.Unop"]={__ename__:!0,__constructs__:null,OpIncrement:{_hx_name:"OpIncrement",_hx_index:0,__enum__:"haxe.macro.Unop",toString:v},OpDecrement:{_hx_name:"OpDecrement",_hx_index:1,__enum__:"haxe.macro.Unop",toString:v},OpNot:{_hx_name:"OpNot",_hx_index:2,__enum__:"haxe.macro.Unop",toString:v},OpNeg:{_hx_name:"OpNeg",_hx_index:3,__enum__:"haxe.macro.Unop",
toString:v},OpNegBits:{_hx_name:"OpNegBits",_hx_index:4,__enum__:"haxe.macro.Unop",toString:v},OpSpread:{_hx_name:"OpSpread",_hx_index:5,__enum__:"haxe.macro.Unop",toString:v}};zc.__constructs__=[zc.OpIncrement,zc.OpDecrement,zc.OpNot,zc.OpNeg,zc.OpNegBits,zc.OpSpread];zc.__empty_constructs__=[zc.OpIncrement,zc.OpDecrement,zc.OpNot,zc.OpNeg,zc.OpNegBits,zc.OpSpread];var Yg=function(a,b,c){t.call(this,a,c);this.pos=b};Yg.__name__="haxe.macro.Error";Yg.__super__=t;Yg.prototype=D(t.prototype,{__class__:Yg});
var Eh=function(){};Eh.__name__="haxe.zip.Compress";Eh.run=function(a,b){throw new Bf("Not implemented for this platform",null,{fileName:"haxe/zip/Compress.hx",lineNumber:39,className:"haxe.zip.Compress",methodName:"run"});};var Tc=K["haxe.zip.Huffman"]={__ename__:!0,__constructs__:null,Found:(z=function(a){return{_hx_index:0,i:a,__enum__:"haxe.zip.Huffman",toString:v}},z._hx_name="Found",z.__params__=["i"],z),NeedBit:(z=function(a,b){return{_hx_index:1,left:a,right:b,__enum__:"haxe.zip.Huffman",
toString:v}},z._hx_name="NeedBit",z.__params__=["left","right"],z),NeedBits:(z=function(a,b){return{_hx_index:2,n:a,table:b,__enum__:"haxe.zip.Huffman",toString:v}},z._hx_name="NeedBits",z.__params__=["n","table"],z)};Tc.__constructs__=[Tc.Found,Tc.NeedBit,Tc.NeedBits];Tc.__empty_constructs__=[];var fi=function(){};fi.__name__="haxe.zip.HuffTools";fi.prototype={treeDepth:function(a){switch(a._hx_index){case 0:return 0;case 1:var b=a.right;a=this.treeDepth(a.left);b=this.treeDepth(b);return 1+(a<b?
a:b);case 2:throw t.thrown("assert");}},treeCompress:function(a){var b=this.treeDepth(a);if(0==b)return a;if(1==b){if(1==a._hx_index)return b=a.right,Tc.NeedBit(this.treeCompress(a.left),this.treeCompress(b));throw t.thrown("assert");}for(var c=[],d=0,e=1<<b;d<e;)d++,c.push(Tc.Found(-1));this.treeWalk(c,0,0,b,a);return Tc.NeedBits(b,c)},treeWalk:function(a,b,c,d,e){if(1==e._hx_index){var f=e.left,g=e.right;0<d?(this.treeWalk(a,b,c+1,d-1,f),this.treeWalk(a,b|1<<c,c+1,d-1,g)):a[b]=this.treeCompress(e)}else a[b]=
this.treeCompress(e)},treeMake:function(a,b,c,d){if(d>b)throw t.thrown("Invalid huffman");var e=c<<5|d;if(a.h.hasOwnProperty(e))return Tc.Found(a.h[e]);c<<=1;++d;return Tc.NeedBit(this.treeMake(a,b,c,d),this.treeMake(a,b,c|1,d))},make:function(a,b,c,d){if(1==c)return Tc.NeedBit(Tc.Found(0),Tc.Found(0));var e=[],f=[];if(32<d)throw t.thrown("Invalid huffman");for(var g=0,h=d;g<h;)g++,e.push(0),f.push(0);g=0;for(h=c;g<h;){var k=g++;k=a[k+b];if(k>=d)throw t.thrown("Invalid huffman");e[k]++}var l=0;g=
1;for(h=d-1;g<h;)k=g++,l=l+e[k]<<1,f[k]=l;e=new Fa;g=0;for(h=c;g<h;)k=g++,c=a[k+b],0!=c&&(l=f[c-1],f[c-1]=l+1,e.h[l<<5|c]=k);return this.treeCompress(Tc.NeedBit(this.treeMake(e,d,0,1),this.treeMake(e,d,1,1)))},__class__:fi};var gi=function(a){this.buffer=new S(new ArrayBuffer(65536));this.pos=0;a&&(this.crc=new zf)};gi.__name__="haxe.zip._InflateImpl.Window";gi.prototype={slide:function(){null!=this.crc&&this.crc.update(this.buffer,0,32768);var a=new S(new ArrayBuffer(65536));this.pos-=32768;a.blit(0,
this.buffer,32768,this.pos);this.buffer=a},addBytes:function(a,b,c){65536<this.pos+c&&this.slide();this.buffer.blit(this.pos,a,b,c);this.pos+=c},addByte:function(a){65536==this.pos&&this.slide();this.buffer.b[this.pos]=a;this.pos++},getLastChar:function(){return this.buffer.b[this.pos-1]},available:function(){return this.pos},checksum:function(){null!=this.crc&&this.crc.update(this.buffer,0,this.pos);return this.crc},__class__:gi};var Ua=K["haxe.zip._InflateImpl.State"]={__ename__:!0,__constructs__:null,
Head:{_hx_name:"Head",_hx_index:0,__enum__:"haxe.zip._InflateImpl.State",toString:v},Block:{_hx_name:"Block",_hx_index:1,__enum__:"haxe.zip._InflateImpl.State",toString:v},CData:{_hx_name:"CData",_hx_index:2,__enum__:"haxe.zip._InflateImpl.State",toString:v},Flat:{_hx_name:"Flat",_hx_index:3,__enum__:"haxe.zip._InflateImpl.State",toString:v},Crc:{_hx_name:"Crc",_hx_index:4,__enum__:"haxe.zip._InflateImpl.State",toString:v},Dist:{_hx_name:"Dist",_hx_index:5,__enum__:"haxe.zip._InflateImpl.State",toString:v},
DistOne:{_hx_name:"DistOne",_hx_index:6,__enum__:"haxe.zip._InflateImpl.State",toString:v},Done:{_hx_name:"Done",_hx_index:7,__enum__:"haxe.zip._InflateImpl.State",toString:v}};Ua.__constructs__=[Ua.Head,Ua.Block,Ua.CData,Ua.Flat,Ua.Crc,Ua.Dist,Ua.DistOne,Ua.Done];Ua.__empty_constructs__=[Ua.Head,Ua.Block,Ua.CData,Ua.Flat,Ua.Crc,Ua.Dist,Ua.DistOne,Ua.Done];var Tb=function(a,b,c){null==c&&(c=!0);null==b&&(b=!0);this.isFinal=!1;this.htools=new fi;this.huffman=this.buildFixedHuffman();this.huffdist=
null;this.dist=this.len=0;this.state=b?Ua.Head:Ua.Block;this.input=a;this.needed=this.nbits=this.bits=0;this.output=null;this.outpos=0;this.lengths=[];this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);
this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.window=new gi(c)};Tb.__name__="haxe.zip.InflateImpl";Tb.run=function(a,b){null==b&&(b=65536);var c=new S(new ArrayBuffer(b)),d=new Id;for(a=new Tb(a);;){var e=a.readBytes(c,0,b);d.addBytes(c,0,e);if(e<b)break}return d.getBytes()};Tb.prototype={buildFixedHuffman:function(){if(null!=Tb.FIXED_HUFFMAN)return Tb.FIXED_HUFFMAN;for(var a=[],b=0;288>b;){var c=b++;a.push(143>=c?8:255>=c?9:279>=c?7:8)}Tb.FIXED_HUFFMAN=this.htools.make(a,
0,288,10);return Tb.FIXED_HUFFMAN},readBytes:function(a,b,c){this.needed=c;this.outpos=b;this.output=a;if(0<c)for(;this.inflateLoop(););return c-this.needed},getBits:function(a){for(;this.nbits<a;)this.bits|=this.input.readByte()<<this.nbits,this.nbits+=8;var b=this.bits&(1<<a)-1;this.nbits-=a;this.bits>>=a;return b},getBit:function(){0==this.nbits&&(this.nbits=8,this.bits=this.input.readByte());var a=1==(this.bits&1);this.nbits--;this.bits>>=1;return a},getRevBits:function(a){return 0==a?0:this.getBit()?
1<<a-1|this.getRevBits(a-1):this.getRevBits(a-1)},resetBits:function(){this.nbits=this.bits=0},addBytes:function(a,b,c){this.window.addBytes(a,b,c);this.output.blit(this.outpos,a,b,c);this.needed-=c;this.outpos+=c},addByte:function(a){this.window.addByte(a);this.output.b[this.outpos]=a;this.needed--;this.outpos++},addDistOne:function(a){for(var b=this.window.getLastChar(),c=0;c<a;)c++,this.addByte(b)},addDist:function(a,b){this.addBytes(this.window.buffer,this.window.pos-a,b)},applyHuffman:function(a){switch(a._hx_index){case 0:var b=
a.i;return b;case 1:return b=a.left,a=a.right,this.applyHuffman(this.getBit()?a:b);case 2:return b=a.n,this.applyHuffman(a.table[this.getBits(b)])}},inflateLengths:function(a,b){for(var c=0,d=0;c<b;){var e=this.applyHuffman(this.huffman);switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:d=e;a[c]=e;++c;break;case 16:e=c+3+this.getBits(2);if(e>b)throw t.thrown("Invalid data");for(;c<e;)a[c]=d,++c;break;case 17:c+=3+this.getBits(3);
if(c>b)throw t.thrown("Invalid data");break;case 18:c+=11+this.getBits(7);if(c>b)throw t.thrown("Invalid data");break;default:throw t.thrown("Invalid data");}}},inflateLoop:function(){switch(this.state._hx_index){case 0:var a=this.input.readByte();if(8!=(a&15))throw t.thrown("Invalid data");var b=this.input.readByte(),c=0!=(b&32);if(0!=((a<<8)+b)%31)throw t.thrown("Invalid data");if(c)throw t.thrown("Unsupported dictionary");this.state=Ua.Block;return!0;case 1:switch(this.isFinal=this.getBit(),this.getBits(2)){case 0:this.len=
this.input.readUInt16();if(this.input.readUInt16()!=65535-this.len)throw t.thrown("Invalid data");this.state=Ua.Flat;a=this.inflateLoop();this.resetBits();return a;case 1:return this.huffman=this.buildFixedHuffman(),this.huffdist=null,this.state=Ua.CData,!0;case 2:a=this.getBits(5)+257;b=this.getBits(5)+1;var d=this.getBits(4)+4;c=0;for(var e=d;c<e;){var f=c++;this.lengths[Tb.CODE_LENGTHS_POS[f]]=this.getBits(3)}c=d;for(e=19;c<e;)f=c++,this.lengths[Tb.CODE_LENGTHS_POS[f]]=0;this.huffman=this.htools.make(this.lengths,
0,19,8);f=[];c=0;for(e=a+b;c<e;)c++,f.push(0);this.inflateLengths(f,a+b);this.huffdist=this.htools.make(f,a,b,16);this.huffman=this.htools.make(f,0,a,16);this.state=Ua.CData;return!0;default:throw t.thrown("Invalid data");}case 2:b=this.applyHuffman(this.huffman);if(256>b)return this.addByte(b),0<this.needed;if(256==b)this.state=this.isFinal?Ua.Crc:Ua.Block;else{b-=257;a=Tb.LEN_EXTRA_BITS_TBL[b];if(-1==a)throw t.thrown("Invalid data");this.len=Tb.LEN_BASE_VAL_TBL[b]+this.getBits(a);b=null==this.huffdist?
this.getRevBits(5):this.applyHuffman(this.huffdist);a=Tb.DIST_EXTRA_BITS_TBL[b];if(-1==a)throw t.thrown("Invalid data");this.dist=Tb.DIST_BASE_VAL_TBL[b]+this.getBits(a);if(this.dist>this.window.available())throw t.thrown("Invalid data");this.state=1==this.dist?Ua.DistOne:Ua.Dist}return!0;case 3:return a=this.len<this.needed?this.len:this.needed,b=this.input.read(a),this.len-=a,this.addBytes(b,0,a),0==this.len&&(this.state=this.isFinal?Ua.Crc:Ua.Block),0<this.needed;case 4:a=this.window.checksum();
if(null==a)return this.state=Ua.Done,!0;b=zf.read(this.input);if(!a.equals(b))throw t.thrown("Invalid CRC");this.state=Ua.Done;return!0;case 5:for(;0<this.len&&0<this.needed;)a=this.len<this.dist?this.len:this.dist,a=this.needed<a?this.needed:a,this.addDist(this.dist,a),this.len-=a;0==this.len&&(this.state=Ua.CData);return 0<this.needed;case 6:return a=this.len<this.needed?this.len:this.needed,this.addDistOne(a),this.len-=a,0==this.len&&(this.state=Ua.CData),0<this.needed;case 7:return!1}},__class__:Tb};
var Fh=function(){};Fh.__name__="haxe.zip.Uncompress";Fh.run=function(a,b){return Tb.run(new Vb(a),b)};var jg=function(){this.chunks=[];this.currentData=null;this.available=this.length=this.currentOffset=0};jg.__name__="hx.ws.Buffer";jg.prototype={writeByte:function(a){var b=new S(new ArrayBuffer(1));b.b[0]=a;this.writeBytes(b)},writeShort:function(a){var b=new S(new ArrayBuffer(2));b.b[0]=a>>8&255;b.b[1]=a&255;this.writeBytes(b)},writeInt:function(a){var b=new S(new ArrayBuffer(4));b.b[0]=a>>24&
255;b.b[1]=a>>16&255;b.b[2]=a>>8&255;b.b[3]=a&255;this.writeBytes(b)},writeBytes:function(a){this.chunks.push(a);this.length=this.available+=a.length},readAllAvailableBytes:function(){return this.readBytes(this.available)},readLine:function(){var a=this.readUntil("\n");return null==a?null:X.trim(a.toString())},readLinesUntil:function(a){a=this.readUntil(a);return null==a?null:X.trim(a.toString()).split("\n")},readUntil:function(a){for(var b=a.length,c=0,d=this.available-b;c<d;){for(var e=c++,f=!0,
g=0,h=b;g<h;){var k=g++;if(this.peekByte(this.currentOffset+e+k+1)!=F.cca(a,k)){f=!1;break}}if(f)return this.readBytes(e+b+1)}return null},readBytes:function(a){a=Math.min(a,this.available)|0;for(var b=new S(new ArrayBuffer(a)),c=0;c<a;){var d=c++,e=this.readByte();b.b[d]=e}return b},readUnsignedShort:function(){var a=this.readByte(),b=this.readByte();return a<<8|b},readUnsignedInt:function(){var a=this.readByte(),b=this.readByte(),c=this.readByte(),d=this.readByte();return a<<24|b<<16|c<<8|d},readByte:function(){if(0>=
this.available)throw t.thrown("No bytes available");for(;null==this.currentData||this.currentOffset>=this.currentData.length;)this.currentOffset=0,this.currentData=this.chunks.shift();this.available--;this.length=this.available;return this.currentData.b[this.currentOffset++]},peekByte:function(a){if(0>=this.available)throw t.thrown("No bytes available");var b=this.chunks[0];null==b&&(b=this.currentData);for(var c=0;a>=b.length;)a-=b.length,++c,b=this.chunks[c];return b.b[a]},peekUntil:function(a){var b=
this.currentOffset,c=this.chunks[0];null==c&&(c=this.currentData);for(var d=0;b>=c.length;)b-=c.length,++d,c=this.chunks[d];for(;b<c.length;){if(c.b[b]==a)return b+1;++b}return-1},endsWith:function(a){for(var b=this.available-a.length,c=this.currentOffset;b<this.available;){if(this.peekByte(b)!=F.cca(a,c))return!1;++b;++c}return!0},__class__:jg};var kg=K["hx.ws.MessageType"]={__ename__:!0,__constructs__:null,BytesMessage:(z=function(a){return{_hx_index:0,content:a,__enum__:"hx.ws.MessageType",toString:v}},
z._hx_name="BytesMessage",z.__params__=["content"],z),StrMessage:(z=function(a){return{_hx_index:1,content:a,__enum__:"hx.ws.MessageType",toString:v}},z._hx_name="StrMessage",z.__params__=["content"],z)};kg.__constructs__=[kg.BytesMessage,kg.StrMessage];kg.__empty_constructs__=[];var vh=function(a,b){null==b&&(b=!0);this._ws=this._onmessage=null;this._url=a;b&&this.open();this.set_binaryType("arraybuffer")};vh.__name__="hx.ws.WebSocket";vh.prototype={open:function(){if(null!=this._ws)throw t.thrown("Socket already connected");
this._ws=new WebSocket(this._url)},get_onopen:function(){return this._ws.onopen},set_onopen:function(a){return this._ws.onopen=a},get_onclose:function(){return this._ws.onclose},set_onclose:function(a){return this._ws.onclose=a},get_onerror:function(){return this._ws.onerror},set_onerror:function(a){return this._ws.onerror=a},get_onmessage:function(){return this._onmessage},set_onmessage:function(a){var b=this;this._onmessage=a;this._ws.onmessage=function(a){if(null!=b._onmessage)if(a.data instanceof
ArrayBuffer){var c=new jg;c.writeBytes(S.ofData(a.data));b._onmessage(kg.BytesMessage(c))}else b._onmessage(kg.StrMessage(a.data))};return a},get_binaryType:function(){return this._ws.binaryType},set_binaryType:function(a){return this._ws.binaryType=a},close:function(){this._ws.close()},send:function(a){a instanceof S?(a=ka.__cast(a,S),this._ws.send(a.b.bufferValue)):a instanceof jg?(a=ka.__cast(a,jg),this._ws.send(a.readAllAvailableBytes().b.bufferValue)):this._ws.send(a)},__class__:vh};var Wd=function(a,
b){if(-101!=a||-102!=b){var c=window.document.createElement("canvas");c.width=a;c.height=b;this.ctx=c.getContext("2d",null)}};Wd.__name__="hxd.BitmapData";Wd.notImplemented=function(){throw t.thrown("Not implemented");};Wd.fromNative=function(a){var b=new Wd(-101,-102);b.ctx=a;return b};Wd.prototype={clear:function(a){this.fill(0,0,this.ctx.canvas.width,this.ctx.canvas.height,a)},fill:function(a,b,c,d,e){this.ctx.fillStyle="rgba("+(e>>16&255)+", "+(e>>8&255)+", "+(e&255)+", "+(e>>>24)/255+")";this.ctx.fillRect(a,
b,c,d)},draw:function(a,b,c,d,e,f,g,h){this.drawScaled(a,b,f,g,c,d,e,f,g,h)},drawScaled:function(a,b,c,d,e,f,g,h,k,l,m){throw t.thrown("Not implemented");},line:function(a,b,c,d,e){var f=d-b;if(0==c-a){if(d<b){var g=b;b=d;d=g}0>b&&(b=0);d>this.ctx.canvas.height-1&&(d=this.ctx.canvas.height-1);var h=b;for(c=d+1;h<c;)g=h++,this.setPixel(a,g,e)}else if(0==f)for(c<a&&(g=a,a=c,c=g),0>a&&(a=0),c>this.ctx.canvas.width-1&&(c=this.ctx.canvas.width-1),h=a,c+=1;h<c;){var k=h++;this.setPixel(k,b,e)}else{if(a<
c){if(a>=this.ctx.canvas.width||0>c)return;var l=1;var m=0;var p=this.ctx.canvas.width-1}else{if(c>=this.ctx.canvas.width||0>a)return;l=-1;c=-c;a=-a;m=1-this.ctx.canvas.width;p=0}if(b<d){if(b>=this.ctx.canvas.height||0>d)return;var r=1;var n=0;var q=this.ctx.canvas.height-1}else{if(d>=this.ctx.canvas.width||0>b)return;r=-1;d=-d;b=-b;n=1-this.ctx.canvas.height;q=0}var w=c-a;f=d-b;var t=w<<1,v=f<<1;k=a;g=b;if(w>=f){var x=v-w;var y=!1;if(b<n){h=t*(n-b)-w;b=h/v;k+=b|0;if(k>p)return;k>=m&&(h-=b*v,x-=(h|
0)+w,g=n,0<h&&(++k,x+=v),y=!0)}if(!y&&a<m){h=v*(m-a);g+=h/t|0;h%=t;if(g>q||g==q&&h>w)return;k=m;x+=h|0;h>=w&&(++g,x-=t)}d>q&&(h=t*(q-d)+w,b=h/v,c+=b|0,0==h-b*v&&--c);c>p?c=p+1:++c;-1==l&&(k=-k,c=-c);-1==r&&(g=-g);for(t-=v;k!=c;)this.setPixel(k,g,e),0<=x?(g+=r,x-=t):x+=v,k+=l}else{x=t-f;y=!1;if(a<m){h=v*(m-a)-f;a=h/t;g+=a|0;if(g>q)return;g>=n&&(h-=a*t,x-=(h|0)+f,k=m,0<h&&(++g,x+=t),y=!0)}if(!y&&b<n){h=t*(n-b);k+=h/v|0;h%=v;if(k>p||k==p&&h>f)return;g=n;x+=h|0;h>=f&&(++k,x-=v)}c>p&&(h=v*(p-c)+f,a=h/
t,d+=a|0,0==h-a*t&&--d);d>q?d=q+1:++d;-1==l&&(k=-k);-1==r&&(g=-g,d=-d);for(v-=t;g!=d;)this.setPixel(k,g,e),0<=x?(k+=l,x-=v):x+=t,g+=r}}},dispose:function(){this.pixel=this.ctx=null},clone:function(){return this.sub(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},sub:function(a,b,c,d){var e=window.document.createElement("canvas");e.width=c;e.height=d;e=e.getContext("2d",null);e.drawImage(this.ctx.canvas,a,b,c,d,0,0,c,d);return Wd.fromNative(e)},lock:function(){null==this.lockImage&&(this.lockImage=
this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height))},unlock:function(){null!=this.lockImage&&(this.ctx.putImageData(this.lockImage,0,0),this.lockImage=null)},getPixel:function(a,b){var c=this.lockImage;if(null!=c)var d=a+b*c.width<<2;else d=0,c=this.ctx.getImageData(a,b,1,1);return c.data[d]<<16|c.data[d|1]<<8|c.data[d|2]|c.data[d|3]<<24},setPixel:function(a,b,c){var d=this.lockImage;null!=d?(a=a+b*d.width<<2,d.data[a]=c>>16&255,d.data[a|1]=c>>8&255,d.data[a|2]=c&255,d.data[a|
3]=c>>>24&255):(d=this.pixel,null==d&&(this.pixel=d=this.ctx.createImageData(1,1)),d.data[0]=c>>16&255,d.data[1]=c>>8&255,d.data[2]=c&255,d.data[3]=c>>>24&255,this.ctx.putImageData(d,a,b))},get_width:function(){return this.ctx.canvas.width},get_height:function(){return this.ctx.canvas.height},getPixels:function(){var a=this.ctx.canvas.width,b=this.ctx.canvas.height,c=this.ctx.getImageData(0,0,a,b).data.buffer;return new ta(a,b,S.ofData(c),J.RGBA)},setPixels:function(a){if(a.width!=this.ctx.canvas.width||
a.height!=this.ctx.canvas.height)throw t.thrown("Invalid pixels size");var b=this.ctx.createImageData(a.width,a.height);a.convert(J.RGBA);for(var c=0,d=a.width*a.height*4;c<d;){var e=c++;b.data[e]=a.bytes.b[e]}this.ctx.putImageData(b,0,0)},toNative:function(){return this.ctx},toPNG:function(){var a=this.getPixels(),b=a.toPNG();a.dispose();return b},__class__:Wd};var $b={_new:function(a){return a},getSize:function(a){return $b.SIZES[a]},toInt:function(a){return a},fromInt:function(a){return a},toString:function(a){switch(a){case 0:return"F32";
case 1:return"F16";case 2:return"U8";case 3:return"S8"}}},Vd={_new:function(a){return a},getSize:function(a){return a==ka.__cast(9,jc)?1:a},toInt:function(a){return a},toString:function(a){switch(a){case 1:return"DFloat";case 2:return"DVec2";case 3:return"DVec3";case 4:return"DVec4";case 9:return"DBytes4";case 16:return"DMat4"}},fromInt:function(a){return a},fromHXSL:function(a){switch(a._hx_index){case 3:return 1;case 5:var b=a.t;switch(a.size){case 2:if(1==b._hx_index)return 2;throw t.thrown("Unsupported buffer type "+
y.string(a));case 3:if(1==b._hx_index)return 3;throw t.thrown("Unsupported buffer type "+y.string(a));case 4:if(1==b._hx_index)return 4;throw t.thrown("Unsupported buffer type "+y.string(a));default:throw t.thrown("Unsupported buffer type "+y.string(a));}case 7:return 16;case 9:if(4==a.size)return 9;throw t.thrown("Unsupported buffer type "+y.string(a));default:throw t.thrown("Unsupported buffer type "+y.string(a));}}},va=function(a,b,c){null==c&&(c=0);this.name=a;this.type=b;this.precision=c};va.__name__=
"hxd.BufferInput";va.prototype={getBytesSize:function(){var a=this.type;return(a==ka.__cast(9,jc)?1:a)*$b.SIZES[this.precision]},equals:function(a){return this.type==a.type&&this.name==a.name?this.precision==a.precision:!1},__class__:va};var aj={_new:function(a,b,c){return a<<3|c|b<<16},get_bufferIndex:function(a){return a>>3&255},get_precision:function(a){return a&7},get_offset:function(a){return a>>16}},N=function(a){this.uid=N._UID++;this.stride=this.strideBytes=0;this.inputs=a.slice();this.hasLowPrecision=
!1;for(var b=0;b<a.length;){var c=a[b];++b;var d=c.type;this.stride+=d==ka.__cast(9,jc)?1:d;d=c.type;this.strideBytes+=(d==ka.__cast(9,jc)?1:d)*$b.SIZES[c.precision];0!=(this.strideBytes&3)&&(this.strideBytes+=4-(this.strideBytes&3));0!=c.precision&&(this.hasLowPrecision=!0)}};N.__name__="hxd.BufferFormat";N.get_COMPRESSED_CONFIG=function(){null==N.COMPRESSED_CONFIG&&(N.COMPRESSED_CONFIG=N.make([new va("data",4,1),new va("color",4,1),new va("position",2,1),new va("normal",3,3),new va("uv",2,1),new va("position",
3,1)]),N.COMPRESSED_CONFIG.compressed=N.COMPRESSED_CONFIG);return N.COMPRESSED_CONFIG};N.get_H2D=function(){return N.get_XY_UV_RGBA()};N.get_XY_UV_RGBA=function(){null==N.XY_UV_RGBA&&(N.XY_UV_RGBA=N.make([new va("position",2,0),new va("uv",2,0),new va("color",4,0)]));return N.XY_UV_RGBA};N.get_XY_UV=function(){null==N.XY_UV&&(N.XY_UV=N.make([new va("position",2,0),new va("uv",2,0)]));return N.XY_UV};N.get_POS3D=function(){null==N.POS3D&&(N.POS3D=N.make([new va("position",3,0)]));return N.POS3D};N.get_POS3D_NORMAL=
function(){null==N.POS3D_NORMAL&&(N.POS3D_NORMAL=N.make([new va("position",3,0),new va("normal",3,0)]));return N.POS3D_NORMAL};N.get_POS3D_NORMAL_UV=function(){null==N.POS3D_NORMAL_UV&&(N.POS3D_NORMAL_UV=N.make([new va("position",3,0),new va("normal",3,0),new va("uv",2,0)]));return N.POS3D_NORMAL_UV};N.get_POS3D_NORMAL_UV_RGBA=function(){null==N.POS3D_NORMAL_UV_RGBA&&(N.POS3D_NORMAL_UV_RGBA=N.get_POS3D_NORMAL_UV().append("color",4));return N.POS3D_NORMAL_UV_RGBA};N.get_POS3D_UV=function(){null==N.POS3D_UV&&
(N.POS3D_UV=N.make([new va("position",3,0),new va("uv",2,0)]));return N.POS3D_UV};N.get_VEC4_DATA=function(){null==N.VEC4_DATA&&(N.VEC4_DATA=N.make([new va("data",4,0)]));return N.VEC4_DATA};N.get_MAT4_DATA=function(){null==N.MAT4_DATA&&(N.MAT4_DATA=N.make([new va("data",16,0)]));return N.MAT4_DATA};N.get_INDEX16=function(){null==N.INDEX16&&(N.INDEX16=N.make([new va("index",1,1)]),N.INDEX16.strideBytes=2);return N.INDEX16};N.get_INDEX32=function(){null==N.INDEX32&&(N.INDEX32=N.make([new va("index",
1,0)]));return N.INDEX32};N.fromID=function(a){for(var b=N.ALL_FORMATS.h,c=Object.keys(b),d=c.length,e=0;e<d;)for(var f=b[c[e++]],g=0;g<f.length;){var h=f[g];++g;if(h.uid==a)return h}return null};N.make=function(a){for(var b,c,d=[],e=0;e<a.length;)b=a[e],++e,d.push(b.name);e=d.join("|");d=N.ALL_FORMATS.h[e];null==d&&(d=[],N.ALL_FORMATS.h[e]=d);for(e=0;e<d.length;){c=d[e];++e;for(var f=!0,g=0,h=a.length;g<h;){b=g++;var k=a[b];b=c.inputs[b];if(k.type!=b.type||k.name!=b.name||k.precision!=b.precision){f=
!1;break}}if(f)return c}c=new N(a);d.push(c);return c};N.float32to16=function(a,b){null==b&&(b=!1);var c=hb.floatToI32(a);a=(c&-2147483648)>>>16;var d=(c&2139095040)>>>23;c&=8388607;return 112<d?a|d-112<<10&31744|c>>13:113>d&&101<d&&!b?a|(8384512+c>>125-d)+1>>1:143<d?a|32767:0};N.float16to32=function(a){var b=(a&32768)<<16,c=(a&1023)<<13;a=(a&31744)>>10;if(0!=a)return hb.i32ToFloat(b|a+112<<23|c);if(0==c)return 0;a=hb.floatToI32(c)>>23;return hb.i32ToFloat(b|a-37<<23|c<<150-a&8380416)};N.float32toS8=
function(a){a=Math.floor(128*a);return 127<=a?127:-127>=a?128:0<=a?a:127+a|128};N.floatS8to32=function(a){return 0!=(a&128)?-1*(127-(a&127))/128:(a&127)/128};N.float32toU8=function(a){return 0>a?0:1<=a?255:Math.floor(256*a)};N.floatU8to32=function(a){return(a&255)/255};N.prototype={getInput:function(a){for(var b=0,c=this.inputs;b<c.length;){var d=c[b];++b;if(d.name==a)return d}return null},getCompressed:function(){if(null!=this.compressed)return this.compressed;var a=[],b=[];a.length=this.inputs.length;
b.length=this.inputs.length;for(var c=0,d=0,e=this.inputs;d<e.length;){var f=e[d],g=d++;var h=!1;for(var k=0,l=N.get_COMPRESSED_CONFIG().inputs;k<l.length;){var m=l[k],p=k++;if(f.type==m.type&&0==sa.compare(f.name,m.name)){h=m.type;c+=(h==ka.__cast(9,jc)?1:h)*$b.SIZES[m.precision];0!=(c&3)&&(c+=4-(c&3));a[g]=new va(m.name,m.type,m.precision);b[g]={compressedIndex:p,index:g};h=!0;break}}h||(h=f.type,c+=(h==ka.__cast(9,jc)?1:h)*$b.SIZES[f.precision],0!=(c&3)&&(c+=4-(c&3)),a[g]=new va(f.name,f.type,
f.precision),b[g]={compressedIndex:-1,index:g})}d=c;0!=(d&7)&&(d+=8-(d&7));if(d!=c)for(b.sort(function(a,b){return b.compressedIndex-a.compressedIndex}),e=0;e<b.length;){g=b[e];++e;f=a[g.index];h=f.type;h=(h==ka.__cast(9,jc)?1:h)*$b.SIZES[f.precision];0!=(h&3)&&(h+=4-(h&3));p=c-h;for(k=c;c<d&&0<f.precision;)k=c,--f.precision,h=f.type,c=p+(h==ka.__cast(9,jc)?1:h)*$b.SIZES[f.precision],0!=(c&3)&&(c+=4-(c&3));c>d&&(f.precision+=1,c=k);a[g.index]=f;if(c==d)break}this.compressed=N.make(a);return this.compressed.compressed=
this.compressed},calculateInputOffset:function(a){for(var b=0,c=0,d=this.inputs;c<d.length;){var e=d[c];++c;if(e.name==a)return b;var f=e.type;b+=(f==ka.__cast(9,jc)?1:f)*$b.SIZES[e.precision];0!=(b&3)&&(b+=4-(b&3))}throw t.thrown("Input not found : "+a);},hasInput:function(a,b){for(var c=0,d=this.inputs;c<d.length;){var e=d[c];++c;if(e.name==a)return null!=b?b==e.type:!0}return!1},append:function(a,b){var c=this.inputs.slice();c.push(new va(a,b,0));return N.make(c)},pop:function(){var a=this.inputs.slice();
a.pop();return N.make(a)},isSubSet:function(a){if(a==this)return!0;if(this.inputs.length>=a.inputs.length)return!1;for(var b=0,c=this.inputs.length;b<c;){var d=b++,e=this.inputs[d];d=a.inputs[d];if(e.name!=d.name||e.type!=d.type)return!1}return!0},resolveMapping:function(a){var b=null==this.mappings?null:this.mappings[a.uid];if(null!=b)return b;b=[];for(var c=0,d=a.inputs;c<d.length;){var e=d[c];++c;for(var f=!1,g=0,h=this.inputs;g<h.length;){var k=h[g];++g;if(k.name==e.name&&k.type==e.type){b.push(aj._new(0,
this.calculateInputOffset(k.name),k.precision));f=!0;break}}if(!f)throw t.thrown("Missing buffer input '"+e.name+"'");}null==this.mappings&&(this.mappings=[]);return this.mappings[a.uid]=b},getInputs:function(){return new td(this.inputs)},toString:function(){for(var a=[],b=0,c=this.inputs;b<c.length;){var d=c[b];++b;a.push(d.name+":"+Vd.toString(d.type)+(0==d.precision?"":"."+$b.toString(d.precision).toLowerCase()))}return a.toString()},__class__:N};var Rc=function(a){this.mappings=[];this.uid=Rc._UID++;
this.formats=a};Rc.__name__="hxd.MultiFormat";Rc.make=function(a){if(a.length>Rc.MAX_FORMATS){var b=[];for(var c=0;c<a.length;){var d=a[c];++c;b.push(d.toString())}throw t.thrown("Too many formats (addBuffer leak?) "+y.string(b));}c={found:null,nexts:Rc.CACHE};for(b=0;b<a.length;){d=a[b];++b;var e=c.nexts.h[d.uid];null==e&&(e={found:null,nexts:new Fa},c.nexts.h[d.uid]=e);c=e}null==c.found&&(c.found=new Rc(a));return c.found};Rc.prototype={resolveMapping:function(a){var b=this.mappings[a.uid];null==
b&&(b=this.makeMapping(a));return b},makeMapping:function(a){for(var b=[],c=0,d=a.inputs;c<d.length;){for(var e=d[c++],f=!1,g=null,h=0,k=this.formats;h<k.length;){var l=k[h],m=h++,p=l;l=p.getInput(e.name);if(null!=l&&(g=l,l.type==e.type)){f=p.calculateInputOffset(l.name);b.push(aj._new(m,f,l.precision));f=!0;break}}if(!f){if(null!=g)throw t.thrown("Shader buffer "+e.name+" was requested with "+(null==e.type?"null":Vd.toString(e.type))+" but found with "+(null==g.type?"null":Vd.toString(g.type)));
throw t.thrown("Missing shader buffer "+e.name);}}return this.mappings[a.uid]=b},__class__:Rc};var vc=K["hxd.Cursor"]={__ename__:!0,__constructs__:null,Default:{_hx_name:"Default",_hx_index:0,__enum__:"hxd.Cursor",toString:v},Button:{_hx_name:"Button",_hx_index:1,__enum__:"hxd.Cursor",toString:v},Move:{_hx_name:"Move",_hx_index:2,__enum__:"hxd.Cursor",toString:v},TextInput:{_hx_name:"TextInput",_hx_index:3,__enum__:"hxd.Cursor",toString:v},Hide:{_hx_name:"Hide",_hx_index:4,__enum__:"hxd.Cursor",toString:v},
Custom:(z=function(a){return{_hx_index:5,custom:a,__enum__:"hxd.Cursor",toString:v}},z._hx_name="Custom",z.__params__=["custom"],z),Callback:(z=function(a){return{_hx_index:6,f:a,__enum__:"hxd.Cursor",toString:v}},z._hx_name="Callback",z.__params__=["f"],z)};vc.__constructs__=[vc.Default,vc.Button,vc.Move,vc.TextInput,vc.Hide,vc.Custom,vc.Callback];vc.__empty_constructs__=[vc.Default,vc.Button,vc.Move,vc.TextInput,vc.Hide];var Zg=function(a){this.file=a};Zg.__name__="hxd.DroppedFile";Zg.prototype=
{__class__:Zg};var hi=function(a,b,c){this.files=a;this.dropX=b;this.dropY=c};hi.__name__="hxd.DropFileEvent";hi.prototype={get_file:function(){return this.files[0]},__class__:hi};var ha=K["hxd.EventKind"]={__ename__:!0,__constructs__:null,EPush:{_hx_name:"EPush",_hx_index:0,__enum__:"hxd.EventKind",toString:v},ERelease:{_hx_name:"ERelease",_hx_index:1,__enum__:"hxd.EventKind",toString:v},EMove:{_hx_name:"EMove",_hx_index:2,__enum__:"hxd.EventKind",toString:v},EOver:{_hx_name:"EOver",_hx_index:3,
__enum__:"hxd.EventKind",toString:v},EOut:{_hx_name:"EOut",_hx_index:4,__enum__:"hxd.EventKind",toString:v},EWheel:{_hx_name:"EWheel",_hx_index:5,__enum__:"hxd.EventKind",toString:v},EFocus:{_hx_name:"EFocus",_hx_index:6,__enum__:"hxd.EventKind",toString:v},EFocusLost:{_hx_name:"EFocusLost",_hx_index:7,__enum__:"hxd.EventKind",toString:v},EKeyDown:{_hx_name:"EKeyDown",_hx_index:8,__enum__:"hxd.EventKind",toString:v},EKeyUp:{_hx_name:"EKeyUp",_hx_index:9,__enum__:"hxd.EventKind",toString:v},EReleaseOutside:{_hx_name:"EReleaseOutside",
_hx_index:10,__enum__:"hxd.EventKind",toString:v},ETextInput:{_hx_name:"ETextInput",_hx_index:11,__enum__:"hxd.EventKind",toString:v},ECheck:{_hx_name:"ECheck",_hx_index:12,__enum__:"hxd.EventKind",toString:v}};ha.__constructs__=[ha.EPush,ha.ERelease,ha.EMove,ha.EOver,ha.EOut,ha.EWheel,ha.EFocus,ha.EFocusLost,ha.EKeyDown,ha.EKeyUp,ha.EReleaseOutside,ha.ETextInput,ha.ECheck];ha.__empty_constructs__=[ha.EPush,ha.ERelease,ha.EMove,ha.EOver,ha.EOut,ha.EWheel,ha.EFocus,ha.EFocusLost,ha.EKeyDown,ha.EKeyUp,
ha.EReleaseOutside,ha.ETextInput,ha.ECheck];var Pb=function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.button=0;this.kind=a;this.relX=b;this.relY=c};Pb.__name__="hxd.Event";Pb.prototype={toString:function(){var a=y.string(this.kind)+"["+(this.relX|0)+","+(this.relY|0)+"]";switch(this.kind._hx_index){case 5:var b=",wheelDelta="+this.wheelDelta;break;case 8:case 9:b=",keyCode="+this.keyCode;break;case 0:case 1:case 10:b=",button="+this.button;break;case 11:b=",charCode="+this.charCode;break;case 2:case 3:case 4:case 6:case 7:case 12:b=
""}return a+b},__class__:Pb};var wd={_new:function(a){return{pos:a,array:new Float32Array(new ArrayBuffer(a<<2))}},get_length:function(a){return a.pos},set_length:function(a,b){if(a.pos!=b){var c=new Float32Array(b);c.set(a.array);a.array=c}return a.pos=b},push:function(a,b){if(a.pos==a.array.length){var c=a.array.length<<1;128>c&&(c=128);c=new Float32Array(c);c.set(a.array);a.array=c}a.array[a.pos++]=b},get:function(a,b){return a.array[b]},set:function(a,b,c){return a.array[b]=c},toF32Array:function(a){return a.array},
toArray:function(a){for(var b=[],c=0,d=a.pos;c<d;){var e=c++;b.push(a.array[e])}return b}},H=function(){};H.__name__="hxd.Key";H.isDown=function(a){return 0<H.keyPressed[a]};H.getFrame=function(){return ea.frameCount+2};H.isPressed=function(a){return H.keyPressed[a]==ea.frameCount+2-1};H.isReleased=function(a){return H.keyPressed[a]==-(ea.frameCount+2)+1};H.initialize=function(){H.initDone&&H.dispose();H.initDone=!0;H.keyPressed=[];ic.getInstance().addEventTarget(H.onEvent)};H.dispose=function(){H.initDone&&
(ic.getInstance().removeEventTarget(H.onEvent),H.initDone=!1,H.keyPressed=[])};H.onEvent=function(a){switch(a.kind._hx_index){case 0:5>a.button&&(H.keyPressed[a.button]=ea.frameCount+2);break;case 1:5>a.button&&(H.keyPressed[a.button]=-(ea.frameCount+2));break;case 5:H.keyPressed[0<a.wheelDelta?6:5]=ea.frameCount+2;break;case 8:if(!H.ALLOW_KEY_REPEAT&&0<H.keyPressed[a.keyCode])break;H.keyPressed[a.keyCode]=ea.frameCount+2;break;case 9:H.keyPressed[a.keyCode]=-(ea.frameCount+2);break;case 10:H.keyPressed=
[]}};H.getKeyName=function(a){switch(a){case 0:return"MouseLeft";case 1:return"MouseRight";case 2:return"MouseMiddle";case 3:return"Mouse3";case 4:return"Mouse4";case 8:return"Backspace";case 9:return"Tab";case 13:return"Enter";case 16:return"Shift";case 17:return"Ctrl";case 18:return"Alt";case 19:return"PauseBreak";case 20:return"CapsLock";case 27:return"Escape";case 32:return"Space";case 33:return"PageUp";case 34:return"PageDown";case 35:return"End";case 36:return"Home";case 37:return"Left";case 38:return"Up";
case 39:return"Right";case 40:return"Down";case 45:return"Insert";case 46:return"Delete";case 91:return"LeftWindowKey";case 92:return"RightWindowKey";case 93:return"ContextMenu";case 106:return"NumPad*";case 107:return"NumPad+";case 108:return"NumPadEnter";case 109:return"NumPad-";case 110:return"NumPad.";case 111:return"NumPad/";case 144:return"NumLock";case 145:return"ScrollLock";case 186:return"Semicolon";case 187:return"Equals";case 188:return"Comma";case 189:return"Minus";case 190:return"Period";
case 191:return"Slash";case 192:return"Tilde";case 219:return"BracketLeft";case 220:return"Backslash";case 221:return"BracketRight";case 222:return"Quote";case 226:return"IntlBackslash";case 272:return"LShift";case 273:return"LCtrl";case 274:return"LAlt";case 528:return"RShift";case 529:return"RCtrl";case 530:return"RAlt";default:return 48<=a&&57>=a?""+(a-48):96<=a&&105>=a?"NumPad"+(a-96):65<=a&&90>=a?String.fromCodePoint(65+a-65):112<=a&&135>=a?"F"+(a-112+1):null}};var T=function(){};T.__name__=
"hxd.Math";T.get_POSITIVE_INFINITY=function(){return Infinity};T.get_NEGATIVE_INFINITY=function(){return-Infinity};T.get_NaN=function(){return NaN};T.isNaN=function(a){return isNaN(a)};T.fmt=function(a){if(0>a){var b=-1;a=-a}else b=1;if(isNaN(a)||!isFinite(a))return a;var c=4-Math.log(a)/Math.log(10)|0;if(1>c)c=1;else if(10<=c)return 0;c=Math.pow(10,c);return Math.floor(a*c+.49999)*b/c};T.floor=function(a){return Math.floor(a)};T.ceil=function(a){return Math.ceil(a)};T.round=function(a){return Math.round(a)};
T.clamp=function(a,b,c){null==c&&(c=1);null==b&&(b=0);return a<b?b:a>c?c:a};T.pow=function(a,b){return Math.pow(a,b)};T.cos=function(a){return Math.cos(a)};T.sin=function(a){return Math.sin(a)};T.tan=function(a){return Math.tan(a)};T.acos=function(a){return Math.acos(a)};T.asin=function(a){return Math.asin(a)};T.atan=function(a){return Math.atan(a)};T.sqrt=function(a){return Math.sqrt(a)};T.invSqrt=function(a){return 1/Math.sqrt(a)};T.atan2=function(a,b){return Math.atan2(a,b)};T.abs=function(a){return 0>
a?-a:a};T.max=function(a,b){return a<b?b:a};T.min=function(a,b){return a>b?b:a};T.iabs=function(a){return 0>a?-a:a};T.imax=function(a,b){return a<b?b:a};T.imin=function(a,b){return a>b?b:a};T.iclamp=function(a,b,c){return a<b?b:a>c?c:a};T.lerp=function(a,b,c){return a+c*(b-a)};T.inverseLerp=function(a,b,c){return(c-a)/(b-a)};T.ease=function(a,b,c,d){var e=Math.pow(c,1+d);return a+e/(e+Math.pow(1-c,d+1))*(b-a)};T.easeFactor=function(a,b){var c=Math.pow(a,1+b);return c/(c+Math.pow(1-a,b+1))};T.lerpTime=
function(a,b,c,d){return a+(1-Math.pow(1-c,d*ea.wantedFPS))*(b-a)};T.bitCount=function(a){a-=a>>1&1431655765;a=(a&858993459)+(a>>2&858993459);return 16843009*(a+(a>>4)&252645135)>>24};T.isPOT=function(a){return 0==(a&a-1)};T.nextPOT=function(a){--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;return++a};T.distanceSq=function(a,b,c){null==c&&(c=0);return a*a+b*b+c*c};T.distance=function(a,b,c){null==c&&(c=0);null==c&&(c=0);return Math.sqrt(a*a+b*b+c*c)};T.colorLerp=function(a,b,c){return((a>>>24)*(1-c)+
(b>>>24)*c|0)<<24|((a>>16&255)*(1-c)+(b>>16&255)*c|0)<<16|((a>>8&255)*(1-c)+(b>>8&255)*c|0)<<8|(a&255)*(1-c)+(b&255)*c|0};T.angle=function(a){a%=6.283185307179586;3.141592653589793<a?a-=6.283185307179586:-3.141592653589793>=a&&(a+=6.283185307179586);return a};T.angleLerp=function(a,b,c){b=(b-a)%6.283185307179586;3.141592653589793<b?b-=6.283185307179586:-3.141592653589793>=b&&(b+=6.283185307179586);return a+b*c};T.angleMove=function(a,b,c){var d=(b-a)%6.283185307179586;3.141592653589793<d?d-=6.283185307179586:
-3.141592653589793>=d&&(d+=6.283185307179586);return d>-c&&d<c?b:a+(0>d?-c:c)};T.valueMove=function(a,b,c){a<b?(a+=c,a>b&&(a=b)):a>b&&(a-=c,a<b&&(a=b));return a};T.shuffle=function(a){for(var b=a.length,c=0;c<b;){c++;var d=y.random(b),e=y.random(b),f=a[d];a[d]=a[e];a[e]=f}};T.random=function(a){null==a&&(a=1);return Math.random()*a};T.srand=function(a){null==a&&(a=1);return 2*(Math.random()-.5)*a};T.b2f=function(a){return.00392156862745098*(a&255)};T.f2b=function(a){return 255*(0>a?0:1<a?1:a)|0};
T.umod=function(a,b){a%=b;return 0<=a?a:a+b};T.ufmod=function(a,b){a%=b;return 0<=a?a:a+b};T.degToRad=function(a){return 3.141592653589793*a/180};T.radToDeg=function(a){return 180*a/3.141592653589793};var bc=K["hxd.Flags"]={__ename__:!0,__constructs__:null,ReadOnly:{_hx_name:"ReadOnly",_hx_index:0,__enum__:"hxd.Flags",toString:v},AlphaPremultiplied:{_hx_name:"AlphaPremultiplied",_hx_index:1,__enum__:"hxd.Flags",toString:v}};bc.__constructs__=[bc.ReadOnly,bc.AlphaPremultiplied];bc.__empty_constructs__=
[bc.ReadOnly,bc.AlphaPremultiplied];var ej={getPixel:function(a,b,c){a=a.bytes.getInt32((b+c*a.width<<2)+a.offset);return a>>>24|a>>8&65280|a<<8&16711680|a<<24},setPixel:function(a,b,c,d){a.bytes.setInt32((b+c*a.width<<2)+a.offset,d>>>24|d>>8&65280|d<<8&16711680|d<<24)},fromPixels:function(a){a.convert(J.ARGB);return a}},ta=function(a,b,c,d,e){null==e&&(e=0);this.width=a;this.height=b;this.bytes=c;this.set_innerFormat(d);this.offset=e;a=0;null==a&&(a=0);this.flags=a};ta.__name__="hxd.Pixels";ta.switchEndian=
function(a){return a>>>24|a>>8&65280|a<<8&16711680|a<<24};ta.switchBR=function(a){return a&-16711936|a<<16&16711680|a>>16&255};ta.calcDataSize=function(a,b,c){return 22==c._hx_index?(b+3>>2<<2)*ta.calcStride(a,c):b*ta.calcStride(a,c)};ta.calcStride=function(a,b){switch(b._hx_index){case 3:case 21:var c=8;break;case 4:c=16;break;case 5:c=1;break;case 6:case 18:c=2;break;case 7:c=4;break;case 8:c=2;break;case 9:case 19:c=4;break;case 10:c=8;break;case 11:c=3;break;case 12:case 20:c=6;break;case 13:c=
12;break;case 0:case 1:case 2:case 14:case 15:c=4;break;case 16:c=4;break;case 17:c=4;break;case 22:return b=b.v,a=a+3>>2,1==b||4==b?a<<1:a<<2;case 23:c=2;break;case 24:c=3;break;case 25:case 26:c=4}return a*c};ta.isFloatFormat=function(a){switch(a._hx_index){case 3:case 6:case 9:case 12:return!0;case 4:case 7:case 10:case 13:return!0;case 22:return 6==a.v?!0:!1;default:return!1}};ta.getChannelOffset=function(a,b){switch(a._hx_index){case 0:return[1,2,3,0][b];case 1:return[2,1,0,3][b];case 4:return 4*
b;case 8:case 9:case 10:case 19:return a=ta.calcStride(1,a),[0,a,-1,-1][b];case 2:case 14:case 15:return b;case 16:case 17:throw t.thrown("Bit packed format");case 5:case 6:case 7:case 18:return 0==b?0:-1;case 11:case 12:case 13:case 20:return a=ta.calcStride(1,a),[0,a,a<<1,-1][b];case 3:case 21:return 2*b;case 22:throw t.thrown("Not supported");case 23:case 24:case 25:case 26:throw t.thrown("Not supported");}};ta.alloc=function(a,b,c){return new ta(a,b,new S(new ArrayBuffer(ta.calcDataSize(a,b,c))),
c)};ta.toDDSLayers=function(a,b){var c,d;null==b&&(b=!1);if(0==a.length)throw t.thrown("Must contain at least one image");var e=a[0],f=e.innerFormat,g=[],h=0;for(c=0;c<a.length;){var k=a[c];++c;if(!da.enumEq(k.innerFormat,f))throw t.thrown("All images must be of the same pixel format");h+=k.dataSize;var l=!1;for(d=0;d<g.length;){var m=g[d];++d;if(m[0].width==k.width&&m[0].height==k.height){m.push(k);l=!0;break}}l||g.push([k])}g.sort(function(a,b){return b[0].width*b[0].height-a[0].width*a[0].height});
k=g[0].length;m=g[0][0].width;var p=g[0][0].height;c=1;for(d=g.length;c<d;){l=c++;var r=g[l];if(r.length!=k)throw t.thrown("Invalid number of mipmaps at level "+l+": "+r.length+" should be "+k);var n=m>>l;0==n&&(n=1);var q=p>>l;0==q&&(q=1);var w=r[0].width;r=r[0].height;if(w!=n||r!=q)throw t.thrown("Invalid mip level size "+l+": "+w+"x"+r+" should be "+n+"x"+q);}h+=128;(d=1<k&&!b)&&(h+=20);h=new S(new ArrayBuffer(h));n=0;h.setInt32(n,542327876);n+=4;h.setInt32(n,124);n+=4;h.setInt32(n,135183);n+=
4;h.setInt32(n,p);n+=4;h.setInt32(n,m);n+=4;h.setInt32(n,e.stride);n+=4;h.setInt32(n,1);n+=4;h.setInt32(n,g.length);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,32);n+=4;if(d)h.setInt32(n,4),n+=4,h.setInt32(n,808540228),n+=4,h.setInt32(n,0),n+=4,h.setInt32(n,0),n+=4,h.setInt32(n,0),n+=4,h.setInt32(n,
0),n+=4,h.setInt32(n,0),n+=4;else switch(f._hx_index){case 0:case 1:case 2:h.setInt32(n,65);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,32);n+=4;c=ta.getChannelOffset(f,0);h.setInt32(n,255<<8*c);n+=4;c=ta.getChannelOffset(f,1);h.setInt32(n,255<<8*c);n+=4;c=ta.getChannelOffset(f,2);h.setInt32(n,255<<8*c);n+=4;c=ta.getChannelOffset(f,3);h.setInt32(n,255<<8*c);n+=4;break;default:h.setInt32(n,4);n+=4;switch(f._hx_index){case 3:c=113;break;case 4:c=116;break;case 6:c=111;break;case 7:c=114;break;case 9:c=112;
break;case 10:c=115;break;default:throw t.thrown("Unsupported format "+y.string(f));}h.setInt32(n,c);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4}h.setInt32(n,d?4096:(1==a.length?0:8)|4096|(1==g.length?0:4194304));n+=4;h.setInt32(n,b?1536|(1<k?2048:0)|(2<k?4096:0)|(3<k?8192:0)|(4<k?16384:0)|(5<k?32768:0):0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;if(d){switch(f._hx_index){case 2:h.setInt32(n,28);n+=4;break;
case 22:switch(f.v){case 1:c=71;break;case 2:c=74;break;case 3:c=77;break;case 7:c=98;break;default:throw t.thrown("Unnsupported format "+y.string(f));}h.setInt32(n,c);n+=4;break;default:throw t.thrown("Unsupported DXT10 format "+y.string(f));}h.setInt32(n,3);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,k);n+=4;h.setInt32(n,0);n+=4}c=0;for(d=k;c<d;)for(l=c++,a=0,b=g.length;a<b;)f=a++,k=g[f][l],h.blit(n,k.bytes,k.offset,k.dataSize),n+=k.dataSize;return h};ta.prototype={get_format:function(){return this.innerFormat},
set_innerFormat:function(a){this.innerFormat=a;this.stride=ta.calcStride(this.width,a);this.dataSize=ta.calcDataSize(this.width,this.height,a);this.bytesPerPixel=ta.calcStride(1,a);return a},invalidFormat:function(){throw t.thrown("Unsupported format for this operation : "+y.string(this.innerFormat));},sub:function(a,b,c,d){if(0>a||0>b||a+c>this.width||b+d>this.height)throw t.thrown("Pixels.sub() outside bounds");for(var e=new S(new ArrayBuffer(d*this.stride)),f=ta.calcStride(c,this.innerFormat),
g=0,h=0;h<d;){var k=h++;e.blit(g,this.bytes,(a+(b+k)*this.width)*this.bytesPerPixel+this.offset,f);g+=f}return new ta(c,d,e,this.innerFormat)},blit:function(a,b,c,d,e,f,g){if(0>a||0>b||a+f>this.width||b+g>this.height)throw t.thrown("Pixels.blit() outside bounds");if(0>d||0>d||d+f>c.width||e+g>c.height)throw t.thrown("Pixels.blit() outside src bounds");0!=(this.flags&1<<bc.ReadOnly._hx_index)&&this.copyInner();c.convert(this.innerFormat);var h=this.bytesPerPixel;if(0==h)throw t.thrown("assert");f=
ta.calcStride(f,this.innerFormat);for(var k=0;k<g;){var l=k++;this.bytes.blit((a+(l+b)*this.width)*h+this.offset,c.bytes,(d+(l+e)*c.width)*h+c.offset,f)}},clear:function(a,b){null==b&&(b=0);var c=b;0!=(this.flags&1<<bc.ReadOnly._hx_index)&&this.copyInner();if((a&255)==(a>>8&255)&&(a&65535)==a>>>16&&0==c)this.bytes.fill(this.offset,this.width*this.height*this.bytesPerPixel,a&255);else{switch(this.innerFormat._hx_index){case 0:a=a>>>24|a>>8&65280|a<<8&16711680|a<<24;c=c>>>24|c>>8&65280|c<<8&16711680|
c<<24;break;case 1:break;case 2:a=a&-16711936|a<<16&16711680|a>>16&255;c=c&-16711936|c<<16&16711680|c>>16&255;break;default:this.invalidFormat()}var d=this.offset;if(0==c){var e=0;for(b=this.width*this.height;e<b;)e++,this.bytes.setInt32(d,a),d+=4}else for(e=0,b=this.width*this.height;e<b;)e++,this.bytes.setInt32(d,a|this.bytes.getInt32(d)&c),d+=4}},toVector:function(){var a,b=Array(this.width*this.height),c=0,d=this.offset;switch(this.innerFormat._hx_index){case 0:for(var e=0,f=this.height;e<f;){e++;
var g=0;for(a=this.width;g<a;){g++;var h=this.bytes.getInt32(d);b[c++]=h>>>24|h>>8&65280|h<<8&16711680|h<<24;d+=4}d+=0}break;case 1:e=0;for(f=this.height;e<f;){e++;g=0;for(a=this.width;g<a;)g++,b[c++]=this.bytes.getInt32(d),d+=4;d+=0}break;case 2:e=0;for(f=this.height;e<f;){e++;g=0;for(a=this.width;g<a;)g++,h=this.bytes.getInt32(d),b[c++]=h&-16711936|h<<16&16711680|h>>16&255,d+=4;d+=0}break;default:this.invalidFormat()}return b},makeSquare:function(a){for(var b=this.width,c=this.height,d=0==b?0:1,
e=0==c?0:1;d<b;)d<<=1;for(;e<c;)e<<=1;if(b==d&&c==e)return this;for(var f=this.bytesPerPixel,g=new S(new ArrayBuffer(d*e*f)),h=0,k=this.offset,l=0,m=c;l<m;){l++;g.blit(h,this.bytes,k,b*f);h+=b*f;k+=b*f;for(var p=0,r=(d-b)*f>>2;p<r;)p++,g.setInt32(h,0),h+=4}l=0;for(m=(e-c)*d*f>>2;l<m;)l++,g.setInt32(h,0),h+=4;if(a)return new ta(d,e,g,this.innerFormat);this.bytes=g;this.width=d;this.height=e;return this},copyInner:function(){var a=this.bytes;this.bytes=new S(new ArrayBuffer(this.dataSize));this.bytes.blit(0,
a,this.offset,this.dataSize);this.offset=0;this.flags&=-1-(1<<bc.ReadOnly._hx_index)},willChange:function(){0!=(this.flags&1<<bc.ReadOnly._hx_index)&&this.copyInner()},flipY:function(){0!=(this.flags&1<<bc.ReadOnly._hx_index)&&this.copyInner();0!=this.stride%4&&this.invalidFormat();for(var a=0,b=this.height>>1;a<b;){var c=a++,d=c*this.stride+this.offset;c=(this.height-1-c)*this.stride+this.offset;for(var e=0,f=this.stride>>2;e<f;){e++;var g=this.bytes.getInt32(d),h=this.bytes.getInt32(c);this.bytes.setInt32(d,
h);this.bytes.setInt32(c,g);d+=4;c+=4}}},convert:function(a){if(this.innerFormat!=a&&!da.enumEq(this.innerFormat,a)){0!=(this.flags&1<<bc.ReadOnly._hx_index)&&this.copyInner();var b=this.bytes.b;var c=this.innerFormat;switch(c._hx_index){case 0:switch(a._hx_index){case 1:var d=0;for(c=this.width*this.height;d<c;){var e=d++;e=(e<<2)+this.offset;var f=b[e];var g=b[e+1];var h=b[e+2];var k=b[e+3];b[e++]=k;b[e++]=h;b[e++]=g;b[e]=f}break;case 2:d=0;for(c=this.width*this.height;d<c;)e=d++,e=(e<<2)+this.offset,
f=b[e],k=b[e+1],b[e]=k,k=b[e+2],b[e+1]=k,k=b[e+3],b[e+2]=k,b[e+3]=f;break;default:throw t.thrown("Cannot convert from "+y.string(this.innerFormat)+" to "+y.string(a));}break;case 1:switch(a._hx_index){case 0:d=0;for(c=this.width*this.height;d<c;)e=d++,e=(e<<2)+this.offset,f=b[e],g=b[e+1],h=b[e+2],k=b[e+3],b[e++]=k,b[e++]=h,b[e++]=g,b[e]=f;break;case 2:d=0;for(c=this.width*this.height;d<c;)e=d++,e=(e<<2)+this.offset,k=b[e],g=b[e+2],b[e]=g,b[e+2]=k;break;default:throw t.thrown("Cannot convert from "+
y.string(this.innerFormat)+" to "+y.string(a));}break;case 2:switch(a._hx_index){case 0:d=0;for(c=this.width*this.height;d<c;)e=d++,e=(e<<2)+this.offset,f=b[e+3],k=b[e+2],b[e+3]=k,k=b[e+1],b[e+2]=k,k=b[e],b[e+1]=k,b[e]=f;break;case 1:d=0;for(c=this.width*this.height;d<c;)e=d++,e=(e<<2)+this.offset,k=b[e],g=b[e+2],b[e]=g,b[e+2]=k;break;case 5:g=new S(new ArrayBuffer(this.width*this.height));f=g.b;d=0;for(c=this.width*this.height;d<c;)e=d++,k=b[e<<2],f[e]=k;this.bytes=g;break;default:throw t.thrown("Cannot convert from "+
y.string(this.innerFormat)+" to "+y.string(a));}break;case 4:if(7==a._hx_index){g=new S(new ArrayBuffer(this.height*this.width*4));d=0;for(c=this.width*this.height;d<c;)e=d++,g.setFloat(e<<2,this.bytes.getFloat(e<<4));this.bytes=g}else throw t.thrown("Cannot convert from "+y.string(this.innerFormat)+" to "+y.string(a));break;case 7:switch(a._hx_index){case 1:case 2:f=this.bytes;d=e=0;for(c=this.width*this.height;d<c;)d++,k=255*f.getFloat(e)|0,0>k?k=0:255<k&&(k=255),b[e++]=k,b[e++]=k,b[e++]=k,b[e++]=
255;break;default:throw t.thrown("Cannot convert from "+y.string(this.innerFormat)+" to "+y.string(a));}break;case 18:if(7==a._hx_index){g=new S(new ArrayBuffer(this.width*this.height*4));f=this.bytes;d=0;for(c=this.width*this.height;d<c;)e=d++,b=f.getUInt16(e<<1),g.setFloat(e<<2,b/65535);this.bytes=g}else throw t.thrown("Cannot convert from "+y.string(this.innerFormat)+" to "+y.string(a));break;case 22:if(22==a._hx_index){if(k=a.v,f=c.v,f!=k)throw t.thrown("Cannot convert from "+y.string(this.innerFormat)+
" to "+y.string(a));}else throw t.thrown("Cannot convert from "+y.string(this.innerFormat)+" to "+y.string(a));break;default:throw t.thrown("Cannot convert from "+y.string(this.innerFormat)+" to "+y.string(a));}this.set_innerFormat(a)}},getPixel:function(a,b){a=(a+b*this.width)*this.bytesPerPixel+this.offset;switch(this.innerFormat._hx_index){case 0:return a=this.bytes.getInt32(a),a>>>24|a>>8&65280|a<<8&16711680|a<<24;case 1:return this.bytes.getInt32(a);case 2:return a=this.bytes.getInt32(a),a&-16711936|
a<<16&16711680|a>>16&255;case 5:return this.bytes.b[a];case 8:return a=this.bytes.getUInt16(a),(a&255)<<8|a>>8;default:return this.invalidFormat(),0}},setPixel:function(a,b,c){a=(a+b*this.width)*this.bytesPerPixel+this.offset;0!=(this.flags&1<<bc.ReadOnly._hx_index)&&this.copyInner();switch(this.innerFormat._hx_index){case 0:this.bytes.setInt32(a,c>>>24|c>>8&65280|c<<8&16711680|c<<24);break;case 1:this.bytes.setInt32(a,c);break;case 2:this.bytes.setInt32(a,c&-16711936|c<<16&16711680|c>>16&255);break;
case 5:this.bytes.b[a]=c;break;case 8:this.bytes.setUInt16(a,(c&255)<<8|(c&65280)>>8);break;default:this.invalidFormat()}},getPixelF:function(a,b,c){null==c&&(c=new O(0,0,0,1));var d=(a+b*this.width)*this.bytesPerPixel+this.offset;switch(this.innerFormat._hx_index){case 4:var e=c;a=this.bytes.getFloat(d);b=this.bytes.getFloat(d+4);var f=this.bytes.getFloat(d+8);d=this.bytes.getFloat(d+12);null==d&&(d=1);null==f&&(f=0);null==b&&(b=0);null==a&&(a=0);e.x=a;e.y=b;e.z=f;e.w=d;return c;case 7:return e=
c,a=this.bytes.getFloat(d),d=f=b=0,null==d&&(d=1),null==f&&(f=0),null==b&&(b=0),null==a&&(a=0),e.x=a,e.y=b,e.z=f,e.w=d,c;case 10:return e=c,a=this.bytes.getFloat(d),b=this.bytes.getFloat(d+4),d=f=0,null==d&&(d=1),null==f&&(f=0),null==b&&(b=0),null==a&&(a=0),e.x=a,e.y=b,e.z=f,e.w=d,c;case 18:return e=c,a=this.bytes.getUInt16(d)/65535,d=f=b=0,null==d&&(d=1),null==f&&(f=0),null==b&&(b=0),null==a&&(a=0),e.x=a,e.y=b,e.z=f,e.w=d,c;default:return e=c,d=this.getPixel(a,b),e.x=(d>>16&255)/255,e.y=(d>>8&255)/
255,e.z=(d&255)/255,e.w=(d>>>24)/255,c}},setPixelF:function(a,b,c){0!=(this.flags&1<<bc.ReadOnly._hx_index)&&this.copyInner();var d=(a+b*this.width)*this.bytesPerPixel+this.offset;switch(this.innerFormat._hx_index){case 4:this.bytes.setFloat(d,c.x);this.bytes.setFloat(d+4,c.y);this.bytes.setFloat(d+8,c.z);this.bytes.setFloat(d+12,c.w);break;case 7:this.bytes.setFloat(d,c.x);break;default:d=c.w;var e=c.x,f=c.y;c=c.z;this.setPixel(a,b,(255*(0>d?0:1<d?1:d)+.499|0)<<24|(255*(0>e?0:1<e?1:e)+.499|0)<<16|
(255*(0>f?0:1<f?1:f)+.499|0)<<8|255*(0>c?0:1<c?1:c)+.499|0)}},dispose:function(){this.bytes=null},toString:function(){return"Pixels("+this.width+"x"+this.height+" "+y.string(this.innerFormat)+")"},toPNG:function(a){null==a&&(a=9);0!=this.offset&&(this.bytes=this.bytes.sub(this.offset,ta.calcDataSize(this.width,this.height,this.innerFormat)),this.offset=0);switch(this.innerFormat._hx_index){case 0:a=Hb.build32ARGB(this.width,this.height,this.bytes,a);break;case 5:a=Hb.buildGrey(this.width,this.height,
this.bytes,a);break;default:this.convert(J.BGRA),a=Hb.build32BGRA(this.width,this.height,this.bytes,a)}var b=new Yc;(new Ch(b)).write(a);return b.getBytes()},toDDS:function(){return ta.toDDSLayers([this])},clone:function(){var a=new ta(this.width,this.height,null,this.innerFormat);a.flags=this.flags;a.flags&=-1-(1<<bc.ReadOnly._hx_index);null!=this.bytes&&(a.bytes=new S(new ArrayBuffer(this.dataSize)),a.bytes.blit(0,this.bytes,this.offset,this.dataSize));return a},__class__:ta};var wh=function(a){this.defaultCursor=
vc.Default;this.enablePhysicalMouse=this.mouseCheckMove=!0;this.isOut=!1;this.onOver=new Pb(ha.EOver);this.onOut=new Pb(ha.EOut);this.checkPos=new Pb(ha.ECheck);this.focusLost=new Pb(ha.EFocusLost);this.lastTouch=0;this.overIndex=this.mouseX=this.mouseY=-1;this.scenes=[];this.pendingEvents=[];this.pushList=[];this.overList=[];this.overCandidates=[];null==a&&(a=ic.getInstance());this.window=a;a.addEventTarget(M(this,this.onEvent))};wh.__name__="hxd.SceneEvents";wh.prototype={setMousePos:function(a,
b){this.mouseX=a;this.mouseY=b},onRemove:function(a){a==this.currentFocus&&(this.currentFocus=null);if(0<=this.overIndex){var b=this.overList.indexOf(a);0<=b&&(F.remove(this.overList,a),b<this.overIndex&&this.overIndex--)}else F.remove(this.overList,a),this.selectCursor();F.remove(this.pushList,a)},addScene:function(a,b){a.setEvents(this);null==b?this.scenes.push(a):this.scenes.splice(b,0,a)},removeScene:function(a){F.remove(this.scenes,a)&&a.setEvents(null)},dispose:function(){this.window.removeEventTarget(M(this,
this.onEvent))},focus:function(a){if(this.currentFocus!=a)if(null==a)this.blur();else{if(null!=this.currentFocus&&(this.blur(),null!=this.currentFocus))return;var b=new Pb(ha.EFocus);a.handleEvent(b);b.cancel||(this.currentFocus=a)}},blur:function(){null!=this.currentFocus&&(this.focusLost.cancel=!1,this.currentFocus.handleEvent(this.focusLost),this.focusLost.cancel||(this.currentFocus=null))},checkFocus:function(){if(null!=this.currentFocus){var a=this.currentFocus.getInteractiveScene();null==a?
this.currentFocus=null:a.isInteractiveVisible(this.currentFocus)||this.blur()}},emitEvent:function(a){var b,c,d,e=a.relX,f=a.relY,g=0,h=!1,k=!1,l=d=!1,m=!1,p=!1;this.overIndex=0;switch(a.kind._hx_index){case 0:l=m=!0;break;case 1:l=!0;break;case 5:case 8:case 9:case 11:if(null!=this.currentFocus&&(a.relX=a.relY=0,this.currentFocus.handleEvent(a),a.relX=e,a.relY=f,!a.propagate))return;break;case 2:case 12:d=k=!0}var r=0;for(c=this.scenes;r<c.length;){var n=c[r];++r;for(b=null;;){b=n.handleEvent(a,
b);if(null==b){a.relX=e;a.relY=f;break}if(k){if(d){d=this.overList.indexOf(b);if(-1==d)this.overCandidates.length==g?this.overCandidates[g]={i:b,s:n,x:a.relX,y:a.relY,z:a.relZ}:(d=this.overCandidates[g],d.i=b,d.s=n,d.x=a.relX,d.y=a.relY,d.z=a.relZ),++g,this.overList.splice(this.overIndex++,0,b),p=!0;else{if(d<this.overIndex){do this.overList[d]=this.overList[d+1],++d;while(d<this.overIndex);this.overList[this.overIndex]=b;p=!0}else if(d>this.overIndex){do this.overList[d]=this.overList[d-1],--d;while(d>
this.overIndex);this.overList[this.overIndex]=b;p=!0}this.overIndex++}d=a.propagate}}else l&&(a.kind==ha.EPush?this.pushList.push(b):F.remove(this.pushList,b)),m&&b==this.currentFocus&&(m=!1);a.relX=e;a.relY=f;if(!a.propagate){h=!0;break}a.propagate=!1}if(h)break}m&&null!=this.currentFocus&&this.blur();if(k){if(this.overIndex<this.overList.length){for(;this.overIndex<this.overList.length;)this.overList.pop().handleEvent(this.onOut);p=!0}if(0!=g){b=0;n=this.onOver;do d=this.overCandidates[b++],n.relX=
d.x,n.relY=d.y,n.relZ=d.z,d.s.isInteractiveVisible(d.i)?d.i.handleEvent(n):F.remove(this.overList,d.i),d.i=null,d.s=null;while(b<g)}}this.overIndex=-1;p&&this.selectCursor();h||a==this.checkPos||(a.kind==ha.EPush?this.pushList.push(null):a.kind==ha.ERelease&&F.remove(this.pushList,null),this.dispatchListeners(a));if(a.kind==ha.ERelease&&0<this.pushList.length){r=0;for(c=this.pushList;r<c.length;)b=c[r],++r,null==b?(a.kind=ha.EReleaseOutside,this.dispatchListeners(a),a.kind=ha.ERelease):(n=b.getInteractiveScene(),
null!=n&&(a.kind=ha.EReleaseOutside,n.dispatchEvent(a,b),a.kind=ha.ERelease,a.relX=e,a.relY=f));this.pushList=[]}},checkEvents:function(){var a=this.pendingEvents,b=!this.mouseCheckMove,c=null==this.currentFocus;if(0<a.length){this.pendingEvents=[];for(var d=0;d<a.length;){var e=a[d];++d;var f=e.relX,g=e.relY;switch(e.kind._hx_index){case 0:case 1:this.mouseX=e.relX;this.mouseY=e.relY;this.lastTouch=e.touchId;break;case 2:b=!0;this.mouseX=e.relX;this.mouseY=e.relY;this.lastTouch=e.touchId;break;case 3:this.isOut=
!1;this.selectCursor();continue;case 4:this.isOut=!0;if(0<this.overList.length){for(e=this.overList.length-1;0<=e;)this.onOut.cancel=!1,this.overList[e].handleEvent(this.onOut),F.remove(this.overList,this.overList[e]),--e;this.selectCursor()}continue;case 5:case 8:case 9:case 11:c||(c=!0,this.checkFocus())}if(null!=this.currentDrag&&(null==this.currentDrag.ref||this.currentDrag.ref==e.touchId)){e.propagate=!0;e.cancel=!1;this.currentDrag.f(e);e.relX=f;e.relY=g;if(!e.propagate)continue;e.propagate=
!1}this.emitEvent(e)}}c||this.checkFocus();b||this.isOut||null!=this.currentDrag||(this.checkPos.relX=this.mouseX,this.checkPos.relY=this.mouseY,this.checkPos.touchId=this.lastTouch,this.checkPos.cancel=!1,this.checkPos.propagate=!1,this.emitEvent(this.checkPos))},startCapture:function(a,b,c){if(null!=this.currentDrag&&null!=this.currentDrag.onCancel)this.currentDrag.onCancel();this.currentDrag={f:a,ref:c,onCancel:b}},stopCapture:function(){if(null!=this.currentDrag&&null!=this.currentDrag.onCancel)this.currentDrag.onCancel();
this.currentDrag=null},startDrag:function(a,b,c){this.startCapture(a,b,null!=c?c.touchId:null)},stopDrag:function(){this.stopCapture()},getFocus:function(){return this.currentFocus},updateCursor:function(a){-1!=this.overList.indexOf(a)&&this.selectCursor()},set_defaultCursor:function(a){if(da.enumEq(a,this.defaultCursor))return a;this.defaultCursor=a;this.selectCursor();return a},selectCursor:function(){for(var a=this.defaultCursor,b=0,c=this.overList;b<c.length;){var d=c[b];++b;if(null!=d.cursor){a=
d.cursor;break}}6==a._hx_index?(a=a.f,a()):la.setCursor(a)},onEvent:function(a){(this.enablePhysicalMouse||a.kind!=ha.EMove)&&this.pendingEvents.push(a)},dispatchListeners:function(a){var b=a.relX,c=a.relY;a.propagate=!0;for(var d=0,e=this.scenes;d<e.length;){var f=e[d];++d;a.cancel=!1;f.dispatchListeners(a);a.relX=b;a.relY=c;if(!a.propagate)break}},__class__:wh};var Xb=K["hxd.Platform"]={__ename__:!0,__constructs__:null,IOS:{_hx_name:"IOS",_hx_index:0,__enum__:"hxd.Platform",toString:v},Android:{_hx_name:"Android",
_hx_index:1,__enum__:"hxd.Platform",toString:v},WebGL:{_hx_name:"WebGL",_hx_index:2,__enum__:"hxd.Platform",toString:v},PC:{_hx_name:"PC",_hx_index:3,__enum__:"hxd.Platform",toString:v},Console:{_hx_name:"Console",_hx_index:4,__enum__:"hxd.Platform",toString:v},FlashPlayer:{_hx_name:"FlashPlayer",_hx_index:5,__enum__:"hxd.Platform",toString:v}};Xb.__constructs__=[Xb.IOS,Xb.Android,Xb.WebGL,Xb.PC,Xb.Console,Xb.FlashPlayer];Xb.__empty_constructs__=[Xb.IOS,Xb.Android,Xb.WebGL,Xb.PC,Xb.Console,Xb.FlashPlayer];
var Rd=K["hxd.SystemValue"]={__ename__:!0,__constructs__:null,IsTouch:{_hx_name:"IsTouch",_hx_index:0,__enum__:"hxd.SystemValue",toString:v},IsWindowed:{_hx_name:"IsWindowed",_hx_index:1,__enum__:"hxd.SystemValue",toString:v},IsMobile:{_hx_name:"IsMobile",_hx_index:2,__enum__:"hxd.SystemValue",toString:v}};Rd.__constructs__=[Rd.IsTouch,Rd.IsWindowed,Rd.IsMobile];Rd.__empty_constructs__=[Rd.IsTouch,Rd.IsWindowed,Rd.IsMobile];var ea=function(){};ea.__name__="hxd.Timer";ea.update=function(){ea.frameCount++;
var a=F.now()/1E3;ea.elapsedTime=a-ea.lastTimeStamp;ea.lastTimeStamp=a;ea.elapsedTime<ea.maxDeltaTime?(a=ea.elapsedTime,ea.currentDT=a+ea.smoothFactor*(ea.currentDT-a)):ea.elapsedTime=1/ea.wantedFPS;ea.dt=ea.currentDT};ea.get_tmod=function(){return ea.dt*ea.wantedFPS};ea.set_tmod=function(a){ea.dt=a/ea.wantedFPS;return a};ea.fps=function(){return 1/ea.currentDT};ea.skip=function(){ea.lastTimeStamp=F.now()/1E3};ea.reset=function(){ea.lastTimeStamp=F.now()/1E3;ea.dt=ea.currentDT=1/ea.wantedFPS};var ic=
function(a,b){this.canLockMouse=!0;this.discardMouseUp=-1;this.discardMouseCaptureEvent=!0;this.useScreenPixels=te.get_supported();this.curMouseX=this.curMouseY=0;this.mouseMode=Jc.Absolute;var c=this,d=null!=a;this.eventTargets=new vd;this.resizeEvents=new vd;this.dropTargets=new vd;if(te.get_supported()){if(null==a){a=window.document.getElementById("webgl");if(null==a)throw t.thrown("Missing canvas #webgl");"1"==a.getAttribute("globalEvents")&&(b=!0)}this.canvas=a;this.propagateKeyEvents=b;var e=
a.getAttribute("propagateKeyEvents");null!=e&&(this.propagateKeyEvents="0"!=e&&"false"!=e);this.element=(this.focused=b)?window:a;this.canvasPos=a.getBoundingClientRect();d?a.addEventListener("mousemove",M(this,this.onMouseMove)):window.addEventListener("mousemove",M(this,this.onMouseMove));this.element.addEventListener("mousedown",M(this,this.onMouseDown));this.element.addEventListener("mouseup",M(this,this.onMouseUp));this.element.addEventListener("mouseleave",M(this,this.onMouseLeave));this.element.addEventListener("wheel",
M(this,this.onMouseWheel));this.element.addEventListener("touchstart",M(this,this.onTouchStart));this.element.addEventListener("touchmove",M(this,this.onTouchMove));this.element.addEventListener("touchend",M(this,this.onTouchEnd));this.element.addEventListener("keydown",M(this,this.onKeyDown));this.element.addEventListener("keyup",M(this,this.onKeyUp));this.element.addEventListener("keypress",M(this,this.onKeyPress));var f=this;this.element.addEventListener("blur",function(){f.onFocus(!1)});var g=
this;this.element.addEventListener("focus",function(){g.onFocus(!0)});null!=window.ResizeObserver&&(this.observer=new ResizeObserver(function(a){c.checkResize()}),this.observer.observe(a));window.addEventListener("resize",M(this,this.checkResize));window.document.addEventListener("pointerlockchange",M(this,this.onPointerLockChange));a.addEventListener("contextmenu",function(a){a.stopPropagation();2==a.button&&a.preventDefault();return!1});b?(a.addEventListener("mousedown",function(a){c.onMouseDown(a);
a.stopPropagation();a.preventDefault()}),this.element.addEventListener("contextmenu",function(a){a.stopPropagation();a.preventDefault();return!1})):(null==a.getAttribute("tabindex")&&a.setAttribute("tabindex","1"),a.style.outline="none");this.curW=this.get_width();this.curH=this.get_height()}else this.canvasPos={width:0,top:0,left:0,height:0}};ic.__name__="hxd.Window";ic.getInstance=function(){null==ic.inst&&(ic.inst=new ic);return ic.inst};ic.prototype={checkResize:function(){this.canvasPos=this.canvas.getBoundingClientRect();
var a=this.get_width(),b=this.get_height();if(this.curW!=a||this.curH!=b)this.curW=a,this.curH=b,this.onResize(null)},dispose:function(){ic.inst==this&&(ic.inst=null);null!=window.ResizeObserver&&null!=this.observer&&(this.observer.disconnect(),this.observer=null)},onClose:function(){return!0},onMouseModeChange:function(a,b){return null},event:function(a){for(var b=this.eventTargets.h;null!=b;){var c=b.item;b=b.next;c(a)}},addEventTarget:function(a){this.eventTargets.add(a)},removeEventTarget:function(a){for(var b=
this.eventTargets.h;null!=b;){var c=b.item;b=b.next;if(c==a){this.eventTargets.remove(c);break}}},addResizeEvent:function(a){this.resizeEvents.push(a)},removeResizeEvent:function(a){for(var b=this.resizeEvents.h;null!=b;){var c=b.item;b=b.next;if(c==a){this.resizeEvents.remove(a);break}}},onResize:function(a){for(a=this.resizeEvents.h;null!=a;){var b=a.item;a=a.next;b()}},resize:function(a,b){},addDragAndDropTarget:function(a){if(0==this.dropTargets.length){var b=this.canvas;b.addEventListener("dragover",
M(this,this.handleDragAndDropEvent));b.addEventListener("drop",M(this,this.handleDragAndDropEvent))}this.dropTargets.add(a)},removeDragAndDropTarget:function(a){for(var b=this.dropTargets.h;null!=b;){var c=b.item;b=b.next;if(c==a){this.dropTargets.remove(a);break}}0==this.dropTargets.length&&(a=this.canvas,a.removeEventListener("dragover",M(this,this.handleDragAndDropEvent)),a.removeEventListener("drop",M(this,this.handleDragAndDropEvent)))},handleDragAndDropEvent:function(a){a.preventDefault();if("dragover"!=
a.type&&null!=a.dataTransfer&&0!=a.dataTransfer.files.length){for(var b=[],c=0,d=a.dataTransfer.files;c<d.length;){var e=d[c];++c;b.push(new $g(e))}a=new hi(b,Math.round((a.clientX-this.canvasPos.left)*this.getPixelRatio()),Math.round((a.clientY-this.canvasPos.top)*this.getPixelRatio()));for(b=this.dropTargets.h;null!=b;)c=b.item,b=b.next,c(a)}},setFullScreen:function(a){var b=window.document,c=b.documentElement;b.fullscreenElement==c!=a&&(a?c.requestFullscreen():b.exitFullscreen())},setCursorPos:function(a,
b,c){null==c&&(c=!1);if(this.mouseMode==Jc.Absolute)throw t.thrown("setCursorPos only allowed in relative mouse modes on this platform.");this.curMouseX=a+this.canvasPos.left;this.curMouseY=b+this.canvasPos.top;c&&this.event(new Pb(ha.EMove,a,b))},setCurrent:function(){ic.inst=this},getPixelRatio:function(){return this.useScreenPixels?window.devicePixelRatio:1},get_width:function(){return Math.round(this.canvasPos.width*this.getPixelRatio())},get_height:function(){return Math.round(this.canvasPos.height*
this.getPixelRatio())},get_mouseX:function(){return Math.round((this.curMouseX-this.canvasPos.left)*this.getPixelRatio())},get_mouseY:function(){return Math.round((this.curMouseY-this.canvasPos.top)*this.getPixelRatio())},get_mouseLock:function(){return 2==this.mouseMode._hx_index?!0:!1},set_mouseLock:function(a){return da.enumEq(this.set_mouseMode(a?Jc.AbsoluteUnbound(!0):Jc.Absolute),Jc.AbsoluteUnbound(!0))},get_mouseClip:function(){return!1},set_mouseClip:function(a){if(a)throw t.thrown("Can't clip cursor on this platform.");
return!1},set_mouseMode:function(a){if(da.enumEq(a,this.mouseMode))return a;var b=this.onMouseModeChange(this.mouseMode,a);null!=b&&(a=b);b=this.pointerLockTarget=null!=this.canvas?this.canvas:window.document.documentElement;a==Jc.Absolute?b.ownerDocument.pointerLockElement==b&&b.ownerDocument.exitPointerLock():this.canLockMouse&&b.ownerDocument.pointerLockElement!=b&&b.requestPointerLock();return this.mouseMode=a},get_vsync:function(){return!0},set_vsync:function(a){if(!a)throw t.thrown("Can't disable vsync on this platform");
return!0},onPointerLockChange:function(a){this.mouseMode!=Jc.Absolute&&this.pointerLockTarget.ownerDocument.pointerLockElement!=this.pointerLockTarget&&(this.canLockMouse=!1,this.set_mouseMode(Jc.Absolute),this.canLockMouse=!0)},onMouseDown:function(a){if(this.mouseMode==Jc.Absolute){if(a.clientX!=this.curMouseX||a.clientY!=this.curMouseY)this.onMouseMove(a)}else{if(this.pointerLockTarget.ownerDocument.pointerLockElement!=this.pointerLockTarget&&(this.pointerLockTarget.requestPointerLock(),this.discardMouseCaptureEvent)){this.discardMouseUp=
a.button;return}if(0!=a.movementX||0!=a.movementY)this.onMouseMove(a)}var b=new Pb(ha.EPush,this.get_mouseX(),this.get_mouseY());a=a.button;switch(a){case 1:a=2;break;case 2:a=1}b.button=a;this.event(b)},onMouseUp:function(a){if(this.discardMouseUp==a.button)this.discardMouseUp=-1;else{if(this.mouseMode==Jc.Absolute?a.clientX!=this.curMouseX||a.clientY!=this.curMouseY:0!=a.movementX||0!=a.movementY)this.onMouseMove(a);var b=new Pb(ha.ERelease,this.get_mouseX(),this.get_mouseY());a=a.button;switch(a){case 1:a=
2;break;case 2:a=1}b.button=a;this.event(b)}},onMouseLeave:function(a){var b=new Pb(ha.EReleaseOutside,this.get_mouseX(),this.get_mouseY());a=a.button;switch(a){case 1:a=2;break;case 2:a=1}b.button=a;this.event(b)},onMouseMove:function(a){var b=this.mouseMode;switch(b._hx_index){case 0:this.curMouseX=a.clientX;this.curMouseY=a.clientY;this.event(new Pb(ha.EMove,this.get_mouseX(),this.get_mouseY()));break;case 1:b=b.callback;if(this.pointerLockTarget.ownerDocument.pointerLockElement!=this.pointerLockTarget)break;
a=new Pb(ha.EMove,a.movementX,a.movementY);b(a);!a.cancel&&a.propagate&&(a.cancel=!1,a.propagate=!1,a.relX=this.curMouseX,a.relY=this.curMouseY,this.event(a));break;case 2:this.pointerLockTarget.ownerDocument.pointerLockElement==this.pointerLockTarget&&(this.curMouseX+=a.movementX,this.curMouseY+=a.movementY,this.event(new Pb(ha.EMove,this.get_mouseX(),this.get_mouseY())))}},onMouseWheel:function(a){a.preventDefault();var b=new Pb(ha.EWheel,this.get_mouseX(),this.get_mouseY());b.wheelDelta=a.deltaY/
120;this.event(b)},onTouchStart:function(a){a.preventDefault();var b=0;for(a=a.changedTouches;b<a.length;){var c=a[b];++b;var d=Math.round((c.clientX-this.canvasPos.left)*this.getPixelRatio());var e=Math.round((c.clientY-this.canvasPos.top)*this.getPixelRatio());d=new Pb(ha.EPush,d,e);d.touchId=c.identifier;this.event(d)}},onTouchMove:function(a){a.preventDefault();var b=0;for(a=a.changedTouches;b<a.length;){var c=a[b];++b;var d=Math.round((c.clientX-this.canvasPos.left)*this.getPixelRatio());var e=
Math.round((c.clientY-this.canvasPos.top)*this.getPixelRatio());d=new Pb(ha.EMove,d,e);d.touchId=c.identifier;this.event(d)}},onTouchEnd:function(a){a.preventDefault();var b=0;for(a=a.changedTouches;b<a.length;){var c=a[b];++b;var d=Math.round((c.clientX-this.canvasPos.left)*this.getPixelRatio());var e=Math.round((c.clientY-this.canvasPos.top)*this.getPixelRatio());d=new Pb(ha.ERelease,d,e);d.touchId=c.identifier;this.event(d)}},onKeyUp:function(a){var b=new Pb(ha.EKeyUp,this.get_mouseX(),this.get_mouseY());
b.keyCode=a.keyCode;this.event(b);this.propagateKeyEvents||(a.preventDefault(),a.stopPropagation())},onKeyDown:function(a){var b=new Pb(ha.EKeyDown,this.get_mouseX(),this.get_mouseY());b.keyCode=a.keyCode;this.event(b);if(!this.propagateKeyEvents){switch(b.keyCode){case 8:case 9:case 16:case 17:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:a.preventDefault()}a.stopPropagation()}},onKeyPress:function(a){var b=new Pb(ha.ETextInput,this.get_mouseX(),this.get_mouseY());b.charCode=a.charCode;
this.event(b);this.propagateKeyEvents||(a.preventDefault(),a.stopPropagation())},onFocus:function(a){this.event(new Pb(a?ha.EFocus:ha.EFocusLost));this.focused=a},get_isFocused:function(){return this.focused},get_displayMode:function(){return null!=window.document.fullscreenElement?Rb.Borderless:Rb.Windowed},set_displayMode:function(a){if(!te.get_supported())return a;var b=window.document,c=b.documentElement;if(b.fullscreenElement==c==(a!=Rb.Windowed))return Rb.Windowed;a!=Rb.Windowed?c.requestFullscreen():
b.exitFullscreen();return a},get_title:function(){return window.document.title},set_title:function(a){return window.document.title=a},__class__:ic};var te=function(){};te.__name__="js.Browser";te.get_supported=function(){return"undefined"!=typeof window&&"undefined"!=typeof window.location?"string"==typeof window.location.protocol:!1};var la=function(){};la.__name__="hxd.System";la.timeoutTick=function(){};la.getCurrentLoop=function(){return la.loopFunc};la.setLoop=function(a){la.loopInit||(la.loopInit=
!0,la.browserLoop());la.loopFunc=a};la.browserLoop=function(){if(te.get_supported()){var a=window,b=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame;0<la.fpsLimit?window.setTimeout(function(){return b(la.browserLoop)},1E3/la.fpsLimit):b(la.browserLoop)}else throw t.thrown("Cannot use browserLoop without Browser support nor defining nodejs + hxnodejs");null!=la.loopFunc&&la.loopFunc()};la.start=function(a){a()};la.setNativeCursor=function(a){if(null==la.currentNativeCursor||
!da.enumEq(a,la.currentNativeCursor)){la.currentNativeCursor=a;la.currentCustomCursor=null;var b=ic.getInstance().canvas;if(null!=b){switch(a._hx_index){case 0:var c="default";break;case 1:c="pointer";break;case 2:c="move";break;case 3:c="text";break;case 4:c="none";break;case 5:c=a.custom;if(null==c.alloc){c.alloc=[];a=0;for(var d=c.frames;a<d.length;){var e=d[a];++a;c.alloc.push('url("'+e.ctx.canvas.toDataURL("image/png")+'") '+c.offsetX+" "+c.offsetY+", default")}}1<c.frames.length&&(la.currentCustomCursor=
c,c.reset());c=c.alloc[c.frameIndex];break;case 6:throw t.thrown("assert");}b.style.cursor=c}}};la.getDeviceName=function(){return"Unknown"};la.getDefaultFrameRate=function(){return 60};la.getValue=function(a){switch(a._hx_index){case 0:return la.get_platform()!=Xb.Android?la.get_platform()==Xb.IOS:!0;case 1:return!0;case 2:return la.get_platform()!=Xb.Android?la.get_platform()==Xb.IOS:!0}};la.exit=function(){};la.openURL=function(a){window.open(a,"_blank")};la.updateCursor=function(){if(null!=la.currentCustomCursor){var a=
la.currentCustomCursor.update(ea.elapsedTime);if(-1!=a){var b=ic.getInstance().canvas;null!=b&&(b.style.cursor=la.currentCustomCursor.alloc[a])}}};la.getClipboardText=function(){return null};la.setClipboardText=function(a){return!1};la.getLocale=function(){return R.navigator.language+"_"+R.navigator.language.toUpperCase()};la.get_width=function(){return Math.round(window.document.body.clientWidth*window.devicePixelRatio)};la.get_height=function(){return Math.round(window.document.body.clientHeight*
window.devicePixelRatio)};la.get_lang=function(){return R.navigator.language};la.get_platform=function(){var a=R.navigator.userAgent.toLowerCase();return 0<=a.indexOf("android")?Xb.Android:0<=a.indexOf("ipad")||0<=a.indexOf("iphone")||0<=a.indexOf("ipod")?Xb.IOS:Xb.PC};la.get_screenDPI=function(){return 72};la.get_allowTimeout=function(){return!1};la.set_allowTimeout=function(a){return!1};var Rb=K["hxd.DisplayMode"]={__ename__:!0,__constructs__:null,Windowed:{_hx_name:"Windowed",_hx_index:0,__enum__:"hxd.DisplayMode",
toString:v},Borderless:{_hx_name:"Borderless",_hx_index:1,__enum__:"hxd.DisplayMode",toString:v},Fullscreen:{_hx_name:"Fullscreen",_hx_index:2,__enum__:"hxd.DisplayMode",toString:v},FullscreenResize:{_hx_name:"FullscreenResize",_hx_index:3,__enum__:"hxd.DisplayMode",toString:v}};Rb.__constructs__=[Rb.Windowed,Rb.Borderless,Rb.Fullscreen,Rb.FullscreenResize];Rb.__empty_constructs__=[Rb.Windowed,Rb.Borderless,Rb.Fullscreen,Rb.FullscreenResize];var $g=function(a){this.file=a.name;this.native=a};$g.__name__=
"hxd._Window.NativeDroppedFile";$g.__super__=Zg;$g.prototype=D(Zg.prototype,{getBytes:function(a){var b=new FileReader;b.onload=function(c){a(S.ofData(b.result))};b.onerror=function(b){a(null)};b.readAsArrayBuffer(this.native)},__class__:$g});var Lb=K["hxd.clipper.ClipType"]={__ename__:!0,__constructs__:null,Intersection:{_hx_name:"Intersection",_hx_index:0,__enum__:"hxd.clipper.ClipType",toString:v},Union:{_hx_name:"Union",_hx_index:1,__enum__:"hxd.clipper.ClipType",toString:v},Difference:{_hx_name:"Difference",
_hx_index:2,__enum__:"hxd.clipper.ClipType",toString:v},Xor:{_hx_name:"Xor",_hx_index:3,__enum__:"hxd.clipper.ClipType",toString:v}};Lb.__constructs__=[Lb.Intersection,Lb.Union,Lb.Difference,Lb.Xor];Lb.__empty_constructs__=[Lb.Intersection,Lb.Union,Lb.Difference,Lb.Xor];var Yb=K["hxd.clipper._Clipper.EdgeSide"]={__ename__:!0,__constructs__:null,Left:{_hx_name:"Left",_hx_index:0,__enum__:"hxd.clipper._Clipper.EdgeSide",toString:v},Right:{_hx_name:"Right",_hx_index:1,__enum__:"hxd.clipper._Clipper.EdgeSide",
toString:v}};Yb.__constructs__=[Yb.Left,Yb.Right];Yb.__empty_constructs__=[Yb.Left,Yb.Right];var wb=K["hxd.clipper._Clipper.Direction"]={__ename__:!0,__constructs__:null,RightToLeft:{_hx_name:"RightToLeft",_hx_index:0,__enum__:"hxd.clipper._Clipper.Direction",toString:v},LeftToRight:{_hx_name:"LeftToRight",_hx_index:1,__enum__:"hxd.clipper._Clipper.Direction",toString:v}};wb.__constructs__=[wb.RightToLeft,wb.LeftToRight];wb.__empty_constructs__=[wb.RightToLeft,wb.LeftToRight];var Je=function(){var a=
[];this.polygon=null==a?[]:a;this.childs=[]};Je.__name__="hxd.clipper._Clipper.PolyNode";Je.prototype={isHoleNode:function(){for(var a=!0,b=this.parent;null!=b;)a=!a,b=b.parent;return a},get_childCount:function(){return this.childs.length},get_contour:function(){return this.polygon},addChild:function(a){var b=this.childs.length;this.childs.push(a);a.parent=this;a.index=b},getNext:function(){return 0<this.childs.length?this.childs[0]:this.getNextSiblingUp()},getNextSiblingUp:function(){return null==
this.parent?null:this.index==this.parent.childs.length-1?this.parent.getNextSiblingUp():this.parent.childs[this.index+1]},isHole:function(){return this.isHoleNode()},__class__:Je};var ii=function(){Je.call(this);this.allPolys=[]};ii.__name__="hxd.clipper._Clipper.PolyTree";ii.__super__=Je;ii.prototype=D(Je.prototype,{toPolygons:function(a){a=[];this.addRec(this,a)},addRec:function(a,b){0<a.polygon.length&&b.push(a.polygon);var c=0;for(a=a.childs;c<a.length;){var d=a[c];++c;this.addRec(d,b)}},clear:function(){this.allPolys=
[];this.childs=[]},getFirst:function(){return 0<this.childs.length?this.childs[0]:null},get_total:function(){var a=this.allPolys.length;0<a&&this.childs[0]!=this.allPolys[0]&&--a;return a},__class__:ii});var ji=function(){};ji.__name__="hxd.clipper._Clipper.TEdge";ji.prototype={get_top:function(){return new V(this.topX,this.topY)},get_bot:function(){return new V(this.botX,this.botY)},get_curr:function(){return new V(this.currX,this.currY)},set_top:function(a){this.topX=a.x;this.topY=a.y;return a},
set_bot:function(a){this.botX=a.x;this.botY=a.y;return a},set_curr:function(a){this.currX=a.x;this.currY=a.y;return a},__class__:ji};var ki=function(){};ki.__name__="hxd.clipper._Clipper.IntersectNode";ki.prototype={__class__:ki};var ah=function(){};ah.__name__="hxd.clipper._Clipper.LocalMinima";ah.prototype={__class__:ah};var lg=function(){};lg.__name__="hxd.clipper._Clipper.Scanbeam";lg.prototype={__class__:lg};var li=function(){};li.__name__="hxd.clipper._Clipper.OutRec";li.prototype={__class__:li};
var Df=function(){};Df.__name__="hxd.clipper._Clipper.OutPt";Df.prototype={__class__:Df};var bh=function(){};bh.__name__="hxd.clipper._Clipper.Join";bh.prototype={__class__:bh};var qd=function(){this.m_edges=[];this.m_CurrentLM=this.m_MinimaList=null};qd.__name__="hxd.clipper._Clipper.ClipperBase";qd.nearZero=function(a){return-1E-20<a?1E-20>a:!1};qd.getBounds=function(a){var b=new mi;var c=0;for(var d=a.length;c<d&&0==a[c].length;)++c;b.left=b.right=a[c][0].x;b.top=b.bottom=a[c][0].y;for(var e=0;e<
d;){c=e++;var f=0;c=a[c];for(var g=c.length;f<g;){var h=c[f++];h.x<b.left?b.left=h.x:h.x>b.right&&(b.right=h.x);h.y<b.top?b.top=h.y:h.y>b.bottom&&(b.bottom=h.y)}}return b};qd.prototype={isHorizontal:function(a){return 0==a.deltaY},abs:function(a){return 0>a?-a:a},PointIsVertex:function(a,b){var c=b;do{var d=c.pt;if(d.x==a.x&&d.y==a.y)return!0;c=c.next}while(c!=b);return!1},PointOnLineSegment:function(a,b,c){return a.x==b.x&&a.y==b.y||a.x==c.x&&a.y==c.y?!0:a.x>b.x==a.x<c.x&&a.y>b.y==a.y<c.y?(a.x-b.x)*
(c.y-b.y)==(c.x-b.x)*(a.y-b.y):!1},PointOnPolygon:function(a,b){var c=b;do{if(this.PointOnLineSegment(a,c.pt,c.next.pt))return!0;c=c.next}while(c!=b);return!1},SlopesEqual:function(a,b){return a.deltaY*b.deltaX==a.deltaX*b.deltaY},SlopesEqual3:function(a,b,c){return 0==(a.y-b.y)*(b.x-c.x)-(a.x-b.x)*(b.y-c.y)},clear:function(){this.disposeLocalMinimaList();this.m_edges=[]},disposeLocalMinimaList:function(){for(;null!=this.m_MinimaList;){var a=this.m_MinimaList.next;this.m_MinimaList=null;this.m_MinimaList=
a}this.m_CurrentLM=null},addPolygons:function(a,b){for(var c=!1,d=0,e=a.length;d<e;){var f=a[d++];this.addPolygon(f,b)&&(c=!0)}return c},addPolygon:function(a,b){var c;for(c=a.length-1;0<c&&a[c]==a[0];)--c;for(;0<c&&a[c]==a[c-1];)--c;if(2>c)return!1;var d=[];var e=0;for(var f=c+1;e<f;)e++,d.push(new ji);f=!0;var g=d[1];e=a[1];g.currX=e.x;g.currY=e.y;e=d[0];g=a[0];e.next=d[1];e.prev=d[c];e.currX=g.x;e.currY=g.y;e.outIdx=-1;e=d[c];g=a[c];e.next=d[0];e.prev=d[c-1];e.currX=g.x;e.currY=g.y;e.outIdx=-1;
for(--c;0<c;)e=d[c],g=a[c],e.next=d[c+1],e.prev=d[c-1],e.currX=g.x,e.currY=g.y,e.outIdx=-1,--c;for(e=c=a=d[0];;)if(e.currX==e.next.currX&&e.currY==e.next.currY){if(e==e.next)break;e==a&&(a=e.next);c=e=this.RemoveEdge(e)}else{if(e.prev==e.next)break;g=e.prev;var h=g.currX,k=g.currY;null==k&&(k=0);null==h&&(h=0);g=h;h=k;k=e.currX;var l=e.currY;null==l&&(l=0);null==k&&(k=0);var m=e.next,p=m.currX;m=m.currY;null==m&&(m=0);null==p&&(p=0);0==(h-l)*(k-p)-(g-k)*(l-m)?this.preserveCollinear?(g=e.prev,g=new V(g.currX,
g.currY),h=new V(e.currX,e.currY),k=e.next,g=!this.Pt2IsBetweenPt1AndPt3(g,h,new V(k.currX,k.currY))):g=!0:g=!1;if(g)e==a&&(a=e.next),e=this.RemoveEdge(e),c=e=e.prev;else if(e=e.next,e==c)break}if(e.prev==e.next)return!1;e=a;do e.currY>=e.next.currY?(e.botX=e.currX,e.botY=e.currY,e.topX=e.next.currX,e.topY=e.next.currY):(e.topX=e.currX,e.topY=e.currY,e.botX=e.next.currX,e.botY=e.next.currY),this.SetDx(e),e.polyType=b,e=e.next,e.currY!=a.currY&&(f=!1);while(e!=a);if(f)return!1;this.m_edges.push(d);
d=null;e.prev.botX==e.prev.topX&&e.prev.botY==e.prev.topY&&(e=e.next);for(f=null;;){e=this.FindNextLocMin(e);if(e==d)break;else null==d&&(d=e);if(e==f)throw t.thrown("!");f=e;a=new ah;a.next=null;a.y=e.botY;e.dx<e.prev.dx?(a.leftBound=e.prev,a.rightBound=e,b=!1):(a.leftBound=e,a.rightBound=e.prev,b=!0);a.leftBound.side=Yb.Left;a.rightBound.side=Yb.Right;a.leftBound.windDelta=a.leftBound.next==a.rightBound?-1:1;a.rightBound.windDelta=-a.leftBound.windDelta;e=this.ProcessBound(a.leftBound,b);-2==e.outIdx&&
(e=this.ProcessBound(e,b));c=this.ProcessBound(a.rightBound,!b);-2==c.outIdx&&(c=this.ProcessBound(c,!b));-2==a.leftBound.outIdx?a.leftBound=null:-2==a.rightBound.outIdx&&(a.rightBound=null);this.InsertLocalMinima(a);b||(e=c)}return!0},InitEdge:function(a,b,c,d){a.next=b;a.prev=c;a.currX=d.x;a.currY=d.y;a.outIdx=-1},InitEdge2:function(a,b){a.currY>=a.next.currY?(a.botX=a.currX,a.botY=a.currY,a.topX=a.next.currX,a.topY=a.next.currY):(a.topX=a.currX,a.topY=a.currY,a.botX=a.next.currX,a.botY=a.next.currY);
this.SetDx(a);a.polyType=b},RemoveEdge:function(a){a.prev.next=a.next;a.next.prev=a.prev;var b=a.next;a.prev=null;return b},FindNextLocMin:function(a){for(var b;;){for(;a.botX!=a.prev.botX||a.botY!=a.prev.botY||a.currX==a.topX&&a.currY==a.topY;)a=a.next;if(-9007199254740992!=a.dx&&-9007199254740992!=a.prev.dx)break;for(;-9007199254740992==a.prev.dx;)a=a.prev;for(b=a;-9007199254740992==a.dx;)a=a.next;if(a.topY!=a.prev.botY){b.prev.botX<a.botX&&(a=b);break}}return a},ProcessBound:function(a,b){var c,
d=a;if(-2==d.outIdx){a=d;if(b){for(;a.topY==a.next.botY;)a=a.next;for(;a!=d&&-9007199254740992==a.dx;)a=a.prev}else{for(;a.topY==a.prev.botY;)a=a.prev;for(;a!=d&&-9007199254740992==a.dx;)a=a.next}if(a==d)d=b?a.next:a.prev;else{a=b?d.next:d.prev;var e=new ah;e.next=null;e.y=a.botY;e.leftBound=null;e.rightBound=a;a.windDelta=0;d=this.ProcessBound(a,b);this.InsertLocalMinima(e)}return d}-9007199254740992==a.dx&&(e=b?a.prev:a.next,-2!=e.outIdx&&(-9007199254740992==e.dx?e.botX!=a.botX&&e.topX!=a.botX&&
this.ReverseHorizontal(a):e.botX!=a.botX&&this.ReverseHorizontal(a)));e=a;if(b){for(;d.topY==d.next.botY&&-2!=d.next.outIdx;)d=d.next;if(-9007199254740992==d.dx&&-2!=d.next.outIdx){for(c=d;-9007199254740992==c.prev.dx;)c=c.prev;c.prev.topX==d.next.topX?b||(d=c.prev):c.prev.topX>d.next.topX&&(d=c.prev)}for(;a!=d;)a.nextInLML=a.next,-9007199254740992==a.dx&&a!=e&&a.botX!=a.prev.topX&&this.ReverseHorizontal(a),a=a.next;-9007199254740992==a.dx&&a!=e&&a.botX!=a.prev.topX&&this.ReverseHorizontal(a);d=d.next}else{for(;d.topY==
d.prev.botY&&-2!=d.prev.outIdx;)d=d.prev;if(-9007199254740992==d.dx&&-2!=d.prev.outIdx){for(c=d;-9007199254740992==c.next.dx;)c=c.next;c.next.topX==d.prev.topX?b||(d=c.next):c.next.topX>d.prev.topX&&(d=c.next)}for(;a!=d;)a.nextInLML=a.prev,-9007199254740992==a.dx&&a!=e&&a.botX!=a.next.topX&&this.ReverseHorizontal(a),a=a.prev;-9007199254740992==a.dx&&a!=e&&a.botX!=a.next.topX&&this.ReverseHorizontal(a);d=d.prev}return d},ReverseHorizontal:function(a){var b=a.topX;a.topX=a.botX;a.botX=b},Pt2IsBetweenPt1AndPt3:function(a,
b,c){return a.x==c.x&&a.y==c.y||a.x==b.x&&a.y==b.y||c.x==b.x&&c.y==b.y?!1:a.x!=c.x?b.x>a.x==b.x<c.x:b.y>a.y==b.y<c.y},SetDx:function(a){a.deltaX=a.topX-a.botX;a.deltaY=a.topY-a.botY;a.dx=0==a.deltaY?-9007199254740992:a.deltaX/a.deltaY},InsertLocalMinima:function(a){if(null==this.m_MinimaList)this.m_MinimaList=a;else if(a.y>=this.m_MinimaList.y)a.next=this.m_MinimaList,this.m_MinimaList=a;else{for(var b=this.m_MinimaList;null!=b.next&&a.y<b.next.y;)b=b.next;a.next=b.next;b.next=a}},PopLocalMinima:function(){null!=
this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.next)},SwapX:function(a){a.currX=a.topX;a.topX=a.botX;a.botX=a.currX},equals:function(a,b){return a.x==b.x?a.y==b.y:!1},Reset:function(){for(var a=this.m_CurrentLM=this.m_MinimaList;null!=a;){var b=a.leftBound;null!=b&&(b.currX=b.botX,b.currY=b.botY,b.side=Yb.Left,b.outIdx=-1);b=a.rightBound;null!=b&&(b.currX=b.botX,b.currY=b.botY,b.side=Yb.Right,b.outIdx=-1);a=a.next}},__class__:qd};var rd=K["hxd.clipper.NodeType"]={__ename__:!0,__constructs__:null,
Any:{_hx_name:"Any",_hx_index:0,__enum__:"hxd.clipper.NodeType",toString:v},Open:{_hx_name:"Open",_hx_index:1,__enum__:"hxd.clipper.NodeType",toString:v},Closed:{_hx_name:"Closed",_hx_index:2,__enum__:"hxd.clipper.NodeType",toString:v}};rd.__constructs__=[rd.Any,rd.Open,rd.Closed];rd.__empty_constructs__=[rd.Any,rd.Open,rd.Closed];var sc=K["hxd.clipper.ResultKind"]={__ename__:!0,__constructs__:null,All:{_hx_name:"All",_hx_index:0,__enum__:"hxd.clipper.ResultKind",toString:v},NoHoles:{_hx_name:"NoHoles",
_hx_index:1,__enum__:"hxd.clipper.ResultKind",toString:v},HolesOnly:{_hx_name:"HolesOnly",_hx_index:2,__enum__:"hxd.clipper.ResultKind",toString:v}};sc.__constructs__=[sc.All,sc.NoHoles,sc.HolesOnly];sc.__empty_constructs__=[sc.All,sc.NoHoles,sc.HolesOnly];var pb=function(){qd.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.preserveCollinear=this.strictlySimple=
this.reverseSolution=!1;this.resultKind=sc.All};pb.__name__="hxd.clipper.Clipper";pb.compareY=function(a,b){return 0<=b.pt.y-a.pt.y?1:-1};pb.Orientation=function(a){return 0<=pb.polArea(a)};pb.polArea=function(a){var b=a.length;if(3>b)return 0;for(var c=0,d=b-1,e=0;e<b;){var f=e++;c+=(a[d].x+a[f].x)*(a[d].y-a[f].y);d=f}return.5*-c};pb.SimplifyPolygon=function(a,b){null==b&&(b=wa.EvenOdd);var c=new pb;c.strictlySimple=!0;c.addPolygon(a,Wa.Subject);return c.execute(Lb.Union,b,b)};pb.SimplifyPolygons=
function(a,b){null==b&&(b=wa.EvenOdd);var c=new pb;c.strictlySimple=!0;c.addPolygons(a,Wa.Subject);return c.execute(Lb.Union,b,b)};pb.MinkowskiSums=function(a,b,c){var d=new pb;d.resultKind=null==c?sc.All:c;c=0;for(var e=b.length;c<e;){var f=c++,g=d.Minkowski(a,b[f],!0);d.addPolygons(g,Wa.Subject);f=d.TranslatePath(b[f],a[0]);d.addPolygon(f,Wa.Clip)}return d.execute(Lb.Union,wa.NonZero,wa.NonZero)};pb.MinkowskiDiff=function(a,b,c){var d=new pb;a=d.Minkowski(a,b,!1);d.resultKind=null==c?sc.All:c;d.addPolygons(a,
Wa.Subject);return d.execute(Lb.Union,wa.NonZero,wa.NonZero)};pb.__super__=qd;pb.prototype=D(qd.prototype,{xor:function(a,b){return a?!b:b},DisposeScanbeamList:function(){for(;null!=this.m_Scanbeam;){var a=this.m_Scanbeam.next;this.m_Scanbeam=null;this.m_Scanbeam=a}},Reset:function(){qd.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;for(var a=this.m_MinimaList;null!=a;)this.InsertScanbeam(a.y),a=a.next},InsertScanbeam:function(a){if(null==this.m_Scanbeam)this.m_Scanbeam=
new lg,this.m_Scanbeam.next=null,this.m_Scanbeam.y=a;else if(a>this.m_Scanbeam.y){var b=new lg;b.y=a;b.next=this.m_Scanbeam;this.m_Scanbeam=b}else{for(var c=this.m_Scanbeam;null!=c.next&&a<=c.next.y;)c=c.next;a!=c.y&&(b=new lg,b.y=a,b.next=c.next,c.next=b)}},execute:function(a,b,c){null==b&&(b=wa.EvenOdd);null==c&&(c=wa.EvenOdd);if(this.m_ExecuteLocked)return[];this.m_ExecuteLocked=!0;var d=[];this.m_SubjFillType=b;this.m_ClipFillType=c;this.m_ClipType=a;this.m_UsingPolyTree=!1;this.ExecuteInternal()&&
(d=this.BuildResult());this.DisposeAllPolyPts();this.m_ExecuteLocked=!1;return d},ExecuteTree:function(a,b,c,d){null==c&&(c=wa.EvenOdd);null==d&&(d=wa.EvenOdd);if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=c;this.m_ClipFillType=d;this.m_ClipType=a;this.m_UsingPolyTree=!0;(a=this.ExecuteInternal())&&this.BuildResult2(b);this.m_ExecuteLocked=!1;return a},FixHoleLinkage:function(a){if(null!=a.firstLeft&&(a.isHole==a.firstLeft.isHole||null==a.firstLeft.pts)){for(var b=a.firstLeft;null!=
b&&(b.isHole==a.isHole||null==b.pts);)b=b.firstLeft;a.firstLeft=b}},ExecuteInternal:function(){this.Reset();if(null==this.m_CurrentLM)return!1;var a=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(a);0<this.m_GhostJoins.length&&(this.m_GhostJoins=[]);this.ProcessHorizontals(!1);if(null==this.m_Scanbeam)break;a=this.PopScanbeam();if(!this.ProcessIntersections(a))return!1;this.ProcessEdgesAtTopOfScanbeam(a)}while(null!=this.m_Scanbeam||null!=this.m_CurrentLM);for(var b=0,c=this.m_PolyOuts;b<c.length;)if(a=
c[b],++b,null!=a.pts){var d=this.reverseSolution;(a.isHole?!d:d)==0<this.Area(a)&&this.ReversePolyPtLinks(a.pts)}this.JoinCommonEdges();b=0;for(c=this.m_PolyOuts;b<c.length;)a=c[b],++b,null!=a.pts&&this.FixupOutPolygon(a);this.strictlySimple&&this.DoSimplePolygons();this.m_Joins=[];this.m_GhostJoins=[];return!0},PopScanbeam:function(){var a=this.m_Scanbeam.y;this.m_Scanbeam=this.m_Scanbeam.next;return a},DisposeAllPolyPts:function(){for(var a=0,b=this.m_PolyOuts.length;a<b;){var c=a++;this.DisposeOutRec(c)}this.m_PolyOuts=
[]},DisposeOutRec:function(a){this.m_PolyOuts[a].pts=null;this.m_PolyOuts[a]=null},AddJoin:function(a,b,c){var d=new bh;d.outPt1=a;d.outPt2=b;d.offPt=c;this.m_Joins.push(d)},AddGhostJoin:function(a,b){var c=new bh;c.outPt1=a;c.offPt=b;this.m_GhostJoins.push(c)},InsertLocalMinimaIntoAEL:function(a){for(;null!=this.m_CurrentLM&&this.m_CurrentLM.y==a;){var b=this.m_CurrentLM.leftBound,c=this.m_CurrentLM.rightBound;this.PopLocalMinima();var d=null;null==b?(this.InsertEdgeIntoAEL(c),this.SetWindingCount(c),
this.IsContributing(c)&&(d=this.AddOutPt(c,new V(c.botX,c.botY)))):(null==c?(this.InsertEdgeIntoAEL(b),this.SetWindingCount(b),this.IsContributing(b)&&(d=this.AddOutPt(b,new V(b.botX,b.botY)))):(this.InsertEdgeIntoAEL(b),this.InsertEdgeIntoAEL(c,b),this.SetWindingCount(b),c.windCnt=b.windCnt,c.windCnt2=b.windCnt2,this.IsContributing(b)&&(d=this.AddLocalMinPoly(b,c,new V(b.botX,b.botY)))),this.InsertScanbeam(b.topY));null!=c&&(0==c.deltaY?this.AddEdgeToSEL(c):this.InsertScanbeam(c.topY));if(null!=
b&&null!=c){if(null!=d&&0==c.deltaY&&0<this.m_GhostJoins.length&&0!=c.windDelta)for(var e=0,f=this.m_GhostJoins;e<f.length;){var g=f[e];++e;this.HorzSegmentsOverlap(g.outPt1.pt.x,g.offPt.x,c.botX,c.topX)&&this.AddJoin(g.outPt1,d,g.offPt)}0<=b.outIdx&&null!=b.prevInAEL&&b.prevInAEL.currX==b.botX&&0<=b.prevInAEL.outIdx?(e=b.prevInAEL,e=e.deltaY*b.deltaX==e.deltaX*b.deltaY):e=!1;e&&0!=b.windDelta&&0!=b.prevInAEL.windDelta&&(e=this.AddOutPt(b.prevInAEL,new V(b.botX,b.botY)),this.AddJoin(d,e,new V(b.topX,
b.topY)));if(b.nextInAEL!=c&&(0<=c.outIdx&&0<=c.prevInAEL.outIdx?(e=c.prevInAEL,e=e.deltaY*c.deltaX==e.deltaX*c.deltaY):e=!1,e&&0!=c.windDelta&&0!=c.prevInAEL.windDelta&&(e=this.AddOutPt(c.prevInAEL,new V(c.botX,c.botY)),this.AddJoin(d,e,new V(c.topX,c.topY))),d=b.nextInAEL,null!=d))for(;d!=c;)this.IntersectEdges(c,d,new V(b.currX,b.currY)),d=d.nextInAEL}}},InsertEdgeIntoAEL:function(a,b){if(null==this.m_ActiveEdges)a.prevInAEL=null,a.nextInAEL=null,this.m_ActiveEdges=a;else if(null==b&&this.E2InsertsBeforeE1(this.m_ActiveEdges,
a))a.prevInAEL=null,a.nextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.prevInAEL=a;else{null==b&&(b=this.m_ActiveEdges);for(;null!=b.nextInAEL&&!this.E2InsertsBeforeE1(b.nextInAEL,a);)b=b.nextInAEL;a.nextInAEL=b.nextInAEL;null!=b.nextInAEL&&(b.nextInAEL.prevInAEL=a);a.prevInAEL=b;b.nextInAEL=a}},E2InsertsBeforeE1:function(a,b){if(b.currX==a.currX){if(b.topY>a.topY){var c=b.topY;c==a.topY?c=a.topX:(c=a.dx*(c-a.botY),c=a.botX+(0>c?c-.5|0:c+.5|0));return b.topX<c}c=a.topY;c==b.topY?
c=b.topX:(c=b.dx*(c-b.botY),c=b.botX+(0>c?c-.5|0:c+.5|0));return a.topX>c}return b.currX<a.currX},IsEvenOddFillType:function(a){return a.polyType==Wa.Subject?this.m_SubjFillType==wa.EvenOdd:this.m_ClipFillType==wa.EvenOdd},IsEvenOddAltFillType:function(a){return a.polyType==Wa.Subject?this.m_ClipFillType==wa.EvenOdd:this.m_SubjFillType==wa.EvenOdd},IsContributing:function(a){if(a.polyType==Wa.Subject){var b=this.m_SubjFillType;var c=this.m_ClipFillType}else b=this.m_ClipFillType,c=this.m_SubjFillType;
switch(b._hx_index){case 0:if(0==a.windDelta&&1!=a.windCnt)return!1;break;case 1:b=a.windCnt;if(1!=(0>b?-b:b))return!1;break;case 2:if(1!=a.windCnt)return!1;break;default:if(-1!=a.windCnt)return!1}switch(this.m_ClipType._hx_index){case 0:switch(c._hx_index){case 0:case 1:return 0!=a.windCnt2;case 2:return 0<a.windCnt2;default:return 0>a.windCnt2}case 1:switch(c._hx_index){case 0:case 1:return 0==a.windCnt2;case 2:return 0>=a.windCnt2;default:return 0<=a.windCnt2}case 2:if(a.polyType==Wa.Subject)switch(c._hx_index){case 0:case 1:return 0==
a.windCnt2;case 2:return 0>=a.windCnt2;default:return 0<=a.windCnt2}else switch(c._hx_index){case 0:case 1:return 0!=a.windCnt2;case 2:return 0<a.windCnt2;default:return 0>a.windCnt2}case 3:if(0==a.windDelta)switch(c._hx_index){case 0:case 1:return 0==a.windCnt2;case 2:return 0>=a.windCnt2;default:return 0<=a.windCnt2}else return!0}},SetWindingCount:function(a){for(var b=a.prevInAEL;null!=b&&(b.polyType!=a.polyType||0==b.windDelta);)b=b.prevInAEL;if(null==b)a.windCnt=0==a.windDelta?1:a.windDelta,
a.windCnt2=0,b=this.m_ActiveEdges;else{if(0==a.windDelta&&this.m_ClipType!=Lb.Union)a.windCnt=1;else if(a.polyType==Wa.Subject?this.m_SubjFillType==wa.EvenOdd:this.m_ClipFillType==wa.EvenOdd)if(0==a.windDelta){for(var c=!0,d=b.prevInAEL;null!=d;)d.polyType==b.polyType&&0!=d.windDelta&&(c=!c),d=d.prevInAEL;a.windCnt=c?0:1}else a.windCnt=a.windDelta;else a.windCnt=0>b.windCnt*b.windDelta?1<b.windCnt||-1>b.windCnt?0>b.windDelta*a.windDelta?b.windCnt:b.windCnt+a.windDelta:0==a.windDelta?1:a.windDelta:
0==a.windDelta?0>b.windCnt?b.windCnt-1:b.windCnt+1:0>b.windDelta*a.windDelta?b.windCnt:b.windCnt+a.windDelta;a.windCnt2=b.windCnt2;b=b.nextInAEL}if(a.polyType==Wa.Subject?this.m_ClipFillType==wa.EvenOdd:this.m_SubjFillType==wa.EvenOdd)for(;b!=a;)0!=b.windDelta&&(a.windCnt2=0==a.windCnt2?1:0),b=b.nextInAEL;else for(;b!=a;)a.windCnt2+=b.windDelta,b=b.nextInAEL},AddEdgeToSEL:function(a){null==this.m_SortedEdges?(this.m_SortedEdges=a,a.prevInSEL=null,a.nextInSEL=null):(a.nextInSEL=this.m_SortedEdges,
a.prevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.prevInSEL=a)},CopyAELToSEL:function(){var a=this.m_ActiveEdges;for(this.m_SortedEdges=a;null!=a;)a.prevInSEL=a.prevInAEL,a=a.nextInSEL=a.nextInAEL},SwapPositionsInAEL:function(a,b){if(a.nextInAEL!=a.prevInAEL&&b.nextInAEL!=b.prevInAEL){if(a.nextInAEL==b){var c=b.nextInAEL;null!=c&&(c.prevInAEL=a);var d=a.prevInAEL;null!=d&&(d.nextInAEL=b);b.prevInAEL=d;b.nextInAEL=a;a.prevInAEL=b;a.nextInAEL=c}else b.nextInAEL==a?(c=a.nextInAEL,null!=c&&(c.prevInAEL=
b),d=b.prevInAEL,null!=d&&(d.nextInAEL=a),a.prevInAEL=d,a.nextInAEL=b,b.prevInAEL=a,b.nextInAEL=c):(c=a.nextInAEL,d=a.prevInAEL,a.nextInAEL=b.nextInAEL,null!=a.nextInAEL&&(a.nextInAEL.prevInAEL=a),a.prevInAEL=b.prevInAEL,null!=a.prevInAEL&&(a.prevInAEL.nextInAEL=a),b.nextInAEL=c,null!=b.nextInAEL&&(b.nextInAEL.prevInAEL=b),b.prevInAEL=d,null!=b.prevInAEL&&(b.prevInAEL.nextInAEL=b));null==a.prevInAEL?this.m_ActiveEdges=a:null==b.prevInAEL&&(this.m_ActiveEdges=b)}},SwapPositionsInSEL:function(a,b){if(null!=
a.nextInSEL||null!=a.prevInSEL)if(null!=b.nextInSEL||null!=b.prevInSEL){if(a.nextInSEL==b){var c=b.nextInSEL;null!=c&&(c.prevInSEL=a);var d=a.prevInSEL;null!=d&&(d.nextInSEL=b);b.prevInSEL=d;b.nextInSEL=a;a.prevInSEL=b;a.nextInSEL=c}else b.nextInSEL==a?(c=a.nextInSEL,null!=c&&(c.prevInSEL=b),d=b.prevInSEL,null!=d&&(d.nextInSEL=a),a.prevInSEL=d,a.nextInSEL=b,b.prevInSEL=a,b.nextInSEL=c):(c=a.nextInSEL,d=a.prevInSEL,a.nextInSEL=b.nextInSEL,null!=a.nextInSEL&&(a.nextInSEL.prevInSEL=a),a.prevInSEL=b.prevInSEL,
null!=a.prevInSEL&&(a.prevInSEL.nextInSEL=a),b.nextInSEL=c,null!=b.nextInSEL&&(b.nextInSEL.prevInSEL=b),b.prevInSEL=d,null!=b.prevInSEL&&(b.prevInSEL.nextInSEL=b));null==a.prevInSEL?this.m_SortedEdges=a:null==b.prevInSEL&&(this.m_SortedEdges=b)}},AddLocalMaxPoly:function(a,b,c){this.AddOutPt(a,c);0==b.windDelta&&this.AddOutPt(b,c);a.outIdx==b.outIdx?(a.outIdx=-1,b.outIdx=-1):a.outIdx<b.outIdx?this.AppendPolygon(a,b):this.AppendPolygon(b,a)},AddLocalMinPoly:function(a,b,c){if(0==b.deltaY||a.dx>b.dx){var d=
this.AddOutPt(a,c);b.outIdx=a.outIdx;a.side=Yb.Left;b.side=Yb.Right;var e=a;a=e.prevInAEL==b?b.prevInAEL:e.prevInAEL}else d=this.AddOutPt(b,c),a.outIdx=b.outIdx,a.side=Yb.Right,b.side=Yb.Left,e=b,a=e.prevInAEL==a?a.prevInAEL:e.prevInAEL;if(null!=a&&0<=a.outIdx){var f=c.y;f==a.topY?b=a.topX:(f=a.dx*(f-a.botY),b=a.botX+(0>f?f-.5|0:f+.5|0));f=c.y;f==e.topY?f=e.topX:(f=e.dx*(f-e.botY),f=e.botX+(0>f?f-.5|0:f+.5|0));b=b==f}else b=!1;b&&e.deltaY*a.deltaX==e.deltaX*a.deltaY&&0!=e.windDelta&&0!=a.windDelta&&
(c=this.AddOutPt(a,c),this.AddJoin(d,c,new V(e.topX,e.topY)));return d},CreateOutRec:function(){var a=new li;a.idx=-1;a.isHole=!1;a.firstLeft=null;a.pts=null;a.bottomPt=null;a.polyNode=null;this.m_PolyOuts.push(a);a.idx=this.m_PolyOuts.length-1;return a},AddOutPt:function(a,b){var c=a.side==Yb.Left;if(0>a.outIdx){var d=this.CreateOutRec();var e=new Df;d.pts=e;e.idx=d.idx;e.pt=new V(b.x,b.y);e.next=e;e.prev=e;this.SetHoleState(a,d);a.outIdx=d.idx;return e}d=this.m_PolyOuts[a.outIdx];e=d.pts;c?(a=e.pt,
a=b.x==a.x&&b.y==a.y):a=!1;if(a)return e;c?a=!1:(a=e.prev.pt,a=b.x==a.x&&b.y==a.y);if(a)return e.prev;a=new Df;a.idx=d.idx;a.pt=new V(b.x,b.y);a.next=e;a.prev=e.prev;a.prev.next=a;e.prev=a;c&&(d.pts=a);return a},HorzSegmentsOverlap:function(a,b,c,d){if(a>b){var e=a;a=b;b=e}c>d&&(e=c,c=d,d=e);return a<d?c<b:!1},SetHoleState:function(a,b){var c=!1;for(a=a.prevInAEL;null!=a;)0<=a.outIdx&&0!=a.windDelta&&(c=!c,null==b.firstLeft&&(b.firstLeft=this.m_PolyOuts[a.outIdx])),a=a.prevInAEL;c&&(b.isHole=!0)},
GetDx:function(a,b){return a.y==b.y?-9007199254740992:(b.x-a.x)/(b.y-a.y)},FirstIsBottomPt:function(a,b){for(var c,d,e=a.prev;;){d=e.pt;c=a.pt;if(d.x!=c.x||d.y!=c.y||e==a)break;e=e.prev}c=this.GetDx(a.pt,e.pt);var f=0>c?-c:c;for(e=a.next;;){d=e.pt;c=a.pt;if(d.x!=c.x||d.y!=c.y||e==a)break;e=e.next}c=this.GetDx(a.pt,e.pt);a=0>c?-c:c;for(e=b.prev;;){d=e.pt;c=b.pt;if(d.x!=c.x||d.y!=c.y||e==b)break;e=e.prev}c=this.GetDx(b.pt,e.pt);var g=0>c?-c:c;for(e=b.next;;){d=e.pt;c=b.pt;if(d.x!=c.x||d.y!=c.y||e==
b)break;e=e.next}c=this.GetDx(b.pt,e.pt);b=0>c?-c:c;return f>=g&&f>=b?!0:a>=g?a>=b:!1},GetBottomPt:function(a){for(var b=null,c=a.next;c!=a;)c.pt.y>a.pt.y?(a=c,b=null):c.pt.y==a.pt.y&&c.pt.x<=a.pt.x&&(c.pt.x<a.pt.x?(b=null,a=c):c.next!=a&&c.prev!=a&&(b=c)),c=c.next;if(null!=b)for(;b!=c;)for(this.FirstIsBottomPt(c,b)||(a=b),b=b.next;;){var d=b.pt,e=a.pt;if(d.x==e.x&&d.y==e.y)break;b=b.next}return a},GetLowermostRec:function(a,b){null==a.bottomPt&&(a.bottomPt=this.GetBottomPt(a.pts));null==b.bottomPt&&
(b.bottomPt=this.GetBottomPt(b.pts));var c=a.bottomPt,d=b.bottomPt;return c.pt.y>d.pt.y?a:c.pt.y<d.pt.y?b:c.pt.x<d.pt.x?a:c.pt.x>d.pt.x?b:c.next==c?b:d.next==d?a:this.FirstIsBottomPt(c,d)?a:b},Param1RightOfParam2:function(a,b){do if(a=a.firstLeft,a==b)return!0;while(null!=a);return!1},GetOutRec:function(a){for(a=this.m_PolyOuts[a];a!=this.m_PolyOuts[a.idx];)a=this.m_PolyOuts[a.idx];return a},AppendPolygon:function(a,b){var c=this.m_PolyOuts[a.outIdx],d=this.m_PolyOuts[b.outIdx];var e=this.Param1RightOfParam2(c,
d)?d:this.Param1RightOfParam2(d,c)?c:this.GetLowermostRec(c,d);var f=c.pts,g=f.prev,h=d.pts,k=h.prev;a.side==Yb.Left?(b.side==Yb.Left?(this.ReversePolyPtLinks(h),h.next=f,f.prev=h,g.next=k,k.prev=g,c.pts=k):(k.next=f,f.prev=k,h.prev=g,g.next=h,c.pts=h),f=Yb.Left):(b.side==Yb.Right?(this.ReversePolyPtLinks(h),g.next=k,k.prev=g,h.next=f,f.prev=h):(g.next=h,h.prev=g,f.prev=k,k.next=f),f=Yb.Right);c.bottomPt=null;e==d&&(d.firstLeft!=c&&(c.firstLeft=d.firstLeft),c.isHole=d.isHole);d.pts=null;d.bottomPt=
null;d.firstLeft=c;e=a.outIdx;g=b.outIdx;a.outIdx=-1;b.outIdx=-1;for(a=this.m_ActiveEdges;null!=a;){if(a.outIdx==g){a.outIdx=e;a.side=f;break}a=a.nextInAEL}d.idx=c.idx},ReversePolyPtLinks:function(a){if(null!=a){var b=a;do{var c=b.next;b.next=b.prev;b=b.prev=c}while(b!=a)}},SwapSides:function(a,b){var c=a.side;a.side=b.side;b.side=c},SwapPolyIndexes:function(a,b){var c=a.outIdx;a.outIdx=b.outIdx;b.outIdx=c},IntersectEdges:function(a,b,c){var d=0<=a.outIdx,e=0<=b.outIdx;if(a.polyType==b.polyType)if(a.polyType==
Wa.Subject?this.m_SubjFillType==wa.EvenOdd:this.m_ClipFillType==wa.EvenOdd){var f=a.windCnt;a.windCnt=b.windCnt;b.windCnt=f}else a.windCnt=0==a.windCnt+b.windDelta?-a.windCnt:a.windCnt+b.windDelta,b.windCnt=0==b.windCnt-a.windDelta?-b.windCnt:b.windCnt-a.windDelta;else a.windCnt2=(b.polyType==Wa.Subject?this.m_SubjFillType!=wa.EvenOdd:this.m_ClipFillType!=wa.EvenOdd)?a.windCnt2+b.windDelta:0==a.windCnt2?1:0,b.windCnt2=(a.polyType==Wa.Subject?this.m_SubjFillType!=wa.EvenOdd:this.m_ClipFillType!=wa.EvenOdd)?
b.windCnt2-a.windDelta:0==b.windCnt2?1:0;if(a.polyType==Wa.Subject){var g=this.m_SubjFillType;var h=this.m_ClipFillType}else g=this.m_ClipFillType,h=this.m_SubjFillType;if(b.polyType==Wa.Subject){var k=this.m_SubjFillType;f=this.m_ClipFillType}else k=this.m_ClipFillType,f=this.m_SubjFillType;switch(g._hx_index){case 2:g=a.windCnt;break;case 3:g=-a.windCnt;break;default:var l=a.windCnt;g=0>l?-l:l}switch(k._hx_index){case 2:k=b.windCnt;break;case 3:k=-b.windCnt;break;default:l=b.windCnt,k=0>l?-l:l}if(d&&
e)0!=g&&1!=g||0!=k&&1!=k||a.polyType!=b.polyType&&this.m_ClipType!=Lb.Xor?this.AddLocalMaxPoly(a,b,c):(this.AddOutPt(a,c),this.AddOutPt(b,c),c=a.side,a.side=b.side,b.side=c,this.SwapPolyIndexes(a,b));else if(d){if(0==k||1==k)this.AddOutPt(a,c),c=a.side,a.side=b.side,b.side=c,this.SwapPolyIndexes(a,b)}else if(e){if(0==g||1==g)this.AddOutPt(b,c),c=a.side,a.side=b.side,b.side=c,this.SwapPolyIndexes(a,b)}else if(!(0!=g&&1!=g||0!=k&&1!=k)){switch(h._hx_index){case 2:d=a.windCnt2;break;case 3:d=-a.windCnt2;
break;default:l=a.windCnt2,d=0>l?-l:l}switch(f._hx_index){case 2:e=b.windCnt2;break;case 3:e=-b.windCnt2;break;default:l=b.windCnt2,e=0>l?-l:l}if(a.polyType!=b.polyType)this.AddLocalMinPoly(a,b,c);else if(1==g&&1==k)switch(this.m_ClipType._hx_index){case 0:0<d&&0<e&&this.AddLocalMinPoly(a,b,c);break;case 1:0>=d&&0>=e&&this.AddLocalMinPoly(a,b,c);break;case 2:(a.polyType==Wa.Clip&&0<d&&0<e||a.polyType==Wa.Subject&&0>=d&&0>=e)&&this.AddLocalMinPoly(a,b,c);break;case 3:this.AddLocalMinPoly(a,b,c)}else c=
a.side,a.side=b.side,b.side=c}},DeleteFromAEL:function(a){var b=a.prevInAEL,c=a.nextInAEL;if(null!=b||null!=c||a==this.m_ActiveEdges)null!=b?b.nextInAEL=c:this.m_ActiveEdges=c,null!=c&&(c.prevInAEL=b),a.nextInAEL=null,a.prevInAEL=null},DeleteFromSEL:function(a){var b=a.prevInSEL,c=a.nextInSEL;if(null!=b||null!=c||a==this.m_SortedEdges)null!=b?b.nextInSEL=c:this.m_SortedEdges=c,null!=c&&(c.prevInSEL=b),a.nextInSEL=null,a.prevInSEL=null},UpdateEdgeIntoAEL:function(a){if(null==a.nextInLML)throw t.thrown("UpdateEdgeIntoAEL: invalid call");
var b=a.prevInAEL,c=a.nextInAEL;a.nextInLML.outIdx=a.outIdx;null!=b?b.nextInAEL=a.nextInLML:this.m_ActiveEdges=a.nextInLML;null!=c&&(c.prevInAEL=a.nextInLML);a.nextInLML.side=a.side;a.nextInLML.windDelta=a.windDelta;a.nextInLML.windCnt=a.windCnt;a.nextInLML.windCnt2=a.windCnt2;a=a.nextInLML;a.currX=a.botX;a.currY=a.botY;a.prevInAEL=b;a.nextInAEL=c;0!=a.deltaY&&this.InsertScanbeam(a.topY);return a},GetHorzDirection:function(a){return a.botX<a.topX?{left:a.botX,right:a.topX,dir:wb.LeftToRight}:{left:a.topX,
right:a.botX,dir:wb.RightToLeft}},ProcessHorizontals:function(a){for(var b=this.m_SortedEdges;null!=b;)this.DeleteFromSEL(b),this.ProcessHorizontal(b,a),b=this.m_SortedEdges},ProcessHorizontal:function(a,b){var c=this.GetHorzDirection(a);var d=c.dir;var e=c.left,f=c.right,g=a;for(c=null;null!=g.nextInLML&&0==g.nextInLML.deltaY;)g=g.nextInLML;for(null==g.nextInLML&&(c=this.GetMaximaPair(g));;){for(var h=a==g,k=d==wb.LeftToRight?a.nextInAEL:a.prevInAEL;null!=k&&!(k.currX==a.topX&&null!=a.nextInLML&&
k.dx<a.nextInLML.dx);){var l=d==wb.LeftToRight?k.nextInAEL:k.prevInAEL;if(d==wb.LeftToRight&&k.currX<=f||d==wb.RightToLeft&&k.currX>=e){if(k==c&&h){if(0<=a.outIdx){d=this.AddOutPt(a,new V(a.topX,a.topY));for(l=this.m_SortedEdges;null!=l;)0<=l.outIdx&&this.HorzSegmentsOverlap(a.botX,a.topX,l.botX,l.topX)&&(b=this.AddOutPt(l,new V(l.botX,l.botY)),this.AddJoin(b,d,new V(l.topX,l.topY))),l=l.nextInSEL;this.AddGhostJoin(d,new V(a.botX,a.botY));this.AddLocalMaxPoly(a,c,new V(a.topX,a.topY))}this.DeleteFromAEL(a);
this.DeleteFromAEL(c);return}if(d==wb.LeftToRight){var m=new V(k.currX,a.currY);this.IntersectEdges(a,k,m)}else m=new V(k.currX,a.currY),this.IntersectEdges(k,a,m);this.SwapPositionsInAEL(a,k)}else if(d==wb.LeftToRight&&k.currX>=f||d==wb.RightToLeft&&k.currX<=e)break;k=l}if(null!=a.nextInLML&&0==a.nextInLML.deltaY)a=this.UpdateEdgeIntoAEL(a),0<=a.outIdx&&this.AddOutPt(a,new V(a.botX,a.botY)),l=this.GetHorzDirection(a),d=l.dir,e=l.left,f=l.right;else break}null!=a.nextInLML?0<=a.outIdx?(d=this.AddOutPt(a,
new V(a.topX,a.topY)),b&&this.AddGhostJoin(d,new V(a.botX,a.botY)),a=this.UpdateEdgeIntoAEL(a),0!=a.windDelta&&(c=a.prevInAEL,l=a.nextInAEL,null!=c&&c.currX==a.botX&&c.currY==a.botY&&0!=c.windDelta&&0<=c.outIdx&&c.currY>c.topY&&a.deltaY*c.deltaX==a.deltaX*c.deltaY?(b=this.AddOutPt(c,new V(a.botX,a.botY)),this.AddJoin(d,b,new V(a.topX,a.topY))):null!=l&&l.currX==a.botX&&l.currY==a.botY&&0!=l.windDelta&&0<=l.outIdx&&l.currY>l.topY&&a.deltaY*l.deltaX==a.deltaX*l.deltaY&&(b=this.AddOutPt(l,new V(a.botX,
a.botY)),this.AddJoin(d,b,new V(a.topX,a.topY))))):this.UpdateEdgeIntoAEL(a):(0<=a.outIdx&&this.AddOutPt(a,new V(a.topX,a.topY)),this.DeleteFromAEL(a))},GetNextInAEL:function(a,b){return b==wb.LeftToRight?a.nextInAEL:a.prevInAEL},IsMinima:function(a){return null!=a&&a.prev.nextInLML!=a?a.next.nextInLML!=a:!1},IsMaxima:function(a,b){return null!=a&&a.topY==b?null==a.nextInLML:!1},IsIntermediate:function(a,b){return a.topY==b?null!=a.nextInLML:!1},GetMaximaPair:function(a){var b=null;a.next.topX==a.topX&&
a.next.topY==a.topY&&null==a.next.nextInLML?b=a.next:a.prev.topX==a.topX&&a.prev.topY==a.topY&&null==a.prev.nextInLML&&(b=a.prev);return null!=b&&(-2==b.outIdx||b.nextInAEL==b.prevInAEL&&0!=b.deltaY)?null:b},ProcessIntersections:function(a){if(null==this.m_ActiveEdges)return!0;this.BuildIntersectList(a);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1;this.m_SortedEdges=null;return!0},BuildIntersectList:function(a){if(null!=
this.m_ActiveEdges){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!=b;){b.prevInSEL=b.prevInAEL;b.nextInSEL=b.nextInAEL;if(a==b.topY)var c=b.topX;else{var d=b.dx*(a-b.botY);c=b.botX+(0>d?d-.5|0:d+.5|0)}b.currX=c;b=b.nextInAEL}for(c=!0;c&&null!=this.m_SortedEdges;){c=!1;for(b=this.m_SortedEdges;null!=b.nextInSEL;)if(a=b.nextInSEL,b.currX>a.currX){if(b.dx==a.dx)if(c=b.currY,c==b.topY)var e=b.topX;else d=b.dx*(c-b.botY),e=b.botX+(0>d?d-.5|0:d+.5|0);else{if(0==b.deltaX)if(e=b.botX,0==a.deltaY)c=
a.botY;else{var f=a.botY-a.botX/a.dx;c=e/a.dx+f;c=0>c?c-.5|0:c+.5|0}else if(0==a.deltaX)e=a.botX,0==b.deltaY?c=b.botY:(d=b.botY-b.botX/b.dx,c=e/b.dx+d,c=0>c?c-.5|0:c+.5|0);else{d=b.botX-b.botY*b.dx;f=a.botX-a.botY*a.dx;e=(f-d)/(b.dx-a.dx);c=0>e?e-.5|0:e+.5|0;var g=b.dx,h=a.dx;d=(0>g?-g:g)<(0>h?-h:h)?b.dx*e+d:a.dx*e+f;e=0>d?d-.5|0:d+.5|0}if(c<b.topY||c<a.topY)c=b.topY>a.topY?b.topY:a.topY,d=b.dx,f=a.dx,(0>d?-d:d)<(0>f?-f:f)?c==b.topY?e=b.topX:(d=b.dx*(c-b.botY),e=b.botX+(0>d?d-.5|0:d+.5|0)):c==a.topY?
e=a.topX:(d=a.dx*(c-a.botY),e=a.botX+(0>d?d-.5|0:d+.5|0));c>b.currY&&(c=b.currY,d=b.dx,f=a.dx,(0>d?-d:d)>(0>f?-f:f)?c==a.topY?e=a.topX:(d=a.dx*(c-a.botY),e=a.botX+(0>d?d-.5|0:d+.5|0)):c==b.topY?e=b.topX:(d=b.dx*(c-b.botY),e=b.botX+(0>d?d-.5|0:d+.5|0)))}c=new V(e,c);d=new ki;d.edge1=b;d.edge2=a;d.pt=c;this.m_IntersectList.push(d);this.SwapPositionsInSEL(b,a);c=!0}else b=a;if(null!=b.prevInSEL)b.prevInSEL.nextInSEL=null;else break}this.m_SortedEdges=null}},EdgesAdjacent:function(a){return a.edge1.nextInSEL!=
a.edge2?a.edge1.prevInSEL==a.edge2:!0},IntersectNodeSort:function(a,b){return b.pt.y-a.pt.y|0},FixupIntersectionOrder:function(){this.m_IntersectList.sort(pb.compareY);var a=this.m_ActiveEdges;for(this.m_SortedEdges=a;null!=a;)a.prevInSEL=a.prevInAEL,a=a.nextInSEL=a.nextInAEL;a=this.m_IntersectList.length;for(var b=0;b<a;){var c=b++,d=this.m_IntersectList[c];if(d.edge1.nextInSEL!=d.edge2&&d.edge1.prevInSEL!=d.edge2){for(d=c+1;;){if(d<a){var e=this.m_IntersectList[d];e=!(e.edge1.nextInSEL==e.edge2||
e.edge1.prevInSEL==e.edge2)}else e=!1;if(!e)break;++d}if(d==a)return!1;e=this.m_IntersectList[c];this.m_IntersectList[c]=this.m_IntersectList[d];this.m_IntersectList[d]=e}this.SwapPositionsInSEL(this.m_IntersectList[c].edge1,this.m_IntersectList[c].edge2)}return!0},ProcessIntersectList:function(){for(var a=0,b=this.m_IntersectList.length;a<b;){var c=a++;c=this.m_IntersectList[c];this.IntersectEdges(c.edge1,c.edge2,c.pt);this.SwapPositionsInAEL(c.edge1,c.edge2)}this.m_IntersectList=[]},Round:function(a){return 0>
a?a-.5|0:a+.5|0},TopX:function(a,b){if(b==a.topY)return a.topX;b=a.dx*(b-a.botY);return a.botX+(0>b?b-.5|0:b+.5|0)},IntersectPoint:function(a,b){if(a.dx==b.dx){var c=a.currY;if(c==a.topY)var d=a.topX;else{var e=a.dx*(c-a.botY);d=a.botX+(0>e?e-.5|0:e+.5|0)}return new V(d,c)}if(0==a.deltaX)if(d=a.botX,0==b.deltaY)c=b.botY;else{var f=b.botY-b.botX/b.dx;e=d/b.dx+f;c=0>e?e-.5|0:e+.5|0}else if(0==b.deltaX)d=b.botX,0==a.deltaY?c=a.botY:(e=a.botY-a.botX/a.dx,e=d/a.dx+e,c=0>e?e-.5|0:e+.5|0);else{e=a.botX-
a.botY*a.dx;f=b.botX-b.botY*b.dx;var g=(f-e)/(a.dx-b.dx);c=0>g?g-.5|0:g+.5|0;var h=a.dx;d=b.dx;e=(0>h?-h:h)<(0>d?-d:d)?a.dx*g+e:b.dx*g+f;d=0>e?e-.5|0:e+.5|0}if(c<a.topY||c<b.topY)c=a.topY>b.topY?a.topY:b.topY,h=a.dx,d=b.dx,(0>h?-h:h)<(0>d?-d:d)?c==a.topY?d=a.topX:(e=a.dx*(c-a.botY),d=a.botX+(0>e?e-.5|0:e+.5|0)):c==b.topY?d=b.topX:(e=b.dx*(c-b.botY),d=b.botX+(0>e?e-.5|0:e+.5|0));c>a.currY&&(c=a.currY,h=a.dx,d=b.dx,(0>h?-h:h)>(0>d?-d:d)?c==b.topY?d=b.topX:(e=b.dx*(c-b.botY),d=b.botX+(0>e?e-.5|0:e+.5|
0)):c==a.topY?d=a.topX:(e=a.dx*(c-a.botY),d=a.botX+(0>e?e-.5|0:e+.5|0)));return new V(d,c)},ProcessEdgesAtTopOfScanbeam:function(a){for(var b,c,d,e=this.m_ActiveEdges;null!=e;){if(d=null!=e&&e.topY==a&&null==e.nextInLML)d=this.GetMaximaPair(e),d=null==d||0!=d.deltaY;d?(c=e.prevInAEL,this.DoMaxima(e),e=null==c?this.m_ActiveEdges:c.nextInAEL):(e.topY==a&&null!=e.nextInLML&&0==e.nextInLML.deltaY?(e=this.UpdateEdgeIntoAEL(e),0<=e.outIdx&&this.AddOutPt(e,new V(e.botX,e.botY)),this.AddEdgeToSEL(e)):(a==
e.topY?d=e.topX:(d=e.dx*(a-e.botY),d=e.botX+(0>d?d-.5|0:d+.5|0)),e.currX=d,e.currY=a),this.strictlySimple&&(d=e.prevInAEL,0<=e.outIdx&&0!=e.windDelta&&null!=d&&0<=d.outIdx&&d.currX==e.currX&&0!=d.windDelta&&(c=new V(e.currX,e.currY),d=this.AddOutPt(d,c),b=this.AddOutPt(e,c),this.AddJoin(d,b,c))),e=e.nextInAEL)}this.ProcessHorizontals(!0);for(e=this.m_ActiveEdges;null!=e;)e.topY==a&&null!=e.nextInLML&&(d=null,0<=e.outIdx&&(d=this.AddOutPt(e,new V(e.topX,e.topY))),e=this.UpdateEdgeIntoAEL(e),c=e.prevInAEL,
b=e.nextInAEL,null!=c&&c.currX==e.botX&&c.currY==e.botY&&null!=d&&0<=c.outIdx&&c.currY>c.topY&&e.deltaY*c.deltaX==e.deltaX*c.deltaY&&0!=e.windDelta&&0!=c.windDelta?(b=this.AddOutPt(c,new V(e.botX,e.botY)),this.AddJoin(d,b,new V(e.topX,e.topY))):null!=b&&b.currX==e.botX&&b.currY==e.botY&&null!=d&&0<=b.outIdx&&b.currY>b.topY&&e.deltaY*b.deltaX==e.deltaX*b.deltaY&&0!=e.windDelta&&0!=b.windDelta&&(c=this.AddOutPt(b,new V(e.botX,e.botY)),this.AddJoin(d,c,new V(e.topX,e.topY)))),e=e.nextInAEL},DoMaxima:function(a){var b=
this.GetMaximaPair(a);if(null==b)0<=a.outIdx&&this.AddOutPt(a,new V(a.topX,a.topY)),this.DeleteFromAEL(a);else{for(var c=a.nextInAEL;null!=c&&c!=b;)this.IntersectEdges(a,c,new V(a.topX,a.topY)),this.SwapPositionsInAEL(a,c),c=a.nextInAEL;if(-1==a.outIdx&&-1==b.outIdx)this.DeleteFromAEL(a),this.DeleteFromAEL(b);else if(0<=a.outIdx&&0<=b.outIdx)0<=a.outIdx&&this.AddLocalMaxPoly(a,b,new V(a.topX,a.topY)),this.DeleteFromAEL(a),this.DeleteFromAEL(b);else throw t.thrown("DoMaxima error");}},reversePolygons:function(a){for(var b=
0,c=a.length;b<c;){var d=a[b++];hd.reverse(d)}},PointCount:function(a){if(null==a)return 0;var b=0,c=a;do++b,c=c.next;while(c!=a);return b},BuildResult:function(){for(var a=[],b=0,c=this.m_PolyOuts;b<c.length;){var d=c[b];++b;if(!(null==d.pts||this.resultKind==sc.NoHoles&&d.isHole||this.resultKind==sc.HolesOnly&&!d.isHole)){d=d.pts.prev;var e=this.PointCount(d);if(!(2>e)){for(var f=[],g=0;g<e;)g++,f.push(d.pt),d=d.prev;a.push(f)}}}return a},BuildResult2:function(a){a.clear();for(var b=0,c=this.m_PolyOuts;b<
c.length;){var d=c[b];++b;var e=this.PointCount(d.pts);if(!(3>e)){this.FixHoleLinkage(d);var f=new Je;a.allPolys.push(f);d.polyNode=f;d=d.pts.prev;for(var g=0;g<e;)g++,f.polygon.push(d.pt),d=d.prev}}b=0;for(c=this.m_PolyOuts;b<c.length;)d=c[b],++b,null!=d.polyNode&&(null!=d.firstLeft&&null!=d.firstLeft.polyNode?d.firstLeft.polyNode.addChild(d.polyNode):a.addChild(d.polyNode))},FixupOutPolygon:function(a){var b=null;a.bottomPt=null;for(var c=a.pts;;){if(c.prev==c||c.prev==c.next){a.pts=null;return}var d=
c.pt;var e=c.next.pt;d.x!=e.x||d.y!=e.y?(d=c.pt,e=c.prev.pt,d=d.x==e.x&&d.y==e.y):d=!0;if(d)d=!0;else{d=c.prev.pt;e=c.pt;var f=c.next.pt;d=0==(d.y-e.y)*(e.x-f.x)-(d.x-e.x)*(e.y-f.y)&&(!this.preserveCollinear||!this.Pt2IsBetweenPt1AndPt3(c.prev.pt,c.pt,c.next.pt))}if(d)b=null,c.prev.next=c.next,c=c.next.prev=c.prev;else if(c==b)break;else null==b&&(b=c),c=c.next}a.pts=c},DupOutPt:function(a,b){var c=new Df;c.pt=a.pt;c.idx=a.idx;b?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=a.prev,c.next=
a,a.prev.next=c,a.prev=c);return c},GetOverlap:function(a,b,c,d){if(a<b)if(c<d){var e=a<c?c:a;a=b>d?d:b}else e=a<d?d:a,a=b>c?c:b;else c<d?(e=b<c?c:b,a=a>d?d:a):(e=b<d?d:b,a=a>c?c:a);return{left:e,right:a,done:e<a}},JoinHorz:function(a,b,c,d,e,f){var g=a.pt.x>b.pt.x?wb.RightToLeft:wb.LeftToRight;d=c.pt.x>d.pt.x?wb.RightToLeft:wb.LeftToRight;if(g==d)return!1;if(g==wb.LeftToRight){for(;a.next.pt.x<=e.x&&a.next.pt.x>=a.pt.x&&a.next.pt.y==e.y;)a=a.next;f&&a.pt.x!=e.x&&(a=a.next);b=this.DupOutPt(a,!f);
b.pt!=e&&(a=b,a.pt=e,b=this.DupOutPt(a,!f))}else{for(;a.next.pt.x>=e.x&&a.next.pt.x<=a.pt.x&&a.next.pt.y==e.y;)a=a.next;f||a.pt.x==e.x||(a=a.next);b=this.DupOutPt(a,f);b.pt!=e&&(a=b,a.pt=e,b=this.DupOutPt(a,f))}if(d==wb.LeftToRight){for(;c.next.pt.x<=e.x&&c.next.pt.x>=c.pt.x&&c.next.pt.y==e.y;)c=c.next;f&&c.pt.x!=e.x&&(c=c.next);d=this.DupOutPt(c,!f);d.pt!=e&&(c=d,c.pt=e,d=this.DupOutPt(c,!f))}else{for(;c.next.pt.x>=e.x&&c.next.pt.x<=c.pt.x&&c.next.pt.y==e.y;)c=c.next;f||c.pt.x==e.x||(c=c.next);d=
this.DupOutPt(c,f);d.pt!=e&&(c=d,c.pt=e,d=this.DupOutPt(c,f))}g==wb.LeftToRight==f?(a.prev=c,c.next=a,b.next=d,d.prev=b):(a.next=c,c.prev=a,b.prev=d,d.next=b);return!0},JoinPoints:function(a,b,c){var d=a.outPt1,e=a.outPt2,f;if(f=a.outPt1.pt.y==a.offPt.y){var g=a.offPt;var h=a.outPt1.pt;var k=g.x==h.x&&g.y==h.y}else k=!1;k?(g=a.offPt,h=a.outPt2.pt,h=g.x==h.x&&g.y==h.y):h=!1;if(h){if(b!=c)return!1;for(k=a.outPt1.next;;){k!=d?(g=k.pt,h=a.offPt,h=g.x==h.x&&g.y==h.y):h=!1;if(!h)break;k=k.next}k=k.pt.y>
a.offPt.y;for(f=a.outPt2.next;;){f!=e?(g=f.pt,h=a.offPt,h=g.x==h.x&&g.y==h.y):h=!1;if(!h)break;f=f.next}if(k==f.pt.y>a.offPt.y)return!1;k?(k=this.DupOutPt(d,!1),f=this.DupOutPt(e,!0),d.prev=e,e.next=d,k.next=f,f.prev=k):(k=this.DupOutPt(d,!0),f=this.DupOutPt(e,!1),d.next=e,e.prev=d,k.prev=f,f.next=k);a.outPt1=d;a.outPt2=k;return!0}if(f){for(k=d;d.prev.pt.y==d.pt.y&&d.prev!=k&&d.prev!=e;)d=d.prev;for(;k.next.pt.y==k.pt.y&&k.next!=d&&k.next!=e;)k=k.next;if(k.next==d||k.next==e)return!1;for(f=e;e.prev.pt.y==
e.pt.y&&e.prev!=f&&e.prev!=k;)e=e.prev;for(;f.next.pt.y==f.pt.y&&f.next!=e&&f.next!=d;)f=f.next;if(f.next==e||f.next==d)return!1;c=this.GetOverlap(d.pt.x,k.pt.x,e.pt.x,f.pt.x);if(!c.done)return!1;b=c.left;c=c.right;d.pt.x>=b&&d.pt.x<=c?(b=d.pt,c=d.pt.x>k.pt.x):e.pt.x>=b&&e.pt.x<=c?(b=e.pt,c=e.pt.x>f.pt.x):k.pt.x>=b&&k.pt.x<=c?(b=k.pt,c=k.pt.x>d.pt.x):(b=f.pt,c=f.pt.x>e.pt.x);a.outPt1=d;a.outPt2=e;return this.JoinHorz(d,k,e,f,b,c)}for(k=d.next;;){g=k.pt;h=d.pt;if(g.x!=h.x||g.y!=h.y||k==d)break;k=k.next}if(k.pt.y<=
d.pt.y){g=d.pt;h=k.pt;var l=a.offPt;var m=0!=(g.y-h.y)*(h.x-l.x)-(g.x-h.x)*(h.y-l.y)}else m=!0;if(m){for(k=d.prev;;){g=k.pt;h=d.pt;if(g.x!=h.x||g.y!=h.y||k==d)break;k=k.prev}k.pt.y<=d.pt.y?(g=d.pt,h=k.pt,l=a.offPt,h=0!=(g.y-h.y)*(h.x-l.x)-(g.x-h.x)*(h.y-l.y)):h=!0;if(h)return!1}for(f=e.next;;){g=f.pt;h=e.pt;if(g.x!=h.x||g.y!=h.y||f==e)break;f=f.next}if(f.pt.y<=e.pt.y){g=e.pt;h=f.pt;l=a.offPt;var p=0!=(g.y-h.y)*(h.x-l.x)-(g.x-h.x)*(h.y-l.y)}else p=!0;if(p){for(f=e.prev;;){g=f.pt;h=e.pt;if(g.x!=h.x||
g.y!=h.y||f==e)break;f=f.prev}f.pt.y<=e.pt.y?(g=e.pt,h=f.pt,l=a.offPt,h=0!=(g.y-h.y)*(h.x-l.x)-(g.x-h.x)*(h.y-l.y)):h=!0;if(h)return!1}if(k==d||f==e||k==f||b==c&&m==p)return!1;m?(k=this.DupOutPt(d,!1),f=this.DupOutPt(e,!0),d.prev=e,e.next=d,k.next=f,f.prev=k):(k=this.DupOutPt(d,!0),f=this.DupOutPt(e,!1),d.next=e,e.prev=d,k.prev=f,f.next=k);a.outPt1=d;a.outPt2=k;return!0},PointInPolygon:function(a,b){var c=0,d=b.length;if(3>d)return 0;for(var e=b[0],f=1,g=d+1;f<g;){var h=f++;h=h==d?b[0]:b[h];if(h.y==
a.y&&(h.x==a.x||e.y==a.y&&h.x>a.x==e.x<a.x))return-1;if(e.y<a.y!=h.y<a.y)if(e.x>=a.x)if(h.x>a.x)c=1-c;else{var k=(e.x-a.x)*(h.y-a.y)-(h.x-a.x)*(e.y-a.y);if(0==k)return-1;0<k==h.y>e.y&&(c=1-c)}else if(h.x>a.x){k=(e.x-a.x)*(h.y-a.y)-(h.x-a.x)*(e.y-a.y);if(0==k)return-1;0<k==h.y>e.y&&(c=1-c)}e=h}return c},PointInPolygon2:function(a,b){var c=0,d=b,e=a.x;a=a.y;var f=b.pt.x,g=b.pt.y;do{b=b.next;var h=b.pt.x,k=b.pt.y;if(k==a&&(h==e||g==a&&h>e==f<e))return-1;if(g<a!=k<a)if(f>=e)if(h>e)c=1-c;else{f=(f-e)*
(k-a)-(h-e)*(g-a);if(0==f)return-1;0<f==k>g&&(c=1-c)}else if(h>e){f=(f-e)*(k-a)-(h-e)*(g-a);if(0==f)return-1;0<f==k>g&&(c=1-c)}f=h;g=k}while(d!=b);return c},Poly2ContainsPoly1:function(a,b){var c=a;do{var d=this.PointInPolygon2(c.pt,b);if(0<=d)return 0<d;c=c.next}while(c!=a);return!0},FixupFirstLefts1:function(a,b){for(var c=0,d=this.m_PolyOuts;c<d.length;){var e=d[c];++c;null!=e.pts&&null!=e.firstLeft&&this.ParseFirstLeft(e.firstLeft)==a&&this.Poly2ContainsPoly1(e.pts,b.pts)&&(e.firstLeft=b)}},FixupFirstLefts2:function(a,
b){for(var c=0,d=this.m_PolyOuts;c<d.length;){var e=d[c];++c;e.firstLeft==a&&(e.firstLeft=b)}},ParseFirstLeft:function(a){for(;null!=a&&null==a.pts;)a=a.firstLeft;return a},JoinCommonEdges:function(){for(var a=0,b=this.m_Joins.length;a<b;){var c=a++,d=this.m_Joins[c];c=this.GetOutRec(d.outPt1.idx);var e=this.GetOutRec(d.outPt2.idx);if(null!=c.pts&&null!=e.pts){var f=c==e?c:this.Param1RightOfParam2(c,e)?e:this.Param1RightOfParam2(e,c)?c:this.GetLowermostRec(c,e);if(this.JoinPoints(d,c,e))if(c==e){c.pts=
d.outPt1;c.bottomPt=null;e=this.CreateOutRec();e.pts=d.outPt2;this.UpdateOutPtIdxs(e);if(this.m_UsingPolyTree){f=0;for(var g=this.m_PolyOuts.length-1;f<g;){var h=f++;h=this.m_PolyOuts[h];null!=h.pts&&this.ParseFirstLeft(h.firstLeft)==c&&h.isHole!=c.isHole&&this.Poly2ContainsPoly1(h.pts,d.outPt2)&&(h.firstLeft=e)}}this.Poly2ContainsPoly1(e.pts,c.pts)?(e.isHole=!c.isHole,e.firstLeft=c,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,c),c=this.reverseSolution,(e.isHole?!c:c)==0<this.Area(e)&&this.ReversePolyPtLinks(e.pts)):
this.Poly2ContainsPoly1(c.pts,e.pts)?(e.isHole=c.isHole,c.isHole=!e.isHole,e.firstLeft=c.firstLeft,c.firstLeft=e,this.m_UsingPolyTree&&this.FixupFirstLefts2(c,e),e=this.reverseSolution,(c.isHole?!e:e)==0<this.Area(c)&&this.ReversePolyPtLinks(c.pts)):(e.isHole=c.isHole,e.firstLeft=c.firstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(c,e))}else e.pts=null,e.bottomPt=null,e.idx=c.idx,c.isHole=f.isHole,f==e&&(c.firstLeft=e.firstLeft),e.firstLeft=c,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,c)}}},
UpdateOutPtIdxs:function(a){var b=a.pts;do b.idx=a.idx,b=b.prev;while(b!=a.pts)},DoSimplePolygons:function(){for(var a=0;a<this.m_PolyOuts.length;){var b=this.m_PolyOuts[a++],c=b.pts;if(null!=c){do{for(var d=c.next;d!=b.pts;){var e=c.pt,f=d.pt;e.x==f.x&&e.y==f.y&&d.next!=c&&d.prev!=c&&(e=c.prev,f=d.prev,c.prev=f,f.next=c,d.prev=e,e.next=d,b.pts=c,e=this.CreateOutRec(),e.pts=d,this.UpdateOutPtIdxs(e),this.Poly2ContainsPoly1(e.pts,b.pts)?(e.isHole=!b.isHole,e.firstLeft=b):this.Poly2ContainsPoly1(b.pts,
e.pts)?(e.isHole=b.isHole,b.isHole=!e.isHole,e.firstLeft=b.firstLeft,b.firstLeft=e):(e.isHole=b.isHole,e.firstLeft=b.firstLeft),d=c);d=d.next}c=c.next}while(c!=b.pts)}}},Area:function(a){var b=a.pts;if(null==b)return 0;var c=0;do c+=(b.pt.x+b.prev.pt.x)*(b.prev.pt.y-b.pt.y),b=b.next;while(b!=a.pts);return c/2},DistanceFromLineSqrd:function(a,b,c){var d=b.y-c.y;c=c.x-b.x;b=d*b.x+c*b.y;b=d*a.x+c*a.y-b;return b*b/(d*d+c*c)},SlopesNearCollinear:function(a,b,c,d){var e=a.x-b.x,f=a.y-b.y;return(0>e?-e:
e)>(0>f?-f:f)?a.x>b.x==a.x<c.x?this.DistanceFromLineSqrd(a,b,c)<d:b.x>a.x==b.x<c.x?this.DistanceFromLineSqrd(b,a,c)<d:this.DistanceFromLineSqrd(c,a,b)<d:a.y>b.y==a.y<c.y?this.DistanceFromLineSqrd(a,b,c)<d:b.y>a.y==b.y<c.y?this.DistanceFromLineSqrd(b,a,c)<d:this.DistanceFromLineSqrd(c,a,b)<d},PointsAreClose:function(a,b,c){var d=a.x-b.x;a=a.y-b.y;return d*d+a*a<=c},ExcludeOp:function(a){var b=a.prev;b.next=a.next;a.next.prev=b;b.idx=0;return b},CleanPolygon:function(a,b){null==b&&(b=1.415);var c=a.length;
if(0==c){var d=null;return null==d?[]:d}var e=[];d=0;for(var f=c;d<f;){var g=d++;e[g]=new Df;e[g].pt=a[g];e[g].next=e[(g+1)%c];e[g].next.prev=e[g];e[g].idx=0}d=b*b;for(e=e[0];0==e.idx&&e.next!=e.prev;)this.PointsAreClose(e.pt,e.prev.pt,d)?(e=this.ExcludeOp(e),--c):this.PointsAreClose(e.prev.pt,e.next.pt,d)?(this.ExcludeOp(e.next),e=this.ExcludeOp(e),c-=2):this.SlopesNearCollinear(e.prev.pt,e.pt,e.next.pt,d)?(e=this.ExcludeOp(e),--c):(e.idx=1,e=e.next);3>c&&(c=0);d=null;a=null==d?[]:d;d=0;for(f=c;d<
f;)d++,a.push(e.pt),e=e.next;return a},CleanPolygons:function(a,b){null==b&&(b=1.415);for(var c=[],d=0,e=a.length;d<e;){var f=d++;c.push(this.CleanPolygon(a[f],b))}return c},Minkowski:function(a,b,c){var d=a.length,e=b.length;var f=null;for(var g=null==f?[]:f,h=0,k=e;h<k;){f=h++;var l=null;l=null==l?[]:l;for(var m=0,p=a,r=p.length;m<r;){var n=p[m++];c?l.push(new V(b[f].x+n.x,b[f].y+n.y)):l.push(new V(b[f].x-n.x,b[f].y-n.y))}g.push(l)}f=null;a=null==f?[]:f;h=0;for(k=e;h<k;)for(f=h++,b=0,c=d;b<c;)m=
b++,l=null,l=null==l?[]:l,l.push(g[f%e][m%d]),l.push(g[(f+1)%e][m%d]),l.push(g[(f+1)%e][(m+1)%d]),l.push(g[f%e][(m+1)%d]),0<=pb.polArea(l)||hd.reverse(l),a.push(l);return a},MinkowskiSum:function(a,b,c){a=this.Minkowski(a,b,!0);b=new pb;b.resultKind=null==c?sc.All:c;b.addPolygons(a,Wa.Subject);return b.execute(Lb.Union,wa.NonZero,wa.NonZero)},TranslatePath:function(a,b){for(var c=[],d=0,e=a.length;d<e;){var f=d++;c.push(new V(a[f].x+b.x,a[f].y+b.y))}return c},PolyTreeToPaths:function(a){var b=[];
this.AddPolyNodeToPaths(a,rd.Any,b);return b},AddPolyNodeToPaths:function(a,b,c){if(1!=b._hx_index){0<a.polygon.length&&c.push(a.polygon);var d=0;for(a=a.childs;d<a.length;){var e=a[d];++d;this.AddPolyNodeToPaths(e,b,c)}}},__class__:pb});var Kh=function(a,b){null==b&&(b=.25);null==a&&(a=2);this.two_pi=6.283185307179586;this.def_arc_tolerance=.25;this.MiterLimit=a;this.ArcTolerance=b;this.m_lowest=new V(-1,0);this.m_normals=[];this.m_polyNodes=new Je;this.resultKind=sc.All};Kh.__name__="hxd.clipper.ClipperOffset";
Kh.prototype={clear:function(){this.m_polyNodes=new Je;this.m_lowest=new V(-1,0)},addPolygon:function(a,b,c){var d=a.length-1;if(!(0>d)){var e=new Je;e.jointype=b;e.endtype=c;if(c==Xa.ClosedLine||c==Xa.ClosedPol)for(;0<d&&a[0]==a[d];)--d;e.polygon.push(a[0]);var f=0;b=0;var g=1;for(d+=1;g<d;){var h=g++;e.polygon[f]!=a[h]&&(++f,e.polygon.push(a[h]),a[h].y>e.polygon[b].y||a[h].y==e.polygon[b].y&&a[h].x<e.polygon[b].x)&&(b=f)}if(!(c==Xa.ClosedPol&&2>f)&&(this.m_polyNodes.addChild(e),c==Xa.ClosedPol))if(0>
this.m_lowest.x)this.m_lowest=new V(this.m_polyNodes.childs.length-1,b);else if(a=this.m_polyNodes.childs[this.m_lowest.x].polygon[this.m_lowest.y],e.polygon[b].y>a.y||e.polygon[b].y==a.y&&e.polygon[b].x<a.x)this.m_lowest=new V(this.m_polyNodes.childs.length-1,b)}},addPolygons:function(a,b,c){for(var d=0,e=a.length;d<e;){var f=a[d++];this.addPolygon(f,b,c)}},fixOrientations:function(){var a;if(0<=this.m_lowest.x&&!(0<=pb.polArea(this.m_polyNodes.childs[this.m_lowest.x].polygon))){var b=0;for(a=this.m_polyNodes.childs;b<
a.length;){var c=a[b];++b;(c.endtype==Xa.ClosedPol||c.endtype==Xa.ClosedLine&&0<=pb.polArea(c.polygon))&&hd.reverse(c.polygon)}}else for(b=0,a=this.m_polyNodes.childs;b<a.length;)c=a[b],++b,c.endtype!=Xa.ClosedLine||0<=pb.polArea(c.polygon)||hd.reverse(c.polygon)},getUnitNormal:function(a,b){var c=b.x-a.x;a=b.y-a.y;if(0==c&&0==a)return new Da(0,0);b=0;null==b&&(b=0);b=1/Math.sqrt(c*c+a*a+b*b);a*=b;c=-(c*b);null==c&&(c=0);null==a&&(a=0);return new Da(a,c)},doOffset:function(a){var b;this.m_destPolys=
[];this.m_delta=a;if(-1E-20<a&&1E-20>a){var c=0;for(b=this.m_polyNodes.childs;c<b.length;){var d=b[c];++c;d.endtype==Xa.ClosedPol&&this.m_destPolys.push(d.polygon)}}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var e=0>=this.ArcTolerance?this.def_arc_tolerance:this.ArcTolerance>(0>a?-a:a)*this.def_arc_tolerance?(0>a?-a:a)*this.def_arc_tolerance:this.ArcTolerance;var f=3.141592653589793/Math.acos(1-e/(0>a?-a:a))|0;this.m_sin=Math.sin(this.two_pi/f);this.m_cos=Math.cos(this.two_pi/
f);this.m_StepsPerRad=f/this.two_pi;0>a&&(this.m_sin=-this.m_sin);c=0;for(b=this.m_polyNodes.childs;c<b.length;){d=b[c];++c;this.m_srcPoly=d.polygon;var g=this.m_srcPoly.length;if(!(0==g||0>=a&&(3>g||d.endtype!=Xa.ClosedPol))){this.m_destPoly=[];if(1==g)if(d.jointype==id.Round){d=1;g=0;var h=1;for(e=f+1;h<e;){h++;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*a),Math.round(this.m_srcPoly[0].y+g*a)));var k=d;d=d*this.m_cos-this.m_sin*g;g=k*this.m_sin+g*this.m_cos}}else g=d=-1,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+
d*a),Math.round(this.m_srcPoly[0].y+g*a))),0>d?d=1:0>g?g=1:d=-1,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*a),Math.round(this.m_srcPoly[0].y+g*a))),0>d?d=1:0>g?g=1:d=-1,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*a),Math.round(this.m_srcPoly[0].y+g*a))),0>d?d=1:0>g?g=1:d=-1,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*a),Math.round(this.m_srcPoly[0].y+g*a)));else{this.m_normals=[];h=0;for(e=g-1;h<e;)k=h++,this.m_normals.push(this.getUnitNormal(this.m_srcPoly[k],
this.m_srcPoly[k+1]));d.endtype==Xa.ClosedLine||d.endtype==Xa.ClosedPol?this.m_normals.push(this.getUnitNormal(this.m_srcPoly[g-1],this.m_srcPoly[0])):this.m_normals.push(this.m_normals[g-2]);if(d.endtype==Xa.ClosedPol)for(h=g-1,e=0;e<g;)k=e++,h=this.offsetPoint(k,h,d.jointype);else if(d.endtype==Xa.ClosedLine){h=g-1;e=0;for(k=g;e<k;){var l=e++;h=this.offsetPoint(l,h,d.jointype)}this.m_destPolys.push(this.m_destPoly);this.m_destPoly=[];h=this.m_normals[g-1];for(k=g-1;0<k;)l=-this.m_normals[k-1].x,
e=-this.m_normals[k-1].y,null==e&&(e=0),null==l&&(l=0),this.m_normals[k]=new Da(l,e),--k;e=-h.x;h=-h.y;null==h&&(h=0);null==e&&(e=0);this.m_normals[0]=new Da(e,h);h=0;for(--g;0<g;)h=this.offsetPoint(g,h,d.jointype),--g}else{h=0;e=1;for(k=g-1;e<k;)l=e++,h=this.offsetPoint(l,h,d.jointype);if(d.endtype==Xa.OpenButt)e=g-1,h=new V(Math.round(this.m_srcPoly[e].x+this.m_normals[e].x*a),Math.round(this.m_srcPoly[e].y+this.m_normals[e].y*a)),this.m_destPoly.push(h),h=new V(Math.round(this.m_srcPoly[e].x-this.m_normals[e].x*
a),Math.round(this.m_srcPoly[e].y-this.m_normals[e].y*a)),this.m_destPoly.push(h);else if(e=g-1,h=g-2,this.m_sinA=0,k=-this.m_normals[e].x,l=-this.m_normals[e].y,null==l&&(l=0),null==k&&(k=0),this.m_normals[e]=new Da(k,l),d.endtype==Xa.OpenSquare)k=Math.tan(.25*Math.atan2(this.m_sinA,this.m_normals[h].x*this.m_normals[e].x+this.m_normals[h].y*this.m_normals[e].y)),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[e].x+this.m_delta*(this.m_normals[h].x-this.m_normals[h].y*k)),Math.round(this.m_srcPoly[e].y+
this.m_delta*(this.m_normals[h].y+this.m_normals[h].x*k)))),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[e].x+this.m_delta*(this.m_normals[e].x+this.m_normals[e].y*k)),Math.round(this.m_srcPoly[e].y+this.m_delta*(this.m_normals[e].y-this.m_normals[e].x*k))));else{k=Math.atan2(this.m_sinA,this.m_normals[h].x*this.m_normals[e].x+this.m_normals[h].y*this.m_normals[e].y);var m=Math.round(this.m_StepsPerRad*(0>k?-k:k));k=this.m_normals[h].x;h=this.m_normals[h].y;l=0;for(var p=1>m?1:m;l<p;)l++,
this.m_destPoly.push(new V(Math.round(this.m_srcPoly[e].x+k*this.m_delta),Math.round(this.m_srcPoly[e].y+h*this.m_delta))),m=k,k=k*this.m_cos-this.m_sin*h,h=m*this.m_sin+h*this.m_cos;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[e].x+this.m_normals[e].x*this.m_delta),Math.round(this.m_srcPoly[e].y+this.m_normals[e].y*this.m_delta)))}for(h=g-1;0<h;)e=-this.m_normals[h-1].x,k=-this.m_normals[h-1].y,null==k&&(k=0),null==e&&(e=0),this.m_normals[h]=new Da(e,k),--h;h=-this.m_normals[1].x;e=-this.m_normals[1].y;
null==e&&(e=0);null==h&&(h=0);this.m_normals[0]=new Da(h,e);h=g-1;for(g=h-1;0<g;)h=this.offsetPoint(g,h,d.jointype),--g;if(d.endtype==Xa.OpenButt)h=new V(Math.round(this.m_srcPoly[0].x-this.m_normals[0].x*a),Math.round(this.m_srcPoly[0].y-this.m_normals[0].y*a)),this.m_destPoly.push(h),h=new V(Math.round(this.m_srcPoly[0].x+this.m_normals[0].x*a),Math.round(this.m_srcPoly[0].y+this.m_normals[0].y*a)),this.m_destPoly.push(h);else if(this.m_sinA=0,d.endtype==Xa.OpenSquare)d=Math.tan(.25*Math.atan2(this.m_sinA,
this.m_normals[1].x*this.m_normals[0].x+this.m_normals[1].y*this.m_normals[0].y)),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+this.m_delta*(this.m_normals[1].x-this.m_normals[1].y*d)),Math.round(this.m_srcPoly[0].y+this.m_delta*(this.m_normals[1].y+this.m_normals[1].x*d)))),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+this.m_delta*(this.m_normals[0].x+this.m_normals[0].y*d)),Math.round(this.m_srcPoly[0].y+this.m_delta*(this.m_normals[0].y-this.m_normals[0].x*d))));else{d=
Math.atan2(this.m_sinA,this.m_normals[1].x*this.m_normals[0].x+this.m_normals[1].y*this.m_normals[0].y);e=Math.round(this.m_StepsPerRad*(0>d?-d:d));d=this.m_normals[1].x;g=this.m_normals[1].y;h=0;for(k=1>e?1:e;h<k;)h++,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*this.m_delta),Math.round(this.m_srcPoly[0].y+g*this.m_delta))),e=d,d=d*this.m_cos-this.m_sin*g,g=e*this.m_sin+g*this.m_cos;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+this.m_normals[0].x*this.m_delta),Math.round(this.m_srcPoly[0].y+
this.m_normals[0].y*this.m_delta)))}}}this.m_destPolys.push(this.m_destPoly)}}}},execute:function(a){this.fixOrientations();this.doOffset(a);var b=new pb;b.resultKind=this.resultKind;b.addPolygons(this.m_destPolys,Wa.Subject);if(0<a)return b.execute(Lb.Union,wa.Positive,wa.Positive);a=qd.getBounds(this.m_destPolys);var c=[];c.push(new V(a.left-10,a.bottom+10));c.push(new V(a.right+10,a.bottom+10));c.push(new V(a.right+10,a.top-10));c.push(new V(a.left-10,a.top-10));b.addPolygon(c,Wa.Subject);b.reverseSolution=
!0;b=b.execute(Lb.Union,wa.Negative,wa.Negative);0<b.length&&b.shift();return b},offsetPoint:function(a,b,c){this.m_sinA=this.m_normals[b].x*this.m_normals[a].y-this.m_normals[a].x*this.m_normals[b].y;var d=this.m_sinA*this.m_delta;if(1>(0>d?-d:d)){if(0<this.m_normals[b].x*this.m_normals[a].x+this.m_normals[a].y*this.m_normals[b].y)return this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_normals[b].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[b].y*this.m_delta))),b}else 1<
this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)d=new V(Math.round(this.m_srcPoly[a].x+this.m_normals[b].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[b].y*this.m_delta)),b=new V(Math.round(this.m_srcPoly[a].x+this.m_normals[a].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[a].y*this.m_delta)),this.m_destPoly.push(d),c=d.x-b.x,d=d.y-b.y,1<c*c+d*d&&(this.m_destPoly.push(this.m_srcPoly[a]),this.m_destPoly.push(b));else switch(c._hx_index){case 0:c=
Math.tan(.25*Math.atan2(this.m_sinA,this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*this.m_normals[a].y));this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[b].x-this.m_normals[b].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[b].y+this.m_normals[b].x*c))));this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[a].x+this.m_normals[a].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[a].y-
this.m_normals[a].x*c))));break;case 1:c=Math.atan2(this.m_sinA,this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*this.m_normals[a].y);var e=Math.round(this.m_StepsPerRad*(0>c?-c:c));c=this.m_normals[b].x;b=this.m_normals[b].y;d=0;for(var f=1>e?1:e;d<f;)d++,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+c*this.m_delta),Math.round(this.m_srcPoly[a].y+b*this.m_delta))),e=c,c=c*this.m_cos-this.m_sin*b,b=e*this.m_sin+b*this.m_cos;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+
this.m_normals[a].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[a].y*this.m_delta)));break;case 2:c=1+(this.m_normals[a].x*this.m_normals[b].x+this.m_normals[a].y*this.m_normals[b].y),c>=this.m_miterLim?(c=this.m_delta/c,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+(this.m_normals[b].x+this.m_normals[a].x)*c),Math.round(this.m_srcPoly[a].y+(this.m_normals[b].y+this.m_normals[a].y)*c)))):(c=Math.tan(.25*Math.atan2(this.m_sinA,this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*
this.m_normals[a].y)),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[b].x-this.m_normals[b].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[b].y+this.m_normals[b].x*c)))),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[a].x+this.m_normals[a].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[a].y-this.m_normals[a].x*c)))))}return a},doSquare:function(a,b){var c=Math.tan(.25*Math.atan2(this.m_sinA,
this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*this.m_normals[a].y));this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[b].x-this.m_normals[b].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[b].y+this.m_normals[b].x*c))));this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[a].x+this.m_normals[a].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[a].y-this.m_normals[a].x*c))))},doMiter:function(a,
b,c){c=this.m_delta/c;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+(this.m_normals[b].x+this.m_normals[a].x)*c),Math.round(this.m_srcPoly[a].y+(this.m_normals[b].y+this.m_normals[a].y)*c)))},doRound:function(a,b){var c=Math.atan2(this.m_sinA,this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*this.m_normals[a].y),d=Math.round(this.m_StepsPerRad*(0>c?-c:c));c=this.m_normals[b].x;b=this.m_normals[b].y;for(var e=0,f=1>d?1:d;e<f;)e++,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+
c*this.m_delta),Math.round(this.m_srcPoly[a].y+b*this.m_delta))),d=c,c=c*this.m_cos-this.m_sin*b,b=d*this.m_sin+b*this.m_cos;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_normals[a].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[a].y*this.m_delta)))},__class__:Kh};var Xa=K["hxd.clipper.EndType"]={__ename__:!0,__constructs__:null,ClosedPol:{_hx_name:"ClosedPol",_hx_index:0,__enum__:"hxd.clipper.EndType",toString:v},ClosedLine:{_hx_name:"ClosedLine",_hx_index:1,__enum__:"hxd.clipper.EndType",
toString:v},OpenButt:{_hx_name:"OpenButt",_hx_index:2,__enum__:"hxd.clipper.EndType",toString:v},OpenSquare:{_hx_name:"OpenSquare",_hx_index:3,__enum__:"hxd.clipper.EndType",toString:v},OpenRound:{_hx_name:"OpenRound",_hx_index:4,__enum__:"hxd.clipper.EndType",toString:v}};Xa.__constructs__=[Xa.ClosedPol,Xa.ClosedLine,Xa.OpenButt,Xa.OpenSquare,Xa.OpenRound];Xa.__empty_constructs__=[Xa.ClosedPol,Xa.ClosedLine,Xa.OpenButt,Xa.OpenSquare,Xa.OpenRound];var id=K["hxd.clipper.JoinType"]={__ename__:!0,__constructs__:null,
Square:{_hx_name:"Square",_hx_index:0,__enum__:"hxd.clipper.JoinType",toString:v},Round:{_hx_name:"Round",_hx_index:1,__enum__:"hxd.clipper.JoinType",toString:v},Miter:{_hx_name:"Miter",_hx_index:2,__enum__:"hxd.clipper.JoinType",toString:v}};id.__constructs__=[id.Square,id.Round,id.Miter];id.__empty_constructs__=[id.Square,id.Round,id.Miter];var wa=K["hxd.clipper.PolyFillType"]={__ename__:!0,__constructs__:null,EvenOdd:{_hx_name:"EvenOdd",_hx_index:0,__enum__:"hxd.clipper.PolyFillType",toString:v},
NonZero:{_hx_name:"NonZero",_hx_index:1,__enum__:"hxd.clipper.PolyFillType",toString:v},Positive:{_hx_name:"Positive",_hx_index:2,__enum__:"hxd.clipper.PolyFillType",toString:v},Negative:{_hx_name:"Negative",_hx_index:3,__enum__:"hxd.clipper.PolyFillType",toString:v}};wa.__constructs__=[wa.EvenOdd,wa.NonZero,wa.Positive,wa.Negative];wa.__empty_constructs__=[wa.EvenOdd,wa.NonZero,wa.Positive,wa.Negative];var Wa=K["hxd.clipper.PolyType"]={__ename__:!0,__constructs__:null,Subject:{_hx_name:"Subject",
_hx_index:0,__enum__:"hxd.clipper.PolyType",toString:v},Clip:{_hx_name:"Clip",_hx_index:1,__enum__:"hxd.clipper.PolyType",toString:v}};Wa.__constructs__=[Wa.Subject,Wa.Clip];Wa.__empty_constructs__=[Wa.Subject,Wa.Clip];var mi=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.left=a;this.top=b;this.right=c;this.bottom=d};mi.__name__="hxd.clipper.Rect";mi.prototype={__class__:mi};var Zd=function(){};Zd.__name__="hxd.earcut.EarNode";Zd.prototype={__class__:Zd};var Cg=
function(){};Cg.__name__="hxd.earcut.Earcut";Cg.prototype={triangulate_anon_y_Float_x_Float:function(a,b){var c=null!=b&&0<b.length?b[0]:a.length;if(3>c)return[];c=this.setLinkedList_triangulate_T(a,0,c,!0);null!=b&&(c=this.eliminateHoles_triangulate_T(a,b,c));return this.triangulateNode(c,80<a.length)},triangulate_h2d_GPoint:function(a,b){var c=null!=b&&0<b.length?b[0]:a.length;if(3>c)return[];c=this.setLinkedList_triangulate_T(a,0,c,!0);null!=b&&(c=this.eliminateHoles_triangulate_T(a,b,c));return this.triangulateNode(c,
80<a.length)},eliminateHoles_triangulate_T:function(a,b,c){for(var d=[],e=0,f=b.length;e<f;){var g=e++;g=this.setLinkedList_eliminateHoles_T(a,b[g],g==b.length-1?a.length:b[g+1],!1);g==g.next&&(g.steiner=!0);d.push(this.getLeftmost(g))}d.sort(M(this,this.compareX));for(e=0;e<d.length;)a=d[e],++e,this.eliminateHole(a,c),c=this.filterPoints(c,c.next);return c},setLinkedList_eliminateHoles_T:function(a,b,c,d){var e,f=0,g=c-1;var h=b;for(e=c;h<e;){var k=h++;f+=(a[g].x-a[k].x)*(a[k].y+a[g].y);g=k}var l=
this.cache;null==l?(l=new Zd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next;l.i=-1;l.z=-1;l.x=0;l.y=0;l.next=null;l.prev=null;l.steiner=!1;l.prevZ=null;l.nextZ=null;var m=g=l;if(d==0<f)for(h=b,e=c;h<e;)k=h++,l=a[k],c=l.x,d=l.y,l=this.cache,null==l?(l=new Zd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next,l.i=k,l.z=-1,l.x=c,l.y=d,l.next=null,l.prev=g,l.steiner=!1,l.prevZ=null,l.nextZ=null,null!=g&&(g.next=l),g=l;else for(k=c-1;k>=b;)l=a[k],c=l.x,d=l.y,l=this.cache,null==
l?(l=new Zd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next,l.i=k,l.z=-1,l.x=c,l.y=d,l.next=null,l.prev=g,l.steiner=!1,l.prevZ=null,l.nextZ=null,null!=g&&(g.next=l),g=l,--k;g.next=m.next;return g.next.prev=g},setLinkedList_triangulate_T:function(a,b,c,d){var e,f=0,g=c-1;var h=b;for(e=c;h<e;){var k=h++;f+=(a[g].x-a[k].x)*(a[k].y+a[g].y);g=k}var l=this.cache;null==l?(l=new Zd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next;l.i=-1;l.z=-1;l.x=0;l.y=0;l.next=null;l.prev=null;
l.steiner=!1;l.prevZ=null;l.nextZ=null;var m=g=l;if(d==0<f)for(h=b,e=c;h<e;)k=h++,l=a[k],c=l.x,d=l.y,l=this.cache,null==l?(l=new Zd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next,l.i=k,l.z=-1,l.x=c,l.y=d,l.next=null,l.prev=g,l.steiner=!1,l.prevZ=null,l.nextZ=null,null!=g&&(g.next=l),g=l;else for(k=c-1;k>=b;)l=a[k],c=l.x,d=l.y,l=this.cache,null==l?(l=new Zd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next,l.i=k,l.z=-1,l.x=c,l.y=d,l.next=null,l.prev=g,l.steiner=!1,l.prevZ=
null,l.nextZ=null,null!=g&&(g.next=l),g=l,--k;g.next=m.next;return g.next.prev=g},triangulateNode:function(a,b){this.triangles=[];a=this.filterPoints(a);if(b&&null!=a){var c=a.x;this.minX=c;this.minY=b=a.y;for(var d=a.next;d!=a;){var e=d.x,f=d.y;e<this.minX&&(this.minX=e);f<this.minY&&(this.minY=f);e>c&&(c=e);f>b&&(b=f);d=d.next}c-=this.minX;b-=this.minY;this.size=c<b?b:c;this.hasSize=!0}else this.hasSize=!1;this.earcutLinked(a);a=this.triangles;this.triangles=null;b=this.allocated;if(null!=this.cache){for(;b!=
this.cache;)b=b.allocNext;b=b.allocNext}for(;null!=b;)b.next=this.cache,this.cache=b,b=b.allocNext;return a},eliminateHole:function(a,b){b=this.findHoleBridge(a,b);null!=b&&(a=this.splitPolygon(b,a),this.filterPoints(a,a.next))},findHoleBridge:function(a,b){var c=b,d=a.x,e=a.y,f=-Infinity,g=null;do{if(e<=c.y&&e>=c.next.y){var h=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);h<=d&&h>f&&(f=h,g=c.x<c.next.x?c:c.next)}c=c.next}while(c!=b);if(null==g)return null;b=g;h=Infinity;for(c=g.next;c!=b;){if(d>=c.x&&
c.x>=g.x){var k=e<g.y?d:f;var l=g.x,m=g.y,p=e<g.y?f:d,r=c.x,n=c.y;k=0<=(p-r)*(e-n)-(k-r)*(e-n)&&0<=(k-r)*(m-n)-(l-r)*(e-n)&&0<=(l-r)*(e-n)-(p-r)*(m-n)}else k=!1;k&&(k=e-c.y,k=(0>k?-k:k)/(d-c.x),k<h||k==h&&c.x>g.x?(l=c.prev,m=c.next,0>(c.y-l.y)*(m.x-c.x)-(c.x-l.x)*(m.y-c.y)?(l=c.next,0<=(a.y-c.y)*(l.x-a.x)-(a.x-c.x)*(l.y-a.y)?(l=c.prev,l=0<=(l.y-c.y)*(a.x-l.x)-(l.x-c.x)*(a.y-l.y)):l=!1):(l=c.prev,0>(a.y-c.y)*(l.x-a.x)-(a.x-c.x)*(l.y-a.y)?l=!0:(l=c.next,l=0>(l.y-c.y)*(a.x-l.x)-(l.x-c.x)*(a.y-l.y)))):
l=!1,l&&(g=c,h=k));c=c.next}return g},getLeftmost:function(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!=a);return c},compareX:function(a,b){return 0<a.x-b.x?1:-1},equals:function(a,b){return a.x==b.x?a.y==b.y:!1},area:function(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)},intersects:function(a,b,c,d){return 0<(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)!=0<(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-b.y)?0<(d.y-c.y)*(a.x-d.x)-(d.x-c.x)*(a.y-d.y)!=0<(d.y-c.y)*(b.x-d.x)-(d.x-c.x)*(b.y-d.y):!1},locallyInside:function(a,
b){var c=a.prev;var d=a.next;if(0>(a.y-c.y)*(d.x-a.x)-(a.x-c.x)*(d.y-a.y))return d=a.next,0<=(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-b.y)?(d=a.prev,0<=(d.y-a.y)*(b.x-d.x)-(d.x-a.x)*(b.y-d.y)):!1;d=a.prev;if(0>(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-b.y))return!0;d=a.next;return 0>(d.y-a.y)*(b.x-d.x)-(d.x-a.x)*(b.y-d.y)},filterPoints:function(a,b){if(null==a)return a;null==b&&(b=a);do{var c=!1;if(a.steiner)var d=!1;else if(d=a.next,a.x!=d.x||a.y!=d.y){d=a.prev;var e=a.next;d=0==(a.y-d.y)*(e.x-a.x)-(a.x-d.x)*
(e.y-a.y)}else d=!0;if(d){a.next.prev=a.prev;a.prev.next=a.next;null!=a.prevZ&&(a.prevZ.nextZ=a.nextZ);null!=a.nextZ&&(a.nextZ.prevZ=a.prevZ);a=b=a.prev;if(a==a.next)return null;c=!0}else a=a.next}while(c||a!=b);return b},removeNode:function(a){a.next.prev=a.prev;a.prev.next=a.next;null!=a.prevZ&&(a.prevZ.nextZ=a.nextZ);null!=a.nextZ&&(a.nextZ.prevZ=a.prevZ)},allocNode:function(a,b,c,d){var e=this.cache;null==e?(e=new Zd,e.allocNext=this.allocated,this.allocated=e):this.cache=e.next;e.i=a;e.z=-1;
e.x=b;e.y=c;e.next=null;e.prev=d;e.steiner=!1;e.prevZ=null;e.nextZ=null;null!=d&&(d.next=e);return e},earcutLinked:function(a,b){null==b&&(b=0);if(null!=a){0==b&&this.hasSize&&this.indexCurve(a);for(var c=a,d,e;a.prev!=a.next;)if(d=a.prev,e=a.next,this.hasSize?this.isEarHashed(a):this.isEar(a))this.triangles.push(d.i),this.triangles.push(a.i),this.triangles.push(e.i),a.next.prev=a.prev,a.prev.next=a.next,null!=a.prevZ&&(a.prevZ.nextZ=a.nextZ),null!=a.nextZ&&(a.nextZ.prevZ=a.prevZ),c=a=e.next;else if(a=
e,a==c){switch(b){case 0:this.earcutLinked(this.filterPoints(a),1);break;case 1:a=this.cureLocalIntersections(a);this.earcutLinked(a,2);break;case 2:this.splitEarcut(a)}break}}},isEar:function(a){var b=a.prev,c=a.next;if(0<=(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-a.y))return!1;for(var d=a.next.next;d!=a.prev;){var e=b.x;var f=b.y,g=a.x,h=a.y,k=c.x,l=c.y,m=d.x,p=d.y;0<=(k-m)*(f-p)-(e-m)*(l-p)&&0<=(e-m)*(h-p)-(g-m)*(f-p)&&0<=(g-m)*(l-p)-(k-m)*(h-p)?(e=d.prev,f=d.next,e=0<=(d.y-e.y)*(f.x-d.x)-(d.x-e.x)*(f.y-
d.y)):e=!1;if(e)return!1;d=d.next}return!0},isEarHashed:function(a){var b=a.prev,c=a.next;if(0<=(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-a.y))return!1;var d=b.x>a.x?b.x>c.x?b.x:c.x:a.x>c.x?a.x:c.x,e=b.y>a.y?b.y>c.y?b.y:c.y:a.y>c.y?a.y:c.y;var f=32767*((b.x<a.x?b.x<c.x?b.x:c.x:a.x<c.x?a.x:c.x)-this.minX)/this.size|0;var g=32767*((b.y<a.y?b.y<c.y?b.y:c.y:a.y<c.y?a.y:c.y)-this.minY)/this.size|0;f=(f|f<<8)&16711935;f=(f|f<<4)&252645135;f=(f|f<<2)&858993459;g=(g|g<<8)&16711935;g=(g|g<<4)&252645135;g=(g|g<<2)&
858993459;var h=(f|f<<1)&1431655765|((g|g<<1)&1431655765)<<1;f=32767*(d-this.minX)/this.size|0;g=32767*(e-this.minY)/this.size|0;f=(f|f<<8)&16711935;f=(f|f<<4)&252645135;f=(f|f<<2)&858993459;g=(g|g<<8)&16711935;g=(g|g<<4)&252645135;g=(g|g<<2)&858993459;d=(f|f<<1)&1431655765|((g|g<<1)&1431655765)<<1;for(e=a.nextZ;null!=e&&e.z<=d;){if(e!=a.prev&&e!=a.next){var k=b.x;var l=b.y;var m=a.x;var p=a.y;var r=c.x;var n=c.y;g=e.x;f=e.y;f=0<=(r-g)*(l-f)-(k-g)*(n-f)&&0<=(k-g)*(p-f)-(m-g)*(l-f)&&0<=(m-g)*(n-f)-
(r-g)*(p-f)}else f=!1;f?(g=e.prev,f=e.next,f=0<=(e.y-g.y)*(f.x-e.x)-(e.x-g.x)*(f.y-e.y)):f=!1;if(f)return!1;e=e.nextZ}for(e=a.prevZ;null!=e&&e.z>=h;){e!=a.prev&&e!=a.next?(k=b.x,l=b.y,m=a.x,p=a.y,r=c.x,n=c.y,g=e.x,f=e.y,f=0<=(r-g)*(l-f)-(k-g)*(n-f)&&0<=(k-g)*(p-f)-(m-g)*(l-f)&&0<=(m-g)*(n-f)-(r-g)*(p-f)):f=!1;f?(g=e.prev,f=e.next,f=0<=(e.y-g.y)*(f.x-e.x)-(e.x-g.x)*(f.y-e.y)):f=!1;if(f)return!1;e=e.prevZ}return!0},cureLocalIntersections:function(a){var b=a;do{var c=b.prev,d=b.next.next;var e=b.next;
if(0<(b.y-c.y)*(e.x-b.x)-(b.x-c.x)*(e.y-b.y)!=0<(b.y-c.y)*(d.x-b.x)-(b.x-c.x)*(d.y-b.y)&&0<(d.y-e.y)*(c.x-d.x)-(d.x-e.x)*(c.y-d.y)!=0<(d.y-e.y)*(b.x-d.x)-(d.x-e.x)*(b.y-d.y)){e=c.prev;var f=c.next;0>(c.y-e.y)*(f.x-c.x)-(c.x-e.x)*(f.y-c.y)?(e=c.next,0<=(d.y-c.y)*(e.x-d.x)-(d.x-c.x)*(e.y-d.y)?(e=c.prev,e=0<=(e.y-c.y)*(d.x-e.x)-(e.x-c.x)*(d.y-e.y)):e=!1):(e=c.prev,0>(d.y-c.y)*(e.x-d.x)-(d.x-c.x)*(e.y-d.y)?e=!0:(e=c.next,e=0>(e.y-c.y)*(d.x-e.x)-(e.x-c.x)*(d.y-e.y)))}else e=!1;e?(e=d.prev,f=d.next,0>(d.y-
e.y)*(f.x-d.x)-(d.x-e.x)*(f.y-d.y)?(e=d.next,0<=(c.y-d.y)*(e.x-c.x)-(c.x-d.x)*(e.y-c.y)?(e=d.prev,e=0<=(e.y-d.y)*(c.x-e.x)-(e.x-d.x)*(c.y-e.y)):e=!1):(e=d.prev,0>(c.y-d.y)*(e.x-c.x)-(c.x-d.x)*(e.y-c.y)?e=!0:(e=d.next,e=0>(e.y-d.y)*(c.x-e.x)-(e.x-d.x)*(c.y-e.y)))):e=!1;e&&(this.triangles.push(c.i),this.triangles.push(b.i),this.triangles.push(d.i),b.next.prev=b.prev,b.prev.next=b.next,null!=b.prevZ&&(b.prevZ.nextZ=b.nextZ),null!=b.nextZ&&(b.nextZ.prevZ=b.prevZ),a=b.next,a.next.prev=a.prev,a.prev.next=
a.next,null!=a.prevZ&&(a.prevZ.nextZ=a.nextZ),null!=a.nextZ&&(a.nextZ.prevZ=a.prevZ),b=a=d);b=b.next}while(b!=a);return b},splitEarcut:function(a){var b=a;do{for(var c=b.next.next;c!=b.prev;){if(b.i!=c.i&&this.isValidDiagonal(b,c)){a=this.splitPolygon(b,c);b=this.filterPoints(b,b.next);a=this.filterPoints(a,a.next);this.earcutLinked(b);this.earcutLinked(a);return}c=c.next}b=b.next}while(b!=a)},splitPolygon:function(a,b){var c=a.i,d=a.x,e=a.y,f=null,g=this.cache;null==g?(g=new Zd,g.allocNext=this.allocated,
this.allocated=g):this.cache=g.next;g.i=c;g.z=-1;g.x=d;g.y=e;g.next=null;g.prev=f;g.steiner=!1;g.prevZ=null;g.nextZ=null;null!=f&&(f.next=g);var h=g;c=b.i;d=b.x;e=b.y;f=null;g=this.cache;null==g?(g=new Zd,g.allocNext=this.allocated,this.allocated=g):this.cache=g.next;g.i=c;g.z=-1;g.x=d;g.y=e;g.next=null;g.prev=f;g.steiner=!1;g.prevZ=null;g.nextZ=null;null!=f&&(f.next=g);c=g;d=a.next;e=b.prev;a.next=b;b.prev=a;h.next=d;d.prev=h;c.next=h;h.prev=c;e.next=c;c.prev=e;return c},pointInTriangle:function(a,
b,c,d,e,f,g,h){return 0<=(e-g)*(b-h)-(a-g)*(f-h)&&0<=(a-g)*(d-h)-(c-g)*(b-h)?0<=(c-g)*(f-h)-(e-g)*(d-h):!1},isValidDiagonal:function(a,b){if(a.x!=b.x||a.y!=b.y){if(a.next.i==b.i||a.prev.i==b.i||this.intersectsPolygon(a,b))var c=!1;else{var d=a.prev;c=a.next;0>(a.y-d.y)*(c.x-a.x)-(a.x-d.x)*(c.y-a.y)?(c=a.next,0<=(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)?(c=a.prev,c=0<=(c.y-a.y)*(b.x-c.x)-(c.x-a.x)*(b.y-c.y)):c=!1):(c=a.prev,0>(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)?c=!0:(c=a.next,c=0>(c.y-a.y)*(b.x-
c.x)-(c.x-a.x)*(b.y-c.y)))}c?(d=b.prev,c=b.next,0>(b.y-d.y)*(c.x-b.x)-(b.x-d.x)*(c.y-b.y)?(c=b.next,0<=(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-a.y)?(c=b.prev,c=0<=(c.y-b.y)*(a.x-c.x)-(c.x-b.x)*(a.y-c.y)):c=!1):(c=b.prev,0>(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-a.y)?c=!0:(c=b.next,c=0>(c.y-b.y)*(a.x-c.x)-(c.x-b.x)*(a.y-c.y)))):c=!1;return c?this.middleInside(a,b):!1}return!0},middleInside:function(a,b){var c=a,d=!1,e=(a.x+b.x)/2;b=(a.y+b.y)/2;do c.y>b!=c.next.y>b&&e<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&
(d=!d),c=c.next;while(c!=a);return d},intersectsPolygon:function(a,b){var c=a;do{if(c.i!=a.i&&c.next.i!=a.i&&c.i!=b.i&&c.next.i!=b.i){var d=c.next;d=0<(d.y-c.y)*(a.x-d.x)-(d.x-c.x)*(a.y-d.y)!=0<(d.y-c.y)*(b.x-d.x)-(d.x-c.x)*(b.y-d.y)&&0<(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)!=0<(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-b.y)}else d=!1;if(d)return!0;c=c.next}while(c!=a);return!1},zOrder:function(a,b){a=32767*(a-this.minX)/this.size|0;b=32767*(b-this.minY)/this.size|0;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;
a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1},indexCurve:function(a){var b=a;do{if(0>b.z){var c=32767*(b.x-this.minX)/this.size|0,d=32767*(b.y-this.minY)/this.size|0;c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;c=(c|c<<1)&1431655765;d=(d|d<<8)&16711935;d=(d|d<<4)&252645135;d=(d|d<<2)&858993459;d=(d|d<<1)&1431655765;b.z=c|d<<1}b.prevZ=b.prev;b=b.nextZ=b.next}while(b!=a);b.prevZ.nextZ=null;b.prevZ=
null;this.sortLinked(b)},sortLinked:function(a){var b,c,d,e=1;do{var f=a;var g=a=null;for(b=0;null!=f;){++b;var h=f;var k=c=0;for(d=e;k<d&&(k++,++c,h=h.nextZ,null!=h););for(d=e;0<c||0<d&&null!=h;)0==c?(k=h,h=h.nextZ,--d):0==d||null==h?(k=f,f=f.nextZ,--c):f.z<=h.z?(k=f,f=f.nextZ,--c):(k=h,h=h.nextZ,--d),null!=g?g.nextZ=k:a=k,k.prevZ=g,g=k;f=h}g.nextZ=null;e*=2}while(1<b);return a},__class__:Cg};var Yi=function(){};Yi.__name__="hxd.fmt.hdr.Reader";Yi.decode=function(a,b){for(var c,d=new Vb(a),e,f,g=
Object.create(null);;){f=d.readLine();if(""==f)break;35!=F.cca(f,0)&&(f=f.split("="),1<f.length&&(g[f.shift()]=f.join("=")))}e=d.readLine().split(" ");f=y.parseInt(e[1]);e=y.parseInt(e[3]);var h="1"==g.GAMMA,k=new S(new ArrayBuffer(e*f*16)),l=1,m=g.EXPOSURE;null!=m&&(m=parseFloat(m),1E-12>m||1E12>m)&&(l=m);var p=b?1:.45454545454545453,r=[];for(b=0;256>b;)c=b++,r.push(Math.pow(c,p));m=r;r=[];for(b=0;256>b;)c=b++,r.push(Math.pow(Math.pow(2,c-128)/(256*l),p));l=r;r=g.FORMAT;if(null==r)throw t.thrown("Unsupported HDR format "+
r);if("32-bit_rle_rgbe"==r)for(d=d.pos,g=new S(new ArrayBuffer(4*e)),r=e>>8|(e&255)<<8,b=0;b<f;){c=b++;p=a.getInt32(d);if(514!=(p&65535)||p>>>16!=r)g.blit(0,a,d,4*e),d+=4*e;else{d+=4;p=0;for(var n=4*e;p<n;){var q=a.b[d++];128<q?(q-=128,g.fill(p,q,a.b[d++])):(g.blit(p,a,d,q),d+=q);p+=q}}p=c*e*16;n=0;for(q=e;n<q;){var w=n++;c=l[g.b[w+3*e]];k.setFloat(p,m[g.b[w]]*c);p+=4;k.setFloat(p,m[g.b[w+e]]*c);p+=4;k.setFloat(p,m[g.b[w+(e<<1)]]*c);p+=4;k.setFloat(p,1);p+=4}}else throw t.thrown("Unsupported HDR format "+
r);return{width:e,height:f,bytes:k,gamma:h}};var xb=K["hxd.fmt.hmd.Property"]={__ename__:!0,__constructs__:null,CameraFOVY:(z=function(a){return{_hx_index:0,v:a,__enum__:"hxd.fmt.hmd.Property",toString:v}},z._hx_name="CameraFOVY",z.__params__=["v"],z),Unused_HasMaterialFlags:{_hx_name:"Unused_HasMaterialFlags",_hx_index:1,__enum__:"hxd.fmt.hmd.Property",toString:v},HasExtraTextures:{_hx_name:"HasExtraTextures",_hx_index:2,__enum__:"hxd.fmt.hmd.Property",toString:v},FourBonesByVertex:{_hx_name:"FourBonesByVertex",
_hx_index:3,__enum__:"hxd.fmt.hmd.Property",toString:v},HasLod:{_hx_name:"HasLod",_hx_index:4,__enum__:"hxd.fmt.hmd.Property",toString:v},HasCollider:{_hx_name:"HasCollider",_hx_index:5,__enum__:"hxd.fmt.hmd.Property",toString:v}};xb.__constructs__=[xb.CameraFOVY,xb.Unused_HasMaterialFlags,xb.HasExtraTextures,xb.FourBonesByVertex,xb.HasLod,xb.HasCollider];xb.__empty_constructs__=[xb.Unused_HasMaterialFlags,xb.HasExtraTextures,xb.FourBonesByVertex,xb.HasLod,xb.HasCollider];var mg=function(){};mg.__name__=
"hxd.fmt.hmd.Position";mg.prototype={loadQuaternion:function(a){a.x=this.qx;a.y=this.qy;a.z=this.qz;a.w=this.get_qw()},get_qw:function(){var a=1-(this.qx*this.qx+this.qy*this.qy+this.qz*this.qz);return 0>a?-Math.sqrt(-a):Math.sqrt(a)},toMatrix:function(a){null==a&&(a=!1);var b=new ca,c=mg.QTMP;c.x=this.qx;c.y=this.qy;c.z=this.qz;c.w=this.get_qw();c.toMatrix(b);a?(b.translate(this.x,this.y,this.z),b.scale(this.sx,this.sy,this.sz)):(b._11*=this.sx,b._12*=this.sx,b._13*=this.sx,b._21*=this.sy,b._22*=
this.sy,b._23*=this.sy,b._31*=this.sz,b._32*=this.sz,b._33*=this.sz,b.translate(this.x,this.y,this.z));return b},__class__:mg};var ni=function(){};ni.__name__="hxd.fmt.hmd.Geometry";ni.prototype={get_indexCount:function(){for(var a=0,b=0,c=this.indexCounts;b<c.length;){var d=c[b];++b;a+=d}return a},__class__:ni};var oi=function(){};oi.__name__="hxd.fmt.hmd.BlendShape";oi.prototype={__class__:oi};var pi=function(){};pi.__name__="hxd.fmt.hmd.Collider";pi.prototype={__class__:pi};var qi=function(){};
qi.__name__="hxd.fmt.hmd.Material";qi.prototype={__class__:qi};var ri=function(){};ri.__name__="hxd.fmt.hmd.SkinJoint";ri.prototype={__class__:ri};var si=function(){};si.__name__="hxd.fmt.hmd.SkinSplit";si.prototype={__class__:si};var ti=function(){};ti.__name__="hxd.fmt.hmd.Skin";ti.prototype={__class__:ti};var ui=function(){};ui.__name__="hxd.fmt.hmd.Model";ui.prototype={getObjectName:function(){return null==this.name?this.name:this.name.replace(/_*-*LOD0/,"")},isLOD:function(){return 0>this.name.indexOf("LOD0")},
isLOD0:function(a){return null!=this.name&&-1!=this.name.indexOf(a)?-1!=this.name.indexOf("LOD0"):!1},toLODName:function(a){return this.name+"LOD"+a},getLODInfos:function(){if(null==this.name||3>=this.name.length)return{lodLevel:-1,modelName:null};if("LOD"==F.substr(this.name,0,3)){var a=y.parseInt(F.substr(this.name,3,1));if(null!=a){if(null!=y.parseInt(F.substr(this.name,4,1)))throw t.thrown("Did not expect a second number after LOD in "+this.name);return{lodLevel:a,modelName:F.substr(this.name,
3,null)}}}var b=this.name.length-3-1;return"LOD"==F.substr(this.name,b,3)&&(a=y.parseInt(this.name.charAt(this.name.length-1)),null!=a)?{lodLevel:a,modelName:F.substr(this.name,0,b)}:{lodLevel:-1,modelName:null}},__class__:ui};var Ga=K["hxd.fmt.hmd.AnimationFlag"]={__ename__:!0,__constructs__:null,HasPosition:{_hx_name:"HasPosition",_hx_index:0,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},HasRotation:{_hx_name:"HasRotation",_hx_index:1,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},HasScale:{_hx_name:"HasScale",
_hx_index:2,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},HasUV:{_hx_name:"HasUV",_hx_index:3,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},HasAlpha:{_hx_name:"HasAlpha",_hx_index:4,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},SingleFrame:{_hx_name:"SingleFrame",_hx_index:5,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},HasProps:{_hx_name:"HasProps",_hx_index:6,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},Reserved:{_hx_name:"Reserved",_hx_index:7,__enum__:"hxd.fmt.hmd.AnimationFlag",
toString:v}};Ga.__constructs__=[Ga.HasPosition,Ga.HasRotation,Ga.HasScale,Ga.HasUV,Ga.HasAlpha,Ga.SingleFrame,Ga.HasProps,Ga.Reserved];Ga.__empty_constructs__=[Ga.HasPosition,Ga.HasRotation,Ga.HasScale,Ga.HasUV,Ga.HasAlpha,Ga.SingleFrame,Ga.HasProps,Ga.Reserved];var vi=function(){};vi.__name__="hxd.fmt.hmd.AnimationObject";vi.prototype={getStride:function(){var a=0;0!=(this.flags&1<<Ga.HasPosition._hx_index)&&(a+=3);0!=(this.flags&1<<Ga.HasRotation._hx_index)&&(a+=3);0!=(this.flags&1<<Ga.HasScale._hx_index)&&
(a+=3);0!=(this.flags&1<<Ga.HasUV._hx_index)&&(a+=2);0!=(this.flags&1<<Ga.HasAlpha._hx_index)&&++a;0!=(this.flags&1<<Ga.HasProps._hx_index)&&(a+=this.props.length);return a},__class__:vi};var wi=function(){};wi.__name__="hxd.fmt.hmd.AnimationEvent";wi.prototype={__class__:wi};var xi=function(){};xi.__name__="hxd.fmt.hmd.Animation";xi.prototype={__class__:xi};var ch=function(){};ch.__name__="hxd.fmt.hmd.Data";ch.prototype={__class__:ch};var dh=function(a,b,c,d){this.size=a;this.offset=b;this.precision=
d;this.def=c};dh.__name__="hxd.fmt.hmd._Library.FormatMap";dh.prototype={__class__:dh};var Qg=function(){};Qg.__name__="hxd.fmt.hmd.GeometryBuffer";Qg.prototype={__class__:Qg};var yi=function(a,b){this.resource=a;this.header=b;this.cachedPrimitives=[];this.cachedAnimations=new Sa;this.cachedSkin=new Sa};yi.__name__="hxd.fmt.hmd.Library";yi.prototype={getData:function(){var a=this.resource.entry,b=new S(new ArrayBuffer(a.get_size()-this.header.dataPosition));a.readFull(b,this.header.dataPosition,b.length);
return b},getDefaultFormat:function(a){var b=[new va("position",3)],c=[null];3<a&&(b.push(new va("normal",3)),c.push(null));6<a&&(b.push(new va("uv",2)),c.push(null));if(8<a){b.push(new va("color",3));var d=1,e=1,f=1;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.push(new G(d,e,f))}if(11<a)throw t.thrown("Unsupported stride");return{format:N.make(b),defs:c}},load:function(a,b,c){null==c&&(c=-1);c=0>c?this.header.models:[this.header.models[c]];for(var d=wd._new(0),e=[],f=a.stride,g=-1,h=0;h<c.length;){var k=
c[h];++h;var l=this.header.geometries[k.geometry];if(null!=l){for(var m=0,p=k.materials;m<p.length;){var r=p[m];++m;0>g&&(g=r);if(g!=r)throw t.thrown("Models have several materials");}k=k.position.toMatrix();m=this.getBuffers(l,a,b);l=d.pos/f|0;p=0;for(r=m.vertexes.length/f|0;p<r;){var n=p++*f;var q=m.vertexes[n++];var w=m.vertexes[n++];var v=m.vertexes[n++];var x=q*k._12+w*k._22+v*k._32+k._42,y=q*k._13+w*k._23+v*k._33+k._43;q=q*k._11+w*k._21+v*k._31+k._41;w=x;v=y;d.pos==d.array.length&&(x=d.array.length<<
1,128>x&&(x=128),x=new Float32Array(x),x.set(d.array),d.array=x);d.array[d.pos++]=q;d.pos==d.array.length&&(q=d.array.length<<1,128>q&&(q=128),q=new Float32Array(q),q.set(d.array),d.array=q);d.array[d.pos++]=w;d.pos==d.array.length&&(w=d.array.length<<1,128>w&&(w=128),w=new Float32Array(w),w.set(d.array),d.array=w);d.array[d.pos++]=v;v=0;for(w=f-3;v<w;)v++,q=m.vertexes[n++],d.pos==d.array.length&&(x=d.array.length<<1,128>x&&(x=128),x=new Float32Array(x),x.set(d.array),d.array=x),d.array[d.pos++]=
q}k=0;for(m=m.indexes;k<m.length;)p=m[k],++k,e.push(p+l)}}return{vertex:d,index:e}},getBuffers:function(a,b,c,d){var e,f;0==d&&1==a.indexCounts.length&&(d=null);var g=[];var h=f=0;for(var k=!1,l=0,m=b.inputs;l<m.length;){b=m[l++];var p=a.vertexFormat.getInput(b.name);if(null==p){p=null==c?null:c[f];if(null==p)throw t.thrown("Missing required "+b.name);var r=b.type;var n=new dh(r==ka.__cast(9,jc)?1:r,0,p,0)}else{if(p.type!=b.type)throw t.thrown("Requested "+b.name+" "+(null==b.type?"null":Vd.toString(b.type))+
" but found "+(null==p.type?"null":Vd.toString(p.type)));n=b.type;n=new dh(n==ka.__cast(9,jc)?1:n,a.vertexFormat.calculateInputOffset(p.name),null,p.precision);0!=p.precision&&(k=!0)}g.push(n);b=b.type;h+=b==ka.__cast(9,jc)?1:b;++f}c=a.vertexFormat.strideBytes;b=a.vertexCount*c;l=new S(new ArrayBuffer(b));var q=this.resource.entry;q.readFull(l,this.header.dataPosition+a.vertexPosition,b);f=this.header.dataPosition+a.indexPosition;var w=(m=65536>=a.vertexCount)?2:4;if(null==d)b=a.get_indexCount()*
w;else{n=r=0;for(p=d;n<p;)b=n++,r+=a.indexCounts[b];f+=r*w;b=a.indexCounts[d]*w}w=new S(new ArrayBuffer(b));q.readFull(w,f,b);q=new Qg;if(null==d){q.vertexes=Array(h*a.vertexCount);q.indexes=Array(a.get_indexCount());var v=0;n=0;for(p=a.vertexCount;n<p;)for(d=n++,a=0;a<g.length;){var x=g[a];++a;if(null==x.def){var y=0;for(e=x.size;y<e;){b=y++;r=q.vertexes;f=v++;if(k)switch(x.precision){case 0:var z=l.getFloat(d*c+(b<<2)+x.offset);break;case 1:z=N.float16to32(l.getUInt16(d*c+(b<<1)+x.offset));break;
case 2:z=(l.b[d*c+b+x.offset]&255)/255;break;case 3:z=N.floatS8to32(l.b[d*c+b+x.offset])}else z=l.getFloat(d*c+(b<<2)+x.offset);r[f]=z}}else switch(x.size){case 1:q.vertexes[v++]=x.def.x;break;case 2:q.vertexes[v++]=x.def.x;q.vertexes[v++]=x.def.y;break;case 3:q.vertexes[v++]=x.def.x;q.vertexes[v++]=x.def.y;q.vertexes[v++]=x.def.z;break;default:q.vertexes[v++]=x.def.x,q.vertexes[v++]=x.def.y,q.vertexes[v++]=x.def.z,q.vertexes[v++]=x.def.w}}if(m)for(n=h=0,p=q.indexes.length;n<p;)b=n++,q.indexes[b]=
w.b[h++]|w.b[h++]<<8;else for(n=0,p=q.indexes.length;n<p;)b=n++,q.indexes[b]=w.getInt32(b<<2)}else{b=a.indexCounts[d];z=Array(a.vertexCount);f=wd._new(0);q.indexes=Array(b);n=r=h=0;for(p=q.indexes.length;n<p;){b=n++;d=m?w.b[h++]|w.b[h++]<<8:w.getInt32(b<<2);var A=z[d];if(0==A)for(++r,A=r,z[d]=A,a=0;a<g.length;)if(x=g[a],++a,null==x.def)for(y=0,e=x.size;y<e;){var B=y++;if(k)switch(x.precision){case 0:v=l.getFloat(d*c+(B<<2)+x.offset);break;case 1:v=N.float16to32(l.getUInt16(d*c+(B<<1)+x.offset));break;
case 2:v=(l.b[d*c+B+x.offset]&255)/255;break;case 3:v=N.floatS8to32(l.b[d*c+B+x.offset])}else v=l.getFloat(d*c+(B<<2)+x.offset);f.pos==f.array.length&&(B=f.array.length<<1,128>B&&(B=128),B=new Float32Array(B),B.set(f.array),f.array=B);f.array[f.pos++]=v}else switch(x.size){case 1:x=x.def.x;f.pos==f.array.length&&(e=f.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(f.array),f.array=e);f.array[f.pos++]=x;break;case 2:e=x.def.x;f.pos==f.array.length&&(y=f.array.length<<1,128>y&&(y=128),y=
new Float32Array(y),y.set(f.array),f.array=y);f.array[f.pos++]=e;x=x.def.y;f.pos==f.array.length&&(e=f.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(f.array),f.array=e);f.array[f.pos++]=x;break;case 3:e=x.def.x;f.pos==f.array.length&&(y=f.array.length<<1,128>y&&(y=128),y=new Float32Array(y),y.set(f.array),f.array=y);f.array[f.pos++]=e;e=x.def.y;f.pos==f.array.length&&(y=f.array.length<<1,128>y&&(y=128),y=new Float32Array(y),y.set(f.array),f.array=y);f.array[f.pos++]=e;x=x.def.z;f.pos==
f.array.length&&(e=f.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(f.array),f.array=e);f.array[f.pos++]=x;break;default:e=x.def.x,f.pos==f.array.length&&(y=f.array.length<<1,128>y&&(y=128),y=new Float32Array(y),y.set(f.array),f.array=y),f.array[f.pos++]=e,e=x.def.y,f.pos==f.array.length&&(y=f.array.length<<1,128>y&&(y=128),y=new Float32Array(y),y.set(f.array),f.array=y),f.array[f.pos++]=e,e=x.def.z,f.pos==f.array.length&&(y=f.array.length<<1,128>y&&(y=128),y=new Float32Array(y),y.set(f.array),
f.array=y),f.array[f.pos++]=e,x=x.def.w,f.pos==f.array.length&&(e=f.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(f.array),f.array=e),f.array[f.pos++]=x}q.indexes[b]=A-1}r=f;n=[];p=0;for(a=r.pos;p<a;)b=p++,n.push(r.array[b]);q.vertexes=n}return q},makePrimitive:function(a){var b=a.geometry;var c=this.cachedPrimitives[b];if(null!=c)return c;c=null;if(null!=a.lods){if(a.isLOD())return null;var d=[];c=0;for(var e=a.lods;c<e.length;){var f=e[c];++c;d.push(this.header.models[f])}c=d;this.patchLodsMaterials(a,
c)}else{e=a.getLODInfos();if(0<e.lodLevel){d=0;for(c=this.header.models;d<c.length;)if(a=c[d],++d,a.isLOD0(e.modelName))return null;throw t.thrown("No LOD0 found for "+e.modelName+" in "+this.resource.entry.name);}0==e.lodLevel&&(c=this.findLODs(e.modelName,a),this.patchLodsMaterials(a,c))}c=new Gd(this.header.geometries[b],this.header.dataPosition,this,c);c.incref();return this.cachedPrimitives[b]=c},dispose:function(){for(var a=0,b=this.cachedPrimitives;a<b.length;){var c=b[a];++a;null!=c&&c.decref()}this.cachedPrimitives=
[]},makeMaterial:function(a,b,c){a=this.header.materials[b];b=Ld.current.createMaterial();b.name=a.name;b.model=this.resource;b.set_blendMode(a.blendMode);var d=Ld.current.loadMaterialProps(b);null==d&&(d=b.getDefaultModelProps());null!=a.diffuseTexture&&(b.set_texture(c(a.diffuseTexture)),null==b.get_texture()&&b.set_texture(W.fromColor(16711935)));null!=a.specularTexture&&b.set_specularTexture(c(a.specularTexture));null!=a.normalMap&&b.set_normalMap(c(a.normalMap));b.set_props(d);return b},makeSkin:function(a,
b){var c=this.cachedSkin.h[a.name];if(null!=c)return c;c=new Sh(a.name,0,null!=b.props&&0<=b.props.indexOf(xb.FourBonesByVertex)?4:3);c.namedJoints=new Sa;c.allJoints=[];c.boundJoints=[];c.rootJoints=[];var d=0;for(b=a.joints;d<b.length;){var e=b[d];++d;var f=new Ze;f.name=e.name;f.index=c.allJoints.length;f.defMat=e.position.toMatrix();0<=e.bind&&(f.bindIndex=e.bind,f.transPos=e.transpos.toMatrix(!0),c.boundJoints[f.bindIndex]=f);0<=e.parent?(e=c.allJoints[e.parent],e.subs.push(f),f.parent=e):c.rootJoints.push(f);
c.allJoints.push(f);c.namedJoints.h[f.name]=f}if(null!=a.split)for(c.splitJoints=[],d=0,b=a.split;d<b.length;){f=b[d];++d;e=c.splitJoints;for(var g=f.materialIndex,h=[],k=0,l=f.joints;k<l.length;)f=l[k],++k,h.push(c.allJoints[f]);e.push({material:g,joints:h})}return this.cachedSkin.h[a.name]=c},getModelProperty:function(a,b,c){for(var d=0,e=this.header.models;d<e.length;){var f=e[d];++d;if(f.name==a){if(null!=f.props)for(a=0,f=f.props;a<f.length;)if(d=f[a],++a,d._hx_index==b._hx_index)return da.enumParameters(d)[0];
return c}}if(null==c)throw t.thrown("Model "+a+" not found");return c},findLODs:function(a,b){if(null==a)return null;b=[];for(var c=0,d=this.header.models;c<d.length;){var e=d[c];++c;var f=e.getLODInfos();if(!(1>f.lodLevel)&&f.modelName==a){if(null!=b[f.lodLevel-1])throw t.thrown("Multiple LODs with the same level : "+e.name);b[f.lodLevel-1]=e}}return b},patchLodsMaterials:function(a,b){for(var c=0;c<b.length;){var d=b[c];++c;for(var e=0,f=d.materials;e<f.length;){var g=f[e];++e;if(-1==a.materials.indexOf(g))throw t.thrown("Model "+
d.name+" has a material that isn't used by "+a.name+". This is not supported.");}e=this.header.geometries[d.geometry];f=[];for(var h=g=0,k=a.materials.length;h<k;){var l=h++;a.materials[l]==d.materials[g]?(f[l]=e.indexCounts[g],++g):f[l]=0}e.indexCounts=f}},makeObject:function(a){null==a&&(a=function(a){return W.fromColor(16711935)});if(0==this.header.models.length)throw t.thrown("This file does not contain any model");for(var b=[],c=0,d=this.header.models;c<d.length;){var e=d[c];++c;if(0>e.geometry)var f=
new Aa;else{f=this.makePrimitive(e);if(null==f)continue;if(null!=e.skin){var g=this.makeSkin(e.skin,this.header.geometries[e.geometry]);g.primitive=f;f=[];for(var h=0,k=e.materials;h<k.length;){var l=k[h];++h;f.push(this.makeMaterial(e,l,a))}f=new Jb(g,f)}else if(1==e.materials.length)f=new Ra(f,this.makeMaterial(e,e.materials[0],a));else{g=[];h=0;for(k=e.materials;h<k.length;)l=k[h],++h,g.push(this.makeMaterial(e,l,a));f=new Hc(f,g)}}f.name=e.getObjectName();g=e.position.toMatrix();f.defaultTransform=
g;f.flags|=1;0!=(f.flags&131072)&&(f.flags|=262144);b.push(f);e=b[e.parent];null!=e&&e.addChild(f);e=this.resource.entry.get_directory();g=f instanceof Ra?f:null;g=null!=g?g.primitive:null;nb.current.loadModelProps({resourceDirectory:e,resourceName:this.resource.entry.name,objectName:f.name,hmd:g instanceof Gd?g:null,skin:f instanceof Jb?f:null})}a=b[0];null!=a&&(a.flags|=256);return a},loadAnimation:function(a){var b=this.cachedAnimations.h[null==a?"":a];if(null!=b)return b;b=null;if(null==a){if(0==
this.header.animations.length)return null;b=this.header.animations[0]}else{for(var c=0,d=this.header.animations;c<d.length;){var e=d[c];++c;if(e.name==a){b=e;break}}if(null==b)throw t.thrown("Animation "+a+" not found !");}c=2>=this.header.version?this.makeLinearAnimation(b):this.makeAnimation(b);c.speed=b.speed;c.loop=b.loop;null!=b.events&&c.setEvents(b.events);c.resourcePath=this.resource.entry.get_path();this.cachedAnimations.h[b.name]=c;null==a&&(this.cachedAnimations.h[""]=c);return c},makeAnimation:function(a){var b,
c=new ue(a.name,a.frames,a.sampling),d=0,e=[],f=[],g=0;for(b=a.objects;g<b.length;){var h=b[g];++g;var k=c.addObject(h.name,0),l=1;0!=(h.flags&1<<Ga.SingleFrame._hx_index)?(k.layout|=1<<Ea.SingleFrame._hx_index,e.push(k),l=0):f.push(k);0!=(h.flags&1<<Ga.HasPosition._hx_index)&&(k.layout|=1<<Ea.Position._hx_index,d+=3*l);0!=(h.flags&1<<Ga.HasRotation._hx_index)&&(k.layout|=1<<Ea.Rotation._hx_index,d+=3*l);0!=(h.flags&1<<Ga.HasScale._hx_index)&&(k.layout|=1<<Ea.Scale._hx_index,d+=3*l);0!=(h.flags&1<<
Ga.HasUV._hx_index)&&(k.layout|=1<<Ea.UV._hx_index,d+=2*l);0!=(h.flags&1<<Ga.HasAlpha._hx_index)&&(k.layout|=1<<Ea.Alpha._hx_index,d+=l);if(0!=(h.flags&1<<Ga.HasProps._hx_index))for(var m=0,p=h.props.length;m<p;){var r=m++,n=k;0<r&&(n=c.addObject(h.name,0),0==l?e.push(n):f.push(n));n.layout|=1<<Ea.Property._hx_index;n.propName=h.props[r];d+=l}}for(g=h=0;g<e.length;)b=e[g],++g,b.dataOffset=h,h+=b.getStride();e=h;for(g=0;g<f.length;)b=f[g],++g,b.dataOffset=h,h+=b.getStride();f=this.resource.entry;g=
new S(new ArrayBuffer(4*(d*a.frames+e)));f.readFull(g,this.header.dataPosition+a.dataPosition,g.length);c.setData(new Float32Array(g.b.buffer),d);return c},makeLinearAnimation:function(a){for(var b=new Vf(a.name,a.frames,a.sampling),c=this.resource.entry,d=this.header.dataPosition+a.dataPosition,e=0,f=a.objects;e<f.length;){var g=f[e];++e;var h=0!=(g.flags&1<<Ga.HasPosition._hx_index),k=0!=(g.flags&1<<Ga.HasRotation._hx_index),l=0!=(g.flags&1<<Ga.HasScale._hx_index);if(h||k||l){var m=a.frames;0!=
(g.flags&1<<Ga.SingleFrame._hx_index)&&(m=1);var p=Array(m),r=4*((h?3:0)+(k?3:0)+(l?3:0))*m,n=c.fetchBytes(d,r);d+=r;for(var q=r=0;q<m;){var w=q++,t=new Ph;h?(t.tx=n.getFloat(r),r+=4,t.ty=n.getFloat(r),r+=4,t.tz=n.getFloat(r),r+=4):(t.tx=0,t.ty=0,t.tz=0);if(k){t.qx=n.getFloat(r);r+=4;t.qy=n.getFloat(r);r+=4;t.qz=n.getFloat(r);r+=4;var v=1-(t.qx*t.qx+t.qy*t.qy+t.qz*t.qz);t.qw=0>v?-Math.sqrt(-v):Math.sqrt(v)}else t.qx=0,t.qy=0,t.qz=0,t.qw=1;l?(t.sx=n.getFloat(r),r+=4,t.sy=n.getFloat(r),r+=4,t.sz=n.getFloat(r),
r+=4):(t.sx=1,t.sy=1,t.sz=1);p[w]=t}b.addCurve(g.name,p,!0,k,l)}if(0!=(g.flags&1<<Ga.HasUV._hx_index)){h=Array(2*a.frames);l=8*a.frames;k=c.fetchBytes(d,l);d+=l;l=0;for(p=h.length;l<p;)n=l++,h[n]=k.getFloat(4*n);b.addUVCurve(g.name,h)}if(0!=(g.flags&1<<Ga.HasAlpha._hx_index)){h=Array(a.frames);l=4*a.frames;k=c.fetchBytes(d,l);d+=l;l=0;for(p=h.length;l<p;)n=l++,h[n]=k.getFloat(4*n);b.addAlphaCurve(g.name,h)}if(0!=(g.flags&1<<Ga.HasProps._hx_index))for(h=0,k=g.props;h<k.length;){l=k[h];++h;p=Array(a.frames);
r=4*a.frames;n=c.fetchBytes(d,r);d+=r;r=0;for(q=p.length;r<q;)m=r++,p[m]=n.getFloat(4*m);b.addPropCurve(g.name,l,p)}}return b},loadSkin:function(a,b,c){var d,e;null==c&&(c=!0);if(null==b.vertexWeights){var f=b.bonesPerVertex;if(3!=f&&4!=f)throw t.thrown("assert");var g=4==f;b.vertexCount=a.vertexCount;var h=N.make([new va("position",3),new va("weights",3),new va("indexes",9)]);var k=this.getBuffers(a,h),l=h.stride;b.vertexWeights=Array(b.vertexCount*f);b.vertexJoints=Array(b.vertexCount*f);var m=
0;for(e=b.boundJoints;m<e.length;)h=e[m],++m,h.offsets=new Ka;var p=k.vertexes,r=1E20,n=-1E20,q=1E20,w=-1E20,v=1E20,x=-1E20;if(null==b.splitJoints){a=[];m=0;for(e=b.boundJoints;m<e.length;)h=e[m],++m,a[h.bindIndex]=h;var y=[{index:0,pos:0,count:k.indexes.length,joints:a}]}else{var z=0;var A=[];m=h=0;for(e=a.indexCounts;m<e.length;){var B=e[m];++m;A.push(h);h+=B}m=[];e=0;for(d=b.splitJoints;e<d.length;)h=d[e],++e,m.push({index:z,pos:A[z],count:a.indexCounts[z++],joints:h.joints});y=m}for(m=0;m<y.length;)for(a=
y[m],++m,e=a.pos,d=a.pos+a.count;e<d;){z=e++;z=k.indexes[z];h=z*l;var C=p[h];if(!isNaN(C)){p[h++]=NaN;B=p[h++];A=p[h++];var D=p[h++];var E=p[h++],F=p[h++],H=0;z*=f;b.vertexWeights[z]=D;b.vertexWeights[z+1]=E;b.vertexWeights[z+2]=F;g&&(H=1-D-E-F,b.vertexWeights[z+3]=H);E=(0==D?1:0)|(0==E?2:0)|(0==F?4:0)|(0==H?8:0);F=hb.floatToI32(p[h++]);C<r&&(r=C);C>n&&(n=C);B<q&&(q=B);B>w&&(w=B);A<v&&(v=A);A>x&&(x=A);H=0;for(var J=f;H<J;)h=H++,0!=(E&1<<h)?b.vertexJoints[z++]=-1:(h=a.joints[F>>(h<<3)&255],D=h.offsets,
C<D.xMin&&(D.xMin=C),C>D.xMax&&(D.xMax=C),B<D.yMin&&(D.yMin=B),B>D.yMax&&(D.yMax=B),A<D.zMin&&(D.zMin=A),A>D.zMax&&(D.zMax=A),b.vertexJoints[z++]=h.bindIndex)}}if(c)for(z=b.allJoints.length-1,e=0,m=(n-r)*(w-q)*(x-v);0<=z;)h=b.allJoints[z--],null!=h.offsets&&null!=h.parent&&null!=h.parent.offsets&&(f=h.parent.offsets,D=h.offsets,a=D.xMax-D.xMin,c=D.yMax-D.yMin,g=D.zMax-D.zMin,C=.5*(D.xMin+D.xMax),B=.5*(D.yMin+D.yMax),A=.5*(D.zMin+D.zMax),a=.5*Math.sqrt(a*a+c*c+g*g),null==a&&(a=1),null==A&&(A=0),null==
B&&(B=0),null==C&&(C=0),c=C,C=A,g=a,null==g&&(g=0),null==C&&(C=0),null==B&&(B=0),null==c&&(c=0),a=c,A=B,f.xMin<=a-g&&f.yMin<=A-g&&f.zMin<=C-g&&f.xMax>=a+g&&f.yMax>=A+g&&f.zMax>=C+g?(h.offsets=null,++e):(c=new Ka,c.xMin=f.xMin,c.xMax=f.xMax,c.yMin=f.yMin,c.yMax=f.yMax,c.zMin=f.zMin,c.zMax=f.zMax,B=A,A=g,a-A<c.xMin&&(c.xMin=a-A),a+A>c.xMax&&(c.xMax=a+A),B-A<c.yMin&&(c.yMin=B-A),B+A>c.yMax&&(c.yMax=B+A),C-A<c.zMin&&(c.zMin=C-A),C+A>c.zMax&&(c.zMax=C+A),(c.xMax-c.xMin)*(c.yMax-c.yMin)*(c.zMax-c.zMin)/
((f.xMax-f.xMin)*(f.yMax-f.yMin)*(f.zMax-f.zMin))<Math.sqrt(1.5*m/((c.xMax-c.xMin)*(c.yMax-c.yMin)*(c.zMax-c.zMin)))&&(h.parent.offsets=c,h.offsets=null,++e)));m=0;for(e=b.allJoints;m<e.length;)h=e[m],++m,null==h.offsets?h.offsetRay=-1:(c=h.offsets,C=.5*(c.xMin+c.xMax),B=.5*(c.yMin+c.yMax),A=.5*(c.zMin+c.zMax),null==A&&(A=0),null==B&&(B=0),null==C&&(C=0),a=C,C=A,null==C&&(C=0),null==B&&(B=0),null==a&&(a=0),A=a,z=B,b=C,c.xMax-c.xMin>c.yMax-c.yMin&&c.xMax-c.xMin>c.zMax-c.zMin?(a=c.yMax-c.yMin,A=c.zMax-
c.zMin,a=.5*(a<A?A:a),A=c.xMin+a,B=z,C=b,null==C&&(C=0),null==B&&(B=0),null==A&&(A=0),B=new G(A,B,C),A=c.xMax-a,null==b&&(b=0),null==z&&(z=0),null==A&&(A=0),b=new G(A,z,b)):c.yMax-c.yMin>c.zMax-c.zMin?(a=c.xMax-c.xMin,z=c.zMax-c.zMin,a=.5*(a<z?z:a),z=A,B=c.yMin+a,C=b,null==C&&(C=0),null==B&&(B=0),null==z&&(z=0),B=new G(z,B,C),z=A,A=c.yMax-a,null==b&&(b=0),null==A&&(A=0),null==z&&(z=0),b=new G(z,A,b)):(a=c.xMax-c.xMin,b=c.yMax-c.yMin,a=.5*(a<b?b:a),b=A,B=z,C=c.zMin+a,null==C&&(C=0),null==B&&(B=0),
null==b&&(b=0),B=new G(b,B,C),b=A,A=c.zMax-a,null==A&&(A=0),null==z&&(z=0),null==b&&(b=0),b=new G(b,z,A)),c.xMin=B.x,c.yMin=B.y,c.zMin=B.z,c.xMax=b.x,c.yMax=b.y,c.zMax=b.z,h.offsetRay=a)}},__class__:yi};var Nd=function(a){this.i=a};Nd.__name__="hxd.fmt.hmd.Reader";Nd.prototype={readProperty:function(){var a=this.i.readByte();switch(a){case 0:return xb.CameraFOVY(this.i.readFloat());case 1:throw t.thrown("Obsolete HasMaterialFlags");case 2:return xb.HasExtraTextures;case 3:return xb.FourBonesByVertex;
case 4:return xb.HasLod;case 5:return xb.HasCollider;default:throw t.thrown("Unknown property #"+a);}},readProps:function(){if(1==this.version)return null;var a=this.i.readByte();if(0==a)return null;for(var b=[],c=0;c<a;)c++,b.push(this.readProperty());return b},readName:function(){var a=this.i.readByte();return 255==a?null:this.i.readString(a)},readCachedName:function(){var a=this.readName();if(null==a)return null;null==Nd.HMD_STRINGS&&(Nd.HMD_STRINGS=new Sa);var b=Nd.HMD_STRINGS.h[a];return null!=
b?b:Nd.HMD_STRINGS.h[a]=a},readPosition:function(a){null==a&&(a=!0);var b=new mg;b.x=this.i.readFloat();b.y=this.i.readFloat();b.z=this.i.readFloat();b.qx=this.i.readFloat();b.qy=this.i.readFloat();b.qz=this.i.readFloat();a?(b.sx=this.i.readFloat(),b.sy=this.i.readFloat(),b.sz=this.i.readFloat()):(b.sx=1,b.sy=1,b.sz=1);return b},readBounds:function(){var a=new Ka;a.xMin=this.i.readFloat();a.yMin=this.i.readFloat();a.zMin=this.i.readFloat();a.xMax=this.i.readFloat();a.yMax=this.i.readFloat();a.zMax=
this.i.readFloat();return a},readSkin:function(){var a;var b=this.readCachedName();if(null==b)return null;var c=new ti;c.props=this.readProps();c.name=b;c.joints=[];b=0;for(a=this.i.readUInt16();b<a;){b++;var d=new ri;d.props=this.readProps();d.name=this.readCachedName();var e=this.i.readUInt16(),f=0!=(e&32768);f&&(e&=32767);d.parent=e-1;d.position=this.readPosition(f);d.bind=this.i.readUInt16()-1;0<=d.bind&&(d.transpos=this.readPosition(f));c.joints.push(d)}a=this.i.readByte();if(0<a)for(c.split=
[],b=0;b<a;){b++;d=new si;d.materialIndex=this.i.readByte();e=[];f=0;for(var g=this.i.readByte();f<g;)f++,e.push(this.i.readUInt16());d.joints=e;c.split.push(d)}return c},readLods:function(){for(var a=[],b=0,c=this.i.readInt32();b<c;)b++,a.push(this.i.readInt32());return a},readHeader:function(a){var b;null==a&&(a=!1);var c=new ch;var d=this.i.readString(3);if("HMD"!=d){if(59==F.cca(d,0))throw t.thrown("FBX was not converted to HMD");throw t.thrown("Invalid HMD header "+encodeURIComponent(d));}this.version=
this.i.readByte();if(4<this.version)throw t.thrown("Can't read HMD v"+this.version);c.version=this.version;c.geometries=[];c.dataPosition=this.i.readInt32();a&&(this.i=new Vb(this.i.read(c.dataPosition-12)));c.props=this.readProps();a=0;for(d=this.i.readInt32();a<d;){a++;var e=new ni;e.props=this.readProps();e.vertexCount=this.i.readInt32();var f=this.i.readByte();var g=[];var h=0;for(b=this.i.readByte();h<b;){h++;var k=this.readCachedName();var l=this.i.readByte();g.push(new va(k,l&15,l>>4))}g=N.make(g);
if(f!=g.stride)throw t.thrown("assert");e.vertexFormat=g;e.vertexPosition=this.i.readInt32();g=this.i.readByte();255==g&&(g=this.i.readInt32());l=[];for(f=0;f<g;)f++,l.push(this.i.readInt32());e.indexCounts=l;e.indexPosition=this.i.readInt32();e.bounds=this.readBounds();c.geometries.push(e)}c.materials=[];a=0;for(d=this.i.readInt32();a<d;)a++,b=new qi,b.props=this.readProps(),b.name=this.readName(),b.diffuseTexture=this.readName(),b.blendMode=Nd.BLEND[this.i.readByte()],this.i.readByte(),this.i.readFloat(),
null!=b.props&&0<=b.props.indexOf(xb.HasExtraTextures)&&(b.specularTexture=this.readName(),b.normalMap=this.readName()),c.materials.push(b);c.models=[];e=!1;a=0;for(d=this.i.readInt32();a<d;)if(a++,b=new ui,b.props=this.readProps(),b.name=this.readCachedName(),b.parent=this.i.readInt32()-1,b.follow=this.readCachedName(),b.position=this.readPosition(),b.geometry=this.i.readInt32()-1,c.models.push(b),!(0>b.geometry)){b.materials=[];h=this.i.readByte();255==h&&(h=this.i.readInt32());for(g=0;g<h;)g++,
b.materials.push(this.i.readInt32());b.skin=this.readSkin();null!=b.props&&(b.lods=-1!=b.props.indexOf(xb.HasLod)?this.readLods():null,-1!=b.props.indexOf(xb.HasCollider)&&(b.collider=this.i.readInt32(),e=!0))}c.animations=[];a=0;for(d=this.i.readInt32();a<d;){a++;k=new xi;k.props=this.readProps();k.name=this.readName();k.frames=this.i.readInt32();k.sampling=this.i.readFloat();k.speed=this.i.readFloat();var m=this.i.readByte();k.loop=0!=(m&1);k.dataPosition=this.i.readInt32();k.objects=[];g=0;for(h=
this.i.readInt32();g<h;){g++;var p=new vi;p.name=this.readCachedName();b=this.i.readByte();null==b&&(b=0);p.flags=b;k.objects.push(p);if(0!=(p.flags&1<<Ga.HasProps._hx_index)){b=[];l=0;for(f=this.i.readByte();l<f;)l++,b.push(this.readName());p.props=b}}if(0!=(m&2))for(k.events=[],g=0,h=this.i.readInt32();g<h;)g++,b=new wi,b.frame=this.i.readInt32(),b.data=this.readCachedName(),k.events.push(b);c.animations.push(k)}if(4<=c.version)for(d=this.i.readInt32(),c.shapes=[],a=0;a<d;){a++;m=new oi;m.name=
this.readName();m.geom=this.i.readInt32()-1;m.vertexCount=this.i.readInt32();f=this.i.readByte();g=[];h=0;for(b=this.i.readByte();h<b;)h++,k=this.readCachedName(),l=this.i.readByte(),g.push(new va(k,l&15,l>>4));g=N.make(g);if(f!=g.stride)throw t.thrown("assert");m.vertexFormat=g;m.vertexPosition=this.i.readInt32();m.indexCount=this.i.readInt32();m.remapPosition=this.i.readInt32();c.shapes.push(m)}if(e)for(c.colliders=[],d=this.i.readInt32(),a=0;a<d;){a++;e=new pi;k=this.i.readInt32();g=[];h=0;for(b=
k;h<b;)h++,g.push(this.i.readInt32());e.vertexCounts=g;e.vertexPosition=this.i.readInt32();l=[];f=0;for(g=k;f<g;)f++,l.push(this.i.readInt32());e.indexCounts=l;e.indexPosition=this.i.readInt32();c.colliders.push(e)}return c},read:function(){var a=this.readHeader();a.data=this.i.read(this.i.readInt32());return a},__class__:Nd};var Ef=function(){};Ef.__name__="hxd.fs.FileEntry";Ef.prototype={getBytes:function(){return null},readBytes:function(a,b,c,d){throw t.thrown("readBytes() not implemented");},
fetchBytes:function(a,b){var c=Ef.TMP_BYTES;if(null==c||c.length<b)c=new S(new ArrayBuffer(b+65535&-65536)),Ef.TMP_BYTES=c;this.readFull(c,a,b);return c},readFull:function(a,b,c){if(this.readBytes(a,0,b,c)<c)throw t.thrown(new dd);},getSign:function(){var a=this.fetchBytes(0,4);return a.b[0]|a.b[1]<<8|a.b[2]<<16|a.b[3]<<24},getText:function(){return this.getBytes().toString()},open:function(){return new Ke(this)},load:function(a){if(this.get_isAvailable())null!=a&&a();else throw t.thrown("load() not implemented");
},loadBitmap:function(a){throw t.thrown("loadBitmap() not implemented");},watch:function(a){},exists:function(a){return!1},get:function(a){return null},iterator:function(){return null},get_isAvailable:function(){return!0},get_isDirectory:function(){return!1},get_size:function(){return 0},get_path:function(){throw t.thrown("path() not implemented");},get_directory:function(){var a=this.get_path().lastIndexOf("/");return 0>a?"":F.substr(this.get_path(),0,a)},get_extension:function(){var a=this.name.lastIndexOf(".");
return 0>a?"":F.substr(this.name,a+1,null).toLowerCase()},__class__:Ef};var eh=function(a,b){this.fullPath=a;this.name=a.split("/").pop();this.bytes=b};eh.__name__="hxd.fs.BytesFileEntry";eh.__super__=Ef;eh.prototype=D(Ef.prototype,{get_path:function(){return this.fullPath},getBytes:function(){return this.bytes},readBytes:function(a,b,c,d){c+d>this.bytes.length&&(d=this.bytes.length-c);0>d&&(d=0);a.blit(b,this.bytes,c,d);return d},load:function(a){qe.delay(a,1)},loadBitmap:function(a){switch(ig.extension(this.fullPath).toLowerCase()){case "gif":var b=
"image/gif";break;case "jpeg":case "jpg":b="image/jpeg";break;case "png":b="image/png";break;default:throw t.thrown("Cannot determine image encoding, try adding an extension to the resource path");}var c=new Image;c.onload=function(){a(c)};var d=Yd.encode(this.bytes);c.src="data:"+b+";base64,"+d},exists:function(a){return!1},get:function(a){return null},iterator:function(){return new zi([])},get_size:function(){return this.bytes.length},__class__:eh});var fh=function(){};fh.__name__="hxd.fs.FileSystem";
fh.__isInterface__=!0;fh.prototype={__class__:fh};var ng=function(){};ng.__name__="hxd.fs.BytesFileSystem";ng.__interfaces__=[fh];ng.prototype={getRoot:function(){throw t.thrown("Not implemented");},getBytes:function(a){throw t.thrown("Not implemented");},exists:function(a){return null!=this.getBytes(a)},get:function(a){var b=this.getBytes(a);if(null==b)throw t.thrown("Resource not found '"+a+"'");return new eh(a,b)},dispose:function(){},dir:function(a){throw t.thrown("Not implemented");},__class__:ng};
var Ke=function(a){this.cachePos=this.cacheLen=this.nextReadPos=0;this.entry=a};Ke.__name__="hxd.fs.FileInput";Ke.__super__=Cf;Ke.prototype=D(Cf.prototype,{fetch:function(a){null==a&&(a=256);var b=this.cache;if(null==this.cache||this.cache.length<a)this.cache=Ke.PREFETCH_CACHE,null!=this.cache&&this.cache.length>=a?Ke.PREFETCH_CACHE=null:this.cache=new S(new ArrayBuffer(a));var c=0;0<this.cacheLen&&(c=this.cacheLen,a-=this.cacheLen,this.cache.blit(0,b,this.cachePos,this.cacheLen));a=this.entry.readBytes(this.cache,
c,this.nextReadPos,a);this.cachePos=0;this.cacheLen=c+a;this.nextReadPos+=a;if(0==this.cacheLen)throw t.thrown(new dd);},skip:function(a){if(0<this.cacheLen){var b=this.cacheLen;b=b>a?a:b;this.cachePos+=b;this.cacheLen-=b;a-=b}this.nextReadPos+=a},readByte:function(){0==this.cacheLen&&this.fetch();var a=this.cache.b[this.cachePos++];this.cacheLen--;return a},readBytes:function(a,b,c){var d=0;256>c&&this.cacheLen<c&&this.fetch();if(0<this.cacheLen){var e=this.cacheLen;e=c>e?e:c;a.blit(b,this.cache,
this.cachePos,e);this.cachePos+=e;this.cacheLen-=e;c-=e;if(0==c)return e;b+=e;d+=e}0<c&&(e=this.entry.readBytes(a,b,this.nextReadPos,c),this.nextReadPos+=e,d+=e);return d},close:function(){null!=this.cache&&(null==Ke.PREFETCH_CACHE||Ke.PREFETCH_CACHE.length<this.cache.length)&&(Ke.PREFETCH_CACHE=this.cache);this.cache=null;this.cacheLen=0},__class__:Ke});var fj={_new:function(a){return a},toBitmap:function(a){var b=new Wd(a.width,a.height);b.ctx.drawImage(a,0,0);return b},toNative:function(a){return a}},
Yf=function(a){this.path=a};Yf.__name__="hxd.fs.NotFound";Yf.prototype={toString:function(){return"Resource file not found '"+this.path+"'"},__class__:Yf};var gf=function(){};gf.__name__="hxd.fs.SourceLoader";gf.isActive=function(){return 0<gf.RELOAD_LFS.length};gf.resolve=function(a){for(var b=0,c=gf.RELOAD_LFS;b<c.length;){var d=c[b];++b;try{return d.get(a)}catch(e){if(!(t.caught(e).unwrap()instanceof Yf))throw e;}}return null};var Oc=function(){this.stack=[];var a=dj.callStack();a.shift();for(var b=
0;b<a.length;){var c=a[b];++b;switch(c._hx_index){case 2:var d=c.file;c=c.line;var e=d.indexOf("\\std/");0<e&&(d=F.substr(d,e+5,null));c=d+":"+c;this.stack.push(c);null==this.position&&(e=d.indexOf("/"),d=0>e?"":F.substr(d,0,e),0>Oc.ENGINE_PACKAGES.indexOf(d)&&(this.position=c))}}null==this.position&&(this.position=this.stack[0])};Oc.__name__="hxd.impl.AllocPos";Oc.make=function(){return Oc.ENABLED?new Oc:null};Oc.prototype={__class__:Oc};var Zb=function(){};Zb.__name__="hxd.impl.Allocator";Zb.set=
function(a){Zb.inst=a};Zb.get=function(){null==Zb.inst&&(Zb.inst=new Zb);return Zb.inst};Zb.prototype={toBufferFlags:function(a){switch(a){case 0:return[Ja.Dynamic];case 1:return null;case 2:return[Ja.UniformBuffer,Ja.Dynamic];case 3:return[Ja.UniformBuffer,Ja.ReadWriteBuffer];case 4:return[Ja.UniformBuffer]}},fromBufferFlags:function(a){if(0==a)return 1;if(a==$i.from(Ja.Dynamic))return 0;var b=1<<Ja.UniformBuffer._hx_index|1<<Ja.Dynamic._hx_index;null==b&&(b=0);if(a==b)return 2;b=1<<Ja.UniformBuffer._hx_index|
1<<Ja.ReadWriteBuffer._hx_index;null==b&&(b=0);return a==b?3:a==$i.from(Ja.UniformBuffer)?4:0},allocBuffer:function(a,b,c){null==c&&(c=0);return new hc(a,b,this.toBufferFlags(c))},ofFloats:function(a,b,c){null==c&&(c=0);return this.ofSubFloats(a,Math.ceil(a.pos/b.stride),b,c)},ofSubFloats:function(a,b,c,d){null==d&&(d=0);c=this.allocBuffer(b,c,d);c.uploadFloats(a,0,b);return c},disposeBuffer:function(a){a.dispose()},allocIndexBuffer:function(a,b){null==b&&(b=!1);return jd._new(a,b)},ofIndexes:function(a,
b){null==b&&(b=-1);0>b&&null!=a&&(b=a.length);var c=this.allocIndexBuffer(b);jd.uploadIndexes(c,a,0,b);return c},disposeIndexBuffer:function(a){a.dispose()},onContextLost:function(){},allocFloats:function(a){null==a&&(a=0);return wd._new(a)},disposeFloats:function(a){},allocIndexes:function(a){null==a&&(a=0);return Array(a)},disposeIndexes:function(a){},__class__:Zb};var yg=function(a){this.i=0;this.a=a;this.l=this.a.length};yg.__name__="hxd.impl.ArrayIterator_h2d_Object";yg.prototype={hasNext:function(){return this.i<
this.l},next:function(){return this.a[this.i++]},__class__:yg};var Jh=function(a){this.i=0;this.a=a;this.l=this.a.length};Jh.__name__="hxd.impl.ArrayIterator_h2d_col_IPoint";Jh.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Jh};var Lh=function(a){this.i=0;this.a=a;this.l=this.a.length};Lh.__name__="hxd.impl.ArrayIterator_h2d_col_Point";Lh.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Lh};
var Nh=function(a){this.i=0;this.a=a;this.l=this.a.length};Nh.__name__="hxd.impl.ArrayIterator_h2d_col_Polygon";Nh.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Nh};var Uh=function(a){this.i=0;this.a=a;this.l=this.a.length};Uh.__name__="hxd.impl.ArrayIterator_h3d_scene_Object";Uh.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Uh};var zi=function(a){this.i=0;this.a=a;this.l=this.a.length};
zi.__name__="hxd.impl.ArrayIterator_hxd_fs_FileEntry";zi.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:zi};var Ai=function(a){this.i=0;this.a=a;this.l=this.a.length};Ai.__name__="hxd.impl.ArrayIterator_hxd_res_Any";Ai.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Ai};var Bi=function(a){this.i=0;this.a=a;this.l=this.a.length};Bi.__name__="hxd.impl.ArrayIterator_hxd_snd_Channel";Bi.prototype=
{hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Bi};var Wi={_new:function(a){return new S(new ArrayBuffer(a+7>>3))},get:function(a,b){return 0!=(a.b[b>>3]&1<<(b&7))},set:function(a,b){a.b[b>>3]|=1<<(b&7)},unset:function(a,b){a.b[b>>3]&=~(1<<(b&7))},toggle:function(a,b,c){var d=b>>3,e=a.b[d];b=1<<(b&7);a.b[d]=c?e|b:e&~b},clear:function(a,b){null==b&&(b=!1);a.fill(0,a.length,b?255:0)}},Jc=K["hxd.impl.MouseMode"]={__ename__:!0,__constructs__:null,Absolute:{_hx_name:"Absolute",
_hx_index:0,__enum__:"hxd.impl.MouseMode",toString:v},Relative:(z=function(a,b){return{_hx_index:1,callback:a,restorePos:b,__enum__:"hxd.impl.MouseMode",toString:v}},z._hx_name="Relative",z.__params__=["callback","restorePos"],z),AbsoluteUnbound:(z=function(a){return{_hx_index:2,restorePos:a,__enum__:"hxd.impl.MouseMode",toString:v}},z._hx_name="AbsoluteUnbound",z.__params__=["restorePos"],z)};Jc.__constructs__=[Jc.Absolute,Jc.Relative,Jc.AbsoluteUnbound];Jc.__empty_constructs__=[Jc.Absolute];var gh=
function(a,b){this.path=a;this.bytes=b};gh.__name__="hxd.res._Any.SingleFileSystem";gh.__super__=ng;gh.prototype=D(ng.prototype,{getBytes:function(a){return a==this.path?this.bytes:null},__class__:gh});var Kc=function(a){this.entry=a};Kc.__name__="hxd.res.Resource";Kc.prototype={get_name:function(){return this.entry.name},toString:function(){return this.entry.get_path()},watch:function(a){Kc.LIVE_UPDATE&&this.entry.watch(a)},__class__:Kc};var Le=function(a,b){this.entry=b;this.loader=a};Le.__name__=
"hxd.res.Any";Le.fromBytes=function(a,b){b=new gh(a,b);return(new md(b)).load(a)};Le.__super__=Kc;Le.prototype=D(Kc.prototype,{toModel:function(){return this.loader.loadCache(this.entry.get_path(),hh)},toTexture:function(){return this.toImage().toTexture()},toTile:function(){return this.toImage().toTile()},toText:function(){return this.entry.getText()},toImage:function(){return this.loader.loadCache(this.entry.get_path(),yb)},toSound:function(){return this.loader.loadCache(this.entry.get_path(),je)},
toPrefab:function(){return this.loader.loadCache(this.entry.get_path(),Kc)},toAnimGraph:function(){return this.loader.loadCache(this.entry.get_path(),Kc)},to:function(a){return this.loader.loadCache(this.entry.get_path(),a)},iterator:function(){for(var a=[],b=this.entry.iterator();b.i<b.l;){var c=b.a[b.i++];a.push(new Le(this.loader,c))}return new Ai(a)},__class__:Le});var ke={get_useLoadBitmap:function(a){return 0==a},toInt:function(a){return a},getName:function(a){switch(a){case 0:return"JPG";case 1:return"PNG";
case 2:return"GIF";case 3:return"TGA";case 4:return"DDS";case 5:return"RAW";case 6:return"HDR"}}},cc=K["hxd.res.ImageInfoFlag"]={__ename__:!0,__constructs__:null,IsCube:{_hx_name:"IsCube",_hx_index:0,__enum__:"hxd.res.ImageInfoFlag",toString:v},Dxt10Header:{_hx_name:"Dxt10Header",_hx_index:1,__enum__:"hxd.res.ImageInfoFlag",toString:v}};cc.__constructs__=[cc.IsCube,cc.Dxt10Header];cc.__empty_constructs__=[cc.IsCube,cc.Dxt10Header];var Ci=function(){this.layerCount=1;this.mipOffset=0;this.mipLevels=
1;this.flags=this.width=this.height=0};Ci.__name__="hxd.res.ImageInfo";Ci.prototype={__class__:Ci};var yb=function(a){this.entry=a};yb.__name__="hxd.res.Image";yb.customCheckInfo=function(a){};yb.setupTextureFlags=function(a){};yb.__super__=Kc;yb.prototype=D(Kc.prototype,{getFormat:function(){return this.getInfo().dataFormat},getPixelFormat:function(){return this.getInfo().pixelFormat},getSize:function(){return this.getInfo()},getInfo:function(){if(null!=this.inf)return this.inf;this.inf=new Ci;var a=
this.entry.open();a.fetch(256);try{var b=a.readUInt16()}catch(h){if(t.caught(h).unwrap()instanceof dd)b=0;else throw h;}switch(b){case 16163:for(this.inf.dataFormat=6;""!=a.readLine(););b=a.readLine().split(" ");this.inf.pixelFormat=J.RGBA32F;this.inf.height=y.parseInt(b[1]);this.inf.width=y.parseInt(b[3]);break;case 17476:this.inf.dataFormat=4;a.skip(10);this.inf.height=a.readInt32();this.inf.width=a.readInt32();a.skip(8);this.inf.mipLevels=a.readInt32();a.skip(48);a.readInt32();b=a.readInt32();
var c=a.readInt32();var d=a.readInt32(),e=a.readInt32(),f=a.readInt32(),g=a.readInt32();a.readInt32();65024==(a.readInt32()&65024)&&(this.inf.flags|=1<<cc.IsCube._hx_index);switch(b&16777215){case 0:if(808540228==b){a.skip(12);this.inf.flags|=1<<cc.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=J.RGBA;break;case 71:c=J.S3TC(1);break;case 74:c=J.S3TC(2);break;case 77:c=J.S3TC(3);break;case 95:c=J.S3TC(6);break;case 98:c=J.S3TC(7);break;default:throw t.thrown(this.entry.get_path()+" has unsupported DXGI format "+
c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else switch(c){case 16:if(65535==d)if(0==e)if(0==f)if(0==g)this.inf.pixelFormat=J.R16U;else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));else throw t.thrown("Unsupported RGB DDS "+
c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));break;case 32:switch(d){case 255:if(65280==e)if(16711680==f)if(-16777216==g)this.inf.pixelFormat=J.RGBA;else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));break;case 65535:if(-65536==e)if(0==
f)if(0==g)this.inf.pixelFormat=J.RG16U;else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));break;case 16711680:if(65280==e)if(255==f)if(-16777216==g)this.inf.pixelFormat=J.BGRA;else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+
"/"+X.hex(f)+"/"+X.hex(g));else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));else throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));break;default:throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));}break;default:throw t.thrown("Unsupported RGB DDS "+c+"bits "+X.hex(d)+"/"+X.hex(e)+"/"+X.hex(f)+"/"+X.hex(g));}break;case 36:if(808540228==b){a.skip(12);this.inf.flags|=
1<<cc.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=J.RGBA;break;case 71:c=J.S3TC(1);break;case 74:c=J.S3TC(2);break;case 77:c=J.S3TC(3);break;case 95:c=J.S3TC(6);break;case 98:c=J.S3TC(7);break;default:throw t.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=J.RGBA16U;break;case 111:if(808540228==b){a.skip(12);this.inf.flags|=1<<cc.Dxt10Header._hx_index;c=a.readInt32();
switch(c){case 28:c=J.RGBA;break;case 71:c=J.S3TC(1);break;case 74:c=J.S3TC(2);break;case 77:c=J.S3TC(3);break;case 95:c=J.S3TC(6);break;case 98:c=J.S3TC(7);break;default:throw t.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=J.R16F;break;case 112:if(808540228==b){a.skip(12);this.inf.flags|=1<<cc.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=J.RGBA;break;case 71:c=
J.S3TC(1);break;case 74:c=J.S3TC(2);break;case 77:c=J.S3TC(3);break;case 95:c=J.S3TC(6);break;case 98:c=J.S3TC(7);break;default:throw t.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=J.RG16F;break;case 113:if(808540228==b){a.skip(12);this.inf.flags|=1<<cc.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=J.RGBA;break;case 71:c=J.S3TC(1);break;case 74:c=J.S3TC(2);break;
case 77:c=J.S3TC(3);break;case 95:c=J.S3TC(6);break;case 98:c=J.S3TC(7);break;default:throw t.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=J.RGBA16F;break;case 114:if(808540228==b){a.skip(12);this.inf.flags|=1<<cc.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=J.RGBA;break;case 71:c=J.S3TC(1);break;case 74:c=J.S3TC(2);break;case 77:c=J.S3TC(3);break;case 95:c=J.S3TC(6);
break;case 98:c=J.S3TC(7);break;default:throw t.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=J.R32F;break;case 115:if(808540228==b){a.skip(12);this.inf.flags|=1<<cc.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=J.RGBA;break;case 71:c=J.S3TC(1);break;case 74:c=J.S3TC(2);break;case 77:c=J.S3TC(3);break;case 95:c=J.S3TC(6);break;case 98:c=J.S3TC(7);break;default:throw t.thrown(this.entry.get_path()+
" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=J.RG32F;break;case 116:if(808540228==b){a.skip(12);this.inf.flags|=1<<cc.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=J.RGBA;break;case 71:c=J.S3TC(1);break;case 74:c=J.S3TC(2);break;case 77:c=J.S3TC(3);break;case 95:c=J.S3TC(6);break;case 98:c=J.S3TC(7);break;default:throw t.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=
c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=J.RGBA32F;break;case 4805697:switch((b>>>24)-48){case 1:c=J.S3TC(4);break;case 2:c=J.S3TC(5);break;default:c=null}this.inf.pixelFormat=c;break;case 5527620:switch((b>>>24)-48){case 1:c=J.S3TC(1);break;case 2:case 3:c=J.S3TC(2);break;case 4:case 5:c=J.S3TC(3);break;default:c=null}this.inf.pixelFormat=c;break;default:if(808540228==b){a.skip(12);this.inf.flags|=1<<cc.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=
J.RGBA;break;case 71:c=J.S3TC(1);break;case 74:c=J.S3TC(2);break;case 77:c=J.S3TC(3);break;case 95:c=J.S3TC(6);break;case 98:c=J.S3TC(7);break;default:throw t.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}}if(null==this.inf.pixelFormat)throw a=String.fromCodePoint(b&255)+String.fromCodePoint(b>>8&255)+String.fromCodePoint(b>>16&255)+String.fromCodePoint(b>>>24),(b&255)==b&&(a=""+b),t.thrown(this.entry.get_path()+
" has unsupported 4CC "+a);break;case 18759:this.inf.dataFormat=2;this.inf.pixelFormat=J.BGRA;a.readInt32();this.inf.width=a.readUInt16();this.inf.height=a.readUInt16();break;case 20617:this.inf.dataFormat=1;a.set_bigEndian(!0);for(a.skip(6);;){b=a.readInt32();if(1229472850==a.readInt32()){this.inf.width=a.readInt32();this.inf.height=a.readInt32();b=a.readByte();c=a.readByte();switch(b){case 8:c=J.BGRA;break;case 16:switch(c){case 0:c=J.R16U;break;case 2:c=J.RGBA16U;break;case 4:c=J.RG16U;break;case 6:c=
J.RGBA16U;break;default:throw t.thrown("Unsupported png format "+b+"/"+c+"("+this.entry.get_path()+")");}break;default:throw t.thrown("Unsupported png format "+b+"/"+c+"("+this.entry.get_path()+")");}this.inf.pixelFormat=c;break}a.skip(b+4)}break;case 55551:this.inf.dataFormat=0;this.inf.pixelFormat=J.BGRA;a.set_bigEndian(!0);a:for(;;)switch(a.readUInt16()){case 65472:case 65473:case 65474:a.readUInt16();a.readByte();this.inf.height=a.readUInt16();this.inf.width=a.readUInt16();break a;default:a.skip(a.readUInt16()-
2)}break;default:if("tga"==this.entry.get_extension())this.inf.dataFormat=3,this.inf.pixelFormat=J.ARGB,a.skip(10),this.inf.width=a.readUInt16(),this.inf.height=a.readUInt16();else if("raw"==this.entry.get_extension()){this.inf.dataFormat=5;this.inf.pixelFormat=J.R32F;b=Math.sqrt(this.entry.get_size()>>2)|0;if(this.entry.get_size()!=b*b*4)if(c=Math.sqrt(this.entry.get_size()>>1)|0,this.entry.get_size()==c*c*2)this.inf.pixelFormat=J.R16F,b=c;else throw t.thrown("RAW format does not match 32 bit per components on "+
b+"x"+b);this.inf.width=this.inf.height=b}else throw t.thrown("Unsupported texture format "+this.entry.get_path());}a.close();if(null==this.inf.pixelFormat)throw t.thrown("Unsupported internal format ("+this.entry.get_path()+")");if(0!=yb.MIPMAP_MAX_SIZE&&1<this.inf.mipLevels)for(;0==((this.inf.width|this.inf.height)&7)&&this.inf.width>>1>=yb.MIPMAP_MAX_SIZE&&this.inf.height>>1>=yb.MIPMAP_MAX_SIZE;)this.inf.width>>=1,this.inf.height>>=1,this.inf.mipLevels--,this.inf.mipOffset++;yb.customCheckInfo(this);
return this.inf},getPixels:function(a,b){null==b&&(b=0);switch(this.getInfo().dataFormat){case 0:var c=this.entry.getBytes();if(this.inf.pixelFormat!=J.BGRA)throw t.thrown("No support to decode "+y.string(this.inf.pixelFormat)+" on this platform ("+this.entry.get_path()+")");try{var d=cb.decode(c)}catch(n){throw a=t.caught(n).unwrap(),t.thrown("Failed to decode JPG "+this.entry.get_path()+" ("+y.string(a)+")");}var e=new ta(d.width,d.height,d.pixels,J.BGRA);break;case 1:c=this.entry.getBytes();b=
new Bh(new Vb(c));b.checkCRC=!1;e=ta.alloc(this.inf.width,this.inf.height,this.inf.pixelFormat);var f=b.read();switch(this.inf.pixelFormat._hx_index){case 1:Hb.extract32(f,e.bytes,!1);break;case 18:case 19:case 20:case 21:var g=e.bytes;this.inf.pixelFormat==J.RGBA16U?(b=Hb.getHeader(f).color,b=1==b._hx_index&&0==b.alpha):b=!1;Hb.extract(f,g,b);break;default:throw t.thrown("No support to decode "+y.string(this.inf.pixelFormat)+" on this platform ("+this.entry.get_path()+")");}break;case 2:c=this.entry.getBytes();
b=(new yh(new Vb(c))).read();e=a==J.RGBA?new ta(this.inf.width,this.inf.height,Mc.extractFullRGBA(b,0),J.RGBA):new ta(this.inf.width,this.inf.height,Mc.extractFullBGRA(b,0),J.BGRA);break;case 3:c=this.entry.getBytes();var h=(new Dh(new Vb(c))).read();if(h.header.imageType!=tb.UncompressedTrueColor||32!=h.header.bitsPerPixel)throw t.thrown("Not supported TGA "+y.string(h.header.imageType)+"/"+h.header.bitsPerPixel);f=h.header.width;var k=h.header.height;if(a==J.RGBA)for(e=ta.alloc(f,k,J.RGBA),c=e.bytes,
b=0,g=f*k;b<g;)d=b++,k=h.imageData[d],k=k>>>24|k<<8,c.setInt32(d<<2,k);else for(e=ta.alloc(f,k,J.ARGB),c=ej.fromPixels(e),b=d=0,g=k;b<g;){var l=b++;for(var m=0,p=f;m<p;){var r=m++;k=h.imageData[d++];c.bytes.setInt32((r+l*c.width<<2)+c.offset,k>>>24|k>>8&65280|k<<8&16711680|k<<24)}}switch(h.header.imageOrigin._hx_index){case 0:e.flipY();break;case 2:break;default:throw t.thrown("Not supported "+y.string(h.header.imageOrigin));}break;case 4:e=128;h=0;0!=(this.inf.flags&1<<cc.Dxt10Header._hx_index)&&
(e+=20);b+=this.inf.mipOffset;if(0<b){f=this.inf.mipLevels+this.inf.mipOffset;ta.calcStride(1,this.inf.pixelFormat);c=b/f|0;h=b%f;b=m=0;for(g=f;b<g;)if(d=b++,f=this.inf.width<<this.inf.mipOffset>>d,k=this.inf.height<<this.inf.mipOffset>>d,0==f&&(f=1),0==k&&(k=1),l=ta.calcDataSize(f,k,this.inf.pixelFormat),m+=l,d<h)e+=l;else if(0==c)break;e+=m*c}f=this.inf.width>>h-this.inf.mipOffset;k=this.inf.height>>h-this.inf.mipOffset;0==f&&(f=1);0==k&&(k=1);1==this.inf.mipLevels+this.inf.mipOffset&&0==(this.inf.flags&
1<<cc.IsCube._hx_index)?c=this.entry.getBytes():(l=ta.calcDataSize(f,k,this.inf.pixelFormat),c=new S(new ArrayBuffer(l)),this.entry.readFull(c,e,l),e=0);e=new ta(f,k,c,this.inf.pixelFormat,e);break;case 5:c=this.entry.getBytes();e=new ta(this.inf.width,this.inf.height,c,this.inf.pixelFormat);break;case 6:b=Yi.decode(this.entry.getBytes(),!1),e=new ta(b.width,b.height,b.bytes,this.inf.pixelFormat)}null!=a&&e.convert(a);return e},toBitmap:function(){this.getInfo();var a=new Wd(this.inf.width,this.inf.height),
b=this.getPixels();a.setPixels(b);b.dispose();return a},watchCallb:function(){var a=this.inf;this.inf=null;try{this.getInfo()}catch(c){this.inf=a;return}var b=this.getInfo();a.width==b.width&&a.height==b.height||this.tex.resize(b.width,b.height);this.tex.realloc=null;this.loadTexture()},asyncLoad:function(a){if(null!=this.tex){var b=this.tex;b=null==b.t&&(b.isDepth()||null==b.realloc)}else b=!0;b||(this.tex.dispose(),this.tex.flags&=-1-(1<<P.Loading._hx_index),this.tex.format=this.inf.pixelFormat,
this.tex.width=this.inf.width,this.tex.height=this.inf.height,this.loadTexture(a))},loadTexture:function(a){var b=this;if(0==this.getInfo().dataFormat)this.tex.flags|=1<<P.Loading._hx_index,this.entry.loadBitmap(function(a){a=fj.toBitmap(a);b.tex.alloc();b.tex.uploadBitmap(a);a.ctx=null;a.pixel=null;b.tex.realloc=function(){b.loadTexture()};b.tex.flags&=-1-(1<<P.Loading._hx_index);if(null!=b.tex.waitLoads){a=b.tex.waitLoads;b.tex.waitLoads=null;for(var c=0;c<a.length;){var d=a[c];++c;d()}}yb.ENABLE_AUTO_WATCH&&
b.watch(M(b,b.watchCallb))});else{var c=function(){var c,e;if((b.enableAsyncLoading||0!=(b.tex.flags&1<<P.AsyncLoading._hx_index))&&null==a&&null!=yb.ASYNC_LOADER&&yb.ASYNC_LOADER.isSupported(b))b.tex.dispose(),b.tex.format=J.RGBA,b.tex.width=1,b.tex.height=1,b.tex.customMipLevels=1,b.tex.flags|=1<<P.Loading._hx_index,b.tex.alloc(),b.tex.uploadPixels(yb.BLACK_1x1),b.tex.width=b.inf.width,b.tex.height=b.inf.height,yb.ASYNC_LOADER.load(b),b.tex.realloc=function(){b.loadTexture()};else{var f=F.now()/
1E3;b.tex.customMipLevels=b.inf.mipLevels;b.tex.alloc();if(4==b.inf.dataFormat){var g=128;0!=(b.inf.flags&1<<cc.Dxt10Header._hx_index)&&(g+=20);var h=0;for(c=b.tex.get_layerCount();h<c;){var k=h++;var l=0;for(e=b.inf.mipOffset;l<e;){var m=l++;m=ta.calcDataSize(b.inf.width<<b.inf.mipOffset>>m,b.inf.height<<b.inf.mipOffset>>m,b.inf.pixelFormat);g+=m}e=0;for(l=b.inf.mipLevels;e<l;){m=e++;var p=b.inf.width>>m,r=b.inf.height>>m;0==p&&(p=1);0==r&&(r=1);var n=ta.calcDataSize(p,r,b.inf.pixelFormat),q=null==
a?b.entry.fetchBytes(g,n):a;b.tex.uploadPixels(new ta(p,r,q,b.inf.pixelFormat,null==a?0:g),m,k);g+=n}}}else for(h=0,c=b.tex.get_layerCount();h<c;)for(k=h++,l=0,e=b.inf.mipLevels;l<e;)m=l++,g=b.getPixels(b.tex.format,k*b.inf.mipLevels+m),b.tex.uploadPixels(g,m,k),g.dispose();yb.LOG_TEXTURE_LOAD&&null==a&&(k=1E3*(F.now()/1E3-f),h=b.inf.pixelFormat,22==h._hx_index?(c=h.v,c=!0):c=!1,c=c?"DXT":ke.getName(b.inf.dataFormat),$a.trace(c+" "+(k|0)+"."+(10*k|0)%10+"ms "+b.inf.width+"x"+b.inf.height+" "+b.entry.get_path(),
{fileName:"hxd/res/Image.hx",lineNumber:625,className:"hxd.res.Image",methodName:"loadTexture"}));b.tex.realloc=function(){b.loadTexture()};yb.ENABLE_AUTO_WATCH&&b.watch(M(b,b.watchCallb))}};this.entry.get_isAvailable()?c():this.entry.load(c)}},toTexture:function(){var a=this;if(null!=this.tex)return this.tex;this.getInfo();var b=[P.NoAlloc],c=this.inf.pixelFormat;if(c==J.BGRA||c==J.ARGB||c==J.RGBA)c=W.nativeFormat;0!=(this.inf.flags&1<<cc.IsCube._hx_index)&&b.push(P.Cube);1<this.inf.mipLevels&&(b.push(P.MipMapped),
b.push(P.ManualMipMapGen));this.tex=1<this.inf.layerCount?new Zf(this.inf.width,this.inf.height,this.inf.layerCount,b,c):new W(this.inf.width,this.inf.height,b,c);yb.DEFAULT_FILTER!=fd.Linear&&this.tex.set_filter(yb.DEFAULT_FILTER);this.tex.setName(this.entry.get_path());yb.setupTextureFlags(this.tex);0!=(this.tex.flags&1<<P.IsArray._hx_index)||0==(this.tex.flags&1<<P.LazyLoading._hx_index)?this.loadTexture():this.tex.realloc=function(){a.loadTexture()};return this.tex},toTile:function(){this.getInfo();
return rb.fromTexture(this.toTexture()).sub(0,0,this.inf.width,this.inf.height)},__class__:yb});var md=function(a){this.fs=a;this.cache=new Sa};md.__name__="hxd.res.Loader";md.prototype={cleanCache:function(){this.cache=new Sa},dir:function(a){var b=[];a=this.fs.dir(a);for(var c=0;c<a.length;){var d=a[c];++c;b.push(new Le(this,d))}return b},exists:function(a){return this.fs.exists(a)},load:function(a){return new Le(this,this.fs.get(a))},loadCache:function(a,b){var c=this.cache.h[a];if(null==c){c=
this.fs.get(a);var d=md.currentInstance;md.currentInstance=this;c=da.createInstance(b,[c]);md.currentInstance=d;this.cache.h[a]=c}else if(null==(ka.__downcastCheck(c,b)?c:null))throw t.thrown(a+" has been reintrepreted from "+y.string(ka.getClass(c))+" to "+y.string(b));return c},dispose:function(){this.cleanCache();this.fs.dispose()},__class__:md};var hh=function(a){this.entry=a};hh.__name__="hxd.res.Model";hh.__super__=Kc;hh.prototype=D(Kc.prototype,{toHmd:function(){var a=this.entry.open(),b=(new Nd(a)).readHeader();
a.close();return new yi(this,b)},__class__:hh});var Ff=K["hxd.res.Filter"]={__ename__:!0,__constructs__:null,Fast:{_hx_name:"Fast",_hx_index:0,__enum__:"hxd.res.Filter",toString:v},Chromatic:{_hx_name:"Chromatic",_hx_index:1,__enum__:"hxd.res.Filter",toString:v}};Ff.__constructs__=[Ff.Fast,Ff.Chromatic];Ff.__empty_constructs__=[Ff.Fast,Ff.Chromatic];var og=function(){};og.__name__="hxd.res._NanoJpeg.Component";og.prototype={__class__:og};var cb=function(){this.comps=[new og,new og,new og].slice(0);
this.qtab=[Array(64),Array(64),Array(64),Array(64)].slice(0);this.counts=Array(16);this.block=Array(64);this.njZZ=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63].slice(0);this.vlctab=[null,null,null,null,null,null,null,null].slice(0)};cb.__name__="hxd.res.NanoJpeg";cb.CF=function(a){a=a+64>>7;return 0>a?0:255<a?255:a};cb.njClip=function(a){return 0>a?0:255<a?255:
a};cb.decode=function(a,b,c,d){null==d&&(d=-1);null==c&&(c=0);null==cb.inst&&(cb.inst=new cb);cb.inst.njInit(a,c,d,b);return cb.inst.njDecode()};cb.prototype={alloc:function(a){return new S(new ArrayBuffer(a))},free:function(a){},njInit:function(a,b,c,d){this.bytes=a;this.pos=b;this.filter=null==d?Ff.Chromatic:d;0>c&&(c=a.length-b);null==this.vlctab[0]&&(this.vlctab[0]=new S(new ArrayBuffer(131072)));null==this.vlctab[1]&&(this.vlctab[1]=new S(new ArrayBuffer(131072)));null==this.vlctab[2]&&(this.vlctab[2]=
new S(new ArrayBuffer(131072)));null==this.vlctab[3]&&(this.vlctab[3]=new S(new ArrayBuffer(131072)));this.size=c;this.bufbits=this.buf=this.length=this.rstinterval=this.qtavail=this.qtused=0;this.progressive=!1;this.comps[0].dcpred=0;this.comps[1].dcpred=0;this.comps[2].dcpred=0},cleanup:function(){this.bytes=null;for(var a=0,b=this.comps;a<b.length;){var c=b[a];++a;null!=c.pixels&&(c.pixels=null)}null!=this.vlctab[0]&&(this.vlctab[0]=null);null!=this.vlctab[1]&&(this.vlctab[1]=null);null!=this.vlctab[2]&&
(this.vlctab[2]=null);null!=this.vlctab[3]&&(this.vlctab[3]=null);null!=this.vlctab[4]&&(this.vlctab[4]=null);null!=this.vlctab[5]&&(this.vlctab[5]=null);null!=this.vlctab[6]&&(this.vlctab[6]=null);null!=this.vlctab[7]&&(this.vlctab[7]=null)},njSkip:function(a){this.pos+=a;this.size-=a;this.length-=a},syntax:function(a){},get:function(a){return this.bytes.b[this.pos+a]},njDecode16:function(a){return this.bytes.b[this.pos+a]<<8|this.bytes.b[this.pos+(a+1)]},njByteAlign:function(){this.bufbits&=248},
njShowBits:function(a){if(0==a)return 0;for(;this.bufbits<a;)if(0>=this.size)this.buf=this.buf<<8|255,this.bufbits+=8;else{var b=this.bytes.b[this.pos];this.pos++;this.size--;this.bufbits+=8;this.buf=this.buf<<8|b;if(255==b)switch(b=this.bytes.b[this.pos],this.pos++,this.size--,b){case 217:this.size=0;break;case 0:case 255:break;default:this.buf=this.buf<<8|b,this.bufbits+=8}}return this.buf>>this.bufbits-a&(1<<a)-1},njSkipBits:function(a){this.bufbits<a&&this.njShowBits(a);this.bufbits-=a},njGetBits:function(a){var b=
this.njShowBits(a);this.bufbits-=a;return b},njDecodeLength:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;this.length-=2},njSkipMarker:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;var a=this.length-=2;this.pos+=a;this.size-=a;this.length-=a},njDecodeSOF:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;this.length-=2;8!=this.bytes.b[this.pos]&&
this.notSupported();this.height=this.bytes.b[this.pos+1]<<8|this.bytes.b[this.pos+2];this.width=this.bytes.b[this.pos+3]<<8|this.bytes.b[this.pos+4];this.ncomp=this.bytes.b[this.pos+5];this.pos+=6;this.size-=6;this.length-=6;switch(this.ncomp){case 1:case 3:break;default:this.notSupported()}for(var a=0,b=0,c=0,d=this.ncomp;c<d;){var e=c++;e=this.comps[e];e.cid=this.bytes.b[this.pos];e.ssx=this.bytes.b[this.pos+1]>>4;0!=(e.ssx&e.ssx-1)&&this.notSupported();e.ssy=this.bytes.b[this.pos+1]&15;0!=(e.ssy&
e.ssy-1)&&this.notSupported();e.qtsel=this.bytes.b[this.pos+2];this.pos+=3;this.size-=3;this.length-=3;this.qtused|=1<<e.qtsel;e.ssx>a&&(a=e.ssx);e.ssy>b&&(b=e.ssy)}1==this.ncomp&&(e=this.comps[0],a=b=1,e.ssx=e.ssy=a);this.mbsizex=a<<3;this.mbsizey=b<<3;this.mbwidth=(this.width+this.mbsizex-1)/this.mbsizex|0;this.mbheight=(this.height+this.mbsizey-1)/this.mbsizey|0;c=0;for(d=this.ncomp;c<d;)e=c++,e=this.comps[e],e.width=(this.width*e.ssx+a-1)/a|0,e.stride=e.width+7&2147483640,e.height=(this.height*
e.ssy+b-1)/b|0,e.stride=this.mbwidth*this.mbsizex*e.ssx/a|0,(3>e.width&&e.ssx!=a||3>e.height&&e.ssy!=b)&&this.notSupported(),e.pixels=new S(new ArrayBuffer(e.stride*(this.mbheight*this.mbsizey*e.ssy/b|0)));a=this.length;this.pos+=a;this.size-=a;this.length-=a},njDecodeDQT:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;for(this.length-=2;65<=this.length;){var a=this.bytes.b[this.pos];this.qtavail|=1<<a;a=this.qtab[a];for(var b=0;64>b;){var c=b++;
a[c]=this.bytes.b[this.pos+(c+1)]}this.pos+=65;this.size-=65;this.length-=65}},njDecodeDHT:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;for(this.length-=2;17<=this.length;){var a=this.bytes.b[this.pos];a=a>>4&1|(a&3)<<1;this.counts[0]=this.bytes.b[this.pos+1];this.counts[1]=this.bytes.b[this.pos+2];this.counts[2]=this.bytes.b[this.pos+3];this.counts[3]=this.bytes.b[this.pos+4];this.counts[4]=this.bytes.b[this.pos+5];this.counts[5]=this.bytes.b[this.pos+
6];this.counts[6]=this.bytes.b[this.pos+7];this.counts[7]=this.bytes.b[this.pos+8];this.counts[8]=this.bytes.b[this.pos+9];this.counts[9]=this.bytes.b[this.pos+10];this.counts[10]=this.bytes.b[this.pos+11];this.counts[11]=this.bytes.b[this.pos+12];this.counts[12]=this.bytes.b[this.pos+13];this.counts[13]=this.bytes.b[this.pos+14];this.counts[14]=this.bytes.b[this.pos+15];this.counts[15]=this.bytes.b[this.pos+16];this.pos+=17;this.size-=17;this.length-=17;a=this.vlctab[a];for(var b=0,c=65536,d=65536,
e=1;17>e;){var f=e++;d>>=1;var g=this.counts[f-1];if(0!=g){c-=g<<16-f;for(var h=0,k=g;h<k;){var l=h++;l=this.bytes.b[this.pos+l];for(var m=0,p=d;m<p;)m++,a.b[b++]=f,a.b[b++]=l}this.pos+=g;this.size-=g;this.length-=g}}for(;0!=c--;)a.b[b]=0,b+=2}},njDecodeDRI:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;this.length-=2;this.rstinterval=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];var a=this.length;this.pos+=a;this.size-=a;this.length-=a},njGetVLC:function(a){var b=
this.njShowBits(16),c=a.b[b<<1];this.bufbits<c&&this.njShowBits(c);this.bufbits-=c;this.vlcCode=b=a.b[b<<1|1];c=b&15;if(0==c)return 0;a=this.njShowBits(c);this.bufbits-=c;b=a;b<1<<c-1&&(b+=(-1<<c)+1);return b},njRowIDCT:function(a){var b=this.block[a+4]<<11,c=this.block[a+6],d=this.block[a+2],e=this.block[a+1],f=this.block[a+7],g=this.block[a+5],h=this.block[a+3];if(0==(b|c|d|e|f|g|h))b=this.block[a+7]=this.block[a]<<3,b=this.block[a+6]=b,b=this.block[a+5]=b,b=this.block[a+4]=b,b=this.block[a+3]=
b,b=this.block[a+2]=b,b=this.block[a+1]=b,this.block[a]=b;else{var k=(this.block[a]<<11)+128,l=565*(e+f);e=l+2276*e;f=l-3406*f;l=2408*(g+h);g=l-799*g;h=l-4017*h;l=k+b;k-=b;b=1108*(d+c);c=b-3784*c;d=b+1568*d;b=e+g;e-=g;g=f+h;f-=h;h=l+d;l-=d;d=k+c;k-=c;c=181*(e+f)+128>>8;e=181*(e-f)+128>>8;this.block[a]=h+b>>8;this.block[a+1]=d+c>>8;this.block[a+2]=k+e>>8;this.block[a+3]=l+g>>8;this.block[a+4]=l-g>>8;this.block[a+5]=k-e>>8;this.block[a+6]=d-c>>8;this.block[a+7]=h-b>>8}},njColIDCT:function(a,b,c,d){var e=
this.block[a+32]<<8,f=this.block[a+48],g=this.block[a+16],h=this.block[a+8];var k=this.block[a+56];var l=this.block[a+40],m=this.block[a+24];if(0==(e|f|g|h|k|l|m))k=(this.block[a]+32>>6)+128,e=0>k?0:255<k?255:k,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,b.b[c+d]=e;else{a=(this.block[a]<<8)+8192;var p=565*(h+k)+4;h=p+2276*h>>3;k=p-3406*k>>3;p=2408*(l+m)+4;l=p-799*l>>3;m=p-4017*m>>3;p=a+e;a-=e;e=1108*(g+f)+4;f=e-3784*f>>3;g=e+1568*g>>3;e=h+l;h-=l;l=
k+m;k-=m;m=p+g;p-=g;g=a+f;a-=f;f=181*(h+k)+128>>8;h=181*(h-k)+128>>8;k=(m+e>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(g+f>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(a+h>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(p+l>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(p-l>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(a-h>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(g-f>>14)+128;b.b[c]=0>k?0:255<k?255:k;k=(m-e>>14)+128;b.b[c+d]=0>k?0:255<k?255:k}},njDecodeBlock:function(a,b){var c,d,e=a.pixels;for(d=c=0;64>d;){var f=
d++;this.block[f]=0}var g=a.dcpred,h=this.vlctab[a.dctabsel];f=this.njShowBits(16);d=h.b[f<<1];this.bufbits<d&&this.njShowBits(d);this.bufbits-=d;this.vlcCode=f=h.b[f<<1|1];d=f&15;0==d?d=0:(f=this.njShowBits(d),this.bufbits-=d,f<1<<d-1&&(f+=(-1<<d)+1),d=f);a.dcpred=g+d;g=this.qtab[a.qtsel];h=this.vlctab[a.actabsel];this.block[0]=a.dcpred*g[0];do{f=this.njShowBits(16);d=h.b[f<<1];this.bufbits<d&&this.njShowBits(d);this.bufbits-=d;this.vlcCode=f=h.b[f<<1|1];d=f&15;0==d?d=0:(f=this.njShowBits(d),this.bufbits-=
d,f<1<<d-1&&(f+=(-1<<d)+1),d=f);if(0==this.vlcCode)break;c+=(this.vlcCode>>4)+1;this.block[this.njZZ[c]]=d*g[c]}while(63>c);var k=0;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];var l=this.block[k+1];var m=this.block[k+7];var p=this.block[k+5],r=this.block[k+3];0==(f|g|h|l|m|p|r)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+
m),l=d+2276*l,m=d-3406*m,d=2408*(p+r),p=d-799*p,r=d-4017*r,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=r+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=r-f>>8);k=8;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];r=this.block[k+
3];0==(f|g|h|l|m|p|r)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+r),p=d-799*p,r=d-4017*r,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=r+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=
d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=r-f>>8);k=16;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];r=this.block[k+3];0==(f|g|h|l|m|p|r)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+r),
p=d-799*p,r=d-4017*r,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=r+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=r-f>>8);k=24;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];r=this.block[k+3];0==(f|g|h|l|m|p|r)?(c=this.block[k+
7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+r),p=d-799*p,r=d-4017*r,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=r+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+
5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=r-f>>8);k=32;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];r=this.block[k+3];0==(f|g|h|l|m|p|r)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+r),p=d-799*p,r=d-4017*r,d=c+f,c-=f,f=1108*(h+g),
g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=r+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=r-f>>8);k=40;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];r=this.block[k+3];0==(f|g|h|l|m|p|r)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+
5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+r),p=d-799*p,r=d-4017*r,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=r+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=r-
f>>8);k=48;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];r=this.block[k+3];0==(f|g|h|l|m|p|r)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+r),p=d-799*p,r=d-4017*r,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+r,m-=r,r=d+h,
d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=r+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=r-f>>8);k=56;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];r=this.block[k+3];0==(f|g|h|l|m|p|r)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+
3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+r),p=d-799*p,r=d-4017*r,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=r+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=r-f>>8);k=b;var n=a.stride;f=this.block[32]<<
8;g=this.block[48];h=this.block[16];l=this.block[8];m=this.block[56];p=this.block[40];r=this.block[24];0==(f|g|h|l|m|p|r)?(m=(this.block[0]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[0]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+r)+4,p=d-799*p>>3,r=d-4017*r>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>
8,l=181*(l-m)+128>>8,m=(r+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(r-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=1+b;n=a.stride;f=this.block[33]<<8;g=this.block[49];h=this.block[17];l=this.block[9];m=this.block[57];p=this.block[41];
r=this.block[25];0==(f|g|h|l|m|p|r)?(m=(this.block[1]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[1]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+r)+4,p=d-799*p>>3,r=d-4017*r>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(r+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=
0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(r-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=2+b;n=a.stride;f=this.block[34]<<8;g=this.block[50];h=this.block[18];l=this.block[10];m=this.block[58];p=this.block[42];r=this.block[26];0==(f|g|h|l|m|p|r)?(m=(this.block[2]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=
f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[2]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+r)+4,p=d-799*p>>3,r=d-4017*r>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(r+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=
0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(r-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=3+b;n=a.stride;f=this.block[35]<<8;g=this.block[51];h=this.block[19];l=this.block[11];m=this.block[59];p=this.block[43];r=this.block[27];0==(f|g|h|l|m|p|r)?(m=(this.block[3]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+
n]=f):(c=(this.block[3]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+r)+4,p=d-799*p>>3,r=d-4017*r>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(r+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=
0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(r-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=4+b;n=a.stride;f=this.block[36]<<8;g=this.block[52];h=this.block[20];l=this.block[12];m=this.block[60];p=this.block[44];r=this.block[28];0==(f|g|h|l|m|p|r)?(m=(this.block[4]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[4]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+r)+
4,p=d-799*p>>3,r=d-4017*r>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(r+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(r-f>>14)+128,e.b[k+
n]=0>m?0:255<m?255:m);k=5+b;n=a.stride;f=this.block[37]<<8;g=this.block[53];h=this.block[21];l=this.block[13];m=this.block[61];p=this.block[45];r=this.block[29];0==(f|g|h|l|m|p|r)?(m=(this.block[5]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[5]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+r)+4,p=d-799*p>>3,r=d-4017*r>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=
l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(r+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(r-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=6+b;n=a.stride;f=this.block[38]<<8;g=this.block[54];h=this.block[22];
l=this.block[14];m=this.block[62];p=this.block[46];r=this.block[30];0==(f|g|h|l|m|p|r)?(m=(this.block[6]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[6]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+r)+4,p=d-799*p>>3,r=d-4017*r>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(r+f>>14)+128,
e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(r-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=7+b;n=a.stride;f=this.block[39]<<8;g=this.block[55];h=this.block[23];l=this.block[15];m=this.block[63];p=this.block[47];r=this.block[31];0==(f|g|h|l|m|p|r)?
(m=(this.block[7]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[7]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+r)+4,p=d-799*p>>3,r=d-4017*r>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+r,m-=r,r=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(r+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>
14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(r-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m)},notSupported:function(){throw t.thrown("This JPG file is not supported");},njDecodeScan:function(){var a;this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;this.length-=2;this.bytes.b[this.pos]!=this.ncomp&&
this.notSupported();this.pos+=1;--this.size;--this.length;var b=0;for(a=this.ncomp;b<a;){var c=b++;c=this.comps[c];c.dctabsel=this.bytes.b[this.pos+1]>>4<<1;c.actabsel=(this.bytes.b[this.pos+1]&3)<<1|1;this.pos+=2;this.size-=2;this.length-=2}a=this.bytes.b[this.pos];b=this.bytes.b[this.pos+1];var d=this.bytes.b[this.pos+2];(!this.progressive&&0!=a||b!=63-a||0!=d)&&this.notSupported();b=this.length;this.pos+=b;this.size-=b;this.length-=b;for(var e=d=0,f=this.rstinterval;;){b=0;for(a=this.ncomp;b<a;){c=
b++;c=this.comps[c];for(var g=0,h=c.ssy;g<h;)for(var k=g++,l=0,m=c.ssx;l<m;){var p=l++;this.njDecodeBlock(c,(e*c.ssy+k)*c.stride+d*c.ssx+p<<3)}}if(++d>=this.mbwidth&&(d=0,++e>=this.mbheight))break;0!=this.rstinterval&&0==--f&&(this.bufbits&=248,this.njShowBits(16),this.bufbits-=16,f=this.rstinterval,this.comps[0].dcpred=0,this.comps[1].dcpred=0,this.comps[2].dcpred=0)}},njUpsampleH:function(a){for(var b=a.width-3,c=new S(new ArrayBuffer(a.width*a.height<<1)),d=a.pixels,e=0,f=0,g=0,h=a.height;g<h;){g++;
var k=139*d.b[e]+-11*d.b[e+1]+64>>7;c.b[f]=0>k?0:255<k?255:k;k=104*d.b[e]+27*d.b[e+1]+-3*d.b[e+2]+64>>7;c.b[f+1]=0>k?0:255<k?255:k;k=28*d.b[e]+109*d.b[e+1]+-9*d.b[e+2]+64>>7;c.b[f+2]=0>k?0:255<k?255:k;k=0;for(var l=b;k<l;){var m=k++,p=-9*d.b[e+m]+111*d.b[e+m+1]+29*d.b[e+m+2]+-3*d.b[e+m+3]+64>>7;c.b[f+(m<<1)+3]=0>p?0:255<p?255:p;p=-3*d.b[e+m]+29*d.b[e+m+1]+111*d.b[e+m+2]+-9*d.b[e+m+3]+64>>7;c.b[f+(m<<1)+4]=0>p?0:255<p?255:p}e+=a.stride;f+=a.width<<1;k=28*d.b[e-1]+109*d.b[e-2]+-9*d.b[e-3]+64>>7;c.b[f-
3]=0>k?0:255<k?255:k;k=104*d.b[e-1]+27*d.b[e-2]+-3*d.b[e-3]+64>>7;c.b[f-2]=0>k?0:255<k?255:k;k=139*d.b[e-1]+-11*d.b[e-2]+64>>7;c.b[f-1]=0>k?0:255<k?255:k}a.width<<=1;a.stride=a.width;a.pixels=c},njUpsampleV:function(a){for(var b=a.width,c=a.stride,d=c+c,e=new S(new ArrayBuffer(a.width*a.height<<1)),f,g,h=a.pixels,k=0;k<b;){f=g=k++;var l=139*h.b[f]+-11*h.b[f+c]+64>>7;e.b[g]=0>l?0:255<l?255:l;g+=b;l=104*h.b[f]+27*h.b[f+c]+-3*h.b[f+d]+64>>7;e.b[g]=0>l?0:255<l?255:l;g+=b;l=28*h.b[f]+109*h.b[f+c]+-9*h.b[f+
d]+64>>7;e.b[g]=0>l?0:255<l?255:l;g+=b;f+=c;l=0;for(var m=a.height-2;l<m;){l++;var p=-9*h.b[f-c]+111*h.b[f]+29*h.b[f+c]+-3*h.b[f+d]+64>>7;e.b[g]=0>p?0:255<p?255:p;g+=b;p=-3*h.b[f-c]+29*h.b[f]+111*h.b[f+c]+-9*h.b[f+d]+64>>7;e.b[g]=0>p?0:255<p?255:p;g+=b;f+=c}f+=c;l=28*h.b[f]+109*h.b[f-c]+-9*h.b[f-d]+64>>7;e.b[g]=0>l?0:255<l?255:l;g+=b;l=104*h.b[f]+27*h.b[f-c]+-3*h.b[f-d]+64>>7;e.b[g]=0>l?0:255<l?255:l;g+=b;f=139*h.b[f]+-11*h.b[f-c]+64>>7;e.b[g]=0>f?0:255<f?255:f}a.height<<=1;a.stride=a.width;a.pixels=
e},njUpsample:function(a){for(var b=0,c=0;a.width<this.width;)a.width<<=1,++b;for(;a.height<this.height;)a.height<<=1,++c;for(var d=new S(new ArrayBuffer(a.width*a.height)),e=a.pixels,f=0,g=0,h=a.height;g<h;)for(var k=(g++>>c)*a.stride,l=0,m=a.width;l<m;){var p=l++;d.b[f++]=e.b[(p>>b)+k]}a.stride=a.width;a.pixels=d},njConvert:function(){var a;var b=0;for(a=this.ncomp;b<a;){var c=b++;c=this.comps[c];switch(this.filter._hx_index){case 0:(c.width<this.width||c.height<this.height)&&this.njUpsample(c);
break;case 1:for(;c.width<this.width||c.height<this.height;)c.width<this.width&&this.njUpsampleH(c),c.height<this.height&&this.njUpsampleV(c)}if(c.width<this.width||c.height<this.height)throw t.thrown("assert");}c=new S(new ArrayBuffer(this.width*this.height*4));if(3==this.ncomp){var d=this.comps[0].pixels,e=this.comps[1].pixels,f=this.comps[2].pixels,g=0,h=0,k=0,l=0;b=0;for(a=this.height;b<a;){b++;for(var m=0,p=this.width;m<p;){m++;var r=d.b[g++]<<8,n=e.b[h++]-128,q=f.b[k++]-128,w=r+359*q+128>>8;
w=0>w?0:255<w?255:w;q=r-88*n-183*q+128>>8;q=0>q?0:255<q?255:q;r=r+454*n+128>>8;r=0>r?0:255<r?255:r;c.b[l++]=r;c.b[l++]=q;c.b[l++]=w;c.b[l++]=255}g+=this.comps[0].stride-this.width;h+=this.comps[1].stride-this.width;k+=this.comps[2].stride-this.width}}else throw t.thrown("TODO");return c},njDecode:function(){if(2>this.size||255!=this.bytes.b[this.pos]||216!=this.bytes.b[this.pos+1])throw t.thrown("This file is not a JPEG");this.pos+=2;this.size-=2;this.length-=2;a:for(;;)switch(this.pos+=2,this.size-=
2,this.length-=2,this.bytes.b[this.pos+-1]){case 192:this.njDecodeSOF();break;case 194:throw this.progressive=!0,t.thrown("Unsupported progressive JPG");null==this.vlctab[4]&&(this.vlctab[4]=new S(new ArrayBuffer(131072)));null==this.vlctab[5]&&(this.vlctab[5]=new S(new ArrayBuffer(131072)));null==this.vlctab[6]&&(this.vlctab[6]=new S(new ArrayBuffer(131072)));null==this.vlctab[7]&&(this.vlctab[7]=new S(new ArrayBuffer(131072)));this.njDecodeSOF();break;case 195:throw t.thrown("Unsupported lossless JPG");
case 196:this.njDecodeDHT();break;case 218:this.njDecodeScan();break a;case 219:this.njDecodeDQT();break;case 221:this.njDecodeDRI();break;case 254:this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;var a=this.length-=2;this.pos+=a;this.size-=a;this.length-=a;break;default:switch(this.bytes.b[this.pos+-1]&240){case 192:throw t.thrown("Unsupported jpeg type "+(this.bytes.b[this.pos+-1]&15));case 224:this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];
this.pos+=2;this.size-=2;a=this.length-=2;this.pos+=a;this.size-=a;this.length-=a;break;default:throw t.thrown("Unsupported jpeg tag 0x"+X.hex(this.bytes.b[this.pos+-1],2));}}a=this.njConvert();this.cleanup();return{pixels:a,width:this.width,height:this.height}},__class__:cb};var Me=K["hxd.res.SoundFormat"]={__ename__:!0,__constructs__:null,Wav:{_hx_name:"Wav",_hx_index:0,__enum__:"hxd.res.SoundFormat",toString:v},Mp3:{_hx_name:"Mp3",_hx_index:1,__enum__:"hxd.res.SoundFormat",toString:v},OggVorbis:{_hx_name:"OggVorbis",
_hx_index:2,__enum__:"hxd.res.SoundFormat",toString:v}};Me.__constructs__=[Me.Wav,Me.Mp3,Me.OggVorbis];Me.__empty_constructs__=[Me.Wav,Me.Mp3,Me.OggVorbis];var je=function(a){this.lastPlay=0;this.entry=a};je.__name__="hxd.res.Sound";je.supportedFormat=function(a){switch(a._hx_index){case 0:case 1:return!0;case 2:return!1}};je.startWorker=function(){return!1};je.__super__=Kc;je.prototype=D(Kc.prototype,{getData:function(){if(null!=this.data)return this.data;var a=this.entry.getBytes();switch(a.b[0]){case 73:case 255:this.data=
new ih(a);break;case 79:throw t.thrown("OGG format requires -lib stb_ogg_sound (for "+this.entry.get_path()+")");case 82:this.data=new pg(a)}if(null==this.data)throw t.thrown("Unsupported sound format "+this.entry.get_path());je.ENABLE_AUTO_WATCH&&this.watch(M(this,this.watchCallb));return this.data},dispose:function(){this.stop();this.data=null},stop:function(){null!=this.channel&&(this.channel.stop(),this.channel=null)},play:function(a,b,c,d){null==b&&(b=1);null==a&&(a=!1);this.lastPlay=F.now()/
1E3;this.channel=La.get().play(this,c,d);this.channel.loop=a;this.channel.set_volume(b);return this.channel},watchCallb:function(){var a=this.data;this.data=null;var b=this.getData();if(null!=a&&(a.channels!=b.channels||a.samples!=b.samples||a.sampleFormat!=b.sampleFormat||a.samplingRate!=b.samplingRate))for(a=La.get().getAll(this);a.hasNext();){var c=a.next();c.duration=b.get_duration();c.set_position(c.position)}},__class__:je});var Ne=function(){this.volume=1;this.bindedEffects=[];this.effects=
[];this.mute=!1;this.priority=0};Ne.__name__="hxd.snd.ChannelBase";Ne.prototype={getEffect:function(a){if(null==this.effects)return null;for(var b=0,c=this.effects;b<c.length;){var d=c[b];++b;d=ka.__downcastCheck(d,a)?d:null;if(null!=d)return d}return null},set_volume:function(a){this.currentFade=null;return this.volume=a},fadeTo:function(a,b,c){null==b&&(b=1);this.currentFade={start:F.now()/1E3,duration:b,startVolume:this.volume,targetVolume:a,onEnd:c}},updateCurrentVolume:function(a){if(null!=this.currentFade){var b=
this.currentFade;a-=b.start;if(a>=b.duration){if(this.set_volume(b.targetVolume),null!=b.onEnd)b.onEnd()}else this.set_volume(b.startVolume+a/b.duration*(b.targetVolume-b.startVolume)),this.currentFade=b}this.currentVolume=this.volume},addEffect:function(a){if(null==a)throw t.thrown("Can't add null effect");if(0<=this.effects.indexOf(a))throw t.thrown("effect already added on this channel");this.effects.push(a);return a},removeEffect:function(a){F.remove(this.effects,a)},__class__:Ne};var Gf=function(){this.queue=
[];this.isVirtual=this.isLoading=this.positionChanged=!1;this.lastStamp=0;this.audibleVolume=1;this.allowVirtual=!0;this.pause=this.loop=!1;this.position=0;Ne.call(this);this.id=Gf.ID++};Gf.__name__="hxd.snd.Channel";Gf.__super__=Ne;Gf.prototype=D(Ne.prototype,{onEnd:function(){},set_position:function(a){this.lastStamp=F.now()/1E3;this.positionChanged=!0;a>this.duration?a=this.duration:0>a&&(a=0);return this.position=a},set_pause:function(a){a||(this.lastStamp=F.now()/1E3);return this.pause=a},updateCurrentVolume:function(a){if(this.pause&&
null!=this.currentFade){var b=this.currentFade;this.currentFade=null;this.updateCurrentVolume(a);this.currentFade=b}Ne.prototype.updateCurrentVolume.call(this,a);this.channelGroup.updateCurrentVolume(a);this.currentVolume=this.currentVolume*this.channelGroup.currentVolume*this.soundGroup.volume;if(null!=this.manager){b=0;for(var c=this.channelGroup.effects;b<c.length;)a=c[b],++b,this.currentVolume*=a.getVolumeModifier();b=0;for(c=this.effects;b<c.length;)a=c[b],++b,this.currentVolume*=a.getVolumeModifier()}},
calcAudibleVolume:function(a){this.updateCurrentVolume(a);this.audibleVolume=this.currentVolume;if(null!=this.manager){for(var b=0,c=this.channelGroup.effects;b<c.length;)a=c[b],++b,this.audibleVolume=a.applyAudibleVolumeModifier(this.audibleVolume);b=0;for(c=this.effects;b<c.length;)a=c[b],++b,this.audibleVolume=a.applyAudibleVolumeModifier(this.audibleVolume)}},queueSound:function(a){this.queue.push(a)},stop:function(){null!=this.manager&&this.manager.releaseChannel(this)},isReleased:function(){return null==
this.manager},__class__:Gf});var jh=function(a){Ne.call(this);this.name=a};jh.__name__="hxd.snd.ChannelGroup";jh.__super__=Ne;jh.prototype=D(Ne.prototype,{__class__:jh});var Qb=K["hxd.snd.SampleFormat"]={__ename__:!0,__constructs__:null,UI8:{_hx_name:"UI8",_hx_index:0,__enum__:"hxd.snd.SampleFormat",toString:v},I16:{_hx_name:"I16",_hx_index:1,__enum__:"hxd.snd.SampleFormat",toString:v},F32:{_hx_name:"F32",_hx_index:2,__enum__:"hxd.snd.SampleFormat",toString:v}};Qb.__constructs__=[Qb.UI8,Qb.I16,Qb.F32];
Qb.__empty_constructs__=[Qb.UI8,Qb.I16,Qb.F32];var le=function(){};le.__name__="hxd.snd.Data";le.formatBytes=function(a){switch(a._hx_index){case 0:return 1;case 1:return 2;case 2:return 4}};le.prototype={isLoading:function(){return!1},decode:function(a,b,c,d){var e=this.getBytesPerSample();if(0>c||0>d||0>b||b+d*e>a.length)throw b="sampleStart = "+c+(" sampleCount = "+d)+(" outPos = "+b),b+=" bpp = "+e,b+=" out.length = "+a.length,t.thrown(b);if(c+d>=this.samples){var f=0;c<this.samples&&(f=this.samples-
c,this.decodeBuffer(a,b,c,f));a.fill(b+f*e,(d-f)*e,0)}else this.decodeBuffer(a,b,c,d)},resample:function(a,b,c){if(this.sampleFormat==b&&this.samplingRate==a&&this.channels==c)return this;var d=Math.ceil(a/this.samplingRate*this.samples),e=this.getBytesPerSample();e=new S(new ArrayBuffer(e*this.samples));this.decodeBuffer(e,0,0,this.samples);switch(b._hx_index){case 0:var f=1;break;case 1:f=2;break;case 2:f=4}f=new S(new ArrayBuffer(c*d*f));this.resampleBuffer(f,0,e,0,a,b,c,this.samples);e=new pg(null);
e.channels=c;e.samples=d;e.sampleFormat=b;e.samplingRate=a;e.rawData=f;return e},resampleBuffer:function(a,b,c,d,e,f,g,h){var k=this.getBytesPerSample(),l=Math.ceil(e/this.samplingRate*h),m=h!=l;if(m||this.sampleFormat!=Qb.I16||f!=Qb.I16||1!=g||2!=this.channels){e=this.channels;var p=g<e?g:e,r=g-p,n=0,q=0;e=0;for(g=l;e<g;){var w=e++;w=w/(l-1)*(h-1);var t=w|0;w-=t;var v=d+t*k;t==h-1&&(m=!1);t=0;for(var x=p;t<x;){t++;n=0;switch(this.sampleFormat._hx_index){case 0:var y=c.b[v]/255;m&&(n=c.b[v+k]/255);
++v;break;case 1:y=c.getUInt16(v);y=(0==(y&32768)?y:y|-65536)/32768;m&&(n=c.getUInt16(v+k),n=(0==(n&32768)?n:n|-65536)/32768);v+=2;break;case 2:y=c.getFloat(v),m&&(n=c.getFloat(v+k)),v+=4}n=m?y+w*(n-y):y;switch(f._hx_index){case 0:q=128*(n+1)|0;255<q&&(q=255);a.b[b++]=q;break;case 1:q=32768*n|0;32767<q&&(q=32767);q&=65535;a.setUInt16(b,q);b+=2;break;case 2:a.setFloat(b,n),b+=4}}w=0;for(v=r;w<v;)switch(w++,f._hx_index){case 0:a.b[b++]=q;break;case 1:a.setUInt16(b,q);b+=2;break;case 2:a.setFloat(b,
n),b+=4}}}else for(e=0,g=h;e<g;)e++,h=c.getUInt16(d),d+=2,f=c.getUInt16(d),d+=2,32768<=(h^f)?(0!=(h&32768)&&(h|=-65536),0!=(f&32768)&&(f|=-65536),h=h+f>>1&65535):h=h+f>>1,a.setUInt16(b,h),b+=2},decodeBuffer:function(a,b,c,d){throw t.thrown("Not implemented");},getBytesPerSample:function(){switch(this.sampleFormat._hx_index){case 0:var a=1;break;case 1:a=2;break;case 2:a=4}return this.channels*a},load:function(a){a()},get_duration:function(){return this.samples/this.samplingRate},__class__:le};var Oe=
function(){};Oe.__name__="hxd.snd.EffectDriver";Oe.prototype={acquire:function(){},release:function(){},update:function(a){},bind:function(a,b){},apply:function(a,b){},unbind:function(a,b){},__class__:Oe};var kh=K["hxd.snd.DriverFeature"]={__ename__:!0,__constructs__:null,MasterVolume:{_hx_name:"MasterVolume",_hx_index:0,__enum__:"hxd.snd.DriverFeature",toString:v}};kh.__constructs__=[kh.MasterVolume];kh.__empty_constructs__=[kh.MasterVolume];var lh=function(){};lh.__name__="hxd.snd.Driver";lh.__isInterface__=
!0;lh.prototype={__class__:lh};var $d=function(a){this.lastStamp=this.retainTime=this.priority=this.refs=0;var b=La.get().driver;null!=b&&(this.driver=b.getEffectDriver(a))};$d.__name__="hxd.snd.Effect";$d.prototype={applyAudibleVolumeModifier:function(a){return a},getVolumeModifier:function(){return 1},__class__:$d};var Di=function(){this.position=new G(0,0,0);this.velocity=new G(0,0,0);var a=1,b=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.direction=new G(a,b,c);b=a=0;c=1;null==c&&(c=
0);null==b&&(b=0);null==a&&(a=0);this.up=new G(a,b,c)};Di.__name__="hxd.snd.Listener";Di.prototype={syncCamera:function(a){var b=this.position,c=a.pos;b.x=c.x;b.y=c.y;b.z=c.z;b=this.direction;c=a.target.x-a.pos.x;var d=a.target.y-a.pos.y,e=a.target.z-a.pos.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.direction;c=b.x*b.x+b.y*b.y+b.z*b.z;c=1E-20>c?0:1/Math.sqrt(c);b.x*=c;b.y*=c;b.z*=c;b=this.up;c=a.up;b.x=c.x;b.y=c.y;b.z=c.z},__class__:Di};var qg=function(a){this.start=0;
this.playing=!1;this.volume=-1;this.id=qg.ID++;this.handle=a.createSource();this.buffers=[]};qg.__name__="hxd.snd.Source";qg.prototype={dispose:function(){La.get().driver.destroySource(this.handle)},__class__:qg};var mh=function(a){this.end=0;this.handle=a.createBuffer();this.refs=0;this.lastStop=F.now()/1E3};mh.__name__="hxd.snd.Buffer";mh.prototype={dispose:function(){La.get().driver.destroyBuffer(this.handle)},__class__:mh};var La=function(){this.suspended=!1;this.timeOffset=0;try{this.driver=
new nh}catch(c){if("string"==typeof t.caught(c).unwrap())this.driver=null;else throw c;}this.masterVolume=1;this.hasMasterVolume=null==this.driver?!0:this.driver.hasFeature(kh.MasterVolume);this.masterSoundGroup=new Ei("master");this.masterChannelGroup=new jh("master");this.listener=new Di;this.soundBufferMap=new Sa;this.soundBufferKeys=[];this.freeStreamBuffers=[];this.effectGC=[];this.soundBufferCount=0;if(null!=this.driver){this.sources=[];for(var a=0,b=La.MAX_SOURCES;a<b;)a++,this.sources.push(new qg(this.driver))}this.cachedBytes=
new S(new ArrayBuffer(24));this.resampleBytes=new S(new ArrayBuffer(2*La.STREAM_BUFFER_SAMPLE_COUNT))};La.__name__="hxd.snd.Manager";La.get=function(){null==La.instance&&(La.instance=new La,La.instance.updateEvent=yc.add((z=La.instance,M(z,z.update))),La.instance.updateEvent.isBlocking=!1);return La.instance};La.regEffect=function(a,b){for(var c=a;null!=c;){if(c==b)return a;c=c.next}b.next=a;return b};La.prototype={getTmpBytes:function(a){this.cachedBytes.length<a&&(this.cachedBytes=new S(new ArrayBuffer(a)));
return this.cachedBytes},getResampleBytes:function(a){this.resampleBytes.length<a&&(this.resampleBytes=new S(new ArrayBuffer(a)));return this.resampleBytes},stopAll:function(){for(;null!=this.channels;)this.channels.stop()},stopAllNotLooping:function(){for(var a=this.channels;null!=a;){var b=a.next;a.loop||a.stop();a=b}},stopByName:function(a){for(var b=this.channels;null!=b;){var c=b.next;null!=b.soundGroup&&b.soundGroup.name==a&&b.stop();b=c}},getAll:function(a){for(var b=this.channels,c=[];null!=
b;)b.sound==a&&c.push(b),b=b.next;return new Bi(c)},cleanCache:function(){for(var a=0;a<this.soundBufferKeys.length;){var b=this.soundBufferKeys[a],c=this.soundBufferMap.h[b];++a;if(!(0<c.refs)){var d=this.soundBufferMap;Object.prototype.hasOwnProperty.call(d.h,b)&&delete d.h[b];F.remove(this.soundBufferKeys,b);--a;c.dispose();--this.soundBufferCount}}},dispose:function(){this.stopAll();if(null!=this.driver){for(var a=0,b=this.sources;a<b.length;){var c=b[a];++a;c.dispose()}a=this.soundBufferMap.h;
b=Object.keys(a);for(var d=b.length,e=0;e<d;)c=a[b[e++]],c.dispose();a=0;for(b=this.freeStreamBuffers;a<b.length;)c=b[a],++a,c.dispose();a=0;for(b=this.effectGC;a<b.length;)c=b[a],++a,c.driver.release();this.driver.dispose()}this.effectGC=this.freeStreamBuffers=this.soundBufferKeys=this.soundBufferMap=this.sources=null;this.updateEvent.stop();La.instance=null},play:function(a,b,c){null==c&&(c=this.masterSoundGroup);null==b&&(b=this.masterChannelGroup);var d=a.getData();if(0==d.samples)throw t.thrown(y.string(a)+
" has no samples");var e=new Gf;e.sound=a;e.duration=d.get_duration();e.manager=this;e.soundGroup=c;e.channelGroup=b;e.next=this.channels;e.isLoading=d.isLoading();e.isVirtual=null==this.driver;e.lastStamp=F.now()/1E3;return this.channels=e},updateVirtualChannels:function(a){for(var b=this.channels;null!=b;)if(b.pause||!b.isVirtual||b.isLoading)b=b.next;else{var c=a-b.lastStamp;b.set_position(b.position+(0>c?0:c));b.lastStamp=a;for(c=b.next;b.position>=b.duration;)if(b.set_position(b.position-b.duration),
b.onEnd(),null!=c&&null==c.manager&&(c=null),0<b.queue.length)b.sound=b.queue.shift(),b.duration=b.sound.getData().get_duration();else if(!b.loop){this.releaseChannel(b);break}b=c}},update:function(){var a,b,c,d;if(0!=this.timeOffset){for(c=this.channels;null!=c;)c.lastStamp+=this.timeOffset,null!=c.currentFade&&(c.currentFade.start+=this.timeOffset),c=c.next;var e=0;for(a=this.sources;e<a.length;){var f=a[e];++e;var g=0;for(b=f.buffers;g<b.length;){var h=b[g];++g;h.lastStop+=this.timeOffset}}this.timeOffset=
0}this.now=F.now()/1E3;if(null==this.driver)this.updateVirtualChannels(this.now);else{e=0;for(a=this.sources;e<a.length;)if(f=a[e],++e,c=f.channel,null!=c)if(c.positionChanged)this.releaseSource(f);else{var k=null;h=this.driver.getProcessedBuffers(f.handle);g=0;for(b=h;g<b;)g++,h=this.unqueueBuffer(f),null!=h&&(k=h,h.isEnd&&(c.sound=h.sound,c.duration=h.sound.getData().get_duration(),c.set_position(c.duration),c.positionChanged=!1,c.onEnd(),f.start=0));0==f.buffers.length?k.isEnd?0<c.queue.length?
(c.sound=c.queue.shift(),c.duration=c.sound.getData().get_duration(),c.set_position(0),this.releaseSource(f)):c.loop?(c.set_position(0),this.releaseSource(f)):this.releaseChannel(c):(c.set_position((k.start+k.samples)/k.sampleRate),this.releaseSource(f)):(c.sound=f.buffers[0].sound,c.duration=c.sound.getData().get_duration(),h=this.driver.getPlayedSampleCount(f.handle),0>h&&(h=0),c.set_position(f.start/this.targetRate+h/f.buffers[0].sampleRate),c.positionChanged=!1,f.buffers.length<La.BUFFER_QUEUE_LENGTH&&
(h=f.buffers[f.buffers.length-1],h.isEnd?0<c.queue.length?this.queueBuffer(f,c.queue[0],0)&&c.queue.shift():c.loop&&this.queueBuffer(f,h.sound,0):this.queueBuffer(f,h.sound,h.start+h.samples)))}for(c=this.channels;null!=c;)c.calcAudibleVolume(this.now),c.isLoading&&!c.sound.getData().isLoading()&&(c.isLoading=!1),c.isVirtual=this.suspended||c.pause||c.mute||c.channelGroup.mute||c.allowVirtual&&c.audibleVolume<La.VIRTUAL_VOLUME_THRESHOLD||c.isLoading,c=c.next;var l=this.channels,m=M(this,this.sortChannel);
if(null==l)a=null;else{for(b=1;;){k=l;c=l=null;for(g=0;null!=k;){++g;f=k;e=d=0;for(a=b;e<a&&(e++,++d,f=f.next,null!=f););for(a=b;0<d||0<a&&null!=f;)0==d?(h=f,f=f.next,--a):0==a||null==f||0>=m(k,f)?(h=k,k=k.next,--d):(h=f,f=f.next,--a),null!=c?c.next=h:l=h,c=h;k=f}c.next=null;if(1>=g)break;b*=2}a=l}this.channels=a;a=0;for(c=this.channels;null!=c&&!c.isVirtual;)++a>this.sources.length?c.isVirtual=!0:0<=c.soundGroup.maxAudible&&(c.soundGroup.lastUpdate!=this.now&&(c.soundGroup.lastUpdate=this.now,c.soundGroup.numAudible=
0),++c.soundGroup.numAudible>c.soundGroup.maxAudible&&(c.isVirtual=!0,--a)),c=c.next;e=0;for(a=this.sources;e<a.length;)f=a[e],++e,null!=f.channel&&f.channel.isVirtual&&this.releaseSource(f);for(c=this.channels;null!=c;){if(null==c.source&&!c.isVirtual){f=null;e=0;for(a=this.sources;e<a.length;)if(h=a[e],++e,null==h.channel){f=h;break}if(null==f)throw t.thrown("could not get a source");f.channel=c;c.source=f;this.checkTargetFormat(c.sound.getData(),c.soundGroup.mono);f.start=Math.floor(c.position*
this.targetRate);0>f.start&&(f.start=0);this.queueBuffer(f,c.sound,f.start);c.positionChanged=!1}c=c.next}k=null;d=this.hasMasterVolume?1:this.masterVolume;e=0;for(a=this.sources;e<a.length;)if(f=a[e],++e,c=f.channel,null!=c){h=c.currentVolume*d;f.volume!=h&&(0>h&&(h=0),f.volume=h,this.driver.setSourceVolume(f.handle,h));f.playing||(this.driver.playSource(f.handle),f.playing=!0);for(g=c.bindedEffects.length;0<=--g;)h=c.bindedEffects[g],0>c.effects.indexOf(h)&&0>c.channelGroup.effects.indexOf(h)&&
this.unbindEffect(c,f,h);g=0;for(b=c.channelGroup.effects;g<b.length;)h=b[g],++g,0>c.bindedEffects.indexOf(h)&&this.bindEffect(c,f,h);h=0;for(g=c.effects;h<g.length;)b=g[h],++h,0>c.bindedEffects.indexOf(b)&&this.bindEffect(c,f,b);f=0;for(c=c.bindedEffects;f<c.length;)h=c[f],++f,k=La.regEffect(k,h)}l=k;m=M(this,this.sortEffect);if(null==l)k=null;else{for(b=1;;){k=l;c=l=null;for(g=0;null!=k;){++g;f=k;e=d=0;for(a=b;e<a&&(e++,++d,f=f.next,null!=f););for(a=b;0<d||0<a&&null!=f;)0==d?(h=f,f=f.next,--a):
0==a||null==f||0>=m(k,f)?(h=k,k=k.next,--d):(h=f,f=f.next,--a),null!=c?c.next=h:l=h,c=h;k=f}c.next=null;if(1>=g)break;b*=2}k=l}for(h=k;null!=h;)h.driver.update(h),h=h.next;e=0;for(a=this.sources;e<a.length;)if(f=a[e],++e,c=f.channel,null!=c)for(g=0,b=c.bindedEffects;g<b.length;)h=b[g],++g,h.driver.apply(h,f.handle);e=0;for(a=this.effectGC;e<a.length;)if(h=a[e],++e,this.now-h.lastStamp>h.retainTime){h.driver.release();F.remove(this.effectGC,h);break}this.updateVirtualChannels(this.now);a=this.listener.direction;
e=a.x*a.x+a.y*a.y+a.z*a.z;e=1E-20>e?0:1/Math.sqrt(e);a.x*=e;a.y*=e;a.z*=e;a=this.listener.up;e=a.x*a.x+a.y*a.y+a.z*a.z;e=1E-20>e?0:1/Math.sqrt(e);a.x*=e;a.y*=e;a.z*=e;this.hasMasterVolume&&this.driver.setMasterVolume(this.masterVolume);this.driver.setListenerParams(this.listener.position,this.listener.direction,this.listener.up,this.listener.velocity);this.driver.update();if(this.soundBufferCount>=La.SOUND_BUFFER_CACHE_SIZE)for(c=F.now()/1E3,g=0;g<this.soundBufferKeys.length;)e=this.soundBufferKeys[g],
h=this.soundBufferMap.h[e],++g,0<h.refs||h.lastStop+60>c||(a=this.soundBufferMap,Object.prototype.hasOwnProperty.call(a.h,e)&&delete a.h[e],F.remove(this.soundBufferKeys,e),--g,h.dispose(),--this.soundBufferCount)}},progressiveDecodeBuffer:function(a,b,c){var d=b.getData(),e=Math.ceil(La.STREAM_BUFFER_SAMPLE_COUNT/La.BUFFER_STREAM_SPLIT);if(a.streamStart!=c||a.streamSound!=b)a.streamSound=b,a.streamStart=c,a.streamPos=c;b=c+La.STREAM_BUFFER_SAMPLE_COUNT;if(a.streamPos==b)return!0;var f=d.getBytesPerSample(),
g=La.STREAM_BUFFER_SAMPLE_COUNT*f;if(null==a.streamBuffer||a.streamBuffer.length<g)a.streamBuffer=new S(new ArrayBuffer(g)),a.streamPos=c;g=b-a.streamPos;g>e&&(g=e);d.decode(a.streamBuffer,(a.streamPos-c)*f,a.streamPos,g);a.streamPos+=g;return a.streamPos==b},queueBuffer:function(a,b,c){var d=b.getData(),e=a.channel.soundGroup;if(d.get_duration()<=La.STREAM_DURATION)b=this.getSoundBuffer(b,e),this.driver.queueBuffer(a.handle,b.handle,c,!0);else{if(0<a.buffers.length&&1<La.BUFFER_STREAM_SPLIT&&!this.progressiveDecodeBuffer(a,
b,c))return!1;b=this.getStreamBuffer(a,b,e,c);this.driver.queueBuffer(a.handle,b.handle,0,b.isEnd)}a.buffers.push(b);return!0},unqueueBuffer:function(a){var b=a.buffers.shift();if(null==b)return null;this.driver.unqueueBuffer(a.handle,b.handle);b.isStream?this.freeStreamBuffers.unshift(b):0==--b.refs&&(b.lastStop=F.now()/1E3);return b},bindEffect:function(a,b,c){0!=c.refs||F.remove(this.effectGC,c)||c.driver.acquire();++c.refs;c.driver.bind(c,b.handle);a.bindedEffects.push(c)},unbindEffect:function(a,
b,c){c.driver.unbind(c,b.handle);F.remove(a.bindedEffects,c);0==--c.refs&&(c.lastStamp=this.now,this.effectGC.push(c))},releaseSource:function(a){if(null!=a.channel){for(var b=0,c=a.channel.bindedEffects.slice();b<c.length;){var d=c[b];++b;this.unbindEffect(a.channel,a,d)}a.channel.bindedEffects=[];a.channel.source=null;a.channel=null}a.playing&&(a.playing=!1,this.driver.stopSource(a.handle),a.volume=-1);for(;0<a.buffers.length;)this.unqueueBuffer(a)},checkTargetFormat:function(a,b){null==b&&(b=!1);
this.targetRate=a.samplingRate;this.targetChannels=b||1==a.channels?1:2;switch(a.sampleFormat._hx_index){case 0:var c=Qb.UI8;break;case 1:c=Qb.I16;break;case 2:c=Qb.F32}this.targetFormat=c;return this.targetChannels==a.channels&&this.targetFormat==a.sampleFormat?this.targetRate==a.samplingRate:!1},getSoundBuffer:function(a,b){var c=this,d=a.getData(),e=b.mono;b=a.entry.get_path();e&&1!=d.channels&&(b+="mono");var f=this.soundBufferMap.h[b];null==f&&(f=new mh(this.driver),f.isStream=!1,f.isEnd=!0,
f.sound=a,d.load(function(){c.fillSoundBuffer(f,d,e)}),this.soundBufferMap.h[b]=f,this.soundBufferKeys.push(b),++this.soundBufferCount);++f.refs;return f},fillSoundBuffer:function(a,b,c){null==c&&(c=!1);this.checkTargetFormat(b,c)||(b=b.resample(this.targetRate,this.targetFormat,this.targetChannels));c=b.samples*b.getBytesPerSample();var d=this.getTmpBytes(c);b.decode(d,0,0,b.samples);this.driver.setBufferData(a.handle,d,c,this.targetFormat,this.targetChannels,this.targetRate);a.sampleRate=this.targetRate;
a.samples=b.samples},getStreamBuffer:function(a,b,c,d){var e=b.getData(),f=this.freeStreamBuffers.shift();null==f&&(f=new mh(this.driver),f.isStream=!0);var g=La.STREAM_BUFFER_SAMPLE_COUNT;d+g>=e.samples?(g=e.samples-d,f.isEnd=!0):f.isEnd=!1;f.sound=b;f.samples=g;f.start=d;var h=g*e.getBytesPerSample();if(a.streamSound==b&&a.streamStart==d){for(;!this.progressiveDecodeBuffer(a,b,d););a=a.streamBuffer}else a=this.getTmpBytes(h),e.decode(a,0,d,g);if(!this.checkTargetFormat(e,c.mono)){h=Math.ceil(this.targetRate/
e.samplingRate*g)*this.targetChannels;switch(this.targetFormat._hx_index){case 0:var k=1;break;case 1:k=2;break;case 2:k=4}h*=k;k=this.getResampleBytes(h);e.resampleBuffer(k,0,a,0,this.targetRate,this.targetFormat,this.targetChannels,g);a=k}this.driver.setBufferData(f.handle,a,h,this.targetFormat,this.targetChannels,this.targetRate);f.sampleRate=this.targetRate;return f},sortChannel:function(a,b){return a.isVirtual!=b.isVirtual?a.isVirtual?1:-1:a.channelGroup.priority!=b.channelGroup.priority?a.channelGroup.priority<
b.channelGroup.priority?1:-1:a.priority!=b.priority?a.priority<b.priority?1:-1:a.audibleVolume!=b.audibleVolume?a.audibleVolume<b.audibleVolume?1:-1:a.id<b.id?1:-1},sortEffect:function(a,b){return b.priority-a.priority},releaseChannel:function(a){if(null!=a.manager){if(this.channels==a)this.channels=a.next;else{for(var b=this.channels;b.next!=a;)b=b.next;b.next=a.next}b=0;for(var c=a.effects;b<c.length;){var d=c[b];++b;a.removeEffect(d)}null!=a.source&&this.releaseSource(a.source);a.next=null;a.manager=
null;a.effects=null;a.bindedEffects=null;a.currentFade=null;b=a.sound;null!=b&&b.channel==a&&(b.channel=null)}},__class__:La};var ih=function(a){var b=(new Ah(new Vb(a))).read();this.samples=b.sampleCount;for(var c=b.frames[0].data,d=-1,e=0,f=c.length-24;e<f;){var g=e++;if(76==c.b[g]&&65==c.b[g+1]&&77==c.b[g+2]&&69==c.b[g+3]){d=g;break}}0<=d&&(c=c.b[d+21]<<16|c.b[d+22]<<8|c.b[d+23],this.samples-=(c>>12)+(c&4095)+1152);b=b.frames[0].header;this.sampleFormat=Qb.F32;this.samplingRate=Oa.srEnum2Num(b.samplingRate);
this.channels=b.channelMode==ad.Mono?1:2;b=ia.get();null!=b&&(b.decodeAudioData(a.b.bufferValue,M(this,this.processBuffer)),a=b.sampleRate|0,this.samples=Math.ceil(this.samples*a/this.samplingRate),this.samplingRate=a)};ih.__name__="hxd.snd.Mp3Data";ih.__super__=le;ih.prototype=D(le.prototype,{isLoading:function(){return null==this.buffer},load:function(a){null!=this.buffer?a():this.onEnd=a},processBuffer:function(a){var b=a.getChannelData(0);this.samples=a.length;if(1==this.channels)this.buffer=
S.ofData(b.buffer);else{var c=2>a.numberOfChannels?b:a.getChannelData(1),d=new Float32Array(2*b.length),e=0,f=0;for(a=a.length;f<a;){var g=f++;d[e++]=b[g];d[e++]=c[g]}this.buffer=S.ofData(d.buffer);null!=this.onEnd&&(this.onEnd(),this.onEnd=null)}},decodeBuffer:function(a,b,c,d){null==this.buffer?a.fill(b,4*d*this.channels,0):a.blit(b,this.buffer,4*c*this.channels,4*d*this.channels)},__class__:ih});var Ei=function(a){this.name=a;this.maxAudible=-1;this.volume=1;this.mono=!1};Ei.__name__="hxd.snd.SoundGroup";
Ei.prototype={__class__:Ei};var pg=function(a){null!=a&&this.init((new Gh(new Vb(a))).read())};pg.__name__="hxd.snd.WavData";pg.__super__=le;pg.prototype=D(le.prototype,{init:function(a){var b=a.header;this.samplingRate=b.samplingRate;this.channels=b.channels;switch(b.bitsPerSample){case 8:b=Qb.UI8;break;case 16:b=Qb.I16;break;default:throw t.thrown("Unsupported WAV "+b.bitsPerSample+" bits");}this.sampleFormat=b;this.rawData=a.data;this.samples=this.rawData.length/this.getBytesPerSample()|0},decodeBuffer:function(a,
b,c,d){var e=this.getBytesPerSample();a.blit(b,this.rawData,c*e,d*e)},__class__:pg});var Fi=function(){$d.call(this,"lowpass");this.priority=100;this.gainHF=1};Fi.__name__="hxd.snd.effect.LowPass";Fi.__super__=$d;Fi.prototype=D($d.prototype,{__class__:Fi});var Gi=function(a){null==a&&(a=1);$d.call(this,"pitch");this.value=a};Gi.__name__="hxd.snd.effect.Pitch";Gi.__super__=$d;Gi.prototype=D($d.prototype,{__class__:Gi});var Hi=function(){$d.call(this,"spatialization");this.position=new G(0,0,0);this.velocity=
new G(0,0,0);this.direction=new G(0,0,0);this.rollOffFactor=this.referenceDistance=1};Hi.__name__="hxd.snd.effect.Spatialization";Hi.__super__=$d;Hi.prototype=D($d.prototype,{getVolumeModifier:function(){if(null==this.fadeDistance)return 1;var a=La.get().listener.position,b=this.position,c=b.x-a.x,d=b.y-a.y;a=b.z-a.z;c=Math.sqrt(c*c+d*d+a*a);c=null!=this.maxDistance?c-this.maxDistance:c-this.referenceDistance;c=1-c/this.fadeDistance;1<c&&(c=1);0>c&&(c=0);return c},applyAudibleVolumeModifier:function(a){var b=
La.get().listener.position,c=this.position;var d=c.x-b.x;var e=c.y-b.y;b=c.z-b.z;e=Math.sqrt(d*d+e*e+b*b);d=this.referenceDistance;e<d&&(e=d);null!=this.maxDistance&&(d=this.maxDistance,e>d&&(e=d));return this.referenceDistance/(this.referenceDistance+this.rollOffFactor*(e-this.referenceDistance))*a},__class__:Hi});var Ii=function(){};Ii.__name__="hxd.snd.webaudio.BufferHandle";Ii.prototype={__class__:Ii};var Ji=function(){this.buffers=[];this.sampleOffset=0;this.pitch=1;this.firstPlay=!0};Ji.__name__=
"hxd.snd.webaudio.SourceHandle";Ji.prototype={updateDestination:function(){this.destination=this.gain;null!=this.lowPass&&(this.lowPass.connect(this.destination),this.destination=this.lowPass);null!=this.panner&&(this.panner.connect(this.destination),this.destination=this.panner);this.gain.connect(ia.destination);for(var a=0,b=this.buffers;a<b.length;){var c=b[a];++a;null!=c.node&&c.restart(this)}},applyPitch:function(){for(var a=0,b=0,c=this.buffers;b<c.length;){var d=c[b];++b;a=d.readjust(a,this)}},
__class__:Ji};var oh=function(){};oh.__name__="hxd.snd.webaudio.BufferPlayback";oh.prototype={get_currentSample:function(){if(this.consumed)return this.buffer.samples;if(null==this.node||!this.dirty||this.node.context.currentTime<this.lastTime)return 0;this.lastSamples+=Math.floor((this.node.context.currentTime-this.lastTime)*this.buffer.inst.sampleRate*this.node.playbackRate.value);this.lastTime=this.node.context.currentTime;return this.lastSamples},set:function(a,b){this.buffer=a;this.offset=isNaN(b)?
0:b;this.consumed=this.dirty=!1;this.ends=this.starts=0},start:function(a,b,c){this.dirty=!0;this.consumed=!1;null!=this.node&&this.stop();if(b.firstPlay&&10<this.buffer.samples){b.firstPlay=!1;for(var d=[],e=0,f=this.buffer.inst.numberOfChannels;e<f;){var g=e++;d.push(this.buffer.inst.getChannelData(g))}for(f=e=0;10>e;){for(g=0;g<d.length;)d[g][e]*=f,++g;++e;f+=.1;1<f&&(f=1)}}this.node=a.createBufferSource();this.node.buffer=this.buffer.inst;this.node.addEventListener("ended",M(this,this.onBufferConsumed));
this.node.connect(b.destination);this.node.playbackRate.value=b.pitch;this.node.start(c,this.offset);this.lastSamples=0;this.starts=this.lastTime=c;return this.ends=c+(this.buffer.inst.duration-this.offset)/b.pitch},readjust:function(a,b){if(this.consumed||null==this.node)return this.ends;var c=b.driver.ctx,d=c.currentTime;this.node.playbackRate.setValueAtTime(b.pitch,d);var e=d-this.starts;if(0>e)return this.start(c,b,0==a?d:a);this.starts=d-e/b.pitch;return this.ends=this.starts+(this.buffer.inst.duration-
this.offset)/b.pitch},restart:function(a){if(!this.consumed&&null!=this.node){var b=ia.get();b.currentTime>this.starts?(this.offset+=(b.currentTime-this.starts)*a.pitch,this.start(b,a,b.currentTime)):this.start(b,a,this.starts)}},stop:function(a){null==a&&(a=!0);null!=this.node&&(this.node.removeEventListener("ended",M(this,this.onBufferConsumed)),a?this.node.disconnect():this.node.stop(),this.node=null)},onBufferConsumed:function(a){this.node.removeEventListener("ended",M(this,this.onBufferConsumed));
this.node.disconnect();this.node=null;this.consumed=!0},clear:function(){this.node=this.buffer=null},__class__:oh};var ia=function(){};ia.__name__="hxd.snd.webaudio.Context";ia.get=function(){if(null==ia.ctx){try{ia.ctx=new AudioContext}catch(a){try{ia.ctx=new window.webkitAudioContext}catch(b){ia.ctx=null}}if(null==ia.ctx)throw t.thrown("WebAudio API not available in this browser!");"suspended"==ia.ctx.state&&ia.waitForPageInput();ia.ctx.addEventListener("statechange",function(a){"suspended"==ia.ctx.state&&
ia.waitForPageInput()});ia.bufferPool=[];ia.gainPool=[];ia.masterGain=ia.ctx.createGain();ia.masterGain.connect(ia.ctx.destination);ia.destination=ia.masterGain}return ia.ctx};ia.getGain=function(){return 0!=ia.gainPool.length?ia.gainPool.pop():ia.ctx.createGain()};ia.putGain=function(a){ia.gainPool.push(a);a.gain.value=1};ia.waitForPageInput=function(){ia.suspended||(window.document.addEventListener("click",ia.resumeContext),window.document.addEventListener("keydown",ia.resumeContext),window.document.body.addEventListener("keydown",
ia.resumeContext),window.document.body.addEventListener("touchend",ia.resumeContext),ia.suspended=!0)};ia.resumeContext=function(a){ia.suspended&&(null!=ia.ctx&&ia.ctx.resume(),window.document.removeEventListener("click",ia.resumeContext),window.document.removeEventListener("keydown",ia.resumeContext),window.document.body.removeEventListener("keydown",ia.resumeContext),window.document.body.removeEventListener("touchend",ia.resumeContext),ia.suspended=!1)};ia.getBuffer=function(a,b,c){for(var d,e=
0,f=ia.bufferPool;e<f.length;)if(d=f[e],++e,d.channels==a&&d.samples==b&&d.rate==c)return 0!=d.pool.length?d.pool.pop():ia.ctx.createBuffer(a,b,c);d=new Ki(a,b,c);ia.bufferPool.push(d);return ia.ctx.createBuffer(a,b,c)};ia.putBuffer=function(a){for(var b=a.sampleRate|0,c=0,d=ia.bufferPool;c<d.length;){var e=d[c];++c;if(e.channels==a.numberOfChannels&&e.samples==a.length&&e.rate==b){e.pool.push(a);break}}};var Ki=function(a,b,c){this.pool=[];this.channels=a;this.samples=b;this.rate=c};Ki.__name__=
"hxd.snd.webaudio._Context.BufferPool";Ki.prototype={__class__:Ki};var nh=function(){this.playbackPool=[];this.ctx=ia.get()};nh.__name__="hxd.snd.webaudio.Driver";nh.__interfaces__=[lh];nh.prototype={getBuffer:function(a,b,c){return ia.getBuffer(a,b,c)},putBuffer:function(a){ia.putBuffer(a)},getGain:function(){return 0!=ia.gainPool.length?ia.gainPool.pop():ia.ctx.createGain()},putGain:function(a){ia.gainPool.push(a);a.gain.value=1},hasFeature:function(a){return!0},setMasterVolume:function(a){ia.masterGain.gain.value=
a},setListenerParams:function(a,b,c,d){this.ctx.listener.setPosition(-a.x,a.y,a.z);this.ctx.listener.setOrientation(-b.x,b.y,b.z,-c.x,c.y,c.z)},createSource:function(){var a=new Ji;a.driver=this;a.gain=0!=ia.gainPool.length?ia.gainPool.pop():ia.ctx.createGain();a.updateDestination();return a},playSource:function(a){if(!a.playing&&(a.playing=!0,0!=a.buffers.length))for(var b=this.ctx.currentTime,c=0,d=a.buffers;c<d.length;){var e=d[c];++c;e.consumed||(b=e.start(this.ctx,a,b))}},stopSource:function(a){a.playing=
!1;a.sampleOffset=0},setSourceVolume:function(a,b){a.gain.gain.value=b},destroySource:function(a){this.stopSource(a);a.gain.disconnect();a.driver=null;var b=a.gain;ia.gainPool.push(b);b.gain.value=1;a.gain=null;b=0;for(var c=a.buffers;b<c.length;){var d=c[b];++b;d.stop();d.clear();this.playbackPool.push(d)}a.buffers=[]},createBuffer:function(){var a=new Ii;a.samples=0;return a},setBufferData:function(a,b,c,d,e,f){switch(d._hx_index){case 0:var g=1;break;case 1:g=2;break;case 2:g=4}c=c/g/e|0;a.samples=
c;if(0!=c){if(null==a.inst)a.inst=ia.getBuffer(e,c,f);else if(a.inst.sampleRate!=f||a.inst.numberOfChannels!=e||a.inst.length!=c)ia.putBuffer(a.inst),a.inst=ia.getBuffer(e,c,f);switch(d._hx_index){case 0:var h=new Uint8Array(b.b.bufferValue);if(1==e)for(e=a.inst.getChannelData(0),a=0,d=c;a<d;)c=a++,e[c]=(h[c]-128)/128;else for(b=a.inst.getChannelData(0),g=a.inst.getChannelData(1),a=f=0,d=c;a<d;)c=a++,b[c]=(h[f]-128)/128,g[c]=(h[f+1]-128)/128,f+=e;break;case 1:h=new Int16Array(b.b.bufferValue);if(1==
e)for(e=a.inst.getChannelData(0),a=0,d=c;a<d;)c=a++,e[c]=h[c]/32768;else for(b=a.inst.getChannelData(0),g=a.inst.getChannelData(1),a=f=0,d=c;a<d;)c=a++,b[c]=h[f]/32768,g[c]=h[f+1]/32768,f+=e;break;case 2:if(h=new Float32Array(b.b.bufferValue),1==e)for(e=a.inst.getChannelData(0),a=0,d=c;a<d;)c=a++,e[c]=h[c];else for(b=a.inst.getChannelData(0),g=a.inst.getChannelData(1),a=f=0,d=c;a<d;)c=a++,b[c]=h[f],g[c]=h[f+1],f+=e}}},destroyBuffer:function(a){null!=a.inst&&ia.putBuffer(a.inst);a.inst=null},queueBuffer:function(a,
b,c,d){var e=0!=this.playbackPool.length?this.playbackPool.pop():new oh;null!=b.inst&&(e.set(b,c/b.inst.length*b.inst.duration),b.isEnd=d,a.buffers.push(e),a.playing&&(1!=a.buffers.length?(c=a.buffers[a.buffers.length-2].ends,b=this.ctx,isFinite(c)?(d=this.ctx.currentTime,c=c<d?d:c):c=this.ctx.currentTime,e.start(b,a,c)):e.start(this.ctx,a,this.ctx.currentTime)))},unqueueBuffer:function(a,b){for(;0<a.buffers.length;){var c=a.buffers[0];if(c.buffer==b){a.buffers.splice(0,1);c.stop(!b.isEnd);c.clear();
this.playbackPool.push(c);break}}a.sampleOffset=b.isEnd||!a.playing?0:a.sampleOffset+b.samples},getProcessedBuffers:function(a){var b=0,c=0;for(a=a.buffers;c<a.length;){var d=a[c];++c;d.consumed&&++b}return b},getPlayedSampleCount:function(a){for(var b=0,c=null,d=0,e=a.buffers;d<e.length;){var f=e[d];++d;if(f.consumed)b+=f.buffer.samples;else if(f.dirty){c=f;break}}return null!=c?a.sampleOffset+b+c.get_currentSample():a.sampleOffset+b},update:function(){},dispose:function(){},getEffectDriver:function(a){switch(a){case "lowpass":return new ph;
case "pitch":return new qh;case "spatialization":return new rh;default:return new Oe}},get_masterGain:function(){return ia.masterGain},set_destination:function(a){return ia.destination=a},get_destination:function(){return ia.destination},__class__:nh};var ph=function(){this.pool=[]};ph.__name__="hxd.snd.webaudio.LowPassDriver";ph.__super__=Oe;ph.prototype=D(Oe.prototype,{get:function(a){if(0!=this.pool.length)return this.pool.pop();a=a.createBiquadFilter();a.type="lowpass";return a},bind:function(a,
b){b.lowPass=this.get(b.driver.ctx);b.updateDestination();this.apply(a,b)},apply:function(a,b){var c=b.driver.ctx.sampleRate/2;b.lowPass.frequency.value=c*Math.pow(2,Math.log(c/40)/Math.LN2*(a.gainHF-1))},unbind:function(a,b){this.pool.push(b.lowPass);b.lowPass.disconnect();b.lowPass=null;null!=b.driver&&b.updateDestination()},__class__:ph});var qh=function(){};qh.__name__="hxd.snd.webaudio.PitchDriver";qh.__super__=Oe;qh.prototype=D(Oe.prototype,{apply:function(a,b){b.pitch!=a.value&&(b.pitch=a.value,
b.applyPitch())},unbind:function(a,b){b.pitch=1;b.applyPitch()},__class__:qh});var rh=function(){this.pool=[]};rh.__name__="hxd.snd.webaudio.SpatializationDriver";rh.__super__=Oe;rh.prototype=D(Oe.prototype,{get:function(a){return 0!=this.pool.length?this.pool.pop():a.createPanner()},bind:function(a,b){b.panner=this.get(b.driver.ctx);b.updateDestination();this.apply(a,b)},apply:function(a,b){b.panner.setPosition(-a.position.x,a.position.y,a.position.z);b.panner.setOrientation(-a.direction.x,a.direction.y,
a.direction.z);b.panner.rolloffFactor=a.rollOffFactor;b.panner.refDistance=a.referenceDistance;b.panner.maxDistance=null==a.maxDistance?3.40282347E38:a.maxDistance},unbind:function(a,b){this.pool.push(b.panner);b.panner.disconnect();b.panner=null;null!=b.driver&&b.updateDestination()},__class__:rh});var Ab=K["hxsl.BufferKind"]={__ename__:!0,__constructs__:null,Uniform:{_hx_name:"Uniform",_hx_index:0,__enum__:"hxsl.BufferKind",toString:v},Storage:{_hx_name:"Storage",_hx_index:1,__enum__:"hxsl.BufferKind",
toString:v},RW:{_hx_name:"RW",_hx_index:2,__enum__:"hxsl.BufferKind",toString:v},Partial:{_hx_name:"Partial",_hx_index:3,__enum__:"hxsl.BufferKind",toString:v},StoragePartial:{_hx_name:"StoragePartial",_hx_index:4,__enum__:"hxsl.BufferKind",toString:v},RWPartial:{_hx_name:"RWPartial",_hx_index:5,__enum__:"hxsl.BufferKind",toString:v}};Ab.__constructs__=[Ab.Uniform,Ab.Storage,Ab.RW,Ab.Partial,Ab.StoragePartial,Ab.RWPartial];Ab.__empty_constructs__=[Ab.Uniform,Ab.Storage,Ab.RW,Ab.Partial,Ab.StoragePartial,
Ab.RWPartial];var Ta=K["hxsl.TexDimension"]={__ename__:!0,__constructs__:null,T1D:{_hx_name:"T1D",_hx_index:0,__enum__:"hxsl.TexDimension",toString:v},T2D:{_hx_name:"T2D",_hx_index:1,__enum__:"hxsl.TexDimension",toString:v},T3D:{_hx_name:"T3D",_hx_index:2,__enum__:"hxsl.TexDimension",toString:v},TCube:{_hx_name:"TCube",_hx_index:3,__enum__:"hxsl.TexDimension",toString:v}};Ta.__constructs__=[Ta.T1D,Ta.T2D,Ta.T3D,Ta.TCube];Ta.__empty_constructs__=[Ta.T1D,Ta.T2D,Ta.T3D,Ta.TCube];var x=K["hxsl.Type"]=
{__ename__:!0,__constructs__:null,TVoid:{_hx_name:"TVoid",_hx_index:0,__enum__:"hxsl.Type",toString:v},TInt:{_hx_name:"TInt",_hx_index:1,__enum__:"hxsl.Type",toString:v},TBool:{_hx_name:"TBool",_hx_index:2,__enum__:"hxsl.Type",toString:v},TFloat:{_hx_name:"TFloat",_hx_index:3,__enum__:"hxsl.Type",toString:v},TString:{_hx_name:"TString",_hx_index:4,__enum__:"hxsl.Type",toString:v},TVec:(z=function(a,b){return{_hx_index:5,size:a,t:b,__enum__:"hxsl.Type",toString:v}},z._hx_name="TVec",z.__params__=["size",
"t"],z),TMat3:{_hx_name:"TMat3",_hx_index:6,__enum__:"hxsl.Type",toString:v},TMat4:{_hx_name:"TMat4",_hx_index:7,__enum__:"hxsl.Type",toString:v},TMat3x4:{_hx_name:"TMat3x4",_hx_index:8,__enum__:"hxsl.Type",toString:v},TBytes:(z=function(a){return{_hx_index:9,size:a,__enum__:"hxsl.Type",toString:v}},z._hx_name="TBytes",z.__params__=["size"],z),TSampler:(z=function(a,b){return{_hx_index:10,dim:a,isArray:b,__enum__:"hxsl.Type",toString:v}},z._hx_name="TSampler",z.__params__=["dim","isArray"],z),TRWTexture:(z=
function(a,b,c){return{_hx_index:11,dim:a,isArray:b,channels:c,__enum__:"hxsl.Type",toString:v}},z._hx_name="TRWTexture",z.__params__=["dim","isArray","channels"],z),TMat2:{_hx_name:"TMat2",_hx_index:12,__enum__:"hxsl.Type",toString:v},TStruct:(z=function(a){return{_hx_index:13,vl:a,__enum__:"hxsl.Type",toString:v}},z._hx_name="TStruct",z.__params__=["vl"],z),TFun:(z=function(a){return{_hx_index:14,variants:a,__enum__:"hxsl.Type",toString:v}},z._hx_name="TFun",z.__params__=["variants"],z),TArray:(z=
function(a,b){return{_hx_index:15,t:a,size:b,__enum__:"hxsl.Type",toString:v}},z._hx_name="TArray",z.__params__=["t","size"],z),TBuffer:(z=function(a,b,c){return{_hx_index:16,t:a,size:b,kind:c,__enum__:"hxsl.Type",toString:v}},z._hx_name="TBuffer",z.__params__=["t","size","kind"],z),TChannel:(z=function(a){return{_hx_index:17,size:a,__enum__:"hxsl.Type",toString:v}},z._hx_name="TChannel",z.__params__=["size"],z)};x.__constructs__=[x.TVoid,x.TInt,x.TBool,x.TFloat,x.TString,x.TVec,x.TMat3,x.TMat4,x.TMat3x4,
x.TBytes,x.TSampler,x.TRWTexture,x.TMat2,x.TStruct,x.TFun,x.TArray,x.TBuffer,x.TChannel];x.__empty_constructs__=[x.TVoid,x.TInt,x.TBool,x.TFloat,x.TString,x.TMat3,x.TMat4,x.TMat3x4,x.TMat2];var Q=K["hxsl.VecType"]={__ename__:!0,__constructs__:null,VInt:{_hx_name:"VInt",_hx_index:0,__enum__:"hxsl.VecType",toString:v},VFloat:{_hx_name:"VFloat",_hx_index:1,__enum__:"hxsl.VecType",toString:v},VBool:{_hx_name:"VBool",_hx_index:2,__enum__:"hxsl.VecType",toString:v}};Q.__constructs__=[Q.VInt,Q.VFloat,Q.VBool];
Q.__empty_constructs__=[Q.VInt,Q.VFloat,Q.VBool];var Za=K["hxsl.SizeDecl"]={__ename__:!0,__constructs__:null,SConst:(z=function(a){return{_hx_index:0,v:a,__enum__:"hxsl.SizeDecl",toString:v}},z._hx_name="SConst",z.__params__=["v"],z),SVar:(z=function(a){return{_hx_index:1,v:a,__enum__:"hxsl.SizeDecl",toString:v}},z._hx_name="SVar",z.__params__=["v"],z)};Za.__constructs__=[Za.SConst,Za.SVar];Za.__empty_constructs__=[];var kb=function(a,b){this.msg=a;this.pos=b};kb.__name__="hxsl.Error";kb.t=function(a,
b){throw t.thrown(new kb(a,b));};kb.prototype={toString:function(){return"Error("+this.msg+")@"+y.string(this.pos)},__class__:kb};var L=K["hxsl.VarKind"]={__ename__:!0,__constructs__:null,Global:{_hx_name:"Global",_hx_index:0,__enum__:"hxsl.VarKind",toString:v},Input:{_hx_name:"Input",_hx_index:1,__enum__:"hxsl.VarKind",toString:v},Param:{_hx_name:"Param",_hx_index:2,__enum__:"hxsl.VarKind",toString:v},Var:{_hx_name:"Var",_hx_index:3,__enum__:"hxsl.VarKind",toString:v},Local:{_hx_name:"Local",_hx_index:4,
__enum__:"hxsl.VarKind",toString:v},Output:{_hx_name:"Output",_hx_index:5,__enum__:"hxsl.VarKind",toString:v},Function:{_hx_name:"Function",_hx_index:6,__enum__:"hxsl.VarKind",toString:v}};L.__constructs__=[L.Global,L.Input,L.Param,L.Var,L.Local,L.Output,L.Function];L.__empty_constructs__=[L.Global,L.Input,L.Param,L.Var,L.Local,L.Output,L.Function];var ma=K["hxsl.VarQualifier"]={__ename__:!0,__constructs__:null,Const:(z=function(a){return{_hx_index:0,max:a,__enum__:"hxsl.VarQualifier",toString:v}},
z._hx_name="Const",z.__params__=["max"],z),Private:{_hx_name:"Private",_hx_index:1,__enum__:"hxsl.VarQualifier",toString:v},Nullable:{_hx_name:"Nullable",_hx_index:2,__enum__:"hxsl.VarQualifier",toString:v},PerObject:{_hx_name:"PerObject",_hx_index:3,__enum__:"hxsl.VarQualifier",toString:v},Name:(z=function(a){return{_hx_index:4,n:a,__enum__:"hxsl.VarQualifier",toString:v}},z._hx_name="Name",z.__params__=["n"],z),Shared:{_hx_name:"Shared",_hx_index:5,__enum__:"hxsl.VarQualifier",toString:v},Precision:(z=
function(a){return{_hx_index:6,p:a,__enum__:"hxsl.VarQualifier",toString:v}},z._hx_name="Precision",z.__params__=["p"],z),Range:(z=function(a,b){return{_hx_index:7,min:a,max:b,__enum__:"hxsl.VarQualifier",toString:v}},z._hx_name="Range",z.__params__=["min","max"],z),Ignore:{_hx_name:"Ignore",_hx_index:8,__enum__:"hxsl.VarQualifier",toString:v},PerInstance:(z=function(a){return{_hx_index:9,v:a,__enum__:"hxsl.VarQualifier",toString:v}},z._hx_name="PerInstance",z.__params__=["v"],z),Doc:(z=function(a){return{_hx_index:10,
s:a,__enum__:"hxsl.VarQualifier",toString:v}},z._hx_name="Doc",z.__params__=["s"],z),Borrow:(z=function(a){return{_hx_index:11,source:a,__enum__:"hxsl.VarQualifier",toString:v}},z._hx_name="Borrow",z.__params__=["source"],z),Sampler:(z=function(a){return{_hx_index:12,name:a,__enum__:"hxsl.VarQualifier",toString:v}},z._hx_name="Sampler",z.__params__=["name"],z),Final:{_hx_name:"Final",_hx_index:13,__enum__:"hxsl.VarQualifier",toString:v},Flat:{_hx_name:"Flat",_hx_index:14,__enum__:"hxsl.VarQualifier",
toString:v}};ma.__constructs__=[ma.Const,ma.Private,ma.Nullable,ma.PerObject,ma.Name,ma.Shared,ma.Precision,ma.Range,ma.Ignore,ma.PerInstance,ma.Doc,ma.Borrow,ma.Sampler,ma.Final,ma.Flat];ma.__empty_constructs__=[ma.Private,ma.Nullable,ma.PerObject,ma.Shared,ma.Ignore,ma.Final,ma.Flat];var Pe=K["hxsl.Prec"]={__ename__:!0,__constructs__:null,Low:{_hx_name:"Low",_hx_index:0,__enum__:"hxsl.Prec",toString:v},Medium:{_hx_name:"Medium",_hx_index:1,__enum__:"hxsl.Prec",toString:v},High:{_hx_name:"High",
_hx_index:2,__enum__:"hxsl.Prec",toString:v}};Pe.__constructs__=[Pe.Low,Pe.Medium,Pe.High];Pe.__empty_constructs__=[Pe.Low,Pe.Medium,Pe.High];var E=K["hxsl.Const"]={__ename__:!0,__constructs__:null,CNull:{_hx_name:"CNull",_hx_index:0,__enum__:"hxsl.Const",toString:v},CBool:(z=function(a){return{_hx_index:1,b:a,__enum__:"hxsl.Const",toString:v}},z._hx_name="CBool",z.__params__=["b"],z),CInt:(z=function(a){return{_hx_index:2,v:a,__enum__:"hxsl.Const",toString:v}},z._hx_name="CInt",z.__params__=["v"],
z),CFloat:(z=function(a){return{_hx_index:3,v:a,__enum__:"hxsl.Const",toString:v}},z._hx_name="CFloat",z.__params__=["v"],z),CString:(z=function(a){return{_hx_index:4,v:a,__enum__:"hxsl.Const",toString:v}},z._hx_name="CString",z.__params__=["v"],z)};E.__constructs__=[E.CNull,E.CBool,E.CInt,E.CFloat,E.CString];E.__empty_constructs__=[E.CNull];var ib=K["hxsl.ExprDef"]={__ename__:!0,__constructs__:null,EConst:(z=function(a){return{_hx_index:0,c:a,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EConst",
z.__params__=["c"],z),EIdent:(z=function(a){return{_hx_index:1,i:a,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EIdent",z.__params__=["i"],z),EParenthesis:(z=function(a){return{_hx_index:2,e:a,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EParenthesis",z.__params__=["e"],z),EField:(z=function(a,b){return{_hx_index:3,e:a,f:b,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EField",z.__params__=["e","f"],z),EBinop:(z=function(a,b,c){return{_hx_index:4,op:a,e1:b,e2:c,__enum__:"hxsl.ExprDef",toString:v}},
z._hx_name="EBinop",z.__params__=["op","e1","e2"],z),EUnop:(z=function(a,b){return{_hx_index:5,op:a,e1:b,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EUnop",z.__params__=["op","e1"],z),ECall:(z=function(a,b){return{_hx_index:6,e:a,args:b,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="ECall",z.__params__=["e","args"],z),EBlock:(z=function(a){return{_hx_index:7,el:a,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EBlock",z.__params__=["el"],z),EVars:(z=function(a){return{_hx_index:8,v:a,__enum__:"hxsl.ExprDef",
toString:v}},z._hx_name="EVars",z.__params__=["v"],z),EFunction:(z=function(a){return{_hx_index:9,f:a,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EFunction",z.__params__=["f"],z),EIf:(z=function(a,b,c){return{_hx_index:10,econd:a,eif:b,eelse:c,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EIf",z.__params__=["econd","eif","eelse"],z),EDiscard:{_hx_name:"EDiscard",_hx_index:11,__enum__:"hxsl.ExprDef",toString:v},EFor:(z=function(a,b,c){return{_hx_index:12,v:a,loop:b,block:c,__enum__:"hxsl.ExprDef",
toString:v}},z._hx_name="EFor",z.__params__=["v","loop","block"],z),EReturn:(z=function(a){return{_hx_index:13,e:a,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EReturn",z.__params__=["e"],z),EBreak:{_hx_name:"EBreak",_hx_index:14,__enum__:"hxsl.ExprDef",toString:v},EContinue:{_hx_name:"EContinue",_hx_index:15,__enum__:"hxsl.ExprDef",toString:v},EArray:(z=function(a,b){return{_hx_index:16,e:a,eindex:b,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EArray",z.__params__=["e","eindex"],z),EArrayDecl:(z=
function(a){return{_hx_index:17,el:a,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EArrayDecl",z.__params__=["el"],z),ESwitch:(z=function(a,b,c){return{_hx_index:18,e:a,cases:b,def:c,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="ESwitch",z.__params__=["e","cases","def"],z),EWhile:(z=function(a,b,c){return{_hx_index:19,cond:a,loop:b,normalWhile:c,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EWhile",z.__params__=["cond","loop","normalWhile"],z),EMeta:(z=function(a,b,c){return{_hx_index:20,
name:a,args:b,e:c,__enum__:"hxsl.ExprDef",toString:v}},z._hx_name="EMeta",z.__params__=["name","args","e"],z)};ib.__constructs__=[ib.EConst,ib.EIdent,ib.EParenthesis,ib.EField,ib.EBinop,ib.EUnop,ib.ECall,ib.EBlock,ib.EVars,ib.EFunction,ib.EIf,ib.EDiscard,ib.EFor,ib.EReturn,ib.EBreak,ib.EContinue,ib.EArray,ib.EArrayDecl,ib.ESwitch,ib.EWhile,ib.EMeta];ib.__empty_constructs__=[ib.EDiscard,ib.EBreak,ib.EContinue];var q=K["hxsl.TExprDef"]={__ename__:!0,__constructs__:null,TConst:(z=function(a){return{_hx_index:0,
c:a,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TConst",z.__params__=["c"],z),TVar:(z=function(a){return{_hx_index:1,v:a,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TVar",z.__params__=["v"],z),TGlobal:(z=function(a){return{_hx_index:2,g:a,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TGlobal",z.__params__=["g"],z),TParenthesis:(z=function(a){return{_hx_index:3,e:a,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TParenthesis",z.__params__=["e"],z),TBlock:(z=function(a){return{_hx_index:4,
el:a,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TBlock",z.__params__=["el"],z),TBinop:(z=function(a,b,c){return{_hx_index:5,op:a,e1:b,e2:c,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TBinop",z.__params__=["op","e1","e2"],z),TUnop:(z=function(a,b){return{_hx_index:6,op:a,e1:b,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TUnop",z.__params__=["op","e1"],z),TVarDecl:(z=function(a,b){return{_hx_index:7,v:a,init:b,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TVarDecl",z.__params__=
["v","init"],z),TCall:(z=function(a,b){return{_hx_index:8,e:a,args:b,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TCall",z.__params__=["e","args"],z),TSwiz:(z=function(a,b){return{_hx_index:9,e:a,regs:b,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TSwiz",z.__params__=["e","regs"],z),TIf:(z=function(a,b,c){return{_hx_index:10,econd:a,eif:b,eelse:c,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TIf",z.__params__=["econd","eif","eelse"],z),TDiscard:{_hx_name:"TDiscard",_hx_index:11,__enum__:"hxsl.TExprDef",
toString:v},TReturn:(z=function(a){return{_hx_index:12,e:a,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TReturn",z.__params__=["e"],z),TFor:(z=function(a,b,c){return{_hx_index:13,v:a,it:b,loop:c,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TFor",z.__params__=["v","it","loop"],z),TContinue:{_hx_name:"TContinue",_hx_index:14,__enum__:"hxsl.TExprDef",toString:v},TBreak:{_hx_name:"TBreak",_hx_index:15,__enum__:"hxsl.TExprDef",toString:v},TArray:(z=function(a,b){return{_hx_index:16,e:a,index:b,
__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TArray",z.__params__=["e","index"],z),TArrayDecl:(z=function(a){return{_hx_index:17,el:a,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TArrayDecl",z.__params__=["el"],z),TSwitch:(z=function(a,b,c){return{_hx_index:18,e:a,cases:b,def:c,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TSwitch",z.__params__=["e","cases","def"],z),TWhile:(z=function(a,b,c){return{_hx_index:19,e:a,loop:b,normalWhile:c,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name=
"TWhile",z.__params__=["e","loop","normalWhile"],z),TMeta:(z=function(a,b,c){return{_hx_index:20,m:a,args:b,e:c,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TMeta",z.__params__=["m","args","e"],z),TField:(z=function(a,b){return{_hx_index:21,e:a,name:b,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TField",z.__params__=["e","name"],z),TSyntax:(z=function(a,b,c){return{_hx_index:22,target:a,code:b,args:c,__enum__:"hxsl.TExprDef",toString:v}},z._hx_name="TSyntax",z.__params__=["target","code",
"args"],z)};q.__constructs__=[q.TConst,q.TVar,q.TGlobal,q.TParenthesis,q.TBlock,q.TBinop,q.TUnop,q.TVarDecl,q.TCall,q.TSwiz,q.TIf,q.TDiscard,q.TReturn,q.TFor,q.TContinue,q.TBreak,q.TArray,q.TArrayDecl,q.TSwitch,q.TWhile,q.TMeta,q.TField,q.TSyntax];q.__empty_constructs__=[q.TDiscard,q.TContinue,q.TBreak];var Ca=K["hxsl.FunctionKind"]={__ename__:!0,__constructs__:null,Vertex:{_hx_name:"Vertex",_hx_index:0,__enum__:"hxsl.FunctionKind",toString:v},Fragment:{_hx_name:"Fragment",_hx_index:1,__enum__:"hxsl.FunctionKind",
toString:v},Init:{_hx_name:"Init",_hx_index:2,__enum__:"hxsl.FunctionKind",toString:v},Helper:{_hx_name:"Helper",_hx_index:3,__enum__:"hxsl.FunctionKind",toString:v},Main:{_hx_name:"Main",_hx_index:4,__enum__:"hxsl.FunctionKind",toString:v}};Ca.__constructs__=[Ca.Vertex,Ca.Fragment,Ca.Init,Ca.Helper,Ca.Main];Ca.__empty_constructs__=[Ca.Vertex,Ca.Fragment,Ca.Init,Ca.Helper,Ca.Main];var B=K["hxsl.TGlobal"]={__ename__:!0,__constructs__:null,Radians:{_hx_name:"Radians",_hx_index:0,__enum__:"hxsl.TGlobal",
toString:v},Degrees:{_hx_name:"Degrees",_hx_index:1,__enum__:"hxsl.TGlobal",toString:v},Sin:{_hx_name:"Sin",_hx_index:2,__enum__:"hxsl.TGlobal",toString:v},Cos:{_hx_name:"Cos",_hx_index:3,__enum__:"hxsl.TGlobal",toString:v},Tan:{_hx_name:"Tan",_hx_index:4,__enum__:"hxsl.TGlobal",toString:v},Asin:{_hx_name:"Asin",_hx_index:5,__enum__:"hxsl.TGlobal",toString:v},Acos:{_hx_name:"Acos",_hx_index:6,__enum__:"hxsl.TGlobal",toString:v},Atan:{_hx_name:"Atan",_hx_index:7,__enum__:"hxsl.TGlobal",toString:v},
Pow:{_hx_name:"Pow",_hx_index:8,__enum__:"hxsl.TGlobal",toString:v},Exp:{_hx_name:"Exp",_hx_index:9,__enum__:"hxsl.TGlobal",toString:v},Log:{_hx_name:"Log",_hx_index:10,__enum__:"hxsl.TGlobal",toString:v},Exp2:{_hx_name:"Exp2",_hx_index:11,__enum__:"hxsl.TGlobal",toString:v},Log2:{_hx_name:"Log2",_hx_index:12,__enum__:"hxsl.TGlobal",toString:v},Sqrt:{_hx_name:"Sqrt",_hx_index:13,__enum__:"hxsl.TGlobal",toString:v},Inversesqrt:{_hx_name:"Inversesqrt",_hx_index:14,__enum__:"hxsl.TGlobal",toString:v},
Abs:{_hx_name:"Abs",_hx_index:15,__enum__:"hxsl.TGlobal",toString:v},Sign:{_hx_name:"Sign",_hx_index:16,__enum__:"hxsl.TGlobal",toString:v},Floor:{_hx_name:"Floor",_hx_index:17,__enum__:"hxsl.TGlobal",toString:v},Ceil:{_hx_name:"Ceil",_hx_index:18,__enum__:"hxsl.TGlobal",toString:v},Fract:{_hx_name:"Fract",_hx_index:19,__enum__:"hxsl.TGlobal",toString:v},Mod:{_hx_name:"Mod",_hx_index:20,__enum__:"hxsl.TGlobal",toString:v},Min:{_hx_name:"Min",_hx_index:21,__enum__:"hxsl.TGlobal",toString:v},Max:{_hx_name:"Max",
_hx_index:22,__enum__:"hxsl.TGlobal",toString:v},Clamp:{_hx_name:"Clamp",_hx_index:23,__enum__:"hxsl.TGlobal",toString:v},Mix:{_hx_name:"Mix",_hx_index:24,__enum__:"hxsl.TGlobal",toString:v},InvLerp:{_hx_name:"InvLerp",_hx_index:25,__enum__:"hxsl.TGlobal",toString:v},Step:{_hx_name:"Step",_hx_index:26,__enum__:"hxsl.TGlobal",toString:v},Smoothstep:{_hx_name:"Smoothstep",_hx_index:27,__enum__:"hxsl.TGlobal",toString:v},Length:{_hx_name:"Length",_hx_index:28,__enum__:"hxsl.TGlobal",toString:v},Distance:{_hx_name:"Distance",
_hx_index:29,__enum__:"hxsl.TGlobal",toString:v},Dot:{_hx_name:"Dot",_hx_index:30,__enum__:"hxsl.TGlobal",toString:v},Cross:{_hx_name:"Cross",_hx_index:31,__enum__:"hxsl.TGlobal",toString:v},Normalize:{_hx_name:"Normalize",_hx_index:32,__enum__:"hxsl.TGlobal",toString:v},LReflect:{_hx_name:"LReflect",_hx_index:33,__enum__:"hxsl.TGlobal",toString:v},Texture:{_hx_name:"Texture",_hx_index:34,__enum__:"hxsl.TGlobal",toString:v},TextureLod:{_hx_name:"TextureLod",_hx_index:35,__enum__:"hxsl.TGlobal",toString:v},
Texel:{_hx_name:"Texel",_hx_index:36,__enum__:"hxsl.TGlobal",toString:v},TextureSize:{_hx_name:"TextureSize",_hx_index:37,__enum__:"hxsl.TGlobal",toString:v},ToInt:{_hx_name:"ToInt",_hx_index:38,__enum__:"hxsl.TGlobal",toString:v},ToFloat:{_hx_name:"ToFloat",_hx_index:39,__enum__:"hxsl.TGlobal",toString:v},ToBool:{_hx_name:"ToBool",_hx_index:40,__enum__:"hxsl.TGlobal",toString:v},Vec2:{_hx_name:"Vec2",_hx_index:41,__enum__:"hxsl.TGlobal",toString:v},Vec3:{_hx_name:"Vec3",_hx_index:42,__enum__:"hxsl.TGlobal",
toString:v},Vec4:{_hx_name:"Vec4",_hx_index:43,__enum__:"hxsl.TGlobal",toString:v},IVec2:{_hx_name:"IVec2",_hx_index:44,__enum__:"hxsl.TGlobal",toString:v},IVec3:{_hx_name:"IVec3",_hx_index:45,__enum__:"hxsl.TGlobal",toString:v},IVec4:{_hx_name:"IVec4",_hx_index:46,__enum__:"hxsl.TGlobal",toString:v},BVec2:{_hx_name:"BVec2",_hx_index:47,__enum__:"hxsl.TGlobal",toString:v},BVec3:{_hx_name:"BVec3",_hx_index:48,__enum__:"hxsl.TGlobal",toString:v},BVec4:{_hx_name:"BVec4",_hx_index:49,__enum__:"hxsl.TGlobal",
toString:v},Mat2:{_hx_name:"Mat2",_hx_index:50,__enum__:"hxsl.TGlobal",toString:v},Mat3:{_hx_name:"Mat3",_hx_index:51,__enum__:"hxsl.TGlobal",toString:v},Mat4:{_hx_name:"Mat4",_hx_index:52,__enum__:"hxsl.TGlobal",toString:v},Mat3x4:{_hx_name:"Mat3x4",_hx_index:53,__enum__:"hxsl.TGlobal",toString:v},Saturate:{_hx_name:"Saturate",_hx_index:54,__enum__:"hxsl.TGlobal",toString:v},Pack:{_hx_name:"Pack",_hx_index:55,__enum__:"hxsl.TGlobal",toString:v},Unpack:{_hx_name:"Unpack",_hx_index:56,__enum__:"hxsl.TGlobal",
toString:v},PackNormal:{_hx_name:"PackNormal",_hx_index:57,__enum__:"hxsl.TGlobal",toString:v},UnpackNormal:{_hx_name:"UnpackNormal",_hx_index:58,__enum__:"hxsl.TGlobal",toString:v},ScreenToUv:{_hx_name:"ScreenToUv",_hx_index:59,__enum__:"hxsl.TGlobal",toString:v},UvToScreen:{_hx_name:"UvToScreen",_hx_index:60,__enum__:"hxsl.TGlobal",toString:v},DFdx:{_hx_name:"DFdx",_hx_index:61,__enum__:"hxsl.TGlobal",toString:v},DFdy:{_hx_name:"DFdy",_hx_index:62,__enum__:"hxsl.TGlobal",toString:v},Fwidth:{_hx_name:"Fwidth",
_hx_index:63,__enum__:"hxsl.TGlobal",toString:v},ChannelRead:{_hx_name:"ChannelRead",_hx_index:64,__enum__:"hxsl.TGlobal",toString:v},ChannelReadLod:{_hx_name:"ChannelReadLod",_hx_index:65,__enum__:"hxsl.TGlobal",toString:v},ChannelFetch:{_hx_name:"ChannelFetch",_hx_index:66,__enum__:"hxsl.TGlobal",toString:v},ChannelTextureSize:{_hx_name:"ChannelTextureSize",_hx_index:67,__enum__:"hxsl.TGlobal",toString:v},Trace:{_hx_name:"Trace",_hx_index:68,__enum__:"hxsl.TGlobal",toString:v},VertexID:{_hx_name:"VertexID",
_hx_index:69,__enum__:"hxsl.TGlobal",toString:v},InstanceID:{_hx_name:"InstanceID",_hx_index:70,__enum__:"hxsl.TGlobal",toString:v},FragCoord:{_hx_name:"FragCoord",_hx_index:71,__enum__:"hxsl.TGlobal",toString:v},FrontFacing:{_hx_name:"FrontFacing",_hx_index:72,__enum__:"hxsl.TGlobal",toString:v},FloatBitsToInt:{_hx_name:"FloatBitsToInt",_hx_index:73,__enum__:"hxsl.TGlobal",toString:v},FloatBitsToUint:{_hx_name:"FloatBitsToUint",_hx_index:74,__enum__:"hxsl.TGlobal",toString:v},IntBitsToFloat:{_hx_name:"IntBitsToFloat",
_hx_index:75,__enum__:"hxsl.TGlobal",toString:v},UintBitsToFloat:{_hx_name:"UintBitsToFloat",_hx_index:76,__enum__:"hxsl.TGlobal",toString:v},RoundEven:{_hx_name:"RoundEven",_hx_index:77,__enum__:"hxsl.TGlobal",toString:v},SetLayout:{_hx_name:"SetLayout",_hx_index:78,__enum__:"hxsl.TGlobal",toString:v},ImageStore:{_hx_name:"ImageStore",_hx_index:79,__enum__:"hxsl.TGlobal",toString:v},ComputeVar_GlobalInvocation:{_hx_name:"ComputeVar_GlobalInvocation",_hx_index:80,__enum__:"hxsl.TGlobal",toString:v},
ComputeVar_LocalInvocation:{_hx_name:"ComputeVar_LocalInvocation",_hx_index:81,__enum__:"hxsl.TGlobal",toString:v},ComputeVar_WorkGroup:{_hx_name:"ComputeVar_WorkGroup",_hx_index:82,__enum__:"hxsl.TGlobal",toString:v},ComputeVar_LocalInvocationIndex:{_hx_name:"ComputeVar_LocalInvocationIndex",_hx_index:83,__enum__:"hxsl.TGlobal",toString:v},AtomicAdd:{_hx_name:"AtomicAdd",_hx_index:84,__enum__:"hxsl.TGlobal",toString:v},GroupMemoryBarrier:{_hx_name:"GroupMemoryBarrier",_hx_index:85,__enum__:"hxsl.TGlobal",
toString:v},UnpackSnorm4x8:{_hx_name:"UnpackSnorm4x8",_hx_index:86,__enum__:"hxsl.TGlobal",toString:v},UnpackUnorm4x8:{_hx_name:"UnpackUnorm4x8",_hx_index:87,__enum__:"hxsl.TGlobal",toString:v}};B.__constructs__=[B.Radians,B.Degrees,B.Sin,B.Cos,B.Tan,B.Asin,B.Acos,B.Atan,B.Pow,B.Exp,B.Log,B.Exp2,B.Log2,B.Sqrt,B.Inversesqrt,B.Abs,B.Sign,B.Floor,B.Ceil,B.Fract,B.Mod,B.Min,B.Max,B.Clamp,B.Mix,B.InvLerp,B.Step,B.Smoothstep,B.Length,B.Distance,B.Dot,B.Cross,B.Normalize,B.LReflect,B.Texture,B.TextureLod,
B.Texel,B.TextureSize,B.ToInt,B.ToFloat,B.ToBool,B.Vec2,B.Vec3,B.Vec4,B.IVec2,B.IVec3,B.IVec4,B.BVec2,B.BVec3,B.BVec4,B.Mat2,B.Mat3,B.Mat4,B.Mat3x4,B.Saturate,B.Pack,B.Unpack,B.PackNormal,B.UnpackNormal,B.ScreenToUv,B.UvToScreen,B.DFdx,B.DFdy,B.Fwidth,B.ChannelRead,B.ChannelReadLod,B.ChannelFetch,B.ChannelTextureSize,B.Trace,B.VertexID,B.InstanceID,B.FragCoord,B.FrontFacing,B.FloatBitsToInt,B.FloatBitsToUint,B.IntBitsToFloat,B.UintBitsToFloat,B.RoundEven,B.SetLayout,B.ImageStore,B.ComputeVar_GlobalInvocation,
B.ComputeVar_LocalInvocation,B.ComputeVar_WorkGroup,B.ComputeVar_LocalInvocationIndex,B.AtomicAdd,B.GroupMemoryBarrier,B.UnpackSnorm4x8,B.UnpackUnorm4x8];B.__empty_constructs__=[B.Radians,B.Degrees,B.Sin,B.Cos,B.Tan,B.Asin,B.Acos,B.Atan,B.Pow,B.Exp,B.Log,B.Exp2,B.Log2,B.Sqrt,B.Inversesqrt,B.Abs,B.Sign,B.Floor,B.Ceil,B.Fract,B.Mod,B.Min,B.Max,B.Clamp,B.Mix,B.InvLerp,B.Step,B.Smoothstep,B.Length,B.Distance,B.Dot,B.Cross,B.Normalize,B.LReflect,B.Texture,B.TextureLod,B.Texel,B.TextureSize,B.ToInt,B.ToFloat,
B.ToBool,B.Vec2,B.Vec3,B.Vec4,B.IVec2,B.IVec3,B.IVec4,B.BVec2,B.BVec3,B.BVec4,B.Mat2,B.Mat3,B.Mat4,B.Mat3x4,B.Saturate,B.Pack,B.Unpack,B.PackNormal,B.UnpackNormal,B.ScreenToUv,B.UvToScreen,B.DFdx,B.DFdy,B.Fwidth,B.ChannelRead,B.ChannelReadLod,B.ChannelFetch,B.ChannelTextureSize,B.Trace,B.VertexID,B.InstanceID,B.FragCoord,B.FrontFacing,B.FloatBitsToInt,B.FloatBitsToUint,B.IntBitsToFloat,B.UintBitsToFloat,B.RoundEven,B.SetLayout,B.ImageStore,B.ComputeVar_GlobalInvocation,B.ComputeVar_LocalInvocation,
B.ComputeVar_WorkGroup,B.ComputeVar_LocalInvocationIndex,B.AtomicAdd,B.GroupMemoryBarrier,B.UnpackSnorm4x8,B.UnpackUnorm4x8];var qc=K["hxsl.SyntaxArgAccess"]={__ename__:!0,__constructs__:null,Read:{_hx_name:"Read",_hx_index:0,__enum__:"hxsl.SyntaxArgAccess",toString:v},Write:{_hx_name:"Write",_hx_index:1,__enum__:"hxsl.SyntaxArgAccess",toString:v},ReadWrite:{_hx_name:"ReadWrite",_hx_index:2,__enum__:"hxsl.SyntaxArgAccess",toString:v}};qc.__constructs__=[qc.Read,qc.Write,qc.ReadWrite];qc.__empty_constructs__=
[qc.Read,qc.Write,qc.ReadWrite];var fa=K["hxsl.Component"]={__ename__:!0,__constructs__:null,X:{_hx_name:"X",_hx_index:0,__enum__:"hxsl.Component",toString:v},Y:{_hx_name:"Y",_hx_index:1,__enum__:"hxsl.Component",toString:v},Z:{_hx_name:"Z",_hx_index:2,__enum__:"hxsl.Component",toString:v},W:{_hx_name:"W",_hx_index:3,__enum__:"hxsl.Component",toString:v}};fa.__constructs__=[fa.X,fa.Y,fa.Z,fa.W];fa.__empty_constructs__=[fa.X,fa.Y,fa.Z,fa.W];var A=function(){};A.__name__="hxsl.Tools";A.allocVarId=function(){return++A.UID};
A.getTexUVSize=function(a,b){null==b&&(b=!1);switch(a._hx_index){case 0:var c=1;break;case 1:c=2;break;case 2:case 3:c=3}b&&++c;return c};A.getDimSize=function(a,b){null==b&&(b=!1);switch(a._hx_index){case 0:var c=1;break;case 2:c=3;break;case 1:case 3:c=2}b&&++c;return c};A.getName=function(a){if(null==a.qualifiers)return a.name;for(var b=0,c=a.qualifiers;b<c.length;){var d=c[b];++b;if(4==d._hx_index)return d.n}return a.name};A.getDoc=function(a){if(null==a.qualifiers)return null;var b=0;for(a=a.qualifiers;b<
a.length;){var c=a[b];++b;if(10==c._hx_index)return c.s}return null};A.getConstBits=function(a){var b=a.type;switch(b._hx_index){case 1:b=0;for(a=a.qualifiers;b<a.length;){var c=a[b];++b;if(0==c._hx_index){b=c.max;if(null!=b){for(a=0;b>=1<<a;)++a;return a}return 8}}break;case 2:return 1;case 16:switch(b.kind._hx_index){case 3:case 4:case 5:return A.MAX_PARTIAL_MAPPINGS_BITS}break;case 17:return 3+A.MAX_CHANNELS_BITS}return 0};A.isConst=function(a){var b=a.type;switch(b._hx_index){case 16:switch(b.kind._hx_index){case 3:case 4:case 5:b=
!0;break;default:b=!1}break;case 17:b=!0;break;default:b=!1}if(b)return!0;if(null!=a.qualifiers)for(b=0,a=a.qualifiers;b<a.length;){var c=a[b];++b;if(0==c._hx_index)return!0}return!1};A.isStruct=function(a){return 13==a.type._hx_index?!0:!1};A.isArray=function(a){return 15==a.type._hx_index?!0:!1};A.hasQualifier=function(a,b){if(null!=a.qualifiers){var c=0;for(a=a.qualifiers;c<a.length;){var d=a[c];++c;if(d==b)return!0}}return!1};A.hasBorrowQualifier=function(a,b){if(null!=a.qualifiers){var c=0;for(a=
a.qualifiers;c<a.length;){var d=a[c];++c;if(11==d._hx_index)return b==d.source}}return!1};A.isTexture=function(a){switch(a._hx_index){case 10:return!0;case 11:return!0;case 17:return!0;default:return!1}};A.toString=function(a){switch(a._hx_index){case 5:var b=a.size,c=a.t;switch(c._hx_index){case 0:var d="i";break;case 1:d="";break;case 2:d="b"}return d+"vec"+b;case 9:return"Bytes"+a.size;case 10:return c=a.dim,d=a.isArray,"Sampler"+F.substr(K[c.__enum__].__constructs__[c._hx_index]._hx_name,1,null)+
(d?"Array":"");case 11:return c=a.dim,d=a.isArray,a=a.channels,"RWTexture"+F.substr(K[c.__enum__].__constructs__[c._hx_index]._hx_name,1,null)+(d?"Array":"")+"<"+(1==a?"Float":"Vec"+a)+">";case 13:c=a.vl;d=[];for(b=0;b<c.length;)a=c[b],++b,d.push(a.name+" : "+A.toString(a.type));return"{"+d.join(",")+"}";case 15:c=a.t;b=a.size;c=A.toString(c)+"[";switch(b._hx_index){case 0:a=b.v;var e=""+a;break;case 1:a=b.v,e=a.name}return c+e+"]";case 16:c=a.t;b=a.size;switch(a.kind._hx_index){case 0:d="Buffer";
break;case 1:d="StorageBuffer";break;case 2:d="RWBuffer";break;case 3:d="PartialBuffer";break;case 4:d="StoragePartialBuffer";break;case 5:d="RWPartialBuffer"}c=d+" "+A.toString(c)+"[";switch(b._hx_index){case 0:a=b.v;e=""+a;break;case 1:a=b.v,e=a.name}return c+e+"]";default:return F.substr(K[a.__enum__].__constructs__[a._hx_index]._hx_name,1,null)}};A.toType=function(a){switch(a._hx_index){case 0:return x.TInt;case 1:return x.TFloat;case 2:return x.TBool}};A.hasSideEffect=function(a){var b;var c=
a.e;switch(c._hx_index){case 0:return!1;case 1:return!1;case 2:return!1;case 3:return a=c.e,A.hasSideEffect(a);case 4:var d=c.el;for(b=0;b<d.length;)if(a=d[b],++b,A.hasSideEffect(a))return!0;return!1;case 5:switch(b=c.op,d=c.e1,c=c.e2,b._hx_index){case 4:return!0;case 20:return!0;default:return a=c,A.hasSideEffect(d)?!0:A.hasSideEffect(a)}case 6:return a=c.e1,A.hasSideEffect(a);case 7:return!0;case 8:b=c.e;d=c.args;c=b.e;if(2==c._hx_index){if(78==c.g._hx_index)return!0;a=d;c=b.e;if(2==c._hx_index)switch(b=
c.g,b._hx_index){case 79:case 84:case 85:return!0}else return!0;for(c=0;c<a.length;)if(d=a[c],++c,A.hasSideEffect(d))return!0;return!1}a=d;b=b.e;if(2==b._hx_index)switch(d=b.g,d._hx_index){case 79:case 84:case 85:return!0}else return!0;for(b=0;b<a.length;)if(d=a[b],++b,A.hasSideEffect(d))return!0;return!1;case 9:return a=c.e,A.hasSideEffect(a);case 10:return a=c.eif,b=c.eelse,A.hasSideEffect(c.econd)||A.hasSideEffect(a)?!0:null!=b?A.hasSideEffect(b):!1;case 12:return!0;case 13:return b=c.loop,A.hasSideEffect(c.it)?
!0:A.hasSideEffect(b);case 11:case 14:case 15:return!0;case 16:return a=c.e,b=c.index,A.hasSideEffect(a)?!0:A.hasSideEffect(b);case 17:d=c.el;for(b=0;b<d.length;)if(a=d[b],++b,A.hasSideEffect(a))return!0;return!1;case 18:a=c.e;var e=c.cases,f=c.def;for(b=0;b<e.length;){var g=e[b];++b;d=0;for(c=g.values;d<c.length;){var h=c[d];++d;if(A.hasSideEffect(h))return!0}if(A.hasSideEffect(g.expr))return!0}return A.hasSideEffect(a)?!0:null!=f?A.hasSideEffect(f):!1;case 19:return a=c.e,b=c.loop,A.hasSideEffect(a)?
!0:A.hasSideEffect(b);case 20:return a=c.e,A.hasSideEffect(a);case 21:return a=c.e,A.hasSideEffect(a);case 22:return!0}};A.iter=function(a,b){var c=a.e;switch(c._hx_index){case 3:a=c.e;b(a);break;case 4:var d=c.el;for(c=0;c<d.length;)a=d[c],++c,b(a);break;case 5:a=c.e1;c=c.e2;b(a);b(c);break;case 6:a=c.e1;b(a);break;case 7:c=c.init;null!=c&&b(c);break;case 8:a=c.e;d=c.args;b(a);for(c=0;c<d.length;)a=d[c],++c,b(a);break;case 9:a=c.e;b(a);break;case 10:a=c.eif;d=c.eelse;b(c.econd);b(a);null!=d&&b(d);
break;case 12:a=c.e;null!=a&&b(a);break;case 13:d=c.loop;b(c.it);b(d);break;case 16:a=c.e;c=c.index;b(a);b(c);break;case 17:d=c.el;for(c=0;c<d.length;)a=d[c],++c,b(a);break;case 18:a=c.e;d=c.cases;var e=c.def;b(a);for(c=0;c<d.length;){a=d[c];++c;for(var f=0,g=a.values;f<g.length;){var h=g[f];++f;b(h)}b(a.expr)}null!=e&&b(e);break;case 19:a=c.e;d=c.loop;b(a);b(d);break;case 20:a=c.e;b(a);break;case 21:a=c.e;b(a);break;case 22:for(d=c.args,c=0;c<d.length;)a=d[c],++c,b(a.e)}};A.map=function(a,b){var c=
a.e;switch(c._hx_index){case 0:var d=a.e;break;case 1:d=a.e;break;case 2:d=a.e;break;case 3:var e=c.e;d=q.TParenthesis(b(e));break;case 4:var f=c.el;d=[];for(c=0;c<f.length;)e=f[c],++c,d.push(b(e));d=q.TBlock(d);break;case 5:d=c.op;e=c.e1;c=c.e2;d=q.TBinop(d,b(e),b(c));break;case 6:d=c.op;e=c.e1;d=q.TUnop(d,b(e));break;case 7:e=c.v;d=c.init;d=q.TVarDecl(e,null!=d?b(d):null);break;case 8:e=c.e;var g=c.args;f=b(e);d=[];for(c=0;c<g.length;)e=g[c],++c,d.push(b(e));d=q.TCall(f,d);break;case 9:e=c.e;var h=
c.regs;d=q.TSwiz(b(e),h);break;case 10:d=c.eif;e=c.eelse;d=q.TIf(b(c.econd),b(d),null!=e?b(e):null);break;case 12:e=c.e;d=q.TReturn(null!=e?b(e):null);break;case 13:e=c.v;d=c.loop;d=q.TFor(e,b(c.it),b(d));break;case 11:case 14:case 15:d=a.e;break;case 16:e=c.e;d=c.index;d=q.TArray(b(e),b(d));break;case 17:f=c.el;d=[];for(c=0;c<f.length;)e=f[c],++c,d.push(b(e));d=q.TArrayDecl(d);break;case 18:e=c.e;g=c.cases;var k=c.def;f=b(e);d=[];for(c=0;c<g.length;){h=g[c];++c;for(var l=[],m=0,p=h.values;m<p.length;)e=
p[m],++m,l.push(b(e));d.push({values:l,expr:b(h.expr)})}d=q.TSwitch(f,d,null==k?null:b(k));break;case 19:e=c.e;d=c.loop;c=c.normalWhile;d=q.TWhile(b(e),b(d),c);break;case 20:d=c.m;g=c.args;e=c.e;d=q.TMeta(d,g,b(e));break;case 21:e=c.e;d=c.name;d=q.TField(b(e),d);break;case 22:e=c.target;f=c.code;g=c.args;c=[];for(d=0;d<g.length;)h=g[d],++d,c.push({e:b(h.e),access:h.access});d=q.TSyntax(e,f,c)}return{e:d,t:a.t,p:a.p}};A.size=function(a){var b,c;switch(a._hx_index){case 0:return 0;case 1:case 3:return 1;
case 2:case 4:return 0;case 5:return c=a.size;case 6:return 9;case 7:return 16;case 8:return 12;case 9:return a=a.size;case 10:return 0;case 11:return 0;case 12:return 4;case 13:var d=a.vl;for(b=a=0;b<d.length;)c=d[b],++b,a+=A.size(c.type);return a;case 14:return 0;case 15:b=a.t;c=a.size;switch(c._hx_index){case 0:return c=c.v,A.size(b)*c;case 1:return 0}break;case 16:return b=a.size,0==b._hx_index?(c=b.v,b=a.t,A.size(b)*c):0;case 17:return c=a.size}};A.evalConst=function(a){var b=a.e;switch(b._hx_index){case 0:var c=
b.c;switch(c._hx_index){case 0:return null;case 1:return c.b;case 2:return c.v;case 3:return c.v;case 4:return c.v}break;case 8:c=b.e;var d=b.args;b=c.e;if(2==b._hx_index)switch(b.g._hx_index){case 41:case 42:b=[];for(c=0;c<d.length;)a=d[c],++c,b.push(A.evalConst(a));d=b;if(1==d.length)return a=d[0],b=d[0],c=d[0],null==c&&(c=0),null==b&&(b=0),null==a&&(a=0),new G(a,b,c);a=d[0];b=d[1];c=d[2];null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c);case 43:b=[];for(c=0;c<d.length;)a=d[c],++c,
b.push(A.evalConst(a));d=b;if(1==d.length)return a=d[0],b=d[0],c=d[0],d=d[0],null==d&&(d=1),null==c&&(c=0),null==b&&(b=0),null==a&&(a=0),new O(a,b,c,d);a=d[0];b=d[1];c=d[2];d=d[3];null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new O(a,b,c,d);default:throw t.thrown("Unhandled constant init "+ra.toString(a));}else throw t.thrown("Unhandled constant init "+ra.toString(a));default:throw t.thrown("Unhandled constant init "+ra.toString(a));}};var Z=function(){};Z.__name__="hxsl.Tools2";
Z.toString=function(a){a=K[a.__enum__].__constructs__[a._hx_index]._hx_name;return a.charAt(0).toLowerCase()+F.substr(a,1,null)};var Qe=function(){this.Batch_Count__=0;na.call(this)};Qe.__name__="hxsl.BatchShader";Qe.__super__=na;Qe.prototype=D(na.prototype,{get_Batch_HasOffset:function(){return this.Batch_HasOffset__},set_Batch_HasOffset:function(a){this.constModified=!0;return this.Batch_HasOffset__=a},get_Batch_UseStorage:function(){return this.Batch_UseStorage__},set_Batch_UseStorage:function(a){this.constModified=
!0;return this.Batch_UseStorage__=a},get_Batch_Count:function(){return this.Batch_Count__},set_Batch_Count:function(a){this.constModified=!0;return this.Batch_Count__=a},get_Batch_Buffer:function(){return this.Batch_Buffer__},set_Batch_Buffer:function(a){return this.Batch_Buffer__=a},get_Batch_StorageBuffer:function(){return this.Batch_StorageBuffer__},set_Batch_StorageBuffer:function(a){return this.Batch_StorageBuffer__=a},updateConstants:function(a){this.constBits=0;this.Batch_HasOffset__&&(this.constBits|=
1);this.Batch_UseStorage__&&(this.constBits|=2);var b=this.Batch_Count__;if(0!=b>>>13)throw t.thrown("Batch_Count is out of range "+b+">8191, consider using @const(MAX_VALUE)");this.constBits|=b<<2;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.Batch_HasOffset__;case 1:return this.Batch_UseStorage__;case 2:return this.Batch_Count__;case 3:return this.Batch_Buffer__;case 4:return this.Batch_StorageBuffer__}return null},getParamFloatValue:function(a){return 2==
a?this.Batch_Count__:0},setParamIndexValue:function(a,b){switch(a){case 0:this.Batch_HasOffset__=b;break;case 1:this.Batch_UseStorage__=b;break;case 2:this.Batch_Count__=b;break;case 3:this.Batch_Buffer__=b;break;case 4:this.Batch_StorageBuffer__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Qe.prototype);a.shader=this.shader;a.Batch_HasOffset__=this.Batch_HasOffset__;a.Batch_UseStorage__=this.Batch_UseStorage__;a.Batch_Count__=this.Batch_Count__;a.Batch_Buffer__=
this.Batch_Buffer__;a.Batch_StorageBuffer__=this.Batch_StorageBuffer__;return a},__class__:Qe});var sh=function(){this.minId=0;this.nexts=[]};sh.__name__="hxsl.SearchMap";sh.prototype={set:function(a,b){if(0==this.minId)this.minId=a,this.nexts=[b];else{a-=this.minId;if(0>a){for(var c=[],d=0,e=this.nexts.length;d<e;){var f=d++;c[f-a]=this.nexts[f]}this.nexts=c;this.minId+=a;a=0}this.nexts[a]=b}},get:function(a){return this.nexts[a-this.minId]},__class__:sh};var nd=function(){this.linkCache=new sh;
this.linkShaders=new Sa;this.batchShaders=new Cc;this.batchShadersParams=new Sa;this.byID=new Sa};nd.__name__="hxsl.Cache";nd.get=function(){var a=nd.INST;null==a&&(a=new nd,nd.INST=a);return a};nd.set=function(a){nd.INST=a};nd.clear=function(){nd.INST=null};nd.prototype={getLinkShader:function(a){for(var b=[],c=0;c<a.length;){var d=a[c];++c;b.push(y.string(d))}b=b.join(",");c=this.linkShaders.h[b];if(null!=c)return c;var e=new Ob("");c=F.substr(Ic.encode(b),0,8);e.data={name:"shaderLinker_"+c,vars:[],
funs:[]};var f=Object.create(null),g=0,h=x.TVec(4,Q.VFloat),k=function(a,b,c,d){for(var e=[],f=b,g=0,h=c.length;g<h;){var k=g++;k=d(c[c.length-1-k],f-(c.length-1-k));f-=A.size(k.t);e.unshift(k)}return{e:q.TCall({e:q.TGlobal(a),t:x.TVoid,p:null},e),t:x.TVec(b,Q.VFloat),p:null}},l=function(a,b,c){var d=null==c?a:A.getName(c)+"."+a,g=f[d];if(null!=g)return g;g={id:A.allocVarId(),name:a,type:b,kind:L.Var,parent:c};if(null==c)e.data.vars.push(g);else if(a=c.type,13==a._hx_index)a.vl.push(g);else throw t.thrown("assert");
return f[d]=g},m=null;m=function(a,b){switch(a._hx_index){case 0:var c=a.v;return{e:q.TConst(E.CFloat(c)),t:x.TFloat,p:null};case 1:var d=a.v;a=a.size;c=f[d];if(null!=c)return{e:q.TVar(c),t:c.type,p:null};c=d.split(".");for(d=null;1<c.length;)d=l(c.shift(),x.TStruct([]),d);null!=a&&(b=a);c=l(c.shift(),1==b?x.TFloat:x.TVec(b,Q.VFloat),d);return{e:q.TVar(c),t:c.type,p:null};case 2:return c=a.v,{e:q.TCall({e:q.TGlobal(B.PackNormal),t:x.TVoid,p:null},[m(c,3)]),t:h,p:null};case 3:return c=a.v,{e:q.TCall({e:q.TGlobal(B.Pack),
t:x.TVoid,p:null},[m(c,1)]),t:h,p:null};case 4:return b=a.a,k(B.Vec2,2,b,m);case 5:return b=a.a,k(B.Vec3,3,b,m);case 6:return b=a.a,k(B.Vec4,4,b,m);case 7:return c=a.a,b=a.swiz,{e:q.TSwiz(m(c,4),b),t:x.TVec(b.length,Q.VFloat),p:null}}};var p=function(a){g+=1;var b={id:A.allocVarId(),type:h,name:"OUTPUT"+(g-1),kind:L.Output};e.data.vars.push(b);return{e:q.TBinop(aa.OpAssign,{e:q.TVar(b),t:h,p:null},m(a,4)),t:x.TVoid,p:null}};c=function(a,b){for(var c={id:A.allocVarId(),type:x.TFun([]),name:(""+y.string(a)).toLowerCase(),
kind:L.Function},d=[],f=0;f<b.length;){var g=b[f];++f;d.push(p(g))}a={kind:a,ref:c,args:[],ret:x.TVoid,expr:{e:q.TBlock(d),p:null,t:x.TVoid}};e.data.funs.push(a)};c(Ca.Vertex,[Sb.Value("output.position")]);c(Ca.Fragment,a);c=Object.create(na.prototype);c.shader=e;this.linkShaders.h[b]=c;c.updateConstantsFinal(null);return c},link:function(a,b){for(var c=this.linkCache,d=a;null!=d;){var e=d.s;d=d.next;e=e.instance;var f=c.nexts[e.id-c.minId];null==f&&(f=new sh,c.set(e.id,f));c=f}null==c.linked&&(c.linked=
this.compileRuntimeShader(a,b));return c.linked},compileRuntimeShader:function(a,b){var c,d=[],e=0;var f=a;for(var g=null;f!=g;){var h=f.s;f=f.next;var k=h;var l=k.instance;d.push({inst:l,p:k.priority,index:e++})}d.reverse();ub.sort(d,function(a,b){return b.p-a.p});f=new Li(b);try{var m=[];for(c=0;c<d.length;)k=d[c],++c,m.push(k.inst.shader);h=f.link(m)}catch(n){c=t.caught(n).unwrap();if(c instanceof kb){a=c;c=[];for(f=0;f<d.length;)k=d[f],++f,c.push(ra.shaderToString(k.inst.shader));a.msg+="\n\nin\n\n"+
c.join("\n-----\n");throw t.thrown(a);}throw n;}if(b==Fb.Batch){var p=null;p=function(a){null!=a.qualifiers&&0<=a.qualifiers.indexOf(ma.PerObject)&&(1==a.qualifiers.length?a.qualifiers=null:(a.qualifiers=a.qualifiers.slice(),F.remove(a.qualifiers,ma.PerObject)),a.kind!=L.Var&&(a.kind=L.Local));var b=a.type;if(13==b._hx_index){var c=b.vl;for(b=0;b<c.length;)a=c[b],++b,p(a)}};m=0;for(c=h.vars;m<c.length;)k=c[m],++m,p(k)}l=new Mi;try{var q=l.split(h,b==Fb.Batch)}catch(n){c=t.caught(n).unwrap();if(c instanceof
kb)throw a=c,a.msg+="\n\nin\n\n"+ra.shaderToString(h),t.thrown(a);throw n;}h=new Fa;m=0;for(c=f.allVars;m<c.length;)k=c[m],++m,k.v.kind==L.Param&&(f=k.v.type,13!=f._hx_index&&(f=d[k.instanceIndex],g=l.varMap.h[k.v.__id__],h.h[null==g?k.id:g.id]={instance:f.index,index:f.inst.params.h[k.merged[0].id]}));c=(new Ni).dce(q);q=this.buildRuntimeShader(c,h);q.mode=b;m=[];f=a;for(g=null;f!=g;)h=f.s,f=f.next,k=h,m.push(new Oi(k.shader,k.constBits));q.spec={instances:m,signature:null};m=0;for(c=d.length;m<
c;)l=m++,h=d[d.length-1-l],q.spec.instances[h.index].index=l;m=[];c=0;for(f=q.spec.instances;c<f.length;)l=f[c],++c,m.push(l.shader.data.name+"_"+l.bits+"_"+l.index);d=m.join(":");q.spec.signature=Ic.encode(d);m=[];c=0;for(f=q.getShaders();c<f.length;)h=f[c],++c,m.push(ra.shaderToString(h.data));q.signature=Ic.encode(m.join(""));d=this.byID.h[q.signature];null!=d?q.id=d.id:this.byID.h[q.signature]=q;return q},buildRuntimeShader:function(a,b){var c=new rg;c.globals=new Fa;for(var d=0;d<a.length;){var e=
a[d];++d;switch(e.name){case "fragment":var f=Ca.Fragment;break;case "main":f=Ca.Main;break;case "vertex":f=Ca.Vertex;break;default:throw t.thrown("assert");}e=this.flattenShader(e,f,b);e.kind=f;switch(f._hx_index){case 0:c.vertex=e;break;case 1:c.fragment=e;break;case 4:c.vertex=e;break;default:throw t.thrown("assert");}this.initGlobals(c,e)}return c},initGlobals:function(a,b){for(var c=b.globals;null!=c;)a.globals.h[c.gid]=!0,c=c.next;for(c=b.params;null!=c;)null!=c.perObjectGlobal&&(a.globals.h[c.perObjectGlobal.gid]=
!0),c=c.next},getPath:function(a){return null==a.parent?a.name:this.getPath(a.parent)+"."+a.name},flattenShader:function(a,b,c){var d,e=new zb,f=new Pi;a=e.flatten(a,b);var g=[],h=[];f.texturesCount=0;for(var k=e.allocData.keys();k.hasNext();){b=k.next();var l=e.allocData.h[b.__id__];switch(b.kind._hx_index){case 0:var m=[];for(d=0;d<l.length;){var p=l[d];++d;null!=p.v&&m.push(new sg(p.pos,this.getPath(p.v),p.v.type))}l=0;for(d=m.length-1;l<d;)p=l++,m[p].next=m[p+1];p=b.type;if(15==p._hx_index)if(b=
p.t,p=p.size,5==b._hx_index)if(4==b.size)if(1==b.t._hx_index)if(0==p._hx_index)b=p.v,f.globals=m[0],f.globalsSize=b;else throw t.thrown("assert");else throw t.thrown("assert");else throw t.thrown("assert");else throw t.thrown("assert");else throw t.thrown("assert");break;case 2:m=[];for(d=p=0;d<l.length;){var q=l[d];++d;if(null!=q.v){var n=c.h[q.v.id];if(null==n)n=new Hf(q.v.name,q.pos,-1,-1,q.v.type),n.perObjectGlobal=new sg(-1,this.getPath(q.v),q.v.type),m.push(n),++p;else{n=new Hf(q.v.name,q.pos,
n.instance,n.index,q.v.type);var u=q.v.type;15==u._hx_index?A.isTexture(u.t)?(n.pos=-q.size,p+=q.size):++p:++p;m.push(n)}}}l=0;for(d=m.length-1;l<d;)q=l++,m[q].next=m[q+1];l=b.type;if(15==l._hx_index)if(b=l.t,l=l.size,d=b,A.isTexture(d))g.push({t:d,all:m}),f.texturesCount+=p;else switch(b._hx_index){case 5:if(4==b.size)if(1==b.t._hx_index)if(0==l._hx_index)b=l.v,f.params=m[0],f.paramsSize=b;else throw t.thrown("assert");else throw t.thrown("assert");else throw t.thrown("assert");break;case 16:b=b.kind;
for(b=0;b<m.length;)p=m[b],++b,null!=p&&h.push(p);break;default:throw t.thrown("assert");}else throw t.thrown("assert");break;default:throw t.thrown("assert");}}if(0<g.length)for(g.sort(function(a,b){var c=a.t;var d=b.t;switch(c._hx_index){case 10:return 10==d._hx_index?(a=d.dim,b=d.isArray,d=c.isArray,c=c.dim,d!=b?d?1:-1:c._hx_index-a._hx_index):a.t._hx_index-b.t._hx_index;case 11:return 11==d._hx_index?(a=d.dim,b=d.isArray,d=c.isArray,c=c.dim,d!=b?d?1:-1:c._hx_index-a._hx_index):a.t._hx_index-b.t._hx_index;
default:return a.t._hx_index-b.t._hx_index}}),f.textures=g[0].all[0],m=1,d=g.length;m<d;)p=m++,c=g[p-1].all,c[c.length-1].next=g[p].all[0];0<h.length&&h.sort(function(a,b){var c=a.type,d=b.type;return 16==c._hx_index?16==d._hx_index?c.kind._hx_index-d.kind._hx_index:a.type._hx_index-b.type._hx_index:a.type._hx_index-b.type._hx_index});n=null;for(m=0;m<h.length;)c=h[m],++m,null==f.buffers?(f.buffers=c,n=f.buffers):(n.next=c,n=n.next);f.bufferCount=h.length;null==f.globals&&(f.globalsSize=0);null==
f.params&&(f.paramsSize=0);f.data=a;return f},makeBatchShader:function(a,b,c){if(null==c)var d=this.batchShaders;else{var e=this.batchShadersParams;var f=c.getSignature();d=e.h[f];null==d&&(d=new Cc,e=this.batchShadersParams,f=c.getSignature(),e.h[f]=d)}f=d.h[a.__id__];null==f&&(f=this.createBatchShader(a,b,c),d.set(a,f));a=Object.create(Qe.prototype);a.shader=f.shader;a.params=f.params;a.paramsSize=f.size;return a},isPerInstance:function(a){if(null==a.qualifiers)return!1;var b=0;for(a=a.qualifiers;b<
a.length;){var c=a[b];++b;switch(c._hx_index){case 3:c=!0;break;case 9:c=!0;break;default:c=!1}if(c)return!0}return!1},createBatchShader:function(a,b,c){var d=new Ob(""),e=F.substr(null==c?a.spec.signature:Ic.encode(a.spec.signature+c.getSignature()),0,8),f=function(a,b,c){return{id:A.allocVarId(),type:b,name:a,kind:c}},g=[];if(null!=c)for(var h=c.forcedPerInstance,k=1,l=h.length-1,m=b;null!=m&&0<=l;)m.s.shader.data.name==h[l].shader&&(g[k]=h[l].params,--l),++k,m=m.next;h=f("Batch_HasOffset",x.TBool,
L.Param);m=f("Batch_Start",x.TFloat,L.Input);h.qualifiers=[ma.Const()];m.qualifiers=[ma.PerInstance(1)];k=f("Batch_UseStorage",x.TBool,L.Param);l=f("Batch_Count",x.TInt,L.Param);var p=f("Batch_Buffer",x.TBuffer(x.TVec(4,Q.VFloat),Za.SVar(l),Ab.Uniform),L.Param);var r=f("Batch_StorageBuffer",x.TBuffer(x.TVec(4,Q.VFloat),Za.SConst(0),Ab.RW),L.Param);var n=f("Batch_Offset",x.TInt,L.Local),u={e:q.TVar(p),p:null,t:p.type},w={e:q.TVar(r),p:null,t:r.type},v={e:q.TVar(n),p:null,t:n.type},z=x.TVec(4,Q.VFloat);
l.qualifiers=[ma.Const(65536)];k.qualifiers=[ma.Const()];d.data={name:"batchShader_"+e,vars:[l,h,k,p,r,n,m],funs:[]};var C=null;C=function(a,b,c){if(a.kind==c&&a.name==b)return a;var d=a.type;if(13==d._hx_index){var e=d.vl;for(d=0;d<e.length;)if(a=e[d],++d,a=C(a,b,c),null!=a)return a}return null};n=function(a){var c,d=b;if(null!=a.perObjectGlobal)for(var e=a.perObjectGlobal.path.split(".");null!=d;){var f=0;for(c=d.s.shader.data.vars;f<c.length;){var g=c[f];++f;if(g.name==e[0]&&(g=C(g,a.name,L.Global),
null!=g))return g}d=d.next}else{for(c=a.instance-1;0<c;)--c,d=d.next;for(e=a.name;;){f=0;for(c=d.s.shader.data.vars;f<c.length;)if(g=c[f],++f,g=C(g,e,L.Param),null!=g)return g;c=F.cca(e,e.length-1);if(48<=c&&57>=c)e=F.substr(e,0,-1);else break}}throw t.thrown("Var not found "+a.name);};c=null;var D=[],G=[],H=function(a){var b;var d=null!=a.perObjectGlobal?-a.perObjectGlobal.gid:1024*a.instance+a.index;if(!(0<=G.indexOf(d))){G.push(d);d=a.type;switch(d._hx_index){case 3:var e=1;break;case 5:if(1==
d.t._hx_index)e=d.size;else throw t.thrown("Unsupported batch var type "+y.string(a.type));break;case 7:e=16;break;default:throw t.thrown("Unsupported batch var type "+y.string(a.type));}if(4<=e){var f=D.length<<2;d=0;for(b=e>>2;d<b;)d++,D.push(15)}else if(1==e){e=-1;d=0;for(b=D.length;d<b;)f=d++,15!=D[f]&&(0>e||D[e]<D[f])&&(e=f);0>e&&(e=D.length,D.push(0));f=e<<2;for(d=0;4>d;){var g=d++;b=3-g;if(0==(D[e]&1<<b)){D[e]|=1<<b;f+=b;break}}}else{g=2==e?3:7;e=-1;d=0;for(b=D.length;d<b;)if(f=d++,0==(D[f]&
g)){D[f]|=g;e=f;break}0>e&&(e=D.length,D.push(g));f=e<<2}d=new Hf(a.name,f,a.instance,a.index,a.type);d.perObjectGlobal=a.perObjectGlobal;d.next=c;c=d}};for(e=a.vertex.params;null!=e;)r=n(e),p=g[e.instance],(null!=p&&0<=p.indexOf(r.name)||this.isPerInstance(r))&&H(e),e=e.next;for(e=a.fragment.params;null!=e;)r=n(e),p=g[e.instance],(null!=p&&0<=p.indexOf(r.name)||this.isPerInstance(r))&&H(e),e=e.next;var J=new Cc,M=[[fa.X],[fa.Y],[fa.Z],[fa.W]],K=function(a,b){return{e:q.TArray(a,{e:q.TBinop(aa.OpAdd,
v,{e:q.TConst(E.CInt(b)),t:x.TInt,p:null}),t:x.TInt,p:null}),t:z,p:null}};r=function(a){var b=f(a.name,a.type,L.Local);if(null!=a.perObjectGlobal){a=a.perObjectGlobal.path.split(".");a.pop();for(var c=b;0<a.length;){a.join(".");var e=a.pop(),g=J.h[a.__id__];null==g&&(g=f(e,x.TStruct([]),L.Local),J.set(a,g));e=g.type;13==e._hx_index&&e.vl.push(c);c=c.parent=g}}d.data.vars.push(b);return b};n=function(a,b,c){var d=c.pos>>2,e=c.type;switch(e._hx_index){case 3:b={p:null,t:c.type,e:q.TSwiz(K(b,d),M[c.pos&
3])};break;case 5:var f=e.t;switch(e.size){case 2:if(1==f._hx_index){switch(c.pos&3){case 0:e=[fa.X,fa.Y];break;case 1:e=[fa.Y,fa.Z];break;default:e=[fa.Z,fa.W]}b={p:null,t:c.type,e:q.TSwiz(K(b,d),e)}}else throw t.thrown("assert");break;case 3:if(1==f._hx_index)b={p:null,t:c.type,e:q.TSwiz(K(b,d),0==(c.pos&3)?[fa.X,fa.Y,fa.Z]:[fa.Y,fa.Z,fa.W])};else throw t.thrown("assert");break;case 4:if(1==f._hx_index)b=K(b,d);else throw t.thrown("assert");break;default:throw t.thrown("assert");}break;case 7:b=
{p:null,t:c.type,e:q.TCall({e:q.TGlobal(B.Mat4),t:x.TVoid,p:null},[K(b,d),K(b,d+1),K(b,d+2),K(b,d+3)])};break;default:throw t.thrown("assert");}return{p:null,e:q.TBinop(aa.OpAssign,{e:q.TVar(a),p:null,t:c.type},b),t:x.TVoid}};g=[];p=[];a=D.length;for(e=c;null!=e;)H=r(e),g.push(n(H,u,e)),p.push(n(H,w,e)),e=e.next;u=[];u.push({p:null,e:q.TBinop(aa.OpAssign,v,{e:q.TGlobal(B.InstanceID),t:x.TInt,p:null}),t:x.TVoid});u.push({p:null,e:q.TIf({e:q.TVar(h),t:x.TBool,p:null},{p:null,e:q.TBinop(aa.OpAssignOp(aa.OpAdd),
v,{e:q.TCall({e:q.TGlobal(B.ToInt),t:x.TVoid,p:null},[{p:null,t:x.TFloat,e:q.TVar(m)}]),t:x.TInt,p:null}),t:x.TVoid},null),t:x.TVoid});u.push({p:null,t:x.TInt,e:q.TBinop(aa.OpAssignOp(aa.OpMult),v,{e:q.TConst(E.CInt(a)),t:x.TInt,p:null})});u.push({p:null,e:q.TIf({e:q.TVar(k),t:x.TBool,p:null},{p:null,e:q.TBlock(p),t:x.TVoid},{p:null,e:q.TBlock(g),t:x.TVoid}),t:x.TVoid});m=f("init",x.TFun([]),L.Function);m={kind:Ca.Init,ref:m,args:[],ret:x.TVoid,expr:{e:q.TBlock(u),p:null,t:x.TVoid}};d.data.funs.push(m);
d.consts=new If(l,2,17);d.consts.globalId=0;d.consts.next=new If(h,0,1);d.consts.next.globalId=0;d.consts.next.next=new If(k,1,1);d.consts.next.next.globalId=0;return{shader:d,params:c,size:a}},__class__:nd};var lb=K["hxsl.Channel"]={__ename__:!0,__constructs__:null,Unknown:{_hx_name:"Unknown",_hx_index:0,__enum__:"hxsl.Channel",toString:v},R:{_hx_name:"R",_hx_index:1,__enum__:"hxsl.Channel",toString:v},G:{_hx_name:"G",_hx_index:2,__enum__:"hxsl.Channel",toString:v},B:{_hx_name:"B",_hx_index:3,__enum__:"hxsl.Channel",
toString:v},A:{_hx_name:"A",_hx_index:4,__enum__:"hxsl.Channel",toString:v},PackedFloat:{_hx_name:"PackedFloat",_hx_index:5,__enum__:"hxsl.Channel",toString:v},PackedNormal:{_hx_name:"PackedNormal",_hx_index:6,__enum__:"hxsl.Channel",toString:v}};lb.__constructs__=[lb.Unknown,lb.R,lb.G,lb.B,lb.A,lb.PackedFloat,lb.PackedNormal];lb.__empty_constructs__=[lb.Unknown,lb.R,lb.G,lb.B,lb.A,lb.PackedFloat,lb.PackedNormal];var me=K["hxsl._Checker.FieldAccess"]={__ename__:!0,__constructs__:null,FField:(z=function(a){return{_hx_index:0,
e:a,__enum__:"hxsl._Checker.FieldAccess",toString:v}},z._hx_name="FField",z.__params__=["e"],z),FGlobal:(z=function(a,b,c){return{_hx_index:1,g:a,arg:b,variants:c,__enum__:"hxsl._Checker.FieldAccess",toString:v}},z._hx_name="FGlobal",z.__params__=["g","arg","variants"],z)};me.__constructs__=[me.FField,me.FGlobal];me.__empty_constructs__=[];var Ba=K["hxsl._Checker.WithType"]={__ename__:!0,__constructs__:null,NoValue:{_hx_name:"NoValue",_hx_index:0,__enum__:"hxsl._Checker.WithType",toString:v},Value:{_hx_name:"Value",
_hx_index:1,__enum__:"hxsl._Checker.WithType",toString:v},InBlock:{_hx_name:"InBlock",_hx_index:2,__enum__:"hxsl._Checker.WithType",toString:v},With:(z=function(a){return{_hx_index:3,t:a,__enum__:"hxsl._Checker.WithType",toString:v}},z._hx_name="With",z.__params__=["t"],z)};Ba.__constructs__=[Ba.NoValue,Ba.Value,Ba.InBlock,Ba.With];Ba.__empty_constructs__=[Ba.NoValue,Ba.Value,Ba.InBlock];var U=function(){this.globals=U.initGlobals()};U.__name__="hxsl.Checker";U.initGlobals=function(){var a,b;if(null!=
U.GLOBALS)return U.GLOBALS;var c=new Sa;var d=[x.TFloat,U.vec2,U.vec3,U.vec4],e=[x.TInt,U.ivec2,U.ivec3,U.ivec4],f=[x.TFloat,x.TBool,x.TInt];var g=[];for(a=0;a<d.length;){var h=d[a];++a;g.push({args:[{name:"value",type:h}],ret:h})}var k=g;g=[];for(a=0;a<d.length;)h=d[a],++a,g.push({args:[{name:"a",type:h},{name:"b",type:h}],ret:h});var l=g;g=[];for(a=0;a<d.length;)h=d[a],++a,g.push({args:[{name:"a",type:h},{name:"b",type:x.TFloat}],ret:h});var m=g,p=[{dim:Ta.T1D,arr:!1,uv:x.TFloat,iuv:x.TInt},{dim:Ta.T2D,
arr:!1,uv:U.vec2,iuv:U.ivec2},{dim:Ta.T3D,arr:!1,uv:U.vec3,iuv:U.ivec3},{dim:Ta.TCube,arr:!1,uv:U.vec3,iuv:U.ivec3},{dim:Ta.T1D,arr:!0,uv:U.vec2,iuv:U.ivec2},{dim:Ta.T2D,arr:!0,uv:U.vec3,iuv:U.ivec3},{dim:Ta.TCube,arr:!0,uv:U.vec4,iuv:U.ivec4}],q=Object.create(null);g=0;for(a=B.__empty_constructs__.slice();g<a.length;){var n=a[g];++g;switch(n._hx_index){case 7:var u=k.concat(l);break;case 8:u=l;break;case 20:case 21:case 22:u=l.concat(m);break;case 23:u=[{args:[{name:"value",type:x.TInt},{name:"min",
type:x.TInt},{name:"max",type:x.TInt}],ret:x.TInt}];for(b=0;b<d.length;)h=d[b],++b,u.push({args:[{name:"value",type:h},{name:"min",type:h},{name:"max",type:h}],ret:h}),h!=x.TFloat&&u.push({args:[{name:"value",type:h},{name:"min",type:x.TFloat},{name:"max",type:x.TFloat}],ret:h});break;case 24:h=[];for(u=0;u<d.length;)b=d[u],++u,h.push({args:[{name:"x",type:b},{name:"y",type:b},{name:"a",type:b}],ret:b}),b!=x.TFloat&&h.push({args:[{name:"x",type:b},{name:"y",type:b},{name:"a",type:x.TFloat}],ret:b});
u=h;break;case 25:u=[{args:[{name:"a",type:x.TFloat},{name:"x",type:x.TFloat},{name:"y",type:x.TFloat}],ret:x.TFloat}];break;case 26:h=[];for(u=0;u<d.length;)b=d[u],++u,h.push({args:[{name:"edge",type:b},{name:"x",type:b}],ret:b}),b!=x.TFloat&&h.push({args:[{name:"edge",type:x.TFloat},{name:"x",type:b}],ret:b});u=h;break;case 27:h=[];for(u=0;u<d.length;)b=d[u],++u,h.push({args:[{name:"edge0",type:b},{name:"edge1",type:b},{name:"x",type:b}],ret:b}),b!=x.TFloat&&h.push({args:[{name:"edge0",type:x.TFloat},
{name:"edge1",type:x.TFloat},{name:"x",type:b}],ret:b});u=h;break;case 28:h=[];for(u=0;u<d.length;)b=d[u],++u,h.push({args:[{name:"value",type:b}],ret:x.TFloat});u=h;break;case 29:case 30:h=[];for(u=0;u<d.length;)b=d[u],++u,h.push({args:[{name:"a",type:b},{name:"b",type:b}],ret:x.TFloat});u=h;break;case 31:u=[{args:[{name:"a",type:U.vec3},{name:"b",type:U.vec3}],ret:U.vec3}];break;case 32:u=k;break;case 33:u=l;break;case 34:h=[];for(u=0;u<p.length;)b=p[u],++u,h.push({args:[{name:"tex",type:x.TSampler(b.dim,
b.arr)},{name:"uv",type:b.uv}],ret:U.vec4});u=h;break;case 35:h=[];for(u=0;u<p.length;)b=p[u],++u,h.push({args:[{name:"tex",type:x.TSampler(b.dim,b.arr)},{name:"uv",type:b.uv},{name:"lod",type:x.TFloat}],ret:U.vec4});u=h;break;case 36:h=[];for(u=0;u<p.length;)b=p[u],++u,h.push({args:[{name:"tex",type:x.TSampler(b.dim,b.arr)},{name:"pos",type:b.iuv}],ret:U.vec4});u=h;break;case 37:u=[];break;case 38:h=[];for(u=0;u<f.length;)b=f[u],++u,h.push({args:[{name:"value",type:b}],ret:x.TInt});u=h;break;case 39:h=
[];for(u=0;u<f.length;)b=f[u],++u,h.push({args:[{name:"value",type:b}],ret:x.TFloat});u=h;break;case 40:h=[];for(u=0;u<f.length;)b=f[u],++u,h.push({args:[{name:"value",type:b}],ret:x.TBool});u=h;break;case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:u=[];break;case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 54:case 77:u=k;break;case 55:u=[{args:[{name:"value",
type:x.TFloat}],ret:U.vec4}];break;case 56:u=[{args:[{name:"value",type:U.vec4}],ret:x.TFloat}];break;case 57:u=[{args:[{name:"value",type:U.vec3}],ret:U.vec4}];break;case 58:u=[{args:[{name:"value",type:U.vec4}],ret:U.vec3}];break;case 59:u=[{args:[{name:"screenPos",type:U.vec2}],ret:U.vec2}];break;case 60:u=[{args:[{name:"uv",type:U.vec2}],ret:U.vec2}];break;case 61:case 62:case 63:u=k;break;case 64:u=[{args:[{name:"channel",type:x.TChannel(1)},{name:"uv",type:U.vec2}],ret:x.TFloat},{args:[{name:"channel",
type:x.TChannel(2)},{name:"uv",type:U.vec2}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"uv",type:U.vec2}],ret:U.vec3},{args:[{name:"channel",type:x.TChannel(4)},{name:"uv",type:U.vec2}],ret:U.vec4}];break;case 65:u=[{args:[{name:"channel",type:x.TChannel(1)},{name:"uv",type:U.vec2},{name:"lod",type:x.TFloat}],ret:x.TFloat},{args:[{name:"channel",type:x.TChannel(2)},{name:"uv",type:U.vec2},{name:"lod",type:x.TFloat}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"uv",
type:U.vec2},{name:"lod",type:x.TFloat}],ret:U.vec3},{args:[{name:"channel",type:x.TChannel(4)},{name:"uv",type:U.vec2},{name:"lod",type:x.TFloat}],ret:U.vec4}];break;case 66:u=[{args:[{name:"channel",type:x.TChannel(1)},{name:"pos",type:U.ivec2}],ret:x.TFloat},{args:[{name:"channel",type:x.TChannel(2)},{name:"pos",type:U.ivec2}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"pos",type:U.ivec2}],ret:U.vec3},{args:[{name:"channel",type:x.TChannel(4)},{name:"pos",type:U.ivec2}],ret:U.vec4},
{args:[{name:"channel",type:x.TChannel(1)},{name:"pos",type:U.ivec2},{name:"lod",type:x.TInt}],ret:x.TFloat},{args:[{name:"channel",type:x.TChannel(2)},{name:"pos",type:U.ivec2},{name:"lod",type:x.TInt}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"pos",type:U.ivec2},{name:"lod",type:x.TInt}],ret:U.vec3},{args:[{name:"channel",type:x.TChannel(4)},{name:"pos",type:U.ivec2},{name:"lod",type:x.TInt}],ret:U.vec4}];break;case 67:u=[{args:[{name:"channel",type:x.TChannel(1)}],ret:U.vec2},
{args:[{name:"channel",type:x.TChannel(2)}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(4)}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(1)},{name:"lod",type:x.TInt}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(2)},{name:"lod",type:x.TInt}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"lod",type:x.TInt}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(4)},{name:"lod",type:x.TInt}],ret:U.vec2}];break;case 69:case 70:case 71:case 72:u=
null;break;case 73:case 74:var w=[];u=0;for(var v=d;u<v.length;)h=v[u],b=u++,w.push({args:[{name:"x",type:h}],ret:e[b]});u=w;break;case 75:case 76:h=[];u=0;for(b=d;u<b.length;)w=b[u],v=u++,h.push({args:[{name:"x",type:e[v]}],ret:w});u=h;break;case 78:u=[{args:[{name:"x",type:x.TInt},{name:"y",type:x.TInt},{name:"z",type:x.TInt}],ret:x.TVoid},{args:[{name:"x",type:x.TInt},{name:"y",type:x.TInt}],ret:x.TVoid},{args:[{name:"x",type:x.TInt}],ret:x.TVoid}];break;case 79:u=[];break;case 84:u=[{args:[{name:"buf",
type:x.TBuffer(x.TInt,Za.SConst(0),Ab.RW)},{name:"index",type:x.TInt},{name:"data",type:x.TInt}],ret:x.TInt}];break;case 68:case 85:u=[];break;case 86:if(0<K[n.__enum__].__constructs__[n._hx_index]._hx_name.indexOf("_")){u=K[n.__enum__].__constructs__[n._hx_index]._hx_name;b=u.indexOf("_");w=F.substr(u,0,b);w=w.charAt(0).toLowerCase()+F.substr(w,1,null);h=q[w];null==h&&(h=[],q[w]=h);switch(n._hx_index){case 80:case 81:case 82:w=U.ivec3;break;case 83:w=x.TInt;break;default:throw t.thrown("Unknown type for global var "+
y.string(n));}u=F.substr(u,b+1,null);u=u.charAt(0).toLowerCase()+F.substr(u,1,null);h.push({name:u,type:w});u=null}else u=[{args:[{name:"value",type:x.TInt}],ret:U.vec4}];break;case 87:if(0<K[n.__enum__].__constructs__[n._hx_index]._hx_name.indexOf("_")){u=K[n.__enum__].__constructs__[n._hx_index]._hx_name;b=u.indexOf("_");w=F.substr(u,0,b);w=w.charAt(0).toLowerCase()+F.substr(w,1,null);h=q[w];null==h&&(h=[],q[w]=h);switch(n._hx_index){case 80:case 81:case 82:w=U.ivec3;break;case 83:w=x.TInt;break;
default:throw t.thrown("Unknown type for global var "+y.string(n));}u=F.substr(u,b+1,null);u=u.charAt(0).toLowerCase()+F.substr(u,1,null);h.push({name:u,type:w});u=null}else u=[{args:[{name:"value",type:x.TInt}],ret:U.vec4}];break;default:if(0<K[n.__enum__].__constructs__[n._hx_index]._hx_name.indexOf("_")){u=K[n.__enum__].__constructs__[n._hx_index]._hx_name;b=u.indexOf("_");w=F.substr(u,0,b);w=w.charAt(0).toLowerCase()+F.substr(w,1,null);h=q[w];null==h&&(h=[],q[w]=h);switch(n._hx_index){case 80:case 81:case 82:w=
U.ivec3;break;case 83:w=x.TInt;break;default:throw t.thrown("Unknown type for global var "+y.string(n));}u=F.substr(u,b+1,null);u=u.charAt(0).toLowerCase()+F.substr(u,1,null);h.push({name:u,type:w});u=null}else throw t.thrown("Unsupported global "+y.string(n));}null!=u&&(h=Z.toString(n),c.h[h]={t:x.TFun(u),g:n})}c.h.vertexID={t:x.TInt,g:B.VertexID};c.h.instanceID={t:x.TInt,g:B.InstanceID};c.h.fragCoord={t:U.vec4,g:B.FragCoord};c.h.frontFacing={t:x.TBool,g:B.FrontFacing};d=Object.keys(q);e=d.length;
for(u=0;u<e;){b=h=d[u++];h=q[h];f=b;g=[];for(a=0;a<h.length;)k=h[a],++a,g.push({name:k.name,kind:L.Global,type:k.type,id:0});c.h[f]={t:x.TStruct(g),g:null}}c.h["int"]=c.h.toInt;c.h["float"]=c.h.toFloat;c.h.reflect=c.h.lReflect;c.h.ivec2=c.h.iVec2;h="iVec2";Object.prototype.hasOwnProperty.call(c.h,h)&&delete c.h[h];c.h.ivec3=c.h.iVec3;h="iVec3";Object.prototype.hasOwnProperty.call(c.h,h)&&delete c.h[h];c.h.ivec4=c.h.iVec4;h="iVec4";Object.prototype.hasOwnProperty.call(c.h,h)&&delete c.h[h];Object.prototype.hasOwnProperty.call(c.h,
"lReflect")&&delete c.h.lReflect;Object.prototype.hasOwnProperty.call(c.h,"toInt")&&delete c.h.toInt;Object.prototype.hasOwnProperty.call(c.h,"toFloat")&&delete c.h.toFloat;return U.GLOBALS=c};U.prototype={error:function(a,b){return kb.t(a,b)},warning:function(a,b){},loadShader:function(a){throw t.thrown("Not implemented");},check:function(a,b){this.vars=new Sa;this.inits=[];this.inWhile=this.inLoop=!1;var c=[];this.checkExpr(b,c,!1,!1);b=[];for(var d=0;d<c.length;){var e=c[d];++d;var f=e.p;e=e.f;
var g=[];for(var h=0,k=e.args;h<k.length;){var l=k[h];++h;null==l.type&&this.error("Argument type required",f);null!=l.expr&&this.error("Optional argument not supported",f);null==l.kind&&(l.kind=L.Local);l.kind!=L.Local&&this.error("Argument should be local",f);0!=l.qualifiers.length&&this.error("No qualifier allowed for argument",f);g.push({id:A.allocVarId(),name:l.name,kind:L.Local,type:l.type})}h=g;switch(e.name){case "fragment":k=Ca.Fragment;break;case "main":k=Ca.Main;break;case "vertex":k=Ca.Vertex;
break;default:k=X.startsWith(e.name,"__init__")?Ca.Init:Ca.Helper}0!=h.length&&k!=Ca.Helper&&this.error(y.string(k)+" function should have no argument",f);g=A.allocVarId();l=e.name;for(var m=[],p=0;p<h.length;){var r=h[p];++p;m.push({type:r.type,name:r.name})}g={id:g,name:l,kind:L.Function,type:x.TFun([{args:m,ret:null==e.ret?x.TVoid:e.ret}])};e={kind:k,ref:g,args:h,ret:null==e.ret?x.TVoid:e.ret,expr:null};Object.prototype.hasOwnProperty.call(this.vars.h,g.name)&&this.error("Duplicate function name",
f);this.vars.h[g.name]=g;b.push(e)}d=0;for(g=b.length;d<g;)f=d++,this.typeFun(b[f],c[f].f.expr);c=[];d=0;for(g=this.inits.slice();d<g.length;)f=g[d],++d,f.v.kind==L.Local&&(c.push({e:q.TBinop(aa.OpAssign,{e:q.TVar(f.v),p:f.e.p,t:f.v.type},f.e),p:f.e.p,t:f.v.type}),F.remove(this.inits,f));0<c.length&&(g={id:A.allocVarId(),name:"__init__consts__",kind:L.Function,type:x.TFun([{args:[],ret:x.TVoid}])},Object.prototype.hasOwnProperty.call(this.vars.h,g.name)&&this.error("assert",c[0].p),this.vars.h[g.name]=
g,b.push({kind:Ca.Init,ref:g,args:[],ret:x.TVoid,expr:{e:q.TBlock(c),p:c[0].p,t:x.TVoid}}));c=Te.array(this.vars);c.sort(function(a,b){return(0>a.id?-a.id:a.id)-(0>b.id?-b.id:b.id)});return{name:a,vars:c,funs:b}},saveVars:function(){for(var a=new Sa,b=Object.keys(this.vars.h),c=b.length,d=0;d<c;){var e=b[d++];a.h[e]=this.vars.h[e]}return a},typeFun:function(a,b){for(var c=this.saveVars(),d=0,e=a.args;d<e.length;){var f=e[d];++d;this.vars.h[f.name]=f}this.curFun=a;a.expr=this.typeExpr(b,Ba.NoValue);
this.vars=c},tryUnify:function(a,b){if(da.enumEq(a,b))return!0;switch(a._hx_index){case 5:if(5==b._hx_index){var c=b.size;var d=b.t;var e=a.t;if(a.size==c&&e==d)return!0}break;case 10:if(10==b._hx_index&&(e=b.dim,d=b.isArray,b=a.isArray,a=a.dim,a==e))return b==d;break;case 11:if(11==b._hx_index){e=b.dim;d=b.isArray;c=b.channels;var f=a.channels;b=a.isArray;a=a.dim;if(a==e&&b==d)return f==c}break;case 15:if(15==b._hx_index){d=b.t;b=b.size;c=a.size;e=a.t;switch(c._hx_index){case 0:if(0==b._hx_index){if(c.v!=
b.v)return!1}else return!1;break;case 1:if(1==b._hx_index){if(c.v!=b.v)return!1}else return!1;break;default:return!1}return this.tryUnify(e,d)}break;case 17:if(17==b._hx_index&&a.size==b.size)return!0}return!1},unify:function(a,b,c){this.tryUnify(a,b)||this.error(A.toString(a)+" should be "+A.toString(b),c)},unifyExpr:function(a,b){this.tryUnify(a.t,b)||(a.t==x.TInt&&b==x.TFloat?this.toFloat(a):this.error(A.toString(a.t)+" should be "+A.toString(b),a.p))},checkWrite:function(a){var b=a.e;switch(b._hx_index){case 1:b=
b.v;switch(b.kind._hx_index){case 2:b=b.type;switch(b._hx_index){case 11:b=!0;break;case 16:switch(b.kind._hx_index){case 2:case 5:b=!0;break;default:b=!1}break;default:b=!1}if(b)return;break;case 4:if(null==b.qualifiers||0>b.qualifiers.indexOf(ma.Final))return;b=b.type;switch(b._hx_index){case 11:b=!0;break;case 16:switch(b.kind._hx_index){case 2:case 5:b=!0;break;default:b=!1}break;default:b=!1}if(b)return;break;case 3:case 5:return}break;case 9:a=b.e;this.checkWrite(a);return;case 16:a=b.e;this.checkWrite(a);
return;case 21:a=b.e;this.checkWrite(a);return}this.error("This expression cannot be assigned",a.p)},typeWith:function(a,b){if(null==b)return this.typeExpr(a,Ba.Value);a=this.typeExpr(a,Ba.With(b));this.unifyExpr(a,b);return a},typeExpr:function(a,b){var c=this,d=null;var e=a.expr;switch(e._hx_index){case 0:var f=e.c;switch(f._hx_index){case 0:d=x.TVoid;break;case 1:var g=f.b;d=x.TBool;break;case 2:var h=f.v;3==b._hx_index?3==b.t._hx_index?(f=E.CFloat(h),d=x.TFloat):d=x.TInt:d=x.TInt;break;case 3:g=
f.v;d=x.TFloat;break;case 4:g=f.v,d=x.TString}var k=q.TConst(f);break;case 1:var l=e.i;k=this.vars.h[l];if(null!=k){switch(l){case "fragment":case "main":case "vertex":e=!1;break;default:e=!X.startsWith(l,"__init__")}e||this.error("Function cannot be accessed",a.pos);d=k.type;k=q.TVar(k)}else h=this.globals.h[l],null!=h&&null!=h.g?(d=h.t,k=q.TGlobal(h.g)):"PI"==l?(d=x.TFloat,k=q.TConst(E.CFloat(Math.PI))):k=this.error("Unknown identifier '"+l+"'",a.pos);break;case 2:var m=e.e;k=this.typeExpr(m,b);
d=k.t;k=q.TParenthesis(k);break;case 3:g=e.e;var p=e.f;e=g.expr;m=g.pos;if(1==e._hx_index)if(l=e.i,m=p,null==this.vars.h[l]&&null!=this.globals.h[l]&&null==this.globals.h[l].g)if(e=this.globals.h[l].t,13==e._hx_index){g=e.vl;for(e=0;e<g.length;)if(k=g[e],++e,k.name==m)return h=l.charAt(0).toUpperCase()+F.substr(l,1,null)+"_"+m.charAt(0).toUpperCase()+F.substr(m,1,null),{e:q.TGlobal(da.createEnum(B,h,null)),t:k.type,p:a.pos};p=l+" field should be ";e=[];for(m=0;m<g.length;)k=g[m],++m,e.push(k.name);
k=this.error(p+e.join("|"),a.pos)}else throw t.thrown("assert");else switch(m=p,l=this.typeExpr(g,Ba.Value),p=this.fieldAccess(l,m,b,a.pos),null==p&&this.error(A.toString(l.t)+" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=p.e;d=e.t;k=e.e;break;case 1:e=p.g,e=p.arg,e=p.variants,k=this.error("Global function must be called immediately",a.pos)}else switch(m=p,l=this.typeExpr(g,Ba.Value),p=this.fieldAccess(l,m,b,a.pos),null==p&&this.error(A.toString(l.t)+" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=
p.e;d=e.t;k=e.e;break;case 1:g=p.g,g=p.arg,g=p.variants,k=this.error("Global function must be called immediately",a.pos)}break;case 4:b=e.op;m=e.e1;k=e.e2;l=this.typeExpr(m,Ba.Value);f=this.typeExpr(k,Ba.With(l.t));switch(b._hx_index){case 4:this.checkWrite(l);this.unify(f.t,l.t,f.p);d=l.t;break;case 20:e=b.op;this.checkWrite(l);this.unify(this.typeBinop(e,l,f,a.pos),l.t,f.p);d=l.t;break;default:d=this.typeBinop(b,l,f,a.pos)}k=q.TBinop(b,l,f);break;case 5:b=e.op;m=e.e1;l=this.typeExpr(m,Ba.Value);
switch(b._hx_index){case 0:case 1:switch(l.t._hx_index){case 1:case 3:break;default:this.error("Cannot increment "+A.toString(l.t),a.pos)}d=x.TVoid;k=q.TBinop(aa.OpAssignOp(b==zc.OpIncrement?aa.OpAdd:aa.OpSub),l,{e:q.TConst(E.CInt(1)),t:x.TInt,p:l.p});break;case 2:this.unifyExpr(l,x.TBool);d=x.TBool;k=q.TUnop(b,l);break;case 3:g=l.t;switch(g._hx_index){case 1:case 3:break;case 5:p=g.size;switch(g.t._hx_index){case 0:case 1:break;default:this.error("Cannot negate "+A.toString(l.t),a.pos)}break;default:this.error("Cannot negate "+
A.toString(l.t),a.pos)}d=l.t;k=q.TUnop(b,l);break;default:k=this.error("Operation non supported",a.pos)}break;case 6:g=e.e;p=e.args;e=g.expr;m=g.pos;if(3==e._hx_index)if(m=e.e,h=m.expr,l=m.pos,1==h._hx_index){if("Syntax"==h.i){g=e.f;var r=p;0==r.length&&this.error("Syntax."+g+" should have a string as first argument",a.pos);e=r[0].expr;0==e._hx_index?(m=e.c,k=4==m._hx_index?m.v:this.error("Syntax."+g+" should have a string as first argument",r[0].pos)):k=this.error("Syntax."+g+" should have a string as first argument",
r[0].pos);f=[];e=1;for(m=r.length;e<m;)if(h=e++,b=r[h],h=b.expr,20==h._hx_index)switch(l=h.name,p=h.e,l){case "r":case "rw":case "w":b=l;p=this.typeExpr(p,Ba.Value);switch(b){case "r":b=qc.Read;break;case "rw":b=qc.ReadWrite;break;case "w":b=qc.Write;break;default:throw t.thrown("assert");}f.push({e:p,access:b});break;default:this.error("Syntax."+g+" arguments should have an access meta of @r, @w or @rw",b.pos)}else this.error("Syntax."+g+" arguments should have an access meta of @r, @w or @rw",b.pos);
return{e:q.TSyntax(g,k,f),t:x.TVoid,p:a.pos}}m=g;r=p;g=function(b){var e=b.t;return 14==e._hx_index?(b=c.unifyCallParams(b,r,e.variants,a.pos),d=b.t,b.e):c.error(A.toString(b.t)+" cannot be called",a.pos)};e=m.expr;if(3==e._hx_index)switch(l=e.e,m=e.f,e=this.typeExpr(l,Ba.Value),p=this.fieldAccess(e,m,b,a.pos),null==p&&this.error(A.toString(e.t)+" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=p.e;k=g(e);break;case 1:h=p.g;b=p.arg;g=p.variants;l={e:q.TGlobal(h),t:x.TFun(g),p:e.p};if(0==g.length){e=
[];for(m=0;m<r.length;)k=r[m],++m,e.push(this.typeExpr(k,Ba.Value));var n=e;n.unshift(b);k=this.specialGlobal(h,l,n,a.pos)}else if(k=this.unifyCallParams(l,r,g,a.pos),e=k.e,m=l.t,8==e._hx_index)if(h=e.e,14==m._hx_index)if(h=m.variants,1==h.length)m=h[0],n=e.args,n.unshift(b),m.args.unshift({name:"_",type:b.t});else throw t.thrown("assert");else throw t.thrown("assert");else throw t.thrown("assert");d=k.t;k=k.e}else k=g(this.typeExpr(m,Ba.Value))}else if(m=g,n=p,g=function(b){var e=b.t;return 14==
e._hx_index?(b=c.unifyCallParams(b,n,e.variants,a.pos),d=b.t,b.e):c.error(A.toString(b.t)+" cannot be called",a.pos)},e=m.expr,3==e._hx_index)switch(l=e.e,m=e.f,e=this.typeExpr(l,Ba.Value),p=this.fieldAccess(e,m,b,a.pos),null==p&&this.error(A.toString(e.t)+" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=p.e;k=g(e);break;case 1:h=p.g;b=p.arg;g=p.variants;l={e:q.TGlobal(h),t:x.TFun(g),p:e.p};if(0==g.length){e=[];for(m=0;m<n.length;)k=n[m],++m,e.push(this.typeExpr(k,Ba.Value));var u=e;u.unshift(b);
k=this.specialGlobal(h,l,u,a.pos)}else if(k=this.unifyCallParams(l,n,g,a.pos),e=k.e,m=l.t,8==e._hx_index)if(h=e.e,14==m._hx_index)if(h=m.variants,1==h.length)m=h[0],u=e.args,u.unshift(b),m.args.unshift({name:"_",type:b.t});else throw t.thrown("assert");else throw t.thrown("assert");else throw t.thrown("assert");d=k.t;k=k.e}else k=g(this.typeExpr(m,Ba.Value));else if(m=g,u=p,h=function(b){var e=b.t;return 14==e._hx_index?(b=c.unifyCallParams(b,u,e.variants,a.pos),d=b.t,b.e):c.error(A.toString(b.t)+
" cannot be called",a.pos)},g=m.expr,3==g._hx_index)switch(l=g.e,m=g.f,e=this.typeExpr(l,Ba.Value),p=this.fieldAccess(e,m,b,a.pos),null==p&&this.error(A.toString(e.t)+" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=p.e;k=h(e);break;case 1:h=p.g;b=p.arg;g=p.variants;l={e:q.TGlobal(h),t:x.TFun(g),p:e.p};if(0==g.length){g=[];for(p=0;p<u.length;)k=u[p],++p,g.push(this.typeExpr(k,Ba.Value));var w=g;w.unshift(b);k=this.specialGlobal(h,l,w,a.pos)}else if(k=this.unifyCallParams(l,u,g,a.pos),g=k.e,p=
l.t,8==g._hx_index)if(e=g.e,14==p._hx_index)if(e=p.variants,1==e.length)m=e[0],w=g.args,w.unshift(b),m.args.unshift({name:"_",type:b.t});else throw t.thrown("assert");else throw t.thrown("assert");else throw t.thrown("assert");d=k.t;k=k.e}else k=h(this.typeExpr(m,Ba.Value));break;case 7:e=e.el;k=this.saveVars();h=e.slice();f=[];b=this.propagate(b);for(0==h.length&&b!=Ba.NoValue&&this.error("Value expected",a.pos);;){m=h.shift();if(null==m)break;g=m.expr;8==g._hx_index&&(g=g.v,1<g.length&&(e=g.shift(),
h.unshift(m),m={expr:ib.EVars([e]),pos:m.pos}));p=m.expr;8==p._hx_index?(e=p.v,e=Ba.InBlock):e=0==h.length?b:Ba.NoValue;l=this.typeExpr(m,e);0==h.length||A.hasSideEffect(l)||this.warning("This expression has no side effect",m.pos);f.push(l)}this.vars=k;d=b==Ba.NoValue?x.TVoid:f[f.length-1].t;k=q.TBlock(f);break;case 8:g=e.v;b!=Ba.InBlock&&this.error("Cannot declare a variable outside of a block",a.pos);if(1!=g.length)throw t.thrown("assert");k=g[0];null==k.kind&&(k.kind=L.Local);k.kind!=L.Local&&
this.error("Should be local var",a.pos);0!=k.qualifiers.length&&this.error("Unexpected qualifier",a.pos);e=this.makeVar(g[0],a.pos);g=null==k.expr?null:this.typeWith(k.expr,e.type);null==e.type&&(null==g&&this.error("Type required for unitialized local var",a.pos),e.type=g.t);this.vars.h[e.name]=e;d=x.TVoid;k=q.TVarDecl(e,g);break;case 9:throw g=e.f,t.thrown("assert");case 10:g=e.econd;m=e.eif;k=e.eelse;b=this.propagate(b);e=this.typeWith(g,x.TBool);l=this.typeExpr(m,b);f=null==k?null:this.typeExpr(k,
b);b==Ba.NoValue?d=x.TVoid:(null==f&&this.error("Missing else",a.pos),this.tryUnify(l.t,f.t)?d=l.t:(this.unifyExpr(f,l.t),d=f.t));k=q.TIf(e,l,f);break;case 11:d=x.TVoid;k=q.TDiscard;break;case 12:k=e.v;g=e.loop;m=e.block;d=x.TVoid;e=this.typeExpr(g,Ba.Value);g=e.t;15==g._hx_index?(p=g.size,b=g.t,p={id:A.allocVarId(),name:k,type:b,kind:L.Local},k=this.vars.h[p.name],this.vars.h[p.name]=p,g=this.inLoop,this.inLoop=!0,b=this.typeExpr(m,Ba.NoValue),this.inLoop=g,null==k?(g=p.name,m=this.vars,Object.prototype.hasOwnProperty.call(m.h,
g)&&delete m.h[g]):this.vars.h[p.name]=k,k=q.TFor(p,e,b)):k=this.error("Cannot iterate on "+A.toString(e.t),e.p);break;case 13:m=e.e;null==m!=(this.curFun.ret==x.TVoid)&&this.error("This function should return "+A.toString(this.curFun.ret),a.pos);k=null==m?null:this.typeWith(m,this.curFun.ret);d=x.TVoid;k=q.TReturn(k);break;case 14:this.inLoop||this.error("Break outside loop",a.pos);d=x.TVoid;k=q.TBreak;break;case 15:this.inLoop||this.error("Continue outside loop",a.pos);d=x.TVoid;k=q.TContinue;break;
case 16:m=e.e;k=e.eindex;l=this.typeExpr(m,Ba.Value);f=this.typeExpr(k,Ba.With(x.TInt));this.unify(f.t,x.TInt,f.p);g=l.t;switch(g._hx_index){case 5:p=g.size;switch(g.t._hx_index){case 0:d=x.TInt;break;case 1:d=x.TFloat;break;default:this.error("Cannot index "+A.toString(l.t)+" : should be an array",a.pos)}break;case 6:d=U.vec3;break;case 7:case 8:d=U.vec4;break;case 12:d=U.vec2;break;case 15:b=g.t;k=g.size;p=f.e;0==k._hx_index?0==p._hx_index&&(e=p.c,2==e._hx_index&&(m=e.v,k=k.v,m>=k?this.error("Indexing outside array bounds",
a.pos):0>m&&this.error("Cannot index with negative value",a.pos))):0==p._hx_index&&(e=p.c,2==e._hx_index&&(h=e.v,0>h&&this.error("Cannot index with negative value",a.pos)));d=b;break;case 16:p=g.t;e=g.size;switch(g.kind._hx_index){case 0:case 3:k=e;b=p;g=f.e;0==k._hx_index?0==g._hx_index&&(m=g.c,2==m._hx_index&&(h=m.v,k=k.v,h>=k?this.error("Indexing outside array bounds",a.pos):0>h&&this.error("Cannot index with negative value",a.pos))):0==g._hx_index&&(m=g.c,2==m._hx_index&&(h=m.v,0>h&&this.error("Cannot index with negative value",
a.pos)));d=b;break;default:k=e,d=p}break;default:this.error("Cannot index "+A.toString(l.t)+" : should be an array",a.pos)}k=q.TArray(l,f);break;case 17:e=e.el;0==e.length&&this.error("Empty array not supported",a.pos);g=[];for(p=0;p<e.length;)m=e[p],++p,g.push(this.typeExpr(m,Ba.Value));e=g;b=e[0].t;g=1;for(p=e.length;g<p;)h=g++,this.unifyExpr(e[h],b);d=x.TArray(b,Za.SConst(e.length));k=q.TArrayDecl(e);break;case 18:m=e.e;w=e.cases;var v=e.def;l=this.typeExpr(m,Ba.Value);g=[];for(p=0;p<w.length;){f=
w[p];++p;e=[];m=0;for(h=f.values;m<h.length;)k=h[m],++m,e.push(this.typeWith(k,l.t));g.push({values:e,expr:this.typeExpr(f.expr,b)})}w=g;e=null==v?null:this.typeExpr(v,b);d=x.TVoid;k=q.TSwitch(l,w,e);break;case 19:g=e.cond;p=e.loop;b=e.normalWhile;d=x.TVoid;e=this.typeWith(g,x.TBool);g=this.inLoop;m=this.inWhile;this.inWhile=this.inLoop=!0;p=this.typeExpr(p,Ba.NoValue);this.inLoop=g;this.inWhile=m;k=q.TWhile(e,p,b);break;case 20:l=e.name;w=e.args;m=e.e;k=this.typeExpr(m,b);d=k.t;e=[];for(g=0;g<w.length;){f=
w[g];++g;p=f.expr;switch(p._hx_index){case 0:p=p.c;break;case 1:h=p.i;p=E.CString(h);break;default:p=this.error("Metadata parameter should be constant",f.pos)}e.push(p)}k=q.TMeta(l,e,k)}if(null==d)throw t.thrown("assert");return{e:k,t:d,p:a.pos}},propagate:function(a){return 2==a._hx_index?Ba.NoValue:a},checkExpr:function(a,b,c,d){var e=this;var f=a.expr;switch(f._hx_index){case 6:var g=f.e;var h=f.args;var k=g.expr;if(1==k._hx_index)switch(k.i){case "extends":if(1==h.length){f=h[0];var l=[],m=null;
m=function(a){var b=a.expr;switch(b._hx_index){case 0:b=b.c;4==b._hx_index?l.push(b.v):e.error("Should be a shader type path",a.pos);break;case 1:l.push(b.i);break;case 3:a=b.f;m(b.e);l.push(a);break;default:e.error("Should be a shader type path",a.pos)}};m(f);g=null;try{g=this.loadShader(l.join("."))}catch(n){if(k=t.caught(n).unwrap(),k instanceof kb)this.error(y.string(k),f.pos);else throw n;}null!=g&&this.checkExpr(g,b,c,!0)}else this.error("This expression is not allowed at shader declaration level",
a.pos);break;case "import":if(1==h.length){f=h[0];var p=[],q=null;q=function(a){var b=a.expr;switch(b._hx_index){case 1:p.push(b.i);break;case 3:a=b.f;q(b.e);p.push(a);break;default:e.error("Should be a shader type path",a.pos)}};q(f);g=null;try{g=this.loadShader(p.join("."))}catch(n){h=t.caught(n);k=h.unwrap();if(h instanceof Yg)throw h;this.error(y.string(k),f.pos)}null!=g&&this.checkExpr(g,b,!0,d)}else this.error("This expression is not allowed at shader declaration level",a.pos);break;default:this.error("This expression is not allowed at shader declaration level",
a.pos)}else this.error("This expression is not allowed at shader declaration level",a.pos);break;case 7:a=f.el;for(g=0;g<a.length;)f=a[g],++g,this.checkExpr(f,b,c,d);break;case 8:b=f.v;for(g=0;g<b.length;){d=b[g];++g;if(null==d.kind)for(d.kind=L.Local,h=0,k=d.qualifiers;h<k.length;)f=k[h],++h,0==f._hx_index&&(d.kind=L.Param);f=null;null!=d.expr&&(d.kind!=L.Param&&d.kind!=L.Local&&this.error("Cannot initialize variable declaration if not @param or local",d.expr.pos),f=this.typeExpr(d.expr,null==d.type?
Ba.Value:Ba.With(d.type)),null==d.type?d.type=f.t:this.unify(f.t,d.type,d.expr.pos),this.checkConst(f));null==d.type&&this.error("Type required for variable declaration",a.pos);if(!c||d.kind!=L.Param){Object.prototype.hasOwnProperty.call(this.vars.h,d.name)&&this.error("Duplicate var decl '"+d.name+"'",a.pos);d=this.makeVar(d,a.pos);k=d.type;switch(k._hx_index){case 10:2==k.dim._hx_index&&1==k.isArray&&this.error("Unsupported texture type",a.pos);break;case 11:h=k.channels,2==k.dim._hx_index?1==k.isArray?
this.error("Unsupported texture type",a.pos):3==h&&this.error("Unsupported texture type",a.pos):3==h&&this.error("Unsupported texture type",a.pos)}null!=f?this.inits.push({v:d,e:f}):null!=d.qualifiers&&0<=d.qualifiers.indexOf(ma.Final)&&this.error("Final variable needs initializer",a.pos);this.vars.h[d.name]=d}}break;case 9:k=f.f;if(c&&("fragment"==k.name||"vertex"==k.name||X.startsWith(k.name,"__init__")))break;f=0;for(g=b.slice();f<g.length;)h=g[f],++f,h.f.name==k.name&&h.inherit&&F.remove(b,h);
b.push({f:k,p:a.pos,inherit:d||c});break;default:this.error("This expression is not allowed at shader declaration level",a.pos)}},checkConst:function(a){var b=a.e;switch(b._hx_index){case 0:break;case 3:a=b.e;this.checkConst(a);break;case 8:var c=b.e;b=b.args;c=c.e;if(2==c._hx_index)switch(c.g._hx_index){case 41:case 42:case 43:case 44:case 45:case 46:for(c=0;c<b.length;)a=b[c],++c,this.checkConst(a);break;default:this.error("This expression should be constant",a.p)}else this.error("This expression should be constant",
a.p);break;case 17:c=b.el;for(b=0;b<c.length;)a=c[b],++b,this.checkConst(a);break;default:this.error("This expression should be constant",a.p)}},makeVar:function(a,b,c){var d={id:A.allocVarId(),name:a.name,kind:a.kind,type:a.type,qualifiers:a.qualifiers};null!=c&&(d.parent=c);null==d.kind?d.kind=null==c?L.Local:c.kind:null!=c&&d.kind!=c.kind&&(0==c.kind._hx_index?3!=d.kind._hx_index&&this.error("Variable "+y.string(c.kind)+" cannot be changed to "+y.string(d.kind),b):this.error("Variable "+y.string(c.kind)+
" cannot be changed to "+y.string(d.kind),b));if(0<a.qualifiers.length){d.qualifiers=a.qualifiers;for(var e=0,f=a.qualifiers;e<f.length;){var g=f[e];++e;switch(g._hx_index){case 0:for(g=c;null!=g;)A.isStruct(g)||this.error("@const only allowed in structure",b),g=g.parent;d.kind!=L.Global&&d.kind!=L.Param&&this.error("@const only allowed on parameter or global",b);break;case 2:d.kind!=L.Param&&this.error("@nullable only allowed on parameter or global",b);break;case 3:d.kind!=L.Global&&this.error("@perObject only allowed on global",
b);break;case 4:null!=c&&this.error("Cannot have an explicit name for a structure variable",b);d.kind!=L.Global&&this.error("Explicit name is only allowed for global var",b);break;case 5:null!=c&&this.error("Cannot share a structure field",b);d.kind!=L.Param&&this.error("Can only share a @param",b);break;case 6:g=a.type;if(null==g)this.error("Precision qualifier not supported on "+y.string(a.type),b);else switch(g._hx_index){case 3:break;case 5:1!=g.t._hx_index&&this.error("Precision qualifier not supported on "+
y.string(a.type),b);break;default:this.error("Precision qualifier not supported on "+y.string(a.type),b)}break;case 7:g=a.type;if(null==g)this.error("Precision qualifier not supported on "+y.string(a.type),b);else switch(g._hx_index){case 1:case 3:break;case 5:1!=g.t._hx_index&&this.error("Precision qualifier not supported on "+y.string(a.type),b);break;default:this.error("Precision qualifier not supported on "+y.string(a.type),b)}break;case 9:d.kind!=L.Input&&d.kind!=L.Param&&(d.kind!=L.Global||
0>a.qualifiers.indexOf(ma.PerObject))&&this.error("@perInstance only allowed on input/param",b);break;case 11:a.kind!=L.Local&&this.error("Borrow should not have a type qualifier",b);break;case 12:g=a.type;if(null==g)this.error("Sampler should be on sampler type or sampler array",b);else switch(g._hx_index){case 10:break;case 15:10!=g.t._hx_index&&this.error("Sampler should be on sampler type or sampler array",b);break;default:this.error("Sampler should be on sampler type or sampler array",b)}break;
case 13:d.kind!=L.Local&&this.error("final only allowed on local",b);break;case 14:d.kind!=L.Local&&this.error("flat only allowed on local",b)}}}null!=d.type&&(d.type=this.makeVarType(d.type,d,b));return d},makeVarType:function(a,b,c){var d;switch(a._hx_index){case 13:var e=a.vl;var f=e.slice();b.type=x.TStruct(f);var g=0;for(d=f.length;g<d;){a=g++;var h=f[a];f[a]=this.makeVar({type:h.type,qualifiers:h.qualifiers,name:h.name,kind:h.kind,expr:null},c,b)}return b.type;case 15:f=a.t;h=a.size;15==f._hx_index&&
this.error("Multidimentional arrays are not allowed",c);switch(h._hx_index){case 0:g=h;break;case 1:h=h.v;var k=h.name.split(".");var l=null;for(g=0;g<k.length;){var m=k[g];++g;if(null==l){if(l=this.vars.h[m],null==l&&null!=b){for(d=b;null!=d.parent;)d=d.parent;d.name==m&&(l=d)}}else if(d=l.type,13==d._hx_index){e=d.vl;var p=null;for(l=0;l<e.length;)if(d=e[l],++l,d.name==m){p=d;break}l=p}else l=null;if(null==l)break}null==l&&this.error("Array size variable '"+h.name+"'not found",c);A.isConst(l)||
this.error("Array size variable '"+h.name+"'should be a constant",c);g=Za.SVar(l)}f=this.makeVarType(f,b,c);switch(a._hx_index){case 15:return x.TArray(f,g);case 16:return b=a.kind,x.TBuffer(f,g,b);default:throw t.thrown("assert");}case 16:f=a.t;h=a.size;15==f._hx_index&&this.error("Multidimentional arrays are not allowed",c);switch(h._hx_index){case 0:g=h;break;case 1:h=h.v;k=h.name.split(".");l=null;for(g=0;g<k.length;){m=k[g];++g;if(null==l){if(l=this.vars.h[m],null==l&&null!=b){for(d=b;null!=
d.parent;)d=d.parent;d.name==m&&(l=d)}}else if(d=l.type,13==d._hx_index){e=d.vl;p=null;for(l=0;l<e.length;)if(d=e[l],++l,d.name==m){p=d;break}l=p}else l=null;if(null==l)break}null==l&&this.error("Array size variable '"+h.name+"'not found",c);A.isConst(l)||this.error("Array size variable '"+h.name+"'should be a constant",c);g=Za.SVar(l)}f=this.makeVarType(f,b,c);switch(a._hx_index){case 15:return x.TArray(f,g);case 16:return b=a.kind,x.TBuffer(f,g,b);default:throw t.thrown("assert");}default:return a}},
isParentArray:function(a){if(null==a.parent)return!1;switch(a.parent.type._hx_index){case 13:return this.isParentArray(a.parent);case 15:return!0;case 16:return!0;default:return!1}},fieldAccess:function(a,b,c,d){c=a.t;if(13==c._hx_index){var e=c.vl;var f=null;for(c=0;c<e.length;){var g=e[c];++c;if(g.name==b){f=g;break}}c=null==f?null:this.isParentArray(f)?{e:q.TField(a,b),t:f.type,p:d}:{e:q.TVar(f),t:f.type,p:d}}else c=null;if(null!=c)return me.FField(c);e=this.globals.h[b];if(null==e){c=a.t;switch(b){case "fetch":switch(c._hx_index){case 10:c=
B.Texel;break;case 17:c=B.ChannelFetch;break;default:c=null}break;case "fetchLod":switch(c._hx_index){case 10:c=B.Texel;break;case 17:c=B.ChannelFetch;break;default:c=null}break;case "get":switch(c._hx_index){case 10:c=B.Texture;break;case 17:c=B.ChannelRead;break;default:c=null}break;case "getLod":switch(c._hx_index){case 10:c=B.TextureLod;break;case 17:c=B.ChannelReadLod;break;default:c=null}break;case "size":switch(c._hx_index){case 10:c=B.TextureSize;break;case 11:c=B.TextureSize;break;case 17:c=
B.ChannelTextureSize;break;default:c=null}break;case "store":c=11==c._hx_index?B.ImageStore:null;break;default:c=null}null!=c&&("get"==b&&this.inWhile&&this.error("Cannot use .get() in while loop, use .getLod instead",d),g=this.globals,c=Z.toString(c),e=g.h[c])}if(null!=e){c=e.t;if(14==c._hx_index){f=c.variants;var h=[];for(c=0;c<f.length;)if(g=f[c],++c,0!=g.args.length&&this.tryUnify(a.t,g.args[0].type)){var k=g.args.slice();k.shift();h.push({args:k,ret:g.ret})}if(0<h.length||0==f.length)return me.FGlobal(e.g,
a,h)}c=a.t;if(28==e.g._hx_index&&15==c._hx_index)return me.FField({e:q.TCall({e:q.TGlobal(B.Length),t:x.TVoid,p:d},[a]),t:x.TInt,p:d})}c=a.t;switch(c._hx_index){case 1:g=Q.VInt;f=1;break;case 2:g=Q.VBool;f=1;break;case 3:g=Q.VFloat;f=1;break;case 5:e=c.size;g=c.t;f=e;break;case 9:e=c.size;g=Q.VFloat;f=e;break;default:g=null,f=0}if(0<f&&4>=b.length){h=[fa.X,fa.Y,fa.Z,fa.W];k=-1;var l=[];c=0;for(e=b.length;c<e;){var m=c++,p="xrsygtzbpwaq".indexOf(b.charAt(m));if(0>p)return null;var r=p%3;if(0>k)k=r;
else if(r!=k)return null;p=p/3|0;p>=f&&this.error(A.toString(a.t)+" does not have component "+b.charAt(m),d);l.push(h[p])}return me.FField({e:q.TSwiz(a,l),t:1==l.length?A.toType(g):x.TVec(l.length,g),p:d})}return null},getSizeType:function(a,b){switch(a){case 1:return b==Q.VInt?x.TInt:x.TFloat;case 2:return b==Q.VInt?U.ivec2:U.vec2;case 3:return b==Q.VInt?U.ivec3:U.vec3;case 4:return b==Q.VInt?U.ivec4:U.vec4;default:throw t.thrown("assert");}},specialGlobal:function(a,b,c,d){var e;var f=null;switch(a._hx_index){case 37:1!=
c.length&&this.error("TextureSize() requires one single argument",d);var g=c[0].t;switch(g._hx_index){case 10:var h=g.dim;f=g.isArray;f=this.getSizeType(A.getDimSize(h,f),Q.VFloat);break;case 11:h=g.dim;f=g.isArray;f=this.getSizeType(A.getDimSize(h,f),Q.VFloat);break;default:this.unify(c[0].t,x.TSampler(Ta.T2D,!1),c[0].p),f=U.vec2}break;case 41:h=x.TFloat;var k=!1;if(1==c.length&&(h==x.TInt||h==x.TFloat)&&(g=c[0].t,5==g._hx_index)){var l=g.size;g=g.t;g!=Q.VInt&&g!=Q.VFloat||2!=l||(k=!0)}if(!k){for(g=
e=0;g<c.length;)if(k=c[g],++g,l=k.t,5==l._hx_index){var m=l.size;f=l.t;A.toType(f)!=h&&this.unify(k.t,h,k.p);e+=m}else this.unifyExpr(k,h),++e;2!=e&&1<e&&this.error(Z.toString(a)+" requires 2 "+A.toString(h)+" values but has "+e,d)}f=x.TVec(2,Q.VFloat);break;case 42:h=x.TFloat;k=!1;1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||3!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,f=l.t,A.toType(f)!=h&&this.unify(k.t,
h,k.p),e+=m):(this.unifyExpr(k,h),++e);3!=e&&1<e&&this.error(Z.toString(a)+" requires 3 "+A.toString(h)+" values but has "+e,d)}f=x.TVec(3,Q.VFloat);break;case 43:h=x.TFloat;k=!1;1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||4!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,f=l.t,A.toType(f)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);4!=e&&1<e&&this.error(Z.toString(a)+" requires 4 "+A.toString(h)+
" values but has "+e,d)}f=x.TVec(4,Q.VFloat);break;case 44:case 45:case 46:switch(a._hx_index){case 44:f=2;break;case 45:f=3;break;case 46:f=4;break;default:throw t.thrown("assert");}if(1==c.length)switch(c[0].t._hx_index){case 1:case 3:break;default:if(h=x.TInt,k=!1,1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||l!=f||(k=!0))),!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,l=l.t,A.toType(l)!=h&&this.unify(k.t,h,k.p),e+=
m):(this.unifyExpr(k,h),++e);e!=f&&1<e&&this.error(Z.toString(a)+" requires "+f+" "+A.toString(h)+" values but has "+e,d)}}else if(h=x.TInt,k=!1,1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||l!=f||(k=!0))),!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,l=l.t,A.toType(l)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);e!=f&&1<e&&this.error(Z.toString(a)+" requires "+f+" "+A.toString(h)+" values but has "+e,d)}f=
x.TVec(f,Q.VInt);break;case 47:h=x.TBool;k=!1;1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||2!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,f=l.t,A.toType(f)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);2!=e&&1<e&&this.error(Z.toString(a)+" requires 2 "+A.toString(h)+" values but has "+e,d)}f=x.TVec(2,Q.VBool);break;case 48:h=x.TBool;k=!1;1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&
(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||3!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,f=l.t,A.toType(f)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);3!=e&&1<e&&this.error(Z.toString(a)+" requires 3 "+A.toString(h)+" values but has "+e,d)}f=x.TVec(3,Q.VBool);break;case 49:h=x.TBool;k=!1;1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||4!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,
5==l._hx_index?(m=l.size,f=l.t,A.toType(f)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);4!=e&&1<e&&this.error(Z.toString(a)+" requires 4 "+A.toString(h)+" values but has "+e,d)}f=x.TVec(4,Q.VBool);break;case 50:g=[];for(l=0;l<c.length;)k=c[l],++l,g.push(k.t);l=g;switch(l.length){case 1:12==l[0]._hx_index?f=x.TMat2:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d);break;case 2:g=l[0];k=l[1];5==g._hx_index?2==g.size?1==g.t._hx_index?5==k._hx_index?2==k.size?1==k.t._hx_index?
f=x.TMat2:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d);break;case 4:3==l[0]._hx_index?3==l[1]._hx_index?3==l[2]._hx_index?3==l[3]._hx_index?f=x.TMat2:
this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d);break;default:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d)}break;case 51:g=[];for(l=0;l<c.length;)k=c[l],++l,g.push(k.t);l=g;switch(l.length){case 1:switch(l[0]._hx_index){case 7:case 8:f=x.TMat3;break;default:this.error("Cannot apply "+
Z.toString(a)+" to these parameters",d)}break;case 3:g=l[0];k=l[1];h=l[2];5==g._hx_index?3==g.size?1==g.t._hx_index?5==k._hx_index?3==k.size?1==k.t._hx_index?5==h._hx_index?3==h.size?1==h.t._hx_index?f=x.TMat3:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+
Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d);break;case 9:3==l[0]._hx_index?3==l[1]._hx_index?3==l[2]._hx_index?3==l[3]._hx_index?3==l[4]._hx_index?3==l[5]._hx_index?3==l[6]._hx_index?3==l[7]._hx_index?3==l[8]._hx_index?f=x.TMat3:this.error("Cannot apply "+
Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",
d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d);break;default:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d)}break;case 52:g=[];for(l=0;l<c.length;)k=c[l],++l,g.push(k.t);l=g;switch(l.length){case 1:7==l[0]._hx_index?f=x.TMat4:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d);break;case 4:g=l[0];k=l[1];h=l[2];l=l[3];5==g._hx_index?4==g.size?1==g.t._hx_index?5==k._hx_index?4==k.size?1==k.t._hx_index?5==h._hx_index?4==h.size?1==h.t._hx_index?
5==l._hx_index?4==l.size?1==l.t._hx_index?f=x.TMat4:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",
d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d);break;default:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d)}break;case 53:g=[];for(l=0;l<c.length;)k=c[l],++l,g.push(k.t);l=g;switch(l.length){case 1:7==
l[0]._hx_index?f=x.TMat3x4:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d);break;case 3:g=l[0];k=l[1];h=l[2];5==g._hx_index?4==g.size?1==g.t._hx_index?5==k._hx_index?4==k.size?1==k.t._hx_index?5==h._hx_index?4==h.size?1==h.t._hx_index?f=x.TMat3x4:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+
" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d);break;default:this.error("Cannot apply "+Z.toString(a)+" to these parameters",d)}break;case 68:f=x.TVoid;break;case 79:g=[];for(l=0;l<c.length;)k=
c[l],++l,g.push(k.t);l=g;3==l.length?(g=l[0],11==g._hx_index?(h=g.dim,f=g.isArray,g=g.channels,k=l[1],l=l[2],f=this.getSizeType(A.getDimSize(h,f),Q.VInt),this.unify(k,f,c[1].p),this.unify(l,1==g?x.TFloat:x.TVec(g,Q.VFloat),c[2].p),f=x.TVoid):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d)):this.error("Cannot apply "+Z.toString(a)+" to these parameters",d)}if(null==f)throw t.thrown("Custom Global not supported "+y.string(a));return{e:q.TCall(b,c),t:f,p:d}},unifyCallParams:function(a,
b,c,d){var e;var f=1E3;var g=-1E3;var h=[];for(e=0;e<c.length;){var k=c[e];++e;var l=k.args.length;l<f&&(f=l);l>g&&(g=l);l==b.length&&h.push(k)}switch(h.length){case 0:if(0==c.length){e=a.e;if(2==e._hx_index){var m=e.g;e=[];for(g=0;g<b.length;)k=b[g],++g,e.push(this.typeExpr(k,Ba.Value));return this.specialGlobal(m,a,e,d)}throw t.thrown("assert");}return this.error("Function expects "+(f==g?""+f:f+"-"+g)+" arguments",d);case 1:l=h[0];m=[];e=0;for(g=b.length;e<g;){f=e++;h=l.args[f].type;k=this.typeExpr(b[f],
Ba.With(h));try{this.unifyExpr(k,h)}catch(u){a=t.caught(u).unwrap();if(a instanceof kb)throw m=a,m.msg+=" for argument '"+l.args[f].name+"'",t.thrown(m);throw u;}m.push(k)}1<c.length&&(a.t=x.TFun([l]));return{e:q.TCall(a,m),t:l.ret,p:d};default:c=null;var p=-1;for(e=0;e<h.length;){l=h[e];++e;var r=[];g=0;for(var n=b.length;g<n;){f=g++;k=this.typeExpr(b[f],Ba.With(l.args[f].type));if(!this.tryUnify(k.t,l.args[f].type))break;r.push(k)}if(r.length>p&&(c=l,p=r.length,p==b.length))return a.t=x.TFun([l]),
{e:q.TCall(a,r),t:l.ret,p:d}}e=0;for(g=b.length;e<g;){f=e++;try{m=this.typeExpr(b[f],Ba.Value),this.unify(m.t,c.args[f].type,m.p)}catch(u){a=t.caught(u).unwrap();if(a instanceof kb)throw a.msg+=" for argument '"+c.args[f].name+"'",t.thrown(a);throw u;}}throw t.thrown("assert");}},toFloat:function(a){if(a.t!=x.TInt)throw t.thrown("assert");var b=a.e;0==b._hx_index?(b=b.c,a.e=2==b._hx_index?q.TConst(E.CFloat(b.v)):q.TCall({e:q.TGlobal(B.ToFloat),t:x.TFun([]),p:a.p},[{e:a.e,t:a.t,p:a.p}])):a.e=q.TCall({e:q.TGlobal(B.ToFloat),
t:x.TFun([]),p:a.p},[{e:a.e,t:a.t,p:a.p}]);a.t=x.TFloat},typeBinop:function(a,b,c,d){switch(a._hx_index){case 4:throw t.thrown("assert");case 5:case 6:case 7:case 8:case 9:case 10:var e=b.t;switch(e._hx_index){case 2:if(a!=aa.OpEq&&a!=aa.OpNotEq||c.t==x.TVoid){var f=b.e;var g=c.e;switch(f._hx_index){case 0:return 0==f.c._hx_index&&1==g._hx_index?(c=g.v,A.hasQualifier(c,ma.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+A.toString(b.t)+" and "+
A.toString(c.t),d);case 1:return 0==g._hx_index&&0==g.c._hx_index?(c=f.v,A.hasQualifier(c,ma.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),d);default:return this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),d)}}else return this.unifyExpr(c,b.t),x.TBool;case 1:case 3:case 4:if(c.t!=x.TVoid)return this.unifyExpr(c,b.t),x.TBool;f=b.e;g=c.e;switch(f._hx_index){case 0:return 0==f.c._hx_index&&
1==g._hx_index?(c=g.v,A.hasQualifier(c,ma.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),d);case 1:return 0==g._hx_index&&0==g.c._hx_index?(c=f.v,A.hasQualifier(c,ma.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),d);default:return this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),d)}case 5:if(c.t!=
x.TVoid)return this.unifyExpr(c,b.t),b.t;e=b.e;f=c.e;switch(e._hx_index){case 0:return 0==e.c._hx_index&&1==f._hx_index?(c=f.v,A.hasQualifier(c,ma.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),d);case 1:return 0==f._hx_index&&0==f.c._hx_index?(c=e.v,A.hasQualifier(c,ma.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),
d);default:return this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),d)}default:switch(e=b.e,f=c.e,e._hx_index){case 0:return 0==e.c._hx_index&&1==f._hx_index?(c=f.v,A.hasQualifier(c,ma.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),d);case 1:return 0==f._hx_index&&0==f.c._hx_index?(c=e.v,A.hasQualifier(c,ma.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+
A.toString(b.t)+" and "+A.toString(c.t),d);default:return this.error("Cannot compare "+A.toString(b.t)+" and "+A.toString(c.t),d)}}case 11:case 12:case 13:case 16:case 17:case 18:return this.unifyExpr(b,x.TInt),this.unifyExpr(c,x.TInt),x.TInt;case 14:case 15:return this.unifyExpr(b,x.TBool),this.unifyExpr(c,x.TBool),x.TBool;case 0:case 1:case 2:case 3:case 19:if(e=b.t,f=c.t,1==a._hx_index)switch(e._hx_index){case 1:switch(f._hx_index){case 1:return x.TInt;case 3:return this.toFloat(b),x.TFloat;case 5:if(1==
f.t._hx_index)return this.toFloat(b),c.t;switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),
d)}case 3:switch(f._hx_index){case 1:return this.toFloat(c),x.TFloat;case 3:return x.TFloat;case 5:if(1==f.t._hx_index)return c.t;switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");
}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}case 5:switch(g=e.size,e=e.t,g){case 2:if(1==e._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,Q.VFloat);switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),
d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d);case 12:return U.vec2;default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}else{switch(a._hx_index){case 0:a=
"add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}case 3:if(1==e._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,Q.VFloat);switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");
}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d);case 6:return U.vec3;case 8:return U.vec3;default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");
}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}else{switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}case 4:if(1==e._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,Q.VFloat);switch(a._hx_index){case 0:a=
"add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d);case 7:return U.vec4;default:switch(a._hx_index){case 0:a="add";break;case 1:a=
"multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}else{switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}default:if(1==e._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;
case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,Q.VFloat);switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+
A.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}else{switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}}case 7:if(7==
f._hx_index)return x.TMat4;switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}else switch(e._hx_index){case 1:switch(f._hx_index){case 1:return x.TInt;
case 3:return this.toFloat(b),x.TFloat;case 5:if(1==f.t._hx_index)return this.toFloat(b),c.t;switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+
a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}case 3:switch(f._hx_index){case 1:return this.toFloat(c),x.TFloat;case 3:return x.TFloat;case 5:if(1==f.t._hx_index)return c.t;switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;
case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}case 5:if(g=e.size,1==e.t._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,Q.VFloat);switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+
A.toString(b.t)+" and "+A.toString(c.t),d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),
d)}else{switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw t.thrown("assert");}return this.error("Cannot "+a+" "+A.toString(b.t)+" and "+A.toString(c.t),d)}case 20:throw t.thrown("assert");
case 21:return this.unifyExpr(b,x.TInt),this.unifyExpr(c,x.TInt),x.TArray(x.TInt,Za.SConst(0));default:return this.error("Unsupported operator "+y.string(a),d)}},__class__:U};var tg=function(){this.varMap=new Fa};tg.__name__="hxsl.Clone";tg.shaderData=function(a){return(new tg).shader(a)};tg.prototype={tvar:function(a){var b=this.varMap.h[a.id];if(null!=b)return b;b={id:A.allocVarId(),type:a.type,name:a.name,kind:a.kind};this.varMap.h[a.id]=b;null!=a.parent&&(b.parent=this.tvar(a.parent));null!=a.qualifiers&&
(b.qualifiers=a.qualifiers.slice());b.type=this.ttype(a.type);return b},tfun:function(a){for(var b=this.ttype(a.ret),c=a.kind,d=this.tvar(a.ref),e=[],f=0,g=a.args;f<g.length;){var h=g[f];++f;e.push(this.tvar(h))}return{ret:b,kind:c,ref:d,args:e,expr:this.texpr(a.expr)}},ttype:function(a){switch(a._hx_index){case 13:var b=a.vl;a=[];for(var c=0;c<b.length;){var d=b[c];++c;a.push(this.tvar(d))}return x.TStruct(a);case 14:return x.TFun(a.variants);case 15:d=a.size;a=this.ttype(a.t);switch(d._hx_index){case 0:b=
d;break;case 1:d=d.v,b=Za.SVar(this.tvar(d))}return x.TArray(a,b);default:return a}},texpr:function(a){var b=A.map(a,M(this,this.texpr));b.t=this.ttype(a.t);var c=b.e;switch(c._hx_index){case 1:a=c.v;a=q.TVar(this.tvar(a));break;case 7:a=c.v;var d=c.init;a=q.TVarDecl(this.tvar(a),d);break;case 13:a=c.v;d=c.it;c=c.loop;a=q.TFor(this.tvar(a),d,c);break;default:a=b.e}b.e=a;return b},shader:function(a){for(var b=a.name,c=[],d=0,e=a.vars;d<e.length;){var f=e[d];++d;c.push(this.tvar(f))}f=c;c=[];d=0;for(e=
a.funs;d<e.length;)a=e[d],++d,c.push(this.tfun(a));return{name:b,vars:f,funs:c}},__class__:tg};var Qi=function(a){this.fields=0;this.v=a};Qi.__name__="hxsl._Dce.VarRel";Qi.prototype={__class__:Qi};var Ri=function(a){this.keep=this.used=0;this.v=a;this.deps=new Fa;this.adeps=[]};Ri.__name__="hxsl._Dce.VarDeps";Ri.prototype={__class__:Ri};var Uc=function(){this.vars=[];this.bits=[]};Uc.__name__="hxsl._Dce.WriteTo";Uc.prototype={push:function(a,b){this.vars.push(a);this.bits.push(b)},pop:function(){this.vars.pop();
this.bits.pop()},append:function(a,b){for(var c=0,d=this.vars;c<d.length;){var e=d[c],f=c++;if(e==a){this.bits[f]|=b;return}}this.push(a,b)},appendTo:function(a){for(var b=0,c=this.vars;b<c.length;){var d=c[b],e=b++;a.append(d,this.bits[e])}},__class__:Uc};var Ni=function(){};Ni.__name__="hxsl.Dce";Ni.prototype={dce:function(a){var b,c;this.used=new Fa;this.channelVars=[];var d=[];for(b=0;b<a.length;){var e=a[b];++b;var f=0;for(c=e.vars;f<c.length;){var g=c[f];++f;var h=this.get(g);g.kind==L.Input&&
d.push(h);if(g.kind!=L.Output)switch(e=g.type,e._hx_index){case 11:g=!0;break;case 16:g=2==e.kind._hx_index;break;default:g=!1}else g=!0;g&&(h.keep=15)}}for(b=0;b<a.length;)for(e=a[b],++b,f=0,c=e.funs;f<c.length;)h=c[f],++f,this.check(h.expr,new Uc,new Uc);do{gb.TRACE&&$a.trace("DCE LOOP",{fileName:"hxsl/Debug.hx",lineNumber:9,className:"hxsl.Dce",methodName:"dce"});for(g=this.used.iterator();g.hasNext();)c=g.next(),0!=c.keep&&this.markRec(c,c.keep);for(;1<d.length&&0==d[d.length-1].used;)d.pop();
for(b=0;b<d.length;)c=d[b],++b,this.markRec(c,15);g=[];for(f=0;f<a.length;)for(e=a[f],++f,c=0,e=e.funs;c<e.length;)h=e[c],++c,g.push(this.mapExpr(h.expr,!1));this.markAsKeep=!1;for(b=0;b<g.length;)c=g[b],++b,this.checkBranches(c)}while(this.markAsKeep);for(b=0;b<a.length;)for(e=a[b],++b,f=0,c=e.funs;f<c.length;)h=c[f],++f,h.expr=g.shift();for(g=this.used.iterator();g.hasNext();)if(c=g.next(),0==c.used&&c.v.kind!=L.Input)for(b=0;b<a.length;)e=a[b],++b,F.remove(e.vars,c.v);return a.slice()},get:function(a){var b=
this.used.h[a.id];null==b&&(b=new Ri(a),this.used.h[a.id]=b);return b},varName:function(a,b){null==b&&(b=15);return gb.varName(a,b)},markRec:function(a,b){if((a.used&b)!=b){b&=~a.used;gb.TRACE&&$a.trace(this.varName(a.v,b)+" is used",{fileName:"hxsl/Debug.hx",lineNumber:9,className:"hxsl.Dce",methodName:"markRec"});a.used|=b;var c=0;for(a=a.adeps;c<a.length;){var d=a[c];++c;var e=this.makeFieldsBits(15,b);0!=(d.fields&e)&&this.markRec(d.v,this.extractFieldsBits(d.fields,b))}}},extractFieldsBits:function(a,
b){return((0==(b&1)?0:a)|(0==(b&2)?0:a>>4)|(0==(b&4)?0:a>>8)|(0==(b&8)?0:a>>12))&15},makeFieldsBits:function(a,b){return a*((b&1)+((b&2)<<3)+((b&4)<<6)+((b&8)<<9))},link:function(a,b,c){null==c&&(c=15);for(var d=this.get(a),e=0,f=b.vars;e<f.length;){var g=f[e],h=e++;if(null==g)0==d.keep&&(gb.TRACE&&$a.trace("Force keep "+this.varName(d.v),{fileName:"hxsl/Debug.hx",lineNumber:9,className:"hxsl.Dce",methodName:"link"}),d.keep=15,this.markAsKeep=!0);else{var k=g.deps.h[a.id];null==k&&(k=new Qi(d),g.deps.h[a.id]=
k,g.adeps.push(k));var l=this.makeFieldsBits(c,b.bits[h]);(k.fields&l)!=l&&(k.fields|=l,gb.TRACE&&$a.trace(this.varName(g.v,b.bits[h])+" depends on "+this.varName(d.v,c),{fileName:"hxsl/Debug.hx",lineNumber:9,className:"hxsl.Dce",methodName:"link"}))}}},swizBits:function(a){for(var b=0,c=0;c<a.length;){var d=a[c];++c;b|=1<<d._hx_index}return b},check:function(a,b,c){var d,e=this;var f=a.e;switch(f._hx_index){case 1:var g=f.v;this.link(g,b);break;case 4:g=f.el;a=new Uc;var h=0;for(d=g.length;h<d;){var k=
h++;this.check(g[k],k<g.length-1?a:b,c)}break;case 5:h=f.op;d=f.e1;var l=f.e2;switch(h._hx_index){case 4:var m=d.e;var p=d.p;p=d.t;switch(m._hx_index){case 1:g=m.v;a=l;g=this.get(g);b.push(g,15);this.check(a,b,c);b.pop();c.append(g,15);break;case 9:p=m.e;var q=m.regs;var n=p.e;var u=p.p;u=p.t;switch(n._hx_index){case 1:g=n.v;k=q;a=l;g=this.get(g);k=this.swizBits(k);b.push(g,k);this.check(a,b,c);b.pop();c.append(g,k);break;case 16:p=n.e;q=p.e;u=p.p;u=p.t;1==q._hx_index?(g=q.v,k=n.index,a=l,g=this.get(g),
b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(p=this,A.iter(a,function(a){p.check(a,b,c)}));break;default:q=this,A.iter(a,function(a){q.check(a,b,c)})}break;case 16:n=m.e;u=n.e;var t=n.p;t=n.t;1==u._hx_index?(g=u.v,k=m.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(n=this,A.iter(a,function(a){n.check(a,b,c)}));break;case 21:u=m.e;t=m.name;m=u.e;t=u.p;t=u.t;if(16==m._hx_index){u=m.e;t=u.e;var v=u.p;v=u.t;1==t._hx_index?
(g=t.v,k=m.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(m=this,A.iter(a,function(a){m.check(a,b,c)}))}else u=this,A.iter(a,function(a){u.check(a,b,c)});break;default:t=this,A.iter(a,function(a){t.check(a,b,c)})}break;case 20:v=h.op;h=d.e;v=d.p;v=d.t;switch(h._hx_index){case 1:g=h.v;a=l;g=this.get(g);b.push(g,15);this.check(a,b,c);b.pop();c.append(g,15);break;case 9:d=h.e;v=h.regs;var x=d.e;var y=d.p;y=d.t;switch(x._hx_index){case 1:g=x.v;k=v;a=
l;g=this.get(g);k=this.swizBits(k);b.push(g,k);this.check(a,b,c);b.pop();c.append(g,k);break;case 16:d=x.e;v=d.e;y=d.p;y=d.t;1==v._hx_index?(g=v.v,k=x.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(d=this,A.iter(a,function(a){d.check(a,b,c)}));break;default:v=this,A.iter(a,function(a){v.check(a,b,c)})}break;case 16:x=h.e;y=x.e;var z=x.p;z=x.t;1==y._hx_index?(g=y.v,k=h.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),
c.append(g,15)):(x=this,A.iter(a,function(a){x.check(a,b,c)}));break;case 21:y=h.e;z=h.name;h=y.e;z=y.p;z=y.t;if(16==h._hx_index){y=h.e;z=y.e;var B=y.p;B=y.t;1==z._hx_index?(g=z.v,k=h.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(h=this,A.iter(a,function(a){h.check(a,b,c)}))}else l=this,A.iter(a,function(a){l.check(a,b,c)});break;default:y=this,A.iter(a,function(a){y.check(a,b,c)})}break;default:z=this,A.iter(a,function(a){z.check(a,b,c)})}break;
case 7:g=f.v;k=f.init;null!=k?(b.push(this.get(g),15),this.check(k,b,c),b.pop()):(B=this,A.iter(a,function(a){B.check(a,b,c)}));break;case 8:var C=f.e;var D=f.args;var E=C.e;var F=C.p;F=C.t;if(2==E._hx_index)switch(E.g._hx_index){case 64:if(3==D.length){C=D[0];E=D[2];F=C.e;var G=C.p;G=C.t;1==F._hx_index?(C=E.e,G=E.p,G=E.t,0==C._hx_index?(E=C.c,2==E._hx_index?(k=E.v,a=D[1],g=F.v,this.check(a,b,c),null==this.channelVars[k]?(this.channelVars[k]=g,this.link(g,b)):this.link(this.channelVars[k],b)):(C=
this,A.iter(a,function(a){C.check(a,b,c)}))):(E=this,A.iter(a,function(a){E.check(a,b,c)}))):(F=this,A.iter(a,function(a){F.check(a,b,c)}))}else G=this,A.iter(a,function(a){G.check(a,b,c)});break;case 65:if(4==D.length){var H=D[0];var J=D[3];var K=H.e;var M=H.p;M=H.t;if(1==K._hx_index)if(H=J.e,M=J.p,M=J.t,0==H._hx_index)if(J=H.c,2==J._hx_index){k=J.v;var L=D[2];a=D[1];g=K.v;this.check(a,b,c);this.check(L,b,c);null==this.channelVars[k]?(this.channelVars[k]=g,this.link(g,b)):this.link(this.channelVars[k],
b)}else H=this,A.iter(a,function(a){H.check(a,b,c)});else J=this,A.iter(a,function(a){J.check(a,b,c)});else K=this,A.iter(a,function(a){K.check(a,b,c)})}else M=this,A.iter(a,function(a){M.check(a,b,c)});break;case 79:if(3==D.length){var N=D[0];var O=N.e;var R=N.p;R=N.t;1==O._hx_index?(g=O.v,a=D[1],k=D[2],g=this.get(g),b.push(g,15),this.check(a,b,c),this.check(k,b,c),b.pop(),c.append(g,15)):(D=this,A.iter(a,function(a){D.check(a,b,c)}))}else N=this,A.iter(a,function(a){N.check(a,b,c)});break;default:O=
this,A.iter(a,function(a){O.check(a,b,c)})}else R=this,A.iter(a,function(a){R.check(a,b,c)});break;case 9:var Q=f.e;var P=Q.e;L=Q.p;L=Q.t;1==P._hx_index?(g=P.v,k=f.regs,this.link(g,b,this.swizBits(k))):(Q=this,A.iter(a,function(a){Q.check(a,b,c)}));break;case 10:a=f.econd;k=f.eif;L=f.eelse;g=new Uc;this.check(k,b,g);null!=L&&this.check(L,b,g);g.appendTo(c);b.appendTo(g);this.check(a,g,c);break;case 13:g=f.v;a=f.it;k=f.loop;g=new Uc;this.check(k,b,g);g.appendTo(c);this.check(a,g,c);break;case 19:P=
f.normalWhile;a=f.e;k=f.loop;g=new Uc;this.check(k,b,g);g.appendTo(c);b.appendTo(g);this.check(a,g,c);break;case 22:P=f.target;P=f.code;a=f.args;for(f=0;f<a.length;)if(g=a[f],++f,g.access!=qc.Read)for(k=[[]],L=[null],L[0]=function(a,b){return function(c){var d=c.e;1==d._hx_index?b[0].push(e.get(d.v)):A.iter(c,a[0])}}(L,k),L[0](g.e),P=0;P<k[0].length;){g=k[0][P];++P;b.push(g,15);for(L=0;L<a.length;){var S=a[L];++L;S.access!=qc.Write&&this.check(S.e,b,c)}b.pop();c.append(g,15)}else this.check(g.e,b,
c);break;default:f=this,A.iter(a,function(a){f.check(a,b,c)})}},checkBranches:function(a){var b=a.e;switch(b._hx_index){case 10:b=b.econd;var c=new Uc;c.append(null,0);this.check(b,c,new Uc);break;case 19:b=b.e,c=new Uc,c.append(null,0),this.check(b,c,new Uc)}A.iter(a,M(this,this.checkBranches))},mapExpr:function(a,b){var c,d,e=this;var f=a.e;switch(f._hx_index){case 4:f=f.el;var g=[];for(c=d=0;c<f.length;){var h=f[c];++c;var k=b&&d==f.length-1;h=this.mapExpr(h,k);(A.hasSideEffect(h)||k)&&g.push(h);
++d}return{e:q.TBlock(g),p:a.p,t:a.t};case 5:switch(c=f.op,b=f.e1,f=f.e2,c._hx_index){case 4:switch(d=b.e,g=b.p,g=b.t,d._hx_index){case 1:return b=d.v,h=f,0==this.get(b).used?null!=h&&A.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(E.CNull),t:a.t,p:a.p}:A.map(a,function(a){return e.mapExpr(a,!0)});case 9:g=d.e;h=g.e;if(1==h._hx_index){g=h.v;h=f;if(0==this.get(g).used)return null!=h&&A.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(E.CNull),t:a.t,p:a.p};c=d.regs;h=f;return 0==(this.get(g).used&
this.swizBits(c))?A.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(E.CNull),t:a.t,p:a.p}:A.map(a,function(a){return e.mapExpr(a,!0)})}return A.map(a,function(a){return e.mapExpr(a,!0)});case 16:return g=d.e,h=d.index,d=g.e,h=g.p,h=g.t,1==d._hx_index?(b=d.v,h=f,0==this.get(b).used?null!=h&&A.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(E.CNull),t:a.t,p:a.p}:A.map(a,function(a){return e.mapExpr(a,!0)})):A.map(a,function(a){return e.mapExpr(a,!0)});default:return A.map(a,function(a){return e.mapExpr(a,
!0)})}case 20:switch(d=c.op,c=b.e,d=b.p,d=b.t,c._hx_index){case 1:return b=c.v,h=f,0==this.get(b).used?null!=h&&A.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(E.CNull),t:a.t,p:a.p}:A.map(a,function(a){return e.mapExpr(a,!0)});case 9:b=c.e;d=b.e;g=b.p;g=b.t;if(1==d._hx_index){b=d.v;h=f;if(0==this.get(b).used)return null!=h&&A.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(E.CNull),t:a.t,p:a.p};c=c.regs;h=f;return 0==(this.get(b).used&this.swizBits(c))?A.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(E.CNull),
t:a.t,p:a.p}:A.map(a,function(a){return e.mapExpr(a,!0)})}return A.map(a,function(a){return e.mapExpr(a,!0)});case 16:return b=c.e,d=c.index,c=b.e,d=b.p,d=b.t,1==c._hx_index?(b=c.v,h=f,0==this.get(b).used?null!=h&&A.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(E.CNull),t:a.t,p:a.p}:A.map(a,function(a){return e.mapExpr(a,!0)})):A.map(a,function(a){return e.mapExpr(a,!0)});default:return A.map(a,function(a){return e.mapExpr(a,!0)})}default:return A.map(a,function(a){return e.mapExpr(a,!0)})}case 7:return b=
f.v,h=f.init,0==this.get(b).used?null!=h&&A.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(E.CNull),t:a.t,p:a.p}:A.map(a,function(a){return e.mapExpr(a,!0)});case 8:if(c=f.e,b=f.args,f=c.e,d=c.p,d=c.t,2==f._hx_index)switch(f.g._hx_index){case 64:return 3==b.length&&(c=b[0],c=b[2],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index))?(c=c.v,f=b[1],b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(B.Texture),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},this.mapExpr(f,!0)]),t:x.TVoid,p:a.p}):A.map(a,
function(a){return e.mapExpr(a,!0)});case 65:return 4==b.length&&(c=b[0],c=b[3],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index))?(c=c.v,h=b[2],f=b[1],b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(B.TextureLod),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},this.mapExpr(f,!0),this.mapExpr(h,!0)]),t:x.TVoid,p:a.p}):A.map(a,function(a){return e.mapExpr(a,!0)});case 66:switch(b.length){case 3:return c=b[0],c=b[2],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index)?(c=c.v,f=b[1],b=this.channelVars[c],
{e:q.TCall({e:q.TGlobal(B.Texel),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},this.mapExpr(f,!0)]),t:x.TVoid,p:a.p}):A.map(a,function(a){return e.mapExpr(a,!0)});case 4:return c=b[0],c=b[3],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index)?(c=c.v,h=b[2],f=b[1],b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(B.Texel),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},this.mapExpr(f,!0),this.mapExpr(h,!0)]),t:x.TVoid,p:a.p}):A.map(a,function(a){return e.mapExpr(a,!0)});default:return A.map(a,function(a){return e.mapExpr(a,
!0)})}case 67:switch(b.length){case 2:return c=b[0],c=b[1],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index)?(c=c.v,b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(B.TextureSize),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p}]),t:x.TVoid,p:a.p}):A.map(a,function(a){return e.mapExpr(a,!0)});case 3:return c=b[0],c=b[2],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index)?(c=c.v,h=b[1],b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(B.TextureSize),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},
this.mapExpr(h,!0)]),t:x.TVoid,p:a.p}):A.map(a,function(a){return e.mapExpr(a,!0)});default:return A.map(a,function(a){return e.mapExpr(a,!0)})}default:return A.map(a,function(a){return e.mapExpr(a,!0)})}else return A.map(a,function(a){return e.mapExpr(a,!0)});case 10:return h=f.econd,a=f.eif,c=f.eelse,h=this.mapExpr(h,!0),a=this.mapExpr(a,b),c=null==c?null:this.mapExpr(c,b),b||A.hasSideEffect(a)||null!=c&&A.hasSideEffect(c)?{e:q.TIf(h,a,c),p:h.p,t:h.t}:{e:q.TConst(E.CNull),t:h.t,p:h.p};case 13:return b=
f.v,c=f.loop,h=this.mapExpr(f.it,!0),c=this.mapExpr(c,!1),A.hasSideEffect(c)?{e:q.TFor(b,h,c),p:a.p,t:a.t}:{e:q.TConst(E.CNull),t:a.t,p:a.p};case 19:return h=f.e,c=f.loop,a=f.normalWhile,h=this.mapExpr(h,!0),c=this.mapExpr(c,b),A.hasSideEffect(c)?{e:q.TWhile(h,c,a),p:h.p,t:h.t}:{e:q.TConst(E.CNull),t:h.t,p:h.p};case 20:return h=f.m,c=f.args,f=this.mapExpr(f.e,b),b||A.hasSideEffect(f)?{e:q.TMeta(h,c,f),t:a.t,p:a.p}:{e:q.TConst(E.CNull),t:a.t,p:a.p};default:return A.map(a,function(a){return e.mapExpr(a,
!0)})}},__class__:Ni};var gb=function(){};gb.__name__="hxsl.Debug";gb.varName=function(a,b){null==b&&(b=15);var c=a.name;15!=b&&(c+=gb.swizStr(b));return gb.VAR_IDS?c+"@"+a.id:c};gb.swizStr=function(a){var b=".";0!=(a&1)&&(b+="x");0!=(a&2)&&(b+="y");0!=(a&4)&&(b+="z");0!=(a&8)&&(b+="w");return b};var Si=function(){this.mapped=[];this.varMap=new Cc;this.funMap=new Cc;this.constants=new Fa};Si.__name__="hxsl.Eval";Si.prototype={setConstant:function(a,b){this.constants.h[a.id]=q.TConst(b)},mapVar:function(a,
b){var c,d=this.varMap.h[a.__id__];if(null!=d)return d;if(null!=a.parent&&(this.mapVar(a.parent,b),d=this.varMap.h[a.__id__],null!=d))return a==d?d:this.mapVar(d,b);var e=a.type;d={id:17==e._hx_index?a.id:A.allocVarId(),name:a.name,type:a.type,kind:a.kind};null!=a.parent&&(d.parent=this.mapVar(a.parent,b));null!=a.qualifiers&&(d.qualifiers=a.qualifiers.slice());this.varMap.set(a,d);this.varMap.set(d,d);b&&this.mapped.push(a);e=d.type;switch(e._hx_index){case 13:e=e.vl;var f=[];for(c=0;c<e.length;)a=
e[c],++c,f.push(this.mapVar(a,b));d.type=x.TStruct(f);break;case 15:f=e.size;if(1==f._hx_index)if(a=f.v,c=e.t,f=this.constants.h[a.id],null!=f)if(null==f)kb.t("Integer value expected for array size constant "+a.name,null);else if(0==f._hx_index)if(f=f.c,2==f._hx_index){a=f.v;f=d.type;switch(f._hx_index){case 15:b=x.TArray(c,Za.SConst(a));break;case 16:f=f.kind;b=x.TBuffer(c,Za.SConst(a),f);break;default:throw t.thrown("assert");}d.type=b}else kb.t("Integer value expected for array size constant "+
a.name,null);else kb.t("Integer value expected for array size constant "+a.name,null);else{b=this.mapVar(a,b);f=d.type;switch(f._hx_index){case 15:b=x.TArray(c,Za.SVar(b));break;case 16:f=f.kind;b=x.TBuffer(c,Za.SVar(b),f);break;default:throw t.thrown("assert");}d.type=b}break;case 16:if(f=e.size,1==f._hx_index)if(a=f.v,c=e.t,f=this.constants.h[a.id],null!=f)if(null==f)kb.t("Integer value expected for array size constant "+a.name,null);else if(0==f._hx_index)if(e=f.c,2==e._hx_index){a=e.v;e=d.type;
switch(e._hx_index){case 15:b=x.TArray(c,Za.SConst(a));break;case 16:f=e.kind;b=x.TBuffer(c,Za.SConst(a),f);break;default:throw t.thrown("assert");}d.type=b}else kb.t("Integer value expected for array size constant "+a.name,null);else kb.t("Integer value expected for array size constant "+a.name,null);else{b=this.mapVar(a,b);e=d.type;switch(e._hx_index){case 15:b=x.TArray(c,Za.SVar(b));break;case 16:f=e.kind;b=x.TBuffer(c,Za.SVar(b),f);break;default:throw t.thrown("assert");}d.type=b}}return d},checkTextureRec:function(a){if(A.isTexture(a))return!0;
switch(a._hx_index){case 13:a=a.vl;for(var b=0;b<a.length;){var c=a[b];++b;if(this.checkTextureRec(c.type))return!0}break;case 15:return this.checkTextureRec(a.t);case 16:return!0}return!1},needsInline:function(a){var b=0;for(a=a.args;b<a.length;){var c=a[b];++b;if(this.checkTextureRec(c.type))return!0}return!1},eval:function(a){for(var b,c=[],d=0,e=a.funs;d<e.length;){var f=e[d];++d;var g=f.kind,h=this.mapVar(f.ref,!1);b=[];for(var k=0,l=f.args;k<l.length;){var m=l[k];++k;b.push(this.mapVar(m,!1))}b=
{kind:g,ref:h,args:b,ret:f.ret,expr:f.expr};f.kind==Ca.Helper&&this.inlineCalls||this.needsInline(b)?this.funMap.set(b.ref,f):c.push(b)}d=0;for(e=c.length;d<e;)b=d++,this.curFun=c[b],this.curFun.expr=this.evalExpr(this.curFun.expr,!1);f=a.name;d=[];e=0;for(b=a.vars;e<b.length;)a=b[e],++e,d.push(this.mapVar(a,!1));return{name:f,vars:d,funs:c}},hasReturn:function(a){this.markReturn=!1;this.hasReturnLoop(a);return this.markReturn},hasReturnLoop:function(a){12==a.e._hx_index?this.markReturn=!0:this.markReturn||
A.iter(a,M(this,this.hasReturnLoop))},handleReturn:function(a,b){null==b&&(b=!1);var c=a.e;switch(c._hx_index){case 3:var d=c.e;b=this.handleReturn(d,b);return{e:q.TParenthesis(b),t:b.t,p:a.p};case 4:var e=c.el,f=0,g=e.length;c=[];a:for(;f<g;){var h=e[f++];if(f==g)c.push(this.handleReturn(h,b));else{var k=h.e;switch(k._hx_index){case 10:if(null==k.eelse)if(d=k.eif,k=k.econd,b&&this.hasReturn(d)){c.push(this.handleReturn({e:q.TIf(k,d,{e:q.TBlock(e.slice(f)),t:h.t,p:h.p}),t:h.t,p:h.p}));break a}else c.push(this.handleReturn(h));
else c.push(this.handleReturn(h));break;case 12:c.push(this.handleReturn(k.e,b));break a;default:c.push(this.handleReturn(h))}}}b=b?0==c.length?x.TVoid:c[c.length-1].t:a.t;return{e:q.TBlock(c),t:b,p:a.p};case 10:return e=c.econd,d=c.eif,c=c.eelse,null!=c&&b?(e=this.handleReturn(e),d=this.handleReturn(d,b),{e:q.TIf(e,d,this.handleReturn(c,b)),t:d.t,p:a.p}):A.map(a,M(this,this.handleReturnDef));case 12:return d=c.e,b||kb.t("Cannot inline not final return",a.p),null==d?{e:q.TBlock([]),t:x.TVoid,p:a.p}:
this.handleReturn(d,!0);default:return A.map(a,M(this,this.handleReturnDef))}},handleReturnDef:function(a){return this.handleReturn(a)},evalCall:function(a,b,c,d){var e;switch(a._hx_index){case 28:if(1==b.length){var f=b[0];var g=f.e;if(1==g._hx_index&&(f=g.v,f=f.type,15==f._hx_index&&(g=f.size,0==g._hx_index)))return f=g.v,q.TConst(E.CInt(f))}return null;case 39:if(1==b.length&&(f=b[0],g=f.e,0==g._hx_index&&(f=g.c,2==f._hx_index))){var h=f.v;return q.TConst(E.CFloat(h))}return null;case 64:case 65:f=
b[0].e;if(0==f._hx_index)if(g=f.c,2==g._hx_index)h=e=g.v;else throw kb.t("Cannot eval complex channel "+ra.toString(b[0],!0)+" "+this.constantsToString(),d),t.thrown("assert");else throw kb.t("Cannot eval complex channel "+ra.toString(b[0],!0)+" "+this.constantsToString(),d),t.thrown("assert");g=c[0];f=g.e;if(1==f._hx_index)f=f.v,f=q.TVar(this.mapVar(f,!1));else throw t.thrown("assert");g={e:f,t:g.t,p:g.p};f=g.t;if(17==f._hx_index)c=e=f.size;else throw t.thrown("assert");var k=da.createEnumIndex(lb,
h&7,null),l=[g];f=1;for(g=b.length;f<g;)e=f++,l.push(b[e]);l.push({e:q.TConst(E.CInt(h>>3)),t:x.TInt,p:d});b={e:q.TCall({e:q.TGlobal(a),t:x.TVoid,p:d},l),t:x.TVoid,p:d};switch(k._hx_index){case 0:return b={e:q.TConst(E.CFloat(0)),t:x.TFloat,p:d},1==c?b.e:q.TCall({e:q.TGlobal([B.Vec2,B.Vec3,B.Vec4][c-2]),t:x.TVoid,p:d},[b]);case 1:case 2:case 3:case 4:switch(c){case 1:switch(k._hx_index){case 1:d=[fa.X];break;case 2:d=[fa.Y];break;case 3:d=[fa.Z];break;case 4:d=[fa.W];break;default:throw t.thrown("Invalid channel value "+
y.string(k)+" for "+c+" channels");}break;case 2:switch(k._hx_index){case 1:d=[fa.X,fa.Y];break;case 2:d=[fa.Y,fa.Z];break;case 3:d=[fa.Z,fa.W];break;default:throw t.thrown("Invalid channel value "+y.string(k)+" for "+c+" channels");}break;case 3:switch(k._hx_index){case 1:d=[fa.X,fa.Y,fa.Z];break;case 2:d=[fa.Y,fa.Z,fa.W];break;default:throw t.thrown("Invalid channel value "+y.string(k)+" for "+c+" channels");}break;default:throw t.thrown("Invalid channel value "+y.string(k)+" for "+c+" channels");
}return q.TSwiz(b,d);case 5:return q.TCall({e:q.TGlobal(B.Unpack),t:x.TVoid,p:d},[b]);case 6:return q.TCall({e:q.TGlobal(B.UnpackNormal),t:x.TVoid,p:d},[b])}break;case 68:for(f=0;f<b.length;)d=b[f],++f,$a.trace(ra.toString(d),{fileName:d.p.file,lineNumber:0,className:null,methodName:null});return q.TBlock([]);default:return null}},constantsToString:function(){for(var a=[],b=this.constants.keys();b.hasNext();){var c=b.next();a.push(c+" => "+ra.toString({e:this.constants.h[c],t:x.TVoid,p:null},!0))}return a.toString()},
ifBlock:function(a){return(null!=a?10!=a.e._hx_index:1)?a:{e:q.TBlock([a]),t:a.t,p:a.p}},evalExpr:function(a,b){null==b&&(b=!0);var c=this;var d=a.t;var e=a.e;switch(e._hx_index){case 0:var f=e.c;var g=a.e;break;case 1:f=e.v;var h=this.constants.h[f.id];null!=h?g=h:(b=this.mapVar(f,!1),d=b.type,g=q.TVar(b));break;case 2:f=e.g;g=a.e;break;case 3:h=e.e;var k=this.evalExpr(h,b);f=k.e;0==f._hx_index?(e=f.c,g=k.e):g=q.TParenthesis(k);break;case 4:var l=e.el;var m=this.mapped.length;var p=[];k=l.length-
1;f=0;for(e=l.length;f<e;){g=f++;var r=b&&g==k;h=this.evalExpr(l[g],r);var n=h.e;switch(n._hx_index){case 0:g=n.c;r&&p.push(h);break;case 1:var u=n.v;r&&p.push(h);break;default:p.push(h)}}for(;this.mapped.length>m;)f=this.mapped.pop(),b=this.varMap.h[f.__id__],null!=b&&(this.varMap.remove(f),this.varMap.remove(b));g=1==p.length&&this.curFun.kind!=Ca.Init?p[0].e:q.TBlock(p);break;case 5:b=e.op;h=e.e1;k=e.e2;h=this.evalExpr(h);m=this.evalExpr(k);switch(b._hx_index){case 0:f=h.e;e=m.e;if(0==f._hx_index)switch(n=
f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n+e|0))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CFloat(n+e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 1:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n*e|0))):g=q.TBinop(b,h,m)):g=q.TBinop(b,
h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CFloat(n*e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n/e|0))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CFloat(n/e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,
m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n-e|0))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CFloat(n-e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:case 21:g=q.TBinop(b,h,m);break;case 5:f=h.e;e=m.e;if(0==f._hx_index)switch(n=
f.c,n._hx_index){case 0:g=0==e._hx_index?0==e.c._hx_index?q.TConst(E.CBool(!0)):q.TConst(E.CBool(!1)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 1:e=g.b;g=q.TConst(E.CBool(0==(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 2:e=g.v;g=q.TConst(E.CBool(0==f-e));break;default:g=q.TBinop(b,h,m)}else g=
q.TBinop(b,h,m);break;case 3:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 3:e=g.v;n=f;g=q.TConst(E.CBool(0==(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 4:e=n.v;n=f;g=q.TConst(E.CBool(0==(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 6:f=h.e;e=m.e;if(0==f._hx_index)switch(n=
f.c,n._hx_index){case 0:g=0==e._hx_index?0==e.c._hx_index?q.TConst(E.CBool(!1)):q.TConst(E.CBool(!0)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 1:e=g.b;g=q.TConst(E.CBool(0!=(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 2:e=g.v;g=q.TConst(E.CBool(0!=f-e));break;default:g=q.TBinop(b,h,m)}else g=
q.TBinop(b,h,m);break;case 3:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 3:e=g.v;n=f;g=q.TConst(E.CBool(0!=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 4:e=n.v;n=f;g=q.TConst(E.CBool(0!=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 7:f=h.e;e=m.e;if(0==f._hx_index)switch(n=
f.c,n._hx_index){case 0:g=0==e._hx_index?q.TConst(E.CBool(!1)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 1:e=g.b;g=q.TConst(E.CBool(0<(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 2:e=g.v;g=q.TConst(E.CBool(0<f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=n.v;if(0==
e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 3:e=g.v;n=f;g=q.TConst(E.CBool(0<(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 4:e=n.v;n=f;g=q.TConst(E.CBool(0<(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 8:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 0:g=
0==e._hx_index?0==e.c._hx_index?q.TConst(E.CBool(!0)):q.TConst(E.CBool(!1)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 1:e=g.b;g=q.TConst(E.CBool(0<=(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 2:e=g.v;g=q.TConst(E.CBool(0<=f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=
n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 3:e=g.v;n=f;g=q.TConst(E.CBool(0<=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(E.CBool(!0));break;case 4:e=n.v;n=f;g=q.TConst(E.CBool(0<=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 9:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 0:g=
0==e._hx_index?0==e.c._hx_index?q.TConst(E.CBool(!1)):q.TConst(E.CBool(!0)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 1:e=g.b;g=q.TConst(E.CBool(0>(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 2:e=g.v;g=q.TConst(E.CBool(0>f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=
n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 3:e=g.v;n=f;g=q.TConst(E.CBool(0>(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 4:e=n.v;n=f;g=q.TConst(E.CBool(0>(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 10:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 0:g=
0==e._hx_index?q.TConst(E.CBool(!0)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 1:e=g.b;g=q.TConst(E.CBool(0>=(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 2:e=g.v;g=q.TConst(E.CBool(0>=f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=n.v;if(0==e._hx_index)switch(g=e.c,
g._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 3:e=g.v;n=f;g=q.TConst(E.CBool(0>=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(E.CBool(!1));break;case 4:e=n.v;n=f;g=q.TConst(E.CBool(0>=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 11:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?(f=e.c,2==f._hx_index?
(e=f.v,n=n.v,g=q.TConst(E.CInt(n&e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 12:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n|e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 13:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n^e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=
q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 14:f=h.e;e=m.e;0==f._hx_index?(n=f.c,1==n._hx_index?(f=n.b,0==e._hx_index?(n=e.c,1==n._hx_index?(e=n.b,g=q.TConst(E.CBool(f&&e))):(n=f,g=0==n?q.TConst(E.CBool(n)):m.e)):(n=f,g=0==n?q.TConst(E.CBool(n)):m.e)):0==e._hx_index?(f=e.c,1==f._hx_index?(n=f.b,g=0==n?q.TConst(E.CBool(n)):h.e):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m)):0==e._hx_index?(f=e.c,1==f._hx_index?(n=f.b,g=0==n?q.TConst(E.CBool(n)):h.e):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 15:f=h.e;
e=m.e;0==f._hx_index?(n=f.c,1==n._hx_index?(f=n.b,0==e._hx_index?(n=e.c,1==n._hx_index?(e=n.b,g=q.TConst(E.CBool(f||e))):(n=f,g=1==n?q.TConst(E.CBool(n)):m.e)):(n=f,g=1==n?q.TConst(E.CBool(n)):m.e)):0==e._hx_index?(f=e.c,1==f._hx_index?(n=f.b,g=1==n?q.TConst(E.CBool(n)):h.e):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m)):0==e._hx_index?(f=e.c,1==f._hx_index?(n=f.b,g=1==n?q.TConst(E.CBool(n)):h.e):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 16:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?
(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n<<e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 17:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n>>e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 18:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n>>>e))):g=q.TBinop(b,
h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 19:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CInt(n%e|0))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,g=q.TConst(E.CFloat(n%e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 20:f=b.op;g=q.TBinop(b,h,m);break;default:throw t.thrown("assert");
}break;case 6:b=e.op;h=e.e1;k=this.evalExpr(h);f=k.e;if(0==f._hx_index)switch(h=f.c,b._hx_index){case 2:1==h._hx_index?(e=h.b,g=q.TConst(E.CBool(!e))):g=q.TUnop(b,k);break;case 3:switch(h._hx_index){case 2:g=h.v;g=q.TConst(E.CInt(-g));break;case 3:l=h.v;g=q.TConst(E.CFloat(-l));break;default:g=q.TUnop(b,k)}break;default:g=q.TUnop(b,k)}else g=q.TUnop(b,k);break;case 7:f=e.v;e=e.init;g=q.TVarDecl(this.mapVar(f,!0),null==e?null:this.evalExpr(e));break;case 8:h=e.e;g=e.args;h=this.evalExpr(h);f=[];for(e=
0;e<g.length;)n=g[e],++e,f.push(this.evalExpr(n));p=f;f=h.e;switch(f._hx_index){case 1:f=f.v;if(null!=this.funMap.h.__keys__[f.__id__]){l=this.funMap.h[f.__id__];m=[];k=[];e=0;for(n=l.args.length;e<n;)switch(g=e++,f=[l.args[g]],h=p[g],g=h.e,g._hx_index){case 0:u=g.c;k.push(function(a,b){return function(){null==a[0]?c.constants.remove(b[0].id):c.constants.h[b[0].id]=a[0]}}([this.constants.h[f[0].id]],f));this.constants.h[f[0].id]=h.e;break;case 1:switch(g.v.kind._hx_index){case 0:case 1:case 2:k.push(function(a,
b){return function(){null==a[0]?c.constants.remove(b[0].id):c.constants.h[b[0].id]=a[0]}}([this.constants.h[f[0].id]],f));this.constants.h[f[0].id]=h.e;break;default:g=[this.varMap.h[f[0].__id__]],null==g[0]?k.push(function(a){return function(){c.varMap.remove(a[0])}}(f)):(this.varMap.remove(f[0]),k.push(function(a,b){return function(){c.varMap.set(b[0],a[0])}}(g,f))),b=this.mapVar(f[0],!1),m.push({e:q.TVarDecl(b,h),t:x.TVoid,p:h.p})}break;default:g=[this.varMap.h[f[0].__id__]],null==g[0]?k.push(function(a){return function(){c.varMap.remove(a[0])}}(f)):
(this.varMap.remove(f[0]),k.push(function(a,b){return function(){c.varMap.set(b[0],a[0])}}(g,f))),f=this.mapVar(f[0],!1),m.push({e:q.TVarDecl(f,h),t:x.TVoid,p:h.p})}h=this.handleReturn(this.evalExpr(l.expr,!1),!0);for(e=0;e<k.length;)f=k[e],++e,f();e=h.e;if(4==e._hx_index)for(l=e.el,e=0;e<l.length;)k=l[e],++e,m.push(k);else m.push(h);g=q.TBlock(m)}else g=q.TCall(h,p);break;case 2:m=this.evalCall(f.g,p,g,a.p);g=null!=m?m:q.TCall(h,p);break;default:g=kb.t("Cannot eval non-static call expresssion '"+
(new ra).exprString(h)+"'",h.p)}break;case 9:h=e.e;e=e.regs;g=q.TSwiz(this.evalExpr(h),e.slice());break;case 10:n=e.eif;g=e.eelse;h=this.evalExpr(e.econd);f=h.e;0==f._hx_index?(e=f.c,1==e._hx_index?g=(e=e.b)?this.evalExpr(n,b).e:null==g?q.TConst(E.CNull):this.evalExpr(g,b).e:b&&null!=g&&this.eliminateConditionals?g=q.TCall({e:q.TGlobal(B.Mix),t:a.t,p:a.p},[this.evalExpr(g,!0),this.evalExpr(n,!0),{e:q.TCall({e:q.TGlobal(B.ToFloat),t:x.TFun([]),p:h.p},[h]),t:x.TFloat,p:a.p}]):(n=this.evalExpr(n,b),
null!=g&&(g=this.evalExpr(g,b),f=g.e,0==f._hx_index&&0==f.c._hx_index&&(g=null)),n=this.ifBlock(n),g=this.ifBlock(g),g=q.TIf(h,n,g))):b&&null!=g&&this.eliminateConditionals?g=q.TCall({e:q.TGlobal(B.Mix),t:a.t,p:a.p},[this.evalExpr(g,!0),this.evalExpr(n,!0),{e:q.TCall({e:q.TGlobal(B.ToFloat),t:x.TFun([]),p:h.p},[h]),t:x.TFloat,p:a.p}]):(n=this.evalExpr(n,b),null!=g&&(g=this.evalExpr(g,b),f=g.e,0==f._hx_index&&0==f.c._hx_index&&(g=null)),n=this.ifBlock(n),g=this.ifBlock(g),g=q.TIf(h,n,g));break;case 11:g=
q.TDiscard;break;case 12:h=e.e;g=q.TReturn(null==h?null:this.evalExpr(h));break;case 13:m=e.v;f=e.it;h=e.loop;b=this.mapVar(m,!0);p=this.evalExpr(f);f=p.e;if(5==f._hx_index)if(e=f.e1,n=f.e2,21==f.op._hx_index)if(f=e.e,g=e.p,g=e.t,0==f._hx_index)if(e=f.c,2==e._hx_index)if(f=n.e,g=n.p,g=n.t,0==f._hx_index)if(n=f.c,2==n._hx_index)if(n=n.v,e=e.v,this.unrollLoops){p=[];f=e;for(e=n;f<e;)g=f++,this.constants.h[m.id]=q.TConst(E.CInt(g)),p.push(this.evalExpr(h,!1));this.constants.remove(m.id);h=q.TBlock(p)}else h=
q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));this.varMap.remove(m);g=h;break;case 14:g=q.TContinue;break;case 15:g=q.TBreak;break;case 16:h=e.e;k=e.index;h=this.evalExpr(h);m=this.evalExpr(k);
f=h.e;e=m.e;if(17==f._hx_index)if(0==e._hx_index)if(n=e.c,2==n._hx_index)if(g=n.v,l=f.el,0<=g&&g<l.length)g=l[g].e;else{f=h.t;switch(f._hx_index){case 15:e=f.size;d=f.t;break;case 16:e=f.size,e=f.kind,d=f.t}g=q.TArray(h,m)}else{f=h.t;switch(f._hx_index){case 15:e=f.size;d=f.t;break;case 16:e=f.size,e=f.kind,d=f.t}g=q.TArray(h,m)}else{f=h.t;switch(f._hx_index){case 15:e=f.size;d=f.t;break;case 16:e=f.size,e=f.kind,d=f.t}g=q.TArray(h,m)}else{f=h.t;switch(f._hx_index){case 15:e=f.size;d=f.t;break;case 16:e=
f.size,e=f.kind,d=f.t}g=q.TArray(h,m)}break;case 17:l=e.el;f=[];for(e=0;e<l.length;)h=l[e],++e,f.push(this.evalExpr(h));g=q.TArrayDecl(f);break;case 18:h=e.e;p=e.cases;l=e.def;k=this.evalExpr(h);f=[];for(e=0;e<p.length;){h=p[e];++e;n=[];g=0;for(u=h.values;g<u.length;)m=u[g],++g,n.push(this.evalExpr(m));f.push({values:n,expr:this.evalExpr(h.expr,b)})}p=f;b=null==l?null:this.evalExpr(l,b);u=!1;f=k.e;if(0==f._hx_index)if(h=f.c,2==h._hx_index)for(l=h.v,f=0;f<p.length;)for(h=p[f],++f,e=0,n=h.values;e<
n.length;)if(m=n[e],++e,g=m.e,0==g._hx_index)switch(g=g.c,g._hx_index){case 2:if(g.v==l)return h.expr;break;case 3:if(g.v==l)return h.expr}else u=!0;else throw t.thrown("Unsupported switch constant "+y.string(h));else u=!0;g=u?q.TSwitch(k,p,b):null==b?q.TBlock([]):b.e;break;case 19:f=e.e;h=e.loop;e=e.normalWhile;f=this.evalExpr(f);n=this.evalExpr(h,!1);g=q.TWhile(f,this.ifBlock(n),e);break;case 20:f=e.m;p=e.args;h=e.e;"unroll"==f?(this.unrollLoops=!0,k=this.evalExpr(h,b),this.unrollLoops=!1):k=this.evalExpr(h,
b);g=q.TMeta(f,p,k);break;case 21:h=e.e;f=e.name;g=q.TField(this.evalExpr(h),f);break;case 22:n=e.target;g=e.code;p=e.args;e=[];for(f=0;f<p.length;)h=p[f],++f,e.push({e:this.evalExpr(h.e),access:h.access});g=q.TSyntax(n,g,e)}return{e:g,t:d,p:a.p}},__class__:Si};var ae=function(a,b,c,d){this.g=a;this.t=b;this.pos=c;this.size=d};ae.__name__="hxsl._Flatten.Alloc";ae.prototype={__class__:ae};var sd=K["hxsl.ARead"]={__ename__:!0,__constructs__:null,AIndex:(z=function(a){return{_hx_index:0,a:a,__enum__:"hxsl.ARead",
toString:v}},z._hx_name="AIndex",z.__params__=["a"],z),AOffset:(z=function(a,b,c){return{_hx_index:1,a:a,stride:b,delta:c,__enum__:"hxsl.ARead",toString:v}},z._hx_name="AOffset",z.__params__=["a","stride","delta"],z)};sd.__constructs__=[sd.AIndex,sd.AOffset];sd.__empty_constructs__=[];var zb=function(){};zb.__name__="hxsl.Flatten";zb.prototype={flatten:function(a,b){this.globals=[];this.params=[];this.outVars=[];this.textureFormats=[];this.varMap=new Cc;this.allocData=new Cc;for(var c=0,d=a.vars;c<
d.length;){var e=d[c];++c;this.gatherVar(e)}switch(b._hx_index){case 0:b="vertex";break;case 1:b="fragment";break;case 4:b="compute";break;default:throw t.thrown("assert");}this.pack(b+"Globals",L.Global,this.globals,Q.VFloat);this.pack(b+"Params",L.Param,this.params,Q.VFloat);e=this.globals.concat(this.params);this.textureFormats.sort(function(a,b){return a.rw!=b.rw?a.rw-b.rw:a.arr!=b.arr?a.arr?1:-1:a.dim._hx_index-b.dim._hx_index});c=0;for(d=this.textureFormats;c<d.length;){var f=d[c];++c;if(f.dim==
Ta.T2D)var g="";else g=f.dim,g=F.substr(K[g.__enum__].__constructs__[g._hx_index]._hx_name,1,null);0<f.rw&&(g="RW"+g+f.rw);f.arr&&(g+="Array");this.packTextures(b+"Textures"+g,e,0==f.rw?x.TSampler(f.dim,f.arr):x.TRWTexture(f.dim,f.arr,f.rw))}this.packBuffers("buffers",e,Ab.Uniform);this.packBuffers("storagebuffers",e,Ab.Storage);this.packBuffers("rwbuffers",e,Ab.RW);c=[];d=0;for(b=a.funs;d<b.length;)e=b[d],++d,c.push(this.mapFun(e,M(this,this.mapExpr)));return{name:a.name,vars:this.outVars,funs:c}},
mapFun:function(a,b){return{kind:a.kind,ret:a.ret,args:a.args,ref:a.ref,expr:b(a.expr)}},mkOp:function(a,b,c,d,e){var f=a.e;return 0==f._hx_index&&(f=f.c,2==f._hx_index)?{e:q.TConst(E.CInt(c(f.v,b))),t:x.TInt,p:e}:{e:q.TBinop(d,a,{e:q.TConst(E.CInt(b)),t:x.TInt,p:e}),t:x.TInt,p:e}},mkAdd:function(a,b,c){return 0==b?a:this.mkOp(a,b,function(a,b){return a+b},aa.OpAdd,c)},mkMult:function(a,b,c){return 1==b?a:this.mkOp(a,b,function(a,b){return a*b},aa.OpMult,c)},mapExpr:function(a){var b;var c=a.e;switch(c._hx_index){case 1:var d=
c.v;var e=this.varMap.h[d.__id__];null!=e&&(a=this.access(e,d.type,a.p,sd.AIndex(e)));break;case 5:if(4==c.op._hx_index){var f=c.e1;c=c.e2;if(7==a.t._hx_index){var g=f.e;var h=21==g._hx_index?!0:!1}else h=!1;if(h)if(g=f.e,21==g._hx_index)if(7==f.t._hx_index){h=g.name;f=g.e;e=-1;g=f.t;if(13==g._hx_index){var k=g.vl;for(g=b=0;g<k.length;){d=k[g];++g;if(d.name==h){e=b;break}b+=A.size(d.type)}}if(0>e)throw t.thrown("assert");g=e;d=this.mapExpr(f);b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(g>>2)),
p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(g&3)?f=b:(e=zb.SWIZ.slice(g&3,(g&3)+4),f={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});h={e:q.TBinop(aa.OpAssign,f,{e:q.TArray(c,{e:q.TConst(E.CInt(0)),t:x.TInt,p:null}),t:x.TVec(4,Q.VFloat),p:null}),t:a.t,p:a.p};e=g+4;b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?f=b:(e=zb.SWIZ.slice(e&3,(e&3)+4),f={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});k={e:q.TBinop(aa.OpAssign,f,{e:q.TArray(c,
{e:q.TConst(E.CInt(1)),t:x.TInt,p:null}),t:x.TVec(4,Q.VFloat),p:null}),t:a.t,p:a.p};e=g+8;b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?f=b:(e=zb.SWIZ.slice(e&3,(e&3)+4),f={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});var l={e:q.TBinop(aa.OpAssign,f,{e:q.TArray(c,{e:q.TConst(E.CInt(2)),t:x.TInt,p:null}),t:x.TVec(4,Q.VFloat),p:null}),t:a.t,p:a.p};e=g+12;b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,
Q.VFloat)});0==(e&3)?f=b:(e=zb.SWIZ.slice(e&3,(e&3)+4),f={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});a={e:q.TBlock([h,k,l,{e:q.TBinop(aa.OpAssign,f,{e:q.TArray(c,{e:q.TConst(E.CInt(3)),t:x.TInt,p:null}),t:x.TVec(4,Q.VFloat),p:null}),t:a.t,p:a.p}]),t:a.t,p:a.p}}else throw t.thrown("assert");else throw t.thrown("assert");else a=A.map(a,M(this,this.mapExpr))}else a=A.map(a,M(this,this.mapExpr));break;case 7:d=c.v;c=c.init;g=d.type;(f=13==g._hx_index?!0:!1)?(k=Math.ceil(A.size(d.type)/4),f={id:A.allocVarId(),
name:d.name,type:x.TArray(x.TVec(4,Q.VFloat),Za.SConst(k)),kind:d.kind,qualifiers:d.qualifiers},e=new ae(f,Q.VFloat,0,0),e.v=d,this.varMap.set(d,e),a={e:q.TVarDecl(f,null==c?null:this.mapExpr(c)),t:x.TVoid,p:a.p}):a=A.map(a,M(this,this.mapExpr));break;case 16:g=c.e;f=g.e;if(1==f._hx_index)if(d=f.v,b=g.p,l=c.index,e=this.varMap.h[d.__id__],null!=e?(g=d.type,(c=16==g._hx_index?!0:!1)?f=!1:(g=l.e,0==g._hx_index?(f=g.c,f=2==f._hx_index?!0:!1):f=!1)):f=!0,f)a=A.map(a,M(this,this.mapExpr));else switch(g=
d.type,g._hx_index){case 5:switch(g.t._hx_index){case 0:case 1:a=A.map(a,M(this,this.mapExpr));break;default:throw t.thrown("assert");}break;case 15:h=f=g.t;if(A.isTexture(h))l=this.toInt(this.mapExpr(l)),a=this.access(e,h,b,sd.AOffset(e,1,l));else{h=f;k=this.varSize4Bytes(h,e.t);0!=k?(f=d.type,f=(c=15==f._hx_index?!0:!1)&&0!=(k&3)):f=!0;if(f)throw t.thrown(new kb("Dynamic access to an Array which size is not 4 components-aligned is not allowed",a.p));k=k+3>>2;l=this.toInt(this.mapExpr(l));a=this.access(e,
h,b,sd.AOffset(e,k,this.mkMult(l,k,b)))}break;case 16:f=g.t;switch(f._hx_index){case 1:case 3:a=A.map(a,M(this,this.mapExpr));break;default:h=f;k=this.varSize4Bytes(h,e.t);0!=k?(g=d.type,f=(c=15==g._hx_index?!0:!1)&&0!=(k&3)):f=!0;if(f)throw t.thrown(new kb("Dynamic access to an Array which size is not 4 components-aligned is not allowed",a.p));k=k+3>>2;l=this.toInt(this.mapExpr(l));a=this.access(e,h,b,sd.AOffset(e,k,this.mkMult(l,k,b)))}break;default:throw t.thrown("assert");}else a=A.map(a,M(this,
this.mapExpr));break;case 21:f=c.e;h=c.name;e=-1;c=f.t;if(13==c._hx_index)for(k=c.vl,c=b=0;c<k.length;){d=k[c];++c;if(d.name==h){e=b;break}b+=A.size(d.type)}if(0>e)throw t.thrown("assert");g=e;d=this.mapExpr(f);c=a.t;switch(c._hx_index){case 3:b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});e=zb.SWIZ.slice(g&3,(g&3)+1);a={e:q.TSwiz(b,e),t:x.TFloat,p:a.p};break;case 5:if(1==c.t._hx_index)if(k=c.size,c=g+k-1>>2,g>>2==c)b=this.optimize({e:q.TArray(d,
{e:q.TConst(E.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)}),4==k&&0==(g&3)?a=b:(e=zb.SWIZ.slice(g&3,(g&3)+k),a={e:q.TSwiz(b,e),t:1==k?x.TFloat:x.TVec(k,Q.VFloat),p:a.p});else{h=(c<<2)-g;switch(k){case 2:c=B.Vec2;break;case 3:c=B.Vec3;break;case 4:c=B.Vec4;break;default:throw t.thrown("assert");}f={e:q.TGlobal(c),p:a.p,t:x.TVoid};b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});4==h&&0==(g&3)?c=b:(e=zb.SWIZ.slice(g&3,(g&3)+h),c={e:q.TSwiz(b,
e),t:1==h?x.TFloat:x.TVec(h,Q.VFloat),p:a.p});e=g+h;g=k-h;b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});4==g&&0==(e&3)?h=b:(e=zb.SWIZ.slice(e&3,(e&3)+g),h={e:q.TSwiz(b,e),t:1==g?x.TFloat:x.TVec(g,Q.VFloat),p:a.p});a={e:q.TCall(f,[c,h]),t:a.t,p:a.p}}else throw t.thrown("Unsupported type "+A.toString(a.t));break;case 7:f={e:q.TGlobal(B.Mat4),p:a.p,t:x.TVoid};b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,
Q.VFloat)});0==(g&3)?c=b:(e=zb.SWIZ.slice(g&3,(g&3)+4),c={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+4;b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?h=b:(e=zb.SWIZ.slice(e&3,(e&3)+4),h={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+8;b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?k=b:(e=zb.SWIZ.slice(e&3,(e&3)+4),k={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+
12;b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?l=b:(e=zb.SWIZ.slice(e&3,(e&3)+4),l={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});a={e:q.TCall(f,[c,h,k,l]),t:a.t,p:a.p};break;case 8:f={e:q.TGlobal(B.Mat3x4),p:a.p,t:x.TVoid};b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(g&3)?c=b:(e=zb.SWIZ.slice(g&3,(g&3)+4),c={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+4;b=this.optimize({e:q.TArray(d,
{e:q.TConst(E.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?h=b:(e=zb.SWIZ.slice(e&3,(e&3)+4),h={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+8;b=this.optimize({e:q.TArray(d,{e:q.TConst(E.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?k=b:(e=zb.SWIZ.slice(e&3,(e&3)+4),k={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});a={e:q.TCall(f,[c,h,k]),t:a.t,p:a.p};break;case 9:k=c.size;f={e:q.TGlobal(B.UnpackSnorm4x8),p:a.p,t:x.TVec(k,Q.VFloat)};b=this.optimize({e:q.TArray(d,
{e:q.TConst(E.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});e=zb.SWIZ.slice(g&3,(g&3)+1);a={e:q.TCall(f,[this.floatBitsToUint({e:q.TSwiz(b,e),t:x.TFloat,p:a.p})]),t:a.t,p:a.p};break;default:throw t.thrown("Unsupported type "+A.toString(a.t));}break;default:a=A.map(a,M(this,this.mapExpr))}return this.optimize(a)},mkInt:function(a,b){return{e:q.TConst(E.CInt(a)),t:x.TInt,p:b}},readIndex:function(a,b,c){var d=null==a.t?a.pos:a.pos>>2;return{e:q.TArray({e:q.TVar(a.g),t:a.g.type,p:c},{e:q.TConst(E.CInt(d+
b)),t:x.TInt,p:c}),t:x.TVec(4,a.t),p:c}},readOffset:function(a,b,c,d,e){b=this.mkAdd(c,16==a.g.type._hx_index?d:(null==a.t?a.pos:a.pos>>2)+d,e);return{e:q.TArray({e:q.TVar(a.g),t:a.g.type,p:e},b),t:x.TVec(4,a.t),p:e}},access:function(a,b,c,d){switch(b._hx_index){case 6:var e=this.access(a,x.TMat3x4,c,d);return{e:q.TCall({e:q.TGlobal(B.Mat3),t:x.TFun([]),p:c},[e]),t:x.TMat3,p:c};case 7:e={e:q.TGlobal(B.Mat4),t:x.TFun([]),p:c};switch(d._hx_index){case 0:var f=d.a;var g=null==f.t?f.pos:f.pos>>2;var h=
{e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a;g=d.delta;var k=f.g.type;var l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2;g=this.mkAdd(g,l,c);h={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;var m={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g+1)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?
1:(null==f.t?f.pos:f.pos>>2)+1,g=this.mkAdd(g,l,c),m={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;var p={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g+2)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?2:(null==f.t?f.pos:f.pos>>2)+2,g=this.mkAdd(g,l,c),p={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=d.a;
g=null==f.t?f.pos:f.pos>>2;var r={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g+3)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?3:(null==f.t?f.pos:f.pos>>2)+3,g=this.mkAdd(g,l,c),r={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}return{e:q.TCall(e,[h,m,p,r]),t:x.TMat4,p:c};case 8:e={e:q.TGlobal(B.Mat3x4),t:x.TFun([]),p:c};switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;h={e:q.TArray({e:q.TVar(f.g),t:f.g.type,
p:c},{e:q.TConst(E.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2,g=this.mkAdd(g,l,c),h={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;m={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g+1)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?1:(null==f.t?f.pos:f.pos>>2)+1,g=this.mkAdd(g,
l,c),m={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;p={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g+2)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?2:(null==f.t?f.pos:f.pos>>2)+2,g=this.mkAdd(g,l,c),p={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}return{e:q.TCall(e,[h,m,p]),t:x.TMat3x4,p:c};case 13:b=b.vl;for(k=h=0;k<b.length;)f=
b[k],++k,h+=this.varSize(f.type,a.t);b=Math.ceil(h/4);k=[];h=0;for(m=b;h<m;){l=h++;switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;e={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g+l)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:a=d.a,g=d.delta,l=16==a.g.type._hx_index?l:(null==a.t?a.pos:a.pos>>2)+l,g=this.mkAdd(g,l,c),e={e:q.TArray({e:q.TVar(a.g),t:a.g.type,p:c},g),t:x.TVec(4,a.t),p:c}}k.push(e)}return{e:q.TArrayDecl(k),t:x.TArray(x.TVec(4,Q.VFloat),Za.SConst(b)),
p:c};case 15:k=b.size;if(0==k._hx_index){d=k.v;e=b.t;b=a.size/d|0;k=[];h=0;for(m=d;h<m;)l=h++,f=new ae(a.g,a.t,a.pos+b*l,b),k.push(this.access(f,e,c,sd.AIndex(f)));return{e:q.TArrayDecl(k),t:e,p:c}}e=b;if(A.isTexture(e)){switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2,g=this.mkAdd(g,l,c),f={e:q.TArray({e:q.TVar(f.g),
t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}f.t=e}else{h=this.varSize(b,a.t);if(4<h)return kb.t("Access not supported for "+A.toString(b),null);switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2,g=this.mkAdd(g,l,c),f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}if(4==h){if(-1==a.pos)return{e:q.TCall({e:q.TGlobal(B.Vec4),
t:x.TFun([]),p:c},[{e:q.TConst(E.CFloat(0)),t:x.TFloat,p:c}]),t:x.TVec(4,Q.VFloat),p:c}}else{d=[];for(k=0;k<h;)l=k++,d.push(A.SWIZ[l+(a.pos&3)]);f={e:q.TSwiz(f,d),t:b,p:c}}switch(b._hx_index){case 1:f.t=x.TFloat;f=this.toInt(f);break;case 5:0==b.t._hx_index&&(h=b.size,f.t=x.TVec(h,Q.VFloat),f={e:q.TCall({e:q.TGlobal([B.IVec2,B.IVec3,B.IVec4][h-2]),t:x.TFun([]),p:c},[f]),t:b,p:c})}}return f;case 16:return{e:q.TVar(a.g),t:b,p:c};default:e=b;if(A.isTexture(e)){switch(d._hx_index){case 0:f=d.a;g=null==
f.t?f.pos:f.pos>>2;f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(E.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2,g=this.mkAdd(g,l,c),f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}f.t=e}else{h=this.varSize(b,a.t);if(4<h)return kb.t("Access not supported for "+A.toString(b),null);switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},
{e:q.TConst(E.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2,g=this.mkAdd(g,l,c),f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}if(4==h){if(-1==a.pos)return{e:q.TCall({e:q.TGlobal(B.Vec4),t:x.TFun([]),p:c},[{e:q.TConst(E.CFloat(0)),t:x.TFloat,p:c}]),t:x.TVec(4,Q.VFloat),p:c}}else{d=[];for(k=0;k<h;)l=k++,d.push(A.SWIZ[l+(a.pos&3)]);f={e:q.TSwiz(f,d),t:b,p:c}}switch(b._hx_index){case 1:f.t=x.TFloat;
f=this.toInt(f);break;case 5:0==b.t._hx_index&&(h=b.size,f.t=x.TVec(h,Q.VFloat),f={e:q.TCall({e:q.TGlobal([B.IVec2,B.IVec3,B.IVec4][h-2]),t:x.TFun([]),p:c},[f]),t:b,p:c})}}return f}},floatBitsToUint:function(a){return{e:q.TCall({e:q.TGlobal(B.FloatBitsToUint),t:x.TFun([]),p:a.p},[a]),t:x.TInt,p:a.p}},toInt:function(a){return a.t==x.TInt?a:{e:q.TCall({e:q.TGlobal(B.ToInt),t:x.TFun([]),p:a.p},[a]),t:x.TInt,p:a.p}},optimize:function(a){var b=a.e;switch(b._hx_index){case 8:var c=b.e;var d=b.args;b=c.e;
if(2==b._hx_index&&53==b.g._hx_index&&1==d.length&&(c=d[0],d=c.e,8==d._hx_index&&(c=d.e,b=c.e,2==b._hx_index&&52==b.g._hx_index))){b=d.args;for(c=d=0;4>c;)c+=this.varSize(b[b.length-1-d].t,Q.VFloat),++d;if(4==c){for(c=0;c<d;)c++,b.pop();c=a.e;if(8==c._hx_index)d=c.e;else throw t.thrown("assert");return{e:q.TCall(d,b),t:a.t,p:a.p}}}break;case 16:if(c=b.e,d=b.index,b=c.e,17==b._hx_index&&(c=d.e,0==c._hx_index&&(d=c.c,2==d._hx_index))){d=d.v;b=b.el;if(0<=d&&d<b.length)return b[d];kb.t("Reading outside array bounds",
a.p)}}return a},packTextures:function(a,b,c){var d,e=[],f={id:A.allocVarId(),name:a,type:c,kind:L.Param},g=0,h=[];for(d=0;d<b.length;){var k=b[d];++d;var l=1;if(!da.enumEq(k.type,c)){var m=k.type;switch(m._hx_index){case 15:l=m.size;if(0==l._hx_index){if(l=l.v,!da.enumEq(m.t,c))continue}else continue;break;case 17:if(10!=c._hx_index||1!=c.dim._hx_index||0!=c.isArray)continue;break;default:continue}}m=new ae(f,null,g,l);m.v=k;if(null!=k.qualifiers)for(var p=0,q=k.qualifiers;p<q.length;){var n=q[p];
++p;if(12==n._hx_index){a=n.name;for(var t=0,w=l;t<w;)n=t++,h[g+n]=a}}this.varMap.set(k,m);e.push(m);g+=l}f.type=x.TArray(c,Za.SConst(g));if(0<h.length){d=0;for(m=g;d<m;)n=d++,null==h[n]&&(h[n]="");null==f.qualifiers&&(f.qualifiers=[]);f.qualifiers.push(ma.Sampler(h.join(",")))}0<e.length&&(this.outVars.push(f),this.allocData.set(f,e));return e},packBuffers:function(a,b,c){var d=[];a={id:A.allocVarId(),name:a,type:x.TVoid,kind:L.Param};for(var e=0;e<b.length;){var f=b[e];++e;var g=f.type;if(16==g._hx_index){var h=
g.size;if(0==h._hx_index){h=h.v;var k=g.t;g=g.kind;if(c==g){var l=Math.ceil(A.size(k)/4);switch(k._hx_index){case 1:case 3:switch(c._hx_index){case 1:case 2:case 4:case 5:k=!0;break;default:k=!1}h=k?f.type:x.TBuffer(x.TVec(4,Q.VFloat),Za.SConst(h*l),g);break;default:h=x.TBuffer(x.TVec(4,Q.VFloat),Za.SConst(h*l),g)}h={id:A.allocVarId(),name:f.name,type:h,kind:L.Param};k=new ae(h,null,d.length,1);k.t=Q.VFloat;k.v=f;d.push(k);this.varMap.set(f,k);this.outVars.push(h)}}}}a.type=x.TArray(x.TBuffer(x.TVoid,
Za.SConst(0),c),Za.SConst(d.length));this.allocData.set(a,d)},pack:function(a,b,c,d){var e=[],f=0;a={id:A.allocVarId(),name:a,type:x.TVec(0,d),kind:b};for(b=0;b<c.length;){var g=c[b];++b;if(!A.isTexture(g.type)&&16!=g.type._hx_index){var h=g.type;if(15!=h._hx_index||!A.isTexture(h.t))if(h=this.varSize(g.type,d),0==h)h=new ae(a,d,-1,h),h.v=g,this.varMap.set(g,h);else{for(var k=null,l=0;l<e.length;){var m=e[l];++l;null==m.v&&m.size>=h&&(null==k||k.size>m.size)&&(k=m)}null!=k?(m=k.size-h,0<m&&(l=e.indexOf(k),
m=new ae(a,d,k.pos+h,m),e.splice(l+1,0,m),k.size=h),k.v=g,this.varMap.set(g,k)):(k=new ae(a,d,f,h),f+=h,k.v=g,this.varMap.set(g,k),e.push(k),g=(4-h%4)%4,0<g&&(h=new ae(a,d,f,g),f+=g,e.push(h)))}}}a.type=x.TArray(x.TVec(4,d),Za.SConst(f>>2));0<f&&(this.outVars.push(a),this.allocData.set(a,e));return a},varSize:function(a,b){switch(a._hx_index){case 1:case 3:if(b==Q.VFloat)return 1;throw t.thrown(A.toString(a)+" size unknown for type "+y.string(b));case 5:var c=a.size;if(b==a.t)return c;throw t.thrown(A.toString(a)+
" size unknown for type "+y.string(b));case 7:if(b==Q.VFloat)return 16;throw t.thrown(A.toString(a)+" size unknown for type "+y.string(b));case 6:case 8:if(b==Q.VFloat)return 12;throw t.thrown(A.toString(a)+" size unknown for type "+y.string(b));case 9:return c=a.size;case 13:a=a.vl;var d=0;for(c=0;c<a.length;){var e=a[c];++c;d+=this.varSize(e.type,b)}return d;case 15:c=a.size;if(0==c._hx_index)return c=c.v,this.varSize(a.t,b)*c;throw t.thrown(A.toString(a)+" size unknown for type "+y.string(b));
default:throw t.thrown(A.toString(a)+" size unknown for type "+y.string(b));}},varSize4Bytes:function(a,b){switch(a._hx_index){case 9:if(4==a.size)return 1;throw t.thrown(A.toString(a)+" 4 bytes size unknown for type"+y.string(b));case 13:a=a.vl;for(var c=0,d=0;d<a.length;){var e=a[d];++d;c+=this.varSize4Bytes(e.type,b)}return c;case 15:return d=a.size,0==d._hx_index?(d=d.v,this.varSize4Bytes(a.t,b)*d):this.varSize(a,b);default:return this.varSize(a,b)}},addTextureFormat:function(a,b,c){null==c&&
(c=0);for(var d=0,e=this.textureFormats;d<e.length;){var f=e[d];++d;if(f.dim==a&&f.arr==b&&f.rw==c)return}this.textureFormats.push({dim:a,arr:b,rw:c})},gatherVar:function(a){var b=a.type;switch(b._hx_index){case 10:var c=b.dim;b=b.isArray;var d=a.type;d=11==d._hx_index?d.channels:0;this.addTextureFormat(c,b,d);break;case 11:c=b.dim;b=b.isArray;d=a.type;d=11==d._hx_index?d.channels:0;this.addTextureFormat(c,b,d);break;case 13:a=b.vl;for(d=0;d<a.length;)c=a[d],++d,this.gatherVar(c);return;case 15:d=
b.t;switch(d._hx_index){case 10:c=d.dim;b=d.isArray;this.addTextureFormat(c,b,0);break;case 11:c=d.dim,b=d.isArray,d=d.channels,this.addTextureFormat(c,b,d)}break;case 17:this.addTextureFormat(Ta.T2D,!1)}switch(a.kind._hx_index){case 0:A.hasQualifier(a,ma.PerObject)?this.params.push(a):this.globals.push(a);break;case 2:this.params.push(a);break;default:this.outVars.push(a)}},__class__:zb};var za=function(){this.channels=[];this.map=new Fa};za.__name__="hxsl.Globals";za.allocID=function(a){null==za.MAP&&
(za.MAP=new Sa,za.ALL=[]);var b=za.MAP.h[a];null==b&&(b=za.ALL.length,za.ALL.push(a),za.MAP.h[a]=b);return b};za.getIDName=function(a){return za.ALL[a]};za.prototype={set:function(a,b){var c=this.map;a=za.allocID(a);c.h[a]=b},get:function(a){var b=this.map;a=za.allocID(a);return b.h[a]},fastSet:function(a,b){this.map.h[a]=b},fastGet:function(a){return this.map.h[a]},resetChannels:function(){this.maxChannels=0},allocChannelID:function(a){for(var b,c=0,d=this.maxChannels;c<d;)if(b=c++,this.channels[b]==
a)return b;if(this.maxChannels==1<<A.MAX_CHANNELS_BITS)throw t.thrown("Too many unique channels");b=this.maxChannels++;this.channels[b]=a;return b},__class__:za};var ka=function(){};ka.__name__="js.Boot";ka.getClass=function(a){if(null==a)return null;if(a instanceof Array)return Array;var b=a.__class__;if(null!=b)return b;a=ka.__nativeClassName(a);return null!=a?ka.__resolveNativeClass(a):null};ka.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==
c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "function":return"<function>";case "object":if(a.__enum__){var d=K[a.__enum__].__constructs__[a._hx_index];c=d._hx_name;if(d.__params__){b+="\t";var e=[],f=0;for(d=d.__params__;f<d.length;){var g=d[f];f+=1;e.push(ka.__string_rec(a[g],b))}return c+"("+e.join(",")+")"}return c}if(a instanceof Array){c="[";b+="\t";e=0;for(f=a.length;e<f;)d=e++,c+=(0<d?",":"")+ka.__string_rec(a[d],b);return c+"]"}try{e=a.toString}catch(h){return"???"}if(null!=
e&&e!=Object.toString&&"function"==typeof e&&(c=a.toString(),"[object Object]"!=c))return c;c="{\n";b+="\t";e=null!=a.hasOwnProperty;f=null;for(f in a)e&&!a.hasOwnProperty(f)||"prototype"==f||"__class__"==f||"__super__"==f||"__interfaces__"==f||"__properties__"==f||(2!=c.length&&(c+=", \n"),c+=b+f+" : "+ka.__string_rec(a[f],b));b=b.substring(1);return c+("\n"+b+"}");case "string":return a;default:return String(a)}};ka.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;
if(null!=c)for(var d=0,e=c.length;d<e;){var f=d++;f=c[f];if(f==b||ka.__interfLoop(f,b))return!0}return ka.__interfLoop(a.__super__,b)};ka.__instanceof=function(a,b){if(null==b)return!1;switch(b){case Array:return a instanceof Array;case gj:return"boolean"==typeof a;case hj:return null!=a;case ij:return"number"==typeof a;case jc:return"number"==typeof a?(a|0)===a:!1;case String:return"string"==typeof a;default:if(null!=a)if("function"==typeof b){if(ka.__downcastCheck(a,b))return!0}else{if("object"==
typeof b&&ka.__isNativeObj(b)&&a instanceof b)return!0}else return!1;return b==jj&&null!=a.__name__||b==kj&&null!=a.__ename__?!0:null!=a.__enum__?K[a.__enum__]==b:!1}};ka.__downcastCheck=function(a,b){return a instanceof b?!0:b.__isInterface__?ka.__interfLoop(ka.getClass(a),b):!1};ka.__cast=function(a,b){if(null==a||ka.__instanceof(a,b))return a;throw t.thrown("Cannot cast "+y.string(a)+" to "+y.string(b));};ka.__nativeClassName=function(a){a=ka.__toStr.call(a).slice(8,-1);return"Object"==a||"Function"==
a||"Math"==a||"JSON"==a?null:a};ka.__isNativeObj=function(a){return null!=ka.__nativeClassName(a)};ka.__resolveNativeClass=function(a){return R[a]};var mc=function(){this.computeLayout=[1,1,1];this.exprIds=this.uniformBuffer=this.outIndex=0;this.varNames=new Fa;this.allNames=new Sa};mc.__name__="hxsl.GlslOut";mc.compile=function(a){var b=new mc;b.glES=1;b.version=100;return b.run(a)};mc.prototype={get_isES:function(){return null!=this.glES},get_isES2:function(){return null!=this.glES?2>=this.glES:
!1},add:function(a){this.buf.b+=y.string(a)},ident:function(a){a=this.varName(a);this.buf.b+=y.string(a)},decl:function(a){for(var b=0,c=this.decls;b<c.length;){var d=c[b];++b;if(d==a)return}35==F.cca(a,0)?this.decls.unshift(a):this.decls.push(a)},getSamplerType:function(a,b){a="sampler"+F.substr(K[a.__enum__].__constructs__[a._hx_index]._hx_name,1,null);b&&(a+="Array");return a},addType:function(a){switch(a._hx_index){case 0:this.buf.b+=y.string("void");break;case 1:this.buf.b+=y.string("int");break;
case 2:this.buf.b+=y.string("bool");break;case 3:this.buf.b+=y.string("float");break;case 4:this.buf.b+=y.string("string");break;case 5:var b=a.size;switch(a.t._hx_index){case 0:this.buf.b+=y.string("i");break;case 2:this.buf.b+=y.string("b")}this.buf.b+=y.string("vec");this.buf.b+=y.string(b);break;case 6:this.buf.b+=y.string("mat3");break;case 7:this.buf.b+=y.string("mat4");break;case 8:this.decl(mc.MAT34);this.buf.b+=y.string("_mat3x4");break;case 9:a=a.size;this.buf.b+=y.string("vec");this.buf.b+=
y.string(a);break;case 10:b=a.dim;a=a.isArray;var c=this.getSamplerType(b,a);this.buf.b+=y.string(c);null==this.glES||!a&&b!=Ta.T3D||this.decl("precision lowp "+c+";");break;case 11:b=a.dim;a=a.isArray;this.buf.b+=y.string("image"+F.substr(K[b.__enum__].__constructs__[b._hx_index]._hx_name,1,null)+(a?"Array":""));break;case 12:this.buf.b+=y.string("mat2");break;case 13:c=a.vl;this.buf.b+=y.string("struct { ");for(a=0;a<c.length;)b=c[a],++a,this.addVar(b),this.buf.b+=y.string(";");this.buf.b+=y.string(" }");
break;case 14:this.buf.b+=y.string("function");break;case 15:c=a.t;b=a.size;this.addType(c);this.buf.b+=y.string("[");switch(b._hx_index){case 0:a=b.v;switch(a){case 0:break;case 1:this.buf.b=this.intelDriverFix?this.buf.b+y.string(2):this.buf.b+y.string(a);break;default:this.buf.b+=y.string(a)}break;case 1:b=b.v,a=this.varName(b),this.buf.b+=y.string(a)}this.buf.b+=y.string("]");break;case 16:throw t.thrown("assert");case 17:a=a.size,this.buf.b+=y.string("channel"+a)}},addVar:function(a){var b=a.type;
switch(b._hx_index){case 15:var c=b.t,d=b.size;b=a.type;a.type=c;this.addVar(a);a.type=b;this.buf.b+=y.string("[");switch(d._hx_index){case 0:a=d.v;switch(a){case 0:break;case 1:this.buf.b=this.intelDriverFix?this.buf.b+y.string(2):this.buf.b+y.string(a);break;default:this.buf.b+=y.string(a)}break;case 1:a=d.v,a=this.varName(a),this.buf.b+=y.string(a)}this.buf.b+=y.string("]");break;case 16:c=b.t;d=b.size;b=b.kind;switch(b._hx_index){case 1:case 4:this.buf.b+=y.string("storage_");break;case 2:case 5:this.buf.b+=
y.string("rw_")}this.buf.b+=y.string((this.isVertex?"vertex_":"")+"uniform_buffer"+this.uniformBuffer++);this.buf.b+=y.string(" { ");a.type=x.TArray(c,d);this.addVar(a);a.type=x.TBuffer(c,d,b);this.buf.b+=y.string("; }");break;default:this.addType(a.type),this.buf.b+=y.string(" "),a=this.varName(a),this.buf.b+=y.string(a)}},addValue:function(a,b){var c=a.e;switch(c._hx_index){case 4:var d=c.el;b="_val"+this.exprIds++;c=this.buf;this.buf=new Lc;this.addType(a.t);this.buf.b+=y.string(" ");this.buf.b+=
y.string(b);this.buf.b+=y.string("(void)");d=d.slice();var e=d[d.length-1];d[d.length-1]={e:q.TReturn(e),t:a.t,p:e.p};a={t:x.TVoid,e:q.TBlock(d),p:a.p};this.addExpr(a,"");this.exprValues.push(this.buf.b);this.buf=c;this.buf.b+=y.string(b);this.buf.b+=y.string("()");break;case 10:a=c.econd;d=c.eif;c=c.eelse;this.buf.b+=y.string("( ");this.addValue(a,b);this.buf.b+=y.string(" ) ? ");this.addValue(d,b);this.buf.b+=y.string(" : ");this.addValue(c,b);break;case 20:this.addValue(c.e,b);break;default:this.addExpr(a,
b)}},addBlock:function(a,b){this.addExpr(a,b)},getFunName:function(a,b,c){switch(a._hx_index){case 20:if(c==x.TInt&&null!=this.glES)return this.decl("int _imod( int x, int y ) { return int(mod(float(x),float(y))); }"),"_imod";break;case 25:this.decl("float invLerp(float v, float a, float b) { return clamp((v - a) / (b - a), 0.0, 1.0); }");break;case 34:c=b[0].t;switch(c._hx_index){case 10:switch(c.dim._hx_index){case 1:if(null!=this.glES&&2>=this.glES)return"texture2D";break;case 3:if(null!=this.glES&&
2>=this.glES)return"textureCube"}break;case 17:if(null!=this.glES&&2>=this.glES)return"texture2D"}break;case 35:c=b[0].t;switch(c._hx_index){case 10:switch(c.dim._hx_index){case 1:if(null!=this.glES&&2>=this.glES)return this.decl("#extension GL_EXT_shader_texture_lod : enable"),"texture2DLodEXT";break;case 3:if(null!=this.glES&&2>=this.glES)return this.decl("#extension GL_EXT_shader_texture_lod : enable"),"textureCubeLodEXT"}break;case 17:if(null!=this.glES&&2>=this.glES)return this.decl("#extension GL_EXT_shader_texture_lod : enable"),
"texture2DLodEXT"}break;case 36:return"texelFetch";case 37:a="";c=b[0].t;switch(c._hx_index){case 10:b=c.dim;a=c.isArray;c=A.getDimSize(b,a);a=a?"Array":"";b="sampler"+F.substr(K[b.__enum__].__constructs__[b._hx_index]._hx_name,1,null)+a;this.decl("vec"+c+" _texture"+a+"Size("+b+" sampler, int lod) { return vec"+c+"(textureSize(sampler, lod)); }");break;case 11:return b=c.dim,a=c.isArray,c=A.getDimSize(b,a),"vec"+c+"(imageSize";case 17:this.decl("vec2 _textureSize(sampler2D sampler, int lod) { return vec2(textureSize(sampler, lod)); }")}return"_texture"+
a+"Size";case 51:if(b[0].t==x.TMat3x4)return this.decl(mc.MAT34),this.decl("mat3 _mat3( _mat3x4 v ) { return mat3(v.a.xyz,v.b.xyz,v.c.xyz); }"),"_mat3";break;case 53:this.decl(mc.MAT34);if(1==b.length)return this.decl("_mat3x4 mat_to_34( mat4 m ) { return _mat3x4(m[0],m[1],m[2]); }"),"mat_to_34";break;case 55:this.decl("vec4 pack( float v ) { vec4 color = fract(v * vec4(1, 255, 255.*255., 255.*255.*255.)); return color - color.yzww * vec4(1. / 255., 1. / 255., 1. / 255., 0.); }");break;case 56:this.decl("float unpack( vec4 color ) { return dot(color,vec4(1., 1. / 255., 1. / (255. * 255.), 1. / (255. * 255. * 255.))); }");
break;case 57:this.decl("vec4 packNormal( vec3 v ) { return vec4((v + vec3(1.)) * vec3(0.5),1.); }");break;case 58:this.decl("vec3 unpackNormal( vec4 v ) { return normalize((v.xyz - vec3(0.5)) * vec3(2.)); }");break;case 59:this.decl("vec2 screenToUv( vec2 v ) { return v * vec2(0.5,-0.5) + vec2(0.5,0.5); }");break;case 60:this.decl("vec2 uvToScreen( vec2 v ) { return v * vec2(2.,-2.) + vec2(-1., 1.); }");break;case 61:case 62:case 63:if(this.isVertex)throw t.thrown("Can't use "+y.string(a)+" in vertex shader");
300>this.version&&this.decl("#extension GL_OES_standard_derivatives:enable");break;case 74:330>this.version&&this.decl("#extension GL_ARB_shader_bit_encoding :enable");this.decl("int _floatBitsToUint( float v) { return int(floatBitsToUint(v)); }");this.decl("ivec2 _floatBitsToUint( vec2 v ) { return ivec2(floatBitsToUint(v)); }");this.decl("ivec3 _floatBitsToUint( vec3 v ) { return ivec3(floatBitsToUint(v)); }");this.decl("ivec4 _floatBitsToUint( vec4 v ) { return ivec4(floatBitsToUint(v)); }");break;
case 73:case 75:330>this.version&&this.decl("#extension GL_ARB_shader_bit_encoding :enable");break;case 76:330>this.version&&this.decl("#extension GL_ARB_shader_bit_encoding :enable"),this.decl("float _uintBitsToFloat( int v ) { return uintBitsToFloat(uint(v)); }"),this.decl("vec2 _uintBitsToFloat( ivec2 v ) { return uintBitsToFloat(uvec2(v)); }"),this.decl("vec3 _uintBitsToFloat( ivec3 v ) { return uintBitsToFloat(uvec3(v)); }"),this.decl("vec4 _uintBitsToFloat( ivec4 v ) { return uintBitsToFloat(uvec4(v)); }")}return mc.GLOBALS[a._hx_index]},
addExpr:function(a,b){var c=a.e;switch(c._hx_index){case 0:b=c.c;switch(b._hx_index){case 0:this.buf.b+=y.string("null");break;case 1:this.buf.b+=y.string(b.b);break;case 2:var d=b.v;this.buf.b+=y.string(d);break;case 3:b=""+b.v;this.buf.b+=y.string(b);-1==b.indexOf(".")&&-1==b.indexOf("e")&&(this.buf.b+=y.string("."));break;case 4:d=b.v,this.buf.b+=y.string('"'+d+'"')}break;case 1:d=c.v;var e=this.varName(d);this.buf.b+=y.string(e);break;case 2:e=c.g;this.buf.b+=y.string(mc.GLOBALS[e._hx_index]);
break;case 3:var f=c.e;this.buf.b+=y.string("(");this.addValue(f,b);this.buf.b+=y.string(")");break;case 4:var g=c.el;this.buf.b+=y.string("{\n");a=b+"\t";for(e=0;e<g.length;)f=g[e],++e,this.buf.b+=y.string(a),this.addExpr(f,a),this.newLine(f);this.buf.b+=y.string(b);this.buf.b+=y.string("}");break;case 5:d=c.op;f=c.e1;c=c.e2;e=f.t;g=c.t;switch(d._hx_index){case 1:if(5==e._hx_index)if(3==e.size)if(1==e.t._hx_index)if(8==g._hx_index){this.decl(mc.MAT34);this.decl("vec3 m3x4mult( vec3 v, _mat3x4 m) { vec4 ve = vec4(v,1.0); return vec3(dot(m.a,ve),dot(m.b,ve),dot(m.c,ve)); }");
if(g=20==d._hx_index?!0:!1)this.addValue(f,b),this.buf.b+=y.string(" = ");this.buf.b+=y.string("m3x4mult(");this.addValue(f,b);this.buf.b+=y.string(",");this.addValue(c,b);this.buf.b+=y.string(")")}else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),
d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);break;case 5:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=y.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw t.thrown("assert");
}this.buf.b+=y.string(d);this.buf.b+=y.string("(");this.addValue(f,b);this.buf.b+=y.string(",");this.addValue(c,b);this.buf.b+=y.string("))")}else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);break;case 6:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=y.string("vec"+e+"(");
switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw t.thrown("assert");}this.buf.b+=y.string(d);this.buf.b+=y.string("(");this.addValue(f,b);this.buf.b+=y.string(",");this.addValue(c,b);this.buf.b+=y.string("))")}else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,
b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);break;case 7:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=y.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw t.thrown("assert");}this.buf.b+=y.string(d);this.buf.b+=y.string("(");this.addValue(f,b);this.buf.b+=
y.string(",");this.addValue(c,b);this.buf.b+=y.string("))")}else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);break;case 8:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=y.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";
break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw t.thrown("assert");}this.buf.b+=y.string(d);this.buf.b+=y.string("(");this.addValue(f,b);this.buf.b+=y.string(",");this.addValue(c,b);this.buf.b+=y.string("))")}else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=
y.string(" "),this.addValue(c,b);break;case 9:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=y.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw t.thrown("assert");}this.buf.b+=y.string(d);this.buf.b+=y.string("(");this.addValue(f,b);this.buf.b+=y.string(",");this.addValue(c,b);this.buf.b+=y.string("))")}else this.addValue(f,
b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);break;case 10:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=y.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d=
"lessThanEqual";break;default:throw t.thrown("assert");}this.buf.b+=y.string(d);this.buf.b+=y.string("(");this.addValue(f,b);this.buf.b+=y.string(",");this.addValue(c,b);this.buf.b+=y.string("))")}else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);break;case 18:this.decl("int _ushr( int i, int j ) { return int(uint(i) >> uint(j)); }");
this.buf.b+=y.string("_ushr(");this.addValue(f,b);this.buf.b+=y.string(",");this.addValue(c,b);this.buf.b+=y.string(")");break;case 19:if(a.t!=x.TInt){if(g=20==d._hx_index?!0:!1)this.addValue(f,b),this.buf.b+=y.string(" = ");this.addExpr({e:q.TCall({e:q.TGlobal(B.Mod),t:x.TFun([]),p:a.p},[f,c]),t:a.t,p:a.p},b)}else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);break;case 20:switch(d.op._hx_index){case 1:if(5==e._hx_index)if(3==
e.size)if(1==e.t._hx_index)if(8==g._hx_index){this.decl(mc.MAT34);this.decl("vec3 m3x4mult( vec3 v, _mat3x4 m) { vec4 ve = vec4(v,1.0); return vec3(dot(m.a,ve),dot(m.b,ve),dot(m.c,ve)); }");if(g=20==d._hx_index?!0:!1)this.addValue(f,b),this.buf.b+=y.string(" = ");this.buf.b+=y.string("m3x4mult(");this.addValue(f,b);this.buf.b+=y.string(",");this.addValue(c,b);this.buf.b+=y.string(")")}else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),
this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);break;case 19:if(a.t!=x.TInt){if(g=20==d._hx_index?!0:!1)this.addValue(f,b),this.buf.b+=
y.string(" = ");this.addExpr({e:q.TCall({e:q.TGlobal(B.Mod),t:x.TFun([]),p:a.p},[f,c]),t:a.t,p:a.p},b)}else this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b);break;default:this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),this.addValue(c,b)}break;default:this.addValue(f,b),this.buf.b+=y.string(" "),d=ra.opStr(d),this.buf.b+=y.string(d),this.buf.b+=y.string(" "),
this.addValue(c,b)}break;case 6:d=c.op;f=c.e1;switch(d._hx_index){case 0:d="++";break;case 1:d="--";break;case 2:d="!";break;case 3:d="-";break;case 4:d="~";break;default:throw t.thrown("assert");}this.buf.b+=y.string(d);this.addValue(f,b);break;case 7:d=c.v;f=c.init;this.locals.h[d.id]=d;null!=f?(e=this.varName(d),this.buf.b+=y.string(e),this.buf.b+=y.string(" = "),this.addValue(f,b)):this.buf.b+=y.string("/*var*/");break;case 8:e=c.e;g=c.args;c=e.e;if(2==c._hx_index)switch(f=c.g,f._hx_index){case 36:d=
this.getFunName(f,g,a.t);this.buf.b+=y.string(d);this.buf.b+=y.string("(");this.addValue(g[0],b);this.buf.b+=y.string(", ");this.addValue(g[1],b);2!=g.length?(this.buf.b+=y.string(", "),this.addValue(g[2],b),this.buf.b+=y.string(")")):this.buf.b+=y.string(", 0)");break;case 37:d=this.getFunName(f,g,a.t);this.buf.b+=y.string(d);this.buf.b+=y.string("(");this.addValue(g[0],b);1!=g.length?(this.buf.b+=y.string(", "),this.addValue(g[1],b),this.buf.b+=y.string(")")):(c=g[0].t,g=11==c._hx_index?!0:!1,this.buf.b=
g?this.buf.b+y.string("))"):this.buf.b+y.string(", 0)"));break;case 54:if(1==g.length)f=g[0],this.buf.b+=y.string("clamp("),this.addValue(f,b),this.buf.b+=y.string(", 0., 1.)");else{d=e;c=d.e;2==c._hx_index?(e=c.g,e=this.getFunName(e,g,a.t),this.buf.b+=y.string(e)):this.addValue(d,b);this.buf.b+=y.string("(");d=!0;for(c=0;c<g.length;)f=g[c],++c,d?d=!1:this.buf.b+=y.string(", "),this.addValue(f,b);this.buf.b+=y.string(")")}break;case 78:break;case 79:if(3==g.length){e=g[0];f=g[1];a=g[2];c=e.t;if(11==
c._hx_index)g=c.channels;else throw t.thrown("assert");this.buf.b+=y.string("imageStore(");this.addValue(e,b);this.buf.b+=y.string(",");this.addValue(f,b);this.buf.b+=y.string(",");4!=g&&(this.buf.b+=y.string("("));this.addValue(a,b);4!=g&&(this.buf.b+=y.string(")"+(1==g?".xx":".xyyy")))}else for(d=e,c=d.e,2==c._hx_index?(e=c.g,e=this.getFunName(e,g,a.t),this.buf.b+=y.string(e)):this.addValue(d,b),this.buf.b+=y.string("("),d=!0,c=0;c<g.length;)f=g[c],++c,d?d=!1:this.buf.b+=y.string(", "),this.addValue(f,
b);this.buf.b+=y.string(")");break;case 84:this.buf.b+=y.string("atomicAdd(");this.addValue(g[0],b);this.buf.b+=y.string("[");this.addValue(g[1],b);this.buf.b+=y.string("],");this.addValue(g[2],b);this.buf.b+=y.string(")");break;default:d=e;c=d.e;2==c._hx_index?(e=c.g,e=this.getFunName(e,g,a.t),this.buf.b+=y.string(e)):this.addValue(d,b);this.buf.b+=y.string("(");d=!0;for(c=0;c<g.length;)f=g[c],++c,d?d=!1:this.buf.b+=y.string(", "),this.addValue(f,b);this.buf.b+=y.string(")")}else{d=e;e=d.e;2==e._hx_index?
(e=e.g,e=this.getFunName(e,g,a.t),this.buf.b+=y.string(e)):this.addValue(d,b);this.buf.b+=y.string("(");d=!0;for(e=0;e<g.length;)f=g[e],++e,d?d=!1:this.buf.b+=y.string(", "),this.addValue(f,b);this.buf.b+=y.string(")")}break;case 9:f=c.e;d=c.regs;if(3==f.t._hx_index){for(e=0;e<d.length;)if(a=d[e],++e,a!=fa.X)throw t.thrown("assert");switch(d.length){case 1:this.addValue(f,b);break;case 2:this.decl("vec2 _vec2( float v ) { return vec2(v,v); }");this.buf.b+=y.string("_vec2(");this.addValue(f,b);this.buf.b+=
y.string(")");break;case 3:this.decl("vec3 _vec3( float v ) { return vec3(v,v,v); }");this.buf.b+=y.string("_vec3(");this.addValue(f,b);this.buf.b+=y.string(")");break;case 4:this.decl("vec4 _vec4( float v ) { return vec4(v,v,v,v); }");this.buf.b+=y.string("_vec4(");this.addValue(f,b);this.buf.b+=y.string(")");break;default:throw t.thrown("assert");}}else for(this.addValue(f,b),this.buf.b+=y.string("."),e=0;e<d.length;){a=d[e];++e;b=this.buf;f=b.b;switch(a._hx_index){case 0:g="x";break;case 1:g="y";
break;case 2:g="z";break;case 3:g="w"}b.b=f+y.string(g)}break;case 10:e=c.econd;f=c.eif;a=c.eelse;this.buf.b+=y.string("if( ");this.addValue(e,b);this.buf.b+=y.string(") ");this.addExpr(f,b);null!=a&&(this.isBlock(f)||(this.buf.b+=y.string(";")),this.buf.b+=y.string(" else "),this.addExpr(a,b));break;case 11:this.buf.b+=y.string("discard");break;case 12:f=c.e;null==f?this.buf.b+=y.string("return"):(this.buf.b+=y.string("return "),this.addValue(f,b));break;case 13:d=c.v;e=c.it;g=c.loop;this.locals.h[d.id]=
d;e=e.e;if(5==e._hx_index)if(21==e.op._hx_index)f=e.e1,c=e.e2,this.buf.b+=y.string("for("),this.buf.b+=y.string(d.name+"="),this.addValue(f,b),this.buf.b+=y.string(";"+d.name+"<"),this.addValue(c,b),this.buf.b+=y.string(";"+d.name+"++) "),this.addBlock(g,b);else throw t.thrown("assert");else throw t.thrown("assert");break;case 14:this.buf.b+=y.string("continue");break;case 15:this.buf.b+=y.string("break");break;case 16:f=c.e;a=c.index;this.addValue(f,b);this.buf.b+=y.string("[");this.addValue(a,b);
this.buf.b+=y.string("]");break;case 17:g=c.el;e=a.t;if(15==e._hx_index)this.addType(e.t);else throw t.thrown("assert");this.buf.b+=y.string("["+g.length+"]");this.buf.b+=y.string("(");d=!0;for(e=0;e<g.length;)a=g[e],++e,d?d=!1:this.buf.b+=y.string(", "),this.addValue(a,b);this.buf.b+=y.string(")");break;case 18:this.buf.b+=y.string("switch(...)");break;case 19:e=c.e;g=c.loop;0==c.normalWhile?(a=e,b+="\t",this.buf.b+=y.string("do "),this.addBlock(g,b),this.buf.b+=y.string(" while( "),this.addValue(a,
b),this.buf.b+=y.string(" )")):(a=e,this.buf.b+=y.string("while( "),this.addValue(a,b),this.buf.b+=y.string(" ) "),this.addBlock(g,b));break;case 20:a=c.e;this.addExpr(a,b);break;case 21:e=c.name;this.addExpr(c.e,b);this.buf.b+=y.string(".");this.buf.b+=y.string(e);break;case 22:switch(e=c.code,g=c.args,c.target){case "code":case "glsl":a=0;for(f=new oe("{(\\d+)}","g");f.matchSub(e,a);)d=f.matchedPos(),this.buf.b+=y.string(e.substring(a,d.pos)),a=y.parseInt(f.matched(1)),a<g.length&&this.addValue(g[a].e,
b),a=d.pos+d.len;this.buf.b+=y.string(F.substr(e,a,null))}}},varName:function(a){if(a.kind==L.Output){if(this.isVertex)return"gl_Position";if(null!=this.glES&&2>=this.glES)return null==this.outIndexes?"gl_FragColor":"gl_FragData["+this.outIndexes.h[a.id]+"]"}var b=this.varNames.h[a.id];if(null!=b)return b;b=a.name;a.kind==L.Var&&(b+="_varying");Object.prototype.hasOwnProperty.call(mc.KWDS.h,b)&&(b="_"+b);if(Object.prototype.hasOwnProperty.call(this.allNames.h,b)){var c=2;for(b+="_";Object.prototype.hasOwnProperty.call(this.allNames.h,
b+c);)++c;b+=c}this.varNames.h[a.id]=b;this.allNames.h[b]=a.id;return b},newLine:function(a){this.isBlock(a)?this.buf.b+=y.string("\n"):this.buf.b+=y.string(";\n")},isBlock:function(a){a=a.e;switch(a._hx_index){case 4:return!0;case 13:return a=a.loop,this.isBlock(a);case 19:return 1==a.normalWhile?(a=a.loop,this.isBlock(a)):!1;default:return!1}},initVar:function(a){switch(a.kind._hx_index){case 0:case 2:var b=a.type;switch(b._hx_index){case 15:var c=b.t;11==c._hx_index?(c=F.substr("rgba",0,c.channels),
this.buf.b+=y.string("layout("+c+"32f) uniform ")):this.buf.b+=y.string("uniform ");break;case 16:c=b.kind;switch(c._hx_index){case 1:case 4:if(430>this.version)throw t.thrown("SSBO are available since version 4.3");this.buf.b+=y.string("layout(std430) readonly buffer ");break;case 2:case 5:if(430>this.version)throw t.thrown("SSBO are available since version 4.3");this.buf.b+=y.string("layout(std430) buffer ");break;default:switch(this.buf.b+=y.string("layout(std140) "),c._hx_index){case 0:case 3:this.buf.b+=
y.string("uniform ");break;default:throw t.thrown("assert");}}break;default:this.buf.b+=y.string("uniform ")}break;case 1:this.buf.b+=y.string(null!=this.glES&&2>=this.glES?"attribute ":"in ");break;case 3:A.hasQualifier(a,ma.Flat)&&(this.buf.b+=y.string("flat "));this.buf.b+=y.string(null!=this.glES&&2>=this.glES?"varying ":this.isVertex?"out ":"in ");break;case 5:if(null!=this.glES&&2>=this.glES){this.outIndexes.h[a.id]=this.outIndex++;return}if(this.isVertex)return;null!=this.glES&&(this.buf.b+=
y.string("layout(location="+this.outIndex++ +") "));this.buf.b+=y.string("out ");break;case 6:return}if(null!=a.qualifiers)for(b=0,c=a.qualifiers;b<c.length;){var d=c[b];++b;if(6==d._hx_index)switch(d.p._hx_index){case 0:this.buf.b+=y.string("lowp ");break;case 1:this.buf.b+=y.string("mediump ");break;case 2:this.buf.b+=y.string("highp ")}}this.addVar(a);this.buf.b+=y.string(";\n")},initVars:function(a){this.uniformBuffer=this.outIndex=0;this.outIndexes=new Fa;var b=0;for(a=a.vars;b<a.length;){var c=
a[b];++b;this.initVar(c)}this.buf.b+=y.string("\n");2>this.outIndex?this.outIndexes=null:!this.isVertex&&null!=this.glES&&2>=this.glES&&this.decl("#extension GL_EXT_draw_buffers : enable")},collectGlobals:function(a,b){var c=b.e;switch(c._hx_index){case 2:a.set(c.g,!0);break;case 8:var d=c.e;var e=c.args;c=d.e;var f=d.p;f=d.t;if(2==c._hx_index)if(78==c.g._hx_index)switch(e.length){case 1:c=e[0];d=c.e;f=c.p;f=c.t;if(0==d._hx_index)if(c=d.c,2==c._hx_index){var g=c.v;this.computeLayout=[g,1,1]}else c=
this,A.iter(b,function(b){c.collectGlobals(a,b)});else d=this,A.iter(b,function(b){d.collectGlobals(a,b)});break;case 2:f=e[0];var h=e[1];var k=f.e;var l=f.p;l=f.t;0==k._hx_index?(f=k.c,2==f._hx_index?(k=h.e,l=h.p,l=h.t,0==k._hx_index?(h=k.c,2==h._hx_index?(b=h.v,g=f.v,this.computeLayout=[g,b,1]):(f=this,A.iter(b,function(b){f.collectGlobals(a,b)}))):(h=this,A.iter(b,function(b){h.collectGlobals(a,b)}))):(k=this,A.iter(b,function(b){k.collectGlobals(a,b)}))):(l=this,A.iter(b,function(b){l.collectGlobals(a,
b)}));break;case 3:var m=e[0];var p=e[1];var q=e[2];e=m.e;var n=m.p;n=m.t;if(0==e._hx_index)if(m=e.c,2==m._hx_index)if(e=p.e,n=p.p,n=p.t,0==e._hx_index)if(p=e.c,2==p._hx_index)if(e=q.e,n=q.p,n=q.t,0==e._hx_index)if(q=e.c,2==q._hx_index){var t=q.v;g=m.v;b=p.v;this.computeLayout=[g,b,t]}else e=this,A.iter(b,function(b){e.collectGlobals(a,b)});else m=this,A.iter(b,function(b){m.collectGlobals(a,b)});else p=this,A.iter(b,function(b){p.collectGlobals(a,b)});else q=this,A.iter(b,function(b){q.collectGlobals(a,
b)});else n=this,A.iter(b,function(b){n.collectGlobals(a,b)});else{var w=this;A.iter(b,function(b){w.collectGlobals(a,b)})}break;default:var v=this;A.iter(b,function(b){v.collectGlobals(a,b)})}else{var x=this;A.iter(b,function(b){x.collectGlobals(a,b)})}else{var y=this;A.iter(b,function(b){y.collectGlobals(a,b)})}break;default:var z=this;A.iter(b,function(b){z.collectGlobals(a,b)})}},run:function(a){var b=new $e;var c=0;for(var d=a.funs;c<d.length;){var e=d[c];++c;this.collectGlobals(b,e.expr)}this.locals=
new Fa;this.decls=[];this.buf=new Lc;this.exprValues=[];if(1!=a.funs.length)throw t.thrown("assert");e=a.funs[0];this.isVertex=e.kind==Ca.Vertex;(this.isCompute=e.kind==Ca.Main)||(this.isVertex?this.decl("precision highp float;"):this.decl("precision mediump float;"));this.initVars(a);this.isCompute&&this.decl("layout(local_size_x = "+this.computeLayout[0]+", local_size_y = "+this.computeLayout[1]+", local_size_z = "+this.computeLayout[2]+") in;");d=this.buf;this.buf=new Lc;this.buf.b+=y.string("void main(void) {\n");
c=e.expr.e;if(4==c._hx_index)for(a=c.el,c=0;c<a.length;)e=a[c],++c,this.buf.b+=y.string("\t"),this.addExpr(e,"\t"),this.newLine(e);else this.addExpr(e.expr,"");this.isVertex&&(this.buf.b+=y.string("\tgl_Position.z += gl_Position.z - gl_Position.w;\n"));this.buf.b+=y.string("}");this.exprValues.push(this.buf.b);this.buf=d;e=Te.array(this.locals);e.sort(function(a,b){return sa.compare(a.name,b.name)});for(c=0;c<e.length;)d=e[c],++c,this.addVar(d),this.buf.b+=y.string(";\n");this.buf.b+=y.string("\n");
c=0;for(d=this.exprValues;c<d.length;)e=d[c],++c,this.buf.b+=y.string(e),this.buf.b+=y.string("\n\n");null!=this.glES?this.decl("#version "+(100>this.version?100:this.version)+(150<this.version?" es":"")):this.isCompute||430<=this.version?this.decl("#version 430"):null!=this.version?this.decl("#version "+(150<this.version?150:this.version)):this.decl("#version 130");this.decls.push(this.buf.b);this.buf=null;return this.decls.join("\n")},__class__:mc};var Ti=function(){};Ti.__name__="hxsl._Linker.AllocatedVar";
Ti.prototype={__class__:Ti};var Jf=function(a,b){this.name=a;this.uid=Jf.UID++;this.vertex=b;this.processed=new Fa;this.usedFunctions=[];this.readMap=new Fa;this.readVars=[];this.writeMap=new Fa;this.writeVars=[]};Jf.__name__="hxsl._Linker.ShaderInfos";Jf.prototype={__class__:Jf};var Li=function(a){this.debugDepth=0;this.mode=a};Li.__name__="hxsl.Linker";Li.prototype={error:function(a,b){return kb.t(a,b)},mergeVar:function(a,b,c,d,e){switch(b.kind._hx_index){case 2:if(null==e||!A.hasBorrowQualifier(c,
e))throw t.thrown("assert");break;case 6:throw t.thrown("assert");}b.kind!=c.kind&&b.kind!=L.Local&&c.kind!=L.Local&&this.error("'"+a+"' kind does not match : "+y.string(b.kind)+" should be "+y.string(c.kind),d);var f=b.type;var g=c.type;if(13==f._hx_index)if(13==g._hx_index)for(b=g.vl,c=f.vl,f=0;f<c.length;){var h=c[f];++f;var k=null;for(g=0;g<b.length;){var l=b[g];++g;if(h.name==l.name){k=l;break}}null==k?b.push(this.allocVar(h,d,e).v):this.mergeVar(a+"."+k.name,h,k,d,e)}else da.enumEq(b.type,c.type)||
this.error("'"+a+"' type does not match : "+A.toString(b.type)+" should be "+A.toString(c.type),d);else da.enumEq(b.type,c.type)||this.error("'"+a+"' type does not match : "+A.toString(b.type)+" should be "+A.toString(c.type),d)},allocVar:function(a,b,c,d,e){var f;if(null!=a.parent&&null==e){e=this.allocVar(a.parent,b,c);var g=e.v;d=g.name;for(g=g.parent;null!=g;)d=g.name+"."+d,g=g.parent}d=null==d?a.name:d+"."+a.name;if(null!=a.qualifiers){var h=0;for(f=a.qualifiers;h<f.length;)g=f[h],++h,4==g._hx_index&&
(d=g.n)}var k=d.toLowerCase();g=this.varMap.h[k];var l=a.name;if(null!=g){h=0;for(f=g.merged;h<f.length;){var m=f[h];++h;if(m==a)return g}f=A.hasBorrowQualifier(g.v,c);(a.kind!=L.Param||f||A.hasQualifier(a,ma.Shared)||this.isBatchShader)&&a.kind!=L.Function&&(a.kind!=L.Var&&a.kind!=L.Local||!A.hasQualifier(a,ma.Private))?(h=g.v,f=A.hasBorrowQualifier(a,g.rootShaderName),f=h.kind==L.Param&&!f&&!A.hasQualifier(h,ma.Shared)&&!this.isBatchShader||h.kind==L.Function||(h.kind==L.Var||h.kind==L.Local)&&
A.hasQualifier(h,ma.Private)):f=!0;if(f||a.kind==L.Param&&g.v.kind==L.Param){for(var p=2;;){var q=this.varMap.h[k+p];if(null==q)break;h=0;for(f=q.merged;h<f.length;)if(m=f[h],++h,m==a)return q;++p}a.kind==L.Input?(f=this.varMap,Object.prototype.hasOwnProperty.call(f.h,k)&&delete f.h[k],this.varMap.h[k+p]=g,g.v.name+=p,g.path+=p):(l+=p,d+=p,k+=p)}else return g.merged.push(a),this.mergeVar(d,a,g.v,b,g.rootShaderName),this.varIdMap.h[a.id]=g.id,g}g={id:A.allocVarId(),name:l,type:a.type,kind:a.kind,qualifiers:a.qualifiers,
parent:null==e?null:e.v};q=new Ti;q.v=g;q.merged=[a];q.path=d;q.id=g.id;q.parent=e;q.instanceIndex=this.curInstance;q.rootShaderName=c;this.allVars.push(q);this.varMap.h[k]=q;h=g.type;if(13==h._hx_index){e=h.vl;h=[];for(f=0;f<e.length;)a=e[f],++f,h.push(this.allocVar(a,b,c,d,q).v);g.type=x.TStruct(h)}return q},mapExprVar:function(a){var b=a.e;switch(b._hx_index){case 1:var c=b.v;if(!this.locals.h.hasOwnProperty(c.id)){var d=this.allocVar(c,a.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(gb.TRACE){var e=
this.curShader.name+" read "+d.path;c=0;for(b=this.debugDepth;c<b;)c++,e="    "+e;$a.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.readMap.h.hasOwnProperty(d.id)||(this.curShader.readMap.h[d.id]=d,this.curShader.readVars.push(d));if(null==this.curShader.vertex&&d.v.kind==L.Var){if(gb.TRACE){e="Force "+this.curShader.name+" into fragment (use varying)";c=0;for(b=this.debugDepth;c<b;)c++,e="    "+e;$a.trace(e,{fileName:"hxsl/Debug.hx",
lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.vertex=!1}}return{e:q.TVar(d.v),t:d.v.type,p:a.p}}break;case 5:var f=b.op;var g=b.e1;var h=b.e2;c=g.e;switch(f._hx_index){case 4:switch(c._hx_index){case 1:c=b=c.v;if(this.locals.h.hasOwnProperty(c.id)){if(c=b,!this.locals.h.hasOwnProperty(c.id)){g=this.mapExprVar(g);h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(gb.TRACE){e=this.curShader.name+" write "+
d.path;b=0;for(c=this.debugDepth;b<c;)b++,e="    "+e;$a.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,g,h),t:a.t,p:a.p}}}else{h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(gb.TRACE){e=this.curShader.name+" write "+d.path;c=0;for(g=this.debugDepth;c<g;)c++,e="    "+e;$a.trace(e,{fileName:"hxsl/Debug.hx",
lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,{e:q.TVar(d.v),t:d.v.type,p:a.p},h),t:a.t,p:a.p}}break;case 9:if(b=c.e,c=b.e,1==c._hx_index&&(c=c.v,!this.locals.h.hasOwnProperty(c.id))){g=this.mapExprVar(g);h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(gb.TRACE){e=this.curShader.name+" write "+d.path;b=0;for(c=this.debugDepth;b<
c;)b++,e="    "+e;$a.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,g,h),t:a.t,p:a.p}}}break;case 20:switch(c._hx_index){case 1:c=c.v;if(!this.locals.h.hasOwnProperty(c.id)){g=this.mapExprVar(g);h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(gb.TRACE){e=this.curShader.name+" write "+d.path;
b=0;for(c=this.debugDepth;b<c;)b++,e="    "+e;$a.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,g,h),t:a.t,p:a.p}}break;case 9:if(b=c.e,c=b.e,1==c._hx_index&&(c=c.v,!this.locals.h.hasOwnProperty(c.id))){g=this.mapExprVar(g);h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(gb.TRACE){e=this.curShader.name+
" write "+d.path;c=0;for(b=this.debugDepth;c<b;)c++,e="    "+e;$a.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,g,h),t:a.t,p:a.p}}}}break;case 7:c=b.v;this.locals.h[c.id]=!0;break;case 11:null!=this.curShader&&(this.curShader.vertex=!1,this.curShader.hasDiscard=!0);break;case 13:c=b.v;this.locals.h[c.id]=!0;break;case 22:f=b.target;c=b.code;e=b.args;d=[];for(b=
0;b<e.length;){var k=e[b];++b;switch(k.access._hx_index){case 0:g=this.mapExprVar(k.e);break;case 1:h=null!=this.curShader?this.mapSyntaxWrite(k.e):k.e;g=this.mapExprVar(h);break;case 2:h=this.mapExprVar(k.e),null!=this.curShader&&(h=this.mapSyntaxWrite(h)),g=h}d.push({e:g,access:k.access})}null!=this.curShader&&(this.curShader.hasSyntax=!0);return{e:q.TSyntax(f,c,d),t:a.t,p:a.p}}return A.map(a,M(this,this.mapExprVar))},mapSyntaxWrite:function(a){var b=a.e;if(1==b._hx_index){var c=this.allocVar(b.v,
a.p);if(!this.curShader.writeMap.h.hasOwnProperty(c.id)){if(gb.TRACE){var d=this.curShader.name+" syntax write "+c.path;b=0;for(var e=this.debugDepth;b<e;)b++,d="    "+d;$a.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapSyntaxWrite"})}this.curShader.writeMap.h[c.id]=c;this.curShader.writeVars.push(c)}return{e:q.TVar(c.v),t:c.v.type,p:a.p}}return A.map(a,M(this,this.mapSyntaxWrite))},addShader:function(a,b,c,d){this.curShader=b=new Jf(a,b);b.priority=d;b.body=
this.mapExprVar(c);this.shaders.push(b);this.curShader=null;if(gb.TRACE){a="Adding shader "+a+" with priority "+d;c=0;for(d=this.debugDepth;c<d;)c++,a="    "+a;$a.trace(a,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"addShader"})}return b},sortByPriorityDesc:function(a,b){return a.priority==b.priority?a.uid-b.uid:b.priority-a.priority},buildDependency:function(a,b,c){c=!c;for(var d=0,e=this.shaders;d<e.length;){var f=e[d];++d;if(f==a)c=!0;else if(c&&f.writeMap.h.hasOwnProperty(b.id)){if(a.vertex){if(0==
f.vertex)continue;null==f.vertex&&(f.vertex=!0)}if(gb.TRACE){for(var g=a.name+" => "+f.name+" ("+b.path+")",h=0,k=this.debugDepth;h<k;)h++,g="    "+g;$a.trace(g,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"buildDependency"})}a.deps.set(f,!0);this.debugDepth++;this.initDependencies(f);this.debugDepth--;if(!f.readMap.h.hasOwnProperty(b.id))return}}b.v.kind==L.Var&&this.error("Variable "+b.path+" required by "+a.name+" is missing initializer",null)},initDependencies:function(a){if(null==
a.deps){a.deps=new Cc;for(var b=0,c=a.readVars;b<c.length;){var d=c[b];++b;this.buildDependency(a,d,a.writeMap.h.hasOwnProperty(d.id))}}},collect:function(a,b,c){var d;a.onStack&&this.error("Loop in shader dependencies ("+a.name+")",null);if(a.marked!=c){a.marked=c;a.onStack=!0;var e=[];for(d=a.deps.keys();d.hasNext();){var f=d.next();e.push(f)}f=e;f.sort(M(this,this.sortByPriorityDesc));for(e=0;e<f.length;)d=f[e],++e,this.collect(d,b,c);if(null==a.vertex){if(gb.TRACE){f="MARK "+a.name+" "+(c?"vertex":
"fragment");e=0;for(d=this.debugDepth;e<d;)e++,f="    "+f;$a.trace(f,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"collect"})}a.vertex=c}if(a.vertex==c){if(gb.TRACE){f="COLLECT "+a.name+" "+(c?"vertex":"fragment");e=0;for(d=this.debugDepth;e<d;)e++,f="    "+f;$a.trace(f,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"collect"})}b.push(a)}a.onStack=!1}},link:function(a){var b,c;if(gb.TRACE){var d="---------------------- LINKING -----------------------";
var e=0;for(c=this.debugDepth;e<c;){var f=e++;d="    "+d}$a.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"link"})}this.varMap=new Sa;this.varIdMap=new Fa;this.allVars=[];this.shaders=[];this.locals=new Fa;var g=[];e=[];c=0;for(b=a;c<b.length;){var h=b[c];f=c++;if(a.indexOf(h)<f){var k=tg.shaderData(h);g.push({origin:h,cloned:k});e.push(k)}else e.push(h)}a=e;this.curInstance=0;var l=[];for(e=0;e<a.length;){h=a[e];++e;this.isBatchShader=this.mode==Fb.Batch&&X.startsWith(h.name,
"batchShader_");c=0;for(b=h.vars;c<b.length;){d=b[c];++c;var m=this.allocVar(d,null,h.name);this.isBatchShader&&m.v.kind==L.Param&&!X.startsWith(m.path,"Batch_")&&(m.v.kind=L.Local,null==m.v.qualifiers&&(m.v.qualifiers=[]),m.v.qualifiers.push(ma.Flat));d.kind==L.Output&&l.push(d)}m=0;for(k=h.funs;m<k.length;){f=k[m];++m;var p=this.allocVar(f.ref,f.expr.p);p.kind=f.kind}this.curInstance++}p=0;var r=[-3E3],n=[-2E3],u=[-1E3],w=[-2500];for(e=0;e<a.length;){h=a[e];++e;c=0;for(b=h.funs;c<b.length;){f=b[c];
++c;d=this.allocVar(f.ref,f.expr.p);if(null==d.kind)throw t.thrown("assert");switch(d.kind._hx_index){case 0:case 1:if(this.mode==Fb.Compute)throw g=d.kind,t.thrown("Unexpected "+K[g.__enum__].__constructs__[g._hx_index]._hx_name.toLowerCase()+"() function in compute shader");this.addShader(h.name+"."+(d.kind==Ca.Vertex?"vertex":"fragment"),d.kind==Ca.Vertex,f.expr,p+(d.kind==Ca.Vertex?-1500:-500));break;case 2:switch(f.ref.name){case "__init__fragment":d=u;var v=!1;break;case "__init__main":d=w;
v=!1;break;case "__init__vertex":d=n;v=!0;break;default:d=r,v=null}m=f.expr.e;if(4==m._hx_index){m=m.el;var y=0;for(k=0;k<m.length;){var z=m[k];++k;this.addShader(h.name+"."+f.ref.name+y++,v,z,d[0]++)}}else this.addShader(h.name+"."+f.ref.name,v,f.expr,d[0]++);break;case 3:throw t.thrown("Unexpected helper function in linker "+d.v.name);case 4:if(this.mode!=Fb.Compute)throw t.thrown("Unexpected main() outside compute shader");this.addShader(h.name,!0,f.expr,p).isCompute=!0}}++p}this.shaders.sort(M(this,
this.sortByPriorityDesc));e=b=0;for(c=this.shaders;e<c.length;)h=c[e],++e,h.uid=b++;a=new Jf("<entry>",!1);a.deps=new Cc;for(e=0;e<l.length;)d=l[e],++e,this.buildDependency(a,this.allocVar(d,null),!1);e=0;for(c=this.shaders;e<c.length;)if(h=c[e],++e,h.hasDiscard||h.isCompute||h.hasSyntax)this.initDependencies(h),a.deps.set(h,!0);e=0;for(c=this.shaders;e<c.length;)if(h=c[e],++e,null==h.vertex){k=!0;b=0;for(m=h.readVars;b<m.length;)if(f=m[b],++b,f.v.kind!=L.Param){k=!1;break}if(k){if(gb.TRACE){d="Force "+
h.name+" into fragment since it only reads params";k=0;for(b=this.debugDepth;k<b;)f=k++,d="    "+d;$a.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"link"})}h.vertex=!1}}e=0;for(c=this.shaders;e<c.length;)if(h=c[e],++e,null!=h.deps){if(null==h.vertex)for(k=h.deps.keys();k.hasNext();)if(b=k.next(),0==b.vertex){if(gb.TRACE){d=h.name+" marked as fragment because of "+b.name;b=0;for(m=this.debugDepth;b<m;)f=b++,d="    "+d;$a.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,
className:"hxsl.Linker",methodName:"link"})}h.vertex=!1;break}if(h.vertex)for(f=h.deps.keys();f.hasNext();)if(m=f.next(),null==m.vertex){if(gb.TRACE){d=m.name+" marked as vertex because of "+h.name;k=0;for(b=this.debugDepth;k<b;)k++,d="    "+d;$a.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"link"})}m.vertex=!0}}d=[];f=[];this.collect(a,d,!0);this.collect(a,f,!1);if(f.pop()!=a)throw t.thrown("assert");e=0;for(c=this.shaders;e<c.length;)h=c[e],++e,h.marked=null;
e=0;for(c=d.concat(f);e<c.length;){h=c[e];++e;for(k=h.deps.keys();k.hasNext();)b=k.next(),null==b.marked&&this.error(b.name+" needed by "+h.name+" is unreachable",null);h.marked=!0}l=[];var B={},C=null;C=function(a){B.hasOwnProperty(a.id)||(B[a.id]=!0,null!=a.v.parent?C(a.parent):l.push(a.v))};e=0;for(c=d.concat(f);e<c.length;){h=c[e];++e;b=0;for(m=h.readVars;b<m.length;)p=m[b],++b,C(p);k=0;for(b=h.writeVars;k<b.length;)m=b[k],++k,C(m)}var D=null;D=function(a){var b=a.type;if(13==b._hx_index){var c=
b.vl;if(a.kind!=L.Input){var d=[];for(b=0;b<c.length;){var e=c[b];++b;B.hasOwnProperty(e.id)&&(D(e),d.push(e))}a.type=x.TStruct(d)}}};for(e=0;e<l.length;)p=l[e],++e,D(p);e=function(a,b,c){b={id:A.allocVarId(),name:b,type:x.TFun([{ret:x.TVoid,args:[]}]),kind:L.Function};l.push(b);for(var d=[],e=0;e<c.length;){var f=c[e];++e;var g=f.body.e;if(4==g._hx_index)for(f=g.el,g=0;g<f.length;){var h=f[g];++g;d.push(h)}else d.push(f.body)}c={e:q.TBlock(d),t:x.TVoid,p:0==d.length?null:d[0].p};return{kind:a,ref:b,
ret:x.TVoid,args:[],expr:c}};h=this.mode==Fb.Compute?[e(Ca.Main,"main",d)]:[e(Ca.Vertex,"vertex",d),e(Ca.Fragment,"fragment",f)];for(e=0;e<g.length;)for(k=g[e],++e,c=0,b=k.cloned.vars.length;c<b;)f=c++,this.allocVar(k.cloned.vars[f],null).merged.unshift(k.origin.vars[f]);return{name:"out",vars:l,funs:h}},__class__:Li};var Sb=K["hxsl.Output"]={__ename__:!0,__constructs__:null,Const:(z=function(a){return{_hx_index:0,v:a,__enum__:"hxsl.Output",toString:v}},z._hx_name="Const",z.__params__=["v"],z),Value:(z=
function(a,b){return{_hx_index:1,v:a,size:b,__enum__:"hxsl.Output",toString:v}},z._hx_name="Value",z.__params__=["v","size"],z),PackNormal:(z=function(a){return{_hx_index:2,v:a,__enum__:"hxsl.Output",toString:v}},z._hx_name="PackNormal",z.__params__=["v"],z),PackFloat:(z=function(a){return{_hx_index:3,v:a,__enum__:"hxsl.Output",toString:v}},z._hx_name="PackFloat",z.__params__=["v"],z),Vec2:(z=function(a){return{_hx_index:4,a:a,__enum__:"hxsl.Output",toString:v}},z._hx_name="Vec2",z.__params__=["a"],
z),Vec3:(z=function(a){return{_hx_index:5,a:a,__enum__:"hxsl.Output",toString:v}},z._hx_name="Vec3",z.__params__=["a"],z),Vec4:(z=function(a){return{_hx_index:6,a:a,__enum__:"hxsl.Output",toString:v}},z._hx_name="Vec4",z.__params__=["a"],z),Swiz:(z=function(a,b){return{_hx_index:7,a:a,swiz:b,__enum__:"hxsl.Output",toString:v}},z._hx_name="Swiz",z.__params__=["a","swiz"],z)};Sb.__constructs__=[Sb.Const,Sb.Value,Sb.PackNormal,Sb.PackFloat,Sb.Vec2,Sb.Vec3,Sb.Vec4,Sb.Swiz];Sb.__empty_constructs__=[];
var ra=function(a){null==a&&(a=!1);this.varId=a};ra.__name__="hxsl.Printer";ra.opStr=function(a){switch(a._hx_index){case 0:return"+";case 1:return"*";case 2:return"/";case 3:return"-";case 4:return"=";case 5:return"==";case 6:return"!=";case 7:return">";case 8:return">=";case 9:return"<";case 10:return"<=";case 11:return"&";case 12:return"|";case 13:return"^";case 14:return"&&";case 15:return"||";case 16:return"<<";case 17:return">>";case 18:return">>>";case 19:return"%";case 20:return ra.opStr(a.op)+
"=";case 21:return"...";case 22:return"=>";default:return"??"+y.string(a)}};ra.toString=function(a,b){null==b&&(b=!1);return(new ra(b)).exprString(a)};ra.shaderToString=function(a,b){null==b&&(b=!1);return(new ra(b)).shaderString(a)};ra.check=function(a,b){var c;try{var d=new Fa,e=[],f=null;f=function(a,b){if(b){if(d.h.hasOwnProperty(a.id))throw t.thrown("Duplicate var "+a.id);d.h[a.id]=a;e.push(a)}else d.remove(a.id);var c=a.type;if(13==c._hx_index){var g=c.vl;for(c=0;c<g.length;)a=g[c],++c,f(a,
b)}};var g=null;g=function(a){var b=a.e;switch(b._hx_index){case 1:a=b.v;if(!d.h.hasOwnProperty(a.id))throw t.thrown("Unbound var "+a.name+"@"+a.id);break;case 4:a=b.el;b=e;e=[];for(var c=0;c<a.length;){var h=a[c];++c;g(h)}for(c=0;c<e.length;)a=e[c],++c,f(a,!1);e=b;break;case 7:a=b.v;b=b.init;null!=b&&g(b);f(a,!0);break;case 13:a=b.v;c=b.loop;g(b.it);f(a,!0);g(c);f(a,!1);break;default:A.iter(a,g)}};var h=0;for(c=a.vars;h<c.length;){var k=c[h];++h;f(k,!0)}h=0;for(c=a.funs;h<c.length;){var l=c[h];++h;
var m=0;for(var p=l.args;m<p.length;)k=p[m],++m,f(k,!0);g(l.expr);for(var q=0,n=l.args;q<n.length;){var u=n[q];++q;f(u,!1)}}}catch(w){c=t.caught(w).unwrap();if("string"==typeof c){k=c+"\n    in\n"+ra.shaderToString(a,!0);if(null!=b){c=[];for(m=0;m<b.length;)a=b[m],++m,c.push(ra.shaderToString(a,!0));k+="\n    from\n\n"+c.join("\n\n")}throw t.thrown(k);}throw w;}};ra.prototype={add:function(a){this.buffer.b+=y.string(a)},shaderString:function(a){this.buffer=new Lc;for(var b=0,c=a.vars;b<c.length;){var d=
c[b];++b;this.addVar(d,null);this.buffer.b+=y.string(";\n")}0<a.vars.length&&(this.buffer.b+=y.string("\n"));b=0;for(c=a.funs;b<c.length;)a=c[b],++b,this.addFun(a),this.buffer.b+=y.string("\n\n");return this.buffer.b},varString:function(a){this.buffer=new Lc;this.addVar(a,null);return this.buffer.b},funString:function(a){this.buffer=new Lc;this.addFun(a);return this.buffer.b},exprString:function(a){this.buffer=new Lc;this.addExpr(a,"");return this.buffer.b},addVar:function(a,b,c,d){null==c&&(c="");
if(null!=a.qualifiers){var e=0;for(var f=a.qualifiers;e<f.length;){var g=f[e];++e;switch(g._hx_index){case 0:var h=g.max;h="const"+(null==h?"":"("+h+")");break;case 1:h="private";break;case 2:h="nullable";break;case 3:h="perObject";break;case 4:h="name('"+g.n+"')";break;case 5:h="shared";break;case 6:h=g.p;h=K[h.__enum__].__constructs__[h._hx_index]._hx_name.toLowerCase()+"p";break;case 7:h="range("+g.min+","+g.max+")";break;case 8:h="ignore";break;case 9:h="perInstance("+g.v+")";break;case 10:h=
'doc("'+X.replace(g.s,'"','\\"')+'")';break;case 11:h="borrow("+g.source+")";break;case 12:h="sampler("+g.name+")";break;case 13:h="final";break;case 14:h="flat"}this.buffer.b+=y.string("@"+h+" ")}}if(a.kind!=b)switch(a.kind._hx_index){case 0:this.buffer.b+=y.string("@global ");break;case 1:this.buffer.b+=y.string("@input ");break;case 2:this.buffer.b+=y.string("@param ");break;case 3:this.buffer.b+=y.string("@varying ");break;case 4:this.buffer.b+=y.string("@local ");break;case 5:this.buffer.b+=
y.string("@output ");break;case 6:this.buffer.b+=y.string("@function ")}this.buffer.b+=y.string("var ");a.parent==d?this.buffer.b+=y.string(a.name+(this.varId?"@"+a.id:"")):this.addVarName(a);this.buffer.b+=y.string(" : ");e=a.type;if(13==e._hx_index){a=e.vl;this.buffer.b+=y.string("{");b=!0;for(e=0;e<a.length;)h=a[e],++e,b?b=!1:this.buffer.b+=y.string(", "),this.addVar(h,h.kind,c,h);this.buffer.b+=y.string("}")}else h=A.toString(a.type),this.buffer.b+=y.string(h)},addFun:function(a){this.buffer.b+=
y.string("function "+a.ref.name+"(");for(var b=!0,c=0,d=a.args;c<d.length;){var e=d[c];++c;b?(this.buffer.b+=y.string(" "),b=!1):this.buffer.b+=y.string(", ");this.addVar(e,L.Local)}0<a.args.length&&(this.buffer.b+=y.string(" "));b=") : "+A.toString(a.ret)+" ";this.buffer.b+=y.string(b);this.addExpr(a.expr,"")},addVarName:function(a){null!=a.parent&&(this.addVarName(a.parent),this.buffer.b+=y.string("."));this.buffer.b+=y.string(a.name);this.varId&&(this.buffer.b+=y.string("@"+a.id))},addConst:function(a){var b=
this.buffer,c=b.b;switch(a._hx_index){case 0:var d="null";break;case 1:d=a.b;break;case 2:d=a.v;break;case 3:d=a.v;break;case 4:d='"'+a.v+'"'}b.b=c+y.string(d)},addExpr:function(a,b){var c;var d=a.e;switch(d._hx_index){case 0:var e=d.c;this.addConst(e);break;case 1:var f=d.v;this.addVarName(f);break;case 2:f=Z.toString(d.g);this.buffer.b+=y.string(f);break;case 3:a=d.e;this.buffer.b+=y.string("(");this.addExpr(a,b);this.buffer.b+=y.string(")");break;case 4:f=d.el;this.buffer.b+=y.string("{");b+="\t";
for(c=0;c<f.length;)a=f[c],++c,this.buffer.b+=y.string("\n"+b),this.addExpr(a,b),this.buffer.b+=y.string(";");b=F.substr(b,1,null);0<f.length&&(this.buffer.b+=y.string("\n"+b));this.buffer.b+=y.string("}");break;case 5:c=d.op;a=d.e1;d=d.e2;this.addExpr(a,b);f=" "+ra.opStr(c)+" ";this.buffer.b+=y.string(f);this.addExpr(d,b);break;case 6:c=d.op;a=d.e1;switch(c._hx_index){case 0:f="++";break;case 1:f="--";break;case 2:f="!";break;case 3:f="-";break;case 4:f="~";break;default:throw t.thrown("assert");
}this.buffer.b+=y.string(f);this.addExpr(a,b);break;case 7:f=d.v;a=d.init;this.addVar(f,L.Local,b);null!=a&&(this.buffer.b+=y.string(" = "),this.addExpr(a,b));break;case 8:a=d.e;f=d.args;this.addExpr(a,b);this.buffer.b+=y.string("(");d=!0;for(c=0;c<f.length;)a=f[c],++c,d?d=!1:this.buffer.b+=y.string(", "),this.addExpr(a,b);this.buffer.b+=y.string(")");break;case 9:a=d.e;d=d.regs;this.addExpr(a,b);this.buffer.b+=y.string(".");for(c=0;c<d.length;)b=d[c],++c,this.buffer.b+=y.string(ra.SWIZ[b._hx_index]);
break;case 10:a=d.econd;c=d.eif;d=d.eelse;this.buffer.b+=y.string("if( ");this.addExpr(a,b);this.buffer.b+=y.string(" ) ");this.addExpr(c,b);null!=d&&(this.buffer.b+=y.string(" else "),this.addExpr(d,b));break;case 11:this.buffer.b+=y.string("discard");break;case 12:a=d.e;this.buffer.b+=y.string("return");null!=a&&(this.buffer.b+=y.string(" "),this.addExpr(a,b));break;case 13:f=d.v;a=d.it;d=d.loop;this.buffer.b+=y.string("for( ");this.addVarName(f);this.buffer.b+=y.string(" in ");this.addExpr(a,b);
this.buffer.b+=y.string(" ) ");this.addExpr(d,b);break;case 14:this.buffer.b+=y.string("continue");break;case 15:this.buffer.b+=y.string("break");break;case 16:a=d.e;d=d.index;this.addExpr(a,b);this.buffer.b+=y.string("[");this.addExpr(d,b);this.buffer.b+=y.string("]");break;case 17:f=d.el;this.buffer.b+=y.string("[");d=!0;for(c=0;c<f.length;)a=f[c],++c,d?d=!1:this.buffer.b+=y.string(", "),this.addExpr(a,b);this.buffer.b+=y.string("]");break;case 18:a=d.e;var g=d.cases,h=d.def;this.buffer.b+=y.string("switch( ");
this.addExpr(a,b);this.buffer.b+=y.string(") {");var k=b;for(c=0;c<g.length;){e=g[c];++c;this.buffer.b+=y.string("\n"+b);this.buffer.b+=y.string("case ");d=!0;a=0;for(var l=e.values;a<l.length;)f=l[a],++a,d?d=!1:this.buffer.b+=y.string(", "),this.addExpr(f,b);b+="\t";this.buffer.b+=y.string(":\n"+b);this.addExpr(e.expr,b);b=k}null!=h&&(this.buffer.b+=y.string("\n"+b),b+="\t",this.buffer.b+=y.string("default:\n"+b),this.addExpr(h,b),b=k);this.buffer.b+=y.string("\n"+b+"}");break;case 19:c=d.e;a=d.loop;
0==d.normalWhile?(d=a,a=c,k=b,b+="\t",this.buffer.b+=y.string("do {\n"+b),this.addExpr(d,b),b=k,this.buffer.b+=y.string("\n"+b+"} while( "),this.addExpr(a,b),this.buffer.b+=y.string(" )")):(d=a,a=c,this.buffer.b+=y.string("while( "),this.addExpr(a,b),k=b,b+="\t",this.buffer.b+=y.string(" ) {\n"+b),this.addExpr(d,b),this.buffer.b+=y.string("\n"+k+"}"));break;case 20:c=d.m;f=d.args;a=d.e;this.buffer.b+=y.string("@");this.buffer.b+=y.string(c);if(0<f.length){this.buffer.b+=y.string("(");d=!0;for(c=0;c<
f.length;)e=f[c],++c,d?d=!1:this.buffer.b+=y.string(", "),this.addConst(e);this.buffer.b+=y.string(")")}this.buffer.b+=y.string(" ");this.addExpr(a,b);break;case 21:a=d.e;d=d.name;this.addExpr(a,b);this.buffer.b+=y.string(".");this.buffer.b+=y.string(d);break;case 22:a=d.target;c=d.code;f=d.args;this.buffer.b+=y.string("Syntax.");this.buffer.b+=y.string(a);this.buffer.b+=y.string("(");this.addConst(E.CString(c));for(d=0;d<f.length;){a=f[d];++d;switch(a.access._hx_index){case 0:this.buffer.b+=y.string(", @r ");
break;case 1:this.buffer.b+=y.string(", @w ");break;case 2:this.buffer.b+=y.string(", @rw ")}this.addExpr(a.e,b)}this.buffer.b+=y.string(")")}},__class__:ra};var Fb=K["hxsl.LinkMode"]={__ename__:!0,__constructs__:null,Default:{_hx_name:"Default",_hx_index:0,__enum__:"hxsl.LinkMode",toString:v},Batch:{_hx_name:"Batch",_hx_index:1,__enum__:"hxsl.LinkMode",toString:v},Compute:{_hx_name:"Compute",_hx_index:2,__enum__:"hxsl.LinkMode",toString:v}};Fb.__constructs__=[Fb.Default,Fb.Batch,Fb.Compute];Fb.__empty_constructs__=
[Fb.Default,Fb.Batch,Fb.Compute];var Hf=function(a,b,c,d,e){this.name=a;this.pos=b;this.instance=c;this.index=d;this.type=e};Hf.__name__="hxsl.AllocParam";Hf.prototype={clone:function(a){null==a&&(a=!1);var b=new Hf(this.name,this.pos,this.instance,this.index,this.type);null!=this.perObjectGlobal&&(b.perObjectGlobal=this.perObjectGlobal.clone(a));null!=this.next&&(b.next=this.next.clone(a));return b},__class__:Hf};var sg=function(a,b,c){this.pos=a;this.path=b;this.gid=za.allocID(b);this.type=c};sg.__name__=
"hxsl.AllocGlobal";sg.prototype={clone:function(a){null==a&&(a=!1);var b=new sg(this.pos,this.path,this.type);null!=this.next&&(b.next=this.next.clone(a));a&&(b.gid=0);return b},__class__:sg};var Pi=function(){};Pi.__name__="hxsl.RuntimeShaderData";Pi.prototype={__class__:Pi};var Oi=function(a,b){this.shader=a;this.bits=b};Oi.__name__="hxsl.ShaderInstanceDesc";Oi.prototype={__class__:Oi};var rg=function(){this.id=rg.UID++};rg.__name__="hxsl.RuntimeShader";rg.prototype={get_compute:function(){return this.vertex},
set_compute:function(a){return this.vertex=a},hasGlobal:function(a){return this.globals.h.hasOwnProperty(a)},getShaders:function(){return this.mode==Fb.Compute?[this.vertex]:[this.vertex,this.fragment]},__class__:rg};var Ma=function(){this.uid=this.tid=1};Ma.__name__="hxsl.Serializer";Ma.run=function(a){return(new Ma).serialize(a)};Ma.prototype={writeArr:function(a,b){this.writeVarInt(a.length);for(var c=0;c<a.length;){var d=a[c];++c;b(d)}},readArr:function(a){for(var b=[],c=0,d=this.readVarInt();c<
d;)c++,b.push(a());return b},readVarInt:function(){var a=this.input.readByte();return 128>a?a:255==a?this.input.readInt32():(a&127)<<8|this.input.readByte()},writeVarInt:function(a){if(128>a)this.out.addByte(a);else{var b=a>>8;127<=b?(this.out.addByte(255),this.out.addInt32(b)):(this.out.addByte(b|128),this.out.addByte(a&255))}},writeID:function(a){var b=this.idMap.h[a];null==b&&(b=this.uid++,this.idMap.h[a]=b);this.writeVarInt(b)},readID:function(){return this.readVarInt()},writeTID:function(a){var b=
this.typeIdMap.get(a);if(null!=b)return this.writeVarInt(b),!1;b=this.tid++;this.typeIdMap.set(a,b);this.writeVarInt(b);return!0},writeType:function(a){this.out.addByte(a._hx_index);switch(a._hx_index){case 5:var b=a.size;var c=a.t;this.out.addByte(b|c._hx_index<<3);break;case 9:b=a.size;this.out.addInt32(b);break;case 10:c=a.dim;b=a.isArray;this.out.addByte(c._hx_index<<1|(b?1:0));break;case 11:c=a.dim;b=a.isArray;this.out.addByte(c._hx_index<<3|(b?1:0)|a.channels-1<<1);break;case 13:b=a.vl;if(this.writeTID(a)){var d=
M(this,this.writeVar);this.writeVarInt(b.length);for(c=0;c<b.length;)a=b[c],++c,d(a)}break;case 15:c=a.t;b=a.size;this.writeType(c);switch(b._hx_index){case 0:a=b.v;this.out.addByte(0);this.writeVarInt(a);break;case 1:a=b.v,this.writeVar(a)}break;case 16:c=a.t;b=a.size;a=a.kind;0!=a._hx_index&&this.out.addByte(a._hx_index+128);this.writeType(c);switch(b._hx_index){case 0:a=b.v;this.out.addByte(0);this.writeVarInt(a);break;case 1:a=b.v,this.writeVar(a)}break;case 17:b=a.size,this.out.addByte(b)}},
readType:function(){switch(this.input.readByte()){case 0:return x.TVoid;case 1:return x.TInt;case 2:return x.TBool;case 3:return x.TFloat;case 4:return x.TString;case 5:var a=this.input.readByte();var b=Ma.TVECS.h[a];null==b&&(b=x.TVec(a&7,da.createEnumIndex(Q,a>>3,null)),Ma.TVECS.h[a]=b);return b;case 6:return x.TMat3;case 7:return x.TMat4;case 8:return x.TMat3x4;case 9:return x.TBytes(this.input.readInt32());case 10:if(0==this.version)return x.TSampler(Ta.T2D,!1);b=this.input.readByte();a=Ma.TDIMS[b>>
1];return x.TSampler(a,0!=(b&1));case 11:if(0==this.version)return x.TSampler(Ta.T2D,!0);b=this.input.readByte();a=Ma.TDIMS[b>>3];return x.TRWTexture(a,0!=(b&1),(b>>1&3)+1);case 12:return 0==this.version?x.TSampler(Ta.TCube,!1):x.TMat2;case 13:a=this.readVarInt();var c=this.types[a];if(null!=c)return c;b=M(this,this.readVar);c=[];for(var d=0,e=this.readVarInt();d<e;)d++,c.push(b());c=x.TStruct(c);return this.types[a]=c;case 14:return x.TFun(null);case 15:return c=this.readType(),b=this.readVar(),
x.TArray(c,null==b?Za.SConst(this.readVarInt()):Za.SVar(b));case 16:return b=this.input.readByte(),a=Ab.Uniform,0==(b&128)?(b=this.input,b.set_position(b.pos-1)):a=da.createEnumIndex(Ab,b&127,null),c=this.readType(),b=this.readVar(),x.TBuffer(c,null==b?Za.SConst(this.readVarInt()):Za.SVar(b),a);case 17:return x.TChannel(this.input.readByte());case 18:if(0==this.version)return x.TMat2;throw t.thrown("assert");default:throw t.thrown("assert");}},writeString:function(a){a=S.ofString(a);this.writeVarInt(a.length);
this.out.add(a)},readString:function(){var a=this.readVarInt();return this.input.read(a).getString(0,a)},writeVar:function(a){if(null==a)this.out.addByte(0);else if(this.writeID(a.id),!this.varMap.h.hasOwnProperty(a.id))if(this.varMap.h[a.id]=a,this.writeString(a.name),this.writeType(a.type),this.out.addByte(a.kind._hx_index),this.writeVar(a.parent),null==a.qualifiers)this.out.addByte(0);else{this.out.addByte(a.qualifiers.length);for(var b=0,c=a.qualifiers;b<c.length;)switch(a=c[b],++b,this.out.addByte(a._hx_index),
a._hx_index){case 0:a=a.max;this.out.addInt32(null==a?0:a);break;case 4:this.writeString(a.n);break;case 6:this.out.addByte(a.p._hx_index);break;case 7:var d=a.max;this.out.addDouble(a.min);this.out.addDouble(d);break;case 9:a=a.v;this.out.addInt32(a);break;case 10:this.writeString(a.s);break;case 11:this.writeString(a.source);break;case 12:this.writeString(a.name)}}},writeFun:function(a){this.out.addByte(a.kind._hx_index);this.writeVar(a.ref);var b=a.args,c=M(this,this.writeVar);this.writeVarInt(b.length);
for(var d=0;d<b.length;){var e=b[d];++d;c(e)}this.writeType(a.ret);this.writeExpr(a.expr)},writeConst:function(a){this.out.addByte(a._hx_index);switch(a._hx_index){case 1:this.out.addByte(a.b?1:0);break;case 2:a=a.v;this.out.addInt32(a);break;case 3:a=a.v;this.out.addDouble(a);break;case 4:a=a.v,this.writeString(a)}},writeExpr:function(a){if(null==a)this.out.addByte(0);else{this.out.addByte(a.e._hx_index+1);var b=a.e;switch(b._hx_index){case 0:this.writeConst(b.c);break;case 1:var c=b.v;this.writeVar(c);
break;case 2:this.out.addByte(b.g._hx_index);break;case 3:var d=b.e;this.writeExpr(d);break;case 4:d=b.el;var e=M(this,this.writeExpr);this.writeVarInt(d.length);for(b=0;b<d.length;)c=d[b],++b,e(c);break;case 5:c=b.op;d=b.e1;b=b.e2;20==c._hx_index?this.out.addByte(c.op._hx_index|128):this.out.addByte(c._hx_index);this.writeExpr(d);this.writeExpr(b);break;case 6:c=b.op;d=b.e1;this.out.addByte(c._hx_index);this.writeExpr(d);break;case 7:c=b.v;d=b.init;this.writeVar(c);this.writeExpr(d);break;case 8:d=
b.e;var f=b.args;this.writeExpr(d);e=M(this,this.writeExpr);this.writeVarInt(f.length);for(b=0;b<f.length;)c=f[b],++b,e(c);break;case 9:d=b.e;c=b.regs;this.writeExpr(d);if(0==c.length)throw t.thrown("assert");d=c.length-1;e=2;for(b=0;b<c.length;)f=c[b],++b,d|=f._hx_index<<e,e+=2;this.out.addByte(d&255);this.out.addByte(d>>8);break;case 10:d=b.eif;c=b.eelse;this.writeExpr(b.econd);this.writeExpr(d);this.writeExpr(c);break;case 12:d=b.e;this.writeExpr(d);break;case 13:c=b.v;d=b.it;e=b.loop;this.writeVar(c);
this.writeExpr(d);this.writeExpr(e);break;case 16:d=b.e;c=b.index;this.writeExpr(d);this.writeExpr(c);break;case 17:d=b.el;e=M(this,this.writeExpr);this.writeVarInt(d.length);for(b=0;b<d.length;)c=d[b],++b,e(c);break;case 18:d=b.e;f=b.cases;var g=b.def;this.writeExpr(d);this.writeVarInt(f.length);for(b=0;b<f.length;){c=f[b];++b;d=c.values;e=M(this,this.writeExpr);this.writeVarInt(d.length);for(var h=0;h<d.length;){var k=d[h];++h;e(k)}this.writeExpr(c.expr)}this.writeExpr(g);break;case 19:d=b.e;e=
b.loop;c=b.normalWhile;this.writeExpr(d);this.writeExpr(e);this.out.addByte(c?1:0);break;case 20:c=b.m;f=b.args;d=b.e;this.writeString(c);e=M(this,this.writeConst);this.writeVarInt(f.length);for(b=0;b<f.length;)c=f[b],++b,e(c);this.writeExpr(d);break;case 21:d=b.e;c=b.name;this.writeExpr(d);this.writeString(c);break;case 22:for(d=b.target,c=b.code,f=b.args,this.writeString(d),this.writeString(c),this.writeVarInt(f.length),b=0;b<f.length;)c=f[b],++b,this.writeExpr(c.e),this.out.addByte(c.access._hx_index)}this.writeType(a.t)}},
readConst:function(){switch(this.input.readByte()){case 0:return E.CNull;case 1:return E.CBool(0!=this.input.readByte());case 2:return E.CInt(this.input.readInt32());case 3:return E.CFloat(this.input.readDouble());case 4:return E.CString(this.readString());default:throw t.thrown("assert");}},readExpr:function(){var a,b=this.input.readByte();if(0==b--)return null;switch(b){case 0:b=q.TConst(this.readConst());break;case 1:b=q.TVar(this.readVar());break;case 2:b=q.TGlobal(Ma.TGLOBALS[this.input.readByte()]);
break;case 3:b=q.TParenthesis(this.readExpr());break;case 4:var c=M(this,this.readExpr);var d=[];var e=0;for(a=this.readVarInt();e<a;)e++,d.push(c());b=q.TBlock(d);break;case 5:b=this.input.readByte();b=q.TBinop(128<=b?aa.OpAssignOp(Ma.BOPS[b&127]):Ma.BOPS[b],this.readExpr(),this.readExpr());break;case 6:b=q.TUnop(Ma.UNOPS[this.input.readByte()],this.readExpr());break;case 7:b=q.TVarDecl(this.readVar(),this.readExpr());break;case 8:b=this.readExpr();c=M(this,this.readExpr);d=[];e=0;for(a=this.readVarInt();e<
a;)e++,d.push(c());b=q.TCall(b,d);break;case 9:b=this.readExpr();c=this.input.readUInt16();a=Ma.TSWIZ.h[c];if(null==a){d=[];e=0;for(a=(c&3)+1;e<a;){var f=e++;d.push(Ma.REGS[c>>2*f+2&3])}a=d;Ma.TSWIZ.h[c]=a}b=q.TSwiz(b,a);break;case 10:b=q.TIf(this.readExpr(),this.readExpr(),this.readExpr());break;case 11:b=q.TDiscard;break;case 12:b=q.TReturn(this.readExpr());break;case 13:b=q.TFor(this.readVar(),this.readExpr(),this.readExpr());break;case 14:b=q.TContinue;break;case 15:b=q.TBreak;break;case 16:b=
q.TArray(this.readExpr(),this.readExpr());break;case 17:c=M(this,this.readExpr);d=[];e=0;for(a=this.readVarInt();e<a;)e++,d.push(c());b=q.TArrayDecl(d);break;case 18:b=this.readExpr();d=[];e=0;for(a=this.readVarInt();e<a;){e++;c=M(this,this.readExpr);f=[];for(var g=0,h=this.readVarInt();g<h;)g++,f.push(c());d.push({values:f,expr:this.readExpr()})}b=q.TSwitch(b,d,this.readExpr());break;case 19:b=q.TWhile(this.readExpr(),this.readExpr(),0!=this.input.readByte());break;case 20:b=this.readString();c=
M(this,this.readConst);d=[];e=0;for(a=this.readVarInt();e<a;)e++,d.push(c());b=q.TMeta(b,d,this.readExpr());break;case 21:b=q.TField(this.readExpr(),this.readString());break;case 22:b=this.readString();c=this.readString();d=[];e=0;for(a=this.readVarInt();e<a;)e++,d.push({e:this.readExpr(),access:da.createEnumIndex(qc,this.input.readByte(),null),read:!1,write:!1});b=q.TSyntax(b,c,d);break;default:throw t.thrown("assert");}return{e:b,t:this.readType(),p:null}},readVar:function(){var a=this.readVarInt();
if(0==a)return null;var b=this.varMap.h[a];if(null!=b)return b;b={id:A.allocVarId(),name:this.readString(),type:null,kind:null};this.varMap.h[a]=b;b.type=this.readType();b.kind=Ma.VKINDS[this.input.readByte()];b.parent=this.readVar();a=this.input.readByte();if(0<a){b.qualifiers=[];for(var c=0;c<a;){c++;switch(this.input.readByte()){case 0:var d=this.input.readInt32();d=ma.Const(0==d?null:d);break;case 1:d=ma.Private;break;case 2:d=ma.Nullable;break;case 3:d=ma.PerObject;break;case 4:d=ma.Name(this.readString());
break;case 5:d=ma.Shared;break;case 6:d=ma.Precision(Ma.PRECS[this.input.readByte()]);break;case 7:d=ma.Range(this.input.readDouble(),this.input.readDouble());break;case 8:d=ma.Ignore;break;case 9:d=ma.PerInstance(this.input.readInt32());break;case 10:d=ma.Doc(this.readString());break;case 11:d=ma.Borrow(this.readString());break;case 12:d=ma.Sampler(this.readString());break;case 13:d=ma.Final;break;case 14:d=ma.Flat;break;default:throw t.thrown("assert");}b.qualifiers.push(d)}}return b},readFun:function(){for(var a=
Ma.FKIND[this.input.readByte()],b=this.readVar(),c=M(this,this.readVar),d=[],e=0,f=this.readVarInt();e<f;)e++,d.push(c());return{kind:a,ref:b,args:d,ret:this.readType(),expr:this.readExpr()}},unserialize:function(a){this.input=new Vb(Yd.decode(a,!1));if(this.input.readByte()!=(Ma.SIGN&255)||this.input.readByte()!=(Ma.SIGN>>8&255))throw t.thrown("Invalid HXSL data");this.version=this.input.readByte()-139;if(0>this.version||1<this.version)throw t.thrown("Invalid HXSL data");this.varMap=new Fa;this.types=
[];a=this.readString();for(var b=M(this,this.readVar),c=[],d=0,e=this.readVarInt();d<e;)d++,c.push(b());var f=c;b=M(this,this.readFun);c=[];d=0;for(e=this.readVarInt();d<e;)d++,c.push(b());return{name:a,vars:f,funs:c}},serialize:function(a){this.varMap=new Fa;this.idMap=new Fa;this.typeIdMap=new $e;this.out=new Id;this.out.addByte(Ma.SIGN&255);this.out.addByte(Ma.SIGN>>8&255);this.out.addByte(Ma.SIGN>>16&255);this.writeString(a.name);var b=a.vars,c=M(this,this.writeVar);this.writeVarInt(b.length);
for(var d=0;d<b.length;){var e=b[d];++d;c(e)}b=a.funs;c=M(this,this.writeFun);this.writeVarInt(b.length);for(d=0;d<b.length;)e=b[d],++d,c(e);return Yd.encode(this.out.getBytes(),!1)},__class__:Ma};var Eb=function(a,b){this.s=a;this.next=b};Eb.__name__="hxsl.ShaderList";Eb.addSort=function(a,b){for(var c=null,d=b;null!=d&&d.s.priority<a.priority;)c=d,d=d.next;if(null==c)return a=new Eb(a,b),Eb.checkSize(a),a;c.next=new Eb(a,c.next);Eb.checkSize(b);return b};Eb.checkSize=function(a){if(!(0>=Eb.MAX_LIST_SIZE)){for(var b=
0;null!=a;){if(!Eb.ALLOW_DUPLICATES&&null!=a.next&&a.next.s==a.s)throw t.thrown("Duplicate shader "+y.string(a.s));++b;a=a.next}if(b>Eb.MAX_LIST_SIZE)throw t.thrown("Too many shaders");}};Eb.prototype={clone:function(){return new Eb(this.s.clone(),null==this.next?null:this.next.clone())},iterator:function(){return new re(this,null)},iterateTo:function(a){return new re(this,a)},__class__:Eb};var re=function(a,b){this.l=a;this.last=b};re.__name__="hxsl._ShaderList.ShaderIterator";re.prototype={hasNext:function(){return this.l!=
this.last},next:function(){var a=this.l.s;this.l=this.l.next;return a},__class__:re};var ug=function(a){this.id=++ug.UID;this.shader=a;this.params=new Fa};ug.__name__="hxsl.ShaderInstance";ug.prototype={__class__:ug};var Ui=function(a,b){this.v=a;this.globalId=b};Ui.__name__="hxsl.ShaderGlobal";Ui.prototype={__class__:Ui};var If=function(a,b,c){this.v=a;this.pos=b;this.bits=c};If.__name__="hxsl.ShaderConst";If.prototype={__class__:If};var Ob=function(a,b){this.instanceCache=new Fa;this.consts=null;
this.globals=[];if(""!=a){this.module=b;this.data=(new Ma).unserialize(a);a=0;for(b=this.data.vars;a<b.length;){var c=b[a];++a;this.initVarId(c)}this.data=Ob.compactMem(this.data);this.initialize();this.initLiveReload()}};Ob.__name__="hxsl.SharedShader";Ob.mergeVars=function(a,b){if(a.length!=b.length)return!1;for(var c=0,d=a;c<d.length;){var e=d[c];a=c++;var f=b[a];if(e.name!=f.name)return!1;f.id=e.id;a=e.type;e=f.type;if(13==a._hx_index&&13==e._hx_index&&(e=e.vl,a=a.vl,a.length!=e.length||!Ob.mergeVars(a,
e)))return!1}return!0};Ob.loadShader=function(a,b){a.getText();throw t.thrown("Shader live reload requires --library hscript");};Ob.compactMem=function(a){return a};Ob.prototype={initialize:function(){for(var a=0,b=this.data.vars;a<b.length;){var c=b[a];++a;this.browseVar(c)}},getInstance:function(a){var b=this.instanceCache.h[a];return null==b?this.makeInstance(a):b},makeBufferType:function(a,b,c){if(13==b._hx_index){b=b.vl;for(var d=[],e=0,f=c.inputs;e<f.length;)c=f[e++],d.push(c);e=[];for(f=0;f<
d.length;){c=d[f++];var g=c.name;switch(c.type){case 1:var h=x.TFloat;break;case 2:h=x.TVec(2,Q.VFloat);break;case 3:h=x.TVec(3,Q.VFloat);break;case 4:h=x.TVec(4,Q.VFloat);break;case 9:h=x.TBytes(4);break;case 16:h=x.TMat4}if(X.endsWith(c.name,"__m0")){h=c.type;h=h==ka.__cast(9,jc)?1:h;for(var k=2;null!=d[f+k-1]&&X.endsWith(d[f+k-1].name,"__m"+k);)++k;switch(k){case 2:if(2==h)h=x.TMat2;else throw t.thrown("Unsupported matrix format");break;case 3:switch(h){case 3:h=x.TMat3;break;case 4:h=x.TMat3x4;
break;default:throw t.thrown("Unsupported matrix format");}break;case 4:if(4==h)h=x.TMat4;else throw t.thrown("Unsupported matrix format");break;default:throw t.thrown("Unsupported matrix format");}g=F.substr(c.name,0,-4);f+=k-1}e.push({id:A.allocVarId(),name:g,type:h,kind:a.kind,parent:a})}for(d=0;d<b.length;){a=b[d];++d;h=!1;for(f=0;f<e.length;)if(c=e[f],++f,a.name==c.name){h=a.type;f=c.type;switch(h._hx_index){case 3:if(3!=f._hx_index&&!da.enumEq(a.type,c.type))throw t.thrown("Buffer "+this.data.name+
"."+a.name+":"+A.toString(a.type)+" should be "+A.toString(c.type));break;case 5:if(1==h.t._hx_index)if(5==f._hx_index)if(1==f.t._hx_index){if(h.size>f.size&&!da.enumEq(a.type,c.type))throw t.thrown("Buffer "+this.data.name+"."+a.name+":"+A.toString(a.type)+" should be "+A.toString(c.type));}else{if(!da.enumEq(a.type,c.type))throw t.thrown("Buffer "+this.data.name+"."+a.name+":"+A.toString(a.type)+" should be "+A.toString(c.type));}else{if(!da.enumEq(a.type,c.type))throw t.thrown("Buffer "+this.data.name+
"."+a.name+":"+A.toString(a.type)+" should be "+A.toString(c.type));}else if(!da.enumEq(a.type,c.type))throw t.thrown("Buffer "+this.data.name+"."+a.name+":"+A.toString(a.type)+" should be "+A.toString(c.type));break;default:if(!da.enumEq(a.type,c.type))throw t.thrown("Buffer "+this.data.name+"."+a.name+":"+A.toString(a.type)+" should be "+A.toString(c.type));}h=!0;break}if(!h)throw t.thrown("Buffer is missing "+this.data.name+"."+a.name+":"+A.toString(a.type));}return x.TStruct(e)}throw t.thrown("assert");
},makeInstance:function(a){var b=new Si;var c=this.consts;for(var d=[];null!=c;){var e=c.v.type;switch(e._hx_index){case 1:b.setConstant(c.v,E.CInt(a>>>c.pos&(1<<c.bits)-1));break;case 2:b.setConstant(c.v,E.CBool(0!=(a>>>c.pos&1)));break;case 16:var f=e.t;var g=e.size;var h=e.kind;e=N.fromID(a>>>c.pos&(1<<c.bits)-1);var k={id:c.v.id,name:c.v.name,kind:c.v.kind,type:null};f=this.makeBufferType(k,f,e);switch(h._hx_index){case 3:h=Ab.Uniform;break;case 4:h=Ab.Storage;break;case 5:h=Ab.RW;break;default:throw t.thrown("assert");
}k.type=x.TBuffer(f,g,h);b.varMap.set(c.v,k);d.push(k);break;case 17:b.setConstant(c.v,E.CInt(a>>>c.pos&(1<<c.bits)-1));break;default:throw t.thrown("assert");}c=c.next}for(e=0;e<d.length;)k=d[e],++e,h=k.type,16==h._hx_index&&(f=h.size,1==f._hx_index&&(c=f.v,f=h.t,h=h.kind,c=b.constants.h[c.id],null!=c&&null!=c&&0==c._hx_index&&(c=c.c,2==c._hx_index&&(c=c.v,k.type=x.TBuffer(f,Za.SConst(c),h)))));b.inlineCalls=!0;b.unrollLoops=Ob.UNROLL_LOOPS;k=b.eval(this.data);k=Ob.compactMem(k);c=new ug(k);e=this.paramsCount=
0;for(h=this.data.vars;e<h.length;)k=h[e],++e,this.addParam(b,c,k);return this.instanceCache.h[a]=c},addSelfParam:function(a,b){var c=b.type;if(13==c._hx_index)for(b=c.vl,c=0;c<b.length;){var d=b[c];++c;this.addSelfParam(a,d)}else b.kind==L.Param&&(a.params.h[b.id]=this.paramsCount,this.paramsCount++)},addParam:function(a,b,c){var d=c.type;if(13==d._hx_index)for(c=d.vl,d=0;d<c.length;){var e=c[d];++d;this.addParam(a,b,e)}else c.kind==L.Param&&(b.params.h[a.varMap.h[c.__id__].id]=this.paramsCount,
this.paramsCount++)},initVarId:function(a){a.id=A.allocVarId();var b=a.type;if(13==b._hx_index){var c=b.vl;for(b=0;b<c.length;)a=c[b],++b,this.initVarId(a)}},browseVar:function(a,b){b=null==b?A.getName(a):b+("."+a.name);var c=a.type;if(13==c._hx_index)for(a=c.vl,c=0;c<a.length;){var d=a[c];++c;this.browseVar(d,b)}else c=0,a.kind==L.Global&&(c=za.allocID(b),this.globals.push(new Ui(a,c))),A.isConst(a)&&(b=A.getConstBits(a),0<b&&(b=new If(a,null==this.consts?0:this.consts.pos+this.consts.bits,b),b.globalId=
c,b.next=this.consts,this.consts=b))},initLiveReload:function(){if(null!=this.module&&gf.isActive()){Ob.SHADER_RESOLVE.h[this.data.name]=this;var a=this.module.split(".").join("/")+".hx";this.file=gf.resolve(a);null!=this.file&&this.file.watch(M(this,this.onFileReload))}},onFileReload:function(){for(var a=Ob.SHADER_RESOLVE.h,b=Object.keys(a),c=b.length,d=0;d<c;){var e=a[b[d++]];e.file==this.file&&e.reloadShader()}},reloadShader:function(){try{var a=Ob.loadShader(this.file,this.data.name);if(null!=
a){var b=new U;b.loadShader=function(a){var b=Ob.SHADER_RESOLVE.h[a];if(null==b)throw t.thrown("Could not resolve shader "+a);if(null==b.file)throw t.thrown("Shader "+a+" can't be live reload because of missing live path");return Ob.loadShader(b.file,b.data.name)};var c=b.check(this.data.name,a);this.applyChanges(c)}}catch(d){if(a=t.caught(d).unwrap(),a instanceof kb)b=F.substr(this.file.getText(),0,a.pos.min).split("\n").length,$a.trace(a.msg,{methodName:null,className:null,fileName:a.pos.file,lineNumber:b});
else throw d;}},applyChanges:function(a){if(!Ob.mergeVars(this.data.vars,a.vars))return!1;this.data=Ob.compactMem(a);this.instanceCache=new Fa;return!0},__class__:Ob};var Kf=function(a){this.v=a;this.write=this.read=0};Kf.__name__="hxsl._Splitter.VarProps";Kf.prototype={__class__:Kf};var Mi=function(){};Mi.__name__="hxsl.Splitter";Mi.prototype={split:function(a,b){var c=this;this.isBatchShader=b;var d=null,e=new Fa;var f=[];var g=null,h=new Fa;var k=[];var l=!1;this.varNames=new Sa;this.varMap=new Cc;
b=0;for(a=a.funs;b<a.length;){var m=a[b];++b;switch(m.kind._hx_index){case 1:this.vars=h;this.avars=k;g=m;this.checkExpr(m.expr);break;case 0:case 4:this.vars=e;this.avars=f;d=m;this.checkExpr(m.expr);m.kind==Ca.Main&&(l=!0);break;default:throw t.thrown("assert");}}var p=[];a=f.length;for(b=0;b<a;){var r=b++;var n=[f[r]],u=[n[0].v];if(!n[0].local){switch(u[0].kind._hx_index){case 3:case 4:m=h.h[n[0].origin.id],u[0].kind=null!=m&&0<m.read?L.Var:L.Local}switch(u[0].kind._hx_index){case 3:case 5:if(0<
n[0].read||1<n[0].write)m={id:A.allocVarId(),name:u[0].name,kind:L.Local,type:u[0].type},this.uniqueName(m),this.varMap.set(n[0].origin,m),r=new Kf(m),r.read++,e.h[m.id]=r,r=d.expr.p,m=[{e:q.TBinop(aa.OpAssign,{e:q.TVar(u[0]),t:m.type,p:r},{e:q.TVar(m),t:u[0].type,p:r}),t:m.type,p:r}],p.push(function(a){return function(){c.addExpr(d,a[0])}}(m)),u[0].kind==L.Var&&p.push(function(a,b){return function(){c.varMap.set(b[0].origin,a[0])}}(u,n))}}}d={ret:d.ret,ref:d.ref,kind:d.kind,args:d.args,expr:this.mapVars(d.expr)};
for(b=0;b<p.length;)m=p[b],++b,m();a=[];for(b=0;b<k.length;)switch(p=k[b],++b,f=p.v,f.kind._hx_index){case 1:m={id:A.allocVarId(),name:f.name,kind:L.Var,type:f.type};this.uniqueName(m);r=e.h[p.origin.id];null==r&&(r=new Kf(f),e.h[p.origin.id]=r);r.read++;this.varMap.set(p.origin,m);r=new Kf(m);r.origin=p.origin;h.h[p.origin.id]=r;e.h[m.id]=r;this.addExpr(d,{e:q.TBinop(aa.OpAssign,{e:q.TVar(m),t:f.type,p:d.expr.p},{e:q.TVar(f),t:f.type,p:d.expr.p}),t:f.type,p:d.expr.p});break;case 3:0<p.write&&(m=
{id:A.allocVarId(),name:f.name,kind:L.Local,type:f.type},this.uniqueName(m),a.push({e:q.TVarDecl(m,{e:q.TVar(f),t:f.type,p:g.expr.p}),t:x.TVoid,p:g.expr.p}),this.varMap.set(p.origin,m))}for(f=e.iterator();f.hasNext();)k=f.next(),this.checkVar(k,!0,e,d.expr.p);for(f=h.iterator();f.hasNext();)k=f.next(),this.checkVar(k,!1,e,g.expr.p);if(null!=g)if(g={ret:g.ret,ref:g.ref,kind:g.kind,args:g.args,expr:this.mapVars(g.expr)},b=g.expr.e,4==b._hx_index)for(k=b.el,b=0;b<a.length;)f=a[b],++b,k.unshift(f);else a.push(g.expr),
g.expr={e:q.TBlock(a),t:x.TVoid,p:g.expr.p};b=[];for(f=e.iterator();f.hasNext();)k=f.next(),k.local||b.push(k);e=b;b=[];for(f=h.iterator();f.hasNext();)k=f.next(),k.local||b.push(k);h=b;e.sort(function(a,b){var c=(null==a.origin?a.v.id:a.origin.id)-(null==b.origin?b.v.id:b.origin.id);return 0!=c?c:a.v.id-b.v.id});h.sort(function(a,b){var c=(null==a.origin?a.v.id:a.origin.id)-(null==b.origin?b.v.id:b.origin.id);return 0!=c?c:a.v.id-b.v.id});if(l){b=[];for(a=0;a<e.length;)f=e[a],++a,b.push(f.v);return[{name:"main",
vars:b,funs:[d]}]}b=[];for(a=0;a<e.length;)f=e[a],++a,b.push(f.v);e={name:"vertex",vars:b,funs:[d]};b=[];for(a=0;a<h.length;)f=h[a],++a,b.push(f.v);return[e,{name:"fragment",vars:b,funs:[g]}]},addExpr:function(a,b){var c=a.expr.e;4==c._hx_index?c.el.push(b):a.expr={e:q.TBlock([a.expr,b]),t:x.TVoid,p:a.expr.p}},checkVar:function(a,b,c,d){switch(a.v.kind._hx_index){case 3:if(!(b||(b=c.h[a.origin.id],null!=b&&b.v.kind==L.Input||!a.requireInit||null!=b&&0!=b.write)))throw t.thrown(new kb("Varying "+a.v.name+
" is not written by vertex shader",d));break;case 4:if(a.requireInit&&(null==a.origin.parent||"global"!=a.origin.parent.name&&!this.isBatchShader))throw t.thrown(new kb("Variable "+a.v.name+" is used without being initialized",d));}},mapVars:function(a){var b=a.e;switch(b._hx_index){case 1:var c=b.v;c=this.varMap.h[c.__id__];return null==c?a:{e:q.TVar(c),t:a.t,p:a.p};case 7:c=b.v;var d=b.init;c=this.varMap.h[c.__id__];return null==c?A.map(a,M(this,this.mapVars)):{e:q.TVarDecl(c,null==d?null:this.mapVars(d)),
t:a.t,p:a.p};case 13:return c=b.v,d=b.it,b=b.loop,c=this.varMap.h[c.__id__],null==c?A.map(a,M(this,this.mapVars)):{e:q.TFor(c,this.mapVars(d),this.mapVars(b)),t:a.t,p:a.p};default:return A.map(a,M(this,this.mapVars))}},get:function(a){var b=this.vars.h[a.id];if(null==b){b=this.varMap.h[a.__id__];if(null==b){if(a.kind==L.Global||a.kind==L.Output||a.kind==L.Input)b=a;else{b={id:A.allocVarId(),name:a.name,kind:a.kind,type:a.type};if(null!=a.qualifiers)for(var c=0,d=a.qualifiers;c<d.length;){var e=d[c];
++c;switch(e._hx_index){case 13:case 14:null==b.qualifiers&&(b.qualifiers=[]),b.qualifiers.push(e)}}this.uniqueName(b)}this.varMap.set(a,b)}b=new Kf(b);b.origin=a;this.vars.h[a.id]=b;this.avars.push(b)}return b},uniqueName:function(a){if(a.kind!=L.Global&&a.kind!=L.Output&&a.kind!=L.Input){var b=this.varNames.h[a.name];if(null!=b&&b!=a){for(b=a.name;48<=F.cca(b,b.length-1)&&57>=F.cca(b,b.length-1);)b=F.substr(b,0,-1);for(var c=b==a.name?2:y.parseInt(F.substr(a.name,b.length,null));Object.prototype.hasOwnProperty.call(this.varNames.h,
b+c);)++c;a.name=b+c}this.varNames.h[a.name]=a}},checkExpr:function(a){var b=this;var c=a.e;switch(c._hx_index){case 1:var d=c.v;d=this.get(d);0==d.write&&(d.requireInit=!0);d.read++;break;case 5:d=c.op;var e=c.e1;c=c.e2;switch(d._hx_index){case 4:var f=e.e;d=e.p;d=e.t;switch(f._hx_index){case 1:d=f.v;d=this.get(d);d.write++;this.checkExpr(c);break;case 9:d=f.e;f=d.e;1==f._hx_index?(d=f.v,d=this.get(d),d.write++,this.checkExpr(c)):A.iter(a,M(this,this.checkExpr));break;default:A.iter(a,M(this,this.checkExpr))}break;
case 20:f=d.op;d=e.e;f=e.p;f=e.t;switch(d._hx_index){case 1:d=d.v;d=this.get(d);0==d.write&&(d.requireInit=!0);d.read++;d.write++;this.checkExpr(c);break;case 9:e=d.e;f=d.regs;d=e.e;f=e.p;f=e.t;1==d._hx_index?(d=d.v,d=this.get(d),0==d.write&&(d.requireInit=!0),d.read++,d.write++,this.checkExpr(c)):A.iter(a,M(this,this.checkExpr));break;default:A.iter(a,M(this,this.checkExpr))}break;default:A.iter(a,M(this,this.checkExpr))}break;case 7:d=c.v;c=c.init;d=this.get(d);d.local=!0;null!=c&&(this.checkExpr(c),
d.write++);break;case 13:d=c.v;a=c.loop;this.checkExpr(c.it);d=this.get(d);d.local=!0;d.write++;this.checkExpr(a);break;case 22:d=c.target;d=c.code;a=c.args;var g=null,h=null;h=function(a){var c=a.e;if(1==c._hx_index)switch(a=b.get(c.v),g.access._hx_index){case 0:a.read--;break;case 1:a.write++;break;case 2:a.read--,a.write++}else A.iter(a,h)};c=0;for(d=a.length;c<d;)e=c++,g=a[e],h(g.e),this.checkExpr(g.e);break;default:A.iter(a,M(this,this.checkExpr))}},__class__:Mi};var Xi=function(){};Xi.__name__=
"js.html._CanvasElement.CanvasUtil";Xi.getContextWebGL=function(a,b){var c=a.getContext("webgl",b);if(null!=c)return c;c=a.getContext("experimental-webgl",b);return null!=c?c:null};var Zi=function(){};Zi.__name__="js.lib._ArrayBuffer.ArrayBufferCompat";Zi.sliceImpl=function(a,b){a=new Uint8Array(this,a,null==b?null:b-a);b=new Uint8Array(a.byteLength);b.set(a);return b.buffer};Math.__name__="Math";var Re=K["org.msgpack.DecodeOption"]={__ename__:!0,__constructs__:null,AsMap:{_hx_name:"AsMap",_hx_index:0,
__enum__:"org.msgpack.DecodeOption",toString:v},AsObject:{_hx_name:"AsObject",_hx_index:1,__enum__:"org.msgpack.DecodeOption",toString:v}};Re.__constructs__=[Re.AsMap,Re.AsObject];Re.__empty_constructs__=[Re.AsMap,Re.AsObject];var Vi=function(a,b){this.k=a;this.v=b};Vi.__name__="org.msgpack._Decoder.Pair";Vi.prototype={__class__:Vi};var th=function(a,b){a=new Vb(a);a.set_bigEndian(!0);this.o=this.decode(a,b)};th.__name__="org.msgpack.Decoder";th.prototype={decode:function(a,b){try{var c=a.readByte();
switch(c){case 192:break;case 194:return!1;case 195:return!0;case 196:return a.read(a.readByte());case 197:return a.read(a.readUInt16());case 198:return a.read(a.readInt32());case 202:return a.readFloat();case 203:return a.readDouble();case 204:return a.readByte();case 205:return a.readUInt16();case 206:return a.readInt32();case 207:throw t.thrown("UInt64 not supported");case 208:return a.readInt8();case 209:return a.readInt16();case 210:return a.readInt32();case 211:return this.readInt64(a);case 217:return a.readString(a.readByte());
case 218:return a.readString(a.readUInt16());case 219:return a.readString(a.readInt32());case 220:return this.readArray(a,a.readUInt16(),b);case 221:return this.readArray(a,a.readInt32(),b);case 222:return this.readMap(a,a.readUInt16(),b);case 223:return this.readMap(a,a.readInt32(),b);default:if(128>c)return c;if(144>c)return this.readMap(a,15&c,b);if(160>c)return this.readArray(a,15&c,b);if(192>c)return a.readString(31&c);if(223<c)return-256|c}}catch(d){if(!(t.caught(d).unwrap()instanceof dd))throw d;
}return null},readInt64:function(a){var b=a.readInt32();a=a.readInt32();return new Ug(b,a)},readArray:function(a,b,c){for(var d=[],e=0;e<b;)e++,d.push(this.decode(a,c));return d},readMap:function(a,b,c){var d;switch(c._hx_index){case 0:var e=[];for(d=0;d<b;){d++;var f=this.decode(a,c);var g=this.decode(a,c);e.push(new Vi(f,g))}if(0==e.length)return new Sa;d=da.typeof(e[0].k);switch(d._hx_index){case 1:var h=new Fa;for(b=0;b<e.length;){a=e[b];++b;if(1!=da.typeof(a.k)._hx_index)throw t.thrown("Error: Mixed key type when decoding IntMap");
if(h.h.hasOwnProperty(a.k))throw t.thrown("Error: Duplicate keys found => "+y.string(a.k));h.h[a.k]=a.v}return h;case 6:c=d.c;if("String"==c.__name__){h=new Sa;for(d=0;d<e.length;){a=e[d];++d;b=da.typeof(a.k);if(6==b._hx_index){if(c=b.c,"String"!=c.__name__)throw t.thrown("Error: Mixed key type when decoding StringMap");}else throw t.thrown("Error: Mixed key type when decoding StringMap");if(Object.prototype.hasOwnProperty.call(h.h,a.k))throw t.thrown("Error: Duplicate keys found => "+y.string(a.k));
h.h[a.k]=a.v}return h}throw t.thrown("Error: Unsupported key Type");default:throw t.thrown("Error: Unsupported key Type");}case 1:h={};for(d=0;d<b;)d++,f=this.decode(a,c),g=this.decode(a,c),h[y.string(f)]=g;return h}},getResult:function(){return this.o},__class__:th};var ne=function(a){this.o=new Yc;this.o.set_bigEndian(!0);this.encode(a)};ne.__name__="org.msgpack.Encoder";ne.prototype={encode:function(a){var b=da.typeof(a);switch(b._hx_index){case 0:this.o.writeByte(192);break;case 1:-32>a?-32768>
a?(this.o.writeByte(210),this.o.writeInt32(a)):-128>a?(this.o.writeByte(209),this.o.writeInt16(a)):(this.o.writeByte(208),this.o.writeInt8(a)):128>a?this.o.writeByte(a&255):256>a?(this.o.writeByte(204),this.o.writeByte(a)):65536>a?(this.o.writeByte(205),this.o.writeUInt16(a)):(this.o.writeByte(206),this.o.writeInt32(a));break;case 2:b=Math.abs(a);1.401298464324817E-45<b&&3.4028234663852886E38>b?(this.o.writeByte(202),this.o.writeFloat(a)):(this.o.writeByte(203),this.o.writeDouble(a));break;case 3:this.o.writeByte(a?
195:194);break;case 4:var c=sa.fields(a);var d=Te.count(c);16>d?this.o.writeByte(128|d):65536>d?(this.o.writeByte(222),this.o.writeUInt16(d)):(this.o.writeByte(223),this.o.writeInt32(d));for(d=0;d<c.length;)b=c[d],++d,this.encode(b),this.encode(sa.field(a,b));break;case 5:throw t.thrown("Error: Function not supported");case 6:b=b.c;switch(b.__name__){case "Array":d=a.length;16>d?this.o.writeByte(144|d):65536>d?(this.o.writeByte(220),this.o.writeUInt16(d)):(this.o.writeByte(221),this.o.writeInt32(d));
for(d=0;d<a.length;)b=a[d],++d,this.encode(b);break;case "String":d=a.length;32>d?this.o.writeByte(160|d):256>d?(this.o.writeByte(217),this.o.writeByte(d)):65536>d?(this.o.writeByte(218),this.o.writeUInt16(d)):(this.o.writeByte(219),this.o.writeInt32(d));this.o.writeString(a);break;case "haxe._Int64.___Int64":this.o.writeByte(211);this.o.writeInt32(a.high);this.o.writeInt32(a.low);break;case "haxe.ds.IntMap":case "haxe.ds.StringMap":case "haxe.ds.UnsafeStringMap":d=0;for(b=a.keys();b.hasNext();)b.next(),
++d;16>d?this.o.writeByte(128|d):65536>d?(this.o.writeByte(222),this.o.writeUInt16(d)):(this.o.writeByte(223),this.o.writeInt32(d));for(b=a.keys();b.hasNext();)d=b.next(),this.encode(d),this.encode(a.get(d));break;case "haxe.io.Bytes":d=a.length;256>d?(this.o.writeByte(196),this.o.writeByte(d)):65536>d?(this.o.writeByte(197),this.o.writeUInt16(d)):(this.o.writeByte(198),this.o.writeInt32(d));this.o.write(a);break;default:throw t.thrown("Error: "+b.__name__+" not supported");}break;case 7:throw t.thrown("Error: Enum not supported");
case 8:throw t.thrown("Error: Unknown Data Type");}},writeInt64:function(a){this.o.writeByte(211);this.o.writeInt32(a.high);this.o.writeInt32(a.low)},writeInt:function(a){-32>a?-32768>a?(this.o.writeByte(210),this.o.writeInt32(a)):-128>a?(this.o.writeByte(209),this.o.writeInt16(a)):(this.o.writeByte(208),this.o.writeInt8(a)):128>a?this.o.writeByte(a&255):256>a?(this.o.writeByte(204),this.o.writeByte(a)):65536>a?(this.o.writeByte(205),this.o.writeUInt16(a)):(this.o.writeByte(206),this.o.writeInt32(a))},
writeFloat:function(a){var b=Math.abs(a);1.401298464324817E-45<b&&3.4028234663852886E38>b?(this.o.writeByte(202),this.o.writeFloat(a)):(this.o.writeByte(203),this.o.writeDouble(a))},writeBinary:function(a){var b=a.length;256>b?(this.o.writeByte(196),this.o.writeByte(b)):65536>b?(this.o.writeByte(197),this.o.writeUInt16(b)):(this.o.writeByte(198),this.o.writeInt32(b));this.o.write(a)},writeString:function(a){var b=a.length;32>b?this.o.writeByte(160|b):256>b?(this.o.writeByte(217),this.o.writeByte(b)):
65536>b?(this.o.writeByte(218),this.o.writeUInt16(b)):(this.o.writeByte(219),this.o.writeInt32(b));this.o.writeString(a)},writeArray:function(a){var b=a.length;16>b?this.o.writeByte(144|b):65536>b?(this.o.writeByte(220),this.o.writeUInt16(b)):(this.o.writeByte(221),this.o.writeInt32(b));for(b=0;b<a.length;){var c=a[b];++b;this.encode(c)}},writeMapLength:function(a){16>a?this.o.writeByte(128|a):65536>a?(this.o.writeByte(222),this.o.writeUInt16(a)):(this.o.writeByte(223),this.o.writeInt32(a))},writeMap:function(a){var b=
0;for(var c=a.keys();c.hasNext();)c.next(),++b;16>b?this.o.writeByte(128|b):65536>b?(this.o.writeByte(222),this.o.writeUInt16(b)):(this.o.writeByte(223),this.o.writeInt32(b));for(c=a.keys();c.hasNext();)b=c.next(),this.encode(b),this.encode(a.get(b))},writeObject:function(a){var b=sa.fields(a),c=Te.count(b);16>c?this.o.writeByte(128|c):65536>c?(this.o.writeByte(222),this.o.writeUInt16(c)):(this.o.writeByte(223),this.o.writeInt32(c));for(c=0;c<b.length;){var d=b[c];++c;this.encode(d);this.encode(sa.field(a,
d))}},getBytes:function(){return this.o.getBytes()},__class__:ne};var Ac=K["packets.IncomingPackets"]={__ename__:!0,__constructs__:null,AddPlayer:(z=function(a){return{_hx_index:0,data:a,__enum__:"packets.IncomingPackets",toString:v}},z._hx_name="AddPlayer",z.__params__=["data"],z),AddBuilding:(z=function(a){return{_hx_index:1,data:a,__enum__:"packets.IncomingPackets",toString:v}},z._hx_name="AddBuilding",z.__params__=["data"],z),UpdatePlayers:(z=function(a){return{_hx_index:2,data:a,__enum__:"packets.IncomingPackets",
toString:v}},z._hx_name="UpdatePlayers",z.__params__=["data"],z),Ping:{_hx_name:"Ping",_hx_index:3,__enum__:"packets.IncomingPackets",toString:v}};Ac.__constructs__=[Ac.AddPlayer,Ac.AddBuilding,Ac.UpdatePlayers,Ac.Ping];Ac.__empty_constructs__=[Ac.Ping];var Vc=K["packets.OutgoingPackets"]={__ename__:!0,__constructs__:null,Spawn:{_hx_name:"Spawn",_hx_index:0,__enum__:"packets.OutgoingPackets",toString:v},ChatMessage:(z=function(a){return{_hx_index:1,data:a,__enum__:"packets.OutgoingPackets",toString:v}},
z._hx_name="ChatMessage",z.__params__=["data"],z),Aim:(z=function(a){return{_hx_index:2,data:a,__enum__:"packets.OutgoingPackets",toString:v}},z._hx_name="Aim",z.__params__=["data"],z),Move:(z=function(a){return{_hx_index:3,data:a,__enum__:"packets.OutgoingPackets",toString:v}},z._hx_name="Move",z.__params__=["data"],z),Ping:{_hx_name:"Ping",_hx_index:4,__enum__:"packets.OutgoingPackets",toString:v}};Vc.__constructs__=[Vc.Spawn,Vc.ChatMessage,Vc.Aim,Vc.Move,Vc.Ping];Vc.__empty_constructs__=[Vc.Spawn,
Vc.Ping];R.$haxeUID|=0;"undefined"!=typeof performance&&"function"==typeof performance.now&&(F.now=performance.now.bind(performance));null==String.fromCodePoint&&(String.fromCodePoint=function(a){return 65536>a?String.fromCharCode(a):String.fromCharCode((a>>10)+55232)+String.fromCharCode((a&1023)+56320)});Object.defineProperty(String.prototype,"__class__",{value:String,enumerable:!1,writable:!0});String.__name__="String";Array.__name__="Array";var jc={},hj={},ij=Number,gj=Boolean,jj={},kj={};yc.add(la.updateCursor,
-1);ka.__toStr={}.toString;null==ArrayBuffer.prototype.slice&&(ArrayBuffer.prototype.slice=Zi.sliceImpl);Mc.LN2=Math.log(2);Oa.V1=3;Oa.V2=2;Oa.V25=0;Oa.Reserved=1;Oa.V1_Bitrates=[[C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad],[C.BR_Free,C.BR_32,C.BR_40,C.BR_48,C.BR_56,C.BR_64,C.BR_80,C.BR_96,C.BR_112,C.BR_128,C.BR_160,C.BR_192,C.BR_224,C.BR_256,C.BR_320,C.BR_Bad],[C.BR_Free,C.BR_32,C.BR_48,C.BR_56,C.BR_64,
C.BR_80,C.BR_96,C.BR_112,C.BR_128,C.BR_160,C.BR_192,C.BR_224,C.BR_256,C.BR_320,C.BR_384,C.BR_Bad],[C.BR_Free,C.BR_32,C.BR_64,C.BR_96,C.BR_128,C.BR_160,C.BR_192,C.BR_224,C.BR_256,C.BR_288,C.BR_320,C.BR_352,C.BR_384,C.BR_416,C.BR_448,C.BR_Bad]];Oa.V2_Bitrates=[[C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad,C.BR_Bad],[C.BR_Free,C.BR_8,C.BR_16,C.BR_24,C.BR_32,C.BR_40,C.BR_48,C.BR_56,C.BR_64,C.BR_80,C.BR_96,C.BR_112,
C.BR_128,C.BR_144,C.BR_160,C.BR_Bad],[C.BR_Free,C.BR_8,C.BR_16,C.BR_24,C.BR_32,C.BR_40,C.BR_48,C.BR_56,C.BR_64,C.BR_80,C.BR_96,C.BR_112,C.BR_128,C.BR_144,C.BR_160,C.BR_Bad],[C.BR_Free,C.BR_32,C.BR_48,C.BR_56,C.BR_64,C.BR_80,C.BR_96,C.BR_112,C.BR_128,C.BR_144,C.BR_160,C.BR_176,C.BR_192,C.BR_224,C.BR_256,C.BR_Bad]];Oa.SamplingRates=[[ua.SR_11025,ua.SR_12000,ua.SR_8000,ua.SR_Bad],[ua.SR_Bad,ua.SR_Bad,ua.SR_Bad,ua.SR_Bad],[ua.SR_22050,ua.SR_24000,ua.SR_12000,ua.SR_Bad],[ua.SR_44100,ua.SR_48000,ua.SR_32000,
ua.SR_Bad]];Zc.LReserved=0;Zc.LLayer3=1;Zc.LLayer2=2;Zc.LLayer1=3;hf.CStereo=0;hf.CJointStereo=1;hf.CDualChannel=2;hf.CMono=3;jf.ENone=0;jf.EMs50_15=1;jf.EReserved=2;jf.ECCIT_J17=3;Pa.tmpPoint=new Da(0,0);Qa.STRICT=!0;Qf.BUFFERING=!1;Nc.tmp=new Nc;hc.GUID=0;ja.SOFTWARE_DRIVER=!1;ja.ANTIALIASING=0;ca.tmp=new ca;ca.lumR=.212671;ca.lumG=.71516;ca.lumB=.072169;ca.SQ13=.5773502691896257;Nb.IDENTITY_DECOMPOSED=Nb.L([1,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1]);Ec.EPSILON=1E-6;Sd.SLEEP_THRESHOLD=1E-4;Sd.MAX_THRESHOLD=
1E6;lc.TMP_RAY=new Mb;lc.TMP_MAT=new ca;Aa.ROT2RAD=-.017453292519943295;Aa.NO_VELOCITY=-1;Aa.VELOCITY=0;Aa.tmpMat=new ca;oa.UID=0;oa.ALLOW_WEBGL2=!0;oa.hasMultiIndirectCount=!1;oa.BLACK=function(a){var b=a=0,c=0,d=0;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new O(a,b,c,d)}(this);oa.outOfMemoryCheck=!1;oa.STREAM_POS=1;oa.TFILTERS=[[[9728,9728],[9729,9729]],[[9728,9984],[9729,9985]],[[9728,9986],[9729,9987]]];oa.TWRAP=[33071,10497];oa.FACES=[0,1028,1029,1032];oa.BLEND=[1,0,
770,768,772,774,771,769,773,775,32769,32771,32770,32772,776];oa.COMPARE=[519,512,514,517,516,518,513,515];oa.STENCIL_OP=[7680,0,7681,7682,34055,7683,34056,5386];oa.OP=[32774,32778,32779,32775,32776];oa.CUBE_FACES=[34069,34070,34071,34072,34073,34074];oa.CBUFFERS=function(a){a=[];for(var b=0;32>b;){for(var c=[],d=0,e=b++;d<e;){var f=d++;c.push(36064+f)}a.push(c)}return a}(this);lf.MAX_MEMORY=4294967296;lf.SIZE=65532;lf.ALL_FLAGS=Ja.__empty_constructs__.slice();rc.checkFlags=-1;Ad.defaultKillAlphaThreshold=
.5;Ad.loadingTextureColor=-65281;Ld.current=new Ld("Default");ba.enableLights_bits=1;ba.enableLights_offset=0;ba.enableLights_mask=1;ba.dynamicParameters_bits=1;ba.dynamicParameters_offset=1;ba.dynamicParameters_mask=2;ba.isStatic_bits=1;ba.isStatic_offset=2;ba.isStatic_mask=4;ba.batchMode_bits=1;ba.batchMode_offset=3;ba.batchMode_mask=8;ba.culling_bits=2;ba.culling_offset=0;ba.culling_mask=3;ba.depthWrite_bits=1;ba.depthWrite_offset=2;ba.depthWrite_mask=4;ba.depthTest_bits=3;ba.depthTest_offset=
3;ba.depthTest_mask=56;ba.blendSrc_bits=4;ba.blendSrc_offset=6;ba.blendSrc_mask=960;ba.blendDst_bits=4;ba.blendDst_offset=10;ba.blendDst_mask=15360;ba.blendAlphaSrc_bits=4;ba.blendAlphaSrc_offset=14;ba.blendAlphaSrc_mask=245760;ba.blendAlphaDst_bits=4;ba.blendAlphaDst_offset=18;ba.blendAlphaDst_mask=3932160;ba.blendOp_bits=3;ba.blendOp_offset=22;ba.blendOp_mask=29360128;ba.blendAlphaOp_bits=3;ba.blendAlphaOp_offset=25;ba.blendAlphaOp_mask=234881024;ba.wireframe_bits=1;ba.wireframe_offset=28;ba.wireframe_mask=
268435456;ba.culled_bits=1;ba.culled_offset=29;ba.culled_mask=536870912;ba.reserved_bits=1;ba.reserved_offset=30;ba.reserved_mask=1073741824;pa.readMask_bits=8;pa.readMask_offset=0;pa.readMask_mask=255;pa.writeMask_bits=8;pa.writeMask_offset=8;pa.writeMask_mask=65280;pa.reference_bits=8;pa.reference_offset=16;pa.reference_mask=16711680;pa.frontTest_bits=3;pa.frontTest_offset=0;pa.frontTest_mask=7;pa.frontPass_bits=3;pa.frontPass_offset=3;pa.frontPass_mask=56;pa.frontSTfail_bits=3;pa.frontSTfail_offset=
6;pa.frontSTfail_mask=448;pa.frontDPfail_bits=3;pa.frontDPfail_offset=9;pa.frontDPfail_mask=3584;pa.backTest_bits=3;pa.backTest_offset=12;pa.backTest_mask=28672;pa.backPass_bits=3;pa.backPass_offset=15;pa.backPass_mask=229376;pa.backSTfail_bits=3;pa.backSTfail_offset=18;pa.backSTfail_mask=1835008;pa.backDPfail_bits=3;pa.backDPfail_offset=21;pa.backDPfail_mask=14680064;W.UID=0;W.PREVENT_AUTO_DISPOSE=2147483647;W.PREVENT_FORCED_DISPOSE=-1;W.nativeFormat=J.RGBA;W.TRILINEAR_FILTERING_ENABLED=!0;W.DEFAULT_WRAP=
Qd.Clamp;W.checkerTextureKeys=new Fa;W.noiseTextureKeys=new Fa;W.genTextureKeys=new Sa;$f.__meta__={obj:{ignore:["shader"]}};fb.SRC="HXSMF2gzZC5zaGFkZXIuU2NyZWVuU2hhZGVyBwEFaW5wdXQNAQICCHBvc2l0aW9uBQoBAQADAnV2BQoBAQABAAAEBWZsaXBZAwIAAAUGb3V0cHV0DQICBghwb3NpdGlvbgUMBAUABwVjb2xvcgUMBAUABAAACApwaXhlbENvbG9yBQwEAAAJDGNhbGN1bGF0ZWRVVgUKBAAACghfX2luaXRfXw4GAAALBnZlcnRleA4GAAACAgoAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAALAAAFAQYEAgYFDAkDKw4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAA";
fb._MODULE="h3d.shader.ScreenShader";Ce.SRC="HXSMHWgzZC5wYXNzLl9Cb3JkZXIuQm9yZGVyU2hhZGVyCQEFaW5wdXQNAQICCHBvc2l0aW9uBQoBAQADAnV2BQoBAQABAAAEBWZsaXBZAwIAAAUGb3V0cHV0DQICBghwb3NpdGlvbgUMBAUABwVjb2xvcgUMBAUABAAACApwaXhlbENvbG9yBQwEAAAJDGNhbGN1bGF0ZWRVVgUKBAAACgVjb2xvcgUMAgAACwhfX2luaXRfXw4GAAAMBnZlcnRleA4GAAANCGZyYWdtZW50DgYAAAMCCwAABQIGBAIHBQwCCAUMBQwGBAIJBQoCAwUKBQoAAAwAAAUBBgQCBgUMCQMrDgQKAgIFCgAAAwYBCgICBQoEAAMCBAMDAQMAAAAAAAAAAAMBAwAAAAAAAPA/AwUMBQwAAQ0AAAUBBgQCCAUMAgoFDAUMAA";Ce._MODULE="h3d.pass.Border";
cf.SRC="HXSMHmgzZC5wYXNzLl9Db3B5LkFycmF5Q29weVNoYWRlcgoBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoHdGV4dHVyZQoDAgAACwVsYXllcgECAAAMCF9faW5pdF9fDgYAAA0GdmVydGV4DgYAAA4IZnJhZ21lbnQOBgAAAwIMAAAFAgYEAgcFDAIIBQwFDAYEAgkFCgIDBQoFCgAADQAABQEGBAIGBQwJAysOBAoCAgUKAAADBgEKAgIFCgQAAwIEAwMBAwAAAAAAAAAAAwEDAAAAAAAA8D8DBQwFDAABDgAABQEGBAIIBQwJAyIOAgIKCgMJAyoOAgIJBQoJAycOAQILAQMFCwUMBQwA";
cf._MODULE="h3d.pass.Copy";De.SRC="HXSMGWgzZC5wYXNzLl9Db3B5LkNvcHlTaGFkZXIJAQVpbnB1dA0BAgIIcG9zaXRpb24FCgEBAAMCdXYFCgEBAAEAAAQFZmxpcFkDAgAABQZvdXRwdXQNAgIGCHBvc2l0aW9uBQwEBQAHBWNvbG9yBQwEBQAEAAAICnBpeGVsQ29sb3IFDAQAAAkMY2FsY3VsYXRlZFVWBQoEAAAKB3RleHR1cmUKAgIAAAsIX19pbml0X18OBgAADAZ2ZXJ0ZXgOBgAADQhmcmFnbWVudA4GAAADAgsAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAAMAAAFAQYEAgYFDAkDKw4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAAENAAAFAQYEAggFDAkDIg4CAgoKAgIJBQoFDAUMAA";De._MODULE="h3d.pass.Copy";
df.SRC="HXSMIWgzZC5wYXNzLl9DdWJlQ29weS5DdWJlQ29weVNoYWRlcgoBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoHdGV4dHVyZQoGAgAACwNtYXQGAgAADAhfX2luaXRfXw4GAAANBnZlcnRleA4GAAAOCGZyYWdtZW50DgYAAAMCDAAABQIGBAIHBQwCCAUMBQwGBAIJBQoCAwUKBQoAAA0AAAUBBgQCBgUMCQMrDgQKAgIFCgAAAwYBCgICBQoEAAMCBAMDAQMAAAAAAAAAAAMBAwAAAAAAAPA/AwUMBQwAAQ4AAAUCCA8CdXYFCgQAAAYDBgECCQUKAQMAAAAAAAAAQAMFCgEDAAAAAAAA8D8DBQoABgQCCAUMCQMiDgICCgoGCQMgDgEGAQkDKg4CAg8FCgEDAAAAAAAA8D8DBQsCCwYFCwULBQwFDAA";
df._MODULE="h3d.pass.CubeCopy";nb.db=new Sa;nb.FILE_NAME="model.props";nb.LOD_CONFIG="lodConfig";nb.DYN_BONES_CONFIG="dynamicBones";nb.defaultLodConfigs=new Sa;nb.baseLodConfig=[.5,.2,.01];nb.current=new nb;Ra.tmpMat=new ca;dg.__meta__={fields:{cameraView:{global:["camera.view"]},cameraNear:{global:["camera.zNear"]},cameraFar:{global:["camera.zFar"]},cameraProj:{global:["camera.proj"]},cameraPos:{global:["camera.position"]},cameraProjDiag:{global:["camera.projDiag"]},cameraProjFlip:{global:["camera.projFlip"]},
cameraViewProj:{global:["camera.viewProj"]},cameraInverseViewProj:{global:["camera.inverseViewProj"]},cameraPreviousViewProj:{global:["camera.previousViewProj"]},cameraJitterOffsets:{global:["camera.jitterOffsets"]},globalTime:{global:["global.time"]},pixelSize:{global:["global.pixelSize"]},globalModelView:{global:["global.modelView"]},globalModelViewInverse:{global:["global.modelViewInverse"]},globalPreviousModelView:{global:["global.previousModelView"]}}};qa.newWorldPos=function(a){var b=a=0,c=
0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)}(this);qa.expectedPos=function(a){var b=a=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)}(this);qa.tmpVec=function(a){var b=a=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)}(this);qa.tmpVec2=function(a){var b=a=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new G(a,b,c)}(this);qa.tmpQ=new Dc;Jb.TMP_MAT=new ca;Ge.SRC="HXSMF2gzZC5zaGFkZXIuQW1iaWVudExpZ2h0CgEGZ2xvYmFsDQECAgxhbWJpZW50TGlnaHQFCwABAAMQcGVyUGl4ZWxMaWdodGluZwIAAQEAAAAAAAAAAAQKcGl4ZWxDb2xvcgUMBAAABQ9saWdodFBpeGVsQ29sb3IFCwQAAAYKbGlnaHRDb2xvcgULBAAABwhhZGRpdGl2ZQICAAEAAAAAAAgIX19pbml0X18OBgAACRBfX2luaXRfX2ZyYWdtZW50DgYAAAoJY2FsY0xpZ2h0DgYAAAsGdmVydGV4DgYAAAwIZnJhZ21lbnQOBgAABQIIAAAFAQYEAgYFCwsCBwICAgULCQMqDgEBAwAAAAAAAAAAAwULBQsFCwACCQAABQEGBAIFBQsLAgcCAgIFCwkDKg4BAQMAAAAAAAAAAAMFCwULBQsAAwoBDQpsaWdodENvbG9yBQsEAAAFCwUBDQsCBwICDQULBAYAAgIFCwYBCQMWDgIEBgMBAwAAAAAAAPA/AwICBQsFCwULAQMAAAAAAAAAAAMFCwINBQsFCwULBQsFCwAAAAsAAAUBCwcCAgMCAgaBCgIEBQySAAULCQIKDgECBgULBQsFCwAAAAEMAAAFAQsCAwIGgQoCBAUMkgAFCwkCCg4BAgUFCwULBQsAAAA";
Ge._MODULE="h3d.shader.AmbientLight";kf.SRC="HXSMEWgzZC5zaGFkZXIuQmFzZTJkGwEFaW5wdXQNAQMCCHBvc2l0aW9uBQoBAQADAnV2BQoBAQAEBWNvbG9yBQwBAQABAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgEdGltZQMAAAAJBnpWYWx1ZQMCAAAKB3RleHR1cmUKAgIAAAsOc3ByaXRlUG9zaXRpb24FDAQAAAwQYWJzb2x1dGVQb3NpdGlvbgUMBAAADQpwaXhlbENvbG9yBQwEAAAODHRleHR1cmVDb2xvcgUMBAAADwxjYWxjdWxhdGVkVVYFCgMAABAKaXNSZWxhdGl2ZQICAAEAAAAAABEFY29sb3IFDAIAABIPYWJzb2x1dGVNYXRyaXhBBQsCAAATD2Fic29sdXRlTWF0cml4QgULAgAAFA1maWx0ZXJNYXRyaXhBBQsCAAAVDWZpbHRlck1hdHJpeEIFCwIAABYIaGFzVVZQb3MCAgABAAAAAAAXBXV2UG9zBQwCAAAYCWtpbGxBbHBoYQICAAEAAAAAABkKcGl4ZWxBbGlnbgICAAEAAAAAABoQaGFsZlBpeGVsSW52ZXJzZQUKAgAAGwl2aWV3cG9ydEEFCwIAABwJdmlld3BvcnRCBQsCAAAdDm91dHB1dFBvc2l0aW9uBQwEAAAeCF9faW5pdF9fDgYAAB8GdmVydGV4DgYAACAIZnJhZ21lbnQOBgAAAwIeAAAFBgYEAgsFDAkDKw4DAgIFCgIJAwEDAAAAAAAA8D8DBQwFDAsCEAIFAwYECgIMBQwAAAMJAx4OAgkDKg4CCgILBQwRAAUKAQMAAAAAAADwPwMFCwISBQsDAwYECgIMBQwEAAMJAx4OAgkDKg4CCgILBQwRAAUKAQMAAAAAAADwPwMFCwITBQsDAwYECgIMBQw5AAUKCgILBQw5AAUKBQoABgQCDAUMAgsFDAUMAAYEAg8FCgsCFgIGAAYBAgMFCgoCFwUMOQAFCgUKCgIXBQwRAAUKBQoCAwUKBQoFCgYEAg0FDAsCEAIGAQIRBQwCBAUMBQwCBAUMBQwFDAYEAg4FDAkDIg4CAgoKAgIPBQoFDAUMBoECDQUMAg4FDAUMAAAfAAAFBQghA3RtcAULBAAACQMqDgIKAgwFDBEABQoBAwAAAAAAAPA/AwULAAYEAiEFCwkDKg4DCQMeDgICIQULAhQFCwMJAx4OAgIhBQsCFQULAwEDAAAAAAAA8D8DBQsFCwYEAh0FDAkDKw4DCQMeDgICIQULAhsFCwMJAx4OAgIhBQsCHAULAwoCDAUMOQAFCgUMBQwLAhkCBoMKAh0FDBEABQoCGgUKBQoAAAYEAgYFDAIdBQwFDAABIAAABQILBg4CGAIGCQoCDQUMDAADAQP8qfHSTWJQPwMCAgwAAAAGBAIHBQwCDQUMBQwA";
kf._MODULE="h3d.shader.Base2d";ze.SRC="HXSME2gzZC5zaGFkZXIuQmFzZU1lc2gcAQZjYW1lcmENAQwCBHZpZXcHAAEAAwRwcm9qBwABAAQIcG9zaXRpb24FCwABAAUIcHJvakZsaXADAAEABghwcm9qRGlhZwULAAEABwh2aWV3UHJvagcAAQAIEHByZXZpb3VzVmlld1Byb2oHAAEACQ9pbnZlcnNlVmlld1Byb2oHAAEACgV6TmVhcgMAAQALBHpGYXIDAAEADANkaXIFCwMBAA0Naml0dGVyT2Zmc2V0cwUMAAEAAAAADgZnbG9iYWwNAgUPBHRpbWUDAA4AEAlwaXhlbFNpemUFCgAOABEJbW9kZWxWaWV3BwAOAQMSEG1vZGVsVmlld0ludmVyc2UHAA4BAxMRcHJldmlvdXNNb2RlbFZpZXcHAA4BAwAAABQFaW5wdXQNAwIVCHBvc2l0aW9uBQsBFAAWBm5vcm1hbAULARQAAQAAFwZvdXRwdXQNBAYYCHBvc2l0aW9uBQwEFwAZBWNvbG9yBQwEFwAaBWRlcHRoAwQXABsGbm9ybWFsBQsEFwAcCXdvcmxkRGlzdAMEFwAdCHZlbG9jaXR5BQoEFwAEAAAeEHJlbGF0aXZlUG9zaXRpb24FCwQAAB8TdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAIBtwcmV2aW91c1RyYW5zZm9ybWVkUG9zaXRpb24FCwQAACEYcGl4ZWxUcmFuc2Zvcm1lZFBvc2l0aW9uBQsEAAAiEXRyYW5zZm9ybWVkTm9ybWFsBQsEAAAjEXByb2plY3RlZFBvc2l0aW9uBQwEAAAkGXByZXZpb3VzUHJvamVjdGVkUG9zaXRpb24FDAQAACUKcGl4ZWxDb2xvcgUMBAAAJgVkZXB0aAMEAAAnC25kY1Bvc2l0aW9uBQoEAAAoE3ByZXZpb3VzTmRjUG9zaXRpb24FCgQAACkIc2NyZWVuVVYFCgQAACoJc3BlY1Bvd2VyAwQAACsJc3BlY0NvbG9yBQsEAAAsCXdvcmxkRGlzdAMEAAAtDXBpeGVsVmVsb2NpdHkFCgQAAC4FY29sb3IFDAIAAC8Nc3BlY3VsYXJQb3dlcgMCAAEHAAAAAAAAAAAAAAAAAABZQDAOc3BlY3VsYXJBbW91bnQDAgABBwAAAAAAAAAAAAAAAAAAJEAxDXNwZWN1bGFyQ29sb3IFCwIAADIIX19pbml0X18OBgAAMxBfX2luaXRfX2ZyYWdtZW50DgYAADQGdmVydGV4DgYAADUIZnJhZ21lbnQOBgAABAIyAAAFDQYEAh4FCwIVBQsFCwYEAh8FCwYBAh4FCwkDNQ4BAhEHCAULBQsGBAIjBQwGAQkDKw4CAh8FCwEDAAAAAAAA8D8DBQwCBwcFDAUMBgQCIAULBgECHgULCQM1DgECEwcIBQsFCwYEAiQFDAYBCQMrDgICIAULAQMAAAAAAADwPwMFDAIIBwUMBQwGBAIiBQsJAyAOAQQGAQIWBQsJAzMOAQIRBwYFCwULBQsFCwYEAgwFCwkDIA4BBAYDAgQFCwIfBQsFCwULBQsFCwYEAiUFDAIuBQwFDAYEAioDAi8DAwYEAisFCwYBAjEFCwIwAwULBQsGBAIpBQoJAzsOAQYCCgIjBQwRAAUKCgIjBQwMAAMFCgUKBQoGBAImAwYCCgIjBQwIAAMKAiMFDAwAAwMDBgQCLAMGAgkDHA4BBgMCHwULAgQFCwULAwILAwMDAAIzAAAFCgYEAiIFCwkDIA4BAiIFCwULBQsGBAInBQoGAgoCIwUMEQAFCgoCIwUMDAADBQoFCgYEAigFCgYCCgIkBQwRAAUKCgIkBQwMAAMFCgUKBgQCKQUKCQM7DgECJwUKBQoFCgYEAiYDBgIKAiMFDAgAAwoCIwUMDAADAwMGBAIqAwIvAwMGBAIrBQsGAQIxBQsCMAMFCwULBoMCJwUKCgINBQwRAAUKBQoGgwIoBQoKAg0FDDkABQoFCgYEAi0FCgYBBAYDAigFCgInBQoFCgUKCQMpDgIBAwAAAAAAAOA/AwEDAAAAAAAA4L8DBQoFCgUKAAA0AAAFAgYEAhgFDAYBAiMFDAkDKw4EAQMAAAAAAADwPwMCBQMBAwAAAAAAAPA/AwEDAAAAAAAA8D8DBQwFDAUMBgQCIQULAh8FCwULAAE1AAAFBQYEAhkFDAIlBQwFDAYEAhoDAiYDAwYEAhsFCwIiBQsFCwYEAhwDAiwDAwYEAh0FCgItBQoFCgA";
ze._MODULE="h3d.shader.BaseMesh";Dd.SRC="HXSMD2gzZC5zaGFkZXIuQmx1chsBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoLaW52ZXJzZVByb2oHAgAACwd0ZXh0dXJlCgICAAAMDGRlcHRoVGV4dHVyZQoCAgAADQdRdWFsaXR5AQIAAQAAAAAADgdpc0RlcHRoAgIAAQAAAAAADwZ2YWx1ZXMPAw0CAAAQB29mZnNldHMPAw0CAAARBXBpeGVsBQoCAAASDWhhc0ZpeGVkQ29sb3ICAgABAAAAAAATEHNtb290aEZpeGVkQ29sb3ICAgABAAAAAAAUCmZpeGVkQ29sb3IFDAIAABUQaXNEZXB0aERlcGVuZGFudAICAAEAAAAAABYOZGVwdGhUaHJlc2hvbGQDAgAAFxVkZXB0aFRocmVzaG9sZE1heERpc3QDAgAAGAZpc0N1YmUCAgABAAAAAAAZC2N1YmVUZXh0dXJlCgYCAAAaB2N1YmVEaXIGAgAAGwhfX2luaXRfXw4GAAAcBnZlcnRleA4GAAAdDnNjYWxlVGhyZXNob2xkDgYAAB4IZnJhZ21lbnQOBgAAHw9nZXRWaWV3UG9zaXRpb24OBgAABQIbAAAFAgYEAgcFDAIIBQwFDAYEAgkFCgIDBQoFCgAAHAAABQEGBAIGBQwJAysOBAoCAgUKAAADBgEKAgIFCgQAAwIEAwMBAwAAAAAAAAAAAwEDAAAAAAAA8D8DBQwFDAADHQEgAXoDBAAAAwUDCCEBdAMEAAACFgMACwYHAhcDAQMAAAAAAAAAAAMCBoECIQMGAAEDAAAAAAAA8D8DCQMWDgIGAwIgAwIXAwMBAwAAAAAAAAAAAwMDAwAADQIhAwAAAR4AAAUCCwIVAgUMCCIKZGltZW5zaW9ucwUKBAAACQMlDgECCwoCBQoACCMNaW52RGltZW5zaW9ucwUKBAAABgIBAwAAAAAAAPA/AwIiBQoFCgAIJAVjb29yZAUKBAAACgNHBQwRAAUKAAglBmZyYWdVVgUKBAAABgEKAiQFChEABQoCIwUKBQoACCYBcAULBAAACQIfDgECJQUKBQsACCcEbWluWgMEAAAKAiYFCwgAAwAIKAFjBQwEAAAJAyIOAgILCgICJQUKBQwACCkFY29sb3IFDAQAAAkDKw4EAQMAAAAAAAAAAAMBAwAAAAAAAAAAAwEDAAAAAAAAAAADAQMAAAAAAAAAAAMFDAAIKgZpc0VkZ2UCBAAAAQEAAgAVBnVucm9sbAAOKwFpAQQAAAYVBwMCDQEBBgACDQEBAgEAAAABAQ8BAAAFBQgsCGN1ckNvb3JkBQoEAAAGAAkDEQ4BBgACJAUKBgEGAQQGAQIRBQoCIgUKBQoFCgkDKQ4BAQMAAAAAAADwPwMFCgUKCQMnDgECKwEDBQoFCgUKCQMpDgEBAwAAAAAAAOA/AwUKBQoACC0JbmVhcmVzdFVWBQoEAAAGAQIsBQoCIwUKBQoACC4EcGN1cgULBAAACQIfDgECLQUKBQsACC8BZAMEAAAJAw8OAQYDCgIuBQsIAAMKAiYFCwgAAwMDAAYEAioCBg8CKgIEBgcCLwMJAh0OAQkDFQ4CCgIuBQsIAAMKAiYFCwgAAwMDAgICAgAAABUGdW5yb2xsAA4wAWkBBAAABhUGAAcDAg0BAQECAQAAAAEBAg0BDwEAAAUICDEIY3VyQ29vcmQFCgQAAAYACQMRDgEGAAIkBQoGAQYBBAYBAhEFCgIiBQoFCgUKEQIQDwMNCwYJAjABAQIAAAAAAQIHAwIwAQECMAEBAwUKCQMnDgECMAEDBQoFCgUKCQMpDgEBAwAAAAAAAOA/AwUKBQoACDIJbmVhcmVzdFVWBQoEAAAGAQIxBQoCIwUKBQoACDMCdXYFCgQAAAYAAiUFCgYBBgECEQUKEQIQDwMNCwYJAjABAQIAAAAAAQIHAwIwAQECMAEBAwUKCQMnDgECMAEDBQoFCgAINARjY3VyBQwEAAAJAyIOAgILCgILBAIqAgICMgUKAjMFCgUKBQwACDUEcGN1cgULBAAACQIfDgECMgUKBQsACDYBZAMEAAAJAw8OAQYDCgI1BQsIAAMKAiYFCwgAAwMDAAYEAigFDAsEBgcCNgMJAh0OAQkDFQ4CCgI1BQsIAAMKAiYFCwgAAwMDAgICKAUMAjQFDAUMBQwGgAIpBQwGAQIoBQwRAg8PAw0LBgkCMAEBAgAAAAABAgcDAjABAQIwAQEDBQwFDAAAAAYEAggFDAIpBQwFDAALAg4CBQMINwN2YWwDBAAAAQMAAAAAAAAAAAMAFQZ1bnJvbGwADjgBaQEEAAAGFQYABwMCDQEBAQIBAAAAAQECDQEPAQAABQELAhgCBoACNwMGAQkDOA4BCQMiDgICGQoGBgEJAyoOAgYDBgEEBgACAwUKBgEGAQIRBQoRAhAPAw0LBgkCOAEBAgAAAAABAgcDAjgBAQI4AQEDBQoJAycOAQI4AQMFCgUKBQoBAwAAAAAAAABAAwUKAQMAAAAAAADwPwMFCgEDAAAAAAAA8D8DBQsCGgYFCwUMAxECDw8DDQsGCQI4AQECAAAAAAECBwMCOAEBAjgBAQMDAwaAAjcDBgEJAzgOAQkDIg4CAgsKAgYAAgMFCgYBBgECEQUKEQIQDwMNCwYJAjgBAQIAAAAAAQIHAwI4AQECOAEBAwUKCQMnDgECOAEDBQoFCgUMAxECDw8DDQsGCQI4AQECAAAAAAECBwMCOAEBAjgBAQMDAwAAAAAGBAIIBQwJAzcOAQkDFQ4CAjcDAQPLGlDK///vPwMDBQwFDAAFAwg5BWNvbG9yBQwEAAAJAysOBAEDAAAAAAAAAAADAQMAAAAAAAAAAAMBAwAAAAAAAAAAAwEDAAAAAAAAAAADBQwAFQZ1bnJvbGwADjoBaQEEAAAGFQYABwMCDQEBAQIBAAAAAQECDQEPAQAABQELAhgCBoACOQUMBgEJAyIOAgIZCgYGAQkDKg4CBgMGAQQGAAIDBQoGAQYBAhEFChECEA8DDQsGCQI6AQECAAAAAAECBwMCOgEBAjoBAQMFCgkDJw4BAjoBAwUKBQoFCgEDAAAAAAAAAEADBQoBAwAAAAAAAPA/AwUKAQMAAAAAAADwPwMFCwIaBgULBQwRAg8PAw0LBgkCOgEBAgAAAAABAgcDAjoBAQI6AQEDBQwFDAaAAjkFDAYBCQMiDgICCwoCBgACAwUKBgEGAQIRBQoRAhAPAw0LBgkCOgEBAgAAAAABAgcDAjoBAQI6AQEDBQoJAycOAQI6AQMFCgUKBQwRAg8PAw0LBgkCOgEBAgAAAAABAgcDAjoBAQI6AQEDBQwFDAAAAAAGBAIIBQwCOQUMBQwAAAALAhICBQILAhMCBoEKAggFDAwAAwoCFAUMDAADAwYECgIIBQwMAAMGAQoCFAUMDAADCQMnDgEGBwoCCAUMDAADAQMAAAAAAAAAAAMCAwMDAAYECgIIBQySAAULBgEKAhQFDJIABQsKAggFDAwAAwULBQsAAAAAAx8BOwJ1dgUKBAAABQsFBAg8BWRlcHRoAwQAAAoJAyIOAgIMCgICOwUKBQwAAAMACD0EdGVtcAUMBAAABgEJAysOAwkDPA4BAjsFCgUKAjwDAQMAAAAAAADwPwMFDAIKBwUMAAg+CG9yaWdpbldTBQsEAAAGAgoCPQUMkgAFCwoCPQUMDAADBQsADQI+BQsAAA";
Dd._MODULE="h3d.shader.Blur";Pd.SRC="HXSME2gzZC5zaGFkZXIuQ29sb3JBZGQDAQpwaXhlbENvbG9yBQwEAAACBWNvbG9yBQsCAAADCGZyYWdtZW50DgYAAAEBAwAABQEGgAoCAQUMkgAFCwICBQsFCwA";Pd._MODULE="h3d.shader.ColorAdd";ce.SRC="HXSME2gzZC5zaGFkZXIuQ29sb3JLZXkDAQhjb2xvcktleQUMAgAAAgx0ZXh0dXJlQ29sb3IFDAQAAAMIZnJhZ21lbnQOBgAAAQEDAAAFAggEBWNkaWZmBQwEAAAGAwICBQwCAQUMBQwACwYJCQMeDgICBAUMAgQFDAMBA/Fo44i1+OQ+AwIMAAAAAA";ce._MODULE="h3d.shader.ColorKey";de.SRC="HXSMFmgzZC5zaGFkZXIuQ29sb3JNYXRyaXgEAQpwaXhlbENvbG9yBQwEAAACBm1hdHJpeAcCAAADB2VuYWJsZWQCAgABAAAAAAAECGZyYWdtZW50DgYAAAEBBAAABQELAgMCBgQCAQUMCQMrDgIKBAYBCQMrDgIKAgEFDJIABQsBAwAAAAAAAPA/AwUMAgIHBQwFDJIABQsKBAYBAgEFDAICBwUMBQwMAAMFDAUMAAAA";
de._MODULE="h3d.shader.ColorMatrix";Ee.SRC="HXSMFGgzZC5zaGFkZXIuRGlyU2hhZG93EAEGZW5hYmxlAgIAAQAAAAAAAgdVU0VfRVNNAgIAAQAAAAAAAwtzaGFkb3dQb3dlcgMCAAAEB1VTRV9QQ0YCAgABAAAAAAAFC1BDRl9TQU1QTEVTAQIAAQAAAAAABghwY2ZTY2FsZQMCAAAHCXNoYWRvd1JlcwUKAgAACAlzaGFkb3dNYXARAQIAAAkKc2hhZG93UHJvaggCAAAKCnNoYWRvd0JpYXMDAgAACxN0cmFuc2Zvcm1lZFBvc2l0aW9uBQsEAAAMBnNoYWRvdwMEAAANCWRpclNoYWRvdwMEAAAOC3BvaXNzb25EaXNrDwUMBQIAAA8EcmFuZA4GAAAQCGZyYWdtZW50DgYAAAIDDwERAXYDBAAAAwUCCBICZHADBAAACQMeDgIJAysOAQIRAwUMCQMrDgQBA18pyxDH+ilAAwED9P3UeOmOU0ADAQOiRbbz/ZRGQAMBA1CNl24Sq1dAAwUMAwANCQMTDgEGAQkDAg4BAhIDAwEDUPwYc9Fd5UADAwMAAAEQAAAFAgsCAQIFAQsCBAIFCwYEAgwDAQMAAAAAAADwPwMDCBMJdGV4ZWxTaXplBQoEAAAGAgEDAAAAAAAA8D8DAgcFCgUKAAgUCXNoYWRvd1BvcwULBAAABgECCwULAgkIBQsACBUIc2hhZG93VXYFCgQAAAkDOw4BCgIUBQsRAAUKBQoACBYEek1heAMEAAAJAzYOAQoCFAULCAADAwAIFwNyb3QDBAAABgEGAQkCDw4BBgAGAAoCCwULAAADCgILBQsEAAMDCgILBQsIAAMDAwEDH4XrUbgeCUADAwEDAAAAAAAAAEADAwAIGARjb3NSAwQAAAkDAw4BAhcDAwAIGQRzaW5SAwQAAAkDAg4BAhcDAwAIGg5zYW1wbGVTdHJlbmd0aAMEAAAGAgEDAAAAAAAA8D8DCQMnDgECBQEDAwAIGwhvZmZTY2FsZQUKBAAABgECEwUKAgYDBQoADhwBaQEEAAAGFQECAAAAAAECBQEPAQAABQQIHQZvZmZzZXQFCgQAAAYBChECDg8FDAUCHAEFDBEABQoCGwUKBQoABgQCHQUKCQMpDgIGAwYBAhgDCgIdBQoAAAMDBgECGQMKAh0FCgQAAwMDBgAGAQIYAwoCHQUKBAADAwYBAhkDCgIdBQoAAAMDAwUKBQoIHgVkZXB0aAMEAAAJA0EOAwIIEQEGAAIVBQoCHQUKBQoBAwAAAAAAAAAAAwMABoMCDAMLBAYHBgMCFgMCCgMDAh4DAgICGgMBAwAAAAAAAAAAAwMDAAAACwICAgUFCB8Jc2hhZG93UG9zBQsEAAAGAQILBQsCCQgFCwAIIAVkZXB0aAMEAAAJA0AOAgIIEQEJAzsOAQoCHwULEQAFCgUKAwAIIQR6TWF4AwQAAAkDNg4BCgIfBQsIAAMDAAgiBWRlbHRhAwQAAAYDCQMVDgIEBgACIAMCCgMDAwIhAwMCIQMDAAYEAgwDCQM2DgEJAwkOAQYBAgMDAiIDAwMDAwAFBAgjCXNoYWRvd1BvcwULBAAABgECCwULAgkIBQsACCQIc2hhZG93VXYFCgQAAAkDOw4BCgIjBQsRAAUKBQoACCUFZGVwdGgDBAAACQNADgICCBEBCgIkBQoRAAUKAwAGBAIMAwsGBwYDCQM2DgEKAiMFCwgAAwMCCgMDAiUDAgEDAAAAAAAAAAADAQMAAAAAAADwPwMDAwAAAAAAAAYEAg0DAgwDAwA";
Ee._MODULE="h3d.shader.DirShadow";bf.SRC="HXSMFWgzZC5zaGFkZXIuR2VuVGV4dHVyZQoBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoEbW9kZQECAAEAAAAAAAsFY29sb3IFDAIAAAwIX19pbml0X18OBgAADQZ2ZXJ0ZXgOBgAADghmcmFnbWVudA4GAAADAgwAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAANAAAFAQYEAgYFDAkDKw4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAAEOAAAFARMEAgoBAQEBAQIAAAAAAQUBBgQCCAUMCwYHCQMcDgEKAgYFDBEABQoDAQMAAAAAAADwPwMCCQMrDgEBAwAAAAAAAAAAAwUMAgsFDAUMBQwAAAAA";
bf._MODULE="h3d.shader.GenTexture";Fe.SRC="HXSMFWgzZC5zaGFkZXIuTGluZVNoYWRlcgwBBmNhbWVyYQ0BAwIEdmlldwcAAQADBHByb2oHAAEABAh2aWV3UHJvagcAAQAAAAAFBmdsb2JhbA0CAgYJcGl4ZWxTaXplBQoABQAHCW1vZGVsVmlldwcABQEDAAAACAVpbnB1dA0DAwkIcG9zaXRpb24FCwEIAAoGbm9ybWFsBQsBCAALAnV2BQoBCAABAAAMBm91dHB1dA0EAQ0IcG9zaXRpb24FDAQMAAQAAA4RdHJhbnNmb3JtZWROb3JtYWwFCwQAAA8TdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAEBFwcm9qZWN0ZWRQb3NpdGlvbgUMBAAAEQtsZW5ndGhTY2FsZQMCAAASBXdpZHRoAwIAABMEcGRpcgUMBAAAFAhfX2luaXRfXw4GAAAVBnZlcnRleA4GAAACAhQAAAUBBQUIFgNkaXIFCwQAAAYBAgoFCwkDMw4BAgcHBgULAAYEAhMFDAYBCQMrDgIGAQIWBQsJAzMOAQICBwYFCwEDAAAAAAAA8D8DBQwCAwcFDAUMBoEKAhMFDBEABQoGAgEDAAAAAAAA8D8DCQMNDgEGAAYBCgITBQwAAAMKAhMFDAAAAwMGAQoCEwUMBAADCgITBQwEAAMDAwMDBQoGgAIPBQsGAQYBAhYFCwoCCwUKAAADBQsCEQMFCwULBgQCDgULCQMgDgECFgULBQsFCwAAABUAAAUBBoAKAhAFDBEABQoGAQYBBgEGAQQGAQoCEwUMBQAFCgkDKQ4CAQMAAAAAAADwPwMBAwAAAAAAAPC/AwUKBQoFCgQGAwoCCwUKBAADAQMAAAAAAADgPwMDAwUKCgIQBQwIAAMFCgIGBQoFCgISAwUKBQoA";
Fe._MODULE="h3d.shader.LineShader";Fd.SRC="HXSMF2gzZC5zaGFkZXIuTWluTWF4U2hhZGVyCwEFaW5wdXQNAQICCHBvc2l0aW9uBQoBAQADAnV2BQoBAQABAAAEBWZsaXBZAwIAAAUGb3V0cHV0DQICBghwb3NpdGlvbgUMBAUABwVjb2xvcgUMBAUABAAACApwaXhlbENvbG9yBQwEAAAJDGNhbGN1bGF0ZWRVVgUKBAAACgR0ZXhBCgICAAALBHRleEIKAgIAAAwFaXNNYXgCAgABAAAAAAANCF9faW5pdF9fDgYAAA4GdmVydGV4DgYAAA8IZnJhZ21lbnQOBgAAAwINAAAFAgYEAgcFDAIIBQwFDAYEAgkFCgIDBQoFCgAADgAABQEGBAIGBQwJAysOBAoCAgUKAAADBgEKAgIFCgQAAwIEAwMBAwAAAAAAAAAAAwEDAAAAAAAA8D8DBQwFDAABDwAABQMIEAFhBQwEAAAJAyIOAgIKCgICCQUKBQwACBEBYgUMBAAACQMiDgICCwoCAgkFCgUMAAYEAggFDAsCDAIJAxYOAgIQBQwCEQUMBQwJAxUOAgIQBQwCEQUMBQwFDAUMAA";
Fd._MODULE="h3d.shader.MinMaxShader";yf.SRC="HXSMG2gzZC5zaGFkZXIuQ3ViZU1pbk1heFNoYWRlcgwBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoEdGV4QQoGAgAACwR0ZXhCCgYCAAAMBWlzTWF4AgIAAQAAAAAADQNtYXQGAgAADghfX2luaXRfXw4GAAAPBnZlcnRleA4GAAAQCGZyYWdtZW50DgYAAAMCDgAABQIGBAIHBQwCCAUMBQwGBAIJBQoCAwUKBQoAAA8AAAUBBgQCBgUMCQMrDgQKAgIFCgAAAwYBCgICBQoEAAMCBAMDAQMAAAAAAAAAAAMBAwAAAAAAAPA/AwUMBQwAARAAAAUFCBECdXYFCgQAAAYDBgECCQUKAQMAAAAAAAAAQAMFCgEDAAAAAAAA8D8DBQoACBIDZGlyBQsEAAAGAQkDKg4CAhEFCgEDAAAAAAAA8D8DBQsCDQYFCwAIEwFhBQwEAAAJAyIOAgIKCgYCEgULBQwACBQBYgUMBAAACQMiDgICCwoGAhIFCwUMAAYEAggFDAsCDAIJAxYOAgITBQwCFAUMBQwJAxUOAgITBQwCFAUMBQwFDAUMAA";
yf._MODULE="h3d.shader.MinMaxShader";Cd.SRC="HXSMFGgzZC5zaGFkZXIuTm9ybWFsTWFwCgEGY2FtZXJhDQECAghwb3NpdGlvbgULAAEAAwNkaXIFCwMBAAAAAAQGZ2xvYmFsDQIBBQltb2RlbFZpZXcHAAQBAwAAAAYFaW5wdXQNAwIHBm5vcm1hbAULAQYACAd0YW5nZW50BQsBBgABAAAJB3RleHR1cmUKAgIAAAoMY2FsY3VsYXRlZFVWBQoEAAALE3RyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAwRdHJhbnNmb3JtZWROb3JtYWwFCwQAAA0SdHJhbnNmb3JtZWRUYW5nZW50BQwDAAAODl9faW5pdF9fdmVydGV4DgYAAA8IZnJhZ21lbnQOBgAAAgIOAAAFAQYEAg0FDAkDKw4CBgECCAULCQMzDgECBQcGBQsLBgcJAx4OAgIIBQsCCAULAwEDAAAAAAAA4D8DAgEDAAAAAAAA8D8DAQMAAAAAAADwvwMDBQwFDAABDwAABQUIEAFuBQsEAAACDAULAAgRAm5mBQsEAAAJAzoOAQkDIg4CAgkKAgIKBQoFDAULAAgSBHRhblgFCwQAAAkDIA4BCgINBQySAAULBQsACBMEdGFuWQULBAAABgEJAx8OAgIQBQsCEgULBQsHAwoCDQUMDAADAwULAAYEAgwFCwkDIA4BBAYABgAGAQoCEQULAAADAhIFCwULBgEKAhEFCwQAAwITBQsFCwULBgEKAhEFCwgAAwIQBQsFCwULBQsFCwULAA";
Cd._MODULE="h3d.shader.NormalMap";sf.SRC="HXSMEWgzZC5zaGFkZXIuU2hhZG93BgEGc2hhZG93DQEFAgNtYXARAQABAAMEcHJvaggAAQAEBWNvbG9yBQsAAQAFBXBvd2VyAwABAAYEYmlhcwMAAQAAAAAHCnBpeGVsQ29sb3IFDAQAAAgTdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAACRhwaXhlbFRyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAoJc2hhZG93UG9zBQsEAAEBCwhmcmFnbWVudA4GAAABAQsAAAUGCAwJc2hhZG93UG9zBQsEAAAGAQIJBQsCAwgFCwAIDQVkZXB0aAMEAAAJA0AOAgICEQEJAzsOAQoCDAULEQAFCgUKAwAIDgR6TWF4AwQAAAkDNg4BCgIMBQsIAAMDAAgPBWRlbHRhAwQAAAYDCQMVDgIEBgACDQMCBgMDAwIOAwMCDgMDAAgQBXNoYWRlAwQAAAkDNg4BCQMJDgEGAQIFAwIPAwMDAwAGgQoCBwUMkgAFCwYABgEEBgMBAwAAAAAAAPA/AwIQAwMDCgIEBQuSAAULBQsCEAMFCwULAA";
sf._MODULE="h3d.shader.Shadow";fg.SRC="HXSMEGgzZC5zaGFkZXIuVXRpbHMHAQtib25lTWF0cml4WAgEAAACC2JvbmVNYXRyaXhZCAQAAAMLYm9uZU1hdHJpeFoIBAAABAtib25lTWF0cml4VwgEAAAFC3NraW5XZWlnaHRzBQwEAAAGDmFwcGx5U2tpblBvaW50DgYAAAcMYXBwbHlTa2luVmVjDgYAAAIDBgEIAXAFCwQAAAULBQMICQt0cmFuc2Zvcm1lZAULBAAABgAGAAYBBAYBAggFCwIBCAULBQsKAgUFDAAAAwULBgEEBgECCAULAgIIBQsFCwoCBQUMBAADBQsFCwYBBAYBAggFCwIDCAULBQsKAgUFDAgAAwULBQsACwYHCgIFBQwMAAMBAwAAAAAAAAAAAwIFAQaAAgkFCwYBBAYBAggFCwIECAULBQsKAgUFDAwAAwULBQsAAAANAgkFCwAAAwcBCgF2BQsEAAAFCwUDCAsLdHJhbnNmb3JtZWQFCwQAAAYABgAGAQQGAQIKBQsJAzMOAQIBCAYFCwULCgIFBQwAAAMFCwYBBAYBAgoFCwkDMw4BAgIIBgULBQsKAgUFDAQAAwULBQsGAQQGAQIKBQsJAzMOAQIDCAYFCwULCgIFBQwIAAMFCwULAAsGBwoCBQUMDAADAQMAAAAAAAAAAAMCBQEGgAILBQsGAQQGAQIKBQsJAzMOAQIECAYFCwULCgIFBQwMAAMFCwULAAAADQILBQsAAA";
fg._MODULE="h3d.shader.Skin";pd.SRC="HXSME2gzZC5zaGFkZXIuU2tpbkJhc2UIARByZWxhdGl2ZVBvc2l0aW9uBQsEAAACE3RyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAMRdHJhbnNmb3JtZWROb3JtYWwFCwQAAAQITWF4Qm9uZXMBAgABAAAAAAAFEWZvdXJCb25lc0J5VmVydGV4AgIAAQAAAAAABgtjYWxjUHJldlBvcwICAAEAAAAAAAcNYm9uZXNNYXRyaXhlcw8IBAIAAQgIEXByZXZCb25lc01hdHJpeGVzDwgEAgABCAA";pd._MODULE="h3d.shader.SkinBase";Hd.SRC="HXSMD2gzZC5zaGFkZXIuU2tpbhIBEHJlbGF0aXZlUG9zaXRpb24FCwQAAAITdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAAxF0cmFuc2Zvcm1lZE5vcm1hbAULBAAABAhNYXhCb25lcwECAAEAAAAAAAURZm91ckJvbmVzQnlWZXJ0ZXgCAgABAAAAAAAGC2NhbGNQcmV2UG9zAgIAAQAAAAAABw1ib25lc01hdHJpeGVzDwgEAgABCAgRcHJldkJvbmVzTWF0cml4ZXMPCAQCAAEICQtib25lTWF0cml4WAgEAAAKC2JvbmVNYXRyaXhZCAQAAAsLYm9uZU1hdHJpeFoIBAAADAtib25lTWF0cml4VwgEAAANC3NraW5XZWlnaHRzBQwEAAAOBWlucHV0DQEEDwhwb3NpdGlvbgULAQ4AEAZub3JtYWwFCwEOABEHd2VpZ2h0cwULAQ4AEgdpbmRleGVzCQQAAAABDgABAAATG3ByZXZpb3VzVHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAFA5hcHBseVNraW5Qb2ludA4GAAAVDGFwcGx5U2tpblZlYw4GAAAWBnZlcnRleA4GAAADAxQBFwFwBQsEAAAFCwUDCBgLdHJhbnNmb3JtZWQFCwQAAAYABgAGAQQGAQIXBQsCCQgFCwULCgINBQwAAAMFCwYBBAYBAhcFCwIKCAULBQsKAg0FDAQAAwULBQsGAQQGAQIXBQsCCwgFCwULCgINBQwIAAMFCwULAAsGBwoCDQUMDAADAQMAAAAAAAAAAAMCBQEGgAIYBQsGAQQGAQIXBQsCDAgFCwULCgINBQwMAAMFCwULAAAADQIYBQsAAAMVARkBdgULBAAABQsFAwgaC3RyYW5zZm9ybWVkBQsEAAAGAAYABgEEBgECGQULCQMzDgECCQgGBQsFCwoCDQUMAAADBQsGAQQGAQIZBQsJAzMOAQIKCAYFCwULCgINBQwEAAMFCwULBgEEBgECGQULCQMzDgECCwgGBQsFCwoCDQUMCAADBQsFCwALBgcKAg0FDAwAAwEDAAAAAAAAAAADAgUBBoACGgULBgEEBgECGQULCQMzDgECDAgGBQsFCwoCDQUMDAADBQsFCwAAAA0CGgULAAAAFgAABQsLAgYCBQcGBAIJCBECCA8IBAkDJg4BCgISCQQAAAAAAAMBCAgGBAIKCBECCA8IBAkDJg4BCgISCQQAAAAEAAMBCAgGBAILCBECCA8IBAkDJg4BCgISCQQAAAAIAAMBCAgGBAIMCBECCA8IBAkDJg4BCgISCQQAAAAMAAMBCAgGBAINBQwJAysOAgIRBQsBAwAAAAAAAAAAAwUMBQwLAgUCBgQKAg0FDAwAAwYDAQMAAAAAAADwPwMEBgAGAAoCEQULAAADCgIRBQsEAAMDCgIRBQsIAAMDAwMDAAAGBAITBQsJAhQOAQIBBQsFCwULAAAABgQCCQgRAgcPCAQJAyYOAQoCEgkEAAAAAAADAQgIBgQCCggRAgcPCAQJAyYOAQoCEgkEAAAABAADAQgIBgQCCwgRAgcPCAQJAyYOAQoCEgkEAAAACAADAQgIBgQCDAgRAgcPCAQJAyYOAQoCEgkEAAAADAADAQgIBgQCDQUMCQMrDgICEQULAQMAAAAAAAAAAAMFDAUMCwIFAgYECgINBQwMAAMGAwEDAAAAAAAA8D8DBAYABgAKAhEFCwAAAwoCEQULBAADAwoCEQULCAADAwMDAwAABgQCAgULCQIUDgECAQULBQsFCwYEAgMFCwkCFQ4BAhAFCwULBQsGBAIDBQsJAyAOAQIDBQsFCwULCwcCAgYCAgYEAhMFCwICBQsFCwAAAA";
Hd._MODULE="h3d.shader.Skin";ie.SRC="HXSMFmgzZC5zaGFkZXIuU2tpblRhbmdlbnQTARByZWxhdGl2ZVBvc2l0aW9uBQsEAAACE3RyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAMRdHJhbnNmb3JtZWROb3JtYWwFCwQAAAQITWF4Qm9uZXMBAgABAAAAAAAFEWZvdXJCb25lc0J5VmVydGV4AgIAAQAAAAAABgtjYWxjUHJldlBvcwICAAEAAAAAAAcNYm9uZXNNYXRyaXhlcw8IBAIAAQgIEXByZXZCb25lc01hdHJpeGVzDwgEAgABCAkLYm9uZU1hdHJpeFgIBAAACgtib25lTWF0cml4WQgEAAALC2JvbmVNYXRyaXhaCAQAAAwLYm9uZU1hdHJpeFcIBAAADQtza2luV2VpZ2h0cwUMBAAADgVpbnB1dA0BBQ8IcG9zaXRpb24FCwEOABAGbm9ybWFsBQsBDgARB3RhbmdlbnQFCwEOABIHd2VpZ2h0cwULAQ4AEwdpbmRleGVzCQQAAAABDgABAAAUEnRyYW5zZm9ybWVkVGFuZ2VudAUMBAAAFRtwcmV2aW91c1RyYW5zZm9ybWVkUG9zaXRpb24FCwQAABYOYXBwbHlTa2luUG9pbnQOBgAAFwxhcHBseVNraW5WZWMOBgAAGAZ2ZXJ0ZXgOBgAAAwMWARkBcAULBAAABQsFAwgaC3RyYW5zZm9ybWVkBQsEAAAGAAYABgEEBgECGQULAgkIBQsFCwoCDQUMAAADBQsGAQQGAQIZBQsCCggFCwULCgINBQwEAAMFCwULBgEEBgECGQULAgsIBQsFCwoCDQUMCAADBQsFCwALBgcKAg0FDAwAAwEDAAAAAAAAAAADAgUBBoACGgULBgEEBgECGQULAgwIBQsFCwoCDQUMDAADBQsFCwAAAA0CGgULAAADFwEbAXYFCwQAAAULBQMIHAt0cmFuc2Zvcm1lZAULBAAABgAGAAYBBAYBAhsFCwkDMw4BAgkIBgULBQsKAg0FDAAAAwULBgEEBgECGwULCQMzDgECCggGBQsFCwoCDQUMBAADBQsFCwYBBAYBAhsFCwkDMw4BAgsIBgULBQsKAg0FDAgAAwULBQsACwYHCgINBQwMAAMBAwAAAAAAAAAAAwIFAQaAAhwFCwYBBAYBAhsFCwkDMw4BAgwIBgULBQsKAg0FDAwAAwULBQsAAAANAhwFCwAAABgAAAUNCwIGAgUHBgQCCQgRAggPCAQJAyYOAQoCEwkEAAAAAAADAQgIBgQCCggRAggPCAQJAyYOAQoCEwkEAAAABAADAQgIBgQCCwgRAggPCAQJAyYOAQoCEwkEAAAACAADAQgIBgQCDAgRAggPCAQJAyYOAQoCEwkEAAAADAADAQgIBgQCDQUMCQMrDgICEgULAQMAAAAAAAAAAAMFDAUMCwIFAgYECgINBQwMAAMGAwEDAAAAAAAA8D8DBAYABgAKAhIFCwAAAwoCEgULBAADAwoCEgULCAADAwMDAwAABgQCFQULCQIWDgECAQULBQsFCwAAAAYEAgkIEQIHDwgECQMmDgEKAhMJBAAAAAAAAwEICAYEAgoIEQIHDwgECQMmDgEKAhMJBAAAAAQAAwEICAYEAgsIEQIHDwgECQMmDgEKAhMJBAAAAAgAAwEICAYEAgwIEQIHDwgECQMmDgEKAhMJBAAAAAwAAwEICAYEAg0FDAkDKw4CAhIFCwEDAAAAAAAAAAADBQwFDAsCBQIGBAoCDQUMDAADBgMBAwAAAAAAAPA/AwQGAAYACgISBQsAAAMKAhIFCwQAAwMKAhIFCwgAAwMDAwMAAAYEAgIFCwkCFg4BAgEFCwULBQsGBAIDBQsJAhcOAQIQBQsFCwULBgQKAhQFDJIABQsJAhcOAQoCEQULkgAFCwULBQsGBAIDBQsJAyAOAQIDBQsFCwULBgQKAhQFDJIABQsJAyAOAQoCFAUMkgAFCwULBQsLBwICBgICBgQCFQULAgIFCwULAAAA";
ie._MODULE="h3d.shader.SkinTangent";Ae.SRC="HXSMGmgzZC5zaGFkZXIuU3BlY3VsYXJUZXh0dXJlBAEHdGV4dHVyZQoCAgAAAgxjYWxjdWxhdGVkVVYFCgQAAAMJc3BlY0NvbG9yBQsEAAAECGZyYWdtZW50DgYAAAEBBAAABQEGgQIDBQsKCQMiDgICAQoCAgIFCgUMkgAFCwULAA";Ae._MODULE="h3d.shader.SpecularTexture";af.SRC="HXSMEmgzZC5zaGFkZXIuVGV4dHVyZQsBBWlucHV0DQEBAgJ1dgUKAQEAAQAAAwhhZGRpdGl2ZQICAAEAAAAAAAQJa2lsbEFscGhhAgIAAQAAAAAABQ1zcGVjdWxhckFscGhhAgIAAQAAAAAABhJraWxsQWxwaGFUaHJlc2hvbGQDAgABBwAAAAAAAAAAAAAAAAAA8D8HB3RleHR1cmUKAgIAAAgMY2FsY3VsYXRlZFVWBQoEAAAJCnBpeGVsQ29sb3IFDAQAAAoJc3BlY0NvbG9yBQsEAAALBnZlcnRleA4GAAAMCGZyYWdtZW50DgYAAAIACwAABQEGBAIIBQoCAgUKBQoAAQwAAAUECA0BYwUMBAAACQMiDgICBwoCAggFCgUMAAsGDgIEAgYJBgMKAg0FDAwAAwIGAwMBAwAAAAAAAAAAAwICDAAAAAsCAwIGgAIJBQwCDQUMBQwGgQIJBQwCDQUMBQwACwIFAgaBAgoFCwoCDQUM/gAFCwULAAAA";
af._MODULE="h3d.shader.Texture";Kd.SRC="HXSMEmgzZC5zaGFkZXIuVVZEZWx0YQQBB3V2RGVsdGEFCgIAAAIHdXZTY2FsZQUKAgAAAwxjYWxjdWxhdGVkVVYFCgQAAAQGdmVydGV4DgYAAAEABAAABQEGBAIDBQoGAAYBAgMFCgICBQoFCgIBBQoFCgUKAA";Kd._MODULE="h3d.shader.UVDelta";ff.SRC="HXSMG2gzZC5zaGFkZXIuVmVydGV4Q29sb3JBbHBoYQQBBWlucHV0DQEBAgVjb2xvcgUMAQEAAQAAAwpwaXhlbENvbG9yBQwEAAAECGFkZGl0aXZlAgIAAQAAAAAABQhmcmFnbWVudA4GAAABAQUAAAUBCwIEAgaAAgMFDAICBQwFDAaBAgMFDAICBQwFDAAA";ff._MODULE="h3d.shader.VertexColorAlpha";Bd.SRC="HXSMFmgzZC5zaGFkZXIuVm9sdW1lRGVjYWwdAQZjYW1lcmENAQwCBHZpZXcHAAEAAwRwcm9qBwABAAQIcG9zaXRpb24FCwABAAUIcHJvakZsaXADAAEABghwcm9qRGlhZwULAAEABwh2aWV3UHJvagcAAQAIEHByZXZpb3VzVmlld1Byb2oHAAEACQ9pbnZlcnNlVmlld1Byb2oHAAEACgV6TmVhcgMAAQALBHpGYXIDAAEADANkaXIFCwMBAA0Naml0dGVyT2Zmc2V0cwUMAAEAAAAADgZnbG9iYWwNAgUPBHRpbWUDAA4AEAlwaXhlbFNpemUFCgAOABEJbW9kZWxWaWV3BwAOAQMSEG1vZGVsVmlld0ludmVyc2UHAA4BAxMRcHJldmlvdXNNb2RlbFZpZXcHAA4BAwAAABQFaW5wdXQNAwIVCHBvc2l0aW9uBQsBFAAWBm5vcm1hbAULARQAAQAAFwZvdXRwdXQNBAYYCHBvc2l0aW9uBQwEFwAZBWNvbG9yBQwEFwAaBWRlcHRoAwQXABsGbm9ybWFsBQsEFwAcCXdvcmxkRGlzdAMEFwAdCHZlbG9jaXR5BQoEFwAEAAAeEHJlbGF0aXZlUG9zaXRpb24FCwQAAB8TdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAIBtwcmV2aW91c1RyYW5zZm9ybWVkUG9zaXRpb24FCwQAACEYcGl4ZWxUcmFuc2Zvcm1lZFBvc2l0aW9uBQsEAAAiEXRyYW5zZm9ybWVkTm9ybWFsBQsEAAAjEXByb2plY3RlZFBvc2l0aW9uBQwEAAAkGXByZXZpb3VzUHJvamVjdGVkUG9zaXRpb24FDAQAACUKcGl4ZWxDb2xvcgUMBAAAJgVkZXB0aAMEAAAnC25kY1Bvc2l0aW9uBQoEAAAoE3ByZXZpb3VzTmRjUG9zaXRpb24FCgQAACkIc2NyZWVuVVYFCgQAACoJc3BlY1Bvd2VyAwQAACsJc3BlY0NvbG9yBQsEAAAsCXdvcmxkRGlzdAMEAAAtDXBpeGVsVmVsb2NpdHkFCgQAAC4IZGVwdGhNYXARAQAAAC8Fc2NhbGUFCgIAADAGbm9ybWFsBQsCAAAxB3RhbmdlbnQFCwIAADIKaXNDZW50ZXJlZAICAAEAAAAAADMMY2FsY3VsYXRlZFVWBQoEAAA0EnRyYW5zZm9ybWVkVGFuZ2VudAUMBAAANQ5fX2luaXRfX3ZlcnRleA4GAAA2CGZyYWdtZW50DgYAAAICNQAABQIGBAIiBQsJAyAOAQQGAQIwBQsJAzMOAQIRBwYFCwULBQsFCwYEAjQFDAkDKw4CCQMgDgEEBgECMQULCQMzDgECEQcGBQsFCwULAQMAAAAAAADwPwMFDAUMAAE2AAAFCQg3Bm1hdHJpeAcEAAAGAQIJBwISBwcACDgJc2NyZWVuUG9zBQoEAAAGAgoCIwUMEQAFCgoCIwUMDAADBQoACDkDcnV2BQwEAAAJAysOAwI4BQoJA0AOAgIuEQEJAzsOAQI4BQoFCgMBAwAAAAAAAPA/AwUMAAg6BHdwb3MFDAQAAAYBAjkFDAI3BwUMAAg7BHBwb3MFDAQAAAYBAjkFDAIJBwUMAAYEAiEFCwYCCgI7BQySAAULCgI7BQwMAAMFCwULBgQCMwUKBgECLwUKBAYCCgI6BQwRAAUKCgI6BQwMAAMFCgUKBQoFCgsCMgIGgAIzBQoBAwAAAAAAAOA/AwUKAAALBgkJAxUOAgkDFQ4CCgIzBQoAAAMKAjMFCgQAAwMJAxUOAgYDAQMAAAAAAADwPwMKAjMFCgAAAwMGAwEDAAAAAAAA8D8DCgIzBQoEAAMDAwMBAwAAAAAAAAAAAwIMAAAAAA";
Bd._MODULE="h3d.shader.VolumeDecal";Xd.pending=[];Xd.threadCount=0;Yd.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";Yd.BYTES=S.ofString(Yd.CHARS);hb.i64tmp=new Ug(0,0);hb.helper=new DataView(new ArrayBuffer(8));Tb.LEN_EXTRA_BITS_TBL=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1];Tb.LEN_BASE_VAL_TBL=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];Tb.DIST_EXTRA_BITS_TBL=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,
10,10,11,11,12,12,13,13,-1,-1];Tb.DIST_BASE_VAL_TBL=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];Tb.CODE_LENGTHS_POS=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];$b.F32=0;$b.F16=1;$b.U8=2;$b.S8=3;$b.SIZES=[4,2,1,1];Vd.DFloat=1;Vd.DVec2=2;Vd.DVec3=3;Vd.DVec4=4;Vd.DMat4=16;Vd.DBytes4=9;N._UID=0;N.ALL_FORMATS=new Sa;Rc.UID=0;Rc.CACHE=new Fa;Rc._UID=0;Rc.MAX_FORMATS=16;H.BACKSPACE=8;H.TAB=9;H.ENTER=13;H.SHIFT=16;H.CTRL=17;H.ALT=
18;H.ESCAPE=27;H.SPACE=32;H.PGUP=33;H.PGDOWN=34;H.END=35;H.HOME=36;H.LEFT=37;H.UP=38;H.RIGHT=39;H.DOWN=40;H.INSERT=45;H.DELETE=46;H.QWERTY_EQUALS=187;H.QWERTY_MINUS=189;H.QWERTY_TILDE=192;H.QWERTY_BRACKET_LEFT=219;H.QWERTY_BRACKET_RIGHT=221;H.QWERTY_SEMICOLON=186;H.QWERTY_QUOTE=222;H.QWERTY_BACKSLASH=220;H.QWERTY_COMMA=188;H.QWERTY_PERIOD=190;H.QWERTY_SLASH=191;H.INTL_BACKSLASH=226;H.LEFT_WINDOW_KEY=91;H.RIGHT_WINDOW_KEY=92;H.CONTEXT_MENU=93;H.PAUSE_BREAK=19;H.CAPS_LOCK=20;H.NUM_LOCK=144;H.SCROLL_LOCK=
145;H.NUMBER_0=48;H.NUMBER_1=49;H.NUMBER_2=50;H.NUMBER_3=51;H.NUMBER_4=52;H.NUMBER_5=53;H.NUMBER_6=54;H.NUMBER_7=55;H.NUMBER_8=56;H.NUMBER_9=57;H.NUMPAD_0=96;H.NUMPAD_1=97;H.NUMPAD_2=98;H.NUMPAD_3=99;H.NUMPAD_4=100;H.NUMPAD_5=101;H.NUMPAD_6=102;H.NUMPAD_7=103;H.NUMPAD_8=104;H.NUMPAD_9=105;H.A=65;H.B=66;H.C=67;H.D=68;H.E=69;H.F=70;H.G=71;H.H=72;H.I=73;H.J=74;H.K=75;H.L=76;H.M=77;H.N=78;H.O=79;H.P=80;H.Q=81;H.R=82;H.S=83;H.T=84;H.U=85;H.V=86;H.W=87;H.X=88;H.Y=89;H.Z=90;H.F1=112;H.F2=113;H.F3=114;H.F4=
115;H.F5=116;H.F6=117;H.F7=118;H.F8=119;H.F9=120;H.F10=121;H.F11=122;H.F12=123;H.F13=124;H.F14=125;H.F15=126;H.F16=127;H.F17=128;H.F18=129;H.F19=130;H.F20=131;H.F21=132;H.F22=133;H.F23=134;H.F24=135;H.NUMPAD_MULT=106;H.NUMPAD_ADD=107;H.NUMPAD_ENTER=108;H.NUMPAD_SUB=109;H.NUMPAD_DOT=110;H.NUMPAD_DIV=111;H.MOUSE_LEFT=0;H.MOUSE_RIGHT=1;H.MOUSE_MIDDLE=2;H.MOUSE_BACK=3;H.MOUSE_FORWARD=4;H.MOUSE_WHEEL_UP=5;H.MOUSE_WHEEL_DOWN=6;H.LOC_LEFT=256;H.LOC_RIGHT=512;H.LSHIFT=272;H.RSHIFT=528;H.LCTRL=273;H.RCTRL=
529;H.LALT=274;H.RALT=530;H.initDone=!1;H.keyPressed=[];H.ALLOW_KEY_REPEAT=!1;T.PI=3.141592653589793;T.EPSILON=1E-10;T.EPSILON2=1E-20;ea.wantedFPS=60;ea.maxDeltaTime=.5;ea.smoothFactor=.95;ea.lastTimeStamp=F.now()/1E3;ea.elapsedTime=0;ea.frameCount=0;ea.dt=1/ea.wantedFPS;ea.currentDT=1/ea.wantedFPS;la.setCursor=la.setNativeCursor;la.loopInit=!1;la.fpsLimit=-1;qd.HORIZONTAL=-9007199254740992;qd.TOLERANCE=1E-20;qd.SKIP=-2;qd.UNASSIGNED=-1;mg.QTMP=new Dc;ch.CURRENT_VERSION=4;Nd.BLEND=ya.__empty_constructs__.slice();
Nd.CULLING=gc.__empty_constructs__.slice();gf.RELOAD_LFS=[];Oc.ENABLED=!1;Oc.ENGINE_PACKAGES="h3d hxd h2d haxe sys hrt".split(" ");Kc.LIVE_UPDATE=!1;ke.Jpg=0;ke.Png=1;ke.Gif=2;ke.Tga=3;ke.Dds=4;ke.Raw=5;ke.Hdr=6;yb.DEFAULT_FILTER=fd.Linear;yb.MIPMAP_MAX_SIZE=0;yb.ENABLE_AUTO_WATCH=!0;yb.BLACK_1x1=ta.alloc(1,1,J.RGBA);yb.LOG_TEXTURE_LOAD=!1;cb.BLOCKSIZE=64;cb.W1=2841;cb.W2=2676;cb.W3=2408;cb.W5=1609;cb.W6=1108;cb.W7=565;cb.CF4A=-9;cb.CF4B=111;cb.CF4C=29;cb.CF4D=-3;cb.CF3A=28;cb.CF3B=109;cb.CF3C=-9;
cb.CF3X=104;cb.CF3Y=27;cb.CF3Z=-3;cb.CF2A=139;cb.CF2B=-11;je.ENABLE_AUTO_WATCH=!0;Gf.ID=0;qg.ID=0;La.STREAM_DURATION=5;La.STREAM_BUFFER_SAMPLE_COUNT=44100;La.BUFFER_QUEUE_LENGTH=2;La.MAX_SOURCES=16;La.SOUND_BUFFER_CACHE_SIZE=256;La.VIRTUAL_VOLUME_THRESHOLD=1E-5;La.BUFFER_STREAM_SPLIT=16;oh.FADE_SAMPLES=10;A.UID=0;A.SWIZ=fa.__empty_constructs__.slice();A.MAX_CHANNELS_BITS=3;A.MAX_PARTIAL_MAPPINGS_BITS=7;Qe.SRC="HXSMEGh4c2wuQmF0Y2hTaGFkZXIFAQ9CYXRjaF9IYXNPZmZzZXQCAgABAAAAAAACEEJhdGNoX1VzZVN0b3JhZ2UCAgABAAAAAAADC0JhdGNoX0NvdW50AQIAAQAAEAAABAxCYXRjaF9CdWZmZXIQBQwDAgAABRNCYXRjaF9TdG9yYWdlQnVmZmVyEIIFDAAAAgAAAA";
Qe._MODULE="hxsl.BatchShader";U.vec2=x.TVec(2,Q.VFloat);U.vec3=x.TVec(3,Q.VFloat);U.vec4=x.TVec(4,Q.VFloat);U.ivec2=x.TVec(2,Q.VInt);U.ivec3=x.TVec(3,Q.VInt);U.ivec4=x.TVec(4,Q.VInt);gb.VAR_IDS=!1;gb.TRACE=!1;zb.SWIZ=[fa.X,fa.Y,fa.Z,fa.W];mc.KWD_LIST="attribute const uniform varying buffer shared\r\n\tcoherent volatile restrict readonly writeonly\r\n\tatomic_uint\r\n\tlayout\r\n\tcentroid flat smooth noperspective\r\n\tpatch sample\r\n\tbreak continue do for while switch case default\r\n\tif else\r\n\tsubroutine\r\n\tin out inout\r\n\tfloat double int void bool true false\r\n\tinvariant precise\r\n\tdiscard return\r\n\tmat2 mat3 mat4 dmat2 dmat3 dmat4\r\n\tmat2x2 mat2x3 mat2x4 dmat2x2 dmat2x3 dmat2x4\r\n\tmat3x2 mat3x3 mat3x4 dmat3x2 dmat3x3 dmat3x4\r\n\tmat4x2 mat4x3 mat4x4 dmat4x2 dmat4x3 dmat4x4\r\n\tvec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 dvec2 dvec3 dvec4\r\n\tuint uvec2 uvec3 uvec4\r\n\tlowp mediump highp precision\r\n\timage1D iimage1D uimage1D\r\n\timage2D iimage2D uimage2D\r\n\timage3D iimage3D uimage3D\r\n\tstruct\r\n\tcommon partition active\r\n\tasm\r\n\tclass union enum typedef template this packed\r\n\tresource\r\n\tgoto\r\n\tinline noinline public static extern external interface\r\n\tlong short half fixed unsigned superp\r\n\tinput output\r\n\thvec2 hvec3 hvec4 fvec2 fvec3 fvec4\r\n\tsampler3DRect\r\n\tfilter\r\n\tsizeof cast\r\n\tnamespace using\r\n\trow_major";
mc.KWDS=function(a){a=new Sa;for(var b=0,c=(new oe("[ \t\r\n]+","g")).split(mc.KWD_LIST);b<c.length;){var d=c[b];++b;a.h[d]=!0}return a}(this);mc.GLOBALS=function(a){var b=[];var c=0;for(var d=B.__empty_constructs__.slice();c<d.length;){a=d[c];++c;var e=""+y.string(a);e=e.charAt(0).toLowerCase()+F.substr(e,1,null);b[a._hx_index]=e}b[B.ToInt._hx_index]="int";b[B.ToFloat._hx_index]="float";b[B.ToBool._hx_index]="bool";b[B.LReflect._hx_index]="reflect";b[B.Mat3x4._hx_index]="_mat3x4";b[B.VertexID._hx_index]=
"gl_VertexID";b[B.InstanceID._hx_index]="gl_InstanceID";b[B.IVec2._hx_index]="ivec2";b[B.IVec3._hx_index]="ivec3";b[B.IVec4._hx_index]="ivec4";b[B.BVec2._hx_index]="bvec2";b[B.BVec3._hx_index]="bvec3";b[B.BVec4._hx_index]="bvec4";b[B.FragCoord._hx_index]="gl_FragCoord";b[B.FrontFacing._hx_index]="gl_FrontFacing";b[B.FloatBitsToUint._hx_index]="_floatBitsToUint";b[B.UintBitsToFloat._hx_index]="_uintBitsToFloat";b[B.ComputeVar_LocalInvocation._hx_index]="ivec3(gl_LocalInvocationID)";b[B.ComputeVar_GlobalInvocation._hx_index]=
"ivec3(gl_GlobalInvocationID)";b[B.ComputeVar_LocalInvocationIndex._hx_index]="int(gl_LocalInvocationIndex)";b[B.ComputeVar_WorkGroup._hx_index]="ivec3(gl_WorkGroupID)";for(c=0;c<b.length;)a=b[c],++c,mc.KWDS.h[a]=!0;return b}(this);mc.MAT34="struct _mat3x4 { vec4 a; vec4 b; vec4 c; };";Jf.UID=0;ra.SWIZ=["x","y","z","w"];rg.UID=0;Ma.TVECS=new Fa;Ma.TDIMS=Ta.__empty_constructs__.slice();Ma.BOPS=function(a){a=aa.__empty_constructs__.slice();a.splice(aa.OpAssignOp(null)._hx_index,0,null);return a}(this);
Ma.UNOPS=zc.__empty_constructs__.slice();Ma.TGLOBALS=B.__empty_constructs__.slice();Ma.TSWIZ=new Fa;Ma.REGS=[fa.X,fa.Y,fa.Z,fa.W];Ma.VKINDS=L.__empty_constructs__.slice();Ma.PRECS=Pe.__empty_constructs__.slice();Ma.FKIND=Ca.__empty_constructs__.slice();Ma.SIGN=9204765;Eb.MAX_LIST_SIZE=0;Eb.ALLOW_DUPLICATES=!0;ug.UID=0;Ob.UNROLL_LOOPS=!1;Ob.SHADER_RESOLVE=new Sa;ne.FLOAT_SINGLE_MIN=1.401298464324817E-45;ne.FLOAT_SINGLE_MAX=3.4028234663852886E38;ne.FLOAT_DOUBLE_MIN=4.9E-324;ne.FLOAT_DOUBLE_MAX=1.7976931348623157E308;
var dc={PlayerBaseHealth:100,ServerUpdateRate:100,MapSize:16384,SnowBiomeY:5461.333333333333,GridBoxSize:64,PlayerDeceleration:.993,PlayerBaseSpeed:55.55555555555556,ShapePositionOrbitSpeed:20};Se.main();Xd.run()})("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
