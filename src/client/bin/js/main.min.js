var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(W,J,mc){W!=Array.prototype&&W!=Object.prototype&&(W[J]=mc.value)};$jscomp.getGlobal=function(W){return"undefined"!=typeof window&&window===W?W:"undefined"!=typeof global&&null!=global?global:W};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(W,J,mc,Ca){if(J){mc=$jscomp.global;W=W.split(".");for(Ca=0;Ca<W.length-1;Ca++){var qa=W[Ca];qa in mc||(mc[qa]={});mc=mc[qa]}W=W[W.length-1];Ca=mc[W];J=J(Ca);J!=Ca&&null!=J&&$jscomp.defineProperty(mc,W,{configurable:!0,writable:!0,value:J})}};
$jscomp.polyfill("String.fromCodePoint",function(W){return W?W:function(J){for(var W="",Ca=0;Ca<arguments.length;Ca++){var qa=Number(arguments[Ca]);if(0>qa||1114111<qa||qa!==Math.floor(qa))throw new RangeError("invalid_code_point "+qa);65535>=qa?W+=String.fromCharCode(qa):(qa-=65536,W+=String.fromCharCode(qa>>>10&1023|55296),W+=String.fromCharCode(qa&1023|56320))}return W}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(W){return W?W:function(J,W,Ca){var qa=this.length||0;0>W&&(W=Math.max(0,qa+W));if(null==Ca||Ca>qa)Ca=qa;Ca=Number(Ca);0>Ca&&(Ca=Math.max(0,qa+Ca));for(W=Number(W||0);W<Ca;W++)this[W]=J;return this}},"es6","es3");$jscomp.findInternal=function(W,J,mc){W instanceof String&&(W=String(W));for(var Ca=W.length,qa=0;qa<Ca;qa++){var M=W[qa];if(J.call(mc,M,qa,W))return{i:qa,v:M}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(W){return W?W:function(J,W){return $jscomp.findInternal(this,J,W).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(W){return $jscomp.SYMBOL_PREFIX+(W||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var W=$jscomp.global.Symbol.iterator;W||(W=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[W]&&$jscomp.defineProperty(Array.prototype,W,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(W){var J=0;return $jscomp.iteratorPrototype(function(){return J<W.length?{done:!1,value:W[J++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(W){$jscomp.initSymbolIterator();W={next:W};W[$jscomp.global.Symbol.iterator]=function(){return this};return W};$jscomp.iteratorFromArray=function(W,J){$jscomp.initSymbolIterator();W instanceof String&&(W+="");var mc=0,Ca={next:function(){if(mc<W.length){var qa=mc++;return{value:J(qa,W[qa]),done:!1}}Ca.next=function(){return{done:!0,value:void 0}};return Ca.next()}};Ca[Symbol.iterator]=function(){return Ca};return Ca};
$jscomp.polyfill("Array.prototype.keys",function(W){return W?W:function(){return $jscomp.iteratorFromArray(this,function(J){return J})}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(W){return W?W:function(){return $jscomp.iteratorFromArray(this,function(J,W){return W})}},"es6","es3");
$jscomp.checkStringArgs=function(W,J,mc){if(null==W)throw new TypeError("The 'this' value for String.prototype."+mc+" must not be null or undefined");if(J instanceof RegExp)throw new TypeError("First argument to String.prototype."+mc+" must not be a regular expression");return W+""};
$jscomp.polyfill("String.prototype.startsWith",function(W){return W?W:function(J,W){var Ca=$jscomp.checkStringArgs(this,J,"startsWith");J+="";var qa=Ca.length,M=J.length;W=Math.max(0,Math.min(W|0,Ca.length));for(var z=0;z<M&&W<qa;)if(Ca[W++]!=J[z++])return!1;return z>=M}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(W){return W?W:function(J,W){var Ca=$jscomp.checkStringArgs(this,J,"endsWith");J+="";void 0===W&&(W=Ca.length);W=Math.max(0,Math.min(W|0,Ca.length));for(var qa=J.length;0<qa&&0<W;)if(Ca[--W]!=J[--qa])return!1;return 0>=qa}},"es6","es3");
(function(W){function J(a,b){a=Object.create(a);for(var c in b)a[c]=b[c];b.toString!==Object.prototype.toString&&(a.toString=b.toString);return a}function mc(a){var b=null;null==b&&(b=we.AsObject);b=(new Lg(a,b)).o;a=ua.field(b,"type");b=ua.field(b,"data");switch(a){case "AddBuilding":return Oc.AddBuilding(b);case "AddPlayer":return Oc.AddPlayer(b);case "Ping":return Oc.Ping;case "UpdatePlayers":return Oc.UpdatePlayers(b);default:throw u.thrown("unknown packet type");}}function Ca(a,b){a=(new kd([L[a.__enum__].__constructs__[a._hx_index]._hx_name,
b])).o.getBytes();mf.instance.game.ws.send(a)}function qa(a){return a instanceof Array?new Sd(a):a.iterator()}function M(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=W.$haxeUID++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=b.bind(a),a.hx__closures__[b.__id__]=c);return c}var z={},v=function(){return Z.__string_rec(this,"")},L=L||{},A,nf=function(a,b){this.r=new RegExp(a,b.split("u").join(""))};z.EReg=nf;nf.__name__="EReg";nf.prototype={match:function(a){this.r.global&&
(this.r.lastIndex=0);this.r.m=this.r.exec(a);this.r.s=a;return null!=this.r.m},matched:function(a){if(null!=this.r.m&&0<=a&&a<this.r.m.length)return this.r.m[a];throw u.thrown("EReg::matched");},matchedPos:function(){if(null==this.r.m)throw u.thrown("No string matched");return{pos:this.r.m.index,len:this.r.m[0].length}},matchSub:function(a,b,c){null==c&&(c=-1);if(this.r.global){if(this.r.lastIndex=b,this.r.m=this.r.exec(0>c?a:D.substr(a,0,b+c)),c=null!=this.r.m)this.r.s=a}else if(c=this.match(0>c?
D.substr(a,b,null):D.substr(a,b,c)))this.r.s=a,this.r.m.index+=b;return c},split:function(a){return a.replace(this.r,"#__delim__#").split("#__delim__#")},__class__:nf};var D=function(){};z.HxOverrides=D;D.__name__="HxOverrides";D.strDate=function(a){switch(a.length){case 8:a=a.split(":");var b=new Date;b.setTime(0);b.setUTCHours(a[0]);b.setUTCMinutes(a[1]);b.setUTCSeconds(a[2]);return b;case 10:return a=a.split("-"),new Date(a[0],a[1]-1,a[2],0,0,0);case 19:return a=a.split(" "),b=a[0].split("-"),
a=a[1].split(":"),new Date(b[0],b[1]-1,b[2],a[0],a[1],a[2]);default:throw u.thrown("Invalid date format : "+a);}};D.cca=function(a,b){a=a.charCodeAt(b);if(a==a)return a};D.substr=function(a,b,c){if(null==c)c=a.length;else if(0>c)if(0==b)c=a.length+c;else return"";return a.substr(b,c)};D.remove=function(a,b){b=a.indexOf(b);if(-1==b)return!1;a.splice(b,1);return!0};D.now=function(){return Date.now()};var ge=function(){};z.Lambda=ge;ge.__name__="Lambda";ge.array=function(a){var b=[];for(a=qa(a);a.hasNext();){var c=
a.next();b.push(c)}return b};ge.count=function(a,b){var c=0;if(null==b)for(b=qa(a);b.hasNext();)b.next(),++c;else for(a=qa(a);a.hasNext();){var d=a.next();b(d)&&++c}return c};var mf=function(){Ka.trace("Bundle loaded.",{fileName:"src/client/src/Main.hx",lineNumber:15,className:"Main",methodName:"new"});this.game=new Sh;new Mg};z.Main=mf;mf.__name__="Main";mf.main=function(){mf.instance=new mf};mf.prototype={__class__:mf};Math.__name__="Math";var ua=function(){};z.Reflect=ua;ua.__name__="Reflect";
ua.field=function(a,b){try{return a[b]}catch(c){return null}};ua.fields=function(a){var b=[];if(null!=a){var c=Object.prototype.hasOwnProperty,d;for(d in a)"__id__"!=d&&"hx__closures__"!=d&&c.call(a,d)&&b.push(d)}return b};ua.isFunction=function(a){return"function"==typeof a?!(a.__name__||a.__ename__):!1};ua.compare=function(a,b){return a==b?0:a>b?1:-1};ua.isEnumValue=function(a){return null!=a?null!=a.__enum__:!1};ua.deleteField=function(a,b){if(!Object.prototype.hasOwnProperty.call(a,b))return!1;
delete a[b];return!0};ua.copy=function(a){if(null==a)return null;for(var b={},c=0,d=ua.fields(a);c<d.length;){var e=d[c];++c;b[e]=ua.field(a,e)}return b};var w=function(){};z.Std=w;w.__name__="Std";w.string=function(a){return Z.__string_rec(a,"")};w.parseInt=function(a){a=parseInt(a);return isNaN(a)?null:a};w.random=function(a){return 0>=a?0:Math.floor(Math.random()*a)};var Pc=function(){this.b=""};z.StringBuf=Pc;Pc.__name__="StringBuf";Pc.prototype={__class__:Pc};var aa=function(){};z.StringTools=
aa;aa.__name__="StringTools";aa.htmlEscape=function(a,b){for(var c="",d=0,e=a;d<e.length;){a=e;var f=d++,g=a.charCodeAt(f);55296<=g&&56319>=g&&(g=g-55232<<10|a.charCodeAt(f+1)&1023);a=g;65536<=a&&++d;switch(a){case 34:c=b?c+"&quot;":c+String.fromCodePoint(a);break;case 38:c+="&amp;";break;case 39:c=b?c+"&#039;":c+String.fromCodePoint(a);break;case 60:c+="&lt;";break;case 62:c+="&gt;";break;default:c+=String.fromCodePoint(a)}}return c};aa.startsWith=function(a,b){return a.length>=b.length?0==a.lastIndexOf(b,
0):!1};aa.endsWith=function(a,b){var c=b.length,d=a.length;return d>=c?a.indexOf(b,d-c)==d-c:!1};aa.isSpace=function(a,b){a=D.cca(a,b);return 8<a&&14>a?!0:32==a};aa.ltrim=function(a){for(var b=a.length,c=0;c<b&&aa.isSpace(a,c);)++c;return 0<c?D.substr(a,c,b-c):a};aa.rtrim=function(a){for(var b=a.length,c=0;c<b&&aa.isSpace(a,b-c-1);)++c;return 0<c?D.substr(a,0,b-c):a};aa.trim=function(a){return aa.ltrim(aa.rtrim(a))};aa.replace=function(a,b,c){return a.split(b).join(c)};aa.hex=function(a,b){var c=
"";do c="0123456789ABCDEF".charAt(a&15)+c,a>>>=4;while(0<a);if(null!=b)for(;c.length<b;)c="0"+c;return c};var mb=L.ValueType={__ename__:!0,__constructs__:null,TNull:{_hx_name:"TNull",_hx_index:0,__enum__:"ValueType",toString:v},TInt:{_hx_name:"TInt",_hx_index:1,__enum__:"ValueType",toString:v},TFloat:{_hx_name:"TFloat",_hx_index:2,__enum__:"ValueType",toString:v},TBool:{_hx_name:"TBool",_hx_index:3,__enum__:"ValueType",toString:v},TObject:{_hx_name:"TObject",_hx_index:4,__enum__:"ValueType",toString:v},
TFunction:{_hx_name:"TFunction",_hx_index:5,__enum__:"ValueType",toString:v},TClass:(A=function(a){return{_hx_index:6,c:a,__enum__:"ValueType",toString:v}},A._hx_name="TClass",A.__params__=["c"],A),TEnum:(A=function(a){return{_hx_index:7,e:a,__enum__:"ValueType",toString:v}},A._hx_name="TEnum",A.__params__=["e"],A),TUnknown:{_hx_name:"TUnknown",_hx_index:8,__enum__:"ValueType",toString:v}};mb.__constructs__=[mb.TNull,mb.TInt,mb.TFloat,mb.TBool,mb.TObject,mb.TFunction,mb.TClass,mb.TEnum,mb.TUnknown];
mb.__empty_constructs__=[mb.TNull,mb.TInt,mb.TFloat,mb.TBool,mb.TObject,mb.TFunction,mb.TUnknown];var la=function(){};z.Type=la;la.__name__="Type";la.createInstance=function(a,b){return new (Function.prototype.bind.apply(a,[null].concat(b)))};la.createEnum=function(a,b,c){var d=ua.field(a,b);if(null==d)throw u.thrown("No such constructor "+b);if(ua.isFunction(d)){if(null==c)throw u.thrown("Constructor "+b+" need parameters");return d.apply(a,c)}if(null!=c&&0!=c.length)throw u.thrown("Constructor "+
b+" does not need parameters");return d};la.createEnumIndex=function(a,b,c){var d=a.__constructs__[b];d=null==d?null:d._hx_name;if(null==d)throw u.thrown(b+" is not a valid enum constructor index");return la.createEnum(a,d,c)};la.typeof=function(a){switch(typeof a){case "boolean":return mb.TBool;case "function":return a.__name__||a.__ename__?mb.TObject:mb.TFunction;case "number":return Math.ceil(a)==a%2147483648?mb.TInt:mb.TFloat;case "object":if(null==a)return mb.TNull;var b=a.__enum__;if(null!=
b)return mb.TEnum(L[b]);a=Z.getClass(a);return null!=a?mb.TClass(a):mb.TObject;case "string":return mb.TClass(String);case "undefined":return mb.TNull;default:return mb.TUnknown}};la.enumEq=function(a,b){if(a==b)return!0;try{var c=a.__enum__;if(null==c||c!=b.__enum__||a._hx_index!=b._hx_index)return!1;var d=L[c].__constructs__[a._hx_index].__params__;for(c=0;c<d.length;){var e=d[c];++c;if(!la.enumEq(a[e],b[e]))return!1}}catch(f){return!1}return!0};la.enumParameters=function(a){var b=L[a.__enum__].__constructs__[a._hx_index].__params__;
if(null!=b){for(var c=[],d=0;d<b.length;){var e=b[d];++d;c.push(a[e])}return c}return[]};var db={toString:function(a){switch(a){case 0:return"Element";case 1:return"PCData";case 2:return"CData";case 3:return"Comment";case 4:return"DocType";case 5:return"ProcessingInstruction";case 6:return"Document"}}},R=function(a){this.nodeType=a;this.children=[];this.attributeMap=new La};z.Xml=R;R.__name__="Xml";R.parse=function(a){return xe.parse(a)};R.createElement=function(a){var b=new R(R.Element);if(b.nodeType!=
R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==b.nodeType?"null":db.toString(b.nodeType)));b.nodeName=a;return b};R.createPCData=function(a){var b=new R(R.PCData);if(b.nodeType==R.Document||b.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+(null==b.nodeType?"null":db.toString(b.nodeType)));b.nodeValue=a;return b};R.createCData=function(a){var b=new R(R.CData);if(b.nodeType==R.Document||b.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+
(null==b.nodeType?"null":db.toString(b.nodeType)));b.nodeValue=a;return b};R.createComment=function(a){var b=new R(R.Comment);if(b.nodeType==R.Document||b.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+(null==b.nodeType?"null":db.toString(b.nodeType)));b.nodeValue=a;return b};R.createDocType=function(a){var b=new R(R.DocType);if(b.nodeType==R.Document||b.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+(null==b.nodeType?"null":db.toString(b.nodeType)));b.nodeValue=
a;return b};R.createProcessingInstruction=function(a){var b=new R(R.ProcessingInstruction);if(b.nodeType==R.Document||b.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+(null==b.nodeType?"null":db.toString(b.nodeType)));b.nodeValue=a;return b};R.createDocument=function(){return new R(R.Document)};R.prototype={get:function(a){if(this.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":db.toString(this.nodeType)));return this.attributeMap.h[a]},
set:function(a,b){if(this.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":db.toString(this.nodeType)));this.attributeMap.h[a]=b},exists:function(a){if(this.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==this.nodeType?"null":db.toString(this.nodeType)));return Object.prototype.hasOwnProperty.call(this.attributeMap.h,a)},attributes:function(){if(this.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+
(null==this.nodeType?"null":db.toString(this.nodeType)));return new Ze(this.attributeMap.h)},elements:function(){if(this.nodeType!=R.Document&&this.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element or Document but found "+(null==this.nodeType?"null":db.toString(this.nodeType)));for(var a=[],b=0,c=this.children;b<c.length;){var d=c[b];++b;d.nodeType==R.Element&&a.push(d)}return new Sd(a)},elementsNamed:function(a){if(this.nodeType!=R.Document&&this.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element or Document but found "+
(null==this.nodeType?"null":db.toString(this.nodeType)));for(var b=[],c=0,d=this.children;c<d.length;){var e=d[c];++c;if(e.nodeType==R.Element){if(e.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==e.nodeType?"null":db.toString(e.nodeType)));var f=e.nodeName==a}else f=!1;f&&b.push(e)}return new Sd(b)},firstElement:function(){if(this.nodeType!=R.Document&&this.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element or Document but found "+(null==this.nodeType?
"null":db.toString(this.nodeType)));for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;if(c.nodeType==R.Element)return c}return null},addChild:function(a){if(this.nodeType!=R.Document&&this.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element or Document but found "+(null==this.nodeType?"null":db.toString(this.nodeType)));null!=a.parent&&a.parent.removeChild(a);this.children.push(a);a.parent=this},removeChild:function(a){if(this.nodeType!=R.Document&&this.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element or Document but found "+
(null==this.nodeType?"null":db.toString(this.nodeType)));return D.remove(this.children,a)?(a.parent=null,!0):!1},toString:function(){return Uf.print(this)},__class__:R};var Sh=function(){Bb.mask=273;this.ws=new Th("ws://localhost:5000");this.ws.set_binaryType("arraybuffer");this.ws.set_onopen(M(this,this.onopen));this.ws.set_onmessage(M(this,this.onmessage));this.ws.set_onerror(M(this,this.onerror));this.ws.set_onclose(M(this,this.onclose))};z["classes.Game"]=Sh;Sh.__name__="classes.Game";Sh.prototype=
{onopen:function(){Ka.trace("WS OPENED",{fileName:"src/client/src/classes/Game.hx",lineNumber:30,className:"classes.Game",methodName:"onopen"});Ca(Qc.Spawn,["ok"]);Ca(Qc.Spawn,["ok"]);Ca(Qc.Spawn,["ok"]);Ca(Qc.Spawn,["ok"]);Ca(Qc.Spawn,["ok"])},onerror:function(a){},onclose:function(){},onmessage:function(a){switch(a._hx_index){case 0:3==mc(a.content)._hx_index?this.Packets_Ping():Ka.trace("unknown packet inbound!!",{fileName:"src/client/src/classes/Game.hx",lineNumber:57,className:"classes.Game",
methodName:"onmessage"});break;case 1:Ka.trace("waht????"+a.content,{fileName:"src/client/src/classes/Game.hx",lineNumber:61,className:"classes.Game",methodName:"onmessage"})}},Packets_Ping:function(){Ka.trace("WOAHHHHHHHHH PING PACKET SO COOL!!!",{fileName:"src/client/src/classes/Game.hx",lineNumber:67,className:"classes.Game",methodName:"Packets_Ping"})},__class__:Sh};var ye=function(){};z["h3d.IDrawable"]=ye;ye.__name__="h3d.IDrawable";ye.__isInterface__=!0;ye.prototype={__class__:ye};var Td=function(){var a=
this,b=na.CURRENT;null!=b?(this.engine=b,b.onReady=M(this,this.setup),Ad.delay(M(this,this.setup),0)):ia.start(function(){b=new na;a.engine=b;b.onReady=M(a,a.setup);b.init()})};z["hxd.App"]=Td;Td.__name__="hxd.App";Td.__interfaces__=[ye];Td.staticHandler=function(){};Td.prototype={onResize:function(){},setScene:function(a,b){null==b&&(b=!0);var c=a instanceof he?a:null,d=a instanceof ld?a:null;null!=c?(this.sevents.removeScene(this.s2d),this.sevents.addScene(a,0)):null!=d&&(this.sevents.removeScene(this.s3d),
this.sevents.addScene(a));if(b)if(null!=c)this.s2d.dispose();else if(null!=d)this.s3d.dispose();else throw u.thrown("Can't dispose previous scene");null!=c&&(this.s2d=c);null!=d&&(this.s3d=d)},setCurrent:function(){var a=this;this.engine=na.CURRENT;this.isDisposed=!1;this.engine.onReady=Td.staticHandler;this.engine.onContextLost=M(this,this.onContextLost);this.engine.onResized=function(){null!=a.s2d&&(a.s2d.checkResize(),a.onResize())};ia.setLoop(M(this,this.mainLoop))},onContextLost:function(){if(null!=
this.s3d)this.s3d.onContextLost()},setScene2D:function(a,b){null==b&&(b=!0);this.sevents.removeScene(this.s2d);this.sevents.addScene(a,0);b&&this.s2d.dispose();this.s2d=a;a.mark=M(this,this.mark)},setScene3D:function(a,b){null==b&&(b=!0);this.sevents.removeScene(this.s3d);this.sevents.addScene(a);b&&this.s3d.dispose();this.s3d=a},render:function(a){this.s3d.render(a);this.s2d.render(a)},mark:function(a){this.s3d.mark(a)},setup:function(){var a=this,b=!1;this.engine.onReady=Td.staticHandler;this.engine.onContextLost=
M(this,this.onContextLost);this.engine.onResized=function(){if(null!=a.s2d&&(a.s2d.checkResize(),b))a.onResize()};this.s3d=new ld;this.s2d=new he;this.s2d.mark=M(this,this.mark);this.sevents=new Uh;this.sevents.addScene(this.s2d);this.sevents.addScene(this.s3d);this.loadAssets(function(){b=!0;a.init();ba.skip();a.mainLoop();ia.setLoop(M(a,a.mainLoop));H.initialize()})},dispose:function(){this.engine.onResized=Td.staticHandler;this.engine.onContextLost=Td.staticHandler;this.isDisposed=!0;null!=this.s2d&&
this.s2d.dispose();null!=this.s3d&&this.s3d.dispose();null!=this.sevents&&this.sevents.dispose()},loadAssets:function(a){a()},init:function(){},mainLoop:function(){ba.update();this.sevents.checkEvents();if(!this.isDisposed&&(this.update(ba.dt),!this.isDisposed)){var a=ba.dt;null!=this.s2d&&this.s2d.setElapsedTime(a);null!=this.s3d&&this.s3d.setElapsedTime(a);this.engine.render(this)}},update:function(a){},__class__:Td};var Mg=function(){Td.call(this);this.camera=new Vh};z["classes.Render"]=Mg;Mg.__name__=
"classes.Render";Mg.__super__=Td;Mg.prototype=J(Td.prototype,{init:function(){this.background=new ze(this.s2d);this.renderBackground();this.grid=new ze(this.s2d);this.renderGridLines();this.font=Ng.get();var a=this.fpsText=new Og(this.font,this.s2d);a.posChanged=!0;a.x=10;a=this.fpsText;a.posChanged=!0;a.y=10;this.fpsText.set_text("FPS: --")},update:function(a){0==this.lastFrameCall&&(this.lastFrameCall=a);this.delta=a-this.lastFrameCall;this.lastFrameCall=a;0<this.delta&&this.fpsText.set_text("FPS: "+
(1E3/this.delta|0));H.isDown(87)&&(this.camera.y-=50);H.isDown(83)&&(this.camera.y+=50);H.isDown(65)&&(this.camera.x-=50);H.isDown(68)&&(this.camera.x+=50);a=this.background;a.posChanged=!0;a.x=-this.camera.x;a=this.background;a.posChanged=!0;a.y=-this.camera.y;a=this.grid;a.posChanged=!0;a.x=-this.camera.x;a=this.grid;a.posChanged=!0;a.y=-this.camera.y},renderPlayers:function(){},renderBackground:function(){this.background.clear();this.background.beginFill(16579837);this.background.drawRect(0,0,
md.MapSize,md.SnowBiomeY);this.background.endFill();this.background.beginFill(7856737);this.background.drawRect(0,md.SnowBiomeY,md.MapSize,md.MapSize-md.SnowBiomeY);this.background.endFill();this.background.beginFill(2298960,.3);this.background.drawRect(0,0,md.MapSize,md.MapSize);this.background.endFill()},renderGridLines:function(){this.grid.clear();this.grid.lineStyle(4,0,.06);for(var a=0;a<md.MapSize;){var b=this.grid;b.flush();b.addVertex(0,a,b.curR,b.curG,b.curB,b.curA,0*b.ma+a*b.mc+b.mx,0*b.mb+
a*b.md+b.my);b=this.grid;var c=md.MapSize;b.addVertex(c,a,b.curR,b.curG,b.curB,b.curA,c*b.ma+a*b.mc+b.mx,c*b.mb+a*b.md+b.my);a+=md.GridBoxSize}for(a=0;a<md.MapSize;)b=this.grid,b.flush(),b.addVertex(a,0,b.curR,b.curG,b.curB,b.curA,a*b.ma+0*b.mc+b.mx,a*b.mb+0*b.md+b.my),b=this.grid,c=md.MapSize,b.addVertex(a,c,b.curR,b.curG,b.curB,b.curA,a*b.ma+c*b.mc+b.mx,a*b.mb+c*b.md+b.my),a+=md.GridBoxSize},lerp:function(a,b,c){return a+(b-a)*c},__class__:Mg});var Vh=function(){this.x=-260;this.y=160};z["classes.Camera"]=
Vh;Vh.__name__="classes.Camera";Vh.prototype={__class__:Vh};var nd=L["format.gif.Block"]={__ename__:!0,__constructs__:null,BFrame:(A=function(a){return{_hx_index:0,frame:a,__enum__:"format.gif.Block",toString:v}},A._hx_name="BFrame",A.__params__=["frame"],A),BExtension:(A=function(a){return{_hx_index:1,extension:a,__enum__:"format.gif.Block",toString:v}},A._hx_name="BExtension",A.__params__=["extension"],A),BEOF:{_hx_name:"BEOF",_hx_index:2,__enum__:"format.gif.Block",toString:v}};nd.__constructs__=
[nd.BFrame,nd.BExtension,nd.BEOF];nd.__empty_constructs__=[nd.BEOF];var Ud=L["format.gif.Extension"]={__ename__:!0,__constructs__:null,EGraphicControl:(A=function(a){return{_hx_index:0,gce:a,__enum__:"format.gif.Extension",toString:v}},A._hx_name="EGraphicControl",A.__params__=["gce"],A),EComment:(A=function(a){return{_hx_index:1,text:a,__enum__:"format.gif.Extension",toString:v}},A._hx_name="EComment",A.__params__=["text"],A),EText:(A=function(a){return{_hx_index:2,pte:a,__enum__:"format.gif.Extension",
toString:v}},A._hx_name="EText",A.__params__=["pte"],A),EApplicationExtension:(A=function(a){return{_hx_index:3,ext:a,__enum__:"format.gif.Extension",toString:v}},A._hx_name="EApplicationExtension",A.__params__=["ext"],A),EUnknown:(A=function(a,b){return{_hx_index:4,id:a,data:b,__enum__:"format.gif.Extension",toString:v}},A._hx_name="EUnknown",A.__params__=["id","data"],A)};Ud.__constructs__=[Ud.EGraphicControl,Ud.EComment,Ud.EText,Ud.EApplicationExtension,Ud.EUnknown];Ud.__empty_constructs__=[];
var Pg=L["format.gif.ApplicationExtension"]={__ename__:!0,__constructs__:null,AENetscapeLooping:(A=function(a){return{_hx_index:0,loops:a,__enum__:"format.gif.ApplicationExtension",toString:v}},A._hx_name="AENetscapeLooping",A.__params__=["loops"],A),AEUnknown:(A=function(a,b,c){return{_hx_index:1,name:a,version:b,data:c,__enum__:"format.gif.ApplicationExtension",toString:v}},A._hx_name="AEUnknown",A.__params__=["name","version","data"],A)};Pg.__constructs__=[Pg.AENetscapeLooping,Pg.AEUnknown];Pg.__empty_constructs__=
[];var ie=L["format.gif.Version"]={__ename__:!0,__constructs__:null,GIF87a:{_hx_name:"GIF87a",_hx_index:0,__enum__:"format.gif.Version",toString:v},GIF89a:{_hx_name:"GIF89a",_hx_index:1,__enum__:"format.gif.Version",toString:v},Unknown:(A=function(a){return{_hx_index:2,version:a,__enum__:"format.gif.Version",toString:v}},A._hx_name="Unknown",A.__params__=["version"],A)};ie.__constructs__=[ie.GIF87a,ie.GIF89a,ie.Unknown];ie.__empty_constructs__=[ie.GIF87a,ie.GIF89a];var uc=L["format.gif.DisposalMethod"]=
{__ename__:!0,__constructs__:null,UNSPECIFIED:{_hx_name:"UNSPECIFIED",_hx_index:0,__enum__:"format.gif.DisposalMethod",toString:v},NO_ACTION:{_hx_name:"NO_ACTION",_hx_index:1,__enum__:"format.gif.DisposalMethod",toString:v},FILL_BACKGROUND:{_hx_name:"FILL_BACKGROUND",_hx_index:2,__enum__:"format.gif.DisposalMethod",toString:v},RENDER_PREVIOUS:{_hx_name:"RENDER_PREVIOUS",_hx_index:3,__enum__:"format.gif.DisposalMethod",toString:v},UNDEFINED:(A=function(a){return{_hx_index:4,index:a,__enum__:"format.gif.DisposalMethod",
toString:v}},A._hx_name="UNDEFINED",A.__params__=["index"],A)};uc.__constructs__=[uc.UNSPECIFIED,uc.NO_ACTION,uc.FILL_BACKGROUND,uc.RENDER_PREVIOUS,uc.UNDEFINED];uc.__empty_constructs__=[uc.UNSPECIFIED,uc.NO_ACTION,uc.FILL_BACKGROUND,uc.RENDER_PREVIOUS];var Wh=function(a){this.i=a;a.set_bigEndian(!1)};z["format.gif.Reader"]=Wh;Wh.__name__="format.gif.Reader";Wh.prototype={read:function(){var a=71;if(this.i.readByte()!=a)throw u.thrown("Invalid header");a=73;if(this.i.readByte()!=a)throw u.thrown("Invalid header");
a=70;if(this.i.readByte()!=a)throw u.thrown("Invalid header");var b=this.i.readString(3);switch(b){case "87a":b=ie.GIF87a;break;case "89a":b=ie.GIF89a;break;default:b=ie.Unknown(b)}a=this.i.readUInt16();var c=this.i.readUInt16(),d=this.i.readByte(),e=this.i.readByte(),f=this.i.readByte();c={width:a,height:c,hasGlobalColorTable:128==(d&128),colorResolution:(d&112)>>>4,sorted:8==(d&8),globalColorTableSize:2<<(d&7),backgroundColorIndex:e,pixelAspectRatio:0!=f?(f+15)/64:1};d=null;c.hasGlobalColorTable&&
(d=this.readColorTable(c.globalColorTableSize));for(e=new nc;a=this.readBlock(),e.add(a),a!=nd.BEOF;);return{version:b,logicalScreenDescriptor:c,globalColorTable:d,blocks:e}},readBlock:function(){switch(this.i.readByte()){case 33:return this.readExtension();case 44:return this.readImage()}return nd.BEOF},readImage:function(){var a=this.i.readUInt16(),b=this.i.readUInt16(),c=this.i.readUInt16(),d=this.i.readUInt16(),e=this.i.readByte(),f=128==(e&128),g=64==(e&64),h=32==(e&32);e=2<<(e&7);var k=null;
f&&(k=this.readColorTable(e));return nd.BFrame({x:a,y:b,width:c,height:d,localColorTable:f,interlaced:g,sorted:h,localColorTableSize:e,pixels:this.readPixels(c,d,g),colorTable:k})},readPixels:function(a,b,c){var d,e=this.i,f=a*b,g=new S(new ArrayBuffer(f)),h=e.readByte(),k=e.readByte()-1,l=e.readByte(),m=8,p=1<<h,t=p+1,n=h+1,r=1<<n,y=r-1,G=[];for(d=0;d<p;){var q=d++;G[q]=[q]}for(var v=[],w=p+2,x,A=q=0;q<f;){for(d=A;m<n&&0!=k;)l|=e.readByte()<<m,m+=8,--k,0==k&&(k=e.readByte());A=l&y;l>>=n;m-=n;if(A==
p)v=G.slice(),w=p+2,n=h+1,r=1<<n,y=r-1;else{if(A==t)break;if(A<w)d!=p&&(x=v[d].slice(),x.push(v[A][0]),v[w++]=x);else{if(A!=w)throw u.thrown("Invalid LZW code. Excepted: "+w+", got: "+A);x=v[d].slice();x.push(x[0]);v[w++]=x}x=v[A];for(d=0;d<x.length;){var z=x[d];++d;g.b[q++]=z}w==r&&12>n&&(++n,r=1<<n,y=r-1)}}for(;0<k;)e.readByte(),--k,0==k&&(k=e.readByte());for(;q<f;)g.b[q++]=0;c&&(c=new S(new ArrayBuffer(f)),q=this.deinterlace(g,c,8,0,0,a,b),q=this.deinterlace(g,c,8,4,q,a,b),q=this.deinterlace(g,
c,4,2,q,a,b),this.deinterlace(g,c,2,1,q,a,b),g=c);return g},deinterlace:function(a,b,c,d,e,f,g){for(;d<g;)b.blit(d*f,a,e,f),e+=f,d+=c;return e},readExtension:function(){var a=this.i.readByte();switch(a){case 1:if(12!=this.i.readByte())throw u.thrown("Incorrect size of Plain Text Extension introducer block.");a=this.i.readUInt16();for(var b=this.i.readUInt16(),c=this.i.readUInt16(),d=this.i.readUInt16(),e=this.i.readByte(),f=this.i.readByte(),g=this.i.readByte(),h=this.i.readByte(),k=new Rc,l=new S(new ArrayBuffer(255)),
m=this.i.readByte();0!=m;)this.i.readBytes(l,0,m),k.writeBytes(l,0,m),m=this.i.readByte();k.flush();l=k.getBytes();k.close();return nd.BExtension(Ud.EText({textGridX:a,textGridY:b,textGridWidth:c,textGridHeight:d,charCellWidth:e,charCellHeight:f,textForegroundColorIndex:g,textBackgroundColorIndex:h,text:l.toString()}));case 249:if(4!=this.i.readByte())throw u.thrown("Incorrect Graphic Control Extension block size!");k=this.i.readByte();switch((k&28)>>2){case 0:l=uc.UNSPECIFIED;break;case 1:l=uc.NO_ACTION;
break;case 2:l=uc.FILL_BACKGROUND;break;case 3:l=uc.RENDER_PREVIOUS;break;default:l=uc.UNDEFINED((k&28)>>2)}k=nd.BExtension(Ud.EGraphicControl({disposalMethod:l,userInput:2==(k&2),hasTransparentColor:1==(k&1),delay:this.i.readUInt16(),transparentIndex:this.i.readByte()}));this.i.readByte();return k;case 254:k=new Rc;l=new S(new ArrayBuffer(255));for(m=this.i.readByte();0!=m;)this.i.readBytes(l,0,m),k.writeBytes(l,0,m),m=this.i.readByte();k.flush();l=k.getBytes();k.close();return nd.BExtension(Ud.EComment(l.toString()));
case 255:return this.readApplicationExtension();default:k=new Rc;l=new S(new ArrayBuffer(255));for(m=this.i.readByte();0!=m;)this.i.readBytes(l,0,m),k.writeBytes(l,0,m),m=this.i.readByte();k.flush();l=k.getBytes();k.close();return nd.BExtension(Ud.EUnknown(a,l))}},readApplicationExtension:function(){if(11!=this.i.readByte())throw u.thrown("Incorrect size of Application Extension introducer block.");for(var a=this.i.readString(8),b=this.i.readString(3),c=new Rc,d=new S(new ArrayBuffer(255)),e=this.i.readByte();0!=
e;)this.i.readBytes(d,0,e),c.writeBytes(d,0,e),e=this.i.readByte();c.flush();d=c.getBytes();c.close();c=d;return"NETSCAPE"==a&&"2.0"==b&&1==c.b[0]?nd.BExtension(Ud.EApplicationExtension(Pg.AENetscapeLooping(c.b[1]|c.b[2]<<8))):nd.BExtension(Ud.EApplicationExtension(Pg.AEUnknown(a,b,c)))},readBlocks:function(){for(var a=new Rc,b=new S(new ArrayBuffer(255)),c=this.i.readByte();0!=c;)this.i.readBytes(b,0,c),a.writeBytes(b,0,c),c=this.i.readByte();a.flush();b=a.getBytes();a.close();return b},readColorTable:function(a){a*=
3;for(var b=new S(new ArrayBuffer(a)),c=0;c<a;){var d=this.i.readByte();b.b[c]=d;d=this.i.readByte();b.b[c+1]=d;d=this.i.readByte();b.b[c+2]=d;c+=3}return b},__class__:Wh};var od=function(){};z["format.gif.Tools"]=od;od.__name__="format.gif.Tools";od.framesCount=function(a){var b=0;for(a=a.blocks.h;null!=a;){var c=a.item;a=a.next;0==c._hx_index&&++b}return b};od.frame=function(a,b){var c=0;for(a=a.blocks.h;null!=a;){var d=a.item;a=a.next;if(0==d._hx_index){d=d.frame;if(c==b)return d;++c}}return null};
od.graphicControl=function(a,b){var c=0,d=null;for(a=a.blocks.h;null!=a;){var e=a.item;a=a.next;switch(e._hx_index){case 0:if(c==b)return d;d=null;++c;break;case 1:e=e.extension,0==e._hx_index&&(d=e.gce)}}return null};od.extractBGRA=function(a,b){for(var c=null,d=0,e=a.blocks.h;null!=e;){var f=e.item;e=e.next;switch(f._hx_index){case 0:f=f.frame;if(d==b){b=new S(new ArrayBuffer(f.width*f.height*4));a=f.localColorTable?f.colorTable:a.globalColorTable;if(null==a)throw u.thrown("Frame does not have a color table!");
c=null!=c&&c.hasTransparentColor?3*c.transparentIndex:-1;e=d=0;for(var g=f.pixels.length;e<g;){var h=e++;h=3*f.pixels.b[h];b.b[d]=a.b[h+2];b.b[d+1]=a.b[h+1];b.b[d+2]=a.b[h];b.b[d+3]=c==h?0:255;d+=4}return b}++d;c=null;break;case 1:f=f.extension,0==f._hx_index&&(c=f.gce)}}return null};od.extractRGBA=function(a,b){for(var c=null,d=0,e=a.blocks.h;null!=e;){var f=e.item;e=e.next;switch(f._hx_index){case 0:f=f.frame;if(d==b){b=new S(new ArrayBuffer(f.width*f.height*4));a=f.localColorTable?f.colorTable:
a.globalColorTable;if(null==a)throw u.thrown("Frame does not have a color table!");c=null!=c&&c.hasTransparentColor?3*c.transparentIndex:-1;e=d=0;for(var g=f.pixels.length;e<g;){var h=e++;h=3*f.pixels.b[h];b.b[d]=a.b[h];b.b[d+1]=a.b[h+1];b.b[d+2]=a.b[h+2];b.b[d+3]=c==h?0:255;d+=4}return b}++d;c=null;break;case 1:f=f.extension,0==f._hx_index&&(c=f.gce)}}return null};od.extractFullBGRA=function(a,b){for(var c=null,d=0,e=new S(new ArrayBuffer(a.logicalScreenDescriptor.width*a.logicalScreenDescriptor.height*
4)),f=a.blocks.h;null!=f;){var g=f.item;f=f.next;switch(g._hx_index){case 0:g=g.frame;var h=g.localColorTable?g.colorTable:a.globalColorTable;if(null==h)throw u.thrown("Frame does not have a color table!");var k=null!=c&&c.hasTransparentColor?3*c.transparentIndex:-1,l=g.pixels,m=0,p=4*(g.y*a.logicalScreenDescriptor.width+g.x),t=4*(a.logicalScreenDescriptor.width-g.width)+4;switch((d!=b&&null!=c?c.disposalMethod:uc.NO_ACTION)._hx_index){case 2:h=0;for(l=l.length;h<l;)h++,e.b[p]=0,e.b[p+1]=0,e.b[p+
2]=0,e.b[p+3]=0,++m==g.width?(m=0,p+=t):p+=4;break;case 3:break;default:c=0;for(var n=l.length;c<n;){var r=c++;r=3*l.b[r];k!=r&&(e.b[p]=h.b[r+2],e.b[p+1]=h.b[r+1],e.b[p+2]=h.b[r],e.b[p+3]=255);++m==g.width?(m=0,p+=t):p+=4}}if(d==b)return e;++d;c=null;break;case 1:g=g.extension,0==g._hx_index&&(c=g.gce)}}return e};od.extractFullRGBA=function(a,b){for(var c=null,d=0,e=new S(new ArrayBuffer(a.logicalScreenDescriptor.width*a.logicalScreenDescriptor.height*4)),f=a.blocks.h;null!=f;){var g=f.item;f=f.next;
switch(g._hx_index){case 0:g=g.frame;var h=g.localColorTable?g.colorTable:a.globalColorTable;if(null==h)throw u.thrown("Frame does not have a color table!");var k=null!=c&&c.hasTransparentColor?3*c.transparentIndex:-1,l=g.pixels,m=0,p=4*(g.y*a.logicalScreenDescriptor.width+g.x),t=4*(a.logicalScreenDescriptor.width-g.width)+4;switch((d!=b&&null!=c?c.disposalMethod:uc.NO_ACTION)._hx_index){case 2:h=0;for(l=l.length;h<l;)h++,e.b[p]=0,e.b[p+1]=0,e.b[p+2]=0,e.b[p+3]=0,++m==g.width?(m=0,p+=t):p+=4;break;
case 3:break;default:c=0;for(var n=l.length;c<n;){var r=c++;r=3*l.b[r];k!=r&&(e.b[p]=h.b[r],e.b[p+1]=h.b[r+1],e.b[p+2]=h.b[r+2],e.b[p+3]=255);++m==g.width?(m=0,p+=t):p+=4}}if(d==b)return e;++d;c=null;break;case 1:g=g.extension,0==g._hx_index&&(c=g.gce)}}return e};od.loopCount=function(a){for(a=a.blocks.h;null!=a;){var b=a.item;a=a.next;if(1==b._hx_index&&(b=b.extension,3==b._hx_index&&(b=b.ext,0==b._hx_index)))return b.loops}return 1};od.log2=function(a){return Math.log(a)/od.LN2};var Ba=L["format.mp3.SamplingRate"]=
{__ename__:!0,__constructs__:null,SR_8000:{_hx_name:"SR_8000",_hx_index:0,__enum__:"format.mp3.SamplingRate",toString:v},SR_11025:{_hx_name:"SR_11025",_hx_index:1,__enum__:"format.mp3.SamplingRate",toString:v},SR_12000:{_hx_name:"SR_12000",_hx_index:2,__enum__:"format.mp3.SamplingRate",toString:v},SR_22050:{_hx_name:"SR_22050",_hx_index:3,__enum__:"format.mp3.SamplingRate",toString:v},SR_24000:{_hx_name:"SR_24000",_hx_index:4,__enum__:"format.mp3.SamplingRate",toString:v},SR_32000:{_hx_name:"SR_32000",
_hx_index:5,__enum__:"format.mp3.SamplingRate",toString:v},SR_44100:{_hx_name:"SR_44100",_hx_index:6,__enum__:"format.mp3.SamplingRate",toString:v},SR_48000:{_hx_name:"SR_48000",_hx_index:7,__enum__:"format.mp3.SamplingRate",toString:v},SR_Bad:{_hx_name:"SR_Bad",_hx_index:8,__enum__:"format.mp3.SamplingRate",toString:v}};Ba.__constructs__=[Ba.SR_8000,Ba.SR_11025,Ba.SR_12000,Ba.SR_22050,Ba.SR_24000,Ba.SR_32000,Ba.SR_44100,Ba.SR_48000,Ba.SR_Bad];Ba.__empty_constructs__=[Ba.SR_8000,Ba.SR_11025,Ba.SR_12000,
Ba.SR_22050,Ba.SR_24000,Ba.SR_32000,Ba.SR_44100,Ba.SR_48000,Ba.SR_Bad];var E=L["format.mp3.Bitrate"]={__ename__:!0,__constructs__:null,BR_8:{_hx_name:"BR_8",_hx_index:0,__enum__:"format.mp3.Bitrate",toString:v},BR_16:{_hx_name:"BR_16",_hx_index:1,__enum__:"format.mp3.Bitrate",toString:v},BR_24:{_hx_name:"BR_24",_hx_index:2,__enum__:"format.mp3.Bitrate",toString:v},BR_32:{_hx_name:"BR_32",_hx_index:3,__enum__:"format.mp3.Bitrate",toString:v},BR_40:{_hx_name:"BR_40",_hx_index:4,__enum__:"format.mp3.Bitrate",
toString:v},BR_48:{_hx_name:"BR_48",_hx_index:5,__enum__:"format.mp3.Bitrate",toString:v},BR_56:{_hx_name:"BR_56",_hx_index:6,__enum__:"format.mp3.Bitrate",toString:v},BR_64:{_hx_name:"BR_64",_hx_index:7,__enum__:"format.mp3.Bitrate",toString:v},BR_80:{_hx_name:"BR_80",_hx_index:8,__enum__:"format.mp3.Bitrate",toString:v},BR_96:{_hx_name:"BR_96",_hx_index:9,__enum__:"format.mp3.Bitrate",toString:v},BR_112:{_hx_name:"BR_112",_hx_index:10,__enum__:"format.mp3.Bitrate",toString:v},BR_128:{_hx_name:"BR_128",
_hx_index:11,__enum__:"format.mp3.Bitrate",toString:v},BR_144:{_hx_name:"BR_144",_hx_index:12,__enum__:"format.mp3.Bitrate",toString:v},BR_160:{_hx_name:"BR_160",_hx_index:13,__enum__:"format.mp3.Bitrate",toString:v},BR_176:{_hx_name:"BR_176",_hx_index:14,__enum__:"format.mp3.Bitrate",toString:v},BR_192:{_hx_name:"BR_192",_hx_index:15,__enum__:"format.mp3.Bitrate",toString:v},BR_224:{_hx_name:"BR_224",_hx_index:16,__enum__:"format.mp3.Bitrate",toString:v},BR_256:{_hx_name:"BR_256",_hx_index:17,__enum__:"format.mp3.Bitrate",
toString:v},BR_288:{_hx_name:"BR_288",_hx_index:18,__enum__:"format.mp3.Bitrate",toString:v},BR_320:{_hx_name:"BR_320",_hx_index:19,__enum__:"format.mp3.Bitrate",toString:v},BR_352:{_hx_name:"BR_352",_hx_index:20,__enum__:"format.mp3.Bitrate",toString:v},BR_384:{_hx_name:"BR_384",_hx_index:21,__enum__:"format.mp3.Bitrate",toString:v},BR_416:{_hx_name:"BR_416",_hx_index:22,__enum__:"format.mp3.Bitrate",toString:v},BR_448:{_hx_name:"BR_448",_hx_index:23,__enum__:"format.mp3.Bitrate",toString:v},BR_Free:{_hx_name:"BR_Free",
_hx_index:24,__enum__:"format.mp3.Bitrate",toString:v},BR_Bad:{_hx_name:"BR_Bad",_hx_index:25,__enum__:"format.mp3.Bitrate",toString:v}};E.__constructs__=[E.BR_8,E.BR_16,E.BR_24,E.BR_32,E.BR_40,E.BR_48,E.BR_56,E.BR_64,E.BR_80,E.BR_96,E.BR_112,E.BR_128,E.BR_144,E.BR_160,E.BR_176,E.BR_192,E.BR_224,E.BR_256,E.BR_288,E.BR_320,E.BR_352,E.BR_384,E.BR_416,E.BR_448,E.BR_Free,E.BR_Bad];E.__empty_constructs__=[E.BR_8,E.BR_16,E.BR_24,E.BR_32,E.BR_40,E.BR_48,E.BR_56,E.BR_64,E.BR_80,E.BR_96,E.BR_112,E.BR_128,
E.BR_144,E.BR_160,E.BR_176,E.BR_192,E.BR_224,E.BR_256,E.BR_288,E.BR_320,E.BR_352,E.BR_384,E.BR_416,E.BR_448,E.BR_Free,E.BR_Bad];var Za=function(){};z["format.mp3.MPEG"]=Za;Za.__name__="format.mp3.MPEG";Za.enum2Num=function(a){switch(a._hx_index){case 0:return 3;case 1:return 2;case 2:return 0;case 3:return Za.Reserved}};Za.num2Enum=function(a){switch(a){case 0:return pd.MPEG_V25;case 2:return pd.MPEG_V2;case 3:return pd.MPEG_V1;default:return pd.MPEG_Reserved}};Za.srNum2Enum=function(a){switch(a){case 8E3:return Ba.SR_8000;
case 11025:return Ba.SR_11025;case 12E3:return Ba.SR_12000;case 22050:return Ba.SR_22050;case 24E3:return Ba.SR_24000;case 32E3:return Ba.SR_32000;case 44100:return Ba.SR_44100;case 48E3:return Ba.SR_48000;default:return Ba.SR_Bad}};Za.srEnum2Num=function(a){switch(a._hx_index){case 0:return 8E3;case 1:return 11025;case 2:return 12E3;case 3:return 22050;case 4:return 24E3;case 5:return 32E3;case 6:return 44100;case 7:return 48E3;case 8:return-1}};Za.getBitrateIdx=function(a,b,c){b=(b==pd.MPEG_V1?
Za.V1_Bitrates:Za.V2_Bitrates)[Yb.enum2Num(c)];if(b[0]==a)return 0;if(b[1]==a)return 1;if(b[2]==a)return 2;if(b[3]==a)return 3;if(b[4]==a)return 4;if(b[5]==a)return 5;if(b[6]==a)return 6;if(b[7]==a)return 7;if(b[8]==a)return 8;if(b[9]==a)return 9;if(b[10]==a)return 10;if(b[11]==a)return 11;if(b[12]==a)return 12;if(b[13]==a)return 13;if(b[14]==a)return 14;if(b[15]==a)return 15;throw u.thrown("Bitrate index not found");};Za.getSamplingRateIdx=function(a,b){b=Za.SamplingRates[Za.enum2Num(b)];if(b[0]==
a)return 0;if(b[1]==a)return 1;if(b[2]==a)return 2;if(b[3]==a)return 3;throw u.thrown("Sampling rate index not found");};Za.bitrateEnum2Num=function(a){switch(a._hx_index){case 0:return 8;case 1:return 16;case 2:return 24;case 3:return 32;case 4:return 40;case 5:return 48;case 6:return 56;case 7:return 64;case 8:return 80;case 9:return 96;case 10:return 112;case 11:return 128;case 12:return 144;case 13:return 160;case 14:return 176;case 15:return 192;case 16:return 224;case 17:return 256;case 18:return 288;
case 19:return 320;case 20:return 352;case 21:return 384;case 22:return 416;case 23:return 448;case 24:return 0;case 25:return-1}};Za.bitrateNum2Enum=function(a){switch(a){case 0:return E.BR_Free;case 8:return E.BR_8;case 16:return E.BR_16;case 24:return E.BR_24;case 32:return E.BR_32;case 40:return E.BR_40;case 48:return E.BR_48;case 56:return E.BR_56;case 64:return E.BR_64;case 80:return E.BR_80;case 96:return E.BR_96;case 112:return E.BR_112;case 128:return E.BR_128;case 144:return E.BR_144;case 160:return E.BR_160;
case 176:return E.BR_176;case 192:return E.BR_192;case 224:return E.BR_224;case 256:return E.BR_256;case 288:return E.BR_288;case 320:return E.BR_320;case 352:return E.BR_352;case 384:return E.BR_384;case 416:return E.BR_416;case 448:return E.BR_448;default:return E.BR_Bad}};var Yb=function(){};z["format.mp3.CLayer"]=Yb;Yb.__name__="format.mp3.CLayer";Yb.enum2Num=function(a){switch(a._hx_index){case 0:return Yb.LReserved;case 1:return Yb.LLayer3;case 2:return Yb.LLayer2;case 3:return Yb.LLayer1}};
Yb.num2Enum=function(a){switch(a){case 1:return oc.Layer3;case 2:return oc.Layer2;case 3:return oc.Layer1;default:return oc.LayerReserved}};var $e=function(){};z["format.mp3.CChannelMode"]=$e;$e.__name__="format.mp3.CChannelMode";$e.enum2Num=function(a){switch(a._hx_index){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3}};$e.num2Enum=function(a){switch(a){case 0:return Sc.Stereo;case 1:return Sc.JointStereo;case 2:return Sc.DualChannel;case 3:return Sc.Mono;default:throw u.thrown("assert");
}};var Bd=function(){};z["format.mp3.CEmphasis"]=Bd;Bd.__name__="format.mp3.CEmphasis";Bd.enum2Num=function(a){switch(a._hx_index){case 0:return 0;case 1:return 1;case 2:return 3;case 3:return 2}};Bd.num2Enum=function(a){switch(a){case 0:return Tc.NoEmphasis;case 1:return Tc.Ms50_15;case 2:return Tc.InvalidEmphasis;case 3:return Tc.CCIT_J17;default:throw u.thrown("assert");}};var pd=L["format.mp3.MPEGVersion"]={__ename__:!0,__constructs__:null,MPEG_V1:{_hx_name:"MPEG_V1",_hx_index:0,__enum__:"format.mp3.MPEGVersion",
toString:v},MPEG_V2:{_hx_name:"MPEG_V2",_hx_index:1,__enum__:"format.mp3.MPEGVersion",toString:v},MPEG_V25:{_hx_name:"MPEG_V25",_hx_index:2,__enum__:"format.mp3.MPEGVersion",toString:v},MPEG_Reserved:{_hx_name:"MPEG_Reserved",_hx_index:3,__enum__:"format.mp3.MPEGVersion",toString:v}};pd.__constructs__=[pd.MPEG_V1,pd.MPEG_V2,pd.MPEG_V25,pd.MPEG_Reserved];pd.__empty_constructs__=[pd.MPEG_V1,pd.MPEG_V2,pd.MPEG_V25,pd.MPEG_Reserved];var oc=L["format.mp3.Layer"]={__ename__:!0,__constructs__:null,LayerReserved:{_hx_name:"LayerReserved",
_hx_index:0,__enum__:"format.mp3.Layer",toString:v},Layer3:{_hx_name:"Layer3",_hx_index:1,__enum__:"format.mp3.Layer",toString:v},Layer2:{_hx_name:"Layer2",_hx_index:2,__enum__:"format.mp3.Layer",toString:v},Layer1:{_hx_name:"Layer1",_hx_index:3,__enum__:"format.mp3.Layer",toString:v}};oc.__constructs__=[oc.LayerReserved,oc.Layer3,oc.Layer2,oc.Layer1];oc.__empty_constructs__=[oc.LayerReserved,oc.Layer3,oc.Layer2,oc.Layer1];var Sc=L["format.mp3.ChannelMode"]={__ename__:!0,__constructs__:null,Stereo:{_hx_name:"Stereo",
_hx_index:0,__enum__:"format.mp3.ChannelMode",toString:v},JointStereo:{_hx_name:"JointStereo",_hx_index:1,__enum__:"format.mp3.ChannelMode",toString:v},DualChannel:{_hx_name:"DualChannel",_hx_index:2,__enum__:"format.mp3.ChannelMode",toString:v},Mono:{_hx_name:"Mono",_hx_index:3,__enum__:"format.mp3.ChannelMode",toString:v}};Sc.__constructs__=[Sc.Stereo,Sc.JointStereo,Sc.DualChannel,Sc.Mono];Sc.__empty_constructs__=[Sc.Stereo,Sc.JointStereo,Sc.DualChannel,Sc.Mono];var Tc=L["format.mp3.Emphasis"]=
{__ename__:!0,__constructs__:null,NoEmphasis:{_hx_name:"NoEmphasis",_hx_index:0,__enum__:"format.mp3.Emphasis",toString:v},Ms50_15:{_hx_name:"Ms50_15",_hx_index:1,__enum__:"format.mp3.Emphasis",toString:v},CCIT_J17:{_hx_name:"CCIT_J17",_hx_index:2,__enum__:"format.mp3.Emphasis",toString:v},InvalidEmphasis:{_hx_name:"InvalidEmphasis",_hx_index:3,__enum__:"format.mp3.Emphasis",toString:v}};Tc.__constructs__=[Tc.NoEmphasis,Tc.Ms50_15,Tc.CCIT_J17,Tc.InvalidEmphasis];Tc.__empty_constructs__=[Tc.NoEmphasis,
Tc.Ms50_15,Tc.CCIT_J17,Tc.InvalidEmphasis];var Ae=L["format.mp3.FrameType"]={__ename__:!0,__constructs__:null,FT_MP3:{_hx_name:"FT_MP3",_hx_index:0,__enum__:"format.mp3.FrameType",toString:v},FT_NONE:{_hx_name:"FT_NONE",_hx_index:1,__enum__:"format.mp3.FrameType",toString:v}};Ae.__constructs__=[Ae.FT_MP3,Ae.FT_NONE];Ae.__empty_constructs__=[Ae.FT_MP3,Ae.FT_NONE];var Yh=function(a){this.i=a;a.set_bigEndian(!0);this.bits=new Xh(a);this.sampleSize=this.samples=0;this.any_read=!1};z["format.mp3.Reader"]=
Yh;Yh.__name__="format.mp3.Reader";Yh.prototype={skipID3v2:function(){this.id3v2_version=this.i.readUInt16();this.id3v2_flags=this.i.readByte();var a=this.i.readByte()&127;a=a<<7|this.i.readByte()&127;a=a<<7|this.i.readByte()&127;a=a<<7|this.i.readByte()&127;this.id3v2_data=this.i.read(a)},seekFrame:function(){try{for(var a;;)if(a=this.i.readByte(),this.any_read||(this.any_read=!0,73==a&&(a=this.i.readByte(),68==a&&(a=this.i.readByte(),51==a&&this.skipID3v2()))),255==a&&(this.bits.nbits=0,a=this.bits.readBits(3),
7==a))return Ae.FT_MP3}catch(b){if(u.caught(b).unwrap()instanceof Fc)return Ae.FT_NONE;throw b;}},readFrames:function(){for(var a=[],b;;){b=this.seekFrame();if(b==Ae.FT_NONE)break;switch(b._hx_index){case 0:b=this.readFrame(),null!=b&&a.push(b)}}return a},readFrameHeader:function(){var a=this.bits.readBits(2),b=this.bits.readBits(2),c=!this.bits.readBit();if(a==Za.Reserved||b==Yb.LReserved)return null;var d=this.bits.readBits(4);d=Uc.getBitrate(a,b,d);var e=this.bits.readBits(2);e=Uc.getSamplingRate(a,
e);var f=this.bits.readBit(),g=this.bits.readBit();if(d==E.BR_Bad||d==E.BR_Free||e==Ba.SR_Bad)return null;var h=this.bits.readBits(2),k=this.bits.readBit(),l=this.bits.readBit(),m=this.bits.readBit(),p=this.bits.readBit(),t=this.bits.readBits(2),n=0;c&&(n=this.i.readUInt16());return{version:Za.num2Enum(a),layer:Yb.num2Enum(b),hasCrc:c,crc16:n,bitrate:d,samplingRate:e,isPadded:f,privateBit:g,channelMode:$e.num2Enum(h),isIntensityStereo:k,isMSStereo:l,isCopyrighted:m,isOriginal:p,emphasis:Bd.num2Enum(t)}},
readFrame:function(){var a=this.readFrameHeader();if(null==a||Uc.isInvalidFrameHeader(a))return null;try{var b=this.i.read(Uc.getSampleDataSizeHdr(a));this.samples+=Uc.getSampleCountHdr(a);this.sampleSize+=b.length;return{header:a,data:b}}catch(c){if(u.caught(c).unwrap()instanceof Fc)return null;throw c;}},read:function(){return{frames:this.readFrames(),sampleCount:this.samples,sampleSize:this.sampleSize,id3v2:null==this.id3v2_data?null:{versionBytes:this.id3v2_version,flagByte:this.id3v2_flags,data:this.id3v2_data}}},
__class__:Yh};var Uc=function(){};z["format.mp3.Tools"]=Uc;Uc.__name__="format.mp3.Tools";Uc.getBitrate=function(a,b,c){return a==Za.Reserved||b==Yb.LReserved?E.BR_Bad:(3==a?Za.V1_Bitrates:Za.V2_Bitrates)[b][c]};Uc.getSamplingRate=function(a,b){return Za.SamplingRates[a][b]};Uc.isInvalidFrameHeader=function(a){return a.version!=pd.MPEG_Reserved&&a.layer!=oc.LayerReserved&&a.bitrate!=E.BR_Bad&&a.bitrate!=E.BR_Free?a.samplingRate==Ba.SR_Bad:!0};Uc.getSampleDataSize=function(a,b,c,d,e){return((3==a?
144:72)*b*1E3/c|0)+(d?1:0)-(e?2:0)-4};Uc.getSampleDataSizeHdr=function(a){return Uc.getSampleDataSize(Za.enum2Num(a.version),Za.bitrateEnum2Num(a.bitrate),Za.srEnum2Num(a.samplingRate),a.isPadded,a.hasCrc)};Uc.getSampleCount=function(a){return 3==a?1152:576};Uc.getSampleCountHdr=function(a){return Uc.getSampleCount(Za.enum2Num(a.version))};Uc.getFrameInfo=function(a){return w.string(a.header.version)+", "+w.string(a.header.layer)+", "+w.string(a.header.channelMode)+", "+w.string(a.header.samplingRate)+
" Hz, "+w.string(a.header.bitrate)+" kbps Emphasis: "+w.string(a.header.emphasis)+", "+(a.header.hasCrc?"(CRC) ":"")+(a.header.isPadded?"(Padded) ":"")+(a.header.isIntensityStereo?"(Intensity Stereo) ":"")+(a.header.isMSStereo?"(MS Stereo) ":"")+(a.header.isCopyrighted?"(Copyrighted) ":"")+(a.header.isOriginal?"(Original) ":"")};var Vc=L["format.png.Color"]={__ename__:!0,__constructs__:null,ColGrey:(A=function(a){return{_hx_index:0,alpha:a,__enum__:"format.png.Color",toString:v}},A._hx_name="ColGrey",
A.__params__=["alpha"],A),ColTrue:(A=function(a){return{_hx_index:1,alpha:a,__enum__:"format.png.Color",toString:v}},A._hx_name="ColTrue",A.__params__=["alpha"],A),ColIndexed:{_hx_name:"ColIndexed",_hx_index:2,__enum__:"format.png.Color",toString:v}};Vc.__constructs__=[Vc.ColGrey,Vc.ColTrue,Vc.ColIndexed];Vc.__empty_constructs__=[Vc.ColIndexed];var Oa=L["format.png.Chunk"]={__ename__:!0,__constructs__:null,CEnd:{_hx_name:"CEnd",_hx_index:0,__enum__:"format.png.Chunk",toString:v},CHeader:(A=function(a){return{_hx_index:1,
h:a,__enum__:"format.png.Chunk",toString:v}},A._hx_name="CHeader",A.__params__=["h"],A),CData:(A=function(a){return{_hx_index:2,b:a,__enum__:"format.png.Chunk",toString:v}},A._hx_name="CData",A.__params__=["b"],A),CPalette:(A=function(a){return{_hx_index:3,b:a,__enum__:"format.png.Chunk",toString:v}},A._hx_name="CPalette",A.__params__=["b"],A),CUnknown:(A=function(a,b){return{_hx_index:4,id:a,data:b,__enum__:"format.png.Chunk",toString:v}},A._hx_name="CUnknown",A.__params__=["id","data"],A)};Oa.__constructs__=
[Oa.CEnd,Oa.CHeader,Oa.CData,Oa.CPalette,Oa.CUnknown];Oa.__empty_constructs__=[Oa.CEnd];var Zh=function(a){this.i=a;a.set_bigEndian(!0);this.checkCRC=!0};z["format.png.Reader"]=Zh;Zh.__name__="format.png.Reader";Zh.prototype={read:function(){var a=137;if(this.i.readByte()!=a)throw u.thrown("Invalid header");a=80;if(this.i.readByte()!=a)throw u.thrown("Invalid header");a=78;if(this.i.readByte()!=a)throw u.thrown("Invalid header");a=71;if(this.i.readByte()!=a)throw u.thrown("Invalid header");a=13;if(this.i.readByte()!=
a)throw u.thrown("Invalid header");a=10;if(this.i.readByte()!=a)throw u.thrown("Invalid header");a=26;if(this.i.readByte()!=a)throw u.thrown("Invalid header");a=10;if(this.i.readByte()!=a)throw u.thrown("Invalid header");for(a=new nc;;){var b=this.readChunk();a.add(b);if(b==Oa.CEnd)break}return a},readHeader:function(a){a.set_bigEndian(!0);var b=a.readInt32(),c=a.readInt32(),d=a.readByte(),e=a.readByte();switch(e){case 0:e=Vc.ColGrey(!1);break;case 2:e=Vc.ColTrue(!1);break;case 3:e=Vc.ColIndexed;
break;case 4:e=Vc.ColGrey(!0);break;case 6:e=Vc.ColTrue(!0);break;default:throw u.thrown("Unknown color model "+e+":"+d);}var f=a.readByte(),g=a.readByte();if(0!=f||0!=g)throw u.thrown("Invalid header");a=a.readByte();if(0!=a&&1!=a)throw u.thrown("Invalid header");return{width:b,height:c,colbits:d,color:e,interlaced:1==a}},readChunk:function(){var a=this.i.readInt32(),b=this.i.readString(4);a=this.i.read(a);var c=this.i.readInt32();if(this.checkCRC){var d=-1;var e=(d^D.cca(b,0))&255;e=e>>>1^-(e&1)&
-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;d=d>>>8^e>>>1^-(e&1)&-306674912;e=(d^D.cca(b,1))&255;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;d=d>>>8^e>>>1^-(e&1)&-306674912;e=(d^D.cca(b,2))&255;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;
e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;d=d>>>8^e>>>1^-(e&1)&-306674912;e=(d^D.cca(b,3))&255;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;e=e>>>1^-(e&1)&-306674912;d=d>>>8^e>>>1^-(e&1)&-306674912;for(var f=a.b.bufferValue,g=0,h=a.length;g<h;)e=g++,e=(d^f.bytes[e])&255,e=e>>>1^-(e&1)&-306674912,e=e>>>
1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,e=e>>>1^-(e&1)&-306674912,d=d>>>8^e;if((d^-1)!=c)throw u.thrown("CRC check failure");}switch(b){case "IDAT":return Oa.CData(a);case "IEND":return Oa.CEnd;case "IHDR":return Oa.CHeader(this.readHeader(new Zb(a)));case "PLTE":return Oa.CPalette(a);default:return Oa.CUnknown(b,a)}},__class__:Zh};var Hb=function(){};z["format.png.Tools"]=Hb;Hb.__name__=
"format.png.Tools";Hb.getHeader=function(a){for(a=a.h;null!=a;){var b=a.item;a=a.next;if(1==b._hx_index)return b.h}throw u.thrown("Header not found");};Hb.getPalette=function(a){for(a=a.h;null!=a;){var b=a.item;a=a.next;if(3==b._hx_index)return b.b}return null};Hb.filter=function(a,b,c,d,e,f,g){null==g&&(g=4);var h=0==c?0:a.b[f-d];a=0==b||0==c?0:a.b[f-d-g];d=e+h-a;b=d-e;0>b&&(b=-b);c=d-h;0>c&&(c=-c);d-=a;0>d&&(d=-d);return b<=c&&b<=d?e:c<=d?h:a};Hb.reverseBytes=function(a){for(var b=0,c=0,d=a.length>>
2;c<d;){c++;var e=a.b[b],f=a.b[b+1],g=a.b[b+2],h=a.b[b+3];a.b[b++]=h;a.b[b++]=g;a.b[b++]=f;a.b[b++]=e}};Hb.extractGrey=function(a){var b=Hb.getHeader(a),c=new S(new ArrayBuffer(b.width*b.height)),d=null,e=null;for(a=a.h;null!=a;){var f=a.item;a=a.next;var g=f;if(2==g._hx_index){var h=g.b;null!=e?e.add(h):null==d?d=h:(e=new Vd,e.add(d),e.add(h),d=null)}}null!=e&&(d=e.getBytes());if(null==d)throw u.thrown("Data not found");d=Qg.run(d);a=e=0;var k=b.color;if(0==k._hx_index){k=k.alpha;if(8!=b.colbits)throw u.thrown("Unsupported color mode");
f=b.width;if(d.length<b.height*((k?2:1)*f+1))throw u.thrown("Not enough data");var l=k?2:1;k=0;for(b=b.height;k<b;){var m=k++;h=d.b[e++];switch(h){case 0:h=0;for(m=f;h<m;)h++,g=d.b[e],e+=l,c.b[a++]=g;break;case 1:m=h=0;for(g=f;m<g;)m++,h+=d.b[e],e+=l,c.b[a++]=h;break;case 2:h=0==m?0:f;m=0;for(g=f;m<g;){m++;var p=d.b[e]+c.b[a-h];e+=l;c.b[a++]=p}break;case 3:h=0;m=0==m?0:f;g=0;for(p=f;g<p;)g++,h=d.b[e]+(h+c.b[a-m]>>1)&255,e+=l,c.b[a++]=h;break;case 4:p=f;for(var t=0,n=0,r=f;n<r;){g=n++;var y=1;null==
y&&(y=4);h=0==m?0:c.b[a-p];g=0==g||0==m?0:c.b[a-p-y];var G=t+h-g;y=G-t;0>y&&(y=-y);var q=G-h;0>q&&(q=-q);G-=g;0>G&&(G=-G);t=(y<=q&&y<=G?t:q<=G?h:g)+d.b[e]&255;e+=l;c.b[a++]=t}break;default:throw u.thrown("Invalid filter "+h);}}}else throw u.thrown("Unsupported color mode");return c};Hb.extract32=function(a,b,c){var d,e,f,g,h,k,l,m,p,t,n,r,y=Hb.getHeader(a),G=null==b?new S(new ArrayBuffer(y.width*y.height*4)):b,q=null,v=null;for(k=a.h;null!=k;){var w=k.item;k=k.next;var x=w;if(2==x._hx_index){var A=
x.b;null!=v?v.add(A):null==q?q=A:(v=new Vd,v.add(q),v.add(A),q=null)}}null!=v&&(q=v.getBytes());if(null==q)throw u.thrown("Data not found");q=Qg.run(q);var z=e=0,B=0;c&&(B=8*-y.width,z=4*(y.height-1)*y.width);var C=c?-1:1;var Wd=y.color;switch(Wd._hx_index){case 0:var zb=Wd.alpha;if(8!=y.colbits)throw u.thrown("Unsupported color mode");var E=y.width;var D=(zb?2:1)*E+1;if(q.length<y.height*D)throw u.thrown("Not enough data");var K=-1;if(!zb)for(k=a.h;null!=k;){w=k.item;k=k.next;var H=w;if(4==H._hx_index&&
"tRNS"==H.id){var J=H.data;2<=J.length&&(K=J.b[1]);break}}var I=0;for(d=y.height;I<d;){var F=I++;var M=q.b[e++];switch(M){case 0:if(zb){var L=0;for(h=E;L<h;){L++;var N=q.b[e++];G.b[z++]=N;G.b[z++]=N;G.b[z++]=N;G.b[z++]=q.b[e++]}}else{var Q=0;for(g=E;Q<g;){Q++;var T=q.b[e++];G.b[z++]=T;G.b[z++]=T;G.b[z++]=T;G.b[z++]=T==K?0:255}}break;case 1:var O=0;var P=0;if(zb){var W=0;for(f=E;W<f;)W++,O+=q.b[e++],G.b[z++]=O,G.b[z++]=O,G.b[z++]=O,P+=q.b[e++],G.b[z++]=P}else{var U=0;for(r=E;U<r;){var R=U++;O+=q.b[e++];
G.b[z++]=O;G.b[z++]=O;G.b[z++]=O;G.b[z++]=O==K?0:255}}break;case 2:D=0==F?0:4*E*C;if(zb){var V=0;for(n=E;V<n;){V++;var X=q.b[e++]+G.b[z-D];G.b[z++]=X;G.b[z++]=X;G.b[z++]=X;var aa=q.b[e++]+G.b[z-D];G.b[z++]=aa}}else{var Y=0;for(t=E;Y<t;){Y++;var ha=q.b[e++]+G.b[z-D];G.b[z++]=ha;G.b[z++]=ha;G.b[z++]=ha;G.b[z++]=ha==K?0:255}}break;case 3:var ba=0,ja=0;var ca=0==F?0:4*E*C;if(zb){var da=0;for(p=E;da<p;)da++,ba=q.b[e++]+(ba+G.b[z-ca]>>1)&255,G.b[z++]=ba,G.b[z++]=ba,G.b[z++]=ba,ja=q.b[e++]+(ja+G.b[z-ca]>>
1)&255,G.b[z++]=ja}else{var ma=0;for(m=E;ma<m;)ma++,ba=q.b[e++]+(ba+G.b[z-ca]>>1)&255,G.b[z++]=ba,G.b[z++]=ba,G.b[z++]=ba,G.b[z++]=ba==K?0:255}break;case 4:var Z=4*E*C;var ea=0,ka=0;if(zb){var sa=0;for(l=E;sa<l;){var ra=sa++;A=0==F?0:G.b[z-Z];x=0==ra||0==F?0:G.b[z-Z-4];var na=ea+A-x;var fa=na-ea;0>fa&&(fa=-fa);var ia=na-A;0>ia&&(ia=-ia);var la=na-x;0>la&&(la=-la);var va=e++;ea=(fa<=ia&&fa<=la?ea:ia<=la?A:x)+q.b[va]&255;G.b[z++]=ea;G.b[z++]=ea;G.b[z++]=ea;var ya=0==F?0:G.b[z-Z];var ua=0==ra||0==F?
0:G.b[z-Z-4];var xa=ka+ya-ua;var pa=xa-ka;0>pa&&(pa=-pa);var wa=xa-ya;0>wa&&(wa=-wa);var ta=xa-ua;0>ta&&(ta=-ta);var Fa=e++;ka=(pa<=wa&&pa<=ta?ka:wa<=ta?ya:ua)+q.b[Fa]&255;G.b[z++]=ka}}else{var Ba=0;for(var Ga=E;Ba<Ga;){var Ja=Ba++;var Ea=0==F?0:G.b[z-Z];var Aa=0==Ja||0==F?0:G.b[z-Z-4];var Ha=ea+Ea-Aa;var Ca=Ha-ea;0>Ca&&(Ca=-Ca);var Da=Ha-Ea;0>Da&&(Da=-Da);var za=Ha-Aa;0>za&&(za=-za);var Ma=e++;ea=(Ca<=Da&&Ca<=za?ea:Da<=za?Ea:Aa)+q.b[Ma]&255;G.b[z++]=ea;G.b[z++]=ea;G.b[z++]=ea;G.b[z++]=ea==K?0:255}}break;
default:throw u.thrown("Invalid filter "+M);}z+=B}break;case 1:zb=Wd.alpha;if(8!=y.colbits)throw u.thrown("Unsupported color mode");E=y.width;D=(zb?4:3)*E+1;if(q.length<y.height*D)throw u.thrown("Not enough data");var Ka=-1,La=-1,Ia=-1;if(!zb)for(k=a.h;null!=k;)if(w=k.item,k=k.next,H=w,4==H._hx_index&&"tRNS"==H.id){J=H.data;6<=J.length&&(Ka=J.b[1],La=J.b[3],Ia=J.b[5]);break}var Eb=0,oa=0,qa=0;Wd=P=0;for(I=y.height;Wd<I;){F=Wd++;M=q.b[e++];switch(M){case 0:if(zb)for(d=0,L=E;d<L;)d++,G.b[z++]=q.b[e+
2],G.b[z++]=q.b[e+1],G.b[z++]=q.b[e],G.b[z++]=q.b[e+3],e+=4;else for(h=0,Q=E;h<Q;)h++,qa=q.b[e+2],G.b[z++]=qa,oa=q.b[e+1],G.b[z++]=oa,Eb=q.b[e],G.b[z++]=Eb,G.b[z++]=Eb==Ka&&oa==La&&qa==Ia?0:255,e+=3;break;case 1:Eb=oa=qa=P=0;if(zb)for(g=0,W=E;g<W;)g++,qa+=q.b[e+2],G.b[z++]=qa,oa+=q.b[e+1],G.b[z++]=oa,Eb+=q.b[e],G.b[z++]=Eb,P+=q.b[e+3],G.b[z++]=P,e+=4;else for(f=0,U=E;f<U;)R=f++,qa+=q.b[e+2],G.b[z++]=qa,oa+=q.b[e+1],G.b[z++]=oa,Eb+=q.b[e],G.b[z++]=Eb,G.b[z++]=Eb==Ka&&oa==La&&qa==Ia?0:255,e+=3;break;
case 2:D=0==F?0:4*E*C;if(zb)for(r=0,V=E;r<V;)r++,G.b[z]=q.b[e+2]+G.b[z-D],++z,G.b[z]=q.b[e+1]+G.b[z-D],++z,G.b[z]=q.b[e]+G.b[z-D],++z,G.b[z]=q.b[e+3]+G.b[z-D],++z,e+=4;else for(n=0,Y=E;n<Y;)n++,qa=q.b[e+2]+G.b[z-D],G.b[z]=qa,++z,oa=q.b[e+1]+G.b[z-D],G.b[z]=oa,++z,Eb=q.b[e]+G.b[z-D],G.b[z]=Eb,++z,G.b[z++]=Eb==Ka&&oa==La&&qa==Ia?0:255,e+=3;break;case 3:Eb=oa=qa=P=0;ca=0==F?0:4*E*C;if(zb)for(t=0,da=E;t<da;)t++,qa=q.b[e+2]+(qa+G.b[z-ca]>>1)&255,G.b[z++]=qa,oa=q.b[e+1]+(oa+G.b[z-ca]>>1)&255,G.b[z++]=oa,
Eb=q.b[e]+(Eb+G.b[z-ca]>>1)&255,G.b[z++]=Eb,P=q.b[e+3]+(P+G.b[z-ca]>>1)&255,G.b[z++]=P,e+=4;else for(p=0,ma=E;p<ma;)p++,qa=q.b[e+2]+(qa+G.b[z-ca]>>1)&255,G.b[z++]=qa,oa=q.b[e+1]+(oa+G.b[z-ca]>>1)&255,G.b[z++]=oa,Eb=q.b[e]+(Eb+G.b[z-ca]>>1)&255,G.b[z++]=Eb,G.b[z++]=Eb==Ka&&oa==La&&qa==Ia?0:255,e+=3;break;case 4:Z=4*E*C;Eb=oa=qa=P=0;if(zb)for(m=0,sa=E;m<sa;){ra=m++;A=0==F?0:G.b[z-Z];x=0==ra||0==F?0:G.b[z-Z-4];na=qa+A-x;fa=na-qa;0>fa&&(fa=-fa);ia=na-A;0>ia&&(ia=-ia);la=na-x;0>la&&(la=-la);qa=(fa<=ia&&
fa<=la?qa:ia<=la?A:x)+q.b[e+2]&255;G.b[z++]=qa;ya=0==F?0:G.b[z-Z];ua=0==ra||0==F?0:G.b[z-Z-4];xa=oa+ya-ua;pa=xa-oa;0>pa&&(pa=-pa);wa=xa-ya;0>wa&&(wa=-wa);ta=xa-ua;0>ta&&(ta=-ta);oa=(pa<=wa&&pa<=ta?oa:wa<=ta?ya:ua)+q.b[e+1]&255;G.b[z++]=oa;Ea=0==F?0:G.b[z-Z];Aa=0==ra||0==F?0:G.b[z-Z-4];Ha=Eb+Ea-Aa;Ca=Ha-Eb;0>Ca&&(Ca=-Ca);Da=Ha-Ea;0>Da&&(Da=-Da);za=Ha-Aa;0>za&&(za=-za);Eb=(Ca<=Da&&Ca<=za?Eb:Da<=za?Ea:Aa)+q.b[e]&255;G.b[z++]=Eb;var Qa=0==F?0:G.b[z-Z];var Na=0==ra||0==F?0:G.b[z-Z-4];var Ta=P+Qa-Na,Ua=
Ta-P;0>Ua&&(Ua=-Ua);var Ra=Ta-Qa;0>Ra&&(Ra=-Ra);var Sa=Ta-Na;0>Sa&&(Sa=-Sa);P=(Ua<=Ra&&Ua<=Sa?P:Ra<=Sa?Qa:Na)+q.b[e+3]&255;G.b[z++]=P;e+=4}else for(l=0,Ba=E;l<Ba;){Ja=l++;var $a=0==F?0:G.b[z-Z],db=0==Ja||0==F?0:G.b[z-Z-4],eb=qa+$a-db,Za=eb-qa;0>Za&&(Za=-Za);var Wa=eb-$a;0>Wa&&(Wa=-Wa);var Ya=eb-db;0>Ya&&(Ya=-Ya);qa=(Za<=Wa&&Za<=Ya?qa:Wa<=Ya?$a:db)+q.b[e+2]&255;G.b[z++]=qa;var ab=0==F?0:G.b[z-Z],fb=0==Ja||0==F?0:G.b[z-Z-4],bb=oa+ab-fb,Xa=bb-oa;0>Xa&&(Xa=-Xa);var cb=bb-ab;0>cb&&(cb=-cb);var ib=bb-fb;
0>ib&&(ib=-ib);oa=(Xa<=cb&&Xa<=ib?oa:cb<=ib?ab:fb)+q.b[e+1]&255;G.b[z++]=oa;var kb=0==F?0:G.b[z-Z],lb=0==Ja||0==F?0:G.b[z-Z-4],mb=Eb+kb-lb,Oa=mb-Eb;0>Oa&&(Oa=-Oa);var Pa=mb-kb;0>Pa&&(Pa=-Pa);var jb=mb-lb;0>jb&&(jb=-jb);Eb=(Oa<=Pa&&Oa<=jb?Eb:Pa<=jb?kb:lb)+q.b[e]&255;G.b[z++]=Eb;G.b[z++]=Eb==Ka&&oa==La&&qa==Ia?0:255;e+=3}break;default:throw u.thrown("Invalid filter "+M);}z+=B}break;case 2:var hb=Hb.getPalette(a);if(null==hb)throw u.thrown("PNG Palette is missing");zb=null;for(k=a.h;null!=k;)if(w=k.item,
k=k.next,H=w,4==H._hx_index&&"tRNS"==H.id){zb=J=H.data;break}if(null!=zb&&zb.length<1<<y.colbits){var ob=new S(new ArrayBuffer(1<<y.colbits));ob.blit(0,zb,0,zb.length);ob.fill(zb.length,ob.length-zb.length,255);zb=ob}E=y.width;D=Math.ceil(E*y.colbits/8)+1;if(q.length<y.height*D)throw u.thrown("Not enough data");var sb=D-1;Wd=0;for(I=y.height;Wd<I;)if(F=Wd++,M=q.b[e++],0==M)e+=sb;else switch(M){case 1:d=x=0;for(L=E;d<L;)d++,N=q.b[e],x+=N,q.b[e++]=x&255;break;case 2:D=0==F?0:sb+1;h=0;for(Q=E;h<Q;)h++,
T=q.b[e],q.b[e]=T+q.b[e-D],++e;break;case 3:ua=0;ca=0==F?0:sb+1;g=0;for(W=E;g<W;)g++,X=q.b[e],ua=X+(ua+q.b[e-ca]>>1)&255,q.b[e++]=ua;break;case 4:Z=sb+1;f=Aa=0;for(U=E;f<U;){R=f++;ha=q.b[e];var Va=1;null==Va&&(Va=4);A=0==F?0:q.b[e-Z];Na=0==R||0==F?0:q.b[e-Z-Va];na=Aa+A-Na;fa=na-Aa;0>fa&&(fa=-fa);ia=na-A;0>ia&&(ia=-ia);la=na-Na;0>la&&(la=-la);Aa=(fa<=ia&&fa<=la?Aa:ia<=la?A:Na)+ha&255;q.b[e++]=Aa}break;default:throw u.thrown("Invalid filter "+M);}e=0;if(8==y.colbits)for(Wd=0,I=y.height;Wd<I;){F=Wd++;
++e;d=0;for(L=y.width;d<L;)d++,x=q.b[e++],G.b[z++]=hb.b[3*x+2],G.b[z++]=hb.b[3*x+1],G.b[z++]=hb.b[3*x],G.b[z++]=null!=zb?zb.b[x]:255;z+=B}else if(8>y.colbits){var nb=y.colbits,tb=(1<<nb)-1;Wd=0;for(I=y.height;Wd<I;){F=Wd++;++e;var gb=0,pb=0;d=0;for(L=y.width;d<L;)d++,pb<nb&&(gb=gb<<8|q.b[e++],pb+=8),x=gb>>>pb-nb&tb,pb-=nb,G.b[z++]=hb.b[3*x+2],G.b[z++]=hb.b[3*x+1],G.b[z++]=hb.b[3*x],G.b[z++]=null!=zb?zb.b[x]:255;z+=B}}else throw u.thrown(y.colbits+" indexed bits per pixel not supported");}return G};
Hb.extract=function(a,b,c){null==c&&(c=!1);var d=Hb.getHeader(a),e=!1;var f=d.color;switch(f._hx_index){case 0:var g=f.alpha;var h=(e=g)?2:1;break;case 1:h=(e=g=f.alpha)?4:3;break;case 2:throw u.thrown("assert");}c&&e&&(c=!1);e=d.colbits>>3;g=c?h+1:h;null==b&&(b=new S(new ArrayBuffer(g*e*d.width*d.height)));var k=null;f=null;for(a=a.h;null!=a;){var l=a.item;a=a.next;var m=l;if(2==m._hx_index){var p=m.b;null!=f?f.add(p):null==k?k=p:(f=new Vd,f.add(k),f.add(p),k=null)}}null!=f&&(k=f.getBytes());if(null==
k)throw u.thrown("Data not found");k=Qg.run(k);a=l=0;var t=d.width,n=h*e,r=g*e*t,y=g*e;if(k.length<d.height*(n*t+1))throw u.thrown("Not enough data");f=[];h=0;for(m=n;h<m;)h++,f.push(0);var G=f;f=0;for(h=d.height;f<h;){var q=f++,v=k.b[l++];if(0!=v&&2!=v){m=0;for(var w=n;m<w;)p=m++,G[p]=0}switch(v){case 0:p=0;for(q=t;p<q;){p++;m=0;for(v=n;m<v;)m++,b.b[a++]=k.b[l++];c&&(b.b[a++]=255,2==e&&(b.b[a++]=255))}break;case 1:p=0;for(q=t;p<q;){p++;m=0;for(v=n;m<v;)w=m++,G[w]+=k.b[l++],b.b[a++]=G[w];c&&(b.b[a++]=
255,2==e&&(b.b[a++]=255))}break;case 2:p=0==q?0:r;q=0;for(m=t;q<m;){q++;v=0;for(w=n;v<w;){v++;var x=k.b[l++]+b.b[a-p];b.b[a++]=x}c&&(b.b[a++]=255,2==e&&(b.b[a++]=255))}break;case 3:p=0==q?0:r;q=0;for(m=t;q<m;){q++;v=0;for(w=n;v<w;)x=v++,G[x]=k.b[l++]+(G[x]+b.b[a-p]>>1)&255,b.b[a++]=G[x];c&&(b.b[a++]=255,2==e&&(b.b[a++]=255))}break;case 4:v=0;for(w=t;v<w;){x=v++;for(var z=0,A=n;z<A;){var B=z++,C=G[B];p=0==q?0:b.b[a-r];m=0==x||0==q?0:b.b[a-r-y];var E=C+p-m,zb=E-C;0>zb&&(zb=-zb);var D=E-p;0>D&&(D=-D);
E-=m;0>E&&(E=-E);var F=l++;G[B]=(zb<=D&&zb<=E?C:D<=E?p:m)+k.b[F]&255;b.b[a++]=G[B]}c&&(b.b[a++]=255,2==e&&(b.b[a++]=255))}break;default:throw u.thrown("Invalid filter "+v);}}if(16==d.colbits)for(f=a=0,h=d.height*t*g;f<h;)f++,c=b.b[a],p=b.b[a+1],b.b[a++]=p,b.b[a++]=c;return b};Hb.buildGrey=function(a,b,c,d){null==d&&(d=9);for(var e=new S(new ArrayBuffer(a*b+b)),f=0,g=0,h=0;h<b;){h++;for(var k=e.b[f++]=0,l=a;k<l;)k++,e.b[f++]=c.b[g++]}c=new nc;c.add(Oa.CHeader({width:a,height:b,colbits:8,color:Vc.ColGrey(!1),
interlaced:!1}));c.add(Oa.CData(of.run(e,d)));c.add(Oa.CEnd);return c};Hb.buildIndexed=function(a,b,c,d,e){null==e&&(e=9);for(var f=new S(new ArrayBuffer(a*b+b)),g=0,h=0,k=0;k<b;){k++;for(var l=f.b[g++]=0,m=a;l<m;)l++,f.b[g++]=c.b[h++]}c=new nc;c.add(Oa.CHeader({width:a,height:b,colbits:8,color:Vc.ColIndexed,interlaced:!1}));c.add(Oa.CPalette(d));c.add(Oa.CData(of.run(f,e)));c.add(Oa.CEnd);return c};Hb.buildRGB=function(a,b,c,d){null==d&&(d=9);for(var e=new S(new ArrayBuffer(a*b*3+b)),f=0,g=0,h=0;h<
b;){h++;for(var k=e.b[f++]=0,l=a;k<l;)k++,e.b[f++]=c.b[g+2],e.b[f++]=c.b[g+1],e.b[f++]=c.b[g],g+=3}c=new nc;c.add(Oa.CHeader({width:a,height:b,colbits:8,color:Vc.ColTrue(!1),interlaced:!1}));c.add(Oa.CData(of.run(e,d)));c.add(Oa.CEnd);return c};Hb.build32ARGB=function(a,b,c,d){null==d&&(d=9);for(var e=new S(new ArrayBuffer(a*b*4+b)),f=0,g=0,h=0;h<b;){h++;for(var k=e.b[f++]=0,l=a;k<l;)k++,e.b[f++]=c.b[g+1],e.b[f++]=c.b[g+2],e.b[f++]=c.b[g+3],e.b[f++]=c.b[g],g+=4}c=new nc;c.add(Oa.CHeader({width:a,
height:b,colbits:8,color:Vc.ColTrue(!0),interlaced:!1}));c.add(Oa.CData(of.run(e,d)));c.add(Oa.CEnd);return c};Hb.build32BGRA=function(a,b,c,d){null==d&&(d=9);for(var e=new S(new ArrayBuffer(a*b*4+b)),f=0,g=0,h=0;h<b;){h++;for(var k=e.b[f++]=0,l=a;k<l;)k++,e.b[f++]=c.b[g+2],e.b[f++]=c.b[g+1],e.b[f++]=c.b[g],e.b[f++]=c.b[g+3],g+=4}c=new nc;c.add(Oa.CHeader({width:a,height:b,colbits:8,color:Vc.ColTrue(!0),interlaced:!1}));c.add(Oa.CData(of.run(e,d)));c.add(Oa.CEnd);return c};var $h=function(a){this.o=
a;a.set_bigEndian(!0)};z["format.png.Writer"]=$h;$h.__name__="format.png.Writer";$h.prototype={write:function(a){this.o.writeByte(137);this.o.writeByte(80);this.o.writeByte(78);this.o.writeByte(71);this.o.writeByte(13);this.o.writeByte(10);this.o.writeByte(26);this.o.writeByte(10);for(a=a.h;null!=a;){var b=a.item;a=a.next;switch(b._hx_index){case 0:this.writeChunk("IEND",new S(new ArrayBuffer(0)));break;case 1:var c=b.h;b=new Rc;b.set_bigEndian(!0);b.writeInt32(c.width);b.writeInt32(c.height);b.writeByte(c.colbits);
var d=c.color;switch(d._hx_index){case 0:var e=d.alpha?4:0;break;case 1:e=d.alpha?6:2;break;case 2:e=3}b.writeByte(e);b.writeByte(0);b.writeByte(0);b.writeByte(c.interlaced?1:0);this.writeChunk("IHDR",b.getBytes());break;case 2:this.writeChunk("IDAT",b.b);break;case 3:this.writeChunk("PLTE",b.b);break;case 4:this.writeChunk(b.id,b.data)}}},writeChunk:function(a,b){this.o.writeInt32(b.length);this.o.writeString(a);this.o.write(b);var c=-1;var d=(c^D.cca(a,0))&255;d=d>>>1^-(d&1)&-306674912;d=d>>>1^
-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;c=c>>>8^d>>>1^-(d&1)&-306674912;d=(c^D.cca(a,1))&255;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;c=c>>>8^d>>>1^-(d&1)&-306674912;d=(c^D.cca(a,2))&255;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&
-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;c=c>>>8^d>>>1^-(d&1)&-306674912;d=(c^D.cca(a,3))&255;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;d=d>>>1^-(d&1)&-306674912;c=c>>>8^d>>>1^-(d&1)&-306674912;a=b.b.bufferValue;var e=0;for(b=b.length;e<b;)d=e++,d=(c^a.bytes[d])&255,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,
d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,d=d>>>1^-(d&1)&-306674912,c=c>>>8^d;this.o.writeInt32(c^-1)},__class__:$h};var qd=L["format.tga.ImageOrigin"]={__ename__:!0,__constructs__:null,BottomLeft:{_hx_name:"BottomLeft",_hx_index:0,__enum__:"format.tga.ImageOrigin",toString:v},BottomRight:{_hx_name:"BottomRight",_hx_index:1,__enum__:"format.tga.ImageOrigin",toString:v},TopLeft:{_hx_name:"TopLeft",_hx_index:2,__enum__:"format.tga.ImageOrigin",
toString:v},TopRight:{_hx_name:"TopRight",_hx_index:3,__enum__:"format.tga.ImageOrigin",toString:v}};qd.__constructs__=[qd.BottomLeft,qd.BottomRight,qd.TopLeft,qd.TopRight];qd.__empty_constructs__=[qd.BottomLeft,qd.BottomRight,qd.TopLeft,qd.TopRight];var Ab=L["format.tga.ImageType"]={__ename__:!0,__constructs__:null,NoImage:{_hx_name:"NoImage",_hx_index:0,__enum__:"format.tga.ImageType",toString:v},UncompressedColorMapped:{_hx_name:"UncompressedColorMapped",_hx_index:1,__enum__:"format.tga.ImageType",
toString:v},UncompressedTrueColor:{_hx_name:"UncompressedTrueColor",_hx_index:2,__enum__:"format.tga.ImageType",toString:v},UncompressedBlackAndWhite:{_hx_name:"UncompressedBlackAndWhite",_hx_index:3,__enum__:"format.tga.ImageType",toString:v},RunLengthColorMapped:{_hx_name:"RunLengthColorMapped",_hx_index:4,__enum__:"format.tga.ImageType",toString:v},RunLengthTrueColor:{_hx_name:"RunLengthTrueColor",_hx_index:5,__enum__:"format.tga.ImageType",toString:v},RunLengthBlackAndWhite:{_hx_name:"RunLengthBlackAndWhite",
_hx_index:6,__enum__:"format.tga.ImageType",toString:v},Unknown:(A=function(a){return{_hx_index:7,type:a,__enum__:"format.tga.ImageType",toString:v}},A._hx_name="Unknown",A.__params__=["type"],A)};Ab.__constructs__=[Ab.NoImage,Ab.UncompressedColorMapped,Ab.UncompressedTrueColor,Ab.UncompressedBlackAndWhite,Ab.RunLengthColorMapped,Ab.RunLengthTrueColor,Ab.RunLengthBlackAndWhite,Ab.Unknown];Ab.__empty_constructs__=[Ab.NoImage,Ab.UncompressedColorMapped,Ab.UncompressedTrueColor,Ab.UncompressedBlackAndWhite,
Ab.RunLengthColorMapped,Ab.RunLengthTrueColor,Ab.RunLengthBlackAndWhite];var ai=function(a){this.i=a;a.set_bigEndian(!1)};z["format.tga.Reader"]=ai;ai.__name__="format.tga.Reader";ai.prototype={read:function(){var a=this.i.readByte(),b=this.readHeader();a=0==a?"":this.i.readString(a);var c=this.readColorMapData(b);return{header:b,imageId:a,colorMapData:c,imageData:this.readImageData(b,c),developerData:null}},readHeader:function(){var a=this.i.readByte();var b=this.i.readByte();switch(b){case 0:b=
Ab.NoImage;break;case 1:b=Ab.UncompressedColorMapped;break;case 2:b=Ab.UncompressedTrueColor;break;case 3:b=Ab.UncompressedBlackAndWhite;break;case 9:b=Ab.RunLengthColorMapped;break;case 10:b=Ab.RunLengthTrueColor;break;case 11:b=Ab.RunLengthBlackAndWhite;break;default:b=Ab.Unknown(b)}var c=this.i.readInt16(),d=this.i.readInt16(),e=this.i.readByte(),f=this.i.readInt16(),g=this.i.readInt16(),h=this.i.readInt16(),k=this.i.readInt16(),l=this.i.readByte(),m=this.i.readByte();switch(m&48){case 16:var p=
qd.BottomRight;break;case 32:p=qd.TopLeft;break;case 48:p=qd.TopRight;break;default:p=qd.BottomLeft}return{colorMapType:a,imageType:b,colorMapFirstIndex:c,colorMapLength:d,colorMapEntrySize:e,xOrigin:f,yOrigin:g,width:h,height:k,bitsPerPixel:l,alphaChannelBits:m&15,imageOrigin:p}},readColorMapData:function(a){return 0==a.colorMapType?null:this.readPixels(a.colorMapEntrySize,a.colorMapLength,a.alphaChannelBits,!1)},readImageData:function(a,b){switch(a.imageType._hx_index){case 0:return null;case 1:return this.readIndexes(a.bitsPerPixel,
a.width*a.height,b,a.colorMapFirstIndex,!1);case 2:return this.readPixels(a.bitsPerPixel,a.width*a.height,a.alphaChannelBits,!1);case 3:return this.readMono(a.bitsPerPixel,a.width*a.height,a.alphaChannelBits,!1);case 4:return this.readIndexes(a.bitsPerPixel,a.width*a.height,b,a.colorMapFirstIndex,!0);case 5:return this.readPixels(a.bitsPerPixel,a.width*a.height,a.alphaChannelBits,!0);case 6:return this.readMono(a.bitsPerPixel,a.width*a.height,a.alphaChannelBits,!0);default:throw u.thrown("Unsupported image data type!");
}},readPixels:function(a,b,c,d){var e=Array(b);c=0!=c;switch(a){case 8:var f=(A=this.i,M(A,A.readByte));a=M(this,this.parsePixel1);break;case 16:f=(A=this.i,M(A,A.readUInt16));a=M(this,this.parsePixel2);break;case 24:f=(A=this.i,M(A,A.readUInt24));a=M(this,this.parsePixel3);break;case 32:f=(A=this.i,M(A,A.readInt32));a=M(this,this.parsePixel4);break;default:throw u.thrown("Unsupported bits per pixels amount!");}if(d)for(d=0;d<b;){var g=this.i.readByte();if(0!=(g&128)){g&=127;for(var h=a(f(),c);0<=
g;)e[d++]=h,--g}else for(g&=127;0<=g;)e[d++]=a(f(),c),--g}else for(g=0;g<b;)d=g++,e[d]=a(f(),c);return e},readMono:function(a,b,c,d){var e=Array(b);c=0!=c;switch(a){case 8:var f=(A=this.i,M(A,A.readByte));a=M(this,this.parsePixel1);break;case 16:f=(A=this.i,M(A,A.readUInt16));a=M(this,this.parsePixelGreyAlpha);break;default:throw u.thrown("Unsupported bits per pixels amount!");}if(d)for(d=0;d<b;){var g=this.i.readByte();if(0!=(g&128)){g&=127;for(var h=a(f(),c);0<=g;)e[d++]=h,--g}else for(g&=127;0<=
g;)e[d++]=a(f(),c),--g}else for(g=0;g<b;)d=g++,e[d]=a(f(),c);return e},readIndexes:function(a,b,c,d,e){var f=Array(b);switch(a){case 8:a=(A=this.i,M(A,A.readByte));break;case 16:a=(A=this.i,M(A,A.readUInt16));break;case 24:a=(A=this.i,M(A,A.readUInt24));break;case 32:a=(A=this.i,M(A,A.readInt32));break;default:throw u.thrown("Unsupported bits per pixels amount!");}if(e){e=0;for(var g;e<b;)if(g=this.i.readByte(),0!=(g&128)){g&=127;for(var h=c[d+a()];0<=g;)f[e++]=h,--g}else for(g&=127;0<=g;)f[e++]=
c[d+a()],--g}else for(g=0;g<b;)e=g++,f[e]=c[d+a()];return f},parsePixel1:function(a,b){return a<<16|a<<8|a},parsePixelGreyAlpha:function(a,b){return(b?(a&65280)<<16:0)|this.parsePixel1(a&255,!1)},parsePixel2:function(a,b){return(b?1==(a&32768)?-16777216:0:0)|(((a&31744)>>10)/31*255|0)<<16|(((a&992)>>5)/31*255|0)<<8|(a&31)/31*255|0},parsePixel3:function(a,b){return a},parsePixel4:function(a,b){return a},__class__:ai};var Xh=function(a){this.i=a;this.bits=this.nbits=0};z["format.tools.BitsInput"]=Xh;
Xh.__name__="format.tools.BitsInput";Xh.prototype={readBits:function(a){if(this.nbits>=a){var b=this.nbits-a;var c=this.bits>>>b&(1<<a)-1;this.nbits=b;return c}c=this.i.readByte();if(24<=this.nbits){if(31<a)throw u.thrown("Bits error");b=8+this.nbits-a;a=this.bits&(1<<this.nbits)-1;this.bits=c;this.nbits=b;return a<<8-b|c<<b}this.bits=this.bits<<8|c;this.nbits+=8;return this.readBits(a)},readBit:function(){0==this.nbits&&(this.bits=this.i.readByte(),this.nbits=8);this.nbits--;return 1==(this.bits>>>
this.nbits&1)},reset:function(){this.nbits=0},__class__:Xh};var of=function(){};z["format.tools.Deflate"]=of;of.__name__="format.tools.Deflate";of.run=function(a,b){null==b&&(b=9);return bi.run(a,b)};var Qg=function(){};z["format.tools.Inflate"]=Qg;Qg.__name__="format.tools.Inflate";Qg.run=function(a){return ci.run(a)};var di=L["format.wav.WAVEFormat"]={__ename__:!0,__constructs__:null,WF_PCM:{_hx_name:"WF_PCM",_hx_index:0,__enum__:"format.wav.WAVEFormat",toString:v}};di.__constructs__=[di.WF_PCM];
di.__empty_constructs__=[di.WF_PCM];var ei=function(a){this.i=a;a.set_bigEndian(!1)};z["format.wav.Reader"]=ei;ei.__name__="format.wav.Reader";ei.prototype={readInt:function(){return this.i.readInt32()},read:function(){if("RIFF"!=this.i.readString(4))throw u.thrown("RIFF header expected");this.i.readInt32();if("WAVE"!=this.i.readString(4))throw u.thrown("WAVE signature not found");var a=this.i.readString(4);a:for(;"fmt "!=a;)switch(a){case "JUNK":a=this.i.readInt32();this.i.read(a);a=this.i.readString(4);
break;case "bext":a=this.i.readInt32();this.i.read(a);a=this.i.readString(4);break;default:break a}if("fmt "!=a)throw u.thrown("unsupported wave chunk "+a);var b=this.i.readInt32();switch(this.i.readUInt16()){case 1:case 3:a=di.WF_PCM;break;default:throw u.thrown("only PCM (uncompressed) WAV files are supported");}var c=this.i.readUInt16(),d=this.i.readInt32(),e=this.i.readInt32(),f=this.i.readUInt16(),g=this.i.readUInt16();16<b&&this.i.read(b-16);for(b=this.i.readString(4);"data"!=b;)this.i.read(this.i.readInt32()),
b=this.i.readString(4);if("data"!=b)throw u.thrown("expected data subchunk");var h=this.i.readInt32();try{var k=this.i.read(h)}catch(r){if(u.caught(r).unwrap()instanceof Fc)throw u.thrown("Invalid chunk data length");throw r;}h=[];try{for(;;)if(b=this.i.readString(4),"cue "==b){this.i.readInt32();for(var l=0,m=this.i.readInt32();l<m;){l++;var p=this.i.readInt32();this.i.readInt32();this.i.readString(4);this.i.readInt32();this.i.readInt32();var t=this.i.readInt32();h.push({id:p,sampleOffset:t})}}else{var n=
this.i.readInt32();if(0>n)break;this.i.read(n)}}catch(r){if(!(u.caught(r).unwrap()instanceof Fc))throw r;}return{header:{format:a,channels:c,samplingRate:d,byteRate:e,blockAlign:f,bitsPerSample:g},data:k,cuePoints:h}},__class__:ei};var ta=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b};z["h2d.col.PointImpl"]=ta;ta.__name__="h2d.col.PointImpl";ta.prototype={distanceSq:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},distance:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*
b+a*a)},toString:function(){return"{"+X.fmt(this.x)+","+X.fmt(this.y)+"}"},sub:function(a){var b=this.x-a.x;a=this.y-a.y;null==a&&(a=0);null==b&&(b=0);return new ta(b,a)},add:function(a){var b=this.x+a.x;a=this.y+a.y;null==a&&(a=0);null==b&&(b=0);return new ta(b,a)},scaled:function(a){var b=this.x*a;a*=this.y;null==a&&(a=0);null==b&&(b=0);return new ta(b,a)},equals:function(a){return this.x==a.x?this.y==a.y:!1},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+
this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.x*this.x+this.y*this.y;a=1E-20>a?0:1/Math.sqrt(a);this.x*=a;this.y*=a},normalized:function(){var a=this.x*this.x+this.y*this.y;a=1E-20>a?0:1/Math.sqrt(a);var b=this.x*a;a*=this.y;null==a&&(a=0);null==b&&(b=0);return new ta(b,a)},set:function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b},load:function(a){this.x=a.x;this.y=a.y},scale:function(a){this.x*=a;this.y*=a},clone:function(){var a=
this.x,b=this.y;null==b&&(b=0);null==a&&(a=0);return new ta(a,b)},cross:function(a){return this.x*a.y-this.y*a.x},lerp:function(a,b,c){var d=a.x;this.x=d+c*(b.x-d);d=a.y;this.y=d+c*(b.y-d)},transform:function(a){var b=a.b*this.x+a.d*this.y+a.y;this.x=a.a*this.x+a.c*this.y+a.x;this.y=b},transformed:function(a){var b=a.a*this.x+a.c*this.y+a.x;a=a.b*this.x+a.d*this.y+a.y;null==a&&(a=0);null==b&&(b=0);return new ta(b,a)},transform2x2:function(a){var b=a.b*this.x+a.d*this.y;this.x=a.a*this.x+a.c*this.y;
this.y=b},transformed2x2:function(a){var b=a.a*this.x+a.c*this.y;a=a.b*this.x+a.d*this.y;null==a&&(a=0);null==b&&(b=0);return new ta(b,a)},toIPoint:function(a){null==a&&(a=1);return new V(Math.round(this.x*a),Math.round(this.y*a))},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.x*a+this.y*b;this.x=this.x*b-this.y*a;this.y=c},__class__:ta};var Ra=function(a){this.blendMode=xa.Alpha;this.alpha=1;this.visible=!0;this.rotation=0;this.scaleX=this.scaleY=1;this.x=this.y=0;this.matA=1;this.matC=
this.matB=0;this.matD=1;this.absY=this.absX=0;this.posChanged=null!=a;this.children=[];null!=a&&a.addChild(this)};z["h2d.Object"]=Ra;Ra.__name__="h2d.Object";Ra.prototype={getBounds:function(a,b){null==b?b=new pc:(b.xMin=1E20,b.yMin=1E20,b.xMax=-1E20,b.yMax=-1E20);null!=a&&a.syncPos();a!=this&&this.syncPos();this.getBoundsRec(a,b,!1);if(b.xMax<=b.xMin||b.yMax<=b.yMin)this.addBounds(a,b,-1,-1,2,2),b.xMax=b.xMin=.5*(b.xMax+b.xMin),b.yMax=b.yMin=.5*(b.yMax+b.yMin);return b},getSize:function(a){null==
a?a=new pc:(a.xMin=1E20,a.yMin=1E20,a.xMax=-1E20,a.yMax=-1E20);this.syncPos();this.getBoundsRec(this.parent,a,!0);if(a.xMax<=a.xMin||a.yMax<=a.yMin)this.addBounds(this.parent,a,-1,-1,2,2),a.xMax=a.xMin=.5*(a.xMax+a.xMin),a.yMax=a.yMin=.5*(a.yMax+a.yMin);var b=-this.x,c=-this.y;a.xMin+=b;a.xMax+=b;a.yMin+=c;a.yMax+=c;return a},getAbsPos:function(){this.syncPos();var a=new yc;a.a=this.matA;a.b=this.matB;a.c=this.matC;a.d=this.matD;a.x=this.absX;a.y=this.absY;return a},contains:function(a){for(;null!=
a;)if(a=a.parent,a==this)return!0;return!1},find:function(a){var b=a(this);if(null!=b)return b;for(var c=0,d=this.children;c<d.length;)if(b=d[c],++c,b=b.find(a),null!=b)return b;return null},findAll:function(a,b){null==b&&(b=[]);var c=a(this);null!=c&&b.push(c);c=0;for(var d=this.children;c<d.length;){var e=d[c];++c;e.findAll(a,b)}return b},set_filter:function(a){null!=this.filter&&this.allocated&&this.filter.unbind(this);this.filter=a;null!=a&&this.allocated&&a.bind(this);return a},getBoundsRec:function(a,
b,c){var d;if(this.posChanged){this.calcAbsPos();var e=0;for(d=this.children;e<d.length;){var f=d[e];++e;f.posChanged=!0}this.posChanged=!1}f=this.children.length;if(0==f)b.xMin=1E20,b.yMin=1E20,b.xMax=-1E20,b.yMax=-1E20;else if(1==f)f=this.children[0],f.visible?f.getBoundsRec(a,b,c):(b.xMin=1E20,b.yMin=1E20,b.xMax=-1E20,b.yMax=-1E20);else{var g=Infinity,h=Infinity,k=-Infinity,l=-Infinity;e=0;for(d=this.children;e<d.length;)f=d[e],++e,f.visible&&(f.getBoundsRec(a,b,c),b.xMin<g&&(g=b.xMin),b.yMin<
h&&(h=b.yMin),b.xMax>k&&(k=b.xMax),b.yMax>l&&(l=b.yMax));b.xMin=g;b.yMin=h;b.xMax=k;b.yMax=l}},addBounds:function(a,b,c,d,e,f){if(!(0>=e||0>=f))if(null==a){var g=c*this.matA+d*this.matC+this.absX;var h=c*this.matB+d*this.matD+this.absY;g<b.xMin&&(b.xMin=g);g>b.xMax&&(b.xMax=g);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=(c+e)*this.matA+d*this.matC+this.absX;h=(c+e)*this.matB+d*this.matD+this.absY;g<b.xMin&&(b.xMin=g);g>b.xMax&&(b.xMax=g);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=c*this.matA+(d+
f)*this.matC+this.absX;h=c*this.matB+(d+f)*this.matD+this.absY;g<b.xMin&&(b.xMin=g);g>b.xMax&&(b.xMax=g);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=(c+e)*this.matA+(d+f)*this.matC+this.absX;h=(c+e)*this.matB+(d+f)*this.matD+this.absY;g<b.xMin&&(b.xMin=g);g>b.xMax&&(b.xMax=g);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h)}else if(a==this)b.xMin>c&&(b.xMin=c),b.yMin>d&&(b.yMin=d),b.xMax<c+e&&(b.xMax=c+e),b.yMax<d+f&&(b.yMax=d+f);else{var k=a.matA*a.matD-a.matB*a.matC;if(0!=k){var l=1/k;k=a.matD*l;var m=
-a.matB*l,p=-a.matC*l;l*=a.matA;var t=this.absX-a.absX;a=this.absY-a.absY;g=c*this.matA+d*this.matC+t;h=c*this.matB+d*this.matD+a;var n=g*k+h*p;h=g*m+h*l;n<b.xMin&&(b.xMin=n);n>b.xMax&&(b.xMax=n);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=(c+e)*this.matA+d*this.matC+t;h=(c+e)*this.matB+d*this.matD+a;n=g*k+h*p;h=g*m+h*l;n<b.xMin&&(b.xMin=n);n>b.xMax&&(b.xMax=n);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=c*this.matA+(d+f)*this.matC+t;h=c*this.matB+(d+f)*this.matD+a;n=g*k+h*p;h=g*m+h*l;n<b.xMin&&(b.xMin=
n);n>b.xMax&&(b.xMax=n);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h);g=(c+e)*this.matA+(d+f)*this.matC+t;h=(c+e)*this.matB+(d+f)*this.matD+a;n=g*k+h*p;h=g*m+h*l;n<b.xMin&&(b.xMin=n);n>b.xMax&&(b.xMax=n);h<b.yMin&&(b.yMin=h);h>b.yMax&&(b.yMax=h)}}},getObjectsCount:function(){for(var a=0,b=0,c=this.children;b<c.length;){var d=c[b];++b;a+=d.getObjectsCount()+1}return a},localToGlobal:function(a){this.syncPos();null==a&&(a=new ta(0,0));var b=a.x*this.matB+a.y*this.matD+this.absY;a.x=a.x*this.matA+a.y*this.matC+
this.absX;a.y=b;return a},globalToLocal:function(a){this.syncPos();a.x-=this.absX;a.y-=this.absY;var b=1/(this.matA*this.matD-this.matB*this.matC),c=(-a.x*this.matB+a.y*this.matA)*b;a.x=(a.x*this.matD-a.y*this.matC)*b;a.y=c;return a},getScene:function(){for(var a=this;null!=a.parent;)a=a.parent;return a instanceof he?a:null},set_visible:function(a){if(this.visible==a)return a;this.visible=a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);return a},addChild:function(a){this.addChildAt(a,
this.children.length)},addChildAt:function(a,b){0>b&&(b=0);b>this.children.length&&(b=this.children.length);for(var c=this;null!=c;){if(c==a)throw u.thrown("Recursive addChild");c=c.parent}null!=a.parent&&(c=a.allocated,a.allocated=!1,a.parent.removeChild(a),a.allocated=c);this.children.splice(b,0,a);if(!this.allocated&&a.allocated)a.onRemove();a.parent=this;a.parentContainer=this.parentContainer;a.posChanged=!0;if(this.allocated)if(a.allocated)a.onHierarchyMoved(!0);else a.onAdd();null!=this.parentContainer&&
this.parentContainer.contentChanged(this)},onContentChanged:function(){null!=this.parentContainer&&this.parentContainer.contentChanged(this)},onHierarchyMoved:function(a){for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d.onHierarchyMoved(a)}},onAdd:function(){this.allocated=!0;null!=this.filter&&this.filter.bind(this);for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;c.onAdd()}},onRemove:function(){this.allocated=!1;null!=this.filter&&this.filter.unbind(this);for(var a=this.children.length-
1;0<=a;){var b=this.children[a--];if(null!=b)b.onRemove()}},getMatrix:function(a){a.a=this.matA;a.b=this.matB;a.c=this.matC;a.d=this.matD;a.x=this.absX;a.y=this.absY},removeChild:function(a){if(D.remove(this.children,a)){if(a.allocated)a.onRemove();a.parent=null;null!=a.parentContainer&&a.setParentContainer(null);a.posChanged=!0;null!=this.parentContainer&&this.parentContainer.contentChanged(this)}},setParentContainer:function(a){this.parentContainer=a;for(var b=0,c=this.children;b<c.length;){var d=
c[b];++b;d.setParentContainer(a)}},removeChildren:function(){for(;0<this.children.length;)this.removeChild(this.getChildAt(0))},remove:function(){null!=this.parent&&this.parent.removeChild(this)},drawTo:function(a){var b=this.getScene(),c=null==b;null==b&&(b=new he);b.drawImplTo(this,[a]);c&&(b.dispose(),this.onRemove())},drawToTextures:function(a,b){var c=this.getScene(),d=null==c;null==c&&(c=new he);c.drawImplTo(this,a,b);d&&(c.dispose(),this.onRemove())},draw:function(a){},sync:function(a){var b=
this.posChanged;b&&(this.calcAbsPos(),this.posChanged=!1);this.lastFrame=a.frame;for(var c=0,d=this.children.length;c<d;){var e=this.children[c];if(null==e)break;e.lastFrame!=a.frame&&(b&&(e.posChanged=!0),e.sync(a));this.children[c]!=e?(c=0,d=this.children.length):++c}},syncPos:function(){null!=this.parent&&this.parent.syncPos();if(this.posChanged){this.calcAbsPos();for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;c.posChanged=!0}this.posChanged=!1}},calcAbsPos:function(){if(null==this.parent){if(0==
this.rotation)this.matA=this.scaleX,this.matC=this.matB=0,this.matD=this.scaleY;else{var a=Math.cos(this.rotation);var b=Math.sin(this.rotation);this.matA=this.scaleX*a;this.matB=this.scaleX*b;this.matC=this.scaleY*-b;this.matD=this.scaleY*a}this.absX=this.x;this.absY=this.y}else{if(0==this.rotation)this.matA=this.scaleX*this.parent.matA,this.matB=this.scaleX*this.parent.matB,this.matC=this.scaleY*this.parent.matC,this.matD=this.scaleY*this.parent.matD;else{a=Math.cos(this.rotation);b=Math.sin(this.rotation);
var c=this.scaleX*a,d=this.scaleX*b;b=this.scaleY*-b;a*=this.scaleY;this.matA=c*this.parent.matA+d*this.parent.matC;this.matB=c*this.parent.matB+d*this.parent.matD;this.matC=b*this.parent.matA+a*this.parent.matC;this.matD=b*this.parent.matB+a*this.parent.matD}this.absX=this.x*this.parent.matA+this.y*this.parent.matC+this.parent.absX;this.absY=this.x*this.parent.matB+this.y*this.parent.matD+this.parent.absY}},emitTile:function(a,b){null==Ra.nullDrawable&&(Ra.nullDrawable=new Va(null));Ra.nullDrawable.smooth=
null!=this.filter&&this.filter.smooth?!0:null;Ra.nullDrawable.absX=this.absX;Ra.nullDrawable.absY=this.absY;Ra.nullDrawable.matA=this.matA;Ra.nullDrawable.matB=this.matB;Ra.nullDrawable.matC=this.matC;Ra.nullDrawable.matD=this.matD;a.drawTile(Ra.nullDrawable,b)},clipBounds:function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);var e=a.tmpBounds;if(null!=a.inFilter){var f=a.baseShader.filterMatrixA__;var g=a.baseShader.filterMatrixB__;var h=this.matA*f.x+this.matB*f.y;var k=this.matA*g.x+this.matB*g.y;var l=
this.matC*f.x+this.matD*f.y;var m=this.matC*g.x+this.matD*g.y;f=this.absX*f.x+this.absY*f.y+f.z;var p=this.absX*g.x+this.absY*g.y+g.z;g=(h*a.viewA+k*a.viewC)/c;h=(h*a.viewB+k*a.viewD)/d;c=(l*a.viewA+m*a.viewC)/c;d=(l*a.viewB+m*a.viewD)/d;l=f*a.viewA+p*a.viewC+a.viewX;a=f*a.viewB+p*a.viewD+a.viewY}else g=(this.matA*a.viewA+this.matB*a.viewC)/c,h=(this.matA*a.viewB+this.matB*a.viewD)/d,c=(this.matC*a.viewA+this.matD*a.viewC)/c,d=(this.matC*a.viewB+this.matD*a.viewD)/d,l=this.absX*a.viewA+this.absY*
a.viewC+a.viewX,a=this.absX*a.viewB+this.absY*a.viewD+a.viewY;e.xMin=1E20;e.yMin=1E20;e.xMax=-1E20;e.yMax=-1E20;var t=b.xMin,n=b.yMin;f=t*g+n*c+l;t=t*h+n*d+a;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);t<e.yMin&&(e.yMin=t);t>e.yMax&&(e.yMax=t);t=b.xMax;n=b.yMin;f=t*g+n*c+l;t=t*h+n*d+a;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);t<e.yMin&&(e.yMin=t);t>e.yMax&&(e.yMax=t);t=b.xMin;n=b.yMax;f=t*g+n*c+l;t=t*h+n*d+a;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);t<e.yMin&&(e.yMin=t);t>e.yMax&&(e.yMax=t);t=b.xMax;
n=b.yMax;f=t*g+n*c+l;t=t*h+n*d+a;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);t<e.yMin&&(e.yMin=t);t>e.yMax&&(e.yMax=t);-1>e.xMin&&(e.xMin=-1);-1>e.yMin&&(e.yMin=-1);1<e.xMax&&(e.xMax=1);1<e.yMax&&(e.yMax=1);m=1/(g*d-h*c);p=e.xMin;k=e.yMin;var r=e.xMax,y=e.yMax;e.xMin=1E20;e.yMin=1E20;e.xMax=-1E20;e.yMax=-1E20;t=p-l;n=k-a;f=(t*d-n*c)*m;t=(-t*h+n*g)*m;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);t<e.yMin&&(e.yMin=t);t>e.yMax&&(e.yMax=t);t=r-l;n=k-a;f=(t*d-n*c)*m;t=(-t*h+n*g)*m;f<e.xMin&&(e.xMin=f);f>e.xMax&&
(e.xMax=f);t<e.yMin&&(e.yMin=t);t>e.yMax&&(e.yMax=t);t=p-l;n=y-a;f=(t*d-n*c)*m;t=(-t*h+n*g)*m;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);t<e.yMin&&(e.yMin=t);t>e.yMax&&(e.yMax=t);t=r-l;n=y-a;f=(t*d-n*c)*m;t=(-t*h+n*g)*m;f<e.xMin&&(e.xMin=f);f>e.xMax&&(e.xMax=f);t<e.yMin&&(e.yMin=t);t>e.yMax&&(e.yMax=t);g=b.xMin;h=e.xMin;b.xMin=g<h?h:g;g=b.yMin;h=e.yMin;b.yMin=g<h?h:g;g=b.xMax;h=e.xMax;b.xMax=g>h?h:g;g=b.yMax;h=e.yMax;b.yMax=g>h?h:g},drawFilters:function(a){if(a.pushFilter(this)){var b=a.tmpBounds,
c=new pc;this.filter.sync(a,this);if(this.filter.useScreenResolution){var d=a.scene;var e=d.viewportScaleX*this.filter.resolutionScale;d=d.viewportScaleY*this.filter.resolutionScale}else d=e=this.filter.resolutionScale;if(this.filter.autoBounds){var f=this.filter.boundsExtend;0<=f&&(this.getBounds(this,b),b.xMin=b.xMin*e-f,b.yMin=b.yMin*d-f,b.xMax=b.xMax*e+f,b.yMax=b.yMax*d+f,b.xMin<c.xMin&&(c.xMin=b.xMin),b.xMax>c.xMax&&(c.xMax=b.xMax),b.yMin<c.yMin&&(c.yMin=b.yMin),b.yMax>c.yMax&&(c.yMax=b.yMax))}else{var g=
f=Ra.tmpPoint;var h=e;var k=d;null==k&&(k=0);null==h&&(h=0);g.x=h;g.y=k;this.filter.getBounds(this,b,f);b.xMin<c.xMin&&(c.xMin=b.xMin);b.xMax>c.xMax&&(c.xMax=b.xMax);b.yMin<c.yMin&&(c.yMin=b.yMin);b.yMax>c.yMax&&(c.yMax=b.yMax);e=f.x;d=f.y}a.setFilterScale(e,d);this.clipBounds(a,c,e,d);b=Math.floor(c.xMin+1E-10);f=Math.floor(c.yMin+1E-10);var l=Math.ceil(c.xMax-b-1E-10),m=Math.ceil(c.yMax-f-1E-10);if(0>=l||0>=m||c.xMax<c.xMin)a.popFilter();else{c=a.textures.allocTarget("filterTemp",l,m,!1);a.pushTarget(c,
b,f,l,m);a.engine.clear(0);l=a.globalAlpha;m=a.baseShader;g=m.filterMatrixA__;h=g.x;k=g.y;var p=g.z;null==p&&(p=0);null==k&&(k=0);null==h&&(h=0);var t=h;g=k;var n=p;null==n&&(n=0);null==g&&(g=0);null==t&&(t=0);var r=t,y=g,G=n;g=m.filterMatrixB__;h=g.x;k=g.y;p=g.z;null==p&&(p=0);null==k&&(k=0);null==h&&(h=0);t=h;g=k;n=p;null==n&&(n=0);null==g&&(g=0);null==t&&(t=0);var q=g;g=1/(this.matA*this.matD-this.matB*this.matC);h=this.matD*g*e;var u=-this.matB*g*d;k=-this.matC*g*e;var v=this.matA*g*d;p=-(this.absX*
h+this.absY*k);var w=-(this.absX*u+this.absY*v);g=m.filterMatrixA__;null==p&&(p=0);null==k&&(k=0);null==h&&(h=0);g.x=h;g.y=k;g.z=p;g=m.filterMatrixB__;h=u;k=v;p=w;null==p&&(p=0);null==k&&(k=0);null==h&&(h=0);g.x=h;g.y=k;g.z=p;a.globalAlpha=1;this.drawContent(a);c=ib.fromTexture(c);c.dx=b/e;c.dy=f/d;g=c;c=this.filter.draw(a,c);null!=c&&(c!=g&&(c.dx=(c.dx+b)/e,c.dy=(c.dy+f)/d),c.width/=e,c.height/=d);g=m.filterMatrixA__;g.x=r;g.y=y;g.z=G;g=m.filterMatrixB__;g.x=t;g.y=q;g.z=n;a.popTarget();a.popFilter();
a.globalAlpha=l;null!=c&&this.drawFiltered(a,c)}}},drawFiltered:function(a,b){var c=a.globalAlpha;a.currentBlend=null;a.inFilterBlend=this.blendMode;a.globalAlpha*=this.alpha;this.emitTile(a,b);a.globalAlpha=c;a.inFilterBlend=null;a.currentBlend=null},drawRec:function(a){if(this.visible){if(this.posChanged){this.calcAbsPos();for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d.posChanged=!0}this.posChanged=!1}null!=this.filter&&this.filter.get_enable()?this.drawFilters(a):(b=a.globalAlpha,a.globalAlpha*=
this.alpha,this.drawContent(a),a.globalAlpha=b)}},drawContent:function(a){if(a.front2back){for(var b=this.children.length;0<b--;)this.children[b].drawRec(a);this.draw(a)}else{this.draw(a);b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d.drawRec(a)}}},set_x:function(a){this.posChanged=!0;return this.x=a},set_y:function(a){this.posChanged=!0;return this.y=a},set_scaleX:function(a){this.posChanged=!0;return this.scaleX=a},set_scaleY:function(a){this.posChanged=!0;return this.scaleY=a},set_rotation:function(a){this.posChanged=
!0;return this.rotation=a},move:function(a,b){var c=this.x+(a*Math.cos(this.rotation)-b*Math.sin(this.rotation));this.posChanged=!0;this.x=c;c=this.y+(a*Math.sin(this.rotation)+b*Math.cos(this.rotation));this.posChanged=!0;this.y=c},setPosition:function(a,b){this.posChanged=!0;this.x=a;this.posChanged=!0;this.y=b},rotate:function(a){this.posChanged=!0;this.rotation+=a},scale:function(a){this.scaleX*=a;this.posChanged=!0;this.scaleY*=a},setScale:function(a){this.scaleX=a;this.posChanged=!0;this.scaleY=
a},getChildAt:function(a){return this.children[a]},getChildIndex:function(a){for(var b=0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==a)return d}return-1},getObjectByName:function(a){if(this.name==a)return this;for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d=d.getObjectByName(a);if(null!=d)return d}return null},get_numChildren:function(){return this.children.length},iterator:function(){return new Rg(this.children)},toString:function(){var a=Z.getClass(this).__name__;return null==
this.name?a:this.name+"("+a+")"},contentChanged:function(a){},constraintSize:function(a,b){},__class__:Ra};var Va=function(a){Ra.call(this,a);var b=a=1,c=1,d=1;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.color=new T(a,b,c,d)};z["h2d.Drawable"]=Va;Va.__name__="h2d.Drawable";Va.__super__=Ra;Va.prototype=J(Ra.prototype,{set_tileWrap:function(a){return this.tileWrap=a},get_colorAdd:function(){var a=this.getShader(Be);return null==a?null:a.color__},set_colorAdd:function(a){var b=this.getShader(Be);
null==b?null!=a&&(b=this.addShader(new Be),b.color__=a):null==a?this.removeShader(b):b.color__=a;return a},drawFiltered:function(a,b){var c=this.shaders;this.shaders=null;Ra.prototype.drawFiltered.call(this,a,b);this.shaders=c},set_colorKey:function(a){var b=this.getShader(Ce);if(null==b)null!=a&&this.addShader(new Ce(-16777216|a));else if(null==a)this.removeShader(b);else{b=b.colorKey__;var c=-16777216|a;b.x=(c>>16&255)/255;b.y=(c>>8&255)/255;b.z=(c&255)/255;b.w=(c>>>24)/255}return this.colorKey=
a},adjustColor:function(a){if(null==a)this.set_colorMatrix(null);else{var b=this.get_colorMatrix();null==b&&(b=new ma,this.set_colorMatrix(b));b.identity();b.adjustColor(a)}},get_colorMatrix:function(){var a=this.getShader(De);return null==a?null:a.matrix__},set_colorMatrix:function(a){var b=this.getShader(De);null==b?null!=a&&(b=this.addShader(new De),b.matrix__=a):null==a?this.removeShader(b):b.matrix__=a;return a},getShader:function(a){if(null!=this.shaders)for(var b=this.shaders;null!=b;){var c=
b.s;b=b.next;c=Z.__downcastCheck(c,a)?c:null;if(null!=c)return c}return null},getShaders:function(){return new pf(this.shaders,null)},addShader:function(a){if(null==a)throw u.thrown("Can't add null shader");this.shaders=Fb.addSort(a,this.shaders);return a},removeShader:function(a){for(var b=null,c=this.shaders;null!=c;){if(c.s==a)return null==b?this.shaders=c.next:b.next=c.next,!0;b=c;c=c.next}return!1},emitTile:function(a,b){null==b&&(b=new ib(null,0,0,5,5));a.drawTile(this,b)},__class__:Va});var Sg=
function(a,b){Va.call(this,b);this.set_tile(a)};z["h2d.Bitmap"]=Sg;Sg.__name__="h2d.Bitmap";Sg.__super__=Va;Sg.prototype=J(Va.prototype,{getBoundsRec:function(a,b,c){Va.prototype.getBoundsRec.call(this,a,b,c);null!=this.tile&&(null==this.width&&null==this.height?this.addBounds(a,b,this.tile.dx,this.tile.dy,this.tile.width,this.tile.height):this.addBounds(a,b,this.tile.dx,this.tile.dy,null!=this.width?this.width:this.tile.width*this.height/this.tile.height,null!=this.height?this.height:this.tile.height*
this.width/this.tile.width))},set_width:function(a){if(this.width==a)return a;this.width=a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);return a},set_height:function(a){if(this.height==a)return a;this.height=a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);return a},set_tile:function(a){if(this.tile==a)return a;this.tile=a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);return a},draw:function(a){if(null==this.width&&null==this.height)this.emitTile(a,
this.tile);else{null==this.tile&&this.set_tile(ib.fromColor(16711935));var b=this.tile.width,c=this.tile.height;this.tile.width=null!=this.width?this.width:b*this.height/c;this.tile.height=null!=this.height?this.height:c*this.width/b;this.emitTile(a,this.tile);this.tile.width=b;this.tile.height=c}},__class__:Sg});var xa=L["h2d.BlendMode"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h2d.BlendMode",toString:v},Alpha:{_hx_name:"Alpha",_hx_index:1,__enum__:"h2d.BlendMode",
toString:v},Add:{_hx_name:"Add",_hx_index:2,__enum__:"h2d.BlendMode",toString:v},AlphaAdd:{_hx_name:"AlphaAdd",_hx_index:3,__enum__:"h2d.BlendMode",toString:v},SoftAdd:{_hx_name:"SoftAdd",_hx_index:4,__enum__:"h2d.BlendMode",toString:v},Multiply:{_hx_name:"Multiply",_hx_index:5,__enum__:"h2d.BlendMode",toString:v},AlphaMultiply:{_hx_name:"AlphaMultiply",_hx_index:6,__enum__:"h2d.BlendMode",toString:v},Erase:{_hx_name:"Erase",_hx_index:7,__enum__:"h2d.BlendMode",toString:v},Screen:{_hx_name:"Screen",
_hx_index:8,__enum__:"h2d.BlendMode",toString:v},Sub:{_hx_name:"Sub",_hx_index:9,__enum__:"h2d.BlendMode",toString:v},Max:{_hx_name:"Max",_hx_index:10,__enum__:"h2d.BlendMode",toString:v},Min:{_hx_name:"Min",_hx_index:11,__enum__:"h2d.BlendMode",toString:v}};xa.__constructs__=[xa.None,xa.Alpha,xa.Add,xa.AlphaAdd,xa.SoftAdd,xa.Multiply,xa.AlphaMultiply,xa.Erase,xa.Screen,xa.Sub,xa.Max,xa.Min];xa.__empty_constructs__=[xa.None,xa.Alpha,xa.Add,xa.AlphaAdd,xa.SoftAdd,xa.Multiply,xa.AlphaMultiply,xa.Erase,
xa.Screen,xa.Sub,xa.Max,xa.Min];var fi=function(a){this.followRotation=!1;this.posChanged=!0;this.x=0;this.posChanged=!0;this.y=0;this.scaleY=this.scaleX=1;this.posChanged=!0;this.anchorX=this.rotation=0;this.posChanged=!0;this.viewY=this.viewX=this.anchorY=0;this.viewH=this.viewW=1;this.visible=!0;null!=a&&a.addCamera(this)};z["h2d.Camera"]=fi;fi.__name__="h2d.Camera";fi.prototype={remove:function(){null!=this.scene&&this.scene.removeCamera(this)},layerVisible:function(a){return!0},enter:function(a){a.pushCamera(this);
if(this.clipViewport){var b=a.inFilter;a.inFilter=null;a.pushRenderZone(this.viewX*this.scene.width,this.viewY*this.scene.height,this.viewW*this.scene.width,this.viewH*this.scene.height);a.inFilter=b}},exit:function(a){if(this.clipViewport){var b=a.inFilter;a.inFilter=null;a.popRenderZone();a.inFilter=b}a.popCamera()},sync:function(a,b){null==b&&(b=!1);null!=this.scene&&(null!=this.follow&&(this.posChanged=!0,this.x=this.follow.absX,this.posChanged=!0,this.y=this.follow.absY,this.followRotation&&
(this.posChanged=!0,this.rotation=-this.follow.rotation)),this.posChanged||b)&&(0==this.rotation?(this.matA=this.scaleX,this.matC=this.matB=0,this.matD=this.scaleY):(a=Math.cos(this.rotation),b=Math.sin(this.rotation),this.matA=this.scaleX*a,this.matB=this.scaleX*b,this.matC=this.scaleY*-b,this.matD=this.scaleY*a),this.absX=Math.round(-(this.x*this.matA+this.y*this.matC)+this.scene.width*this.anchorX*this.viewW+this.scene.width*this.viewX),this.absY=Math.round(-(this.x*this.matB+this.y*this.matD)+
this.scene.height*this.anchorY*this.viewH+this.scene.height*this.viewY),this.invDet=1/(this.matA*this.matD-this.matB*this.matC),this.posChanged=!1)},setScale:function(a,b){this.scaleX=a;this.posChanged=!0;this.scaleY=b},scale:function(a,b){this.scaleX*=a;this.posChanged=!0;this.scaleY*=b},setPosition:function(a,b){this.posChanged=!0;this.x=a;this.posChanged=!0;this.y=b},move:function(a,b){this.posChanged=!0;this.x+=a;this.posChanged=!0;this.y+=b},rotate:function(a){this.posChanged=!0;this.rotation+=
a},setAnchor:function(a,b){this.anchorX=a;this.posChanged=!0;this.anchorY=b},setViewport:function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");this.posChanged=!0;this.viewX=Math.floor(a)/this.scene.width;if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");
this.posChanged=!0;this.viewY=Math.floor(b)/this.scene.height;a=0==c?this.scene.width:c;if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");this.posChanged=!0;this.viewW=Math.ceil(a)/this.scene.width;a=0==d?this.scene.height:d;if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");this.posChanged=!0;this.viewH=Math.ceil(a)/this.scene.height},setRawViewport:function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=0);null==
a&&(a=0);this.viewX=a;this.viewY=b;this.viewW=c;this.viewH=d;this.posChanged=!0},screenXToCamera:function(a,b){return(((a-this.scene.offsetX)/this.scene.viewportScaleX-this.absX)*this.matD-((b-this.scene.offsetY)/this.scene.viewportScaleY-this.absY)*this.matC)*this.invDet},screenYToCamera:function(a,b){return(-((a-this.scene.offsetX)/this.scene.viewportScaleX-this.absX)*this.matB+((b-this.scene.offsetY)/this.scene.viewportScaleY-this.absY)*this.matA)*this.invDet},cameraXToScreen:function(a,b){return(a*
this.matA+b*this.matC+this.absX)*this.scene.viewportScaleX+this.scene.offsetX},cameraYToScreen:function(a,b){return(a*this.matB+b*this.matD+this.absY)*this.scene.viewportScaleY+this.scene.offsetY},sceneXToCamera:function(a,b){return((a-this.absX)*this.matD-(b-this.absY)*this.matC)*this.invDet},sceneYToCamera:function(a,b){return(-(a-this.absX)*this.matB+(b-this.absY)*this.matA)*this.invDet},cameraXToScene:function(a,b){return a*this.matA+b*this.matC+this.absX},cameraYToScene:function(a,b){return a*
this.matB+b*this.matD+this.absY},eventToCamera:function(a){var b=(a.relX-this.scene.offsetX)/this.scene.viewportScaleX-this.absX,c=(a.relY-this.scene.offsetY)/this.scene.viewportScaleY-this.absY;a.relX=(b*this.matD-c*this.matC)*this.invDet;a.relY=(-b*this.matB+c*this.matA)*this.invDet},screenToCamera:function(a){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");var b=(a.x-this.scene.offsetX)/this.scene.viewportScaleX-this.absX,c=(a.y-this.scene.offsetY)/this.scene.viewportScaleY-
this.absY;a.x=(b*this.matD-c*this.matC)*this.invDet;a.y=(-b*this.matB+c*this.matA)*this.invDet},cameraToScreen:function(a){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");var b=a.x,c=a.y;a.x=(b*this.matA+c*this.matC+this.absX)*this.scene.viewportScaleX+this.scene.offsetX;a.y=(b*this.matB+c*this.matD+this.absY)*this.scene.viewportScaleY+this.scene.offsetY},sceneToCamera:function(a){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");
var b=a.x-this.absX,c=a.y-this.absY;a.x=(b*this.matD-c*this.matC)*this.invDet;a.y=(-b*this.matB+c*this.matA)*this.invDet},cameraToScene:function(a){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");var b=a.x,c=a.y;a.x=b*this.matA+c*this.matC+this.absX;a.y=b*this.matB+c*this.matD+this.absY},checkScene:function(){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");},set_x:function(a){this.posChanged=!0;return this.x=a},
set_y:function(a){this.posChanged=!0;return this.y=a},set_scaleX:function(a){this.posChanged=!0;return this.scaleX=a},set_scaleY:function(a){this.posChanged=!0;return this.scaleY=a},set_rotation:function(a){this.posChanged=!0;return this.rotation=a},get_viewportX:function(){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");return this.viewX*this.scene.width},set_viewportX:function(a){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");
this.posChanged=!0;this.viewX=Math.floor(a)/this.scene.width;return a},get_viewportY:function(){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");return this.viewY*this.scene.height},set_viewportY:function(a){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");this.posChanged=!0;this.viewY=Math.floor(a)/this.scene.height;return a},get_viewportWidth:function(){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");
return this.viewW*this.scene.width},set_viewportWidth:function(a){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");this.posChanged=!0;this.viewW=Math.ceil(a)/this.scene.width;return a},get_viewportHeight:function(){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");return this.viewH*this.scene.height},set_viewportHeight:function(a){if(null==this.scene)throw u.thrown("This method requires Camera to be added to the Scene");
this.posChanged=!0;this.viewH=Math.ceil(a)/this.scene.height;return a},set_anchorX:function(a){this.posChanged=!0;return this.anchorX=a},set_anchorY:function(a){this.posChanged=!0;return this.anchorY=a},__class__:fi};var Vf=function(a,b){this.prevChar=a;this.offset=b};z["h2d.Kerning"]=Vf;Vf.__name__="h2d.Kerning";Vf.prototype={__class__:Vf};var Kd=function(a,b){this.t=a;this.width=b};z["h2d.FontChar"]=Kd;Kd.__name__="h2d.FontChar";Kd.prototype={addKerning:function(a,b){a=new Vf(a,b);a.next=this.kerning;
this.kerning=a},getKerningOffset:function(a){for(var b=this.kerning;null!=b;){if(b.prevChar==a)return b.offset;b=b.next}return 0},clone:function(){var a=new Kd(this.t.clone(),this.width),b=this.kerning;if(null!=b){var c=new Vf(b.prevChar,b.offset);a.kerning=c;for(b=b.next;null!=b;){var d=new Vf(b.prevChar,b.offset);c=c.next=d;b=b.next}}return a},__class__:Kd};var Wf=L["h2d.FontType"]={__ename__:!0,__constructs__:null,BitmapFont:{_hx_name:"BitmapFont",_hx_index:0,__enum__:"h2d.FontType",toString:v},
SignedDistanceField:(A=function(a,b,c){return{_hx_index:1,channel:a,alphaCutoff:b,smoothing:c,__enum__:"h2d.FontType",toString:v}},A._hx_name="SignedDistanceField",A.__params__=["channel","alphaCutoff","smoothing"],A)};Wf.__constructs__=[Wf.BitmapFont,Wf.SignedDistanceField];Wf.__empty_constructs__=[Wf.BitmapFont];var Xf=function(a,b,c){this.offsetX=this.offsetY=0;this.name=a;this.initSize=this.size=b;this.glyphs=new Da;this.defaultChar=this.nullChar=new Kd(new ib(null,0,0,0,0),0);this.charset=wb.getDefault();
null!=a&&(this.tilePath=Sa.withExtension(a,"png"));this.type=null==c?Wf.BitmapFont:c};z["h2d.Font"]=Xf;Xf.__name__="h2d.Font";Xf.prototype={getChar:function(a){var b=this.glyphs.h[a];null==b&&(b=this.charset.resolveChar(a,this.glyphs),null==b&&(b=13==a||10==a?this.nullChar:this.defaultChar));return b},setOffset:function(a,b){a-=this.offsetX;b-=this.offsetY;if(0!=a||0!=b){for(var c=this.glyphs.iterator();c.hasNext();){var d=c.next();d.t.dx+=a;d.t.dy+=b}this.offsetX+=a;this.offsetY+=b}},clone:function(){var a=
new Xf(this.name,this.size);a.baseLine=this.baseLine;a.lineHeight=this.lineHeight;a.tile=this.tile.clone();a.charset=this.charset;a.defaultChar=this.defaultChar.clone();a.type=this.type;a.offsetX=this.offsetX;a.offsetY=this.offsetY;for(var b=this.glyphs.keys();b.hasNext();){var c=b.next(),d=this.glyphs.h[c],e=d.clone();d==this.defaultChar&&(a.defaultChar=e);a.glyphs.h[c]=e}return a},resizeTo:function(a){for(var b=a/this.size,c=this.glyphs.iterator();c.hasNext();){var d=c.next();d.width*=b;d.t.scaleToSize(d.t.width*
b,d.t.height*b);d.t.dx*=b;d.t.dy*=b;for(d=d.kerning;null!=d;)d.offset*=b,d=d.next}this.lineHeight=Math.ceil(this.lineHeight*b);this.baseLine=Math.ceil(this.baseLine*b);this.size=a},hasChar:function(a){return null!=this.glyphs.h[a]},dispose:function(){this.tile.dispose()},calcBaseLine:function(){var a=0,b=this.glyphs.h[32];null!=b&&(a=.5*b.t.height);b=this.glyphs.h[65];null==b&&(b=this.glyphs.h[97]);null==b&&(b=this.glyphs.h[48]);return null==b?this.lineHeight-2-a:b.t.dy+b.t.height-a},__class__:Xf};
var Yf=function(){};z["h2d.GPoint"]=Yf;Yf.__name__="h2d.GPoint";Yf.prototype={load:function(a,b,c,d,e,f){this.x=a;this.y=b;this.r=c;this.g=d;this.b=e;this.a=f},__class__:Yf};var Wa=function(){this.refCount=0;this.forcedLod=-1};z["h3d.prim.Primitive"]=Wa;Wa.__name__="h3d.prim.Primitive";Wa.prototype={triCount:function(){return null!=this.indexes?this.indexes.vertices/3|0:null==this.buffer?0:this.buffer.vertices/3|0},vertexCount:function(){return 0},getCollider:function(){throw u.thrown("not implemented for "+
w.string(this));},getBounds:function(){throw u.thrown("not implemented for "+w.string(this));},incref:function(){this.refCount++},decref:function(){this.refCount--;0>=this.refCount&&(this.refCount=0,this.dispose())},alloc:function(a){throw u.thrown("not implemented");},selectMaterial:function(a,b){},getMaterialIndexes:function(a,b){null==b&&(b=0);return 0!=b?{start:0,count:0}:{start:this.getMaterialIndexStart(a,b),count:this.getMaterialIndexCount(a,b)}},getMaterialIndexStart:function(a,b){return 0},
getMaterialIndexCount:function(a,b){return null==this.indexes?3*this.triCount():this.indexes.vertices},buildNormalsDisplay:function(){throw u.thrown("not implemented for "+w.string(this));},render:function(a){null!=this.buffer&&null!=this.buffer.vbuf||this.alloc(a);if(null==this.indexes){var b=this.buffer;a.renderBuffer(b,a.mem.getTriIndexes(b.vertices),3,0,-1)}else a.renderIndexed(this.buffer,this.indexes)},dispose:function(){null!=this.buffer&&(this.buffer.dispose(),this.buffer=null);null!=this.indexes&&
(this.indexes.dispose(),this.indexes=null)},toString:function(){return Z.getClass(this).__name__.split(".").pop()},lodCount:function(){return 1},screenRatioToLod:function(a){return 0},__class__:Wa};var Tg=function(){Wa.call(this);this.buffers=[];this.state=new Zf;this.allocPos=rd.make()};z["h2d._Graphics.GraphicsContent"]=Tg;Tg.__name__="h2d._Graphics.GraphicsContent";Tg.__super__=Wa;Tg.prototype=J(Wa.prototype,{addIndex:function(a){this.index.push(a);a=this.state;a.tail.count+=1;a.totalCount+=1;
this.indexDirty=!0},add:function(a,b,c,d,e,f,g,h){var k=this.tmp;if(k.pos==k.array.length){var l=k.array.length<<1;128>l&&(l=128);l=new Float32Array(l);l.set(k.array);k.array=l}k.array[k.pos++]=a;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=b;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=c;k=this.tmp;k.pos==k.array.length&&
(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=d;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=e;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=f;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=
g;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=h;this.bufferDirty=!0},setTile:function(a){null!=a&&this.state.setTexture(a.innerTex)},next:function(){if(32768>this.tmp.pos>>3)return!1;this.buffers.push({buf:this.tmp,idx:this.index,vbuf:null,ibuf:null,state:this.state});this.tmp=Xd._new(0);this.index=[];var a=this.state.tail.texture;this.state=new Zf;this.state.setTexture(a);Wa.prototype.dispose.call(this);return!0},
alloc:function(a){if(!(0>=this.index.length)){a=Ob.get();this.buffer=a.ofFloats(this.tmp,N.get_XY_UV_RGBA());this.buffer.allocPos=this.allocPos;this.indexes=a.ofIndexes(this.index);for(var b=0,c=this.buffers;b<c.length;){var d=c[b];++b;if(null==d.vbuf||null==d.vbuf.vbuf)d.vbuf=a.ofFloats(d.buf,N.get_XY_UV_RGBA());if(null==d.ibuf||null==d.ibuf.vbuf)d.ibuf=a.ofIndexes(d.idx)}this.indexDirty=this.bufferDirty=!1}},doRender:function(a){if(0!=this.index.length){this.flush();for(var b=0,c=this.buffers;b<
c.length;){var d=c[b];++b;d.state.drawIndexed(a,d.vbuf,d.ibuf)}this.state.drawIndexed(a,this.buffer,this.indexes)}},flush:function(){if(null==this.buffer||null==this.buffer.vbuf)this.alloc(na.CURRENT);else{var a=Ob.get();this.bufferDirty&&(a.disposeBuffer(this.buffer),this.buffer=a.ofFloats(this.tmp,N.get_XY_UV_RGBA()),this.bufferDirty=!1);this.indexDirty&&(a.disposeIndexBuffer(this.indexes),this.indexes=a.ofIndexes(this.index),this.indexDirty=!1)}},dispose:function(){for(var a=0,b=this.buffers;a<
b.length;){var c=b[a];++a;null!=c.vbuf&&Ob.get().disposeBuffer(c.vbuf);null!=c.ibuf&&Ob.get().disposeIndexBuffer(c.ibuf);c.vbuf=null;c.ibuf=null;c.state.clear()}null!=this.buffer&&(Ob.get().disposeBuffer(this.buffer),this.buffer=null);null!=this.indexes&&(Ob.get().disposeIndexBuffer(this.indexes),this.indexes=null);this.state.clear();Wa.prototype.dispose.call(this)},clear:function(){this.dispose();this.tmp=Xd._new(0);this.index=[];this.buffers=[]},__class__:Tg});var ze=function(a){this.bevel=.25;
this.mx=this.my=0;this.md=1;this.mb=this.mc=0;this.ma=1;Va.call(this,a);this.content=new Tg;this.tile=ib.fromColor(16777215);this.clear()};z["h2d.Graphics"]=ze;ze.__name__="h2d.Graphics";ze.__super__=Va;ze.prototype=J(Va.prototype,{onRemove:function(){Va.prototype.onRemove.call(this);this.clear()},clear:function(){this.content.clear();this.tmpPoints=[];this.lineSize=this.pindex=0;this.yMin=this.xMin=Infinity;this.xMax=this.yMax=-Infinity;this.yMinSize=this.xMinSize=Infinity;this.xMaxSize=this.yMaxSize=
-Infinity},getBoundsRec:function(a,b,c){Va.prototype.getBoundsRec.call(this,a,b,c);null!=this.tile&&(c?this.addBounds(a,b,this.xMinSize,this.yMinSize,this.xMaxSize-this.xMinSize,this.yMaxSize-this.yMinSize):this.addBounds(a,b,this.xMin,this.yMin,this.xMax-this.xMin,this.yMax-this.yMin))},isConvex:function(a){for(var b=!0,c=!1,d=0,e=a.length;d<e;){var f=d++,g=a[f],h=a[(f+1)%a.length];f=a[(f+2)%a.length];g=0<(h.x-g.x)*(f.y-g.y)-(h.y-g.y)*(f.x-g.x);if(b)b=!1,c=g;else if(c!=g)return!1}return!0},flushLine:function(a){var b=
this.tmpPoints,c=b.length-1,d=b[c],e=b[0];this.content.setTile(ib.fromColor(16777215));var f=e.x==d.x&&e.y==d.y,g=b.length;if(f)e!=d&&(--g,--c,d=b[c]);else{var h=b[c-1];null==h&&(h=e);var k=new Yf;k.load(2*d.x-h.x,2*d.y-h.y,0,0,0,0);b.push(k);var l=b[1];null==l&&(l=e);k=new Yf;k.load(2*e.x-l.x,2*e.y-l.y,0,0,0,0);d=k}for(var m=0,p=g;m<p;){var t=m++,n=b[(t+1)%b.length],r=d.y-e.y,y=e.x-d.x,G=1/Math.sqrt(r*r+y*y),q=e.y-n.y,u=n.x-e.x,v=1/Math.sqrt(q*q+u*u),w=r*G+q*v,x=y*G+u*v,z=1/Math.sqrt(w*w+x*x);w*=
z;x*=z;var A=w*r*G+x*y*G;.1>A&&(A=.1);var B=.5*this.lineSize/A;w*=B;x*=B;if(A>this.bevel){var C=this.content,E=e.x+w,D=e.y+x,F=e.r,H=e.g,K=e.b,J=e.a,I=C.tmp;if(I.pos==I.array.length){var M=I.array.length<<1;128>M&&(M=128);var L=new Float32Array(M);L.set(I.array);I.array=L}I.array[I.pos++]=E;var P=C.tmp;if(P.pos==P.array.length){var N=P.array.length<<1;128>N&&(N=128);var Q=new Float32Array(N);Q.set(P.array);P.array=Q}P.array[P.pos++]=D;var O=C.tmp;if(O.pos==O.array.length){var T=O.array.length<<1;
128>T&&(T=128);var W=new Float32Array(T);W.set(O.array);O.array=W}O.array[O.pos++]=0;var U=C.tmp;if(U.pos==U.array.length){var S=U.array.length<<1;128>S&&(S=128);var V=new Float32Array(S);V.set(U.array);U.array=V}U.array[U.pos++]=0;var R=C.tmp;if(R.pos==R.array.length){var X=R.array.length<<1;128>X&&(X=128);var aa=new Float32Array(X);aa.set(R.array);R.array=aa}R.array[R.pos++]=F;var Y=C.tmp;if(Y.pos==Y.array.length){var Z=Y.array.length<<1;128>Z&&(Z=128);var ca=new Float32Array(Z);ca.set(Y.array);
Y.array=ca}Y.array[Y.pos++]=H;var ba=C.tmp;if(ba.pos==ba.array.length){var ha=ba.array.length<<1;128>ha&&(ha=128);var ea=new Float32Array(ha);ea.set(ba.array);ba.array=ea}ba.array[ba.pos++]=K;var fa=C.tmp;if(fa.pos==fa.array.length){var ia=fa.array.length<<1;128>ia&&(ia=128);var ja=new Float32Array(ia);ja.set(fa.array);fa.array=ja}fa.array[fa.pos++]=J;C.bufferDirty=!0;var da=this.content,la=e.x-w,ma=e.y-x,na=e.r,oa=e.g,qa=e.b,ra=e.a,ka=da.tmp;if(ka.pos==ka.array.length){var sa=ka.array.length<<1;
128>sa&&(sa=128);var ua=new Float32Array(sa);ua.set(ka.array);ka.array=ua}ka.array[ka.pos++]=la;var pa=da.tmp;if(pa.pos==pa.array.length){var wa=pa.array.length<<1;128>wa&&(wa=128);var ya=new Float32Array(wa);ya.set(pa.array);pa.array=ya}pa.array[pa.pos++]=ma;var ta=da.tmp;if(ta.pos==ta.array.length){var xa=ta.array.length<<1;128>xa&&(xa=128);var Aa=new Float32Array(xa);Aa.set(ta.array);ta.array=Aa}ta.array[ta.pos++]=0;var va=da.tmp;if(va.pos==va.array.length){var Ca=va.array.length<<1;128>Ca&&(Ca=
128);var Da=new Float32Array(Ca);Da.set(va.array);va.array=Da}va.array[va.pos++]=0;var za=da.tmp;if(za.pos==za.array.length){var Ea=za.array.length<<1;128>Ea&&(Ea=128);var Ja=new Float32Array(Ea);Ja.set(za.array);za.array=Ja}za.array[za.pos++]=na;var Ba=da.tmp;if(Ba.pos==Ba.array.length){var Ha=Ba.array.length<<1;128>Ha&&(Ha=128);var Fa=new Float32Array(Ha);Fa.set(Ba.array);Ba.array=Fa}Ba.array[Ba.pos++]=oa;var Ga=da.tmp;if(Ga.pos==Ga.array.length){var Ka=Ga.array.length<<1;128>Ka&&(Ka=128);var La=
new Float32Array(Ka);La.set(Ga.array);Ga.array=La}Ga.array[Ga.pos++]=qa;var Ia=da.tmp;if(Ia.pos==Ia.array.length){var Ma=Ia.array.length<<1;128>Ma&&(Ma=128);var Na=new Float32Array(Ma);Na.set(Ia.array);Ia.array=Na}Ia.array[Ia.pos++]=ra;da.bufferDirty=!0;var Qa=t==c?a:this.pindex+2;if(t<g-1||f){var Ua=this.content;Ua.index.push(this.pindex);var Ra=Ua.state;Ra.tail.count+=1;Ra.totalCount+=1;Ua.indexDirty=!0;var Sa=this.content;Sa.index.push(this.pindex+1);var Ta=Sa.state;Ta.tail.count+=1;Ta.totalCount+=
1;Sa.indexDirty=!0;var Za=this.content;Za.index.push(Qa);var Wa=Za.state;Wa.tail.count+=1;Wa.totalCount+=1;Za.indexDirty=!0;var $a=this.content;$a.index.push(this.pindex+1);var Ya=$a.state;Ya.tail.count+=1;Ya.totalCount+=1;$a.indexDirty=!0;var db=this.content;db.index.push(Qa);var Xa=db.state;Xa.tail.count+=1;Xa.totalCount+=1;db.indexDirty=!0;var eb=this.content;eb.index.push(Qa+1);var cb=eb.state;cb.tail.count+=1;cb.totalCount+=1;eb.indexDirty=!0}this.pindex+=2}else{var hb=(n.x-e.x)*w+(n.y-e.y)*
x,Oa=-x,ab=w,fb=.5*this.lineSize/(Oa*r*G+ab*y*G);Oa*=fb;ab*=fb;var bb=t==c?a:this.pindex+3;if(0<hb){var Pa=this.content,jb=e.x+w,kb=e.y+x,lb=e.r,mb=e.g,ob=e.b,sb=e.a,Va=Pa.tmp;if(Va.pos==Va.array.length){var nb=Va.array.length<<1;128>nb&&(nb=128);var pb=new Float32Array(nb);pb.set(Va.array);Va.array=pb}Va.array[Va.pos++]=jb;var gb=Pa.tmp;if(gb.pos==gb.array.length){var tb=gb.array.length<<1;128>tb&&(tb=128);var Db=new Float32Array(tb);Db.set(gb.array);gb.array=Db}gb.array[gb.pos++]=kb;var qb=Pa.tmp;
if(qb.pos==qb.array.length){var Ab=qb.array.length<<1;128>Ab&&(Ab=128);var Fb=new Float32Array(Ab);Fb.set(qb.array);qb.array=Fb}qb.array[qb.pos++]=0;var rb=Pa.tmp;if(rb.pos==rb.array.length){var Cb=rb.array.length<<1;128>Cb&&(Cb=128);var Lb=new Float32Array(Cb);Lb.set(rb.array);rb.array=Lb}rb.array[rb.pos++]=0;var vb=Pa.tmp;if(vb.pos==vb.array.length){var Hb=vb.array.length<<1;128>Hb&&(Hb=128);var Pb=new Float32Array(Hb);Pb.set(vb.array);vb.array=Pb}vb.array[vb.pos++]=lb;var xb=Pa.tmp;if(xb.pos==
xb.array.length){var Jb=xb.array.length<<1;128>Jb&&(Jb=128);var Qb=new Float32Array(Jb);Qb.set(xb.array);xb.array=Qb}xb.array[xb.pos++]=mb;var ub=Pa.tmp;if(ub.pos==ub.array.length){var Ob=ub.array.length<<1;128>Ob&&(Ob=128);var Ub=new Float32Array(Ob);Ub.set(ub.array);ub.array=Ub}ub.array[ub.pos++]=ob;var yb=Pa.tmp;if(yb.pos==yb.array.length){var Sb=yb.array.length<<1;128>Sb&&(Sb=128);var Wb=new Float32Array(Sb);Wb.set(yb.array);yb.array=Wb}yb.array[yb.pos++]=sb;Pa.bufferDirty=!0;var wb=this.content,
$b=e.x-Oa,bc=e.y-ab,dc=e.r,gc=e.g,jc=e.b,lc=e.a,Gb=wb.tmp;if(Gb.pos==Gb.array.length){var Xb=Gb.array.length<<1;128>Xb&&(Xb=128);var hc=new Float32Array(Xb);hc.set(Gb.array);Gb.array=hc}Gb.array[Gb.pos++]=$b;var Bb=wb.tmp;if(Bb.pos==Bb.array.length){var Zb=Bb.array.length<<1;128>Zb&&(Zb=128);var pc=new Float32Array(Zb);pc.set(Bb.array);Bb.array=pc}Bb.array[Bb.pos++]=bc;var Ib=wb.tmp;if(Ib.pos==Ib.array.length){var cc=Ib.array.length<<1;128>cc&&(cc=128);var rc=new Float32Array(cc);rc.set(Ib.array);
Ib.array=rc}Ib.array[Ib.pos++]=0;var Kb=wb.tmp;if(Kb.pos==Kb.array.length){var fc=Kb.array.length<<1;128>fc&&(fc=128);var tc=new Float32Array(fc);tc.set(Kb.array);Kb.array=tc}Kb.array[Kb.pos++]=0;var Nb=wb.tmp;if(Nb.pos==Nb.array.length){var mc=Nb.array.length<<1;128>mc&&(mc=128);var wc=new Float32Array(mc);wc.set(Nb.array);Nb.array=wc}Nb.array[Nb.pos++]=dc;var Rb=wb.tmp;if(Rb.pos==Rb.array.length){var uc=Rb.array.length<<1;128>uc&&(uc=128);var zc=new Float32Array(uc);zc.set(Rb.array);Rb.array=zc}Rb.array[Rb.pos++]=
gc;var Tb=wb.tmp;if(Tb.pos==Tb.array.length){var vc=Tb.array.length<<1;128>vc&&(vc=128);var Ac=new Float32Array(vc);Ac.set(Tb.array);Tb.array=Ac}Tb.array[Tb.pos++]=jc;var Vb=wb.tmp;if(Vb.pos==Vb.array.length){var xc=Vb.array.length<<1;128>xc&&(xc=128);var Dc=new Float32Array(xc);Dc.set(Vb.array);Vb.array=Dc}Vb.array[Vb.pos++]=lc;wb.bufferDirty=!0;var Mb=this.content,Pc=e.x+Oa,Uc=e.y+ab,Xc=e.r,Yc=e.g,fd=e.b,pd=e.a,Yb=Mb.tmp;if(Yb.pos==Yb.array.length){var Fc=Yb.array.length<<1;128>Fc&&(Fc=128);var Vc=
new Float32Array(Fc);Vc.set(Yb.array);Yb.array=Vc}Yb.array[Yb.pos++]=Pc;var ac=Mb.tmp;if(ac.pos==ac.array.length){var Ic=ac.array.length<<1;128>Ic&&(Ic=128);var $c=new Float32Array(Ic);$c.set(ac.array);ac.array=$c}ac.array[ac.pos++]=Uc;var ec=Mb.tmp;if(ec.pos==ec.array.length){var Lc=ec.array.length<<1;128>Lc&&(Lc=128);var gd=new Float32Array(Lc);gd.set(ec.array);ec.array=gd}ec.array[ec.pos++]=0;var ic=Mb.tmp;if(ic.pos==ic.array.length){var Nc=ic.array.length<<1;128>Nc&&(Nc=128);var nd=new Float32Array(Nc);
nd.set(ic.array);ic.array=nd}ic.array[ic.pos++]=0;var nc=Mb.tmp;if(nc.pos==nc.array.length){var Rc=nc.array.length<<1;128>Rc&&(Rc=128);var od=new Float32Array(Rc);od.set(nc.array);nc.array=od}nc.array[nc.pos++]=Xc;var oc=Mb.tmp;if(oc.pos==oc.array.length){var Sc=oc.array.length<<1;128>Sc&&(Sc=128);var rd=new Float32Array(Sc);rd.set(oc.array);oc.array=rd}oc.array[oc.pos++]=Yc;var qc=Mb.tmp;if(qc.pos==qc.array.length){var Zc=qc.array.length<<1;128>Zc&&(Zc=128);var vd=new Float32Array(Zc);vd.set(qc.array);
qc.array=vd}qc.array[qc.pos++]=fd;var sc=Mb.tmp;if(sc.pos==sc.array.length){var ed=sc.array.length<<1;128>ed&&(ed=128);var zd=new Float32Array(ed);zd.set(sc.array);sc.array=zd}sc.array[sc.pos++]=pd;Mb.bufferDirty=!0;var id=this.content;id.index.push(this.pindex);var Qc=id.state;Qc.tail.count+=1;Qc.totalCount+=1;id.indexDirty=!0;var md=this.content;md.index.push(bb);var Tc=md.state;Tc.tail.count+=1;Tc.totalCount+=1;md.indexDirty=!0;var qd=this.content;qd.index.push(this.pindex+2);var Wc=qd.state;Wc.tail.count+=
1;Wc.totalCount+=1;qd.indexDirty=!0;var sd=this.content;sd.index.push(this.pindex+2);var ad=sd.state;ad.tail.count+=1;ad.totalCount+=1;sd.indexDirty=!0;var xd=this.content;xd.index.push(bb);var cd=xd.state;cd.tail.count+=1;cd.totalCount+=1;xd.indexDirty=!0;var yd=this.content;yd.index.push(bb+1);var hd=yd.state;hd.tail.count+=1;hd.totalCount+=1;yd.indexDirty=!0}else{var kc=this.content,Rd=e.x+Oa,Td=e.y+ab,Ud=e.r,Vd=e.g,Xd=e.b,Zd=e.a,Bc=kc.tmp;if(Bc.pos==Bc.array.length){var Ed=Bc.array.length<<1;
128>Ed&&(Ed=128);var Nd=new Float32Array(Ed);Nd.set(Bc.array);Bc.array=Nd}Bc.array[Bc.pos++]=Rd;var Cc=kc.tmp;if(Cc.pos==Cc.array.length){var Jd=Cc.array.length<<1;128>Jd&&(Jd=128);var Pd=new Float32Array(Jd);Pd.set(Cc.array);Cc.array=Pd}Cc.array[Cc.pos++]=Td;var Ec=kc.tmp;if(Ec.pos==Ec.array.length){var Kd=Ec.array.length<<1;128>Kd&&(Kd=128);var Yd=new Float32Array(Kd);Yd.set(Ec.array);Ec.array=Yd}Ec.array[Ec.pos++]=0;var Gc=kc.tmp;if(Gc.pos==Gc.array.length){var Ld=Gc.array.length<<1;128>Ld&&(Ld=
128);var $d=new Float32Array(Ld);$d.set(Gc.array);Gc.array=$d}Gc.array[Gc.pos++]=0;var Hc=kc.tmp;if(Hc.pos==Hc.array.length){var Md=Hc.array.length<<1;128>Md&&(Md=128);var ae=new Float32Array(Md);ae.set(Hc.array);Hc.array=ae}Hc.array[Hc.pos++]=Ud;var Jc=kc.tmp;if(Jc.pos==Jc.array.length){var Od=Jc.array.length<<1;128>Od&&(Od=128);var be=new Float32Array(Od);be.set(Jc.array);Jc.array=be}Jc.array[Jc.pos++]=Vd;var Kc=kc.tmp;if(Kc.pos==Kc.array.length){var Qd=Kc.array.length<<1;128>Qd&&(Qd=128);var fe=
new Float32Array(Qd);fe.set(Kc.array);Kc.array=fe}Kc.array[Kc.pos++]=Xd;var Oc=kc.tmp;if(Oc.pos==Oc.array.length){var Sd=Oc.array.length<<1;128>Sd&&(Sd=128);var he=new Float32Array(Sd);he.set(Oc.array);Oc.array=he}Oc.array[Oc.pos++]=Zd;kc.bufferDirty=!0;var yc=this.content,Be=e.x-w,De=e.y-x,Ee=e.r,Fe=e.g,Je=e.b,Me=e.a,bd=yc.tmp;if(bd.pos==bd.array.length){var ce=bd.array.length<<1;128>ce&&(ce=128);var ne=new Float32Array(ce);ne.set(bd.array);bd.array=ne}bd.array[bd.pos++]=Be;var dd=yc.tmp;if(dd.pos==
dd.array.length){var de=dd.array.length<<1;128>de&&(de=128);var se=new Float32Array(de);se.set(dd.array);dd.array=se}dd.array[dd.pos++]=De;var jd=yc.tmp;if(jd.pos==jd.array.length){var ee=jd.array.length<<1;128>ee&&(ee=128);var ue=new Float32Array(ee);ue.set(jd.array);jd.array=ue}jd.array[jd.pos++]=0;var kd=yc.tmp;if(kd.pos==kd.array.length){var ge=kd.array.length<<1;128>ge&&(ge=128);var xe=new Float32Array(ge);xe.set(kd.array);kd.array=xe}kd.array[kd.pos++]=0;var ld=yc.tmp;if(ld.pos==ld.array.length){var ie=
ld.array.length<<1;128>ie&&(ie=128);var Ce=new Float32Array(ie);Ce.set(ld.array);ld.array=Ce}ld.array[ld.pos++]=Ee;var td=yc.tmp;if(td.pos==td.array.length){var je=td.array.length<<1;128>je&&(je=128);var He=new Float32Array(je);He.set(td.array);td.array=He}td.array[td.pos++]=Fe;var ud=yc.tmp;if(ud.pos==ud.array.length){var ke=ud.array.length<<1;128>ke&&(ke=128);var Ke=new Float32Array(ke);Ke.set(ud.array);ud.array=Ke}ud.array[ud.pos++]=Je;var wd=yc.tmp;if(wd.pos==wd.array.length){var le=wd.array.length<<
1;128>le&&(le=128);var Pe=new Float32Array(le);Pe.set(wd.array);wd.array=Pe}wd.array[wd.pos++]=Me;yc.bufferDirty=!0;var Mc=this.content,hf=e.x-Oa,jf=e.y-ab,kf=e.r,lf=e.g,mf=e.b,nf=e.a,Ad=Mc.tmp;if(Ad.pos==Ad.array.length){var ze=Ad.array.length<<1;128>ze&&(ze=128);var $e=new Float32Array(ze);$e.set(Ad.array);Ad.array=$e}Ad.array[Ad.pos++]=hf;var Bd=Mc.tmp;if(Bd.pos==Bd.array.length){var Ae=Bd.array.length<<1;128>Ae&&(Ae=128);var af=new Float32Array(Ae);af.set(Bd.array);Bd.array=af}Bd.array[Bd.pos++]=
jf;var Cd=Mc.tmp;if(Cd.pos==Cd.array.length){var Ge=Cd.array.length<<1;128>Ge&&(Ge=128);var bf=new Float32Array(Ge);bf.set(Cd.array);Cd.array=bf}Cd.array[Cd.pos++]=0;var Dd=Mc.tmp;if(Dd.pos==Dd.array.length){var Ie=Dd.array.length<<1;128>Ie&&(Ie=128);var cf=new Float32Array(Ie);cf.set(Dd.array);Dd.array=cf}Dd.array[Dd.pos++]=0;var Fd=Mc.tmp;if(Fd.pos==Fd.array.length){var Le=Fd.array.length<<1;128>Le&&(Le=128);var df=new Float32Array(Le);df.set(Fd.array);Fd.array=df}Fd.array[Fd.pos++]=kf;var Gd=Mc.tmp;
if(Gd.pos==Gd.array.length){var Ne=Gd.array.length<<1;128>Ne&&(Ne=128);var ef=new Float32Array(Ne);ef.set(Gd.array);Gd.array=ef}Gd.array[Gd.pos++]=lf;var Hd=Mc.tmp;if(Hd.pos==Hd.array.length){var Oe=Hd.array.length<<1;128>Oe&&(Oe=128);var ff=new Float32Array(Oe);ff.set(Hd.array);Hd.array=ff}Hd.array[Hd.pos++]=mf;var Id=Mc.tmp;if(Id.pos==Id.array.length){var Qe=Id.array.length<<1;128>Qe&&(Qe=128);var gf=new Float32Array(Qe);gf.set(Id.array);Id.array=gf}Id.array[Id.pos++]=nf;Mc.bufferDirty=!0;var Re=
this.content;Re.index.push(this.pindex+1);var me=Re.state;me.tail.count+=1;me.totalCount+=1;Re.indexDirty=!0;var Se=this.content;Se.index.push(bb);var oe=Se.state;oe.tail.count+=1;oe.totalCount+=1;Se.indexDirty=!0;var Te=this.content;Te.index.push(this.pindex+2);var pe=Te.state;pe.tail.count+=1;pe.totalCount+=1;Te.indexDirty=!0;var Ue=this.content;Ue.index.push(this.pindex+1);var qe=Ue.state;qe.tail.count+=1;qe.totalCount+=1;Ue.indexDirty=!0;var Ve=this.content;Ve.index.push(bb);var re=Ve.state;re.tail.count+=
1;re.totalCount+=1;Ve.indexDirty=!0;var We=this.content;We.index.push(bb+1);var te=We.state;te.tail.count+=1;te.totalCount+=1;We.indexDirty=!0}var Xe=this.content;Xe.index.push(this.pindex);var ve=Xe.state;ve.tail.count+=1;ve.totalCount+=1;Xe.indexDirty=!0;var Ye=this.content;Ye.index.push(this.pindex+1);var we=Ye.state;we.tail.count+=1;we.totalCount+=1;Ye.indexDirty=!0;var Ze=this.content;Ze.index.push(this.pindex+2);var ye=Ze.state;ye.tail.count+=1;ye.totalCount+=1;Ze.indexDirty=!0;this.pindex+=
3}d=e;e=n}this.content.setTile(this.tile)},flushFill:function(a){if(!(3>this.tmpPoints.length)){var b=this.tmpPoints;var c=b[0];var d=b[b.length-1];var e=null;var f=c.x-d.x;1E-9>(0>f?-f:f)?(f=c.y-d.y,f=1E-9>(0>f?-f:f)):f=!1;f&&(e=b.pop());if(this.isConvex(b))for(f=1,c=b.length-1;f<c;){d=f++;var g=this.content;g.index.push(a);var h=g.state;h.tail.count+=1;h.totalCount+=1;g.indexDirty=!0;h=this.content;h.index.push(a+d);g=h.state;g.tail.count+=1;g.totalCount+=1;h.indexDirty=!0;h=this.content;h.index.push(a+
d+1);d=h.state;d.tail.count+=1;d.totalCount+=1;h.indexDirty=!0}else for(c=ze.EARCUT,null==c&&(c=new Ug,ze.EARCUT=c),f=0,c=c.triangulate_h2d_GPoint(b);f<c.length;)d=c[f],++f,g=this.content,g.index.push(d+a),h=g.state,h.tail.count+=1,h.totalCount+=1,g.indexDirty=!0;null!=e&&b.push(e)}},flush:function(){0!=this.tmpPoints.length&&(this.doFill&&(this.flushFill(this.pindex),this.pindex+=this.tmpPoints.length,this.content.next()&&(this.pindex=0)),0<this.lineSize&&(this.flushLine(this.pindex),this.content.next()&&
(this.pindex=0)),this.tmpPoints=[])},beginFill:function(a,b){null==b&&(b=1);null==a&&(a=0);this.flush();this.tile=ib.fromColor(16777215);this.content.setTile(this.tile);null==b&&(b=1);this.curA=b;this.curR=(a>>16&255)/255;this.curG=(a>>8&255)/255;this.curB=(a&255)/255;this.doFill=!0},beginTileFill:function(a,b,c,d,e){null==e&&(e=this.tile);if(null==e)throw u.thrown("Tile not specified");this.flush();this.tile=e;this.content.setTile(e);this.curB=this.curG=this.curR=this.curA=1;this.doFill=!0;null==
a&&(a=0);null==b&&(b=0);null==c&&(c=1);null==d&&(d=1);a-=e.x;b-=e.y;e=e.innerTex;var f=1/e.height;this.ma=1/e.width/c;this.mc=this.mb=0;this.md=f/d;this.mx=-a*this.ma;this.my=-b*this.md},drawTile:function(a,b,c){this.beginTileFill(a,b,null,null,c);this.drawRect(a,b,c.width,c.height);this.endFill()},lineStyle:function(a,b,c){null==c&&(c=1);null==b&&(b=0);null==a&&(a=0);this.flush();this.lineSize=a;this.lineA=c;this.lineR=(b>>16&255)/255;this.lineG=(b>>8&255)/255;this.lineB=(b&255)/255},moveTo:function(a,
b){this.flush();this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my)},endFill:function(){this.flush();this.doFill=!1},setColor:function(a,b){null==b&&(b=1);this.curA=b;this.curR=(a>>16&255)/255;this.curG=(a>>8&255)/255;this.curB=(a&255)/255},drawRect:function(a,b,c,d){this.flush();this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);var e=a+c;this.addVertex(e,b,this.curR,this.curG,
this.curB,this.curA,e*this.ma+b*this.mc+this.mx,e*this.mb+b*this.md+this.my);e=a+c;c=b+d;this.addVertex(e,c,this.curR,this.curG,this.curB,this.curA,e*this.ma+c*this.mc+this.mx,e*this.mb+c*this.md+this.my);c=b+d;this.addVertex(a,c,this.curR,this.curG,this.curB,this.curA,a*this.ma+c*this.mc+this.mx,a*this.mb+c*this.md+this.my);this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);this.tmpPoints[0].x+=.01;this.tmpPoints[0].y+=.01;this.tmpPoints[1].y+=
.01;this.tmpPoints[3].x+=.01;this.tmpPoints[4].x+=.01;this.tmpPoints[4].y+=.01;this.flush()},drawRoundedRect:function(a,b,c,d,e,f){null==f&&(f=0);if(0>=e)this.drawRect(a,b,c,d);else{a+=e;b+=e;c-=2*e;d-=2*e;this.flush();0==f&&(f=1.5707963267948966*e/4,f=Math.ceil(0>f?-f:f));3>f&&(f=3);var g=1.5707963267948966/(f-1);var h=b-e;this.addVertex(a,h,this.curR,this.curG,this.curB,this.curA,a*this.ma+h*this.mc+this.mx,a*this.mb+h*this.md+this.my);var k=a+c;h=b-e;this.addVertex(k,h,this.curR,this.curG,this.curB,
this.curA,k*this.ma+h*this.mc+this.mx,k*this.mb+h*this.md+this.my);k=a+c;for(var l=0,m=f;l<m;){var p=l++;var t=p*g+4.71238898038469;p=k+Math.cos(t)*e;h=b+Math.sin(t)*e;this.addVertex(p,h,this.curR,this.curG,this.curB,this.curA,p*this.ma+h*this.mc+this.mx,p*this.mb+h*this.md+this.my)}k=a+c+e;h=b+d;this.addVertex(k,h,this.curR,this.curG,this.curB,this.curA,k*this.ma+h*this.mc+this.mx,k*this.mb+h*this.md+this.my);k=a+c;h=b+d;l=0;for(m=f;l<m;)p=l++,t=p*g,p=k+Math.cos(t)*e,c=h+Math.sin(t)*e,this.addVertex(p,
c,this.curR,this.curG,this.curB,this.curA,p*this.ma+c*this.mc+this.mx,p*this.mb+c*this.md+this.my);h=b+d+e;this.addVertex(a,h,this.curR,this.curG,this.curB,this.curA,a*this.ma+h*this.mc+this.mx,a*this.mb+h*this.md+this.my);h=b+d;l=0;for(m=f;l<m;)p=l++,t=p*g+1.5707963267948966,k=a+Math.cos(t)*e,c=h+Math.sin(t)*e,this.addVertex(k,c,this.curR,this.curG,this.curB,this.curA,k*this.ma+c*this.mc+this.mx,k*this.mb+c*this.md+this.my);k=a-e;this.addVertex(k,b,this.curR,this.curG,this.curB,this.curA,k*this.ma+
b*this.mc+this.mx,k*this.mb+b*this.md+this.my);l=0;for(m=f;l<m;)p=l++,t=p*g+3.141592653589793,k=a+Math.cos(t)*e,h=b+Math.sin(t)*e,this.addVertex(k,h,this.curR,this.curG,this.curB,this.curA,k*this.ma+h*this.mc+this.mx,k*this.mb+h*this.md+this.my);this.flush()}},drawCircle:function(a,b,c,d){null==d&&(d=0);this.flush();if(0==d){var e=6.28*c/4;d=Math.ceil(0>e?-e:e)}3>d&&(d=3);e=6.283185307179586/d;var f=0;for(d+=1;f<d;){var g=f++*e,h=a+Math.cos(g)*c;g=b+Math.sin(g)*c;this.addVertex(h,g,this.curR,this.curG,
this.curB,this.curA,h*this.ma+g*this.mc+this.mx,h*this.mb+g*this.md+this.my)}this.flush()},drawEllipse:function(a,b,c,d,e,f){null==f&&(f=0);null==e&&(e=0);this.flush();if(0==f){var g=6.28*d/4;f=Math.ceil(0>g?-g:g)}3>f&&(f=3);g=6.283185307179586/f;var h=0;for(f+=1;h<f;){var k=h++*g;var l=Math.cos(k)*Math.cos(e)*c-Math.sin(k)*Math.sin(e)*d;k=Math.cos(e)*Math.sin(k)*d+Math.cos(k)*Math.sin(e)*c;l=a+l;k=b+k;this.addVertex(l,k,this.curR,this.curG,this.curB,this.curA,l*this.ma+k*this.mc+this.mx,l*this.mb+
k*this.md+this.my)}this.flush()},drawPie:function(a,b,c,d,e,f){null==f&&(f=0);if(6.283185307179586<=(0>e?-e:e))this.drawCircle(a,b,c,f);else{this.flush();this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);if(0==f){var g=c*e/4;f=Math.ceil(0>g?-g:g)}3>f&&(f=3);e/=f-1;for(g=0;g<f;){var h=g++*e+d,k=a+Math.cos(h)*c;h=b+Math.sin(h)*c;this.addVertex(k,h,this.curR,this.curG,this.curB,this.curA,k*this.ma+h*this.mc+this.mx,k*this.mb+h*this.md+
this.my)}this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);this.flush()}},drawPieInner:function(a,b,c,d,e,f,g){null==g&&(g=0);this.flush();6.284185307179587<=(0>f?-f:f)&&(f=6.284185307179587);var h=Math.sin(e),k=Math.cos(e+f),l=Math.sin(e+f);var m=a+Math.cos(e)*d;var p=b+h*d;this.addVertex(m,p,this.curR,this.curG,this.curB,this.curA,m*this.ma+p*this.mc+this.mx,m*this.mb+p*this.md+this.my);0==g&&(g=c*f/4,g=Math.ceil(0>g?-g:g));3>g&&
(g=3);f/=g-1;h=0;for(var t=g;h<t;)m=h++,p=m*f+e,m=a+Math.cos(p)*c,p=b+Math.sin(p)*c,this.addVertex(m,p,this.curR,this.curG,this.curB,this.curA,m*this.ma+p*this.mc+this.mx,m*this.mb+p*this.md+this.my);m=a+k*d;p=b+l*d;this.addVertex(m,p,this.curR,this.curG,this.curB,this.curA,m*this.ma+p*this.mc+this.mx,m*this.mb+p*this.md+this.my);h=0;for(t=g;h<t;)m=h++,p=(g-1-m)*f+e,m=a+Math.cos(p)*d,p=b+Math.sin(p)*d,this.addVertex(m,p,this.curR,this.curG,this.curB,this.curA,m*this.ma+p*this.mc+this.mx,m*this.mb+
p*this.md+this.my);this.flush()},drawRectanglePie:function(a,b,c,d,e,f,g){null==g&&(g=0);if(6.283185307179586<=(0>f?-f:f))this.drawRect(a-c/2,b-d/2,c,d);else{this.flush();this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);if(0==g){var h=(c<d?d:c)*f/4;g=Math.ceil(0>h?-h:h)}3>g&&(g=3);f/=g-1;h=Math.sqrt(2);for(var k=0;k<g;){var l=k++*f+e,m=Math.cos(l)*(c/2+1)*h,p=Math.sin(l)*(d/2+1)*h;(0>m?-m:m)>=c/2&&(m=0>Math.cos(l)?c/2*-1:c/2);(0>p?
-p:p)>=d/2&&(p=0>Math.sin(l)?d/2*-1:d/2);l=a+m;p=b+p;this.addVertex(l,p,this.curR,this.curG,this.curB,this.curA,l*this.ma+p*this.mc+this.mx,l*this.mb+p*this.md+this.my)}this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my);this.flush()}},curveTo:function(a,b,c,d){var e=0==this.tmpPoints.length?0:this.tmpPoints[this.tmpPoints.length-1].x,f=0==this.tmpPoints.length?0:this.tmpPoints[this.tmpPoints.length-1].y;this.cubicCurveTo(e+.6666666666666666*
(a-e),f+.6666666666666666*(b-f),c+.6666666666666666*(a-c),d+.6666666666666666*(b-d),c,d)},cubicCurveTo:function(a,b,c,d,e,f,g){null==g&&(g=40);for(var h=0==this.tmpPoints.length?0:this.tmpPoints[this.tmpPoints.length-1].x,k=0==this.tmpPoints.length?0:this.tmpPoints[this.tmpPoints.length-1].y,l=a-h,m=b-k,p=c-a,t=d-b,n=e-c,r=f-d,y=1/g,G=1;G<g;){var q=G++*y,u=h+q*l,v=k+q*m,w=a+q*p,x=b+q*t;u+=q*(w-u);v+=q*(x-v);w=u+q*(w+q*(c+q*n-w)-u);q=v+q*(x+q*(d+q*r-x)-v);this.addVertex(w,q,this.curR,this.curG,this.curB,
this.curA,w*this.ma+q*this.mc+this.mx,w*this.mb+q*this.md+this.my)}this.addVertex(e,f,this.curR,this.curG,this.curB,this.curA,e*this.ma+f*this.mc+this.mx,e*this.mb+f*this.md+this.my)},lineTo:function(a,b){this.addVertex(a,b,this.curR,this.curG,this.curB,this.curA,a*this.ma+b*this.mc+this.mx,a*this.mb+b*this.md+this.my)},addVertex:function(a,b,c,d,e,f,g,h){null==h&&(h=0);null==g&&(g=0);var k=this.lineSize/2;a-k<this.xMin&&(this.xMin=a-k);b-k<this.yMin&&(this.yMin=b-k);a+k>this.xMax&&(this.xMax=a+k);
b+k>this.yMax&&(this.yMax=b+k);a<this.xMinSize&&(this.xMinSize=a);b<this.yMinSize&&(this.yMinSize=b);a>this.xMaxSize&&(this.xMaxSize=a);b>this.yMaxSize&&(this.yMaxSize=b);if(this.doFill){k=this.content;var l=k.tmp;if(l.pos==l.array.length){var m=l.array.length<<1;128>m&&(m=128);m=new Float32Array(m);m.set(l.array);l.array=m}l.array[l.pos++]=a;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=b;l=k.tmp;l.pos==l.array.length&&
(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=g;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=h;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=c;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=
d;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=e;l=k.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=f;k.bufferDirty=!0}c=new Yf;c.load(a,b,this.lineR,this.lineG,this.lineB,this.lineA);this.tmpPoints.push(c)},draw:function(a){a.beginDrawBatchState(this)&&this.content.doRender(a)},sync:function(a){Va.prototype.sync.call(this,a);this.flush();
this.content.flush()},__class__:ze});var $f=function(){};z["hxd.Interactive"]=$f;$f.__name__="hxd.Interactive";$f.__isInterface__=!0;$f.prototype={__class__:$f};var ag=function(a,b,c,d){this.shapeX=this.shapeY=0;this.mouseDownButton=this.lastClickFrame=-1;this.cancelEvents=this.propagateEvents=this.enableRightButton=this.allowMultiClick=!1;this.cursor=zc.Button;Ra.call(this,c);this.width=a;this.height=b;this.shape=d};z["h2d.Interactive"]=ag;ag.__name__="h2d.Interactive";ag.__interfaces__=[$f];ag.__super__=
Ra;ag.prototype=J(Ra.prototype,{onAdd:function(){this.scene=this.getScene();null!=this.scene&&this.scene.addEventTarget(this);Ra.prototype.onAdd.call(this)},draw:function(a){this.maskedBounds=a.getCurrentRenderZone(this.maskedBounds);null!=this.backgroundColor&&this.emitTile(a,ib.fromColor(this.backgroundColor,this.width|0,this.height|0,(this.backgroundColor>>>24)/255))},getBoundsRec:function(a,b,c){Ra.prototype.getBoundsRec.call(this,a,b,c);(null!=this.backgroundColor||c)&&this.addBounds(a,b,0,0,
this.width|0,this.height|0)},onHierarchyMoved:function(a){Ra.prototype.onHierarchyMoved.call(this,a);null!=this.scene&&(this.scene.removeEventTarget(this),this.scene=this.getScene(),null!=this.scene&&this.scene.addEventTarget(this))},onRemove:function(){null!=this.scene&&(this.scene.removeEventTarget(this,!0),this.scene=null);Ra.prototype.onRemove.call(this)},checkBounds:function(a){switch(a.kind._hx_index){case 4:case 6:case 7:case 10:return!1;default:return!0}},preventClick:function(){this.mouseDownButton=
-1},getInteractiveScene:function(){return this.scene},handleEvent:function(a){if(null!=this.maskedBounds&&this.checkBounds(a)){var b=a.relX,c=a.relY;null==c&&(c=0);null==b&&(b=0);b=new ta(b,c);this.localToGlobal(b);if(b.x<this.maskedBounds.xMin||b.y<this.maskedBounds.yMin||b.x>this.maskedBounds.xMax||b.y>this.maskedBounds.yMax){a.cancel=!0;return}}if(null==this.shape&&this.isEllipse&&this.checkBounds(a)&&(c=.5*this.width,b=.5*this.height,c=(a.relX-c)/c,b=(a.relY-b)/b,1<c*c+b*b)){a.cancel=!0;return}this.propagateEvents&&
(a.propagate=!0);this.cancelEvents&&(a.cancel=!0);switch(a.kind._hx_index){case 0:if(this.enableRightButton||0==a.button)this.mouseDownButton=a.button,this.onPush(a),a.cancel&&(this.mouseDownButton=-1);break;case 1:if(this.enableRightButton||0==a.button)this.onRelease(a),b=ba.frameCount,this.mouseDownButton!=a.button||this.lastClickFrame==b&&!this.allowMultiClick||(this.onClick(a),this.lastClickFrame=b);this.mouseDownButton=-1;break;case 2:this.onMove(a);break;case 3:this.onOver(a);break;case 4:this.onOut(a);
break;case 5:a.propagate=!0;this.onWheel(a);break;case 6:this.onFocus(a);break;case 7:this.onFocusLost(a);break;case 8:this.onKeyDown(a);break;case 9:this.onKeyUp(a);break;case 10:if(this.enableRightButton||0==a.button)if(this.onRelease(a),this.mouseDownButton==a.button)this.onReleaseOutside(a);this.mouseDownButton=-1;break;case 11:this.onTextInput(a);break;case 12:this.onCheck(a)}},calcAbsPos:function(){Ra.prototype.calcAbsPos.call(this);this.invDet=1/(this.matA*this.matD-this.matB*this.matC)},set_cursor:function(a){this.cursor=
a;null!=this.scene&&null!=this.scene.events&&this.scene.events.updateCursor(this);return a},eventToLocal:function(a){var b=a.relX-this.absX,c=a.relY-this.absY;a.relX=(b*this.matD-c*this.matC)*this.invDet;a.relY=(-b*this.matB+c*this.matA)*this.invDet},startCapture:function(a,b,c){var d=this;this.scene.startCapture(function(b){var c=b.relX,e=b.relY;d.eventToLocal(b);a(b);b.relX=c;b.relY=e},b,c)},stopCapture:function(){this.scene.stopCapture()},startDrag:function(a,b){this.startCapture(a,b)},stopDrag:function(){this.stopCapture()},
focus:function(){null!=this.scene&&null!=this.scene.events&&this.scene.events.focus(this)},blur:function(){this.hasFocus()&&this.scene.events.blur()},isOver:function(){return null!=this.scene&&null!=this.scene.events?-1!=this.scene.events.overList.indexOf(this):!1},hasFocus:function(){return null!=this.scene&&null!=this.scene.events?this.scene.events.currentFocus==this:!1},onOver:function(a){},onOut:function(a){},onPush:function(a){},onRelease:function(a){},onReleaseOutside:function(a){},onClick:function(a){},
onMove:function(a){},onWheel:function(a){},onFocus:function(a){},onFocusLost:function(a){},onKeyUp:function(a){},onKeyDown:function(a){},onCheck:function(a){},onTextInput:function(a){},__class__:ag});var Ee=function(a){Ra.call(this,a);this.layersIndexes=[];this.layerCount=0};z["h2d.Layers"]=Ee;Ee.__name__="h2d.Layers";Ee.__super__=Ra;Ee.prototype=J(Ra.prototype,{addChild:function(a){this.add(a,-1)},add:function(a,b,c){null==c&&(c=-1);null==b&&(b=-1);if(a.parent==this){var d=a.allocated;a.allocated=
!1;this.removeChild(a);a.allocated=d}for(-1==b&&(b=0==this.layerCount?0:this.layerCount-1);b>=this.layerCount;)this.layersIndexes[this.layerCount++]=this.children.length;-1!=c?0==b?(d=this.layersIndexes[b],c=c>d?d:c,Ra.prototype.addChildAt.call(this,a,0<c?c:0)):0>c?Ra.prototype.addChildAt.call(this,a,this.layersIndexes[b-1]):(c=this.layersIndexes[b-1]+c,d=this.layersIndexes[b],Ra.prototype.addChildAt.call(this,a,c>d?d:c)):Ra.prototype.addChildAt.call(this,a,this.layersIndexes[b]);a=b;for(b=this.layerCount;a<
b;)c=a++,this.layersIndexes[c]++},addChildAt:function(a,b){this.add(a,-1,b)},removeChild:function(a){for(var b=0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==a){this.children.splice(d,1);if(a.allocated)a.onRemove();a.parent=null;a.posChanged=!0;null!=a.parentContainer&&a.setParentContainer(null);for(a=this.layerCount-1;0<=a&&this.layersIndexes[a]>d;)this.layersIndexes[a]--,--a;null!=this.parentContainer&&this.parentContainer.contentChanged(this);break}}},under:function(a){for(var b=
0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==a){c=b=0;for(var e=this.layersIndexes;c<e.length;){var f=e[c];++c;if(f>d)break;else b=f}for(;d>b;)this.children[d]=this.children[d-1],--d;this.children[b]=a;if(a.allocated)a.onHierarchyMoved(!1);break}}},over:function(a){for(var b=0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==a){c=0;for(var e=this.layersIndexes;c<e.length;)if(b=e[c],++c,b>d){for(c=b-1;d<c;)e=d++,this.children[e]=this.children[e+1];this.children[b-1]=a;if(a.allocated)a.onHierarchyMoved(!1);
break}break}}},getLayer:function(a){a=a>=this.layerCount?[]:this.children.slice(0==a?0:this.layersIndexes[a-1],this.layersIndexes[a]);return new Rg(a)},getChildAtLayer:function(a,b){-1==b&&(b=0==this.layerCount?0:this.layerCount-1);return b>=this.layerCount||0>a||a>=this.layersIndexes[b]?null:0==b?this.children[a]:this.children[this.layersIndexes[b-1]+a]},getChildLayer:function(a){if(a.parent!=this)return-1;a=this.children.indexOf(a);for(var b=0,c=this.layerCount;b<c;){var d=b++;if(this.layersIndexes[d]>
a)return d}return-1},getChildIndexInLayer:function(a){if(a.parent!=this)return-1;a=this.children.indexOf(a);if(a<this.layersIndexes[0])return a;for(var b=1,c=this.layerCount;b<c;){var d=b++;if(this.layersIndexes[d]>a)return a-this.layersIndexes[d-1]}return-1},drawLayer:function(a,b){var c;if(!(b>=this.layerCount)){var d=a.globalAlpha;a.globalAlpha*=this.alpha;var e=0==b?0:this.layersIndexes[b-1];b=this.layersIndexes[b];if(a.front2back){var f=e;for(c=b;f<c;)e=f++,this.children[b-1-e].drawRec(a)}else for(f=
e,c=b;f<c;)e=f++,this.children[e].drawRec(a);a.globalAlpha=d}},ysort:function(a){if(!(a>=this.layerCount)){var b=0==a?0:this.layersIndexes[a-1];a=this.layersIndexes[a];if(b!=a)for(var c=b,d=this.children[c++].y;c<a;){var e=this.children[c];if(e.y<d){for(var f=c-1;f>=b;){var g=this.children[f];if(e.y>=g.y)break;this.children[f+1]=g;--f}this.children[f+1]=e;if(e.allocated)e.onHierarchyMoved(!1)}else d=e.y;++c}}},__class__:Ee});var jb=function(){this.shaderBuffers=new gi;this.engine=na.CURRENT;this.time=
this.frame=0;this.elapsedTime=1/ia.getDefaultFrameRate();this.textures=new Wc;this.globals=new za};z["h3d.impl.RenderContext"]=jb;jb.__name__="h3d.impl.RenderContext";jb.get=function(){return jb.inst};jb.getType=function(a){var b=jb.inst;return Z.__downcastCheck(b,a)?b:null};jb.prototype={setCurrent:function(){jb.inst=this},clearCurrent:function(){if(jb.inst==this)jb.inst=null;else throw u.thrown("Context has changed");},dispose:function(){this.textures.dispose()},fillRec:function(a,b,c,d){var e;
switch(b._hx_index){case 1:return c[d]=a,1;case 3:return c[d]=a,1;case 5:var f=b.size;if(4==f)return c[d++]=a.x,c[d++]=a.y,c[d++]=a.z,c[d++]=a.w,4;var g=f;c[d++]=a.x;c[d++]=a.y;3==g&&(c[d++]=a.z);return g;case 6:var h=a;c[d++]=h._11;c[d++]=h._21;c[d++]=h._31;c[d++]=0;c[d++]=h._12;c[d++]=h._22;c[d++]=h._32;c[d++]=0;c[d++]=h._13;c[d++]=h._23;c[d++]=h._33;c[d++]=0;return 12;case 7:return h=a,c[d++]=h._11,c[d++]=h._21,c[d++]=h._31,c[d++]=h._41,c[d++]=h._12,c[d++]=h._22,c[d++]=h._32,c[d++]=h._42,c[d++]=
h._13,c[d++]=h._23,c[d++]=h._33,c[d++]=h._43,c[d++]=h._14,c[d++]=h._24,c[d++]=h._34,c[d++]=h._44,16;case 8:return h=a,c[d++]=h._11,c[d++]=h._21,c[d++]=h._31,c[d++]=h._41,c[d++]=h._12,c[d++]=h._22,c[d++]=h._32,c[d++]=h._42,c[d++]=h._13,c[d++]=h._23,c[d++]=h._33,c[d++]=h._43,12;case 13:b=b.vl;for(f=h=0;f<b.length;)g=b[f],++f,h+=this.fillRec(ua.field(a,g.name),g.type,c,d+h);return h;case 15:f=b.t;var k=b.size;switch(f._hx_index){case 3:if(0==k._hx_index){b=k.v;h=a.length<b?a.length:b;f=0;for(k=h;f<k;)g=
f++,c[d++]=a[g];return b}throw u.thrown("assert "+w.string(b));case 5:if(4==f.size)if(1==f.t._hx_index){if(0==k._hx_index){b=k.v;f=0;for(k=b;f<k;){g=f++;g=a[g];if(null==g)break;c[d++]=g.x;c[d++]=g.y;c[d++]=g.z;c[d++]=g.w}return 4*b}}else{if(0==k._hx_index){h=f;b=k.v;f=e=0;for(k=b;f<k;){g=f++;g=a[g];if(null==g)break;e=this.fillRec(g,h,c,d);d+=e}return b*e}}else if(0==k._hx_index){h=f;b=k.v;f=e=0;for(k=b;f<k;){g=f++;g=a[g];if(null==g)break;e=this.fillRec(g,h,c,d);d+=e}return b*e}throw u.thrown("assert "+
w.string(b));case 8:if(0==k._hx_index){b=k.v;f=0;for(k=b;f<k;){g=f++;h=a[g];if(null==h)break;c[d++]=h._11;c[d++]=h._21;c[d++]=h._31;c[d++]=h._41;c[d++]=h._12;c[d++]=h._22;c[d++]=h._32;c[d++]=h._42;c[d++]=h._13;c[d++]=h._23;c[d++]=h._33;c[d++]=h._43}return 12*b}throw u.thrown("assert "+w.string(b));default:if(0==k._hx_index){h=f;b=k.v;f=e=0;for(k=b;f<k;){g=f++;g=a[g];if(null==g)break;e=this.fillRec(g,h,c,d);d+=e}return b*e}throw u.thrown("assert "+w.string(b));}default:throw u.thrown("assert "+w.string(b));
}},shaderInfo:function(a,b){for(b=b.split(".").pop();null!=a;){for(var c=0,d=a.s.instance.shader.vars;c<d.length;){var e=d[c];++c;if(e.name==b)return a.s.toString()}a=a.next}return"(not found)"},getPtr:function(a){return a},getParamValue:function(a,b,c){null==c&&(c=!1);if(null!=a.perObjectGlobal){var d=this.globals.map.h[a.perObjectGlobal.gid];if(null==d)throw u.thrown("Missing global value "+a.perObjectGlobal.path+" for shader "+this.shaderInfo(b,a.perObjectGlobal.path));return 17==a.type._hx_index?
d.texture:d}for(d=a.instance;0<--d;)b=b.next;d=b.s.getParamValue(a.index);if(null==d&&!c)throw u.thrown("Missing param value "+w.string(b.s)+"."+a.name);return d},fillGlobals:function(a,b){var c;var d=b.vertex.globals;for(c=a.vertex.globals;null!=d;){var e=this.globals.map.h[d.gid];if(null==e)throw u.thrown("Missing global value "+d.path);this.fillRec(e,d.type,c,d.pos);d=d.next}if(null!=b.fragment)for(d=b.fragment.globals,c=a.fragment.globals;null!=d;){e=this.globals.map.h[d.gid];if(null==e)throw u.thrown("Missing global value "+
d.path);this.fillRec(e,d.type,c,d.pos);d=d.next}},fillParams:function(a,b,c,d){var e;null==d&&(d=!1);var f=-1;var g=null;var h=a.vertex;var k=b.vertex;var l=k.params;for(e=h.params;null!=l;){if(null==l.perObjectGlobal){switch(l.type._hx_index){case 1:case 3:var m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;e[l.pos]=m.getParamFloatValue(l.index);l=l.next;continue}m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m)throw u.thrown("Missing param value "+
w.string(g)+"."+l.name);}else if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw u.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));var p=l.type;m=(p=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m)throw u.thrown("Missing param value "+w.string(c.s)+"."+l.name);}this.fillRec(m,l.type,e,l.pos);l=l.next}e=
0;for(l=k.textures;null!=l;){p=!jb.STRICT;null==p&&(p=!1);if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw u.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;m=(p=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m&&!p)throw u.thrown("Missing param value "+w.string(c.s)+"."+l.name);}if(0>l.pos){var t=
m;var n=0;for(p=-l.pos;n<p;)m=n++,h.tex[e++]=t[m]}else h.tex[e++]=m;l=l.next}l=k.buffers;for(k=0;null!=l;){p=!jb.STRICT;null==p&&(p=!1);if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw u.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;e=(e=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m&&!p)throw u.thrown("Missing param value "+
w.string(c.s)+"."+l.name);e=m}h.buffers[k++]=e;l=l.next}if(null!=b.fragment){h=a.fragment;k=b.fragment;l=k.params;for(e=h.params;null!=l;){if(null==l.perObjectGlobal){switch(l.type._hx_index){case 1:case 3:m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;e[l.pos]=m.getParamFloatValue(l.index);l=l.next;continue}m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m)throw u.thrown("Missing param value "+w.string(g)+"."+l.name);}else if(null!=
l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw u.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;m=(p=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m)throw u.thrown("Missing param value "+w.string(c.s)+"."+l.name);}this.fillRec(m,l.type,e,l.pos);l=l.next}e=0;for(l=k.textures;null!=l;){p=!jb.STRICT;
null==p&&(p=!1);if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw u.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;m=(p=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m&&!p)throw u.thrown("Missing param value "+w.string(c.s)+"."+l.name);}if(0>l.pos)for(t=m,n=0,p=-l.pos;n<p;)m=n++,h.tex[e++]=
t[m];else h.tex[e++]=m;l=l.next}l=k.buffers;for(k=0;null!=l;){p=!jb.STRICT;null==p&&(p=!1);if(null!=l.perObjectGlobal){m=this.globals.map.h[l.perObjectGlobal.gid];if(null==m)throw u.thrown("Missing global value "+l.perObjectGlobal.path+" for shader "+this.shaderInfo(c,l.perObjectGlobal.path));p=l.type;e=(e=17==p._hx_index?!0:!1)?m.texture:m}else{m=l.instance;if(f!=m){g=c;f=m;for(d&&++m;0<--m;)g=g.next;g=g.s}m=g;m=m.getParamValue(l.index);if(null==m&&!p)throw u.thrown("Missing param value "+w.string(c.s)+
"."+l.name);e=m}h.buffers[k++]=e;l=l.next}}},__class__:jb};var cg=function(a){this.renderZoneIndex=0;this.renderZoneStack=[];this.currentCamera=null;this.tmpBounds=new pc;this.defaultSmooth=!1;this.globalAlpha=1;jb.call(this);this.scene=a;this.bufPos=0;this.output=new bg;this.pass=new ja("",null);this.pass.depth(!0,nb.Always);this.pass.set_culling(Ib.None);this.baseShader=new af;this.baseShader.setPriority(100);this.baseShader.zValue__=0;this.baseShaderList=new Fb(this.baseShader);this.targetsStack=
[];this.targetsStackIndex=0;this.cameraStack=[];this.cameraStackIndex=0;this.filterStack=[];this.filterStackIndex=0};z["h2d.RenderContext"]=cg;cg.__name__="h2d.RenderContext";cg.__super__=jb;cg.prototype=J(jb.prototype,{dispose:function(){jb.prototype.dispose.call(this);null!=this.fixedBuffer&&this.fixedBuffer.dispose()},hasBuffering:function(){return!1},begin:function(){this.currentObj=this.texture=null;this.stride=this.bufPos=0;this.viewA=this.scene.viewportA;this.viewC=this.viewB=0;this.viewD=
this.scene.viewportD;this.viewX=this.scene.viewportX;this.viewY=this.scene.viewportY;this.setCurrent();this.targetFlipY=this.engine.driver.hasFeature(Ta.BottomLeftCoords)?-1:1;this.baseFlipY=null!=this.engine.getCurrentTarget()?this.targetFlipY:1;this.inFilter=null;this.globals.set("time",this.time);this.globals.set("global.time",this.time);var a=this.baseShader;a.constModified=!0;a.pixelAlign__=!1;a=this.baseShader.halfPixelInverse__;var b=.5/this.engine.width,c=.5/this.engine.height;null==c&&(c=
0);null==b&&(b=0);a.x=b;a.y=c;a.z=0;a=this.baseShader.viewportA__;b=this.scene.viewportA;c=0;var d=this.scene.viewportX;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a=this.baseShader.viewportB__;b=0;c=this.scene.viewportD*-this.baseFlipY;d=this.scene.viewportY*-this.baseFlipY;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a=this.baseShader.filterMatrixA__;b=1;d=c=0;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a=this.baseShader.filterMatrixB__;b=
0;c=1;d=0;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;this.baseShaderList.next=null;this.initShaders(this.baseShaderList);this.engine.selectMaterial(this.pass);this.textures.begin()},allocTarget:function(a,b){null==b&&(b=!1);a=this.textures.allocTarget(a,this.scene.width,this.scene.height,!1);a.set_filter(b?sd.Linear:sd.Nearest);return a},clear:function(a){this.engine.clear(a)},initShaders:function(a){this.needInitShaders=!1;this.currentShaders=a;this.compiledShader=this.output.compileShaders(this.globals,
a);a=this.shaderBuffers;var b=this.compiledShader;a.vertex.grow(b.vertex);null!=b.fragment&&a.fragment.grow(b.fragment);this.fillGlobals(a,this.compiledShader);this.engine.selectShader(this.compiledShader);this.engine.uploadShaderBuffers(a,0)},end:function(){this.currentObj=this.texture=null;this.baseShaderList.next=null;this.clearCurrent();if(0!=this.targetsStackIndex)throw u.thrown("Missing popTarget()");if(0!=this.cameraStackIndex)throw u.thrown("Missing popCamera()");},pushCamera:function(a){var b=
this.cameraStack[this.cameraStackIndex++];null==b&&(b={va:0,vb:0,vc:0,vd:0,vx:0,vy:0,camera:null},this.cameraStack.push(b));var c=this.viewA,d=this.viewB,e=this.viewC,f=this.viewD;b.va=c;b.vb=d;b.vc=e;b.vd=f;b.vx=this.viewX;b.vy=this.viewY;b.camera=this.currentCamera;this.currentCamera=a;this.viewA=a.matA*c+a.matB*e;this.viewB=a.matA*d+a.matB*f;this.viewC=a.matC*c+a.matD*e;this.viewD=a.matC*d+a.matD*f;this.viewX=a.absX*c+a.absY*e+this.viewX;this.viewY=a.absX*d+a.absY*f+this.viewY;a=null!=this.curTarget?
-this.targetFlipY:-this.baseFlipY;b=this.baseShader.viewportA__;c=this.viewA;d=this.viewC;e=this.viewX;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.baseShader.viewportB__;c=this.viewB*a;d=this.viewD*a;e=this.viewY*a;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e},popCamera:function(){if(0==this.cameraStackIndex)throw u.thrown("Too many popCamera()");var a=this.cameraStack[--this.cameraStackIndex];this.viewA=a.va;this.viewB=a.vb;this.viewC=a.vc;this.viewD=a.vd;
this.viewX=a.vx;this.viewY=a.vy;this.currentCamera=a.camera;a.camera=null;a=null!=this.curTarget?-this.targetFlipY:-this.baseFlipY;var b=this.baseShader.viewportA__,c=this.viewA,d=this.viewC,e=this.viewX;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.baseShader.viewportB__;c=this.viewB*a;d=this.viewD*a;e=this.viewY*a;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e},pushFilter:function(a){if(0==this.filterStack.length&&null!=this.onEnterFilter&&!this.onEnterFilter(a))return!1;
this.inFilter=this.filterStack[this.filterStackIndex++];null==this.inFilter&&(this.inFilter={spr:null,scaleX:1,scaleY:1},this.filterStack.push(this.inFilter));this.inFilter.spr=a;this.inFilter.scaleX=1;this.inFilter.scaleY=1;return!0},setFilterScale:function(a,b){null!=this.inFilter&&(this.inFilter.scaleX=a,this.inFilter.scaleY=b)},getFilterScale:function(a){null==a&&(a=new ta(0,0));if(null!=this.inFilter){var b=a;var c=this.inFilter.scaleX;var d=this.inFilter.scaleY}else b=a,d=c=1;null==d&&(d=0);
null==c&&(c=0);b.x=c;b.y=d;return a},popFilter:function(){this.inFilter.spr=null;this.filterStackIndex--;if(0<this.filterStackIndex)this.inFilter=this.filterStack[this.filterStackIndex-1];else if(this.inFilter=null,null!=this.onLeaveFilter)this.onLeaveFilter(this.filterStack[this.filterStackIndex].spr)},pushTarget:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=-1);null==c&&(c=0);null==b&&(b=0);this.engine.pushTarget(a);this.initShaders(this.baseShaderList);var f=this.targetsStack[this.targetsStackIndex++];
null==f&&(f={t:null,va:0,vb:0,vc:0,vd:0,vx:0,vy:0,hasRZ:!1,rzX:0,rzY:0,rzW:0,rzH:0},this.targetsStack.push(f));f.t=this.curTarget;f.va=this.viewA;f.vb=this.viewB;f.vc=this.viewC;f.vd=this.viewD;f.vx=this.viewX;f.vy=this.viewY;f.hasRZ=this.hasRenderZone;f.rzX=this.renderX;f.rzY=this.renderY;f.rzW=this.renderW;f.rzH=this.renderH;0>d&&(d=null==a?this.scene.width:a.width);0>e&&(e=null==a?this.scene.height:a.height);this.viewA=2/d;this.viewC=this.viewB=0;this.viewD=2/e;this.viewX=-1-b*this.viewA;this.viewY=
-1-c*this.viewD;b=this.baseShader.halfPixelInverse__;c=.5/(null==a?this.engine.width:a.width);d=.5/(null==a?this.engine.height:a.height);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=0;b=this.baseShader.viewportA__;c=this.viewA;d=this.viewC;e=this.viewX;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.baseShader.viewportB__;c=this.viewB*-this.targetFlipY;d=this.viewD*-this.targetFlipY;e=this.viewY*-this.targetFlipY;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=
e;this.curTarget=a;this.currentBlend=null;this.hasRenderZone&&(this.hasRenderZone=!1,this.engine.setRenderZone())},pushTargets:function(a){this.pushTarget(a[0]);1<a.length&&(this.engine.popTarget(),this.engine.pushTargets(a))},popTarget:function(){if(0>=this.targetsStackIndex)throw u.thrown("Too many popTarget()");this.engine.popTarget();var a=this.targetsStack[--this.targetsStackIndex],b=this.curTarget=a.t;this.viewA=a.va;this.viewB=a.vb;this.viewC=a.vc;this.viewD=a.vd;this.viewX=a.vx;this.viewY=
a.vy;var c=null==b?-this.baseFlipY:-this.targetFlipY;this.initShaders(this.baseShaderList);var d=this.baseShader.halfPixelInverse__,e=.5/(null==b?this.engine.width:b.width);b=.5/(null==b?this.engine.height:b.height);null==b&&(b=0);null==e&&(e=0);d.x=e;d.y=b;d.z=0;d=this.baseShader.viewportA__;e=this.viewA;b=this.viewC;var f=this.viewX;null==f&&(f=0);null==b&&(b=0);null==e&&(e=0);d.x=e;d.y=b;d.z=f;d=this.baseShader.viewportB__;e=this.viewB*c;b=this.viewD*c;f=this.viewY*c;null==f&&(f=0);null==b&&(b=
0);null==e&&(e=0);d.x=e;d.y=b;d.z=f;a.hasRZ&&this.setRZ(a.rzX,a.rzY,a.rzW,a.rzH)},pushRenderZone:function(a,b,c,d){var e=this.renderZoneStack[this.renderZoneIndex++];null==e?(e={hasRZ:this.hasRenderZone,x:this.renderX,y:this.renderY,w:this.renderW,h:this.renderH},this.renderZoneStack[this.renderZoneIndex-1]=e):this.hasRenderZone?(e.hasRZ=!0,e.x=this.renderX,e.y=this.renderY,e.w=this.renderW,e.h=this.renderH):e.hasRZ=!1;this.setRZ(a,b,c,d)},popRenderZone:function(){if(0==this.renderZoneIndex)throw u.thrown("Too many popRenderZone()");
var a=this.renderZoneStack[--this.renderZoneIndex];a.hasRZ?this.setRZ(a.x,a.y,a.w,a.h):(this.hasRenderZone=!1,this.engine.setRenderZone())},getCurrentRenderZone:function(a){if(!this.hasRenderZone)return null;null==a&&(a=new pc);var b=this.renderX,c=this.renderY;a.xMin=b;a.yMin=c;a.xMax=b+this.renderW;a.yMax=c+this.renderH;return a},clipRenderZone:function(a,b,c,d){this.hasRenderZone?(c=Math.min(a+c,this.renderX+this.renderW),d=Math.min(b+d,this.renderY+this.renderH),a=Math.max(a,this.renderX),b=Math.max(b,
this.renderY),c<a&&(c=a),d<b&&(d=b),this.pushRenderZone(a,b,c-a,d-b)):this.pushRenderZone(a,b,c,d)},setRZ:function(a,b,c,d){this.hasRenderZone=!0;this.renderX=a;this.renderY=b;this.renderW=c;this.renderH=d;var e=this.scene.viewportA*this.engine.width/2,f=this.scene.viewportD*this.engine.height/2;if(null!=this.inFilter){var g=this.baseShader.filterMatrixA__,h=this.baseShader.filterMatrixB__;c=a+c;var k=b+d,l=a*g.x+b*g.y+g.z;d=a*h.x+b*h.y+h.z;g=c*g.x+k*g.y+g.z;h=c*h.x+k*h.y+h.z;a=l;b=d;c=g-l;d=h-d}this.engine.setRenderZone(a*
e+this.engine.width/2*(this.scene.viewportX+1)+1E-10|0,b*f+this.engine.height/2*(this.scene.viewportY+1)+1E-10|0,c*e+1E-10|0,d*f+1E-10|0)},clearRZ:function(){this.hasRenderZone=!1;this.engine.setRenderZone()},setRenderZone:function(a,b,c,d){this.pushRenderZone(a,b,c,d)},clearRenderZone:function(){this.popRenderZone()},drawLayer:function(a){this.scene.drawLayer(this,a)},drawScene:function(){this.scene.drawRec(this)},flush:function(){},_flush:function(){if(0!=this.bufPos){this.beforeDraw();var a=this.bufPos/
this.stride|0,b=new $b(a,N.get_XY_UV_RGBA(),[$a.Dynamic]);b.uploadFloats(this.buffer,0,a);a=this.engine;a.renderBuffer(b,a.mem.getQuadIndexes(b.vertices),2,0,-1);b.dispose();this.bufPos=0;this.texture=null}},beforeDraw:function(){null==this.texture&&(this.texture=Y.fromColor(16711935));this.baseShader.texture__=this.texture;this.texture.set_filter((null==this.currentObj.smooth?this.defaultSmooth:this.currentObj.smooth)?sd.Linear:sd.Nearest);this.texture.set_wrap(!this.currentObj.tileWrap||null!=this.currentObj.filter&&
null==this.inFilter?Fe.Clamp:Fe.Repeat);var a=this.currentObj.blendMode;null!=this.inFilter&&this.inFilter.spr==this.currentObj&&a==xa.Erase&&(a=xa.Add);null!=this.inFilterBlend&&(a=this.inFilterBlend);a!=this.currentBlend&&(this.currentBlend=a,this.pass.setBlendMode(a),a==xa.Alpha||a==xa.Add)&&(this.pass.set_blendAlphaSrc(ea.One),null!=this.inFilterBlend&&this.pass.set_blendSrc(ea.One));a=this.shaderBuffers;this.fillParams(a,this.compiledShader,this.currentShaders);this.engine.selectMaterial(this.pass);
this.engine.uploadShaderBuffers(a,1);this.engine.uploadShaderBuffers(a,2);this.engine.uploadShaderBuffers(a,3)},setupColor:function(a){if(null!=this.inFilter&&this.inFilter.spr==a){var b=this.baseShader.color__;var c=a.color.x;var d=a.color.y;var e=a.color.z;a=a.color.w}else null!=this.inFilterBlend?(b=this.baseShader.color__,a=e=d=c=this.globalAlpha):(b=this.baseShader.color__,c=a.color.x,d=a.color.y,e=a.color.z,a=a.color.w*this.globalAlpha);null==a&&(a=1);null==e&&(e=0);null==d&&(d=0);null==c&&
(c=0);b.x=c;b.y=d;b.z=e;b.w=a},beginDrawBatchState:function(a){if(!this.beginDraw(a,null,!0))return!1;if(null!=this.inFilter&&this.inFilter.spr==a){var b=this.baseShader.color__;var c=a.color.x;var d=a.color.y;var e=a.color.z;var f=a.color.w}else null!=this.inFilterBlend?(b=this.baseShader.color__,f=e=d=c=this.globalAlpha):(b=this.baseShader.color__,c=a.color.x,d=a.color.y,e=a.color.z,f=a.color.w*this.globalAlpha);null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b.w=f;
b=this.baseShader.absoluteMatrixA__;c=a.matA;d=a.matC;e=a.absX;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.baseShader.absoluteMatrixB__;c=a.matB;d=a.matD;e=a.absY;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;return!0},swapTexture:function(a){this.texture=a;this.beforeDraw()},beginDrawObject:function(a,b){if(!this.beginDraw(a,b,!0))return!1;if(null!=this.inFilter&&this.inFilter.spr==a){var c=this.baseShader.color__;var d=a.color.x;var e=a.color.y;var f=a.color.z;
b=a.color.w}else null!=this.inFilterBlend?(c=this.baseShader.color__,b=f=e=d=this.globalAlpha):(c=this.baseShader.color__,d=a.color.x,e=a.color.y,f=a.color.z,b=a.color.w*this.globalAlpha);null==b&&(b=1);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c.w=b;c=this.baseShader.absoluteMatrixA__;d=a.matA;e=a.matC;f=a.absX;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c=this.baseShader.absoluteMatrixB__;d=a.matB;e=a.matD;f=a.absY;null==f&&(f=0);null==e&&(e=0);null==d&&(d=
0);c.x=d;c.y=e;c.z=f;this.beforeDraw();return!0},beginDrawBatch:function(a,b){return this.beginDraw(a,b,!1)},drawTile:function(a,b){if(null!=this.inFilter){var c=this.baseShader.filterMatrixA__;var d=this.baseShader.filterMatrixB__;var e=a.matA*c.x+a.matB*c.y;var f=a.matA*d.x+a.matB*d.y;var g=a.matC*c.x+a.matD*c.y;var h=a.matC*d.x+a.matD*d.y;c=a.absX*c.x+a.absY*c.y+c.z;var k=a.absX*d.x+a.absY*d.y+d.z;d=e*this.viewA+f*this.viewC;e=e*this.viewB+f*this.viewD;f=g*this.viewA+h*this.viewC;g=g*this.viewB+
h*this.viewD;h=c*this.viewA+k*this.viewC+this.viewX;c=c*this.viewB+k*this.viewD+this.viewY}else d=a.matA*this.viewA+a.matB*this.viewC,e=a.matA*this.viewB+a.matB*this.viewD,f=a.matC*this.viewA+a.matD*this.viewC,g=a.matC*this.viewB+a.matD*this.viewD,h=a.absX*this.viewA+a.absY*this.viewC+this.viewX,c=a.absX*this.viewB+a.absY*this.viewD+this.viewY;if(0==e&&0==f){k=b.dx+.5*b.width;e=b.dy+.5*b.height;var l=0>d?-d:d;f=0>g?-g:g;f=1.5*(b.width>b.height?b.width:b.height)*(l<f?f:l);d=h+k*d;g=c+e*g;if(-1>d+f||
1<d-f||-1>g+f||1<g-f)return!1}else{var m=1E20,p=1E20,t=-1E20,n=-1E20,r=b.dx*d+b.dy*f;k=b.dx*e+b.dy*g;r<m&&(m=r);r>t&&(t=r);k<p&&(p=k);k>n&&(n=k);l=b.width;r=(l+b.dx)*d+b.dy*f;k=(l+b.dx)*e+b.dy*g;r<m&&(m=r);r>t&&(t=r);k<p&&(p=k);k>n&&(n=k);k=b.height;r=b.dx*d+(k+b.dy)*f;k=b.dx*e+(k+b.dy)*g;r<m&&(m=r);r>t&&(t=r);k<p&&(p=k);k>n&&(n=k);l=b.width;k=b.height;r=(l+b.dx)*d+(k+b.dy)*f;k=(l+b.dx)*e+(k+b.dy)*g;r<m&&(m=r);r>t&&(t=r);k<p&&(p=k);k>n&&(n=k);if(-1>h+t||-1>c+n||1<h+m||1<c+p)return!1}if(!this.beginDraw(a,
b.innerTex,!0,!0))return!1;null!=this.inFilter&&this.inFilter.spr==a?(d=this.baseShader.color__,l=a.color.x,k=a.color.y,h=a.color.z,g=a.color.w):null!=this.inFilterBlend?(d=this.baseShader.color__,g=h=k=l=this.globalAlpha):(d=this.baseShader.color__,l=a.color.x,k=a.color.y,h=a.color.z,g=a.color.w*this.globalAlpha);null==g&&(g=1);null==h&&(h=0);null==k&&(k=0);null==l&&(l=0);d.x=l;d.y=k;d.z=h;d.w=g;d=this.baseShader.absoluteMatrixA__;l=b.width*a.matA;k=b.height*a.matC;h=a.absX+b.dx*a.matA+b.dy*a.matC;
null==h&&(h=0);null==k&&(k=0);null==l&&(l=0);d.x=l;d.y=k;d.z=h;d=this.baseShader.absoluteMatrixB__;l=b.width*a.matB;k=b.height*a.matD;h=a.absY+b.dx*a.matB+b.dy*a.matD;null==h&&(h=0);null==k&&(k=0);null==l&&(l=0);d.x=l;d.y=k;d.z=h;d=this.baseShader.uvPos__;l=b.u;k=b.v;h=b.u2-b.u;g=b.v2-b.v;null==g&&(g=1);null==h&&(h=0);null==k&&(k=0);null==l&&(l=0);d.x=l;d.y=k;d.z=h;d.w=g;this.beforeDraw();if(null==this.fixedBuffer||null==this.fixedBuffer.vbuf)this.fixedBuffer=new $b(4,N.get_XY_UV_RGBA()),a=Xd._new(0),
b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),
a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),
a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=0,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),d.set(a.array),a.array=d),a.array[a.pos++]=b,b=1,a.pos==a.array.length&&(d=a.array.length<<1,128>d&&(d=128),d=new Float32Array(d),
d.set(a.array),a.array=d),a.array[a.pos++]=b,this.fixedBuffer.uploadFloats(a,0,4);d=this.engine;f=this.fixedBuffer;d.renderBuffer(f,d.mem.getQuadIndexes(f.vertices),2,0,-1);return!0},beginDraw:function(a,b,c,d){null==d&&(d=!1);if(null!=this.onBeginDraw&&!this.onBeginDraw(a))return!1;for(var e=this.needInitShaders,f=!1,g=a.shaders,h=this.currentShaders.next;null!=g&&null!=h;){var k=g.s,l=h.s;g=g.next;h=h.next;var m=l.instance;k!=l&&(f=!0);k.updateConstants(this.globals);k.instance!=m&&(e=!0)}if(null!=
g||null!=h||this.baseShader.isRelative__!=c||this.baseShader.hasUVPos__!=d||this.baseShader.killAlpha__!=this.killAlpha)e=!0;if(e)e=this.baseShader,e.constModified=!0,e.hasUVPos__=d,e=this.baseShader,e.constModified=!0,e.isRelative__=c,e=this.baseShader,e.constModified=!0,e.killAlpha__=this.killAlpha,this.baseShader.updateConstants(this.globals),this.baseShaderList.next=a.shaders,this.initShaders(this.baseShaderList);else if(f){if(this.currentShaders!=this.baseShaderList)throw u.thrown("!");this.currentShaders.next=
a.shaders}this.texture=b;this.stride=8;this.currentObj=a;return!0},setCurrent:function(){jb.prototype.setCurrent.call(this);this.needInitShaders=!0},__class__:cg});var ac=L["h2d.ScaleModeAlign"]={__ename__:!0,__constructs__:null,Left:{_hx_name:"Left",_hx_index:0,__enum__:"h2d.ScaleModeAlign",toString:v},Right:{_hx_name:"Right",_hx_index:1,__enum__:"h2d.ScaleModeAlign",toString:v},Center:{_hx_name:"Center",_hx_index:2,__enum__:"h2d.ScaleModeAlign",toString:v},Top:{_hx_name:"Top",_hx_index:3,__enum__:"h2d.ScaleModeAlign",
toString:v},Bottom:{_hx_name:"Bottom",_hx_index:4,__enum__:"h2d.ScaleModeAlign",toString:v}};ac.__constructs__=[ac.Left,ac.Right,ac.Center,ac.Top,ac.Bottom];ac.__empty_constructs__=[ac.Left,ac.Right,ac.Center,ac.Top,ac.Bottom];var Yd=L["h2d.ScaleMode"]={__ename__:!0,__constructs__:null,Resize:{_hx_name:"Resize",_hx_index:0,__enum__:"h2d.ScaleMode",toString:v},Stretch:(A=function(a,b){return{_hx_index:1,width:a,height:b,__enum__:"h2d.ScaleMode",toString:v}},A._hx_name="Stretch",A.__params__=["width",
"height"],A),LetterBox:(A=function(a,b,c,d,e){return{_hx_index:2,width:a,height:b,integerScale:c,horizontalAlign:d,verticalAlign:e,__enum__:"h2d.ScaleMode",toString:v}},A._hx_name="LetterBox",A.__params__=["width","height","integerScale","horizontalAlign","verticalAlign"],A),Fixed:(A=function(a,b,c,d,e){return{_hx_index:3,width:a,height:b,zoom:c,horizontalAlign:d,verticalAlign:e,__enum__:"h2d.ScaleMode",toString:v}},A._hx_name="Fixed",A.__params__=["width","height","zoom","horizontalAlign","verticalAlign"],
A),Zoom:(A=function(a){return{_hx_index:4,level:a,__enum__:"h2d.ScaleMode",toString:v}},A._hx_name="Zoom",A.__params__=["level"],A),AutoZoom:(A=function(a,b,c){return{_hx_index:5,minWidth:a,minHeight:b,integerScaling:c,__enum__:"h2d.ScaleMode",toString:v}},A._hx_name="AutoZoom",A.__params__=["minWidth","minHeight","integerScaling"],A)};Yd.__constructs__=[Yd.Resize,Yd.Stretch,Yd.LetterBox,Yd.Fixed,Yd.Zoom,Yd.AutoZoom];Yd.__empty_constructs__=[Yd.Resize];var dg=function(){};z["hxd.InteractiveScene"]=
dg;dg.__name__="hxd.InteractiveScene";dg.__isInterface__=!0;dg.prototype={__class__:dg};var he=function(){this.scaleMode=Yd.Resize;Ee.call(this,null);var a=na.CURRENT;this.ctx=new cg(this);this._cameras=[];new fi(this);this.set_interactiveCamera(this._cameras[0]);this.width=a.width;this.height=a.height;this.viewportA=2/a.width;this.viewportD=2/a.height;this.viewportY=this.viewportX=-1;this.viewportScaleY=this.viewportScaleX=1;this.offsetY=this.offsetX=0;this.interactive=[];this.eventListeners=[];
this.shapePoint=new ta(0,0);this.window=Gb.getInstance();this.posChanged=!0};z["h2d.Scene"]=he;he.__name__="h2d.Scene";he.__interfaces__=[dg,ye];he.__super__=Ee;he.prototype=J(Ee.prototype,{get_defaultSmooth:function(){return this.ctx.defaultSmooth},set_defaultSmooth:function(a){return this.ctx.defaultSmooth=a},setEvents:function(a){this.events=a},get_zoom:function(){var a=this.scaleMode;return 4==a._hx_index?a.level|0:0},set_zoom:function(a){this.set_scaleMode(Yd.Zoom(a));return a},set_scaleMode:function(a){this.scaleMode=
a;this.checkResize();return a},get_renderer:function(){return this.ctx},set_renderer:function(a){return this.ctx=a},get_camera:function(){return this._cameras[0]},get_cameras:function(){return this._cameras},set_interactiveCamera:function(a){if(null==a)throw u.thrown("Interactive cammera cannot be null!");a.scene!=this&&this.addCamera(a);return this.interactiveCamera=a},addCamera:function(a,b){null!=a.scene&&a.scene.removeCamera(a);a.scene=this;a.posChanged=!0;null!=b?this._cameras.splice(b,0,a):
this._cameras.push(a)},removeCamera:function(a){if(a==this.interactiveCamera)throw u.thrown("Current interactive Camera cannot be removed from camera list!");a.scene=null;D.remove(this._cameras,a)},setFixedSize:function(a,b){this.set_scaleMode(Yd.Stretch(a,b))},checkResize:function(){var a=na.CURRENT;if(null!=a){var b=this.scaleMode;switch(b._hx_index){case 0:var c=a.width;a=a.height;if(c!=this.width||a!=this.height)this.width=c,this.height=a,this.posChanged=!0;this.viewportScaleY=this.viewportScaleX=
1;this.viewportA=2/this.width;this.viewportD=2/this.height;this.viewportY=this.viewportX=-1;break;case 1:var d=b.width,e=b.height;if(d!=this.width||e!=this.height)this.width=d,this.height=e,this.posChanged=!0;this.viewportScaleX=a.width/d;this.viewportScaleY=a.height/e;this.viewportA=2/this.width;this.viewportD=2/this.height;this.viewportY=this.viewportX=-1;break;case 2:d=b.width;e=b.height;c=b.integerScale;var f=b.horizontalAlign;b=b.verticalAlign;if(d!=this.width||e!=this.height)this.width=d,this.height=
e,this.posChanged=!0;var g=a.width/d;e=a.height/e;g=g>e?e:g;c&&(g|=0,0==g&&(g=1));c=f;f=b;this.viewportA=2*g/a.width;this.viewportD=2*g/a.height;this.viewportScaleY=this.viewportScaleX=g;null==c&&(c=ac.Center);switch(c._hx_index){case 0:this.viewportX=-1;this.offsetX=0;break;case 1:this.viewportX=1-this.width*this.viewportA;this.offsetX=a.width-this.width*g;break;default:this.viewportX=Math.floor((a.width-this.width*g)/(2*g))*this.viewportA-1,this.offsetX=Math.floor((a.width-this.width*g)/2)}null==
f&&(f=ac.Center);switch(f._hx_index){case 3:this.viewportY=-1;this.offsetY=0;break;case 4:this.viewportY=1-this.height*this.viewportD;this.offsetY=a.height-this.height*g;break;default:this.viewportY=Math.floor((a.height-this.height*g)/(2*g))*this.viewportD-1,this.offsetY=Math.floor((a.height-this.height*g)/2)}break;case 3:d=b.width;e=b.height;g=b.zoom;f=b.horizontalAlign;b=b.verticalAlign;if(d!=this.width||e!=this.height)this.width=d,this.height=e,this.posChanged=!0;c=f;f=b;this.viewportA=2*g/a.width;
this.viewportD=2*g/a.height;this.viewportScaleY=this.viewportScaleX=g;null==c&&(c=ac.Center);switch(c._hx_index){case 0:this.viewportX=-1;this.offsetX=0;break;case 1:this.viewportX=1-this.width*this.viewportA;this.offsetX=a.width-this.width*g;break;default:this.viewportX=Math.floor((a.width-this.width*g)/(2*g))*this.viewportA-1,this.offsetX=Math.floor((a.width-this.width*g)/2)}null==f&&(f=ac.Center);switch(f._hx_index){case 3:this.viewportY=-1;this.offsetY=0;break;case 4:this.viewportY=1-this.height*
this.viewportD;this.offsetY=a.height-this.height*g;break;default:this.viewportY=Math.floor((a.height-this.height*g)/(2*g))*this.viewportD-1,this.offsetY=Math.floor((a.height-this.height*g)/2)}break;case 4:g=b.level;c=Math.ceil(a.width/g);a=Math.ceil(a.height/g);if(c!=this.width||a!=this.height)this.width=c,this.height=a,this.posChanged=!0;this.viewportScaleY=this.viewportScaleX=g;this.viewportA=2/this.width;this.viewportD=2/this.height;this.viewportY=this.viewportX=-1;break;case 5:f=b.minHeight;c=
b.integerScaling;g=a.width/b.minWidth;e=a.height/f;g=g>e?e:g;c&&(g|=0,0==g&&(g=1));c=Math.ceil(a.width/g);a=Math.ceil(a.height/g);if(c!=this.width||a!=this.height)this.width=c,this.height=a,this.posChanged=!0;this.viewportScaleY=this.viewportScaleX=g;this.viewportA=2/this.width;this.viewportD=2/this.height;this.viewportY=this.viewportX=-1}}},screenXToViewport:function(a){var b=this.interactiveCamera;a=this.window.get_mouseX();var c=this.window.get_mouseY();return(((a-b.scene.offsetX)/b.scene.viewportScaleX-
b.absX)*b.matD-((c-b.scene.offsetY)/b.scene.viewportScaleY-b.absY)*b.matC)*b.invDet},screenYToViewport:function(a){var b=this.interactiveCamera,c=this.window.get_mouseX();a=this.window.get_mouseY();return(-((c-b.scene.offsetX)/b.scene.viewportScaleX-b.absX)*b.matB+((a-b.scene.offsetY)/b.scene.viewportScaleY-b.absY)*b.matA)*b.invDet},get_mouseX:function(){this.syncPos();this.window.get_mouseX();var a=this.interactiveCamera;var b=this.window.get_mouseX();var c=this.window.get_mouseY(),d=(((b-a.scene.offsetX)/
a.scene.viewportScaleX-a.absX)*a.matD-((c-a.scene.offsetY)/a.scene.viewportScaleY-a.absY)*a.matC)*a.invDet-this.absX;if(0==this.matC)return d/this.matA;this.window.get_mouseY();a=this.interactiveCamera;b=this.window.get_mouseX();c=this.window.get_mouseY();return(d*this.matD-((-((b-a.scene.offsetX)/a.scene.viewportScaleX-a.absX)*a.matB+((c-a.scene.offsetY)/a.scene.viewportScaleY-a.absY)*a.matA)*a.invDet-this.absY)*this.matC)/(this.matA*this.matD-this.matB*this.matC)},get_mouseY:function(){this.syncPos();
this.window.get_mouseY();var a=this.interactiveCamera,b=this.window.get_mouseX();var c=this.window.get_mouseY();var d=(-((b-a.scene.offsetX)/a.scene.viewportScaleX-a.absX)*a.matB+((c-a.scene.offsetY)/a.scene.viewportScaleY-a.absY)*a.matA)*a.invDet-this.absY;if(0==this.matB)return d/this.matD;this.window.get_mouseX();a=this.interactiveCamera;b=this.window.get_mouseX();c=this.window.get_mouseY();return(d*this.matA-((((b-a.scene.offsetX)/a.scene.viewportScaleX-a.absX)*a.matD-((c-a.scene.offsetY)/a.scene.viewportScaleY-
a.absY)*a.matC)*a.invDet-this.absX)*this.matB)/(this.matA*this.matD-this.matB*this.matC)},dispatchListeners:function(a){this.screenToViewport(a);for(var b=0,c=this.eventListeners;b<c.length;){var d=c[b];++b;d(a);if(!a.propagate)break}},isInteractiveVisible:function(a){for(;a!=this;){if(null==a||!a.visible)return!1;a=a.parent}return!0},getInteractive:function(a,b){for(var c=this.shapePoint,d=0,e=this.interactive;d<e.length;){var f=e[d];++d;f.posChanged&&f.syncPos();var g=a-f.absX,h=b-f.absY,k=(g*f.matD-
h*f.matC)*f.invDet;h=(h*f.matA-g*f.matB)*f.invDet;if(null!=f.shape){if(g=c,k+=f.shapeX,h+=f.shapeY,null==h&&(h=0),null==k&&(k=0),g.x=k,g.y=h,!f.shape.contains(c))continue}else if(0>h||0>k||k>=f.width||h>=f.height)continue;k=!0;for(g=f;null!=g;){if(!g.visible){k=!1;break}g=g.parent}if(k)return f}return null},screenToViewport:function(a){this.interactiveCamera.eventToCamera(a)},dispatchEvent:function(a,b){this.screenToViewport(a);var c=a.relX-b.absX,d=a.relY-b.absY,e=(d*b.matA-c*b.matB)*b.invDet;a.relX=
(c*b.matD-d*b.matC)*b.invDet;a.relY=e;b.handleEvent(a)},handleEvent:function(a,b){this.screenToViewport(a);var c=a.relX,d=a.relY;if(0>c||0>d||c>=this.width||d>=this.height)return null;var e=null==b?0:this.interactive.indexOf(b)+1;b=this.shapePoint;for(var f=this.interactive.length;e<f;){var g=e++;g=this.interactive[g];if(null==g)break;if(0!=g.invDet){var h=c-g.absX,k=d-g.absY,l=(h*g.matD-k*g.matC)*g.invDet;h=(k*g.matA-h*g.matB)*g.invDet;if(null!=g.shape){k=b;var m=l+g.shapeX,p=h+g.shapeY;null==p&&
(p=0);null==m&&(m=0);k.x=m;k.y=p;if(!g.shape.contains(b))continue}else if(0>h||0>l||l>=g.width||h>=g.height)continue;k=!0;for(m=g;null!=m;){if(!m.visible){k=!1;break}m=m.parent}if(k)if(a.relX=l,a.relY=h,g.handleEvent(a),a.cancel)a.cancel=!1,a.propagate=!1;else return g}}return null},addEventListener:function(a){this.eventListeners.push(a)},removeEventListener:function(a){for(var b=0,c=this.eventListeners;b<c.length;){var d=c[b];++b;if(d==a)return D.remove(this.eventListeners,d),!0}return!1},startCapture:function(a,
b,c){var d=this;this.events.startCapture(function(b){d.screenToViewport(b);a(b)},b,c)},stopCapture:function(){this.events.stopCapture()},startDrag:function(a,b,c){this.startCapture(a,b,null!=c?c.touchId:null)},stopDrag:function(){this.stopCapture()},getFocus:function(){if(null==this.events)return null;var a=this.events.getFocus();if(null==a)return null;a=a instanceof ag?a:null;return null==a?null:this.interactive[this.interactive.indexOf(a)]},addEventTarget:function(a){var b;var c=a;for(b=0;null!=
c;)c=c.parent,++b;for(var d=b,e=0,f=this.interactive.length;e<f;){var g=e++;c=a;var h=this.interactive[g],k=d,l=h;for(b=0;null!=l;)l=l.parent,++b;var m=b;l=c;for(b=h;k>m;)c=l,l=l.parent,--k;for(;m>k;)h=b,b=b.parent,--m;for(;l!=b;)c=l,l=l.parent,h=b,b=b.parent;k=-1;m=0;for(var p=l.children.length;m<p;){var t=m++;if(l.children[t]==c){k=t;break}}c=k;l=-1;k=0;for(m=b.children.length;k<m;)if(p=k++,b.children[p]==h){l=p;break}if(c>l){this.interactive.splice(g,0,a);return}}this.interactive.push(a)},removeEventTarget:function(a,
b){null==b&&(b=!1);D.remove(this.interactive,a);if(b&&null!=this.events)this.events.onRemove(a)},dispose:function(){if(this.allocated)this.onRemove();this.ctx.dispose()},setElapsedTime:function(a){this.ctx.elapsedTime=a},drawImplTo:function(a,b,c){for(var d=0;d<b.length;){var e=b[d];++d;if(0==(e.flags&1<<O.Target._hx_index))throw u.thrown("Can only draw to texture created with Target flag");}this.ctx.engine=na.CURRENT;d=this.ctx.engine.backgroundColor;e=this.ctx.engine.inRender;this.ctx.engine.backgroundColor=
null;this.ctx.globalAlpha=this.alpha;var f=jb.get();e?0==this.ctx.targetFlipY&&this.ctx.begin():(this.ctx.engine.begin(),this.ctx.begin());this.ctx.pushTargets(b);null!=c&&this.ctx.output.setOutput(c);a.drawRec(this.ctx);null!=c&&this.ctx.output.setOutput();this.ctx.popTarget();this.ctx.engine.backgroundColor=d;e||(this.ctx.end(),this.ctx.engine.end());null!=f&&f.setCurrent()},syncOnly:function(a){var b=na.CURRENT;this.setElapsedTime(a);this.ctx.engine=b;this.ctx.frame++;this.ctx.time+=this.ctx.elapsedTime;
this.ctx.globalAlpha=this.alpha;this.sync(this.ctx)},render:function(a){this.ctx.engine=a;this.ctx.frame++;this.ctx.time+=this.ctx.elapsedTime;this.ctx.globalAlpha=this.alpha;this.mark("s2d");this.sync(this.ctx);0!=this.children.length&&(this.ctx.begin(),this.ctx.drawScene(),this.ctx.end());this.mark("vsync")},mark:function(a){},sync:function(a){var b=this.posChanged;if(!this.allocated)this.onAdd();Ee.prototype.sync.call(this,a);for(var c=0,d=this._cameras;c<d.length;){var e=d[c];++c;e.sync(a,b)}},
clipBounds:function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);if(null!=a.inFilter){var e=a.baseShader.filterMatrixA__;var f=a.baseShader.filterMatrixB__;var g=this.matA*e.x+this.matB*e.y;var h=this.matA*f.x+this.matB*f.y;var k=this.matC*e.x+this.matD*e.y;var l=this.matC*f.x+this.matD*f.y;e=this.absX*e.x+this.absY*e.y+e.z;var m=this.absX*f.x+this.absY*f.y+f.z;f=(g*a.viewA+h*a.viewC)/c;g=(g*a.viewB+h*a.viewD)/d;c=(k*a.viewA+l*a.viewC)/c;d=(k*a.viewB+l*a.viewD)/d;k=e*a.viewA+m*a.viewC+a.viewX;a=e*a.viewB+
m*a.viewD+a.viewY}else f=(this.matA*a.viewA+this.matB*a.viewC)/c,g=(this.matA*a.viewB+this.matB*a.viewD)/d,c=(this.matC*a.viewA+this.matD*a.viewC)/c,d=(this.matC*a.viewB+this.matD*a.viewD)/d,k=this.absX*a.viewA+this.absY*a.viewC+a.viewX,a=this.absX*a.viewB+this.absY*a.viewD+a.viewY;e=1/(f*d-g*c);b.xMin=((-1-k)*d+(a+1)*c)*e;b.yMin=((k+1)*g+(-1-a)*f)*e;b.xMax=((1-k)*d+(a-1)*c)*e;b.yMax=((k-1)*g+(1-a)*f)*e},drawContent:function(a){var b;if(a.front2back){var c=0;for(b=this._cameras;c<b.length;){var d=
b[c];++c;if(d.visible){var e=this.children.length;var f=this.layerCount;for(d.enter(a);0<f--;){var g=0==f?0:this.layersIndexes[f-1];if(d.layerVisible(f))for(;e>=g;)this.children[e--].drawRec(a);else e=g-1}d.exit(a)}}this.draw(a)}else for(this.draw(a),c=0,b=this._cameras;c<b.length;)if(d=b[c],++c,d.visible){f=e=0;for(d.enter(a);f<this.layerCount;)if(g=this.layersIndexes[f++],d.layerVisible(f-1))for(;e<g;)this.children[e++].drawRec(a);else e=g;d.exit(a)}},onAdd:function(){this.checkResize();Ee.prototype.onAdd.call(this);
this.window.addResizeEvent(M(this,this.checkResize))},onRemove:function(){Ee.prototype.onRemove.call(this);this.window.removeResizeEvent(M(this,this.checkResize))},captureBitmap:function(a){var b=na.CURRENT;if(null==a){var c=new Y(this.width,this.height,[O.Target]);a=new ib(c,0,0,this.width,this.height)}c=a.innerTex;b.begin();b.pushTarget(c);b.setRenderZone(a.x|0,a.y|0,Math.ceil(a.width),Math.ceil(a.height));var d=this.width,e=this.height,f=this.viewportA,g=this.viewportD,h=this.viewportX,k=this.viewportY;
this.width=c.width;this.height=c.height;this.viewportA=2/this.width;this.viewportD=2/this.height;this.viewportY=this.viewportX=-1;this.posChanged=!0;this.render(b);b.popTarget();this.width=d;this.height=e;this.viewportA=f;this.viewportD=g;this.viewportX=h;this.viewportY=k;this.posChanged=!0;b.setRenderZone();b.end();return new Sg(a)},__class__:he});var Xc=L["h2d.Align"]={__ename__:!0,__constructs__:null,Left:{_hx_name:"Left",_hx_index:0,__enum__:"h2d.Align",toString:v},Right:{_hx_name:"Right",_hx_index:1,
__enum__:"h2d.Align",toString:v},Center:{_hx_name:"Center",_hx_index:2,__enum__:"h2d.Align",toString:v},MultilineRight:{_hx_name:"MultilineRight",_hx_index:3,__enum__:"h2d.Align",toString:v},MultilineCenter:{_hx_name:"MultilineCenter",_hx_index:4,__enum__:"h2d.Align",toString:v}};Xc.__constructs__=[Xc.Left,Xc.Right,Xc.Center,Xc.MultilineRight,Xc.MultilineCenter];Xc.__empty_constructs__=[Xc.Left,Xc.Right,Xc.Center,Xc.MultilineRight,Xc.MultilineCenter];var Og=function(a,b){this.constraintWidth=this.realMaxWidth=
-1;this.lineBreak=!0;this.letterSpacing=this.lineSpacing=0;Va.call(this,b);this.set_font(a);this.set_textAlign(Xc.Left);this.set_text("");this.currentText="";this.set_textColor(16777215)};z["h2d.Text"]=Og;Og.__name__="h2d.Text";Og.__super__=Va;Og.prototype=J(Va.prototype,{set_font:function(a){if(this.font==a)return a;this.font=a;if(null!=a){var b=a.type;switch(b._hx_index){case 0:null!=this.sdfShader&&(this.removeShader(this.sdfShader),this.sdfShader=null);break;case 1:var c=b.channel;var d=b.alphaCutoff;
b=b.smoothing;null==this.sdfShader&&(this.sdfShader=new Cd,this.addShader(this.sdfShader));null==this.smooth&&(this.smooth=!0);this.sdfShader.alphaCutoff__=d;this.sdfShader.smoothing__=b;d=this.sdfShader;d.constModified=!0;d.channel__=c;d=this.sdfShader;d.constModified=!0;d.autoSmoothing__=-1==b}}null!=this.glyphs&&(d=this.glyphs,null!=d&&null!=d.parent&&d.parent.removeChild(d));this.glyphs=new Vg(null==a?null:a.tile,this);this.glyphs.set_visible(!1);this.rebuild();return a},set_textAlign:function(a){if(this.textAlign==
a)return a;this.textAlign=a;this.rebuild();return a},set_letterSpacing:function(a){if(this.letterSpacing==a)return a;this.letterSpacing=a;this.rebuild();return a},set_lineSpacing:function(a){if(this.lineSpacing==a)return a;this.lineSpacing=a;this.rebuild();return a},set_lineBreak:function(a){if(this.lineBreak==a)return a;this.lineBreak=a;this.rebuild();return a},constraintSize:function(a,b){this.constraintWidth=a;this.updateConstraint()},onAdd:function(){Va.prototype.onAdd.call(this);this.rebuild()},
checkText:function(){this.textChanged&&this.text!=this.currentText&&(this.textChanged=!1,this.currentText=this.text,this.calcDone=!1,this.needsRebuild=!0)},sync:function(a){Va.prototype.sync.call(this,a);this.textChanged&&this.text!=this.currentText&&(this.textChanged=!1,this.currentText=this.text,this.calcDone=!1,this.needsRebuild=!0);this.needsRebuild&&this.initGlyphs(this.currentText)},draw:function(a){if(null==this.glyphs)this.emitTile(a,ib.fromColor(16711935,16,16));else{this.textChanged&&this.text!=
this.currentText&&(this.textChanged=!1,this.currentText=this.text,this.calcDone=!1,this.needsRebuild=!0);this.needsRebuild&&this.initGlyphs(this.currentText);if(null!=this.dropShadow){var b=this.absX,c=this.absY;this.absX+=this.dropShadow.dx*this.matA+this.dropShadow.dy*this.matC;this.absY+=this.dropShadow.dx*this.matB+this.dropShadow.dy*this.matD;var d=this.color.x,e=this.color.y,f=this.color.z,g=this.color.w,h=this.color,k=this.dropShadow.color;h.x=(k>>16&255)/255;h.y=(k>>8&255)/255;h.z=(k&255)/
255;h.w=(k>>>24)/255;this.color.w=this.dropShadow.alpha*g;this.glyphs.drawWith(a,this);this.absX=b;this.absY=c;h=this.color;b=d;null==g&&(g=1);null==f&&(f=0);null==e&&(e=0);null==b&&(b=0);h.x=b;h.y=e;h.z=f;h.w=g}this.glyphs.drawWith(a,this)}},set_text:function(a){a=null==a?"null":a;if(a==this.text)return a;this.text=a;this.textChanged=!0;this.validateText();null!=this.parentContainer&&this.parentContainer.contentChanged(this);return a},validateText:function(){},rebuild:function(){this.calcDone=!1;
this.needsRebuild=!0;null!=this.parentContainer&&this.parentContainer.contentChanged(this)},calcTextWidth:function(a){if(this.calcDone){var b=this.calcWidth,c=this.calcHeight,d=this.calcSizeHeight,e=this.calcXMin,f=this.calcYMin;this.initGlyphs(a,!1);a=this.calcWidth;this.calcWidth=b;this.calcHeight=c;this.calcSizeHeight=d;this.calcXMin=e;this.calcYMin=f;return a}this.initGlyphs(a,!1);this.calcDone=!1;return this.calcWidth},splitText:function(a){return this.splitRawText(a,0,0)},splitRawText:function(a,
b,c,d,e,f){null==f&&(f=-1);null==c&&(c=0);null==b&&(b=0);var g=f;f=null!=g?g:-1;g=this.realMaxWidth;if(0>g){if(null==e)return a;g=Infinity}null==d&&(d=this.font);for(var h=[],k=0,l=b,m=0,p=0,t=a.length;p<t;){var n=p++,r=a.charCodeAt(n),y=d.glyphs.h[r];null==y&&(y=d.charset.resolveChar(r,d.glyphs),null==y&&(y=13==r||10==r?d.nullChar:d.defaultChar));var G=10==r;f=y.width+y.getKerningOffset(f);var q=n<a.length-1&&d.charset.isComplementChar(a.charCodeAt(n+1));if(d.charset.isBreakChar(r)&&!q){0==h.length&&
0<b&&l>g&&(h.push(""),null!=e&&e.push(b),l-=b);q=l+f+this.letterSpacing;for(var u=n+1,v=a.length,w=r,x=!1;q<=g&&u<v;){var z=a.charCodeAt(u++);if(this.lineBreak&&(d.charset.isSpace(z)||10==z)){x=!0;break}var A=d.glyphs.h[z];null==A&&(A=d.charset.resolveChar(z,d.glyphs),null==A&&(A=13==z||10==z?d.nullChar:d.defaultChar));q+=A.width+this.letterSpacing+A.getKerningOffset(w);w=z;if(d.charset.isBreakChar(z)){if(u>=a.length)break;z=a.charCodeAt(u);if(!d.charset.isComplementChar(z))break}}this.lineBreak&&
(q>g||!x&&q+c>g)?(G=!0,d.charset.isSpace(r)?(h.push(D.substr(a,k,n-k)),y=null):h.push(D.substr(a,k,n+1-k)),k=n+1):m=q}else l+f+this.letterSpacing-m>g&&(G=!0,h.push(D.substr(a,k,n-k)),k=n+1);null!=y&&10!=r&&(l+=f+this.letterSpacing);G?(null!=e&&e.push(l),m=l=0,f=-1):f=r}k<a.length&&(0==h.length&&0<b&&l+c-this.letterSpacing>g&&(h.push(""),null!=e&&e.push(b),l-=b),h.push(D.substr(a,k,a.length-k)),null!=e&&e.push(l));return h.join("\n")},getTextProgress:function(a,b){return b>=a.length?a:D.substr(a,0,
b|0)},initGlyphs:function(a,b){null==b&&(b=!0);b&&this.glyphs.clear();var c=0,d=0,e=0,f=0,g=0,h=0,k=-1,l=0,m=this.textAlign,p=[],t=this.font.lineHeight+this.lineSpacing,n=this.splitRawText(a,0,0,null,p);for(a=0;a<p.length;){var r=p[a];++a;r>c&&(c=r)}this.calcWidth=c;switch(m._hx_index){case 0:c=0;break;case 1:case 2:case 3:case 4:c=m==Xc.MultilineCenter||m==Xc.MultilineRight?Math.ceil(this.calcWidth):0>this.realMaxWidth?0:Math.ceil(this.realMaxWidth);f=m==Xc.Center||m==Xc.MultilineCenter?.5:1;a=0;
for(r=p.length;a<r;){var y=a++;p[y]=Math.floor((c-p[y])*f)}f=c=p[0]}a=0;for(r=n.length;a<r;){y=a++;y=n.charCodeAt(y);var G=this.font,q=G.glyphs.h[y];null==q&&(q=G.charset.resolveChar(y,G.glyphs),null==q&&(q=13==y||10==y?G.nullChar:G.defaultChar));G=q;q=G.getKerningOffset(k);k=G.width+q;if(10==y){c>e&&(e=c);switch(m._hx_index){case 0:c=0;break;case 1:case 2:case 3:case 4:c=p[++l],c<f&&(f=c)}d+=t;k=-1}else{if(null!=G){if(b){var u=this.glyphs;u.content.add(c+q,d,u.curColor.x,u.curColor.y,u.curColor.z,
u.curColor.w,G.t)}0==d&&G.t.dy<g&&(g=G.t.dy);G=d+G.t.dy+G.t.height;G>h&&(h=G);c+=k+this.letterSpacing}k=y}}c>e&&(e=c);this.calcXMin=f;this.calcYMin=g;this.calcWidth=e-f;this.calcHeight=h-g;this.calcSizeHeight=d+(0<this.font.baseLine?this.font.baseLine:this.font.lineHeight);this.calcDone=!0;b&&(this.needsRebuild=!1)},updateSize:function(){this.textChanged&&this.text!=this.currentText&&(this.textChanged=!1,this.currentText=this.text,this.calcDone=!1,this.needsRebuild=!0);this.calcDone||this.initGlyphs(this.text,
this.needsRebuild)},get_textHeight:function(){this.textChanged&&this.text!=this.currentText&&(this.textChanged=!1,this.currentText=this.text,this.calcDone=!1,this.needsRebuild=!0);this.calcDone||this.initGlyphs(this.text,this.needsRebuild);return 0==this.font.baseLine?this.calcSizeHeight:this.calcSizeHeight-this.font.baseLine+this.font.lineHeight},get_textWidth:function(){this.textChanged&&this.text!=this.currentText&&(this.textChanged=!1,this.currentText=this.text,this.calcDone=!1,this.needsRebuild=
!0);this.calcDone||this.initGlyphs(this.text,this.needsRebuild);return this.calcWidth},set_maxWidth:function(a){if(this.maxWidth==a)return a;this.maxWidth=a;this.updateConstraint();return a},updateConstraint:function(){var a=this.realMaxWidth;if(null==this.maxWidth)this.realMaxWidth=this.constraintWidth;else if(0>this.constraintWidth)this.realMaxWidth=this.maxWidth;else{var b=this.maxWidth,c=this.constraintWidth;this.realMaxWidth=b>c?c:b}this.realMaxWidth!=a&&this.rebuild()},set_textColor:function(a){if(this.textColor==
a)return a;this.textColor=a;var b=this.color.w,c=this.color;c.x=(a>>16&255)/255;c.y=(a>>8&255)/255;c.z=(a&255)/255;c.w=(a>>>24)/255;this.color.w=b;return a},getBoundsRec:function(a,b,c){Va.prototype.getBoundsRec.call(this,a,b,c);this.textChanged&&this.text!=this.currentText&&(this.textChanged=!1,this.currentText=this.text,this.calcDone=!1,this.needsRebuild=!0);this.calcDone||this.initGlyphs(this.text,this.needsRebuild);if(c){c=this.calcXMin;var d=0;var e=this.calcWidth;var f=this.calcSizeHeight}else c=
this.calcXMin,d=this.calcYMin,e=this.calcWidth,f=this.calcHeight;this.addBounds(a,b,c,d,e,f)},__class__:Og});var ib=function(a,b,c,d,e,f,g){null==g&&(g=0);null==f&&(f=0);this.innerTex=a;this.x=b;this.y=c;this.width=d;this.height=e;this.dx=f;this.dy=g;null!=a&&this.setTexture(a)};z["h2d.Tile"]=ib;ib.__name__="h2d.Tile";ib.fromColor=function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=1);a=new ib(Y.fromColor(a,d),0,0,1,1);a.width=b;a.height=c;return a};ib.fromBitmap=function(a){var b=Y.fromBitmap(a);
return new ib(b,0,0,a.ctx.canvas.width,a.ctx.canvas.height)};ib.autoCut=function(a,b,c){a.lock();null==c&&(c=b);for(var d=a.getPixel(a.ctx.canvas.width-1,a.ctx.canvas.height-1),e=[],f=1,g=1;f<a.ctx.canvas.width;)f<<=1;for(;g<a.ctx.canvas.height;)g<<=1;f=new Y(f,g);g=0;for(var h=a.ctx.canvas.height/c|0;g<h;){var k=g++,l=[];e[k]=l;for(var m=0,p=a.ctx.canvas.width/b|0;m<p;){var t=m++,n=ib.isEmpty(a,t*b,k*c,b,c,d);if(null==n)break;l.push(new ib(f,t*b+n.dx,k*c+n.dy,n.w,n.h,n.dx,n.dy))}}a.unlock();b=new ib(f,
0,0,a.ctx.canvas.width,a.ctx.canvas.height);b.upload(a);return{main:b,tiles:e}};ib.fromTexture=function(a){return new ib(a,0,0,a.width,a.height)};ib.fromPixels=function(a){var b=a.makeSquare(!0),c=Y.fromPixels(b,Y.nativeFormat);b!=a&&b.dispose();return new ib(c,0,0,a.width,a.height)};ib.isEmpty=function(a,b,c,d,e,f){for(var g=!0,h=d,k=e,l=0,m=0,p=0;p<d;)for(var t=p++,n=0,r=e;n<r;){var y=n++,G=a.getPixel(t+b,y+c);0==(G&-16777216)?0!=G&&a.setPixel(t+b,y+c,0):(G!=f&&(g=!1,t<h&&(h=t),y<k&&(k=y),t>l&&
(l=t),y>m&&(m=y)),G==f&&0!=G&&a.setPixel(t+b,y+c,0))}return g?null:{dx:h,dy:k,w:l-h+1,h:m-k+1}};ib.prototype={get_ix:function(){return Math.floor(this.x)},get_iy:function(){return Math.floor(this.y)},get_iwidth:function(){return Math.ceil(this.width+this.x)-Math.floor(this.x)},get_iheight:function(){return Math.ceil(this.height+this.y)-Math.floor(this.y)},getTexture:function(){return this.innerTex},isDisposed:function(){if(null!=this.innerTex){var a=this.innerTex;return null==a.t?a.isDepth()?!0:null==
a.realloc:!1}return!0},setTexture:function(a){this.innerTex=a;null!=a&&(this.u=this.x/a.width,this.v=this.y/a.height,this.u2=(this.x+this.width)/a.width,this.v2=(this.y+this.height)/a.height)},switchTexture:function(a){this.setTexture(a.innerTex)},sub:function(a,b,c,d,e,f){null==f&&(f=0);null==e&&(e=0);return new ib(this.innerTex,this.x+a,this.y+b,c,d,e,f)},center:function(){return this.sub(0,0,this.width,this.height,-(.5*this.width),-(.5*this.height))},setCenterRatio:function(a,b){null==b&&(b=.5);
null==a&&(a=.5);this.dx=-(a*this.width);this.dy=-(b*this.height)},flipX:function(){var a=this.u;this.u=this.u2;this.u2=a;this.dx=-this.dx-this.width},flipY:function(){var a=this.v;this.v=this.v2;this.v2=a;this.dy=-this.dy-this.height},setPosition:function(a,b){this.x=a;this.y=b;var c=this.innerTex;null!=c&&(this.u=a/c.width,this.v=b/c.height,this.u2=(a+this.width)/c.width,this.v2=(b+this.height)/c.height)},setSize:function(a,b){this.width=a;this.height=b;var c=this.innerTex;null!=c&&(this.u2=(this.x+
a)/c.width,this.v2=(this.y+b)/c.height)},scaleToSize:function(a,b){this.width=a;this.height=b},scrollDiscrete:function(a,b){var c=this.innerTex;this.u+=a/c.width;this.v-=b/c.height;this.u2+=a/c.width;this.v2-=b/c.height;this.x=this.u*c.width;this.y=this.v*c.height},dispose:function(){null!=this.innerTex&&this.innerTex.dispose();this.innerTex=null},clone:function(){var a=new ib(null,this.x,this.y,this.width,this.height,this.dx,this.dy);a.innerTex=this.innerTex;a.u=this.u;a.u2=this.u2;a.v=this.v;a.v2=
this.v2;return a},get_xFlip:function(){return this.u2<this.u},get_yFlip:function(){return this.v2<this.v},set_xFlip:function(a){a!=this.get_xFlip()&&this.flipX();return a},set_yFlip:function(a){a!=this.get_yFlip()&&this.flipY();return a},split:function(a,b,c){var d;null==c&&(c=!1);null==b&&(b=!1);null==a&&(a=0);var e=[];if(b)for(0==a&&(a=this.height/this.width|0),c=c?this.height/a:this.height/a|0,b=0,d=a;b<d;)a=b++,e.push(this.sub(0,a*c,this.width,c));else for(0==a&&(a=this.width/this.height|0),c=
c?this.width/a:this.width/a|0,b=0,d=a;b<d;)a=b++,e.push(this.sub(a*c,0,c,this.height));return e},gridFlatten:function(a,b,c){null==c&&(c=0);null==b&&(b=0);for(var d=[],e=0,f=this.height/a|0;e<f;)for(var g=e++,h=0,k=this.width/a|0;h<k;){var l=h++;d.push(this.sub(l*a,g*a,a,a,b,c))}return d},grid:function(a,b,c){null==c&&(c=0);null==b&&(b=0);for(var d=[],e=0,f=this.width/a|0;e<f;){for(var g=e++,h=[],k=0,l=this.height/a|0;k<l;){var m=k++;h.push(this.sub(g*a,m*a,a,a,b,c))}d.push(h)}return d},toString:function(){return"Tile("+
this.x+","+this.y+","+this.width+"x"+this.height+(0!=this.dx||0!=this.dy?","+this.dx+":"+this.dy:"")+")"},upload:function(a){this.innerTex.uploadBitmap(a)},__class__:ib};var Wg=function(){this.useAllocatorLimit=1024;Wa.call(this);this.state=new Zf;this.clear()};z["h2d.TileLayerContent"]=Wg;Wg.__name__="h2d.TileLayerContent";Wg.__super__=Wa;Wg.prototype=J(Wa.prototype,{clear:function(){this.tmp=Xd._new(0);null!=this.buffer&&(8*this.buffer.vertices<this.useAllocatorLimit?Ob.get().disposeBuffer(this.buffer):
this.buffer.dispose());this.buffer=null;this.yMin=this.xMin=Infinity;this.yMax=this.xMax=-Infinity;this.state.clear()},isEmpty:function(){return 0==this.triCount()},triCount:function(){return null==this.buffer?this.tmp.pos>>4:this.buffer.vertices>>1},addColor:function(a,b,c,d){this.add(a,b,c.x,c.y,c.z,c.w,d)},add:function(a,b,c,d,e,f,g){var h=a+g.dx,k=b+g.dy,l=this.tmp;if(l.pos==l.array.length){var m=l.array.length<<1;128>m&&(m=128);m=new Float32Array(m);m.set(l.array);l.array=m}l.array[l.pos++]=
h;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=k;l=this.tmp;var p=g.u;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;p=g.v;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=
new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=c;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=d;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=e;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=f;l=this.tmp;p=h+g.width;l.pos==
l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=k;l=this.tmp;p=g.u2;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;p=g.v;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),
l.array=m);l.array[l.pos++]=p;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=c;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=d;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=e;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&
(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=f;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=h;l=this.tmp;p=k+g.height;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;p=g.u;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=
p;l=this.tmp;p=g.v2;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=c;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=d;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),
m.set(l.array),l.array=m);l.array[l.pos++]=e;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=f;l=this.tmp;p=h+g.width;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;p=k+g.height;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;p=g.u2;l.pos==
l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;p=g.v2;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=p;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=c;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),
l.array=m);l.array[l.pos++]=d;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=e;l=this.tmp;l.pos==l.array.length&&(m=l.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(l.array),l.array=m);l.array[l.pos++]=f;a+=g.dx;b+=g.dy;a<this.xMin&&(this.xMin=a);b<this.yMin&&(this.yMin=b);a+=g.width;b+=g.height;a>this.xMax&&(this.xMax=a);b>this.yMax&&(this.yMax=b);null!=g&&this.state.setTexture(g.innerTex);g=this.state;
g.tail.count+=4;g.totalCount+=4},addTransform:function(a,b,c,d,e,f,g){var h=Math.cos(e);e=Math.sin(e);var k=g.width,l=g.height,m=g.dx*c,p=g.dy*d,t=m*h-p*e+a;m=p*h+m*e+b;p=this.tmp;if(p.pos==p.array.length){var n=p.array.length<<1;128>n&&(n=128);n=new Float32Array(n);n.set(p.array);p.array=n}p.array[p.pos++]=t;p=this.tmp;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=m;p=this.tmp;var r=g.u;p.pos==p.array.length&&(n=p.array.length<<
1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=g.v;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.x;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.y;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=
r;p=this.tmp;r=f.z;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.w;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;t<this.xMin&&(this.xMin=t);m<this.yMin&&(this.yMin=m);t>this.xMax&&(this.xMax=t);m>this.yMax&&(this.yMax=m);m=(g.dx+k)*c;p=g.dy*d;t=m*h-p*e+a;m=p*h+m*e+b;p=this.tmp;p.pos==p.array.length&&(n=p.array.length<<1,128>
n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=t;p=this.tmp;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=m;p=this.tmp;r=g.u2;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=g.v;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;
p=this.tmp;r=f.x;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.y;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.z;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.w;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),
n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;t<this.xMin&&(this.xMin=t);m<this.yMin&&(this.yMin=m);t>this.xMax&&(this.xMax=t);m>this.yMax&&(this.yMax=m);m=g.dx*c;p=(g.dy+l)*d;t=m*h-p*e+a;m=p*h+m*e+b;p=this.tmp;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=t;p=this.tmp;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=m;p=this.tmp;
r=g.u;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=g.v2;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.x;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.y;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),
n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.z;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.w;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;t<this.xMin&&(this.xMin=t);m<this.yMin&&(this.yMin=m);t>this.xMax&&(this.xMax=t);m>this.yMax&&(this.yMax=m);m=(g.dx+k)*c;p=(g.dy+l)*d;t=m*h-p*e+a;m=p*h+m*e+b;p=this.tmp;p.pos==
p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=t;p=this.tmp;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=m;p=this.tmp;r=g.u2;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=g.v2;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),
p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.x;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.y;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.z;p.pos==p.array.length&&(n=p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;p=this.tmp;r=f.w;p.pos==p.array.length&&(n=
p.array.length<<1,128>n&&(n=128),n=new Float32Array(n),n.set(p.array),p.array=n);p.array[p.pos++]=r;t<this.xMin&&(this.xMin=t);m<this.yMin&&(this.yMin=m);t>this.xMax&&(this.xMax=t);m>this.yMax&&(this.yMax=m);null!=g&&this.state.setTexture(g.innerTex);a=this.state;a.tail.count+=4;a.totalCount+=4},addPoint:function(a,b,c){var d=this.tmp;if(d.pos==d.array.length){var e=d.array.length<<1;128>e&&(e=128);e=new Float32Array(e);e.set(d.array);d.array=e}d.array[d.pos++]=a;d=this.tmp;d.pos==d.array.length&&
(e=d.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(d.array),d.array=e);d.array[d.pos++]=b;d=this.tmp;d.pos==d.array.length&&(e=d.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(d.array),d.array=e);d.array[d.pos++]=0;d=this.tmp;d.pos==d.array.length&&(e=d.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(d.array),d.array=e);d.array[d.pos++]=0;d=this.tmp;d.pos==d.array.length&&(e=d.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(d.array),d.array=e);d.array[d.pos++]=
(c>>16&255)/255;d=this.tmp;d.pos==d.array.length&&(e=d.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(d.array),d.array=e);d.array[d.pos++]=(c>>8&255)/255;d=this.tmp;d.pos==d.array.length&&(e=d.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(d.array),d.array=e);d.array[d.pos++]=(c&255)/255;d=this.tmp;d.pos==d.array.length&&(e=d.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(d.array),d.array=e);d.array[d.pos++]=(c>>>24)/255;a<this.xMin&&(this.xMin=a);b<this.yMin&&
(this.yMin=b);a>this.xMax&&(this.xMax=a);b>this.yMax&&(this.yMax=b)},insertColor:function(a){var b=this.tmp;if(b.pos==b.array.length){var c=b.array.length<<1;128>c&&(c=128);c=new Float32Array(c);c.set(b.array);b.array=c}b.array[b.pos++]=(a>>16&255)/255;b=this.tmp;b.pos==b.array.length&&(c=b.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(b.array),b.array=c);b.array[b.pos++]=(a>>8&255)/255;b=this.tmp;b.pos==b.array.length&&(c=b.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(b.array),
b.array=c);b.array[b.pos++]=(a&255)/255;b=this.tmp;b.pos==b.array.length&&(c=b.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(b.array),b.array=c);b.array[b.pos++]=(a>>>24)/255},rectColor:function(a,b,c,d,e){var f=this.tmp;if(f.pos==f.array.length){var g=f.array.length<<1;128>g&&(g=128);g=new Float32Array(g);g.set(f.array);f.array=g}f.array[f.pos++]=a;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=b;
f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=0;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=0;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>16&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),
g.set(f.array),f.array=g);f.array[f.pos++]=(e>>8&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>>24)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=a+c;f=this.tmp;
f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=b;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=1;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=0;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),
f.array=g);f.array[f.pos++]=(e>>16&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>8&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>>24)/255;f=this.tmp;f.pos==
f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=a;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=b+d;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=0;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),
f.array=g);f.array[f.pos++]=1;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>16&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>8&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e&255)/255;f=this.tmp;f.pos==f.array.length&&
(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>>24)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=a+c;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=b+d;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=
g);f.array[f.pos++]=1;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=1;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>16&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>8&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<
1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e&255)/255;f=this.tmp;f.pos==f.array.length&&(g=f.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(f.array),f.array=g);f.array[f.pos++]=(e>>>24)/255;a<this.xMin&&(this.xMin=a);b<this.yMin&&(this.yMin=b);a+=c;b+=d;a>this.xMax&&(this.xMax=a);b>this.yMax&&(this.yMax=b);a=this.state;a.tail.count+=4;a.totalCount+=4},rectGradient:function(a,b,c,d,e,f,g,h){var k=this.tmp;if(k.pos==k.array.length){var l=k.array.length<<
1;128>l&&(l=128);l=new Float32Array(l);l.set(k.array);k.array=l}k.array[k.pos++]=a;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=b;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=0;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=0;k=this.tmp;
k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(e>>16&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(e>>8&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(e&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=
128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(e>>>24)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=a+c;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=b;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=1;k=this.tmp;
k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=0;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(f>>16&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(f>>8&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),
l.set(k.array),k.array=l);k.array[k.pos++]=(f&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(f>>>24)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=a;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=b+d;k=this.tmp;k.pos==k.array.length&&
(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=0;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=1;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(g>>16&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=
l);k.array[k.pos++]=(g>>8&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(g&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(g>>>24)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=a+c;k=this.tmp;k.pos==k.array.length&&
(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=b+d;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=1;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=1;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=
(h>>16&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(h>>8&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(h&255)/255;k=this.tmp;k.pos==k.array.length&&(l=k.array.length<<1,128>l&&(l=128),l=new Float32Array(l),l.set(k.array),k.array=l);k.array[k.pos++]=(h>>>24)/255;a<this.xMin&&(this.xMin=a);b<this.yMin&&
(this.yMin=b);a+=c;b+=d;a>this.xMax&&(this.xMax=a);b>this.yMax&&(this.yMax=b);a=this.state;a.tail.count+=4;a.totalCount+=4},fillArc:function(a,b,c,d,e,f){if(!(f<=e)){var g=Math.ceil(6.28*c/4);4>g&&(g=4);for(var h=(f-e)/g,k=-Infinity,l=-Infinity,m,p=0,t=0;p<g;){var n=e+p*h;m=a+Math.cos(n)*c;n=b+Math.sin(n)*c;-Infinity!=k&&(this.addPoint(a,b,d),this.addPoint(m,n,d),this.addPoint(k,l,d),this.addPoint(k,l,d),t+=4);k=m;l=n;++p}n=f;m=a+Math.cos(n)*c;n=b+Math.sin(n)*c;this.addPoint(a,b,d);this.addPoint(m,
n,d);this.addPoint(k,l,d);this.addPoint(k,l,d);a=this.state;t+=4;a.tail.count+=t;a.totalCount+=t}},fillCircle:function(a,b,c,d){var e=Math.ceil(6.28*c/2);3>e&&(e=3);for(var f=2*Math.PI/e,g=-Infinity,h=-Infinity,k=-Infinity,l=-Infinity,m=0,p=0,t=0,n=0;n<e;)p=n++*f,m=a+Math.cos(p)*c,p=b+Math.sin(p)*c,-Infinity!=g&&(this.addPoint(a,b,d),this.addPoint(m,p,d),this.addPoint(g,h,d),this.addPoint(a,b,d),t+=4),-Infinity==k&&(k=m,l=p),g=m,h=p;this.addPoint(a,b,d);this.addPoint(m,p,d);this.addPoint(k,l,d);this.addPoint(a,
b,d);a=this.state;t+=4;a.tail.count+=t;a.totalCount+=t},circle:function(a,b,c,d,e){if(!(d>c)){var f=Math.ceil(6.28*c/2);3>f&&(f=3);for(var g=c-d,h=2*Math.PI/f,k=-Infinity,l=-Infinity,m=-Infinity,p=-Infinity,t=d=0;t<f;){var n=t++*h,r=a+Math.cos(n)*c,y=b+Math.sin(n)*c,G=a+Math.cos(n)*g;n=b+Math.sin(n)*g;-Infinity!=k&&(this.addPoint(r,y,e),this.addPoint(k,l,e),this.addPoint(G,n,e),this.addPoint(m,p,e),d+=4);k=r;l=y;m=G;p=n}a=this.state;a.tail.count+=d;a.totalCount+=d}},arc:function(a,b,c,d,e,f,g){if(!(d>
c||f<=e)){var h=Math.ceil(6.28*c/4);3>h&&(h=3);for(var k=c-d,l=(f-e)/h,m=-Infinity,p=-Infinity,t=-Infinity,n=-Infinity,r,y,G,q=d=0;q<h;){r=q++;var u=e+r*l;r=a+Math.cos(u)*c;y=b+Math.sin(u)*c;G=a+Math.cos(u)*k;u=b+Math.sin(u)*k;-Infinity!=m&&(this.addPoint(r,y,g),this.addPoint(m,p,g),this.addPoint(G,u,g),this.addPoint(t,n,g),d+=4);m=r;p=y;t=G;n=u}u=f;r=a+Math.cos(u)*c;y=b+Math.sin(u)*c;G=a+Math.cos(u)*k;u=b+Math.sin(u)*k;this.addPoint(r,y,g);this.addPoint(m,p,g);this.addPoint(G,u,g);this.addPoint(t,
n,g);a=this.state;b=d+4;a.tail.count+=b;a.totalCount+=b}},alloc:function(a){null==this.tmp&&this.clear();0<this.tmp.pos&&(this.buffer=this.tmp.pos<this.useAllocatorLimit?Ob.get().ofFloats(this.tmp,N.get_XY_UV_RGBA()):$b.ofFloats(this.tmp,N.get_XY_UV_RGBA()))},dispose:function(){null!=this.buffer&&(8*this.buffer.vertices<this.useAllocatorLimit?Ob.get().disposeBuffer(this.buffer):this.buffer.dispose(),this.buffer=null);Wa.prototype.dispose.call(this)},flush:function(){null!=this.buffer&&null!=this.buffer.vbuf||
this.alloc(na.CURRENT)},doRender:function(a,b,c){null!=this.buffer&&null!=this.buffer.vbuf||this.alloc(na.CURRENT);this.state.drawQuads(a,this.buffer,b,c)},__class__:Wg});var Vg=function(a,b){Va.call(this,b);this.tile=a;this.rangeMin=this.rangeMax=-1;var c=b=a=1,d=1;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.curColor=new T(a,b,c,d);this.content=new Wg};z["h2d.TileGroup"]=Vg;Vg.__name__="h2d.TileGroup";Vg.__super__=Va;Vg.prototype=J(Va.prototype,{getBoundsRec:function(a,b,c){Va.prototype.getBoundsRec.call(this,
a,b,c);this.addBounds(a,b,this.content.xMin,this.content.yMin,this.content.xMax-this.content.xMin,this.content.yMax-this.content.yMin)},clear:function(){this.content.clear()},invalidate:function(){this.content.dispose()},count:function(){return this.content.triCount()>>1},onRemove:function(){this.content.dispose();Va.prototype.onRemove.call(this)},setDefaultColor:function(a,b){null==b&&(b=1);this.curColor.x=(a>>16&255)/255;this.curColor.y=(a>>8&255)/255;this.curColor.z=(a&255)/255;this.curColor.w=
b},add:function(a,b,c){this.content.add(a,b,this.curColor.x,this.curColor.y,this.curColor.z,this.curColor.w,c)},addColor:function(a,b,c,d,e,f,g){this.content.add(a,b,c,d,e,f,g)},addAlpha:function(a,b,c,d){this.content.add(a,b,this.curColor.x,this.curColor.y,this.curColor.z,c,d)},addTransform:function(a,b,c,d,e,f){this.content.addTransform(a,b,c,d,e,this.curColor,f)},draw:function(a){this.drawWith(a,this)},sync:function(a){Va.prototype.sync.call(this,a);this.visible&&(a=this.content,null!=a.buffer&&
null!=a.buffer.vbuf||a.alloc(na.CURRENT))},drawWith:function(a,b){var c=this.content.triCount();if(0!=c&&a.beginDrawBatchState(b)){b=0>this.rangeMin?0:2*this.rangeMin;0<this.rangeMax&&this.rangeMax<2*c&&(c=2*this.rangeMax);var d=this.content;null!=d.buffer&&null!=d.buffer.vbuf||d.alloc(na.CURRENT);d.state.drawQuads(a,d.buffer,b,c-b)}},__class__:Vg});var td=function(){};z["h2d.col.Collider"]=td;td.__name__="h2d.col.Collider";td.prototype={__class__:td};var pc=function(){this.yMin=this.xMin=1E20;this.yMax=
this.xMax=-1E20};z["h2d.col.Bounds"]=pc;pc.__name__="h2d.col.Bounds";pc.fromValues=function(a,b,c,d){var e=new pc;e.xMin=a;e.yMin=b;e.xMax=a+c;e.yMax=b+d;return e};pc.fromPoints=function(a,b){var c=new pc;c.xMin=a.x;c.yMin=a.y;c.xMax=b.x;c.yMax=b.y;return c};pc.__super__=td;pc.prototype=J(td.prototype,{toIBounds:function(a){null==a&&(a=1);var b=Math.floor(this.xMin*a),c=Math.floor(this.yMin*a),d=Math.ceil(this.xMax*a)-b;a=Math.ceil(this.yMax*a)-c;var e=new Zd;e.xMin=b;e.yMin=c;e.xMax=b+d;e.yMax=c+
a;return e},intersects:function(a){return!(this.xMin>a.xMax||this.yMin>a.yMax||this.xMax<a.xMin||this.yMax<a.yMin)},collideBounds:function(a){return!(this.xMin>a.xMax||this.yMin>a.yMax||this.xMax<a.xMin||this.yMax<a.yMin)},collideCircle:function(a){if(a.x<this.xMin-a.ray||a.x>this.xMax+a.ray||a.y<this.yMin-a.ray||a.y>this.yMax+a.ray)return!1;if(a.x<this.xMin&&a.y<this.yMin){var b=a.x-this.xMin;var c=a.y-this.yMin;c=b*b+c*c>a.ray*a.ray}else c=!1;if(c)return!1;a.x>this.xMax&&a.y<this.yMin?(b=a.x-this.xMax,
c=a.y-this.yMin,c=b*b+c*c>a.ray*a.ray):c=!1;if(c)return!1;a.x<this.xMin&&a.y>this.yMax?(b=a.x-this.xMin,c=a.y-this.yMax,c=b*b+c*c>a.ray*a.ray):c=!1;if(c)return!1;a.x>this.xMax&&a.y>this.yMax?(b=a.x-this.xMax,c=a.y-this.yMax,c=b*b+c*c>a.ray*a.ray):c=!1;return c?!1:!0},contains:function(a){return a.x>=this.xMin&&a.x<this.xMax&&a.y>=this.yMin?a.y<this.yMax:!1},rayIntersection:function(a){var b=(this.xMin-a.px)/a.lx,c=(this.yMin-a.py)/a.ly,d=(this.xMax-a.px)/a.lx,e=(this.yMax-a.py)/a.ly;a=b>d?d:b;var f=
c>e?e:c;b=b<d?d:b;c=c<e?e:c;a=a<f?f:a;return(b>c?c:b)<a?-1:a},distanceSq:function(a){var b=a.x<this.xMin?this.xMin-a.x:a.x>this.xMax?a.x-this.xMax:0;a=a.y<this.yMin?this.yMin-a.y:a.y>this.yMax?a.y-this.yMax:0;return b*b+a*a},distance:function(a){var b=a.x<this.xMin?this.xMin-a.x:a.x>this.xMax?a.x-this.xMax:0;a=a.y<this.yMin?this.yMin-a.y:a.y>this.yMax?a.y-this.yMax:0;return Math.sqrt(b*b+a*a)},addBounds:function(a){a.xMin<this.xMin&&(this.xMin=a.xMin);a.xMax>this.xMax&&(this.xMax=a.xMax);a.yMin<this.yMin&&
(this.yMin=a.yMin);a.yMax>this.yMax&&(this.yMax=a.yMax)},addPoint:function(a){a.x<this.xMin&&(this.xMin=a.x);a.x>this.xMax&&(this.xMax=a.x);a.y<this.yMin&&(this.yMin=a.y);a.y>this.yMax&&(this.yMax=a.y)},addPos:function(a,b){a<this.xMin&&(this.xMin=a);a>this.xMax&&(this.xMax=a);b<this.yMin&&(this.yMin=b);b>this.yMax&&(this.yMax=b)},set:function(a,b,c,d){this.xMin=a;this.yMin=b;this.xMax=a+c;this.yMax=b+d},setMin:function(a){this.xMin=a.x;this.yMin=a.y},setMax:function(a){this.xMax=a.x;this.yMax=a.y},
doIntersect:function(a){var b=this.xMin,c=a.xMin;this.xMin=b<c?c:b;b=this.yMin;c=a.yMin;this.yMin=b<c?c:b;b=this.xMax;c=a.xMax;this.xMax=b>c?c:b;b=this.yMax;c=a.yMax;this.yMax=b>c?c:b},doUnion:function(a){var b=this.xMin,c=a.xMin;this.xMin=b>c?c:b;b=this.yMin;c=a.yMin;this.yMin=b>c?c:b;b=this.xMax;c=a.xMax;this.xMax=b<c?c:b;b=this.yMax;c=a.yMax;this.yMax=b<c?c:b},intersection:function(a){var b=new pc,c=this.xMin,d=a.xMin;b.xMin=c<d?d:c;c=this.yMin;d=a.yMin;b.yMin=c<d?d:c;c=this.xMax;d=a.xMax;b.xMax=
c>d?d:c;c=this.yMax;d=a.yMax;b.yMax=c>d?d:c;b.xMax<b.xMin&&(b.xMax=b.xMin);b.yMax<b.yMin&&(b.yMax=b.yMin);return b},union:function(a){var b=new pc,c=this.xMin,d=a.xMin;b.xMin=c>d?d:c;c=this.yMin;d=a.yMin;b.yMin=c>d?d:c;c=this.xMax;d=a.xMax;b.xMax=c<d?d:c;c=this.yMax;d=a.yMax;b.yMax=c<d?d:c;return b},load:function(a){this.xMin=a.xMin;this.yMin=a.yMin;this.xMax=a.xMax;this.yMax=a.yMax},scalePivot:function(a){this.xMin*=a;this.yMin*=a;this.xMax*=a;this.yMax*=a},scaleCenter:function(a){var b=.5*(this.xMax-
this.xMin)*a;a*=.5*(this.yMax-this.yMin);var c=.5*(this.xMax+this.xMin),d=.5*(this.yMax+this.yMin);this.xMin=c-b;this.yMin=d-a;this.xMax=c+b;this.yMax=d+a},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.xMin,d=this.yMin,e=this.xMax,f=this.yMax;this.yMin=this.xMin=1E20;this.yMax=this.xMax=-1E20;var g=c*b-d*a,h=c*a+d*b;g<this.xMin&&(this.xMin=g);g>this.xMax&&(this.xMax=g);h<this.yMin&&(this.yMin=h);h>this.yMax&&(this.yMax=h);g=e*b-d*a;h=e*a+d*b;g<this.xMin&&(this.xMin=g);g>this.xMax&&
(this.xMax=g);h<this.yMin&&(this.yMin=h);h>this.yMax&&(this.yMax=h);g=c*b-f*a;h=c*a+f*b;g<this.xMin&&(this.xMin=g);g>this.xMax&&(this.xMax=g);h<this.yMin&&(this.yMin=h);h>this.yMax&&(this.yMax=h);g=e*b-f*a;h=e*a+f*b;g<this.xMin&&(this.xMin=g);g>this.xMax&&(this.xMax=g);h<this.yMin&&(this.yMin=h);h>this.yMax&&(this.yMax=h)},offset:function(a,b){this.xMin+=a;this.xMax+=a;this.yMin+=b;this.yMax+=b},getMin:function(){var a=this.xMin,b=this.yMin;null==b&&(b=0);null==a&&(a=0);return new ta(a,b)},getCenter:function(){var a=
.5*(this.xMin+this.xMax),b=.5*(this.yMin+this.yMax);null==b&&(b=0);null==a&&(a=0);return new ta(a,b)},getSize:function(){var a=this.xMax-this.xMin,b=this.yMax-this.yMin;null==b&&(b=0);null==a&&(a=0);return new ta(a,b)},getMax:function(){var a=this.xMax,b=this.yMax;null==b&&(b=0);null==a&&(a=0);return new ta(a,b)},isEmpty:function(){return this.xMax<=this.xMin?!0:this.yMax<=this.yMin},empty:function(){this.yMin=this.xMin=1E20;this.yMax=this.xMax=-1E20},all:function(){this.yMin=this.xMin=-1E20;this.yMax=
this.xMax=1E20},clone:function(){var a=new pc;a.xMin=this.xMin;a.yMin=this.yMin;a.xMax=this.xMax;a.yMax=this.yMax;return a},get_x:function(){return this.xMin},get_y:function(){return this.yMin},set_x:function(a){this.xMax+=a-this.xMin;return this.xMin=a},set_y:function(a){this.yMax+=a-this.yMin;return this.yMin=a},get_width:function(){return this.xMax-this.xMin},get_height:function(){return this.yMax-this.yMin},set_width:function(a){this.xMax=this.xMin+a;return a},set_height:function(a){this.yMax=
this.yMin+a;return a},toString:function(){var a=this.xMin,b=this.yMin;null==b&&(b=0);null==a&&(a=0);var c="{"+w.string(new ta(a,b))+",";a=this.xMax-this.xMin;b=this.yMax-this.yMin;null==b&&(b=0);null==a&&(a=0);return c+w.string(new ta(a,b))+"}"},toCircle:function(){var a=this.xMax-this.xMin,b=this.yMax-this.yMin;return new Xg(.5*(this.xMin+this.xMax),.5*(this.yMin+this.yMax),.5*Math.sqrt(a*a+b*b))},__class__:pc});var Xg=function(a,b,c){this.x=a;this.y=b;this.ray=c};z["h2d.col.Circle"]=Xg;Xg.__name__=
"h2d.col.Circle";Xg.__super__=td;Xg.prototype=J(td.prototype,{distanceSq:function(a){var b=a.x-this.x;a=a.y-this.y;b=b*b+a*a-this.ray*this.ray;return 0>b?0:b},side:function(a){var b=a.x-this.x;a=a.y-this.y;return this.ray*this.ray-(b*b+a*a)},collideCircle:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c<(this.ray+a.ray)*(this.ray+a.ray)},collideBounds:function(a){if(this.x<a.xMin-this.ray||this.x>a.xMax+this.ray||this.y<a.yMin-this.ray||this.y>a.yMax+this.ray)return!1;if(this.x<a.xMin&&this.y<
a.yMin){var b=this.x-a.xMin;var c=this.y-a.yMin;c=b*b+c*c>this.ray*this.ray}else c=!1;if(c)return!1;this.x>a.xMax&&this.y<a.yMin?(b=this.x-a.xMax,c=this.y-a.yMin,c=b*b+c*c>this.ray*this.ray):c=!1;if(c)return!1;this.x<a.xMin&&this.y>a.yMax?(b=this.x-a.xMin,c=this.y-a.yMax,c=b*b+c*c>this.ray*this.ray):c=!1;if(c)return!1;this.x>a.xMax&&this.y>a.yMax?(b=this.x-a.xMax,c=this.y-a.yMax,c=b*b+c*c>this.ray*this.ray):c=!1;return c?!1:!0},lineIntersect:function(a,b){var c=b.x-a.x;b=b.y-a.y;var d=c*c+b*b;if(1E-8>
d)return null;var e=2*(c*(a.x-this.x)+b*(a.y-this.y));var f=a.x-this.x;var g=a.y-this.y;g=e*e-4*d*(f*f+g*g-this.ray*this.ray);if(0>g)return null;if(0==g)return e=-e/(2*d),d=a.x+e*c,f=a.y+e*b,null==f&&(f=0),null==d&&(d=0),[new ta(d,f)];f=(-e-Math.sqrt(g))/(2*d);e=(-e+Math.sqrt(g))/(2*d);d=a.x+f*c;f=a.y+f*b;null==f&&(f=0);null==d&&(d=0);g=new ta(d,f);d=a.x+e*c;f=a.y+e*b;null==f&&(f=0);null==d&&(d=0);return[g,new ta(d,f)]},toString:function(){return"{"+X.fmt(this.x)+","+X.fmt(this.y)+","+X.fmt(this.ray)+
"}"},contains:function(a){var b=a.x-this.x;a=a.y-this.y;b=b*b+a*a-this.ray*this.ray;return 0==(0>b?0:b)},__class__:Xg});var Zd=function(){this.yMin=this.xMin=2147483647;this.yMax=this.xMax=-2147483648};z["h2d.col.IBounds"]=Zd;Zd.__name__="h2d.col.IBounds";Zd.fromValues=function(a,b,c,d){var e=new Zd;e.xMin=a;e.yMin=b;e.xMax=a+c;e.yMax=b+d;return e};Zd.fromPoints=function(a,b){var c=new Zd;c.xMin=a.x;c.yMin=a.y;c.xMax=b.x;c.yMax=b.y;return c};Zd.prototype={toBounds:function(a){null==a&&(a=1);var b=
this.xMin*a,c=this.yMin*a,d=(this.xMax-this.xMin)*a;a*=this.yMax-this.yMin;var e=new pc;e.xMin=b;e.yMin=c;e.xMax=b+d;e.yMax=c+a;return e},intersects:function(a){return!(this.xMin>a.xMax||this.yMin>a.yMax||this.xMax<a.xMin||this.yMax<a.yMin)},contains:function(a){return a.x>=this.xMin&&a.x<this.xMax&&a.y>=this.yMin?a.y<this.yMax:!1},addBounds:function(a){a.xMin<this.xMin&&(this.xMin=a.xMin);a.xMax>this.xMax&&(this.xMax=a.xMax);a.yMin<this.yMin&&(this.yMin=a.yMin);a.yMax>this.yMax&&(this.yMax=a.yMax)},
addPoint:function(a){a.x<this.xMin&&(this.xMin=a.x);a.x>this.xMax&&(this.xMax=a.x);a.y<this.yMin&&(this.yMin=a.y);a.y>this.yMax&&(this.yMax=a.y)},addPos:function(a,b){a<this.xMin&&(this.xMin=a);a>this.xMax&&(this.xMax=a);b<this.yMin&&(this.yMin=b);b>this.yMax&&(this.yMax=b)},set:function(a,b,c,d){this.xMin=a;this.yMin=b;this.xMax=a+c;this.yMax=b+d},setMin:function(a){this.xMin=a.x;this.yMin=a.y},setMax:function(a){this.xMax=a.x;this.yMax=a.y},doIntersect:function(a){var b=this.xMin,c=a.xMin;this.xMin=
b<c?c:b;b=this.yMin;c=a.yMin;this.yMin=b<c?c:b;b=this.xMax;c=a.xMax;this.xMax=b>c?c:b;b=this.yMax;c=a.yMax;this.yMax=b>c?c:b},doUnion:function(a){var b=this.xMin,c=a.xMin;this.xMin=b>c?c:b;b=this.yMin;c=a.yMin;this.yMin=b>c?c:b;b=this.xMax;c=a.xMax;this.xMax=b<c?c:b;b=this.yMax;c=a.yMax;this.yMax=b<c?c:b},intersection:function(a){var b=new Zd,c=this.xMin,d=a.xMin;b.xMin=c<d?d:c;c=this.yMin;d=a.yMin;b.yMin=c<d?d:c;c=this.xMax;d=a.xMax;b.xMax=c>d?d:c;c=this.yMax;d=a.yMax;b.yMax=c>d?d:c;b.xMax<b.xMin&&
(b.xMax=b.xMin);b.yMax<b.yMin&&(b.yMax=b.yMin);return b},union:function(a){var b=new Zd,c=this.xMin,d=a.xMin;b.xMin=c>d?d:c;c=this.yMin;d=a.yMin;b.yMin=c>d?d:c;c=this.xMax;d=a.xMax;b.xMax=c<d?d:c;c=this.yMax;d=a.yMax;b.yMax=c<d?d:c;return b},load:function(a){this.xMin=a.xMin;this.yMin=a.yMin;this.xMax=a.xMax;this.yMax=a.yMax},offset:function(a,b){this.xMin+=a;this.xMax+=a;this.yMin+=b;this.yMax+=b},getMin:function(){return new V(this.xMin,this.yMin)},getCenter:function(){return new V(this.xMin+this.xMax>>
1,this.yMin+this.yMax>>1)},getSize:function(){return new V(this.xMax-this.xMin,this.yMax-this.yMin)},getMax:function(){return new V(this.xMax,this.yMax)},isEmpty:function(){return this.xMax>this.xMin?this.yMax<=this.yMin:!0},empty:function(){this.yMin=this.xMin=2147483647;this.yMax=this.xMax=-2147483648},all:function(){this.yMin=this.xMin=-2147483648;this.yMax=this.xMax=2147483647},clone:function(){var a=new Zd;a.xMin=this.xMin;a.yMin=this.yMin;a.xMax=this.xMax;a.yMax=this.yMax;return a},get_x:function(){return this.xMin},
get_y:function(){return this.yMin},set_x:function(a){this.xMax+=a-this.xMin;return this.xMin=a},set_y:function(a){this.yMax+=a-this.yMin;return this.yMin=a},get_width:function(){return this.xMax-this.xMin},get_height:function(){return this.yMax-this.yMin},set_width:function(a){this.xMax=this.xMin+a;return a},set_height:function(a){this.yMax=this.yMin+a;return a},toString:function(){return"{"+w.string(new V(this.xMin,this.yMin))+","+w.string(new V(this.xMax-this.xMin,this.yMax-this.yMin))+"}"},__class__:Zd};
var V=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b};z["h2d.col.IPoint"]=V;V.__name__="h2d.col.IPoint";V.prototype={load:function(a){this.x=a.x;this.y=a.y},scale:function(a){this.x*=a;this.y*=a},scaled:function(a){return new V(this.x*a,this.y*a)},distanceSq:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},distance:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},toString:function(){return"{"+this.x+","+this.y+"}"},sub:function(a){return new V(this.x-a.x,
this.y-a.y)},add:function(a){return new V(this.x+a.x,this.y+a.y)},equals:function(a){return this.x==a.x?this.y==a.y:!1},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},set:function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b},clone:function(){return new V(this.x,this.y)},cross:function(a){return this.x*a.y-this.y*a.x},toPoint:function(a){null==a&&(a=1);var b=this.x*a;a*=
this.y;null==a&&(a=0);null==b&&(b=0);return new ta(b,a)},__class__:V};var eg=L["h2d.col.OffsetKind"]={__ename__:!0,__constructs__:null,Square:{_hx_name:"Square",_hx_index:0,__enum__:"h2d.col.OffsetKind",toString:v},Miter:{_hx_name:"Miter",_hx_index:1,__enum__:"h2d.col.OffsetKind",toString:v},Round:(A=function(a){return{_hx_index:2,arc:a,__enum__:"h2d.col.OffsetKind",toString:v}},A._hx_name="Round",A.__params__=["arc"],A)};eg.__constructs__=[eg.Square,eg.Miter,eg.Round];eg.__empty_constructs__=[eg.Square,
eg.Miter];var Ge={get_length:function(a){return a.length},get_points:function(a){return a},_new:function(a){return null==a?[]:a},iterator:function(a){return new hi(a)},toPolygon:function(a,b){null==b&&(b=1);for(var c=[],d=0;d<a.length;){var e=a[d];++d;var f=b;null==f&&(f=1);var g=e.x*f;e=e.y*f;null==e&&(e=0);null==g&&(g=0);c.push(new ta(g,e))}return c},getBounds:function(a,b){null==b&&(b=new Zd);for(var c=0;c<a.length;){var d=a[c];++c;d.x<b.xMin&&(b.xMin=d.x);d.x>b.xMax&&(b.xMax=d.x);d.y<b.yMin&&
(b.yMin=d.y);d.y>b.yMax&&(b.yMax=d.y)}return b},union:function(a,b,c){null==c&&(c=!0);var d=new rb;c||(d.resultKind=Tb.NoHoles);d.addPolygon(a,kb.Clip);d.addPolygon(b,kb.Clip);return d.execute(bc.Union,Ha.NonZero,Ha.NonZero)},intersection:function(a,b,c){null==c&&(c=!0);return Ge.clipperOp(a,b,bc.Intersection,c)},subtraction:function(a,b,c){null==c&&(c=!0);return Ge.clipperOp(a,b,bc.Difference,c)},offset:function(a,b,c,d){null==d&&(d=!0);var e=new ii;switch(c._hx_index){case 0:e.addPolygon(a,Gc.Square,
ab.ClosedPol);break;case 1:e.addPolygon(a,Gc.Miter,ab.ClosedPol);break;case 2:e.ArcTolerance=c.arc,e.addPolygon(a,Gc.Round,ab.ClosedPol)}d||(e.resultKind=Tb.NoHoles);return e.execute(b)},clipperOp:function(a,b,c,d){var e=new rb;d||(e.resultKind=Tb.NoHoles);e.addPolygon(a,kb.Subject);e.addPolygon(b,kb.Clip);return e.execute(c,Ha.NonZero,Ha.NonZero)},convexHull:function(a){var b,c=a.length;if(3>c)throw u.thrown("convexHull() needs at least 3 points");var d=0,e=a[d].x;var f=1;for(b=a.length;f<b;){var g=
f++;var h=a[g].x;h<e&&(d=g,e=h)}e=[];h=d;do{e.push(a[h]);var k=(h+1)%c;f=0;for(b=c;f<b;){g=f++;var l=a[g],m=a[h],p=a[k];0>(m.x-l.x)*(p.y-l.y)-(m.y-l.y)*(p.x-l.x)&&(k=g)}h=k}while(h!=d);return e},isClockwise:function(a){for(var b=0,c=a[a.length-1],d=0;d<a.length;){var e=a[d];++d;b+=(e.x-c.x)*(e.y+c.y);c=e}return 0>b},area:function(a){for(var b=0,c=a[a.length-1],d=0;d<a.length;){var e=a[d];++d;b+=c.x*e.y-e.x*c.y;c=e}return.5*(0>b?-b:b)},side:function(a,b,c,d){return(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-
b.x)},isConvex:function(a){for(var b=a[a.length-2],c=a[a.length-1],d=a[0],e=0<(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x),f=1,g=a.length;f<g;){var h=f++;b=c;c=d;d=a[h];if(0<(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x)!=e)return!1}return!0},reverse:function(a){a.reverse()},contains:function(a,b,c){var d;null==c&&(c=!1);if(c){var e=a[a.length-1];c=0;for(d=a;c<d.length;){a=d[c];++c;if(0>(a.x-e.x)*(b.y-e.y)-(a.y-e.y)*(b.x-e.x))return!1;e=a}return!0}var f=0;e=a[a.length-1];c=0;for(d=a;c<d.length;)a=d[c],++c,a.y<=
b.y?e.y>b.y&&0<(e.x-a.x)*(b.y-a.y)-(e.y-a.y)*(b.x-a.x)&&++f:e.y<=b.y&&0>(e.x-a.x)*(b.y-a.y)-(e.y-a.y)*(b.x-a.x)&&--f,e=a;return 0!=f},optimize:function(a,b){var c=[];Ge.optimizeRec(a,0,a.length,c,b);return c},optimizeRec:function(a,b,c,d,e){for(var f=0,g=a[b],h=a[c-1],k=b+1,l=c-1;k<l;){var m=k++,p=a[m],t=h.x-g.x,n=h.y-g.y,r=(p.x-g.x)*t+(p.y-g.y)*n,y=t*t+n*n,G=-1;0!=y&&(G=r/y);0>G?(t=g.x,n=g.y):1<G?(t=h.x,n=h.y):(t=g.x+G*t,n=g.y+G*n);G=p.x-t;p=p.y-n;p=G*G+p*p;p>f&&(b=m,f=p)}f>=e?(Ge.optimizeRec(a,
0,b,d,e),d.pop(),Ge.optimizeRec(a,b,c,d,e)):(d.push(a[b]),d.push(a[c-1]))}},yc=function(){this.a=1;this.c=this.b=0;this.d=1;this.y=this.x=0};z["h2d.col.Matrix"]=yc;yc.__name__="h2d.col.Matrix";yc.prototype={identity:function(){this.a=1;this.c=this.b=0;this.d=1;this.y=this.x=0},initTranslate:function(a,b){this.a=1;this.c=this.b=0;this.d=1;this.x=a;this.y=b},initScale:function(a,b){this.a=a;this.c=this.b=0;this.d=b;this.y=this.x=0},initRotate:function(a){var b=Math.cos(a);a=Math.sin(a);this.a=b;this.b=
a;this.c=-a;this.d=b;this.y=this.x=0},initSkew:function(a,b){a=Math.tan(a);b=Math.tan(b);this.a=1;this.b=b;this.c=a;this.d=1;this.y=this.x=0},invert:function(){this.inverse(this)},getDeterminant:function(){return this.a*this.d-this.b*this.c},inverse:function(a){var b=a.a,c=a.b,d=a.c,e=a.d,f=a.x,g=a.y;a=1/(a.a*a.d-a.b*a.c);this.a=e*a;this.b=-c*a;this.c=-d*a;this.d=b*a;this.x=(-f*e+d*g)*a;this.y=(f*c-b*g)*a},transform:function(a){var b=a.x*this.a+a.y*this.c+this.x;a=a.x*this.b+a.y*this.d+this.y;null==
a&&(a=0);null==b&&(b=0);return new ta(b,a)},translate:function(a,b){this.x+=a;this.y+=b},translateX:function(a){this.x+=a},translateY:function(a){this.y+=a},prependTranslate:function(a,b){this.x+=this.a*a+this.c*b;this.y+=this.b*a+this.d*b},prependTranslateX:function(a){this.x+=this.a*a},prependTranslateY:function(a){this.y+=this.d*a},multiply:function(a,b){var c=a.a,d=a.b,e=a.c,f=a.d,g=a.x;a=a.y;var h=b.a,k=b.b,l=b.c,m=b.d,p=b.x;b=b.y;this.a=c*h+d*l;this.b=c*k+d*m;this.c=e*h+f*l;this.d=e*k+f*m;this.x=
g*h+a*l+p;this.y=g*k+a*m+b},getScale:function(){var a=new ta(0,0);a.x=Math.sqrt(this.a*this.a+this.b*this.b);a.y=Math.sqrt(this.c*this.c+this.d*this.d);0>this.a*this.d-this.b*this.c&&(a.x*=-1,a.y*=-1);return a},scale:function(a,b){this.a*=a;this.c*=a;this.x*=a;this.b*=b;this.d*=b;this.y*=b},scaleX:function(a){this.a*=a;this.c*=a;this.x*=a},scaleY:function(a){this.b*=a;this.d*=a;this.y*=a},rotate:function(a){var b=yc.tmp,c=Math.cos(a);a=Math.sin(a);b.a=c;b.b=a;b.c=-a;b.d=c;b.x=0;b.y=0;this.multiply(this,
yc.tmp)},skew:function(a,b){var c=this.a,d=this.b,e=this.c,f=this.d,g=this.x,h=this.y;b=Math.tan(b);a=Math.tan(a);this.a=c+d*a;this.b=c*b+d;this.c=e+f*a;this.d=e*b+f;this.x=g+h*a;this.y=g*b+h},skewX:function(a){a=Math.tan(a);this.a+=this.b*a;this.c+=this.d*a;this.x+=this.y*a},skewY:function(a){a=Math.tan(a);this.b=this.a*a+this.b;this.d=this.c*a+this.d;this.y=this.x*a+this.y},clone:function(){var a=new yc;a.a=this.a;a.b=this.b;a.c=this.c;a.d=this.d;a.x=this.x;a.y=this.y;return a},getPosition:function(a){null==
a&&(a=new ta(0,0));var b=a,c=this.x,d=this.y;null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;return a},toString:function(){return"MAT=[\n  [ "+X.fmt(this.a)+", "+X.fmt(this.b)+" ]\n  [ "+X.fmt(this.c)+", "+X.fmt(this.d)+" ]\n  [ "+X.fmt(this.x)+", "+X.fmt(this.y)+" ]\n]"},__class__:yc};var Ld={get_length:function(a){return a.length},get_points:function(a){return a},_new:function(a){return null==a?[]:a},iterator:function(a){return new ji(a)},fastTriangulate:function(a){return(new Ug).triangulate_anon_y_Float_x_Float(a)},
toSegments:function(a){for(var b=[],c=a[a.length-1],d=0;d<a.length;){var e=a[d];++d;c=new ki(c,e);b.push(c);c=e}return b},toIPolygon:function(a,b){null==b&&(b=1);for(var c=[],d=0;d<a.length;){var e=a[d];++d;var f=b;null==f&&(f=1);c.push(new V(Math.round(e.x*f),Math.round(e.y*f)))}return c},getBounds:function(a,b){null==b&&(b=new pc);for(var c=0;c<a.length;){var d=a[c];++c;d.x<b.xMin&&(b.xMin=d.x);d.x>b.xMax&&(b.xMax=d.x);d.y<b.yMin&&(b.yMin=d.y);d.y>b.yMax&&(b.yMax=d.y)}return b},getCollider:function(a,
b){null==b&&(b=!1);return new fg([a],b)},xSort:function(a,b,c){return b.x==c.x?b.y<c.y?-1:1:b.x<c.x?-1:1},convexHull:function(a){var b=a.length;if(3>a.length)return a;a.sort(function(a,b){return a.x==b.x?a.y<b.y?-1:1:a.x<b.x?-1:1});var c=[],d=0;for(b=0;b<a.length;){var e=a[b];for(++b;;){if(2<=d){var f=c[d-2];var g=c[d-1];g=0>=(g.x-f.x)*(e.y-f.y)-(g.y-f.y)*(e.x-f.x)}else g=!1;if(!g)break;--d}c[d++]=e}var h=a.length-2;for(b=d+1;0<=h;){for(e=a[h];;){d>=b?(f=c[d-2],g=c[d-1],g=0>=(g.x-f.x)*(e.y-f.y)-(g.y-
f.y)*(e.x-f.x)):g=!1;if(!g)break;--d}c[d++]=e;--h}for(;c.length>=d;)c.pop();return c},isClockwise:function(a){for(var b=0,c=a[a.length-1],d=0;d<a.length;){var e=a[d];++d;b+=(e.x-c.x)*(e.y+c.y);c=e}return 0>b},area:function(a){for(var b=0,c=a[a.length-1],d=0;d<a.length;){var e=a[d];++d;b+=e.x*c.y-c.x*e.y;c=e}return.5*(0>b?-b:b)},centroid:function(a){for(var b=0,c=0,d=0,e=a[a.length-1],f=0;f<a.length;){var g=a[f];++f;var h=e.x*g.y-g.x*e.y;c+=(e.x+g.x)*h;d+=(e.y+g.y)*h;b+=h;e=g}b*=.5;a=1/(6*b)*c;b=1/
(6*b)*d;null==b&&(b=0);null==a&&(a=0);return new ta(a,b)},side:function(a,b,c,d){return(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x)},isConvex:function(a){if(4>a.length)return!0;for(var b=a[a.length-2],c=a[a.length-1],d=a[0],e=0<(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x),f=1,g=a.length;f<g;){var h=f++;b=c;c=d;d=a[h];if(0<(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x)!=e)return!1}return!0},reverse:function(a){a.reverse()},transform:function(a,b){for(var c=0,d=a.length;c<d;){var e=c++;e=a[e];var f=b.b*e.x+b.d*e.y+
b.y;e.x=b.a*e.x+b.c*e.y+b.x;e.y=f}},transformed:function(a,b){for(var c=a.slice(),d=0,e=c.length;d<e;){var f=d++;a=c[f];var g=b.a*a.x+b.c*a.y+b.x;a=b.b*a.x+b.d*a.y+b.y;null==a&&(a=0);null==g&&(g=0);c[f]=new ta(g,a)}return null==c?[]:c},contains:function(a,b,c){var d;null==c&&(c=!1);if(c){var e=a[a.length-1];c=0;for(d=a;c<d.length;){a=d[c];++c;if(0>(a.x-e.x)*(b.y-e.y)-(a.y-e.y)*(b.x-e.x))return!1;e=a}return!0}var f=0;e=a[a.length-1];c=0;for(d=a;c<d.length;)a=d[c],++c,a.y<=b.y?e.y>b.y&&0<(e.x-a.x)*
(b.y-a.y)-(e.y-a.y)*(b.x-a.x)&&++f:e.y<=b.y&&0>(e.x-a.x)*(b.y-a.y)-(e.y-a.y)*(b.x-a.x)&&--f,e=a;return 0!=f},findClosestPoint:function(a,b,c){var d=null;c*=c;for(var e=0;e<a.length;){var f=a[e];++e;var g=f,h=g.x-b.x;g=g.y-b.y;h=h*h+g*g;h<c&&(d=f,c=h)}return d},projectPoint:function(a,b,c){var d;var e=a[a.length-1];var f=d=0;null==f&&(f=0);null==d&&(d=0);var g=d,h=f;null==c&&(c=new ta(0,0));for(var k=1E10,l=0;l<a.length;){var m=a[l];++l;f=e;e=m;d=f.x;f=f.y;var p=e.x-d;e=e.y-f;var t=p*p+e*e,n=1/t,r=
c,y=(b.x-d)*p+(b.y-f)*e;null==r&&(r=new ta(0,0));0>y?(e=r,null==f&&(f=0),null==d&&(d=0),e.x=d,e.y=f):(y>t?(d+=p,f+=e):(t=y*n,d+=t*p,f+=t*e),null==f&&(f=0),null==d&&(d=0),r.x=d,r.y=f);d=c;f=d.x-b.x;d=d.y-b.y;f=f*f+d*d;f<k&&(g=c.x,h=c.y,k=f);e=m}e=c;e.x=g;e.y=h;return c},distance:function(a,b,c){return Math.sqrt(Ld.distanceSq(a,b,c))},distanceSq:function(a,b,c){for(var d=a[a.length-1],e=1E10,f=0;f<a.length;){var g=a[f];++f;var h=g,k=d.x;d=d.y;var l=h.x-k;h=h.y-d;var m=l*l+h*h,p=1/m;if(null==c||0>l*
(b.y-d)-h*(b.x-k)==c){var t=b.x-k,n=b.y-d,r=t*l+n*h;0>r?d=t*t+n*n:(r>m?(k=b.x-(k+l),d=b.y-(d+h)):(m=r*p,k=k+m*l-b.x,d=d+m*h-b.y),d=k*k+d*d);d<e&&(e=d)}d=g}return 1E10==e?0:e},rayIntersection:function(a,b,c,d){null==d&&(d=!1);for(var e=-1,f=a[a.length-1],g=0;g<a.length;){var h=a[g];++g;if(!(0<(b.lx*(f.y-b.py)-b.ly*(f.x-b.px))*(b.lx*(h.y-b.py)-b.ly*(h.x-b.px)))){var k=(b.lx*(f.y-b.py)-b.ly*(f.x-b.px))/(b.ly*(h.x-f.x)-b.lx*(h.y-f.y)),l=f.x+k*(h.x-f.x)-b.px;f=f.y+k*(h.y-f.y)-b.py;null==f&&(f=0);null==
l&&(l=0);null==f&&(f=0);null==l&&(l=0);if(d){var m=b.lx;k=b.ly;null==k&&(k=0);null==m&&(m=0);null==k&&(k=0);null==m&&(m=0);k=0<m*l+k*f}else k=!0;if(k&&(l=l*l+f*f,l<e||0>e)){if(!c)return Math.sqrt(l);e=l}}f=h}return 0>e?e:Math.sqrt(e)},orientation:function(a,b,c,d){a=(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x);return 0==a?0:0<a?1:-1},onSegment:function(a,b,c,d){a=b.x;var e=c.x;if(d.x>(a<e?e:a))return!1;a=b.x;e=c.x;if(d.x<(a>e?e:a))return!1;a=b.y;e=c.y;if(d.y>(a<e?e:a))return!1;a=b.y;e=c.y;return d.y<(a>
e?e:a)?!1:!0},intersect:function(a,b,c,d,e){var f=(c.x-b.x)*(d.y-b.y)-(c.y-b.y)*(d.x-b.x);var g=0==f?0:0<f?1:-1;f=(c.x-b.x)*(e.y-b.y)-(c.y-b.y)*(e.x-b.x);var h=0==f?0:0<f?1:-1;f=(e.x-d.x)*(b.y-d.y)-(e.y-d.y)*(b.x-d.x);a=0==f?0:0<f?1:-1;f=(e.x-d.x)*(c.y-d.y)-(e.y-d.y)*(c.x-d.x);f=0==f?0:0<f?1:-1;if(g!=h&&a!=f)return!0;if(0==g){var k=b.x;g=c.x;d.x>(k<g?g:k)?g=!1:(k=b.x,g=c.x,d.x<(k>g?g:k)?g=!1:(k=b.y,g=c.y,d.y>(k<g?g:k)?g=!1:(k=b.y,g=c.y,g=d.y<(k>g?g:k)?!1:!0)))}else g=!1;g?h=!0:0==h?(k=b.x,g=c.x,e.x>
(k<g?g:k)?h=!1:(k=b.x,g=c.x,e.x<(k>g?g:k)?h=!1:(k=b.y,g=c.y,e.y>(k<g?g:k)?h=!1:(k=b.y,g=c.y,h=e.y<(k>g?g:k)?!1:!0)))):h=!1;h?b=!0:0==a?(k=d.x,g=e.x,b.x>(k<g?g:k)?b=!1:(k=d.x,g=e.x,b.x<(k>g?g:k)?b=!1:(k=d.y,g=e.y,b.y>(k<g?g:k)?b=!1:(k=d.y,g=e.y,b=b.y<(k>g?g:k)?!1:!0)))):b=!1;b?c=!0:0==f?(k=d.x,g=e.x,c.x>(k<g?g:k)?c=!1:(k=d.x,g=e.x,c.x<(k>g?g:k)?c=!1:(k=d.y,g=e.y,c.y>(k<g?g:k)?c=!1:(k=d.y,g=e.y,c=c.y<(k>g?g:k)?!1:!0)))):c=!1;return c?!0:!1},getIntersectionPoint:function(a,b,c,d,e){if(!Ld.intersect(a,
b,c,d,e))return null;a=c.y-b.y;c=b.x-c.x;b=a*b.x+c*b.y;var f=e.y-d.y;e=d.x-e.x;d=f*d.x+e*d.y;var g=a*e-f*c;if(0==g)return null;c=(e*b-c*d)/g;a=(a*d-f*b)/g;null==a&&(a=0);null==c&&(c=0);return new ta(c,a)},selfIntersecting:function(a){if(4>a.length)return!1;for(var b=0,c=a.length-2;b<c;){var d=b++,e=a[d],f=a[d+1];d+=2;for(var g=a.length;d<g;){var h=d++,k=a[h];h=a[(h+1)%a.length];if(h!=e&&Ld.intersect(a,e,f,k,h))return!0}}return!1},optimize:function(a,b){var c=[];Ld.optimizeRec(a,0,a.length-1,c,b);
return c},optimizeRec:function(a,b,c,d,e){for(var f=0,g=a[b],h=a[c],k=0,l=b+1;l<c;){var m=l++,p=a[m],t=h.x-g.x,n=h.y-g.y,r=(p.x-g.x)*t+(p.y-g.y)*n,y=t*t+n*n,G=-1;0!=y&&(G=r/y);0>G?(t=g.x,n=g.y):1<G?(t=h.x,n=h.y):(t=g.x+G*t,n=g.y+G*n);G=p.x-t;p=p.y-n;p=G*G+p*p;p>f&&(k=m,f=p)}f>=e*e?(Ld.optimizeRec(a,b,k,d,e),d.pop(),Ld.optimizeRec(a,k,c,d,e)):(d.push(a[b]),d.push(a[c]))},makeCircle:function(a,b,c,d){null==d&&(d=0);if(0==d){var e=6.28*c/4;d=Math.ceil(0>e?-e:e)}3>d&&(d=3);e=6.283185307179586/d;for(var f=
[],g=0;g<d;){var h=g++*e,k=Math.cos(h)*c+a;h=Math.sin(h)*c+b;null==h&&(h=0);null==k&&(k=0);f.push(new ta(k,h))}return null==f?[]:f}},fg=function(a,b){null==b&&(b=!1);this.polygons=a;this.isConvex=b};z["h2d.col.PolygonCollider"]=fg;fg.__name__="h2d.col.PolygonCollider";fg.__super__=td;fg.prototype=J(td.prototype,{contains:function(a){return null==this.polygons?!1:Wj.contains(this.polygons,a,this.isConvex)},collideCircle:function(a){throw u.thrown("Not implemented");},collideBounds:function(a){throw u.thrown("Not implemented");
},__class__:fg});var Wj={get_length:function(a){return a.length},get_polygons:function(a){return a},_new:function(a){return null==a?[]:a},iterator:function(a){return new li(a)},toIPolygons:function(a,b){null==b&&(b=1);for(var c=[],d=0;d<a.length;){var e=a[d];++d;c.push(Ld.toIPolygon(e,b))}return c},getBounds:function(a,b){null==b&&(b=new pc);for(var c=0;c<a.length;){var d=a[c];++c;Ld.getBounds(d,b)}return b},getCollider:function(a,b){null==b&&(b=!1);return new fg(a,b)},contains:function(a,b,c){null==
c&&(c=!1);for(var d=0;d<a.length;){var e=a[d];++d;if(Ld.contains(e,b,c))return!0}return!1},optimize:function(a,b){for(var c=[],d=0;d<a.length;){var e=a[d];++d;c.push(Ld.optimize(e,b))}return c}},qf=function(){};z["h2d.col.Ray"]=qf;qf.__name__="h2d.col.Ray";qf.fromPoints=function(a,b){var c=new qf;c.px=a.x;c.py=a.y;c.lx=b.x-a.x;c.ly=b.y-a.y;c.normalize();return c};qf.fromValues=function(a,b,c,d){var e=new qf;e.px=a;e.py=b;e.lx=c;e.ly=d;e.normalize();return e};qf.prototype={side:function(a){return this.lx*
(a.y-this.py)-this.ly*(a.x-this.px)},getPoint:function(a){var b=this.px+a*this.lx;a=this.py+a*this.ly;null==a&&(a=0);null==b&&(b=0);return new ta(b,a)},getPos:function(){var a=this.px,b=this.py;null==b&&(b=0);null==a&&(a=0);return new ta(a,b)},getDir:function(){var a=this.lx,b=this.ly;null==b&&(b=0);null==a&&(a=0);return new ta(a,b)},normalize:function(){var a=this.lx*this.lx+this.ly*this.ly;1!=a&&(a=1E-20>a?0:1/Math.sqrt(a),this.lx*=a,this.ly*=a)},__class__:qf};var ki=function(a,b){this.x=a.x;this.y=
a.y;this.dx=b.x-this.x;this.dy=b.y-this.y;this.lenSq=this.dx*this.dx+this.dy*this.dy;this.invLenSq=1/this.lenSq};z["h2d.col.Segment"]=ki;ki.__name__="h2d.col.Segment";ki.prototype={setPoints:function(a,b){this.x=a.x;this.y=a.y;this.dx=b.x-this.x;this.dy=b.y-this.y;this.lenSq=this.dx*this.dx+this.dy*this.dy;this.invLenSq=1/this.lenSq},side:function(a){return this.dx*(a.y-this.y)-this.dy*(a.x-this.x)},distanceSq:function(a){var b=a.x-this.x,c=a.y-this.y,d=b*this.dx+c*this.dy;if(0>d)return b*b+c*c;if(d>
this.lenSq)return b=a.x-(this.x+this.dx),a=a.y-(this.y+this.dy),b*b+a*a;c=d*this.invLenSq;b=this.x+c*this.dx-a.x;a=this.y+c*this.dy-a.y;return b*b+a*a},distance:function(a){var b=a.x-this.x,c=a.y-this.y,d=b*this.dx+c*this.dy;0>d?a=b*b+c*c:(d>this.lenSq?(b=a.x-(this.x+this.dx),a=a.y-(this.y+this.dy)):(c=d*this.invLenSq,b=this.x+c*this.dx-a.x,a=this.y+c*this.dy-a.y),a=b*b+a*a);return Math.sqrt(a)},project:function(a,b){a=(a.x-this.x)*this.dx+(a.y-this.y)*this.dy;null==b&&(b=new ta(0,0));if(0>a){var c=
b;a=this.x;var d=this.y}else a>this.lenSq?(c=b,a=this.x+this.dx,d=this.y+this.dy):(d=a*this.invLenSq,c=b,a=this.x+d*this.dx,d=this.y+d*this.dy);null==d&&(d=0);null==a&&(a=0);c.x=a;c.y=d;return b},lineIntersection:function(a,b){var c=this.x,d=this.y;null==d&&(d=0);null==c&&(c=0);null==d&&(d=0);null==c&&(c=0);var e=c,f=d;c=this.x+this.dx;d=this.y+this.dy;null==d&&(d=0);null==c&&(c=0);null==d&&(d=0);null==c&&(c=0);if(0<(a.lx*(f-a.py)-a.ly*(e-a.px))*(a.lx*(d-a.py)-a.ly*(c-a.px)))return null;a=(a.lx*(this.y-
a.py)-a.ly*(this.x-a.px))/(a.ly*this.dx-a.lx*this.dy);if(0>a||1<a)return null;null==b&&(b=new ta(0,0));b.x=this.x+a*this.dx;b.y=this.y+a*this.dy;return b},__class__:ki};var Yg=function(){this.useScreenResolution=Yg.defaultUseScreenResolution;this.resolutionScale=1;this.enable=!0;this.smooth=!1;this.boundsExtend=0;this.autoBounds=!0};z["h2d.filter.Filter"]=Yg;Yg.__name__="h2d.filter.Filter";Yg.prototype={get_enable:function(){return this.enable},set_enable:function(a){return this.enable=a},set_resolutionScale:function(a){return this.resolutionScale=
a},set_useScreenResolution:function(a){return this.useScreenResolution=a},sync:function(a,b){},bind:function(a){},unbind:function(a){},getBounds:function(a,b,c){a.getBounds(a,b);b.xMin=b.xMin*c.x-this.boundsExtend;b.xMax=b.xMax*c.x+this.boundsExtend;b.yMin=b.yMin*c.y-this.boundsExtend;b.yMax=b.yMax*c.y+this.boundsExtend},draw:function(a,b){return b},__class__:Yg};var Zf=function(){this.head=this.tail=new Zg(null);this.totalCount=0};z["h2d.impl.BatchDrawState"]=Zf;Zf.__name__="h2d.impl.BatchDrawState";
Zf.prototype={setTile:function(a){null!=a&&this.setTexture(a.innerTex)},setTexture:function(a){if(null!=a)if(null==this.tail.texture)this.tail.texture=a;else if(this.tail.texture!=a){var b=this.tail;0==b.count?b.set(a):null==b.next?b.next=this.tail=new Zg(a):this.tail=b.next.set(a)}},add:function(a){this.tail.count+=a;this.totalCount+=a},clear:function(){var a=this.head;do a.texture=null,a=a.next;while(null!=a);this.tail=this.head;this.totalCount=this.tail.count=0},drawQuads:function(a,b,c,d){null==
d&&(d=-1);null==c&&(c=0);var e=this.head,f=this.tail.next,g=a.engine;if(0==c&&-1==d){do{a.texture=e.texture;a.beforeDraw();var h=e.count>>1;var k=c;var l=h;null==l&&(l=-1);null==k&&(k=0);g.renderBuffer(b,g.mem.getQuadIndexes(b.vertices),2,k,l);c+=h;e=e.next}while(e!=f)}else{-1==d&&(d=(this.totalCount>>1)-c);var m=0;do{h=e.count>>1;if(m+h>=c){l=c>=m?c:m;var p=d>h?h:d;a.texture=e.texture;a.beforeDraw();k=l;l=p;null==l&&(l=-1);null==k&&(k=0);g.renderBuffer(b,g.mem.getQuadIndexes(b.vertices),2,k,l);d-=
p;if(0==d)break}m+=h;e=e.next}while(e!=f)}},drawIndexed:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=0);var f=this.head,g=this.tail.next,h=a.engine;if(0==d&&-1==e){do{a.texture=f.texture;a.beforeDraw();var k=f.count/3|0;h.renderIndexed(b,c,d,k);d+=k;f=f.next}while(f!=g)}else{-1==e&&(e=this.totalCount/3|0);var l=0;do{k=f.count/3|0;if(l+k>=d){var m=d>=l?d:l,p=e>k?k:e;a.texture=f.texture;a.beforeDraw();h.renderIndexed(b,c,m,p);e-=p;if(0==e)break}l+=k;f=f.next}while(f!=g)}},get_currentTexture:function(){return this.tail.texture},
__class__:Zf};var Zg=function(a){this.texture=a;this.count=0};z["h2d.impl._BatchDrawState.StateEntry"]=Zg;Zg.__name__="h2d.impl._BatchDrawState.StateEntry";Zg.prototype={set:function(a){this.texture=a;this.count=0;return this},__class__:Zg};var $a=L["h3d.BufferFlag"]={__ename__:!0,__constructs__:null,Dynamic:{_hx_name:"Dynamic",_hx_index:0,__enum__:"h3d.BufferFlag",toString:v},NoAlloc:{_hx_name:"NoAlloc",_hx_index:1,__enum__:"h3d.BufferFlag",toString:v},UniformBuffer:{_hx_name:"UniformBuffer",_hx_index:2,
__enum__:"h3d.BufferFlag",toString:v},ReadWriteBuffer:{_hx_name:"ReadWriteBuffer",_hx_index:3,__enum__:"h3d.BufferFlag",toString:v},IndexBuffer:{_hx_name:"IndexBuffer",_hx_index:4,__enum__:"h3d.BufferFlag",toString:v}};$a.__constructs__=[$a.Dynamic,$a.NoAlloc,$a.UniformBuffer,$a.ReadWriteBuffer,$a.IndexBuffer];$a.__empty_constructs__=[$a.Dynamic,$a.NoAlloc,$a.UniformBuffer,$a.ReadWriteBuffer,$a.IndexBuffer];var $b=function(a,b,c){this.id=$b.GUID++;this.vertices=a;this.format=b;this.flags=0;this.allocPos=
rd.make();if(null!=c)for(a=0;a<c.length;)b=c[a],++a,this.flags|=1<<b._hx_index;this.engine=na.CURRENT;0==(this.flags&1<<$a.NoAlloc._hx_index)&&this.engine.mem.allocBuffer(this)};z["h3d.Buffer"]=$b;$b.__name__="h3d.Buffer";$b.ofFloats=function(a,b,c){var d=Math.ceil(a.pos/b.stride);b=new $b(d,b,c);b.uploadFloats(a,0,d);return b};$b.ofSubFloats=function(a,b,c,d){c=new $b(b,c,d);c.uploadFloats(a,0,b);return c};$b.prototype={getMemSize:function(){return this.vertices*this.format.strideBytes},isDisposed:function(){return null==
this.vbuf},dispose:function(){null!=this.vbuf&&(this.engine.mem.freeBuffer(this),this.vbuf=null)},uploadFloats:function(a,b,c,d){null==d&&(d=0);if(0>d||0>c||d+c>this.vertices)throw u.thrown("Invalid vertices count");if(0!=c)if(this.format.hasLowPrecision){d=new S(new ArrayBuffer(c*this.format.strideBytes));for(var e=0,f,g=this.format.inputs,h=0;h<c;)for(h++,f=0;f<g.length;){var k=g[f++],l=k.type,m=l==Z.__cast(9,cc)?1:l;l=0;switch(k.precision){case 0:for(var p=0;p<m;)p++,d.setFloat(e+l,a.array[b++]),
l+=4;break;case 1:for(p=0;p<m;){p++;var t=N.float32to16(a.array[b++]);d.setUInt16(e+l,t);l+=2}break;case 2:for(p=0;p<m;)p++,t=N.float32toU8(a.array[b++]),d.b[e+l]=t,++l;break;case 3:for(p=0;p<m;)p++,t=N.float32toS8(a.array[b++]),d.b[e+l]=t,++l}l=k.type;e+=(l==Z.__cast(9,cc)?1:l)*qc.SIZES[k.precision];0!=(e&3)&&(e+=4-(e&3))}this.uploadBytes(d,0,c)}else this.engine.driver.uploadBufferData(this,d,c,a,b)},uploadBytes:function(a,b,c){if(0>c||c>this.vertices)throw u.thrown("Invalid vertices count");0!=
c&&this.engine.driver.uploadBufferBytes(this,0,c,a,b)},readBytes:function(a,b,c,d){null==d&&(d=0);if(0>d||0>c||d+c>this.vertices)throw u.thrown("Invalid vertices count");this.engine.driver.readBufferBytes(this,d,c,a,b)},__class__:$b};var gg=function(a,b,c,d,e,f){null==f&&(f=!1);null==e&&(e=4E3);null==d&&(d=.02);null==c&&(c=1.333333);null==b&&(b=1);null==a&&(a=25);this.viewX=this.viewY=this.jitterOffsetX=this.jitterOffsetY=0;this.fovY=a;this.zoom=b;this.screenRatio=c;this.zNear=d;this.zFar=e;this.rightHanded=
f;a=2;b=3;c=4;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.pos=new I(a,b,c);b=a=0;c=1;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.up=new I(a,b,c);c=b=a=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.target=new I(a,b,c);this.m=new ma;this.mcam=new ma;this.mproj=new ma;this.frustum=new $g;this.update()};z["h3d.Camera"]=gg;gg.__name__="h3d.Camera";gg.prototype={setFovX:function(a,b){var c=Math.PI/180;this.fovY=2*Math.atan(Math.tan(.5*a*c)/b)/c},getFovX:function(){var a=Math.PI/180;return 2*
Math.atan(Math.tan(.5*this.fovY*a)*this.screenRatio)/a},clone:function(){var a=new gg(this.fovY,this.zoom,this.screenRatio,this.zNear,this.zFar,this.rightHanded),b=this.pos,c=b.x,d=b.y;b=b.z;null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.pos=new I(c,d,b);b=this.up;c=b.x;d=b.y;b=b.z;null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.up=new I(c,d,b);b=this.target;c=b.x;d=b.y;b=b.z;null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.target=new I(c,d,b);a.update();return a},getInverseViewProj:function(){null==
this.minv&&(this.minv=new ma);this.needInv&&(this.minv.initInverse(this.m),this.needInv=!1);return this.minv},getInverseProj:function(){null==this.mprojInv&&(this.mprojInv=new ma,this.mprojInv._44=0);0==this.mprojInv._44&&this.mprojInv.initInverse(this.mproj);return this.mprojInv},getInverseView:function(){null==this.mcamInv&&(this.mcamInv=new ma,this.mcamInv._44=0);0==this.mcamInv._44&&this.mcamInv.initInverse(this.mcam);return this.mcamInv},calcDirections:function(){var a=this.target,b=this.pos,
c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;b=d;var f=e,g=a*a+b*b+f*f;g=1E-20>g?0:1/Math.sqrt(g);c=a*g;d=b*g;e=f*g;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;b=d;f=e;g=this.up;c=g.y*f-g.z*b;d=g.z*a-g.x*f;e=g.x*b-g.y*a;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var h=e;g=c*c+d*d+h*h;g=1E-20>g?0:1/Math.sqrt(g);c*=g;d*=g;e=h*
g;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=c;h=d;var k=e;c=b*k-f*h;d=f*g-a*k;e=a*h-b*g;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);this.directions._11=a;this.directions._12=b;this.directions._13=f;this.directions._21=g;this.directions._22=h;this.directions._23=k;this.directions._31=c;this.directions._32=d;this.directions._33=e;this.directions._44=1},getForward:function(){var a=new I(0,0,0);null==this.directions&&
(this.directions=new ma,this.directions._44=0);0==this.directions._44&&this.calcDirections();a.x=this.directions._11;a.y=this.directions._12;a.z=this.directions._13;return a},getRight:function(){var a=new I(0,0,0);null==this.directions&&(this.directions=new ma,this.directions._44=0);0==this.directions._44&&this.calcDirections();a.x=this.directions._21;a.y=this.directions._22;a.z=this.directions._23;return a},getUp:function(){var a=new I(0,0,0);null==this.directions&&(this.directions=new ma,this.directions._44=
0);0==this.directions._44&&this.calcDirections();a.x=this.directions._31;a.y=this.directions._32;a.z=this.directions._33;return a},setCubeMap:function(a,b){var c=0,d=0,e=0;switch(a){case 0:c=1;a=this.up;var f=0;var g=1;var h=0;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 1:c=-1;a=this.up;f=0;g=1;h=0;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 2:d=1;a=this.up;g=f=0;h=-1;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 3:d=
-1;a=this.up;g=f=0;h=1;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 4:e=1;a=this.up;f=0;g=1;h=0;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h;break;case 5:e=-1,a=this.up,f=0,g=1,h=0,null==h&&(h=0),null==g&&(g=0),null==f&&(f=0),a.x=f,a.y=g,a.z=h}null!=b&&(a=this.pos,a.x=b.x,a.y=b.y,a.z=b.z);a=this.target;f=this.pos.x+c;g=this.pos.y+d;h=this.pos.z+e;null==h&&(h=0);null==g&&(g=0);null==f&&(f=0);a.x=f;a.y=g;a.z=h},unproject:function(a,b,c){null==c&&(c=0);
null==b&&(b=0);null==a&&(a=0);c=new I(a,b,c);a=this.getInverseViewProj();b=c.x*a._12+c.y*a._22+c.z*a._32+a._42;var d=c.x*a._13+c.y*a._23+c.z*a._33+a._43,e=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=(c.x*a._11+c.y*a._21+c.z*a._31+a._41)*e;c.y=b*e;c.z=d*e;return c},rayFromScreen:function(a,b,c,d){null==d&&(d=-1);null==c&&(c=-1);var e=na.CURRENT;0>c&&(c=e.width);0>d&&(d=e.height);a=2*(a/c-.5);d=2*(.5-b/d);b=this.unproject(a,d,0);d=this.unproject(a,d,1);a=new Pb;a.px=b.x;a.py=b.y;a.pz=b.z;a.lx=d.x-b.x;
a.ly=d.y-b.y;a.lz=d.z-b.z;a.normalize();return a},update:function(){if(null!=this.follow){var a=this.follow.pos.localToGlobal(),b=this.follow.target.localToGlobal(),c=this.pos,d=a.x,e=a.y;a=a.z;null==a&&(a=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=a;c=this.target;d=b.x;e=b.y;a=b.z;null==a&&(a=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=a;if(null!=this.follow.pos.name)for(b=this.follow.pos;null!=b;){if(null!=b.currentAnimation&&(c=b.currentAnimation.getPropValue(this.follow.pos.name,"FOVY"),
null!=c)){this.fovY=c;break}b=b.parent}}this.makeCameraMatrix(this.mcam);this.makeFrustumMatrix(this.mproj);this.m.multiply(this.mcam,this.mproj);this.needInv=!0;null!=this.mcamInv&&(this.mcamInv._44=0);null!=this.mprojInv&&(this.mprojInv._44=0);null!=this.directions&&(this.directions._44=0);this.frustum.loadMatrix(this.m)},getFrustumCorners:function(a,b){null==b&&(b=0);null==a&&(a=1);return[this.unproject(-1,1,b),this.unproject(1,1,b),this.unproject(1,-1,b),this.unproject(-1,-1,b),this.unproject(-1,
1,a),this.unproject(1,1,a),this.unproject(1,-1,a),this.unproject(-1,-1,a)]},lostUp:function(){var a=this.pos,b=a.x,c=a.y;a=a.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);var d=c,e=a;null==e&&(e=0);null==d&&(d=0);null==b&&(b=0);c=b;a=d;b=e;d=c*c+a*a+b*b;d=1E-20>d?0:1/Math.sqrt(d);e=this.up;return.999<Math.abs(c*d*e.x+a*d*e.y+b*d*e.z)},getViewDirection:function(a,b,c){null==c&&(c=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a=c=new I(a,b,c);b=this.mcam;var d=a.x*b._12+a.y*b._22+a.z*b._32,e=a.x*
b._13+a.y*b._23+a.z*b._33;a.x=a.x*b._11+a.y*b._21+a.z*b._31;a.y=d;a.z=e;a=c;b=a.x*a.x+a.y*a.y+a.z*a.z;b=1E-20>b?0:1/Math.sqrt(b);a.x*=b;a.y*=b;a.z*=b;return c},movePosAxis:function(a,b,c){null==c&&(c=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=c;null==d&&(d=0);null==b&&(b=0);null==a&&(a=0);c=a;a=b;b=d;d=this.mcam;var e=c*d._12+a*d._22+b*d._32,f=c*d._13+a*d._23+b*d._33;this.pos.x+=c*d._11+a*d._21+b*d._31;this.pos.y+=e;this.pos.z+=f},moveTargetAxis:function(a,b,c){null==c&&(c=0);null==c&&
(c=0);null==b&&(b=0);null==a&&(a=0);var d=c;null==d&&(d=0);null==b&&(b=0);null==a&&(a=0);c=a;a=b;b=d;d=this.mcam;var e=c*d._12+a*d._22+b*d._32,f=c*d._13+a*d._23+b*d._33;this.target.x+=c*d._11+a*d._21+b*d._31;this.target.y+=e;this.target.z+=f},forward:function(a){null==a&&(a=1);var b=1-.025*a;a=this.pos;var c=this.target.x+(this.pos.x-this.target.x)*b,d=this.target.y+(this.pos.y-this.target.y)*b;b=this.target.z+(this.pos.z-this.target.z)*b;null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d;a.z=
b},backward:function(a){null==a&&(a=1);var b=1+.025*a;a=this.pos;var c=this.target.x+(this.pos.x-this.target.x)*b,d=this.target.y+(this.pos.y-this.target.y)*b;b=this.target.z+(this.pos.z-this.target.z)*b;null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);a.x=c;a.y=d;a.z=b},makeCameraMatrix:function(a){var b=this.target,c=this.pos,d=b.x-c.x,e=b.y-c.y;c=b.z-c.z;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);var f=e;null==c&&(c=0);null==f&&(f=0);null==d&&(d=0);b=d;var g=f,h=c;this.rightHanded&&(b*=-1,g*=-1,
h*=-1);c=b*b+g*g+h*h;c=1E-20>c?0:1/Math.sqrt(c);b*=c;g*=c;h*=c;var k=this.up;d=k.y*h-k.z*g;e=k.z*b-k.x*h;c=k.x*g-k.y*b;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);f=e;null==c&&(c=0);null==f&&(f=0);null==d&&(d=0);k=d;var l=f,m=c;c=k*k+l*l+m*m;c=1E-20>c?0:1/Math.sqrt(c);k*=c;l*=c;m*=c;0==Math.sqrt(k*k+l*l+m*m)&&(k=g,l=h,m=b);d=g*m-h*l;e=h*k-b*m;c=b*l-g*k;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);f=e;null==c&&(c=0);null==f&&(f=0);null==d&&(d=0);e=d;d=f;f=c;a._11=k;a._12=e;a._13=b;a._14=0;a._21=l;
a._22=d;a._23=g;a._24=0;a._31=m;a._32=f;a._33=h;a._34=0;c=this.pos;a._41=-(k*c.x+l*c.y+m*c.z);c=this.pos;a._42=-(e*c.x+d*c.y+f*c.z);c=this.pos;a._43=-(b*c.x+g*c.y+h*c.z);a._44=1},setTransform:function(a){var b=this.pos,c=a._41,d=a._42,e=a._43;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.target;e=this.pos;a=a.getDirection();c=e.x+a.x;d=e.y+a.y;e=e.z+a.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e},makeFrustumMatrix:function(a){a.zero();
var b=this.orthoBounds;if(null!=b){var c=1/(b.xMax-b.xMin),d=1/(b.yMax-b.yMin),e=1/(b.zMax-b.zMin);a._11=2*c;a._22=2*d;a._33=e;a._41=-(b.xMin+b.xMax)*c;a._42=-(b.yMin+b.yMax)*d;a._43=-b.zMin*e;a._44=1}else b=this.zoom/Math.tan(Math.atan(Math.tan(Math.PI/180*this.fovY*.5)*this.screenRatio)),a._11=b,a._22=b*this.screenRatio,a._33=this.zFar/(this.zFar-this.zNear),a._34=1,a._43=-(this.zNear*this.zFar)/(this.zFar-this.zNear),a._31=this.jitterOffsetX,a._32=this.jitterOffsetY;a._11+=this.viewX*a._14;a._21+=
this.viewX*a._24;a._31+=this.viewX*a._34;a._41+=this.viewX*a._44;a._12+=this.viewY*a._14;a._22+=this.viewY*a._24;a._32+=this.viewY*a._34;a._42+=this.viewY*a._44;this.rightHanded&&(a._33*=-1,a._34*=-1)},projectInline:function(a,b,c,d,e,f){null==f&&(f=!0);var g=new I(0,0,0),h=g;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);h.x=a;h.y=b;h.z=c;h=g;c=this.m;a=h.x*c._12+h.y*c._22+h.z*c._32+c._42;b=h.x*c._13+h.y*c._23+h.z*c._33+c._43;var k=1/(h.x*c._14+h.y*c._24+h.z*c._34+c._44);h.x=(h.x*c._11+h.y*c._21+h.z*
c._31+c._41)*k;h.y=a*k;h.z=b*k;g.x=.5*(g.x+1)*d;g.y=.5*(-g.y+1)*e;f&&(g.x=Math.round(g.x),g.y=Math.round(g.y));return g},project:function(a,b,c,d,e,f,g){null==f&&(f=!0);null==g&&(g=new I(0,0,0));var h=g;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);h.x=a;h.y=b;h.z=c;h=g;c=this.m;a=h.x*c._12+h.y*c._22+h.z*c._32+c._42;b=h.x*c._13+h.y*c._23+h.z*c._33+c._43;var k=1/(h.x*c._14+h.y*c._24+h.z*c._34+c._44);h.x=(h.x*c._11+h.y*c._21+h.z*c._31+c._41)*k;h.y=a*k;h.z=b*k;g.x=.5*(g.x+1)*d;g.y=.5*(-g.y+1)*e;f&&(g.x=
Math.round(g.x),g.y=Math.round(g.y));return g},distanceToDepth:function(a){var b=this.zNear,c=this.zFar;null==c&&(c=1);null==b&&(b=0);return((this.zFar+this.zNear-2*this.zNear*this.zFar/(a<b?b:a>c?c:a))/(this.zFar-this.zNear)+1)/2},depthToDistance:function(a){var b=0,c=1;null==c&&(c=1);null==b&&(b=0);return((a<b?b:a>c?c:a)*this.zFar-this.zNear*this.zFar)/(this.zFar-this.zNear)},load:function(a){var b=this.pos,c=a.pos;b.x=c.x;b.y=c.y;b.z=c.z;b=this.target;c=a.target;b.x=c.x;b.y=c.y;b.z=c.z;b=this.up;
c=a.up;b.x=c.x;b.y=c.y;b.z=c.z;null!=a.orthoBounds?(this.orthoBounds=new fb,this.orthoBounds.load(a.orthoBounds)):this.orthoBounds=null;this.fovY=a.fovY;this.screenRatio=a.screenRatio;this.zoom=a.zoom;this.zNear=a.zNear;this.zFar=a.zFar;this.follow=null!=a.follow?{pos:a.follow.pos,target:a.follow.target}:null;this.viewX=a.viewX;this.viewY=a.viewY;this.update()},__class__:gg};var mi=function(a,b,c,d,e){this.t=a;this.next=b;this.layer=c;this.mipLevel=d;this.depthBinding=e};z["h3d._Engine.TargetTmp"]=
mi;mi.__name__="h3d._Engine.TargetTmp";mi.prototype={__class__:mi};var rc=L["h3d.DepthBinding"]={__ename__:!0,__constructs__:null,ReadWrite:{_hx_name:"ReadWrite",_hx_index:0,__enum__:"h3d.DepthBinding",toString:v},ReadOnly:{_hx_name:"ReadOnly",_hx_index:1,__enum__:"h3d.DepthBinding",toString:v},DepthOnly:{_hx_name:"DepthOnly",_hx_index:2,__enum__:"h3d.DepthBinding",toString:v},NotBound:{_hx_name:"NotBound",_hx_index:3,__enum__:"h3d.DepthBinding",toString:v}};rc.__constructs__=[rc.ReadWrite,rc.ReadOnly,
rc.DepthOnly,rc.NotBound];rc.__empty_constructs__=[rc.ReadWrite,rc.ReadOnly,rc.DepthOnly,rc.NotBound];var na=function(){this.resCache=new vc;this.inRender=this.ready=!1;this.textureColorCache=new Da;this.tmpVector=new T(0,0,0,1);this.backgroundColor=-16777216;this.hardware=!na.SOFTWARE_DRIVER;this.antiAlias=na.ANTIALIASING;this.autoResize=!0;this.set_fullScreen(!ia.getValue(je.IsWindowed));this.window=Gb.getInstance();this.realFps=ia.getDefaultFrameRate();this.lastTime=D.now()/1E3;this.window.addResizeEvent(M(this,
this.onWindowResize));na.CURRENT=this;this.window.setCurrent();this.driver=rf.get_supported()?new fa(this.antiAlias):new ah};z["h3d.Engine"]=na;na.__name__="h3d.Engine";na.getCurrent=function(){return na.CURRENT};na.prototype={setDriver:function(a){this.driver=a;null!=this.mem&&(this.mem.driver=a)},setCurrent:function(){na.CURRENT=this;this.window.setCurrent()},init:function(){this.driver.init(M(this,this.onCreate),!this.hardware)},driverName:function(a){null==a&&(a=!1);return this.driver.getDriverName(a)},
selectShader:function(a){this.needFlushTarget&&this.doFlushTarget();this.driver.selectShader(a)&&this.shaderSwitches++},selectMaterial:function(a){this.driver.selectMaterial(a)},uploadShaderBuffers:function(a,b){this.driver.uploadShaderBuffers(a,b)},selectBuffer:function(a){if(null==a.vbuf)return!1;this.needFlushTarget&&this.doFlushTarget();this.driver.selectBuffer(a);return!0},renderTriBuffer:function(a,b,c){null==c&&(c=-1);null==b&&(b=0);this.renderBuffer(a,this.mem.getTriIndexes(a.vertices),3,
b,c)},renderQuadBuffer:function(a,b,c){null==c&&(c=-1);null==b&&(b=0);this.renderBuffer(a,this.mem.getQuadIndexes(a.vertices),2,b,c)},renderBuffer:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=0);if(null!=b.vbuf){c=a.vertices/c|0;0>e&&(e=c-d);if(0>d||0>e||d+e>c)throw u.thrown("Invalid vertices count");0<e&&this.selectBuffer(a)&&(this.driver.draw(b,3*d,e),this.drawTriangles+=e,this.drawCalls++)}},renderIndexed:function(a,b,c,d){null==d&&(d=-1);null==c&&(c=0);if(null!=b.vbuf){var e=b.vertices/3|0;
0>d&&(d=e-c);0<d&&this.selectBuffer(a)&&(this.driver.draw(b,3*c,d),this.drawTriangles+=d,this.drawCalls++)}},renderMultiBuffers:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=0);var f=c.vertices/3|0;0>=f||(this.needFlushTarget&&this.doFlushTarget(),this.driver.selectMultiBuffers(a,b),null!=c.vbuf&&(0>e&&(e=f-d),0<e&&(this.driver.draw(c,3*d,e),this.drawTriangles+=e,this.drawCalls++)))},renderInstanced:function(a,b){null!=a.vbuf&&0<b.commandCount&&(this.driver.drawInstanced(a,b),this.drawTriangles+=
b.triCount,this.drawCalls++)},set_debug:function(a){this.debug=a;this.driver.setDebug(this.debug);return a},onCreate:function(a){na.CURRENT=this;this.window.setCurrent();this.autoResize&&(this.width=this.window.get_width(),this.height=this.window.get_height());a?(Ob.get().onContextLost(),this.mem.onContextLost()):(this.mem=new bf(this.driver),this.mem.init(),this.nullTexture=new Y(0,0,[O.NoAlloc]));this.hardware=this.driver.hasFeature(Ta.HardwareAccelerated);this.set_debug(this.debug);this.set_fullScreen(this.fullScreen);
this.resize(this.width,this.height);if(a)this.onContextLost();else this.onReady();this.ready=!0},onContextLost:function(){},onReady:function(){},onWindowResize:function(){if(this.autoResize&&!this.driver.isDisposed()){var a=this.window.get_width(),b=this.window.get_height();a==this.width&&b==this.height||this.resize(a,b);this.onResized()}},set_fullScreen:function(a){this.fullScreen=a;null!=this.mem&&ia.getValue(je.IsWindowed)&&this.window.set_displayMode(a?Yc.Borderless:Yc.Windowed);return a},onResized:function(){},
resize:function(a,b){32>a&&(a=32);32>b&&(b=32);this.width=a;this.height=b;this.driver.isDisposed()||this.driver.resize(a,b)},begin:function(){if(this.driver.isDisposed())return!1;this.inRender=!0;this.dispatches=this.drawCalls=this.shaderSwitches=this.drawTriangles=0;this.targetStack=null;this.needFlushTarget=null!=this.currentTargetTex;this.driver.begin(ba.frameCount);null!=this.backgroundColor&&this.clear(this.backgroundColor,1,0);return!0},hasFeature:function(a){return this.driver.hasFeature(a)},
end:function(){this.inRender=!1;this.driver.end()},getCurrentTarget:function(){return null==this.targetStack?null:this.targetStack.t==this.nullTexture?this.targetStack.textures[0]:this.targetStack.t},pushTarget:function(a,b,c,d){null==d&&(d=rc.ReadWrite);null==c&&(c=0);null==b&&(b=0);var e=this.targetTmp;null==e?e=new mi(a,this.targetStack,b,c,d):(this.targetTmp=e.next,e.t=a,e.next=this.targetStack,e.mipLevel=c,e.layer=b,e.depthBinding=d);this.targetStack=e;this.updateNeedFlush()},updateNeedFlush:function(){var a=
this.targetStack;this.needFlushTarget=null==a?null!=this.currentTargetTex:this.currentTargetTex!=a.t||this.currentTargetLayer!=a.layer||this.currentTargetMip!=a.mipLevel||null!=a.textures||this.currentDepthBinding!=a.depthBinding},pushTargets:function(a,b){null==b&&(b=rc.ReadWrite);this.pushTarget(this.nullTexture,null,null,b);this.targetStack.textures=a;this.needFlushTarget=!0},pushDepth:function(a){this.pushTarget(a,null,null,rc.DepthOnly)},popTarget:function(){var a=this.targetStack;if(null==a)throw u.thrown("popTarget() with no matching pushTarget()");
this.targetStack=a.next;this.updateNeedFlush();a.t=null;a.textures=null;a.next=this.targetTmp;this.targetTmp=a},flushTarget:function(){this.needFlushTarget&&this.doFlushTarget()},doFlushTarget:function(){var a=this.targetStack;null==a?(this.driver.setRenderTarget(null),this.currentTargetTex=null):(a.depthBinding==rc.DepthOnly?this.driver.setDepth(a.t):null!=a.textures?this.driver.setRenderTargets(a.textures,a.depthBinding):this.driver.setRenderTarget(a.t,a.layer,a.mipLevel,a.depthBinding),this.currentTargetTex=
a.t,this.currentTargetLayer=a.layer,this.currentTargetMip=a.mipLevel,this.currentDepthBinding=a.depthBinding);this.needFlushTarget=!1},clearF:function(a,b,c){this.needFlushTarget&&this.doFlushTarget();this.driver.clear(a,b,c)},clear:function(a,b,c){if(null!=a){var d=this.tmpVector;d.x=(a>>16&255)/255;d.y=(a>>8&255)/255;d.z=(a&255)/255;d.w=(a>>>24)/255}this.needFlushTarget&&this.doFlushTarget();this.driver.clear(null==a?null:this.tmpVector,b,c)},setRenderZone:function(a,b,c,d){null==d&&(d=-1);null==
c&&(c=-1);null==b&&(b=0);null==a&&(a=0);this.needFlushTarget&&this.doFlushTarget();this.driver.setRenderZone(a,b,c,d)},render:function(a){if(!this.begin())return!1;a.render(this);this.end();var b=D.now()/1E3-this.lastTime;this.lastTime+=b;0<b&&(a=1/b,a>2*this.realFps?a=2*this.realFps:a<.5*this.realFps&&(a=.5*this.realFps),b/=.5,.3<b&&(b=.3),this.realFps=this.realFps*(1-b)+a*b);return!0},onTextureBiasChanged:function(a){if(!a.isDepth())throw u.thrown("Can change texture bias on depth buffer only");
this.driver.onTextureBiasChanged(a)},dispose:function(){this.driver.dispose();this.window.removeResizeEvent(M(this,this.onWindowResize));null!=this.mem&&this.mem.dispose()},get_fps:function(){return Math.ceil(100*this.realFps)/100},__class__:na};var $d={_new:function(a,b){null==b&&(b=!1);return new $b(a,b?N.get_INDEX32():N.get_INDEX16(),[$a.IndexBuffer])},uploadIndexes:function(a,b,c,d,e){null==e&&(e=0);if(0>e||0>d||e+d>a.vertices)throw u.thrown("Invalid indices count");if(1!=a.format.inputs[0].precision)throw u.thrown("Can't upload indexes on a 32-bit buffer");
0!=d&&na.CURRENT.driver.uploadIndexData(a,e,d,b,c)},get_count:function(a){return a.vertices},alloc:function(a,b,c){null==c&&(c=-1);0>c&&(c=a.length);b=$d._new(c);$d.uploadIndexes(b,a,0,c);return b}},ma=function(){};z["h3d.MatrixImpl"]=ma;ma.__name__="h3d.MatrixImpl";ma.prototype={get_tx:function(){return this._41},get_ty:function(){return this._42},get_tz:function(){return this._43},set_tx:function(a){return this._41=a},set_ty:function(a){return this._42=a},set_tz:function(a){return this._43=a},equal:function(a){return this._11==
a._11&&this._12==a._12&&this._13==a._13&&this._14==a._14&&this._21==a._21&&this._22==a._22&&this._23==a._23&&this._24==a._24&&this._31==a._31&&this._32==a._32&&this._33==a._33&&this._34==a._34&&this._41==a._41&&this._42==a._42&&this._43==a._43?this._44==a._44:!1},zero:function(){this._44=this._43=this._42=this._41=this._34=this._33=this._32=this._31=this._24=this._23=this._22=this._21=this._14=this._13=this._12=this._11=0},identity:function(){this._11=1;this._21=this._14=this._13=this._12=0;this._22=
1;this._32=this._31=this._24=this._23=0;this._33=1;this._43=this._42=this._41=this._34=0;this._44=1},isIdentity:function(){return 0!=this._41||0!=this._42||0!=this._43||1!=this._11||1!=this._22||1!=this._33||0!=this._12||0!=this._13||0!=this._14||0!=this._21||0!=this._23||0!=this._24||0!=this._31||0!=this._32||0!=this._34?!1:1==this._44},isIdentityEpsilon:function(a){var b=this._41;(0>b?-b:b)>a?b=!0:(b=this._42,b=(0>b?-b:b)>a);b?b=!0:(b=this._43,b=(0>b?-b:b)>a);if(b)return!1;b=this._11-1;(0>b?-b:
b)>a?b=!0:(b=this._22-1,b=(0>b?-b:b)>a);b?b=!0:(b=this._33-1,b=(0>b?-b:b)>a);if(b)return!1;b=this._12;(0>b?-b:b)>a?b=!0:(b=this._13,b=(0>b?-b:b)>a);b?b=!0:(b=this._14,b=(0>b?-b:b)>a);if(b)return!1;b=this._21;(0>b?-b:b)>a?b=!0:(b=this._23,b=(0>b?-b:b)>a);b?b=!0:(b=this._24,b=(0>b?-b:b)>a);if(b)return!1;b=this._31;(0>b?-b:b)>a?b=!0:(b=this._32,b=(0>b?-b:b)>a);b?b=!0:(b=this._34,b=(0>b?-b:b)>a);if(b)return!1;b=this._44-1;return(0>b?-b:b)<=a},initRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);
this._11=1;this._21=this._14=this._13=this._12=0;this._22=b;this._23=a;this._31=this._24=0;this._32=-a;this._33=b;this._43=this._42=this._41=this._34=0;this._44=1},initRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this._11=b;this._12=0;this._13=-a;this._21=this._14=0;this._22=1;this._24=this._23=0;this._31=a;this._32=0;this._33=b;this._43=this._42=this._41=this._34=0;this._44=1},initRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this._11=b;this._12=a;this._14=this._13=0;this._21=-a;
this._22=b;this._32=this._31=this._24=this._23=0;this._33=1;this._43=this._42=this._41=this._34=0;this._44=1},initTranslation:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this._11=1;this._21=this._14=this._13=this._12=0;this._22=1;this._32=this._31=this._24=this._23=0;this._33=1;this._34=0;this._41=a;this._42=b;this._43=c;this._44=1},initScale:function(a,b,c){null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);this._11=a;this._21=this._14=this._13=this._12=0;this._22=b;this._32=this._31=
this._24=this._23=0;this._33=c;this._43=this._42=this._41=this._34=0;this._44=1},initRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=-a.x,f=-a.y;a=-a.z;var g=1/Math.sqrt(e*e+f*f+a*a);e*=g;f*=g;a*=g;g=e*d;var h=a*d;this._11=c+e*g;this._12=f*g-a*b;this._13=e*h+f*b;this._14=0;this._21=f*g+a*b;this._22=c+f*f*d;this._23=f*h-e*b;this._24=0;this._31=e*h-f*b;this._32=f*h+e*b;this._33=c+a*h;this._43=this._42=this._41=this._34=0;this._44=1},initRotation:function(a,b,c){var d=Math.cos(a);
a=Math.sin(a);var e=Math.cos(b);b=Math.sin(b);var f=Math.cos(c);c=Math.sin(c);var g=d*b,h=a*b;this._11=e*f;this._12=e*c;this._13=-b;this._14=0;this._21=h*f-d*c;this._22=h*c+d*f;this._23=a*e;this._24=0;this._31=g*f+a*c;this._32=g*c-a*f;this._33=d*e;this._43=this._42=this._41=this._34=0;this._44=1},translate:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this._11+=a*this._14;this._12+=b*this._14;this._13+=c*this._14;this._21+=a*this._24;this._22+=b*this._24;this._23+=c*this._24;this._31+=
a*this._34;this._32+=b*this._34;this._33+=c*this._34;this._41+=a*this._44;this._42+=b*this._44;this._43+=c*this._44},scale:function(a,b,c){null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);this._11*=a;this._21*=a;this._31*=a;this._41*=a;this._12*=b;this._22*=b;this._32*=b;this._42*=b;this._13*=c;this._23*=c;this._33*=c;this._43*=c},rotate:function(a,b,c){var d=ma.tmp;d.initRotation(a,b,c);this.multiply(this,d)},rotateAxis:function(a,b){var c=ma.tmp;c.initRotationAxis(a,b);this.multiply(this,c)},getPosition:function(){var a=
new I(0,0,0),b=this._41,c=this._42,d=this._43;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;return a},setPosition:function(a){this._41=a.x;this._42=a.y;this._43=a.z},prependTranslation:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=this._12*a+this._22*b+this._32*c+this._42,e=this._13*a+this._23*b+this._33*c+this._43,f=this._14*a+this._24*b+this._34*c+this._44;this._41=this._11*a+this._21*b+this._31*c+this._41;this._42=d;this._43=e;this._44=f},getScale:function(){var a=
new I(0,0,0);a.x=Math.sqrt(this._11*this._11+this._12*this._12+this._13*this._13);a.y=Math.sqrt(this._21*this._21+this._22*this._22+this._23*this._23);a.z=Math.sqrt(this._31*this._31+this._32*this._32+this._33*this._33);0>this._11*(this._22*this._33-this._23*this._32)+this._12*(this._23*this._31-this._21*this._33)+this._13*(this._21*this._32-this._22*this._31)&&(a.x*=-1,a.y*=-1,a.z*=-1);return a},prependRotation:function(a,b,c){var d=ma.tmp;d.initRotation(a,b,c);this.multiply(d,this)},prependRotationAxis:function(a,
b){var c=ma.tmp;c.initRotationAxis(a,b);this.multiply(c,this)},prependScale:function(a,b,c){null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);var d=ma.tmp;d.initScale(a,b,c);this.multiply(d,this)},multiply3x4:function(a,b){var c=a._11,d=a._12,e=a._13,f=a._21,g=a._22,h=a._23,k=a._31,l=a._32,m=a._33,p=a._41,t=a._42;a=a._43;var n=b._11,r=b._12,y=b._13,G=b._21,q=b._22,u=b._23,v=b._31,w=b._32,x=b._33,z=b._41,A=b._42;b=b._43;this._11=c*n+d*G+e*v;this._12=c*r+d*q+e*w;this._13=c*y+d*u+e*x;this._14=0;this._21=
f*n+g*G+h*v;this._22=f*r+g*q+h*w;this._23=f*y+g*u+h*x;this._24=0;this._31=k*n+l*G+m*v;this._32=k*r+l*q+m*w;this._33=k*y+l*u+m*x;this._34=0;this._41=p*n+t*G+a*v+z;this._42=p*r+t*q+a*w+A;this._43=p*y+t*u+a*x+b;this._44=1},multiply3x4inline:function(a,b){var c=a._11,d=a._12,e=a._13,f=a._21,g=a._22,h=a._23,k=a._31,l=a._32,m=a._33,p=a._41,t=a._42;a=a._43;var n=b._11,r=b._12,y=b._13,G=b._21,q=b._22,u=b._23,v=b._31,w=b._32,x=b._33,z=b._41,A=b._42;b=b._43;this._11=c*n+d*G+e*v;this._12=c*r+d*q+e*w;this._13=
c*y+d*u+e*x;this._14=0;this._21=f*n+g*G+h*v;this._22=f*r+g*q+h*w;this._23=f*y+g*u+h*x;this._24=0;this._31=k*n+l*G+m*v;this._32=k*r+l*q+m*w;this._33=k*y+l*u+m*x;this._34=0;this._41=p*n+t*G+a*v+z;this._42=p*r+t*q+a*w+A;this._43=p*y+t*u+a*x+b;this._44=1},multiply:function(a,b){var c=a._11,d=a._12,e=a._13,f=a._14,g=a._21,h=a._22,k=a._23,l=a._24,m=a._31,p=a._32,t=a._33,n=a._34,r=a._41,y=a._42,G=a._43;a=a._44;var q=b._11,u=b._12,v=b._13,w=b._14,x=b._21,z=b._22,A=b._23,B=b._24,C=b._31,E=b._32,D=b._33,F=
b._34,I=b._41,H=b._42,K=b._43;b=b._44;this._11=c*q+d*x+e*C+f*I;this._12=c*u+d*z+e*E+f*H;this._13=c*v+d*A+e*D+f*K;this._14=c*w+d*B+e*F+f*b;this._21=g*q+h*x+k*C+l*I;this._22=g*u+h*z+k*E+l*H;this._23=g*v+h*A+k*D+l*K;this._24=g*w+h*B+k*F+l*b;this._31=m*q+p*x+t*C+n*I;this._32=m*u+p*z+t*E+n*H;this._33=m*v+p*A+t*D+n*K;this._34=m*w+p*B+t*F+n*b;this._41=r*q+y*x+G*C+a*I;this._42=r*u+y*z+G*E+a*H;this._43=r*v+y*A+G*D+a*K;this._44=r*w+y*B+G*F+a*b},multiplyValue:function(a){this._11*=a;this._12*=a;this._13*=a;
this._14*=a;this._21*=a;this._22*=a;this._23*=a;this._24*=a;this._31*=a;this._32*=a;this._33*=a;this._34*=a;this._41*=a;this._42*=a;this._43*=a;this._44*=a},invert:function(){this.initInverse(this)},getInverse:function(a){null==a&&(a=new ma);a.initInverse(this);return a},getDeterminant:function(){return this._11*(this._22*this._33-this._23*this._32)+this._12*(this._23*this._31-this._21*this._33)+this._13*(this._21*this._32-this._22*this._31)},inverse3x4:function(a){var b=a._11,c=a._12,d=a._13,e=a._21,
f=a._22,g=a._23,h=a._31,k=a._32,l=a._33,m=a._41,p=a._42;a=a._43;this._11=f*l-g*k;this._12=d*k-c*l;this._13=c*g-d*f;this._14=0;this._21=g*h-e*l;this._22=b*l-d*h;this._23=d*e-b*g;this._24=0;this._31=e*k-f*h;this._32=c*h-b*k;this._33=b*f-c*e;this._34=0;this._41=-e*k*a+e*l*p+h*f*a-h*g*p-m*f*l+m*g*k;this._42=b*k*a-b*l*p-h*c*a+h*d*p+m*c*l-m*d*k;this._43=-b*f*a+b*g*p+e*c*a-e*d*p-m*c*g+m*d*f;this._44=1;b=b*this._11+c*this._21+d*this._31;1E-10>(0>b?-b:b)?this.zero():(b=1/b,this._11*=b,this._12*=b,this._13*=
b,this._21*=b,this._22*=b,this._23*=b,this._31*=b,this._32*=b,this._33*=b,this._41*=b,this._42*=b,this._43*=b)},initInverse:function(a){var b=a._11,c=a._12,d=a._13,e=a._14,f=a._21,g=a._22,h=a._23,k=a._24,l=a._31,m=a._32,p=a._33,t=a._34,n=a._41,r=a._42,y=a._43;a=a._44;this._11=g*p*a-g*t*y-m*h*a+m*k*y+r*h*t-r*k*p;this._12=-c*p*a+c*t*y+m*d*a-m*e*y-r*d*t+r*e*p;this._13=c*h*a-c*k*y-g*d*a+g*e*y+r*d*k-r*e*h;this._14=-c*h*t+c*k*p+g*d*t-g*e*p-m*d*k+m*e*h;this._21=-f*p*a+f*t*y+l*h*a-l*k*y-n*h*t+n*k*p;this._22=
b*p*a-b*t*y-l*d*a+l*e*y+n*d*t-n*e*p;this._23=-b*h*a+b*k*y+f*d*a-f*e*y-n*d*k+n*e*h;this._24=b*h*t-b*k*p-f*d*t+f*e*p+l*d*k-l*e*h;this._31=f*m*a-f*t*r-l*g*a+l*k*r+n*g*t-n*k*m;this._32=-b*m*a+b*t*r+l*c*a-l*e*r-n*c*t+n*e*m;this._33=b*g*a-b*k*r-f*c*a+f*e*r+n*c*k-n*e*g;this._34=-b*g*t+b*k*m+f*c*t-f*e*m-l*c*k+l*e*g;this._41=-f*m*y+f*p*r+l*g*y-l*h*r-n*g*p+n*h*m;this._42=b*m*y-b*p*r-l*c*y+l*d*r+n*c*p-n*d*m;this._43=-b*g*y+b*h*r+f*c*y-f*d*r-n*c*h+n*d*g;this._44=b*g*p-b*h*m-f*c*p+f*d*m+l*c*h-l*d*g;b=b*this._11+
c*this._21+d*this._31+e*this._41;1E-10>(0>b?-b:b)?this.zero():(b=1/b,this._11*=b,this._12*=b,this._13*=b,this._14*=b,this._21*=b,this._22*=b,this._23*=b,this._24*=b,this._31*=b,this._32*=b,this._33*=b,this._34*=b,this._41*=b,this._42*=b,this._43*=b,this._44*=b)},initInverse3x3:function(a){var b=a._11,c=a._12,d=a._13,e=a._21,f=a._22,g=a._23,h=a._31,k=a._32;a=a._33;this._11=f*a-k*g;this._12=-c*a+k*d;this._13=c*g-f*d;this._21=-e*a+h*g;this._22=b*a-h*d;this._23=-b*g+e*d;this._31=e*k-h*f;this._32=-b*k+
h*c;this._33=b*f-e*c;b=b*this._11+c*this._21+d*this._31;1E-10>(0>b?-b:b)?this.zero():(b=1/b,this._11*=b,this._12*=b,this._13*=b,this._14=0,this._21*=b,this._22*=b,this._23*=b,this._24=0,this._31*=b,this._32*=b,this._33*=b,this._43=this._42=this._41=this._34=0,this._44=1)},front:function(){var a=this._11,b=this._12,c=this._13;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a=new I(a,b,c);b=a.x*a.x+a.y*a.y+a.z*a.z;b=1E-20>b?0:1/Math.sqrt(b);a.x*=b;a.y*=b;a.z*=b;return a},right:function(){var a=this._21,
b=this._22,c=this._23;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a=new I(a,b,c);b=a.x*a.x+a.y*a.y+a.z*a.z;b=1E-20>b?0:1/Math.sqrt(b);a.x*=b;a.y*=b;a.z*=b;return a},up:function(){var a=this._31,b=this._32,c=this._33;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);a=new I(a,b,c);b=a.x*a.x+a.y*a.y+a.z*a.z;b=1E-20>b?0:1/Math.sqrt(b);a.x*=b;a.y*=b;a.z*=b;return a},transpose:function(){var a=this._12;this._12=this._21;this._21=a;a=this._13;this._13=this._31;this._31=a;a=this._14;this._14=this._41;this._41=
a;a=this._23;this._23=this._32;this._32=a;a=this._24;this._24=this._42;this._42=a;a=this._34;this._34=this._43;this._43=a},clone:function(){var a=new ma;a._11=this._11;a._12=this._12;a._13=this._13;a._14=this._14;a._21=this._21;a._22=this._22;a._23=this._23;a._24=this._24;a._31=this._31;a._32=this._32;a._33=this._33;a._34=this._34;a._41=this._41;a._42=this._42;a._43=this._43;a._44=this._44;return a},load:function(a){this._11=a._11;this._12=a._12;this._13=a._13;this._14=a._14;this._21=a._21;this._22=
a._22;this._23=a._23;this._24=a._24;this._31=a._31;this._32=a._32;this._33=a._33;this._34=a._34;this._41=a._41;this._42=a._42;this._43=a._43;this._44=a._44},loadValues:function(a){this._11=a[0];this._12=a[1];this._13=a[2];this._14=a[3];this._21=a[4];this._22=a[5];this._23=a[6];this._24=a[7];this._31=a[8];this._32=a[9];this._33=a[10];this._34=a[11];this._41=a[12];this._42=a[13];this._43=a[14];this._44=a[15]},getFloats:function(){return[this._11,this._12,this._13,this._14,this._21,this._22,this._23,
this._24,this._31,this._32,this._33,this._34,this._41,this._42,this._43,this._44]},getDirection:function(){var a=new Hc;a.initRotateMatrix(this);a.normalize();var b=1-2*(a.y*a.y+a.z*a.z),c=2*(a.x*a.y+a.z*a.w);a=2*(a.x*a.z-a.y*a.w);null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,a)},getEulerAngles:function(){var a=this.clone();var b=Math.sqrt(this._11*this._11+this._12*this._12+this._13*this._13);var c=Math.sqrt(this._21*this._21+this._22*this._22+this._23*this._23);var d=Math.sqrt(this._31*
this._31+this._32*this._32+this._33*this._33);0>this._11*(this._22*this._33-this._23*this._32)+this._12*(this._23*this._31-this._21*this._33)+this._13*(this._21*this._32-this._22*this._31)&&(b*=-1,c*=-1,d*=-1);a.prependScale(1/b,1/c,1/d);var e=Math.sqrt(a._11*a._11+a._12*a._12);if(.01<e){var f=Math.atan2(a._23,a._33);d=Math.atan2(-a._13,e);c=Math.atan2(a._12,a._11);null==c&&(c=0);null==d&&(d=0);null==f&&(f=0);b=new I(f,d,c);f=Math.atan2(-a._23,-a._33);d=Math.atan2(-a._13,-e);c=Math.atan2(-a._12,-a._11);
null==c&&(c=0);null==d&&(d=0);null==f&&(f=0);a=new I(f,d,c);return b.x*b.x+b.y*b.y+b.z*b.z<a.x*a.x+a.y*a.y+a.z*a.z?b:a}f=Math.atan2(-a._32,a._22);d=Math.atan2(-a._13,e);c=0;null==c&&(c=0);null==d&&(d=0);null==f&&(f=0);return new I(f,d,c)},toString:function(){return"MAT=[\n  [ "+X.fmt(this._11)+", "+X.fmt(this._12)+", "+X.fmt(this._13)+", "+X.fmt(this._14)+" ]\n  [ "+X.fmt(this._21)+", "+X.fmt(this._22)+", "+X.fmt(this._23)+", "+X.fmt(this._24)+" ]\n  [ "+X.fmt(this._31)+", "+X.fmt(this._32)+", "+
X.fmt(this._33)+", "+X.fmt(this._34)+" ]\n  [ "+X.fmt(this._41)+", "+X.fmt(this._42)+", "+X.fmt(this._43)+", "+X.fmt(this._44)+" ]\n]"},colorHue:function(a){if(0!=a){var b=Math.cos(-a);a=Math.sin(-a);var c=(1-b)/3,d=ma.tmp;d._11=b+c;d._12=c-.5773502691896257*a;d._13=c+.5773502691896257*a;d._21=c+.5773502691896257*a;d._22=b+c;d._23=c-.5773502691896257*a;d._31=c-.5773502691896257*a;d._32=c+.5773502691896257*a;d._33=b+c;d._34=0;d._41=0;d._42=0;d._43=0;this.multiply3x4(this,d)}},colorSaturate:function(a){++a;
var b=1-a,c=.212671*b,d=.71516*b;b*=.072169;var e=ma.tmp;e._11=c+a;e._12=c;e._13=c;e._21=d;e._22=d+a;e._23=d;e._31=b;e._32=b;e._33=b+a;e._41=0;e._42=0;e._43=0;this.multiply3x4(this,e)},colorContrast:function(a){var b=ma.tmp,c=a+1;b._11=c;b._12=0;b._13=0;b._21=0;b._22=c;b._23=0;b._31=0;b._32=0;b._33=c;b._41=.5*-a;b._42=.5*-a;b._43=.5*-a;this.multiply3x4(this,b)},colorLightness:function(a){this._41+=a;this._42+=a;this._43+=a},colorGain:function(a,b){var c=ma.tmp;c._11=1-b;c._12=0;c._13=0;c._21=0;c._22=
1-b;c._23=0;c._31=0;c._32=0;c._33=1-b;c._41=(a>>16&255)/255*b;c._42=(a>>8&255)/255*b;c._43=(a&255)/255*b;this.multiply3x4(this,c)},colorBits:function(a,b){var c=0,d=0,e=0,f=0,g=0,h=0,k=0,l=0,m=0;1==(a&1)&&(c=1);a>>=1;1==(a&1)&&(d=1);a>>=1;1==(a&1)&&(e=1);a>>=1;1==(a&1)&&(f=1);a>>=1;1==(a&1)&&(g=1);a>>=1;1==(a&1)&&(h=1);a>>=1;1==(a&1)&&(k=1);a>>=1;1==(a&1)&&(l=1);1==(a>>1&1)&&(m=1);a=c+f+k;var p=d+g+l,t=e+h+m;1<a&&(c/=a,f/=a,k/=a);1<p&&(d/=p,g/=p,l/=p);1<t&&(e/=t,h/=t,m/=t);a=this._11*d+this._12*g+
this._13*l;p=this._11*e+this._12*h+this._13*m;t=this._21*c+this._22*f+this._23*k;var n=this._21*d+this._22*g+this._23*l,r=this._21*e+this._22*h+this._23*m,y=this._31*c+this._32*f+this._33*k;d=this._31*d+this._32*g+this._33*l;e=this._31*e+this._32*h+this._33*m;h=1-b;this._11=this._11*h+(this._11*c+this._12*f+this._13*k)*b;this._12=this._12*h+a*b;this._13=this._13*h+p*b;this._21=this._21*h+t*b;this._22=this._22*h+n*b;this._23=this._23*h+r*b;this._31=this._31*h+y*b;this._32=this._32*h+d*b;this._33=this._33*
h+e*b},colorAdd:function(a){this._41+=(a>>16&255)/255;this._42+=(a>>8&255)/255;this._43+=(a&255)/255},colorSet:function(a,b){null==b&&(b=1);this.zero();this._44=b;this._41+=(a>>16&255)/255;this._42+=(a>>8&255)/255;this._43+=(a&255)/255},adjustColor:function(a){null!=a.hue&&this.colorHue(a.hue);null!=a.saturation&&this.colorSaturate(a.saturation);null!=a.contrast&&this.colorContrast(a.contrast);null!=a.lightness&&this.colorLightness(a.lightness);null!=a.gain&&this.colorGain(a.gain.color,a.gain.alpha)},
toMatrix2D:function(a){null==a&&(a=new yc);a.a=this._11;a.b=this._12;a.c=this._21;a.d=this._22;a.x=this._41;a.y=this._42;return a},decomposeMatrix:function(a){this.load(a);var b=Math.sqrt(this._11*this._11+this._12*this._12+this._13*this._13);var c=Math.sqrt(this._21*this._21+this._22*this._22+this._23*this._23);var d=Math.sqrt(this._31*this._31+this._32*this._32+this._33*this._33);0>this._11*(this._22*this._33-this._23*this._32)+this._12*(this._23*this._31-this._21*this._33)+this._13*(this._21*this._32-
this._22*this._31)&&(b*=-1,c*=-1,d*=-1);this.prependScale(1/b,1/c,1/d);var e=this._11+this._22+this._33;if(0<e){var f=2*Math.sqrt(e+1);var g=1/f;e=(this._23-this._32)*g;var h=(this._31-this._13)*g;var k=(this._12-this._21)*g;g=.25*f}else this._11>this._22&&this._11>this._33?(f=2*Math.sqrt(1+this._11-this._22-this._33),g=1/f,e=.25*f,h=(this._21+this._12)*g,k=(this._31+this._13)*g,g*=this._23-this._32):this._22>this._33?(f=2*Math.sqrt(1+this._22-this._11-this._33),g=1/f,e=(this._21+this._12)*g,h=.25*
f,k=(this._32+this._23)*g,g*=this._31-this._13):(f=2*Math.sqrt(1+this._33-this._11-this._22),g=1/f,e=(this._31+this._13)*g,h=(this._32+this._23)*g,k=.25*f,g*=this._12-this._21);this._11=b;this._12=e;this._13=h;this._14=0;this._21=k;this._22=c;this._23=g;this._32=this._31=this._24=0;this._33=d;this._34=0;this._41=a._41;this._42=a._42;this._43=a._43;this._44=1},recomposeMatrix:function(a){var b=a._11;var c=a._22;var d=a._33;var e=a._41;var f=a._42;var g=a._43;var h=a._12,k=a._13,l=a._21;a=a._23;null==
a&&(a=1);null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);var m=h,p=k,t=a;a=this;null==a&&(a=new ma);k=m*m;h=m*p;var n=m*l;m*=t;var r=p*p,y=p*l;p*=t;var G=l*l;l*=t;a._11=1-2*(r+G);a._12=2*(h+l);a._13=2*(n-p);a._14=0;a._21=2*(h-l);a._22=1-2*(k+G);a._23=2*(y+m);a._24=0;a._31=2*(n+p);a._32=2*(y-m);a._33=1-2*(k+r);a._34=0;a._41=0;a._42=0;a._43=0;a._44=1;this._11*=b;this._12*=b;this._13*=b;this._21*=c;this._22*=c;this._23*=c;this._31*=d;this._32*=d;this._33*=d;this._41=e;this._42=f;this._43=g},__class__:ma};
var Ac={_new:function(){return new ma},multiplied:function(a,b){var c=new ma;c.multiply(a,b);return c},I:function(){var a=new ma;a.identity();return a},L:function(a){var b=new ma;b.loadValues(a);return b},T:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=new ma;d.initTranslation(a,b,c);return d},R:function(a,b,c){var d=new ma;d.initRotation(a,b,c);return d},S:function(a,b,c){null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);var d=new ma;d.initScale(a,b,c);return d},lookAtXInline:function(a,
b,c){var d=a,e=d.x*d.x+d.y*d.y+d.z*d.z;e=1E-20>e?0:1/Math.sqrt(e);var f=d.x*e,g=d.y*e;e*=d.z;null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);a=f;var h=g,k=e;d=b;f=d.y*k-d.z*h;g=d.z*a-d.x*k;e=d.x*h-d.y*a;null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);b=f;d=g;var l=e;e=b*b+d*d+l*l;e=1E-20>e?0:1/Math.sqrt(e);f=b*e;g=d*e;e*=l;null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);b=
f;d=g;l=e;1E-20>b*b+d*d+l*l&&(b=h,d=k,l=a);f=h*l-k*d;g=k*b-a*l;e=a*d-h*b;null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);null==g&&(g=0);null==f&&(f=0);c._11=a;c._12=h;c._13=k;c._14=0;c._21=b;c._22=d;c._23=l;c._24=0;c._31=f;c._32=g;c._33=e;c._34=0;c._41=0;c._42=0;c._43=0;c._44=1;return c},lookAtX:function(a,b,c){var d;if(null==b){var e=d=0;var f=1;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=new I(d,e,f)}null==c&&(c=new ma);var g=a;f=g.x*g.x+g.y*g.y+g.z*g.z;f=1E-20>f?0:1/Math.sqrt(f);
d=g.x*f;e=g.y*f;f*=g.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);a=d;var h=e,k=f;g=b;d=g.y*k-g.z*h;e=g.z*a-g.x*k;f=g.x*h-g.y*a;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;g=e;var l=f;f=b*b+g*g+l*l;f=1E-20>f?0:1/Math.sqrt(f);d=b*f;e=g*f;f*=l;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;g=e;l=f;1E-20>b*b+g*g+l*l&&(b=h,g=k,l=a);d=h*l-k*g;e=k*b-a*l;f=a*g-h*
b;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c._11=a;c._12=h;c._13=k;c._14=0;c._21=b;c._22=g;c._23=l;c._24=0;c._31=d;c._32=e;c._33=f;c._34=0;c._41=0;c._42=0;c._43=0;c._44=1;return c}},Hc=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d};z["h3d.Quat"]=Hc;Hc.__name__="h3d.Quat";Hc.prototype={set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d},identity:function(){this.x=this.y=this.z=
0;this.w=1},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},load:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w},clone:function(){return new Hc(this.x,this.y,this.z,this.w)},initMoveTo:function(a,b){var c=a.x+b.x,d=a.y+b.y;b=a.z+b.z;this.x=a.y*b-a.z*d;this.y=a.z*c-a.x*b;this.z=a.x*d-a.y*c;this.w=a.x*c+a.y*d+a.z*b;this.normalize()},initNormal:function(a,b){null==
b&&(b=0);var c=a.x*a.x+a.y*a.y+a.z*a.z;c=1E-20>c?0:1/Math.sqrt(c);var d=a.x*c;var e=a.y*c;c*=a.z;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);a=d;var f=e,g=c;if(1E-20>a*a+f*f)d=1,c=e=0,null==c&&(c=0),null==e&&(e=0),null==d&&(d=0),this.initDirection(new I(d,e,c));else{d=a;e=f;c=0;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);var h=c;c=d*d+e*e+h*h;c=1E-20>c?0:1/Math.sqrt(c);d*=c;e*=c;c*=h;null==c&&(c=0);null==e&&
(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);h=d;var k=e;e=c;d=f*e-g*k;e=g*h-a*e;c=a*k-f*h;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);h=d;k=e;e=c;d=f*e-g*k;e=g*h-a*e;c=a*k-f*h;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);h=new I(d,e,c);0>g?(e=d=0,c=-1,null==c&&(c=0),null==e&&(e=0),null==d&&(d=0),this.initDirection(h,new I(d,e,c))):this.initDirection(h)}0!=
b&&(d=new Hc,d.initRotateAxis(a,f,g,b),this.multiply(d,this))},initDirection:function(a,b){var c=a;var d=c.x;var e=c.y;var f=c.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);var g=d;a=e;var h=f;f=g*g+a*a+h*h;f=1E-20>f?0:1/Math.sqrt(f);d=g*f;e=a*f;f*=h;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);g=d;a=e;h=f;d=-a;e=g;f=0;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);
c=d;var k=e;var l=f;null!=b&&(c=b,d=c.y*h-c.z*a,e=c.z*g-c.x*h,f=c.x*a-c.y*g,null==f&&(f=0),null==e&&(e=0),null==d&&(d=0),null==f&&(f=0),null==e&&(e=0),null==d&&(d=0),c=d,k=e,l=f);f=c*c+k*k+l*l;f=1E-20>f?0:1/Math.sqrt(f);c*=f;k*=f;l*=f;1E-20>c*c+k*k+l*l&&(c=a,k=h,l=g);d=a*l-h*k;e=h*c-g*l;f=g*k-a*c;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;d=g+k+f;0<d?(k=2*Math.sqrt(d+1),g=1/k,this.x=(l-e)*g,this.y=(b-h)*g,this.z=(a-c)*g,this.w=.25*k):g>k&&g>f?(k=
2*Math.sqrt(1+g-k-f),g=1/k,this.x=.25*k,this.y=(c+a)*g,this.z=(b+h)*g,this.w=(l-e)*g):k>f?(k=2*Math.sqrt(1+k-g-f),g=1/k,this.x=(c+a)*g,this.y=.25*k,this.z=(e+l)*g,this.w=(b-h)*g):(k=2*Math.sqrt(1+f-g-k),g=1/k,this.x=(b+h)*g,this.y=(e+l)*g,this.z=.25*k,this.w=(a-c)*g)},initRotateAxis:function(a,b,c,d){var e=Math.sin(d/2);d=Math.cos(d/2);this.x=a*e;this.y=b*e;this.z=c*e;this.w=d*Math.sqrt(a*a+b*b+c*c);this.normalize()},initRotateMatrix:function(a){var b=a._11+a._22+a._33;if(0<b){var c=2*Math.sqrt(b+
1);b=1/c;this.x=(a._23-a._32)*b;this.y=(a._31-a._13)*b;this.z=(a._12-a._21)*b;this.w=.25*c}else a._11>a._22&&a._11>a._33?(c=2*Math.sqrt(1+a._11-a._22-a._33),b=1/c,this.x=.25*c,this.y=(a._21+a._12)*b,this.z=(a._31+a._13)*b,this.w=(a._23-a._32)*b):a._22>a._33?(c=2*Math.sqrt(1+a._22-a._11-a._33),b=1/c,this.x=(a._21+a._12)*b,this.y=.25*c,this.z=(a._32+a._23)*b,this.w=(a._31-a._13)*b):(c=2*Math.sqrt(1+a._33-a._11-a._22),b=1/c,this.x=(a._31+a._13)*b,this.y=(a._32+a._23)*b,this.z=.25*c,this.w=(a._12-a._21)*
b)},normalize:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;1E-20>a?(this.x=this.y=this.z=0,this.w=1):(a=1/Math.sqrt(a),this.x*=a,this.y*=a,this.z*=a,this.w*=a)},initRotation:function(a,b,c){var d=Math.sin(.5*a);a=Math.cos(.5*a);var e=Math.sin(.5*b);b=Math.cos(.5*b);var f=Math.sin(.5*c);c=Math.cos(.5*c);var g=b*c,h=e*f;this.x=d*g-a*h;this.y=a*e*c+d*b*f;this.z=a*b*f-d*e*c;this.w=a*g+d*h},multiply:function(a,b){var c=a.w*b.y-a.x*b.z+a.y*b.w+a.z*b.x,d=a.w*b.z+a.x*b.y-a.y*b.x+
a.z*b.w,e=a.w*b.w-a.x*b.x-a.y*b.y-a.z*b.z;this.x=a.x*b.w+a.w*b.x+a.y*b.z-a.z*b.y;this.y=c;this.z=d;this.w=e},toEuler:function(){return this.toMatrix().getEulerAngles()},lerp:function(a,b,c,d){null==d&&(d=!1);var e=1-c;d&&0>a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w&&(c=-c);d=a.y*e+b.y*c;var f=a.z*e+b.z*c,g=a.w*e+b.w*c;this.x=a.x*e+b.x*c;this.y=d;this.z=f;this.w=g},slerp:function(a,b,c){var d=a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w;if(1<=(0>d?-d:d))this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w;else{var e=Math.acos(d),
f=1/Math.sqrt(1-d*d);if(1E3<(0>f?-f:f)){var g=.5;d=!0;null==d&&(d=!1);c=1-g;d&&0>a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w&&(g=-g);d=a.y*c+b.y*g;e=a.z*c+b.z*g;f=a.w*c+b.w*g;this.x=a.x*c+b.x*g;this.y=d;this.z=e;this.w=f}else g=Math.sin((1-c)*e)*f,c=Math.sin(c*e)*f*(0>d?-1:1),this.x=a.x*g+b.x*c,this.y=a.y*g+b.y*c,this.z=a.z*g+b.z*c,this.w=a.w*g+b.w*c}},conjugate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z},pow:function(a){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);b=1E-10<b?Math.atan2(b,
this.w)/b:0;this.w=.5*Math.log(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.x*=b;this.y*=b;this.z*=b;this.x*=a;this.y*=a;this.z*=a;this.w*=a;b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);a=Math.exp(this.w);var c=1E-10<b?a*Math.sin(b)/b:0;this.w=a*Math.cos(b);this.x*=c;this.y*=c;this.z*=c},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},getDirection:function(){var a=1-2*(this.y*
this.y+this.z*this.z),b=2*(this.x*this.y+this.z*this.w),c=2*(this.x*this.z-this.y*this.w);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},getUpAxis:function(){var a=2*(this.x*this.z+this.y*this.w),b=2*(this.y*this.z-this.x*this.w),c=1-2*(this.x*this.x+this.y*this.y);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},toMatrix:function(a){null==a&&(a=new ma);var b=this.x*this.x,c=this.x*this.y,d=this.x*this.z,e=this.x*this.w,f=this.y*this.y,g=this.y*this.z,h=this.y*
this.w,k=this.z*this.z,l=this.z*this.w;a._11=1-2*(f+k);a._12=2*(c+l);a._13=2*(d-h);a._14=0;a._21=2*(c-l);a._22=1-2*(b+k);a._23=2*(g+e);a._24=0;a._31=2*(d+h);a._32=2*(g-e);a._33=1-2*(b+f);a._34=0;a._41=0;a._42=0;a._43=0;a._44=1;return a},toString:function(){return"{"+X.fmt(this.x)+","+X.fmt(this.y)+","+X.fmt(this.z)+","+X.fmt(this.w)+"}"},weightedBlend:function(a,b,c){this.w=this.z=this.y=this.x=0;var d=c.x,e=c.y,f=c.z,g=c.w;null==g&&(g=1);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);d=-d;e=-e;f=-f;
for(var h=0;h<a.length;){var k=a[h];var l=h++;l=b[l];var m=d*k.w+g*k.x+e*k.z-f*k.y;var p=g*k.y-d*k.z+e*k.w+f*k.x;var t=g*k.z+d*k.y-e*k.x+f*k.w;k=g*k.w-d*k.x-e*k.y-f*k.z;0>k&&(m=-m,p=-p,t=-t,k=-k);k*=l;m*=l;p*=l;t*=l;this.w+=k;this.x+=m;this.y+=p;this.z+=t}a=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;1E-20>a?(this.x=this.y=this.z=0,this.w=1):(a=1/Math.sqrt(a),this.x*=a,this.y*=a,this.z*=a,this.w*=a);m=c.x*this.w+c.w*this.x+c.y*this.z-c.z*this.y;p=c.w*this.y-c.x*this.z+c.y*this.w+c.z*this.x;
t=c.w*this.z+c.x*this.y-c.y*this.x+c.z*this.w;k=c.w*this.w-c.x*this.x-c.y*this.y-c.z*this.z;this.x=m;this.y=p;this.z=t;this.w=k;0>this.w&&(this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w)},__class__:Hc};var I=function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c};z["h3d.VectorImpl"]=I;I.__name__="h3d.VectorImpl";I.prototype={distance:function(a){var b=a.x-this.x,c=a.y-this.y;a=a.z-this.z;return Math.sqrt(b*b+c*c+a*a)},distanceSq:function(a){var b=a.x-
this.x,c=a.y-this.y;a=a.z-this.z;return b*b+c*c+a*a},sub:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,a)},add:function(a){var b=this.x+a.x,c=this.y+a.y;a=this.z+a.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,a)},scaled:function(a){var b=this.x*a,c=this.y*a;a*=this.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,a)},equals:function(a){return this.x==a.x&&this.y==a.y?this.z==a.z:!1},cross:function(a){var b=
this.y*a.z-this.z*a.y,c=this.z*a.x-this.x*a.z;a=this.x*a.y-this.y*a.x;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,a)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;a=1E-20>a?0:1/Math.sqrt(a);this.x*=a;this.y*=a;this.z*=a},normalized:function(){var a=this.x*
this.x+this.y*this.y+this.z*this.z;a=1E-20>a?0:1/Math.sqrt(a);var b=this.x*a,c=this.y*a;a*=this.z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,a)},packNormal:function(){this.x=.5*this.x+.5;this.y=.5*this.y+.5;this.z=.5*this.z+.5},unpackNormal:function(){this.x=2*this.x-1;this.y=2*this.y-1;this.z=2*this.z-1},normalStrength:function(a){a=1/a;this.x*=a;this.y*=a;a=this.x*this.x+this.y*this.y+this.z*this.z;a=1E-20>a?0:1/Math.sqrt(a);this.x*=a;this.y*=a;this.z*=a},set:function(a,b,c){null==
c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c},load:function(a){this.x=a.x;this.y=a.y;this.z=a.z},scale:function(a){this.x*=a;this.y*=a;this.z*=a},lerp:function(a,b,c){var d=a.x;this.x=d+c*(b.x-d);d=a.y;this.y=d+c*(b.y-d);d=a.z;this.z=d+c*(b.z-d)},transform:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32+a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+a._43;this.x=this.x*a._11+this.y*a._21+this.z*a._31+a._41;this.y=b;this.z=c},transformed:function(a){var b=this.x*a._11+
this.y*a._21+this.z*a._31+a._41,c=this.x*a._12+this.y*a._22+this.z*a._32+a._42;a=this.x*a._13+this.y*a._23+this.z*a._33+a._43;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,a)},transform3x3:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32,c=this.x*a._13+this.y*a._23+this.z*a._33;this.x=this.x*a._11+this.y*a._21+this.z*a._31;this.y=b;this.z=c},transformed3x3:function(a){var b=this.x*a._11+this.y*a._21+this.z*a._31,c=this.x*a._12+this.y*a._22+this.z*a._32;a=this.x*a._13+this.y*
a._23+this.z*a._33;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,a)},clone:function(){var a=this.x,b=this.y,c=this.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},toVector4:function(){var a=this.x,b=this.y,c=this.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new T(a,b,c,1)},to2D:function(){var a=this.x,b=this.y;null==b&&(b=0);null==a&&(a=0);return new ta(a,b)},toString:function(){return"{"+X.fmt(this.x)+","+X.fmt(this.y)+","+X.fmt(this.z)+"}"},reflect:function(a){var b=
2*(this.x*a.x+this.y*a.y+this.z*a.z),c=this.x-b*a.x,d=this.y-b*a.y;a=this.z-b*a.z;null==a&&(a=0);null==d&&(d=0);null==c&&(c=0);return new I(c,d,a)},project:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32+a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+a._43,d=1/(this.x*a._14+this.y*a._24+this.z*a._34+a._44);this.x=(this.x*a._11+this.y*a._21+this.z*a._31+a._41)*d;this.y=b*d;this.z=c*d},get_r:function(){return this.x},get_g:function(){return this.y},get_b:function(){return this.z},set_r:function(a){return this.x=
a},set_g:function(a){return this.y=a},set_b:function(a){return this.z=a},setColor:function(a){this.x=(a>>16&255)/255;this.y=(a>>8&255)/255;this.z=(a&255)/255},makeColor:function(a,b,c){null==c&&(c=.5);null==b&&(b=1);a%=6.283185307179586;a=0<=a?a:a+6.283185307179586;var d=2*c-1;b*=1-(0>d?-d:d);d=3*a/3.141592653589793%2-1;d=b*(1-(0>d?-d:d));c-=b/2;1.0471975511965976>a?(this.x=b,this.y=d,this.z=0):2.0943951023931953>a?(this.x=d,this.y=b,this.z=0):3.141592653589793>a?(this.x=0,this.y=b,this.z=d):4.1887902047863905>
a?(this.x=0,this.y=d,this.z=b):5.235987755982989>a?(this.x=d,this.y=0,this.z=b):(this.x=b,this.y=0,this.z=d);this.x+=c;this.y+=c;this.z+=c},toColor:function(){var a=this.x,b=this.y,c=this.z;return-16777216|(255*(0>a?0:1<a?1:a)+.499|0)<<16|(255*(0>b?0:1<b?1:b)+.499|0)<<8|255*(0>c?0:1<c?1:c)+.499|0},toColorHSL:function(){var a=this.x,b=this.y;a=a<b?b:a;b=this.z;var c=a<b?b:a;a=this.x;b=this.y;a=a>b?b:a;b=this.z;a=a>b?b:a;b=(c+a)/2;if(c==a)c=a=0;else{var d=c-a;a=.5<b?d/(2-c-a):d/(c+a);c=c==this.x?(this.y-
this.z)/d+(this.y<this.z?6:0):c==this.y?(this.z-this.x)/d+2:(this.x-this.y)/d+4;c*=1.0471975511965976}null==b&&(b=0);null==a&&(a=0);null==c&&(c=0);return new I(c,a,b)},toColorHSV:function(){var a=this.x,b=this.y;a=a<b?b:a;b=this.z;var c=a<b?b:a;a=this.x;b=this.y;a=a>b?b:a;b=this.z;b=a>b?b:a;c==b?a=b=0:(a=c-b,b=1<c+b?a/(2-c-b):a/(c+b),a=c==this.x?(this.y-this.z)/a+(this.y<this.z?6:0):c==this.y?(this.z-this.x)/a+2:(this.x-this.y)/a+4,a*=1.0471975511965976);null==c&&(c=0);null==b&&(b=0);null==a&&(a=
0);return new I(a,b,c)},__class__:I};var T=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d};z["h3d.Vector4Impl"]=T;T.__name__="h3d.Vector4Impl";T.prototype={dot4:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},dot3:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},scale3:function(a){this.x*=a;this.y*=a;this.z*=a},scale4:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a},sub:function(a){var b=this.x-a.x,c=this.y-
a.y,d=this.z-a.z;a=this.w-a.w;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new T(b,c,d,a)},add:function(a){var b=this.x+a.x,c=this.y+a.y,d=this.z+a.z;a=this.w+a.w;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new T(b,c,d,a)},equals:function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z?this.w==a.w:!1},cross:function(a){var b=this.y*a.z-this.z*a.y,c=this.z*a.x-this.x*a.z;a=this.x*a.y-this.y*a.x;var d=1;null==d&&(d=1);null==a&&(a=0);null==c&&(c=0);null==
b&&(b=0);return new T(b,c,a,d)},set:function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.w=d},load:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w},lerp:function(a,b,c){var d=a.x;this.x=d+c*(b.x-d);d=a.y;this.y=d+c*(b.y-d);d=a.z;this.z=d+c*(b.z-d);d=a.w;this.w=d+c*(b.w-d)},transform:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32+this.w*a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43,d=this.x*a._14+this.y*a._24+
this.z*a._34+this.w*a._44;this.x=this.x*a._11+this.y*a._21+this.z*a._31+this.w*a._41;this.y=b;this.z=c;this.w=d},transformed:function(a){var b=this.x*a._11+this.y*a._21+this.z*a._31+this.w*a._41,c=this.x*a._12+this.y*a._22+this.z*a._32+this.w*a._42,d=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43;a=this.x*a._14+this.y*a._24+this.z*a._34+this.w*a._44;null==a&&(a=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new T(b,c,d,a)},transform3x4:function(a){var b=this.x*a._12+this.y*a._22+this.z*
a._32+this.w*a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43;this.x=this.x*a._11+this.y*a._21+this.z*a._31+this.w*a._41;this.y=b;this.z=c},transformed3x4:function(a){var b=this.x*a._11+this.y*a._21+this.z*a._31+this.w*a._41,c=this.x*a._12+this.y*a._22+this.z*a._32+this.w*a._42;a=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new T(b,c,a,1)},transform3x3:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32,c=this.x*a._13+this.y*
a._23+this.z*a._33;this.x=this.x*a._11+this.y*a._21+this.z*a._31;this.y=b;this.z=c},transformed3x3:function(a){var b=this.x*a._11+this.y*a._21+this.z*a._31,c=this.x*a._12+this.y*a._22+this.z*a._32;a=this.x*a._13+this.y*a._23+this.z*a._33;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new T(b,c,a,1)},clone:function(){var a=this.x,b=this.y,c=this.z,d=this.w;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new T(a,b,c,d)},toVector:function(){var a=this.x,b=this.y,c=this.z;null==
c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},toString:function(){return"{"+X.fmt(this.x)+","+X.fmt(this.y)+","+X.fmt(this.z)+","+X.fmt(this.w)+"}"},project:function(a){var b=this.x*a._12+this.y*a._22+this.z*a._32+this.w*a._42,c=this.x*a._13+this.y*a._23+this.z*a._33+this.w*a._43,d=1/(this.x*a._14+this.y*a._24+this.z*a._34+this.w*a._44);this.x=(this.x*a._11+this.y*a._21+this.z*a._31+this.w*a._41)*d;this.y=b*d;this.z=c*d;this.w=1},get_r:function(){return this.x},get_g:function(){return this.y},
get_b:function(){return this.z},get_a:function(){return this.w},set_r:function(a){return this.x=a},set_g:function(a){return this.y=a},set_b:function(a){return this.z=a},set_a:function(a){return this.w=a},setColor:function(a){this.x=(a>>16&255)/255;this.y=(a>>8&255)/255;this.z=(a&255)/255;this.w=(a>>>24)/255},makeColor:function(a,b,c){null==c&&(c=.5);null==b&&(b=1);a%=6.283185307179586;a=0<=a?a:a+6.283185307179586;var d=2*c-1;b*=1-(0>d?-d:d);d=3*a/3.141592653589793%2-1;d=b*(1-(0>d?-d:d));c-=b/2;1.0471975511965976>
a?(this.x=b,this.y=d,this.z=0):2.0943951023931953>a?(this.x=d,this.y=b,this.z=0):3.141592653589793>a?(this.x=0,this.y=b,this.z=d):4.1887902047863905>a?(this.x=0,this.y=d,this.z=b):5.235987755982989>a?(this.x=d,this.y=0,this.z=b):(this.x=b,this.y=0,this.z=d);this.x+=c;this.y+=c;this.z+=c;this.w=1},toColor:function(){var a=this.w,b=this.x,c=this.y,d=this.z;return(255*(0>a?0:1<a?1:a)+.499|0)<<24|(255*(0>b?0:1<b?1:b)+.499|0)<<16|(255*(0>c?0:1<c?1:c)+.499|0)<<8|255*(0>d?0:1<d?1:d)+.499|0},toColorHSL:function(){var a=
this.x,b=this.y;a=a<b?b:a;b=this.z;var c=a<b?b:a;a=this.x;b=this.y;a=a>b?b:a;b=this.z;a=a>b?b:a;b=(c+a)/2;if(c==a)c=a=0;else{var d=c-a;a=.5<b?d/(2-c-a):d/(c+a);c=c==this.x?(this.y-this.z)/d+(this.y<this.z?6:0):c==this.y?(this.z-this.x)/d+2:(this.x-this.y)/d+4;c*=1.0471975511965976}d=this.w;null==d&&(d=1);null==b&&(b=0);null==a&&(a=0);null==c&&(c=0);return new T(c,a,b,d)},toColorHSV:function(){var a=this.x,b=this.y;a=a<b?b:a;b=this.z;var c=a<b?b:a;a=this.x;b=this.y;a=a>b?b:a;b=this.z;a=a>b?b:a;c==
a?b=a=0:(b=c-a,a=1<c+a?b/(2-c-a):b/(c+a),b=c==this.x?(this.y-this.z)/b+(this.y<this.z?6:0):c==this.y?(this.z-this.x)/b+2:(this.x-this.y)/b+4,b*=1.0471975511965976);var d=this.w;null==d&&(d=1);null==c&&(c=0);null==a&&(a=0);null==b&&(b=0);return new T(b,a,c,d)},__class__:T};var Dd=function(a){this.objectName=a};z["h3d.anim.AnimatedObject"]=Dd;Dd.__name__="h3d.anim.AnimatedObject";Dd.prototype={clone:function(){return new Dd(this.objectName)},__class__:Dd};var Ic=function(a,b,c){this.name=a;this.frameCount=
b;this.sampling=c;this.objects=[];this.lastEvent=-1;this.frame=0;this.speed=1;this.loop=!0;this.pause=!1};z["h3d.anim.Animation"]=Ic;Ic.__name__="h3d.anim.Animation";Ic.prototype={getDuration:function(){return this.frameCount/(this.sampling*this.speed)},frameToTime:function(a){return a/(this.sampling*this.speed)},getIFrame:function(){var a=this.frame|0,b=this.endFrame();a==b&&--a;return a},unbind:function(a){for(var b=0,c=this.objects;b<c.length;){var d=c[b];++b;if(d.objectName==a){this.isSync=!1;
d.targetObject=null;d.targetSkin=null;break}}},setEvents:function(a){for(var b=[],c=0,d=this.frameCount;c<d;)c++,b.push(null);this.events=b;for(a=qa(a);a.hasNext();)b=a.next(),null==this.events[b.frame]&&(this.events[b.frame]=[]),this.events[b.frame].push(b.data)},addEvent:function(a,b){null==this.events&&(this.events=[]);null==this.events[a]?this.events[a]=[b]:this.events[a].push(b)},removeEvent:function(a,b){if(null==this.events||null==this.events[a]||-1==this.events[a].indexOf(b))throw u.thrown("Can't delete event "+
b+" because it doesn't exist at frame "+a);D.remove(this.events[a],b);0==this.events[a].length&&(this.events[a]=null)},getEvents:function(){return this.events},getObjects:function(){return this.objects},getEventTime:function(a){if(null==this.events)return null;for(var b=0,c=this.events.length;b<c;){var d=b++,e=this.events[d];if(null!=e&&0<=e.indexOf(a))return d/(this.sampling*this.speed)}return null},setFrame:function(a){this.frame=a;for(this.lastEvent=-1;0>this.frame;)this.frame+=this.frameCount;
for(;this.frame>this.frameCount;)this.frame-=this.frameCount},clone:function(a){null==a&&(a=new Ic(this.name,this.frameCount,this.sampling));a.objects=this.objects;a.speed=this.speed;a.loop=this.loop;a.pause=this.pause;a.events=this.events;a.resourcePath=this.resourcePath;return a},initInstance:function(){this.isInstance=!0},createInstance:function(a){for(var b,c=[],d=0,e=this.objects;d<e.length;)b=e[d],++d,c.push(b.clone());b=this.clone();b.objects=c;b.bind(a);b.initInstance();return b},bind:function(a){for(var b=
null,c=0,d=this.objects.slice();c<d.length;){var e=d[c];++c;if(null!=b){var f=b.skinData.namedJoints.h[e.objectName];if(null!=f){e.targetSkin=b;e.targetJoint=f.index;continue}}f=a.getObjectByName(e.objectName);if(null==f)D.remove(this.objects,e);else{var g=f instanceof sf?f:null;null!=g?(b=g.parent,e.targetSkin=null!=b?b:g.skin,e.targetJoint=g.index):e.targetObject=f}}this.isSync=!1},getPropValue:function(a,b){return null},sync:function(a){throw u.thrown("assert");},isPlaying:function(){return this.pause?
!1:1E-6<(0>this.speed?-this.speed:this.speed)},endFrame:function(){return this.frameCount},update:function(a){if(!this.isInstance)throw u.thrown("You must instantiate this animation first");if(!this.isPlaying())return 0;if(null!=this.events&&null!=this.onEvent){var b=this.frame|0,c=this.frame+a*this.speed*this.sampling|0;c>=this.frameCount&&(c=this.frameCount-1);for(var d=c+1;b<d;)if(c=b++,c!=this.lastEvent&&(this.lastEvent=c,null!=this.events[c])){b=this.frame;d=a;a-=(c-this.frame)/(this.speed*this.sampling);
this.frame=c;for(var e=0,f=this.events[c];e<f.length;){var g=f[e];++e;this.onEvent(g)}if(this.frame==c&&c==this.frameCount-1){this.frame=b;a=d;break}else return a}}if(null!=this.onAnimEnd&&(c=this.endFrame(),b=0==this.speed?0:(c-this.frame)/(this.speed*this.sampling),b<=a&&0<b))return this.frame=c,a-=b,this.onAnimEnd(),this.frame==c&&this.isPlaying()&&(this.loop?this.frame=0:a=0),a;this.frame+=a*this.speed*this.sampling;this.frame>=this.frameCount&&(this.frame=this.loop?this.frame%this.frameCount:
this.frameCount);return 0},initAndBind:function(a){this.bind(a);this.initInstance();this.pause=!0},toString:function(){return this.name},__class__:Ic};var Ea=L["h3d.anim.DataLayout"]={__ename__:!0,__constructs__:null,Position:{_hx_name:"Position",_hx_index:0,__enum__:"h3d.anim.DataLayout",toString:v},Rotation:{_hx_name:"Rotation",_hx_index:1,__enum__:"h3d.anim.DataLayout",toString:v},Scale:{_hx_name:"Scale",_hx_index:2,__enum__:"h3d.anim.DataLayout",toString:v},UV:{_hx_name:"UV",_hx_index:3,__enum__:"h3d.anim.DataLayout",
toString:v},Alpha:{_hx_name:"Alpha",_hx_index:4,__enum__:"h3d.anim.DataLayout",toString:v},Property:{_hx_name:"Property",_hx_index:5,__enum__:"h3d.anim.DataLayout",toString:v},SingleFrame:{_hx_name:"SingleFrame",_hx_index:6,__enum__:"h3d.anim.DataLayout",toString:v}};Ea.__constructs__=[Ea.Position,Ea.Rotation,Ea.Scale,Ea.UV,Ea.Alpha,Ea.Property,Ea.SingleFrame];Ea.__empty_constructs__=[Ea.Position,Ea.Rotation,Ea.Scale,Ea.UV,Ea.Alpha,Ea.Property,Ea.SingleFrame];var hg=function(a,b){this.objectName=
a;this.dataOffset=b};z["h3d.anim.BufferObject"]=hg;hg.__name__="h3d.anim.BufferObject";hg.__super__=Dd;hg.prototype=J(Dd.prototype,{getStride:function(){var a=0;0!=(this.layout&1<<Ea.Position._hx_index)&&(a+=3);0!=(this.layout&1<<Ea.Rotation._hx_index)&&(a+=3);0!=(this.layout&1<<Ea.Scale._hx_index)&&(a+=3);0!=(this.layout&1<<Ea.UV._hx_index)&&(a+=2);0!=(this.layout&1<<Ea.Alpha._hx_index)&&++a;0!=(this.layout&1<<Ea.Property._hx_index)&&++a;return a},clone:function(){var a=new hg(this.objectName,this.dataOffset);
a.layout=this.layout;a.propName=this.propName;return a},__class__:hg});var tf=function(a,b,c){Ic.call(this,a,b,c);this.syncFrame=-1};z["h3d.anim.BufferAnimation"]=tf;tf.__name__="h3d.anim.BufferAnimation";tf.__super__=Ic;tf.prototype=J(Ic.prototype,{setData:function(a,b){this.data=a;this.stride=b},addObject:function(a,b){a=new hg(a,b);this.objects.push(a);return a},getPropValue:function(a,b){for(var c=0,d=this.objects;c<d.length;){var e=d[c];++c;if(e.objectName==a&&e.propName==b)return e.propCurrentValue}return null},
getFrames:function(){return this.objects},clone:function(a){null==a&&(a=new tf(this.name,this.frameCount,this.sampling));Ic.prototype.clone.call(this,a);(a instanceof tf?a:null).setData(this.data,this.stride);return a},endFrame:function(){return this.loop?this.frameCount:this.frameCount-1},initInstance:function(){Ic.prototype.initInstance.call(this);for(var a=this.objects,b=0;b<a.length;){var c=a[b];++b;0!=(c.layout&1<<Ea.Property._hx_index)&&(c.propCurrentValue=this.data[c.dataOffset]);if(0!=(c.layout&
1<<Ea.Alpha._hx_index))if(null!=c.targetObject){var d=c.targetObject;d=null==(d instanceof Ua?d:null)}else d=!0;else d=!1;if(d)throw u.thrown(c.objectName+" should be a mesh (for alpha animation)");if(0!=(c.layout&1<<Ea.Position._hx_index)||0!=(c.layout&1<<Ea.Rotation._hx_index)||0!=(c.layout&1<<Ea.Scale._hx_index))c.matrix=new ma,c.matrix.identity(),0==(c.layout&1<<Ea.Position._hx_index)&&null!=c.targetSkin&&(d=c.targetSkin.getSkinData().allJoints[c.targetJoint].defMat,c.matrix._14=d._41,c.matrix._24=
d._42,c.matrix._34=d._43)}a.sort(M(this,this.sortByFrameCountDesc))},sortByFrameCountDesc:function(a,b){return(0!=(b.layout&1<<Ea.SingleFrame._hx_index)?0:1)-(0!=(a.layout&1<<Ea.SingleFrame._hx_index)?0:1)},uvLerp:function(a,b,c){a%=1;b%=1;a<b-.5?++a:a>b+.5&&--a;return a*(1-c)+b*c},sync:function(a){null==a&&(a=!1);if(this.frame!=this.syncFrame||a){var b=this.frame|0;var c=this.endFrame();b==c&&--b;c=b;var d=(c+1)%this.frameCount,e=this.frame-c,f=1-e;0>c?c=d=0:this.frame>=this.frameCount?c=d=this.frameCount-
1:this.loop||0!=d||(d=this.frameCount-1);this.syncFrame=this.frame;a&&(this.isSync=!1);for(var g=0,h=this.objects;g<h.length;){var k=h[g];++g;if(null!=k.targetObject||null!=k.targetSkin){var l=k.layout,m=this.stride*c+k.dataOffset,p=this.stride*d+k.dataOffset;if(0!=(l&1<<Ea.SingleFrame._hx_index)){if(this.isSync)break;m=p=k.dataOffset}var t=k.matrix;if(null!=t){var n=k.targetSkin;n=null!=n?n.skinData:null;if(null==n||n.allJoints[k.targetJoint].shouldReceiveAnimation())if(0!=(l&1<<Ea.Position._hx_index)?
(t._41=this.data[m++]*f+this.data[p++]*e,t._42=this.data[m++]*f+this.data[p++]*e,t._43=this.data[m++]*f+this.data[p++]*e):(t._41=t._14,t._42=t._24,t._43=t._34),0!=(l&1<<Ea.Rotation._hx_index)){var r=this.data[m++];n=this.data[m++];var y=this.data[m++];b=1-(r*r+n*n+y*y);b=Math.sqrt(0>b?-b:b);var G=this.data[p++],q=this.data[p++],u=this.data[p++],v=1-(G*G+q*q+u*u);v=Math.sqrt(0>v?-v:v);var w=0>r*G+n*q+y*u+b*v?-e:e;r=r*f+G*w;n=n*f+q*w;y=y*f+u*w;b=b*f+v*w;u=1/Math.sqrt(r*r+n*n+y*y+b*b);r*=u;n*=u;y*=u;
b*=u;if(a)t._12=r,t._13=n,t._21=y,t._23=b,0!=(l&1<<Ea.Scale._hx_index)?(t._11=this.data[m++]*f+this.data[p++]*e,t._22=this.data[m++]*f+this.data[p++]*e,t._33=this.data[m++]*f+this.data[p++]*e):(t._11=1,t._22=1,t._33=1);else{u=r*r;v=r*n;w=r*y;r*=b;q=n*n;G=n*y;n*=b;var x=y*y;y*=b;t._11=1-2*(q+x);t._12=2*(v+y);t._13=2*(w-n);t._21=2*(v-y);t._22=1-2*(u+x);t._23=2*(G+r);t._31=2*(w+n);t._32=2*(G-r);t._33=1-2*(u+q);0!=(l&1<<Ea.Scale._hx_index)&&(n=this.data[m++]*f+this.data[p++]*e,y=this.data[m++]*f+this.data[p++]*
e,r=this.data[m++]*f+this.data[p++]*e,t._11*=n,t._12*=n,t._13*=n,t._21*=y,t._22*=y,t._23*=y,t._31*=r,t._32*=r,t._33*=r)}}else t._12=0,t._13=0,t._21=0,t._23=a?1:0,0!=(l&1<<Ea.Scale._hx_index)?(t._11=this.data[m++]*f+this.data[p++]*e,t._22=this.data[m++]*f+this.data[p++]*e,t._33=this.data[m++]*f+this.data[p++]*e):(t._11=1,t._22=1,t._33=1);null!=k.targetSkin?(k.targetSkin.jointsData[k.targetJoint].currentRelPose=t,k.targetSkin.jointsUpdated=!0):(n=k.targetObject,n.defaultTransform=t,n.flags|=1,0!=(n.flags&
131072)&&(n.flags|=262144))}0!=(l&1<<Ea.UV._hx_index)&&(n=k.targetObject.toMesh().material,t=n.passes.getShader(Md),null==t&&(t=n.passes.addShader(new Md),n.get_texture().set_wrap(Fe.Repeat)),n=this.data[m++],y=this.data[p++],n%=1,y%=1,n<y-.5?++n:n>y+.5&&--n,t.uvDelta__.x=n*(1-e)+y*e,n=this.data[m++],y=this.data[p++],n%=1,y%=1,n<y-.5?++n:n>y+.5&&--n,t.uvDelta__.y=n*(1-e)+y*e);0!=(l&1<<Ea.Alpha._hx_index)&&(t=k.targetObject.toMesh().material,t.blendMode==xa.None&&t.set_blendMode(xa.Alpha),t.mshader.color__.w=
this.data[m++]*f+this.data[p++]*e);0!=(l&1<<Ea.Property._hx_index)&&(k.propCurrentValue=this.data[m++]*f+this.data[p++]*e)}}a||(this.isSync=!0)}},__class__:tf});var ni=function(){};z["h3d.anim.LinearFrame"]=ni;ni.__name__="h3d.anim.LinearFrame";ni.prototype={toMatrix:function(){var a=new ma;(new Hc(this.qx,this.qy,this.qz,this.qw)).toMatrix(a);a.prependScale(this.sx,this.sy,this.sz);a.translate(this.tx,this.ty,this.tz);return a},__class__:ni};var He=function(a){this.hasPosition=!0;this.objectName=
a};z["h3d.anim.LinearObject"]=He;He.__name__="h3d.anim.LinearObject";He.__super__=Dd;He.prototype=J(Dd.prototype,{clone:function(){var a=new He(this.objectName);a.hasPosition=this.hasPosition;a.hasRotation=this.hasRotation;a.hasScale=this.hasScale;a.frames=this.frames;a.alphas=this.alphas;a.uvs=this.uvs;a.propName=this.propName;a.propValues=this.propValues;return a},__class__:He});var ig=function(a,b,c){Ic.call(this,a,b,c);this.syncFrame=-1};z["h3d.anim.LinearAnimation"]=ig;ig.__name__="h3d.anim.LinearAnimation";
ig.__super__=Ic;ig.prototype=J(Ic.prototype,{addCurve:function(a,b,c,d,e){a=new He(a);a.frames=b;a.hasPosition=c;a.hasRotation=d;a.hasScale=e;this.objects.push(a)},addAlphaCurve:function(a,b){a=new He(a);a.alphas=b;this.objects.push(a)},addUVCurve:function(a,b){a=new He(a);a.uvs=b;this.objects.push(a)},addPropCurve:function(a,b,c){a=new He(a);a.propName=b;a.propValues=c;this.objects.push(a)},getPropValue:function(a,b){for(var c=0,d=this.objects;c<d.length;){var e=d[c];++c;if(e.objectName==a&&e.propName==
b)return e.propCurrentValue}return null},getFrames:function(){return this.objects},clone:function(a){null==a&&(a=new ig(this.name,this.frameCount,this.sampling));Ic.prototype.clone.call(this,a);return a},endFrame:function(){return this.loop?this.frameCount:this.frameCount-1},initInstance:function(){Ic.prototype.initInstance.call(this);for(var a=this.objects,b=0;b<a.length;){var c=a[b];++b;if(null!=c.propValues)c.propCurrentValue=c.propValues[0];else{if(null!=c.alphas)if(null!=c.targetObject){var d=
c.targetObject;d=null==(d instanceof Ua?d:null)}else d=!0;else d=!1;if(d)throw u.thrown(c.objectName+" should be a mesh (for alpha animation)");null==c.uvs&&null==c.alphas&&(c.matrix=new ma,c.matrix.identity())}}a.sort(M(this,this.sortByFrameCountDesc))},sortByFrameCountDesc:function(a,b){return(null==b.frames?10:b.frames.length)-(null==a.frames?10:a.frames.length)},uvLerp:function(a,b,c){a%=1;b%=1;a<b-.5?++a:a>b+.5&&--a;return a*(1-c)+b*c},sync:function(a){null==a&&(a=!1);if(this.frame!=this.syncFrame||
a){var b=this.frame|0;var c=this.endFrame();b==c&&--b;c=b;var d=(c+1)%this.frameCount,e=this.frame-c,f=1-e;0>c?c=d=0:this.frame>=this.frameCount?c=d=this.frameCount-1:this.loop||0!=d||(d=this.frameCount-1);this.syncFrame=this.frame;a&&(this.isSync=!1);for(var g=0,h=this.objects;g<h.length;)if(b=h[g],++g,null!=b.targetObject||null!=b.targetSkin)if(null!=b.alphas){var k=b.targetObject.toMesh().material;k.blendMode==xa.None&&k.set_blendMode(xa.Alpha);k.mshader.color__.w=b.alphas[c]*f+b.alphas[d]*e}else if(null!=
b.uvs){var l=b.targetObject.toMesh().material;k=l.passes.getShader(Md);null==k&&(k=l.passes.addShader(new Md),l.get_texture().set_wrap(Fe.Repeat));l=b.uvs[c<<1];var m=b.uvs[d<<1];l%=1;m%=1;l<m-.5?++l:l>m+.5&&--l;k.uvDelta__.x=l*(1-e)+m*e;l=b.uvs[c<<1|1];b=b.uvs[d<<1|1];l%=1;b%=1;l<b-.5?++l:l>b+.5&&--l;k.uvDelta__.y=l*(1-e)+b*e}else if(null!=b.propValues)b.propCurrentValue=b.propValues[c]*f+b.propValues[d]*e;else{k=c;l=d;if(1==b.frames.length){if(this.isSync)break;k=l=0}k=b.frames[k];m=b.frames[l];
l=b.matrix;l._41=k.tx*f+m.tx*e;l._42=k.ty*f+m.ty*e;l._43=k.tz*f+m.tz*e;if(b.hasRotation){var p=0>k.qx*m.qx+k.qy*m.qy+k.qz*m.qz+k.qw*m.qw?-e:e,t=k.qx*f+m.qx*p,n=k.qy*f+m.qy*p,r=k.qz*f+m.qz*p;p=k.qw*f+m.qw*p;var y=1/Math.sqrt(t*t+n*n+r*r+p*p);t*=y;n*=y;r*=y;p*=y;if(a)l._12=t,l._13=n,l._21=r,l._23=p,b.hasScale?(l._11=k.sx*f+m.sx*e,l._22=k.sy*f+m.sy*e,l._33=k.sz*f+m.sz*e):(l._11=1,l._22=1,l._33=1);else{y=t*t;var G=t*n,q=t*r;t*=p;var u=n*n,v=n*r;n*=p;var w=r*r;r*=p;l._11=1-2*(u+w);l._12=2*(G+r);l._13=
2*(q-n);l._21=2*(G-r);l._22=1-2*(y+w);l._23=2*(v+t);l._31=2*(q+n);l._32=2*(v-t);l._33=1-2*(y+u);b.hasScale&&(r=k.sx*f+m.sx*e,p=k.sy*f+m.sy*e,k=k.sz*f+m.sz*e,l._11*=r,l._12*=r,l._13*=r,l._21*=p,l._22*=p,l._23*=p,l._31*=k,l._32*=k,l._33*=k)}}else l._12=0,l._13=0,l._21=0,l._23=a?1:0,b.hasScale?(l._11=k.sx*f+m.sx*e,l._22=k.sy*f+m.sy*e,l._33=k.sz*f+m.sz*e):(l._11=1,l._22=1,l._33=1);null!=b.targetSkin?(b.targetSkin.jointsData[b.targetJoint].currentRelPose=b.matrix,b.targetSkin.jointsUpdated=!0):(k=b.targetObject,
k.defaultTransform=b.matrix,b=1,k.flags|=b,0!=(k.flags&131072)&&(k.flags|=262144))}a||(this.isSync=!0)}},__class__:ig});var uf=function(){this.splitIndex=this.bindIndex=-1;this.subs=[]};z["h3d.anim.Joint"]=uf;uf.__name__="h3d.anim.Joint";uf.prototype={shouldReceiveAnimation:function(){return!0},makeRuntimeData:function(){return new Ie},__class__:uf};var ae=function(){this.slackness=0;this.damping=this.stiffness=this.resistance=1;var a=0,b=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.lockAxis=
new I(a,b,c);this.additive=!1;c=b=a=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.globalForce=new I(a,b,c);uf.call(this)};z["h3d.anim.DynamicJoint"]=ae;ae.__name__="h3d.anim.DynamicJoint";ae.__super__=uf;ae.prototype=J(uf.prototype,{shouldReceiveAnimation:function(){return this.additive},makeRuntimeData:function(){return new Fa},__class__:ae});var oi=function(){};z["h3d.anim._Skin.Permut"]=oi;oi.__name__="h3d.anim._Skin.Permut";oi.prototype={__class__:oi};var pi=function(a,b){this.j=a;this.w=
b};z["h3d.anim._Skin.Influence"]=pi;pi.__name__="h3d.anim._Skin.Influence";pi.prototype={__class__:pi};var qi=function(a,b,c){this.name=a;this.vertexCount=b;this.bonesPerVertex=c;0<b&&(this.vertexJoints=Array(b*c),this.vertexWeights=Array(b*c),this.envelop=[])};z["h3d.anim.Skin"]=qi;qi.__name__="h3d.anim.Skin";qi.prototype={setJoints:function(a,b){this.rootJoints=b;this.allJoints=a;this.namedJoints=new La;for(b=0;b<a.length;){var c=a[b];++b;null!=c.name&&(this.namedJoints.h[c.name]=c)}},addInfluence:function(a,
b,c){var d=this.envelop[a];null==d&&(d=this.envelop[a]=[]);d.push(new pi(b,c))},sortInfluences:function(a,b){return b.w>a.w?1:-1},isSplit:function(){return null!=this.splitJoints},initWeights:function(){this.boundJoints=[];for(var a=0,b=0,c=this.vertexCount;b<c;){var d=b++;d=this.envelop[d];null==d&&(d=[]);xb.sort(d,M(this,this.sortInfluences));d.length>this.bonesPerVertex&&(d=d.slice(0,this.bonesPerVertex));for(var e=0,f=0;f<d.length;){var g=d[f];++f;e+=g.w}e=1/e;f=0;for(g=this.bonesPerVertex;f<
g;){var h=f++;h=d[h];null==h?(this.vertexJoints[a]=0,this.vertexWeights[a]=0):(-1==h.j.bindIndex&&(h.j.bindIndex=this.boundJoints.length,this.boundJoints.push(h.j)),this.vertexJoints[a]=h.j.bindIndex,this.vertexWeights[a]=h.w*e);++a}}this.envelop=null},sortByBindIndex:function(a,b){return a.bindIndex-b.bindIndex},isSub:function(a,b){for(var c=0,d=b.length,e=0;e<a.length;){var f=a[e];for(++e;f!=b[c++];)if(c>=d)return!1}return!0},merge:function(a){for(var b=0;b<a.length;){var c=a[b];++b;for(var d=0;d<
a.length;){var e=a[d];++d;if(c!=e&&c.material==e.material&&this.isSub(c.joints,e.joints)){b=0;for(d=c.triangles;b<d.length;){var f=d[b];++b;e.triangles.push(f)}D.remove(a,c);return!0}}}return!1},jointsDiff:function(a,b){for(var c=0,d=0,e=0,f=a.joints.length,g=b.joints.length;d<f&&e<g;){var h=a.joints[d],k=b.joints[e];h==k?(++d,++e):(++c,h.bindIndex<k.bindIndex?++d:++e)}return c+(f-d)+(g-e)},split:function(a,b,c){var d,e,f;if(null!=this.splitJoints)return!0;if(this.boundJoints.length<=a)return!1;this.splitJoints=
[];this.triangleGroups=Array(b.length/3|0);var g=[];var h=0;for(e=b.length/3|0;h<e;){var k=h++;var l=3*k;var m=null==c?0:c[k];var p=[];for(d=0;3>d;){var t=d++;var n=b[l+t];var r=0;for(f=this.bonesPerVertex;r<f;)t=r++,t=n*this.bonesPerVertex+t,0!=this.vertexWeights[t]&&(t=this.boundJoints[this.vertexJoints[t]],t.splitIndex!=l&&(t.splitIndex=l,p.push(t)))}p.sort(M(this,this.sortByBindIndex));for(l=0;l<g.length;)if(f=g[l],++l,f.material==m&&this.isSub(p,f.joints)){f.triangles.push(k);p=null;break}if(null!=
p){for(d=0;d<g.length;)if(r=g[d],++d,r.material==m&&this.isSub(r.joints,p)){r.joints=p;r.triangles.push(k);p=null;break}null!=p&&(d=new oi,d.joints=p,d.triangles=[k],d.material=m,g.push(d))}}for(;;){for(;this.merge(g););l=c=1E5;b=k=null;h=0;for(e=g.length;h<e;)if(t=h++,p=g[t],p.joints.length!=a)for(d=t+1,r=g.length;d<r;)t=d++,f=g[t],f.joints.length!=a&&p.material==f.material&&(t=this.jointsDiff(p,f),m=t+(p.joints.length+f.joints.length-t>>1),m>a||m>l||m==l&&t>c||(c=t,l=m,k=p,b=f));if(null==k)break;
e=k;r=b;f=0;for(l=e.joints;f<l.length;)d=l[f],++f,D.remove(r.joints,d),r.joints.push(d);r.joints.sort(M(this,this.sortByBindIndex));d=0;for(p=e.triangles;d<p.length;)h=p[d],++d,r.triangles.push(h);D.remove(g,e)}h=0;for(e=g.length;h<e;)for(t=h++,d=0,r=g[t].triangles;d<r.length;)k=r[d],++d,this.triangleGroups[k]=t;b=[];h=0;for(e=this.boundJoints;h<e.length;){t=e[h];++h;f=[];for(d=0;d<g.length;)r=g[d],++d,0<=r.joints.indexOf(t)&&f.push(r);b.push({j:t,pl:f,priority:0})}for(;;){b.sort(function(a,b){return b.pl.length+
100*b.priority-(a.pl.length+100*a.priority)});for(h=0;h<g.length;)r=g[h],++h,r.indexedJoints=[];h=!1;for(e=0;e<b.length;){t=b[e];++e;t.j.splitIndex=-1;d=0;for(r=a;d<r;){c=d++;k=!0;f=0;for(l=t.pl;f<l.length;)if(p=l[f],++f,null!=p.indexedJoints[c]){k=!1;break}if(k){t.j.splitIndex=c;d=0;for(p=t.pl;d<p.length;)f=p[d],++d,f.indexedJoints[c]=t.j;break}}if(0>t.j.splitIndex){t.priority++;if(10<t.priority)throw u.thrown("Failed to assign index while spliting skin");h=!0;break}}if(!h)break}this.splitJoints=
[];for(h=0;h<g.length;){r=g[h];++h;p=[];e=0;for(d=r.indexedJoints.length;e<d;)t=e++,t=r.indexedJoints[t],null==t&&(t=this.boundJoints[0]),p.push(t);this.splitJoints.push({material:r.material,joints:p})}h=0;for(e=this.vertexJoints.length;h<e;)t=h++,this.vertexJoints[t]=this.boundJoints[this.vertexJoints[t]].splitIndex;return!0},__class__:qi};var Jb=function(){};z["h3d.col.Collider"]=Jb;Jb.__name__="h3d.col.Collider";Jb.prototype={__class__:Jb};var fb=function(){this.xMin=1E20;this.xMax=-1E20;this.yMin=
1E20;this.yMax=-1E20;this.zMin=1E20;this.zMax=-1E20};z["h3d.col.Bounds"]=fb;fb.__name__="h3d.col.Bounds";fb.fromPoints=function(a,b){var c=new fb;c.xMin=a.x;c.yMin=a.y;c.zMin=a.z;c.xMax=b.x;c.yMax=b.y;c.zMax=b.z;return c};fb.fromValues=function(a,b,c,d,e,f){var g=new fb;g.xMin=a;g.yMin=b;g.zMin=c;g.xMax=a+d;g.yMax=b+e;g.zMax=c+f;return g};fb.__super__=Jb;fb.prototype=J(Jb.prototype,{inFrustum:function(a,b){if(null!=b)throw u.thrown("Not implemented");return a.hasBounds(this)},inSphere:function(a){var b=
a.x,c=a.y,d=a.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;d=this.xMin;var h=a.x,k=this.xMax;h=h>k?k:h;b=d<h?h:d;d=this.yMin;h=a.y;k=this.yMax;h=h>k?k:h;c=d<h?h:d;d=this.zMin;h=a.z;k=this.zMax;h=h>k?k:h;d=d<h?h:d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b-e;f=c-f;g=d-g;return e*e+f*f+g*g<a.r*a.r},testPlane:function(a){var b=a.nx,c=a.ny,d=a.nz,e=b*(this.xMax+this.xMin)+c*(this.yMax+this.yMin)+
d*(this.zMax+this.zMin);0>b&&(b=-b);0>c&&(c=-c);0>d&&(d=-d);return e+(b*(this.xMax-this.xMin)+c*(this.yMax-this.yMin)+d*(this.zMax-this.zMin))-2*a.d},rayIntersection:function(a,b){var c=(this.xMin-a.px)/a.lx,d=(this.yMin-a.py)/a.ly,e=(this.zMin-a.pz)/a.lz,f=(this.xMax-a.px)/a.lx,g=(this.yMax-a.py)/a.ly,h=(this.zMax-a.pz)/a.lz;a=c>f?f:c;b=d>g?g:d;var k=e>h?h:e;c=c<f?f:c;d=d<g?g:d;e=e<h?h:e;d=c>d?d:c;e=d>e?e:d;d=a<b?b:a;a=d<k?k:d;return e<a?-1:a},inFrustumDetails:function(a,b){null==b&&(b=!0);var c=
1;var d=a._14+a._11;var e=a._24+a._21;var f=a._34+a._31;var g=a._44+a._41;var h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0);d=a._14-a._11;e=a._24-a._21;f=a._34-a._31;g=a._44-a._41;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+f*
(0<f?this.zMin:this.zMax);0>h+g&&(c=0);d=a._14+a._12;e=a._24+a._22;f=a._34+a._32;g=a._44+a._42;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0);d=a._14-a._12;e=a._24-a._22;f=a._34-a._32;g=a._44-a._42;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:
this.yMax)+f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0);if(b){d=a._13;e=a._23;f=a._33;g=a._43;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0);d=a._14-a._13;e=a._24-a._23;f=a._34-a._33;g=a._44-a._43;h=d*(0<d?this.xMax:this.xMin)+e*(0<e?this.yMax:this.yMin)+f*(0<f?this.zMax:this.zMin);if(0>h+g)return-1;h=d*(0<d?this.xMin:this.xMax)+e*(0<e?this.yMin:this.yMax)+
f*(0<f?this.zMin:this.zMax);0>h+g&&(c=0)}return c},transform3x3:function(a){var b=this.xMin,c=this.yMin,d=this.zMin,e=this.xMax,f=this.yMax,g=this.zMax;this.xMin=1E20;this.xMax=-1E20;this.yMin=1E20;this.yMax=-1E20;this.zMin=1E20;this.zMax=-1E20;var h=b;var k=c;var l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);var m=l;l=h*a._11+k*a._21+m*a._31;var p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&
(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=c;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=f;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*
a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=f;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=c;
l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=c;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);
k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=f;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=f;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31;
p=h*a._12+k*a._22+m*a._32;m=h*a._13+k*a._23+m*a._33;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m)},transform:function(a){var b=this.xMin,c=this.yMin,d=this.zMin,e=this.xMax,f=this.yMax,g=this.zMax;this.xMin=1E20;this.xMax=-1E20;this.yMin=1E20;this.yMax=-1E20;this.zMin=1E20;this.zMax=-1E20;if(!(e<b&&f<c&&g<d)){var h=b;var k=c;var l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=
0);var m=l;l=h*a._11+k*a._21+m*a._31+a._41;var p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=c;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<
this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=f;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=b;k=f;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+
k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=c;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);
k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=c;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=f;l=d;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;
p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m);h=e;k=f;l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);m=l;l=h*a._11+k*a._21+m*a._31+a._41;p=h*a._12+k*a._22+m*a._32+a._42;m=h*a._13+k*a._23+m*a._33+a._43;h=l;k=p;h<this.xMin&&(this.xMin=h);h>this.xMax&&(this.xMax=h);k<this.yMin&&(this.yMin=k);k>this.yMax&&(this.yMax=
k);m<this.zMin&&(this.zMin=m);m>this.zMax&&(this.zMax=m)}},collide:function(a){return!(this.xMin>a.xMax||this.yMin>a.yMax||this.zMin>a.zMax||this.xMax<a.xMin||this.yMax<a.yMin||this.zMax<a.zMin)},contains:function(a){return a.x>=this.xMin&&a.x<this.xMax&&a.y>=this.yMin&&a.y<this.yMax&&a.z>=this.zMin?a.z<this.zMax:!1},containsBounds:function(a){return this.xMin<=a.xMin&&this.yMin<=a.yMin&&this.zMin<=a.zMin&&this.xMax>=a.xMax&&this.yMax>=a.yMax?this.zMax>=a.zMax:!1},containsSphere:function(a){return this.xMin<=
a.x-a.r&&this.yMin<=a.y-a.r&&this.zMin<=a.z-a.r&&this.xMax>=a.x+a.r&&this.yMax>=a.y+a.r?this.zMax>=a.z+a.r:!1},add:function(a){a.xMin<this.xMin&&(this.xMin=a.xMin);a.xMax>this.xMax&&(this.xMax=a.xMax);a.yMin<this.yMin&&(this.yMin=a.yMin);a.yMax>this.yMax&&(this.yMax=a.yMax);a.zMin<this.zMin&&(this.zMin=a.zMin);a.zMax>this.zMax&&(this.zMax=a.zMax)},addTransform:function(a,b){var c=new fb;c.xMin=a.xMin;c.xMax=a.xMax;c.yMin=a.yMin;c.yMax=a.yMax;c.zMin=a.zMin;c.zMax=a.zMax;c.transform(b);c.xMin<this.xMin&&
(this.xMin=c.xMin);c.xMax>this.xMax&&(this.xMax=c.xMax);c.yMin<this.yMin&&(this.yMin=c.yMin);c.yMax>this.yMax&&(this.yMax=c.yMax);c.zMin<this.zMin&&(this.zMin=c.zMin);c.zMax>this.zMax&&(this.zMax=c.zMax)},addPoint:function(a){a.x<this.xMin&&(this.xMin=a.x);a.x>this.xMax&&(this.xMax=a.x);a.y<this.yMin&&(this.yMin=a.y);a.y>this.yMax&&(this.yMax=a.y);a.z<this.zMin&&(this.zMin=a.z);a.z>this.zMax&&(this.zMax=a.z)},addPos:function(a,b,c){a<this.xMin&&(this.xMin=a);a>this.xMax&&(this.xMax=a);b<this.yMin&&
(this.yMin=b);b>this.yMax&&(this.yMax=b);c<this.zMin&&(this.zMin=c);c>this.zMax&&(this.zMax=c)},addSphere:function(a){var b=a.x,c=a.y,d=a.z;a=a.r;b-a<this.xMin&&(this.xMin=b-a);b+a>this.xMax&&(this.xMax=b+a);c-a<this.yMin&&(this.yMin=c-a);c+a>this.yMax&&(this.yMax=c+a);d-a<this.zMin&&(this.zMin=d-a);d+a>this.zMax&&(this.zMax=d+a)},addSpherePos:function(a,b,c,d){a-d<this.xMin&&(this.xMin=a-d);a+d>this.xMax&&(this.xMax=a+d);b-d<this.yMin&&(this.yMin=b-d);b+d>this.yMax&&(this.yMax=b+d);c-d<this.zMin&&
(this.zMin=c-d);c+d>this.zMax&&(this.zMax=c+d)},intersection:function(a,b){var c=a.xMin,d=b.xMin,e=c<d?d:c;c=a.yMin;d=b.yMin;var f=c<d?d:c;c=a.zMin;d=b.zMin;var g=c<d?d:c;c=a.xMax;d=b.xMax;var h=c>d?d:c;c=a.yMax;d=b.yMax;var k=c>d?d:c;c=a.zMax;d=b.zMax;this.xMin=e;this.xMax=h;this.yMin=f;this.yMax=k;this.zMin=g;this.zMax=c>d?d:c},offset:function(a,b,c){this.xMin+=a;this.xMax+=a;this.yMin+=b;this.yMax+=b;this.zMin+=c;this.zMax+=c},setMin:function(a){this.xMin=a.x;this.yMin=a.y;this.zMin=a.z},setMax:function(a){this.xMax=
a.x;this.yMax=a.y;this.zMax=a.z},load:function(a){this.xMin=a.xMin;this.xMax=a.xMax;this.yMin=a.yMin;this.yMax=a.yMax;this.zMin=a.zMin;this.zMax=a.zMax},scalePivot:function(a){this.xMin*=a;this.yMin*=a;this.zMin*=a;this.xMax*=a;this.yMax*=a;this.zMax*=a},scaleCenter:function(a){var b=.5*(this.xMax-this.xMin)*a,c=.5*(this.yMax-this.yMin)*a;a*=.5*(this.zMax-this.zMin);var d=.5*(this.xMax+this.xMin),e=.5*(this.yMax+this.yMin),f=.5*(this.zMax+this.zMin);this.xMin=d-b;this.yMin=e-c;this.zMin=f-a;this.xMax=
d+b;this.yMax=e+c;this.zMax=f+a},getMin:function(){var a=this.xMin,b=this.yMin,c=this.zMin;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},getCenter:function(){var a=.5*(this.xMin+this.xMax),b=.5*(this.yMin+this.yMax),c=.5*(this.zMin+this.zMax);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},getSize:function(){var a=this.xMax-this.xMin,b=this.yMax-this.yMin,c=this.zMax-this.zMin;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},getMax:function(){var a=
this.xMax,b=this.yMax,c=this.zMax;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},getVolume:function(){return(this.xMax-this.xMin)*(this.yMax-this.yMin)*(this.zMax-this.zMin)},get_xSize:function(){return this.xMax-this.xMin},get_ySize:function(){return this.yMax-this.yMin},get_zSize:function(){return this.zMax-this.zMin},set_xSize:function(a){this.xMax=this.xMin+a;return a},set_ySize:function(a){this.yMax=this.yMin+a;return a},set_zSize:function(a){this.zMax=this.zMin+a;return a},
isEmpty:function(){return this.xMax<this.xMin||this.yMax<this.yMin?!0:this.zMax<this.zMin},empty:function(){this.xMin=1E20;this.xMax=-1E20;this.yMin=1E20;this.yMax=-1E20;this.zMin=1E20;this.zMax=-1E20},all:function(){this.xMin=-1E20;this.xMax=1E20;this.yMin=-1E20;this.yMax=1E20;this.zMin=-1E20;this.zMax=1E20},clone:function(){var a=new fb;a.xMin=this.xMin;a.xMax=this.xMax;a.yMin=this.yMin;a.yMax=this.yMax;a.zMin=this.zMin;a.zMax=this.zMax;return a},toString:function(){var a=this.xMin,b=this.yMin,
c=this.zMin;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d="Bounds{"+w.string(new I(a,b,c))+",";a=this.xMax-this.xMin;b=this.yMax-this.yMin;c=this.zMax-this.zMin;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return d+w.string(new I(a,b,c))+"}"},toSphere:function(){var a=this.xMax-this.xMin,b=this.yMax-this.yMin,c=this.zMax-this.zMin;return new ud(.5*(this.xMin+this.xMax),.5*(this.yMin+this.yMax),.5*(this.zMin+this.zMax),.5*Math.sqrt(a*a+b*b+c*c))},dimension:function(){var a=this.xMax-this.xMin,
b=this.yMax-this.yMin,c=this.zMax-this.zMin;b=b<c?c:b;return a<b?b:a},closestPoint:function(a){throw u.thrown("Not implemented");},makeDebugObj:function(){var a=new ke(this.xMax-this.xMin,this.yMax-this.yMin,this.zMax-this.zMin);a.translate(this.xMin,this.yMin,this.zMin);a.addNormals();return new Ua(a)},__class__:fb});var vf=function(a,b){this.a=a;this.b=b};z["h3d.col.OptimizedCollider"]=vf;vf.__name__="h3d.col.OptimizedCollider";vf.__super__=Jb;vf.prototype=J(Jb.prototype,{rayIntersection:function(a,
b){if(0>this.a.rayIntersection(a,!1)){if(!this.checkInside)return-1;var c=a.px+0*a.lx,d=a.py+0*a.ly,e=a.pz+0*a.lz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);if(!this.a.contains(new I(c,d,e)))return-1}return this.b.rayIntersection(a,b)},contains:function(a){return this.a.contains(a)?this.b.contains(a):!1},inFrustum:function(a,b){return this.a.inFrustum(a,b)?this.b.inFrustum(a,b):!1},inSphere:function(a){return this.a.inSphere(a)?this.b.inSphere(a):!1},dimension:function(){return Math.max(this.a.dimension(),
this.b.dimension())},closestPoint:function(a){return this.b.closestPoint(a)},makeDebugObj:function(){var a=this.b.makeDebugObj(),b=this.a.makeDebugObj();if(null==b&&null==a)return null;var c=new Aa;null!=b&&c.addChild(b);null!=a&&c.addChild(a);return c},__class__:vf});var wf=function(a){this.colliders=a};z["h3d.col.GroupCollider"]=wf;wf.__name__="h3d.col.GroupCollider";wf.__super__=Jb;wf.prototype=J(Jb.prototype,{rayIntersection:function(a,b){for(var c=-1,d=0,e=this.colliders;d<e.length;){var f=e[d];
++d;f=f.rayIntersection(a,b);if(0<=f){if(!b)return f;if(0>c||f<c)c=f}}return c},contains:function(a){for(var b=0,c=this.colliders;b<c.length;){var d=c[b];++b;if(d.contains(a))return!0}return!1},inFrustum:function(a,b){for(var c=0,d=this.colliders;c<d.length;){var e=d[c];++c;if(e.inFrustum(a,b))return!0}return!1},inSphere:function(a){for(var b=0,c=this.colliders;b<c.length;){var d=c[b];++b;if(d.inSphere(a))return!0}return!1},dimension:function(){for(var a=-Infinity,b=0,c=this.colliders;b<c.length;){var d=
c[b];++b;a=Math.max(a,d.dimension())}return a},closestPoint:function(a){for(var b=null,c=Infinity,d=0,e=this.colliders;d<e.length;){var f=e[d];++d;var g=f=f.closestPoint(a),h=a.x-g.x,k=a.y-g.y;g=a.z-g.z;h=h*h+k*k+g*g;h<c&&(b=f,c=h)}return b},makeDebugObj:function(){for(var a=null,b=0,c=this.colliders;b<c.length;){var d=c[b];++b;d=d.makeDebugObj();null!=d&&(null==a&&(a=new Aa),a.addChild(d))}return a},__class__:wf});var Zc=function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=
b;this.z=c};z["h3d.col.FPoint"]=Zc;Zc.__name__="h3d.col.FPoint";Zc.prototype={set:function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c},sub:function(a){return new Zc(this.x-a.x,this.y-a.y,this.z-a.z)},add:function(a){return new Zc(this.x+a.x,this.y+a.y,this.z+a.z)},cross:function(a){return new Zc(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},distanceSq:function(a){var b=a.x-this.x,c=a.y-
this.y;a=a.z-this.z;return b*b+c*c+a*a},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalized:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;a=1E-20>a?0:1/Math.sqrt(a);return new Zc(this.x*a,this.y*a,this.z*a)},scaled:function(a){return new Zc(this.x*a,this.y*a,this.z*a)},toString:function(){return"FPoint{"+X.fmt(this.x)+","+X.fmt(this.y)+","+X.fmt(this.z)+"}"},__class__:Zc};var $g=function(a){this.checkNearFar=!0;this.pleft=new bb(1,0,0,0);this.pright=new bb(1,
0,0,0);this.ptop=new bb(1,0,0,0);this.pbottom=new bb(1,0,0,0);this.pnear=new bb(1,0,0,0);this.pfar=new bb(1,0,0,0);null!=a&&this.loadMatrix(a)};z["h3d.col.Frustum"]=$g;$g.__name__="h3d.col.Frustum";$g.prototype={clone:function(){var a=new $g,b=a.pleft,c=this.pleft;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.pright;c=this.pright;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.ptop;c=this.ptop;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.pbottom;c=this.pbottom;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.pnear;c=
this.pnear;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;b=a.pfar;c=this.pfar;b.nx=c.nx;b.ny=c.ny;b.nz=c.nz;b.d=c.d;a.checkNearFar=this.checkNearFar;return a},loadMatrix:function(a){var b=this.pleft,c=a._14+a._11,d=a._24+a._21,e=a._34+a._31,f=-(a._44+a._41);b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pright;c=a._14-a._11;d=a._24-a._21;e=a._34-a._31;f=a._41-a._44;b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.ptop;c=a._14-a._12;d=a._24-a._22;e=a._34-a._32;f=a._42-a._44;b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pbottom;c=a._14+a._12;d=a._24+
a._22;e=a._34+a._32;f=-(a._44+a._42);b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pnear;c=a._13;d=a._23;e=a._33;f=-a._43;b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pfar;c=a._14-a._13;d=a._24-a._23;e=a._34-a._33;f=a._43-a._44;b.nx=c;b.ny=d;b.nz=e;b.d=f;b=this.pleft;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=this.pright;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=this.ptop;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=
this.pbottom;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=this.pnear;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a;b=this.pfar;a=1/Math.sqrt(b.nx*b.nx+b.ny*b.ny+b.nz*b.nz);b.nx*=a;b.ny*=a;b.nz*=a;b.d*=a},transform:function(a){var b=new ma;b.initInverse(a);b.transpose();a=this.pleft;var c=a.nx,d=a.ny,e=a.nz,f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=
0);f=c;c=d;d=e;var h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;var k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pright;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+
h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.ptop;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pbottom;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);
null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pfar;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*
b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pnear;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pleft;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;
a=this.pright;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.ptop;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pbottom;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pnear;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pfar;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b},transform3x3:function(a){var b=new ma;b.initInverse3x3(a);
b.transpose();a=this.pleft;var c=a.nx,d=a.ny,e=a.nz,f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;var h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;var k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pright;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==
e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.ptop;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;
f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pbottom;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pfar;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&
(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pnear;c=a.nx;d=a.ny;e=a.nz;f=-a.d;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);g=f;null==g&&(g=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;c=d;d=e;h=g;e=f*b._11+c*b._21+d*b._31+h*b._41;g=f*b._12+c*b._22+d*b._32+h*b._42;k=
f*b._13+c*b._23+d*b._33+h*b._43;f=f*b._14+c*b._24+d*b._34+h*b._44;a.nx=e;a.ny=g;a.nz=k;a.d=-f;a=this.pleft;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pright;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.ptop;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pbottom;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pnear;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*
a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b;a=this.pfar;b=1/Math.sqrt(a.nx*a.nx+a.ny*a.ny+a.nz*a.nz);a.nx*=b;a.ny*=b;a.nz*=b;a.d*=b},hasPoint:function(a){var b=this.pleft;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=this.pright;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=this.ptop;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=this.pbottom;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;if(this.checkNearFar){b=this.pnear;if(0>b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=this.pfar;if(0>b.nx*a.x+b.ny*a.y+b.nz*
a.z-b.d)return!1}return!0},hasSphere:function(a){var b=a.x;var c=a.y;var d=a.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=d;null==e&&(e=0);null==c&&(c=0);null==b&&(b=0);d=b;b=c;c=this.pleft;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;c=this.pright;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;c=this.ptop;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;c=this.pbottom;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;if(this.checkNearFar){c=this.pnear;if(c.nx*d+c.ny*b+c.nz*e-c.d<-a.r)return!1;c=this.pfar;if(c.nx*
d+c.ny*b+c.nz*e-c.d<-a.r)return!1}return!0},hasBounds:function(a){var b=this.pleft;var c=b.nx;var d=b.ny;var e=b.nz;var f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1;b=this.pright;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1;b=
this.ptop;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1;b=this.pbottom;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1;if(this.checkNearFar){b=this.pnear;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+
e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1;b=this.pfar;c=b.nx;d=b.ny;e=b.nz;f=c*(a.xMax+a.xMin)+d*(a.yMax+a.yMin)+e*(a.zMax+a.zMin);0>c&&(c=-c);0>d&&(d=-d);0>e&&(e=-e);e=c*(a.xMax-a.xMin)+d*(a.yMax-a.yMin)+e*(a.zMax-a.zMin);if(0>f+e-2*b.d)return!1}return!0},hasOrientedBounds:function(a){var b=this.pleft;var c=b.nx;var d=b.ny;var e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=
0);null==c&&(c=0);var f=c;var g=d;var h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var k=c;var l=d;var m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var p=c;var t=d;var n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var r=c;var y=d;var q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==
d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*t+h*n;q=f*r+g*y+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;b=this.pright;c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&
(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;t=d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);r=c;y=d;q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*t+h*n;q=f*r+g*y+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;b=this.ptop;c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);
null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;t=d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);r=c;y=d;q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&
(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*t+h*n;q=f*r+g*y+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;b=this.pbottom;c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=
0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;t=d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);r=c;y=d;q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*t+h*n;q=f*r+g*y+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;if(this.checkNearFar){b=this.pnear;
c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;t=d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);r=c;y=d;q=e;c=a.centerX;
d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*t+h*n;q=f*r+g*y+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1;b=this.pfar;c=b.nx;d=b.ny;e=b.nz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);f=c;g=d;h=e;c=a.xx;d=a.xy;e=a.xz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);k=c;l=d;m=e;c=
a.yx;d=a.yy;e=a.yz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);p=c;t=d;n=e;c=a.zx;d=a.zy;e=a.zz;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);r=c;y=d;q=e;c=a.centerX;d=a.centerY;e=a.centerZ;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);m=f*k+g*l+h*m;n=f*p+g*t+h*n;q=f*r+g*y+h*q;q=a.hx*(0>m?-m:m)+a.hy*(0>n?-n:n)+a.hz*(0>q?-q:q);h=f*c+g*d+h*e-b.d;if(0>h+q)return!1}return!0},
__class__:$g};var Pb=function(){};z["h3d.col.Ray"]=Pb;Pb.__name__="h3d.col.Ray";Pb.fromPoints=function(a,b){var c=new Pb;c.px=a.x;c.py=a.y;c.pz=a.z;c.lx=b.x-a.x;c.ly=b.y-a.y;c.lz=b.z-a.z;c.normalize();return c};Pb.fromValues=function(a,b,c,d,e,f){var g=new Pb;g.px=a;g.py=b;g.pz=c;g.lx=d;g.ly=e;g.lz=f;g.normalize();return g};Pb.prototype={clone:function(){var a=new Pb;a.px=this.px;a.py=this.py;a.pz=this.pz;a.lx=this.lx;a.ly=this.ly;a.lz=this.lz;return a},load:function(a){this.px=a.px;this.py=a.py;
this.pz=a.pz;this.lx=a.lx;this.ly=a.ly;this.lz=a.lz},normalize:function(){var a=this.lx*this.lx+this.ly*this.ly+this.lz*this.lz;1!=a&&(a=1E-20>a?0:1/Math.sqrt(a),this.lx*=a,this.ly*=a,this.lz*=a)},transform:function(a){var b=this.px,c=this.py,d=this.pz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=c,f=d;d=b*a._11+e*a._21+f*a._31+a._41;c=b*a._12+e*a._22+f*a._32+a._42;b=b*a._13+e*a._23+f*a._33+a._43;this.px=d;this.py=c;this.pz=b;b=this.lx;c=this.ly;
d=this.lz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=c;f=d;d=b*a._11+e*a._21+f*a._31;c=b*a._12+e*a._22+f*a._32;b=b*a._13+e*a._23+f*a._33;this.lx=d;this.ly=c;this.lz=b;this.normalize()},getPos:function(){var a=this.px,b=this.py,c=this.pz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},getDir:function(){var a=this.lx,b=this.ly,c=this.lz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},getPoint:function(a){var b=this.px+
a*this.lx,c=this.py+a*this.ly;a=this.pz+a*this.lz;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,a)},toString:function(){var a=this.px,b=this.py,c=this.pz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d="Ray{"+w.string(new I(a,b,c))+",";a=this.lx;b=this.ly;c=this.lz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return d+w.string(new I(a,b,c))+"}"},distance:function(a){var b=this.lx*a.nx+this.ly*a.ny+this.lz*a.nz;a=a.d-(this.px*a.nx+this.py*a.ny+this.pz*a.nz);return 1E-10>(0>b?-b:
b)?1E-10>(0>a?-a:a)?0:-1:a/b},intersect:function(a){var b=this.lx*a.nx+this.ly*a.ny+this.lz*a.nz;a=a.d-(this.px*a.nx+this.py*a.ny+this.pz*a.nz);if(1E-10>(0>b?-b:b)){if(1E-10>(0>a?-a:a)){a=this.px;b=this.py;var c=this.pz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)}return null}c=a/b;a=this.px+this.lx*c;b=this.py+this.ly*c;c=this.pz+this.lz*c;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},collideFrustum:function(a){var b=this.px,c=this.py,d=this.pz;null==d&&(d=
0);null==c&&(c=0);null==b&&(b=0);var e=c;null==d&&(d=0);null==e&&(e=0);null==b&&(b=0);var f=b,g=e,h=d;e=f*a._11+g*a._21+h*a._31+a._41;b=f*a._12+g*a._22+h*a._32+a._42;d=f*a._13+g*a._23+h*a._33+a._43;c=1/(f*a._14+g*a._24+h*a._34+a._44);f=e*c;g=b*c;h=d*c;b=this.px+this.lx;c=this.py+this.ly;d=this.pz+this.lz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=c;null==d&&(d=0);null==e&&(e=0);null==b&&(b=0);c=b;var k=e,l=d;e=c*a._11+k*a._21+l*a._31+a._41;b=c*a._12+k*a._22+l*a._32+a._42;d=c*a._13+k*a._23+l*a._33+
a._43;c=1/(c*a._14+k*a._24+l*a._34+a._44);e=1/(e*c-f);b=1/(b*c-g);c=1/(d*c-h);a=(-1-f)*e;f=(1-f)*e;d=(-1-g)*b;g=(1-g)*b;b=(0-h)*c;c*=1-h;k=a>f?f:a;e=d>g?g:d;k=k<e?e:k;e=b>c?c:b;h=k<e?e:k;k=a<f?f:a;e=d<g?g:d;k=k>e?e:k;e=b<c?c:b;g=k>e?e:k;return!(0>g||h>g)},collide:function(a){var b=1/this.lx,c=1/this.ly,d=1/this.lz,e=(a.xMin-this.px)*b;b*=a.xMax-this.px;var f=(a.yMin-this.py)*c;c*=a.yMax-this.py;var g=(a.zMin-this.pz)*d,h=(a.zMax-this.pz)*d,k=e>b?b:e;a=f>c?c:f;k=k<a?a:k;a=g>h?h:g;d=k<a?a:k;k=e<b?b:
e;a=f<c?c:f;k=k>a?a:k;a=g<h?h:g;a=k>a?a:k;return 0>a?!1:d>a?!1:!0},__class__:Pb};var Bc=function(a,b){this.obj=a;this.collider=b};z["h3d.col.ObjectCollider"]=Bc;Bc.__name__="h3d.col.ObjectCollider";Bc.__super__=Jb;Bc.prototype=J(Jb.prototype,{rayIntersection:function(a,b){var c=Bc.TMP_RAY;Bc.TMP_RAY=null;c.px=a.px;c.py=a.py;c.pz=a.pz;c.lx=a.lx;c.ly=a.ly;c.lz=a.lz;var d=this.obj.getInvPos(),e=a.px,f=a.py,g=a.pz;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var h=e;e=f;f=g;null==f&&(f=0);null==e&&(e=
0);null==h&&(h=0);g=h;h=e;var k=f;e=g*d._11+h*d._21+k*d._31+d._41;f=g*d._12+h*d._22+k*d._32+d._42;g=g*d._13+h*d._23+k*d._33+d._43;a.px=e;a.py=f;a.pz=g;e=a.lx;f=a.ly;g=a.lz;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);h=e;e=f;f=g;null==f&&(f=0);null==e&&(e=0);null==h&&(h=0);g=h;h=e;k=f;e=g*d._11+h*d._21+k*d._31;f=g*d._12+h*d._22+k*d._32;g=g*d._13+h*d._23+k*d._33;a.lx=e;a.ly=f;a.lz=g;a.normalize();d=this.collider.rayIntersection(a,b);if(0>d)return a.px=c.px,a.py=c.py,a.pz=c.pz,a.lx=c.lx,a.ly=c.ly,a.lz=
c.lz,Bc.TMP_RAY=c,d;e=a.px+d*a.lx;f=a.py+d*a.ly;g=a.pz+d*a.lz;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);h=e;e=f;f=g;null==f&&(f=0);null==e&&(e=0);null==h&&(h=0);b=h;g=e;h=f;d=this.obj.absPos;e=b*d._11+g*d._21+h*d._31+d._41;f=b*d._12+g*d._22+h*d._32+d._42;g=b*d._13+g*d._23+h*d._33+d._43;a.px=c.px;a.py=c.py;a.pz=c.pz;a.lx=c.lx;a.ly=c.ly;a.lz=c.lz;Bc.TMP_RAY=c;c=e-a.px;d=f-a.py;a=g-a.pz;null==a&&(a=0);null==a&&(a=0);return Math.sqrt(c*c+d*d+a*a)},contains:function(a){var b=a,c=b.x,d=b.y,e=b.z;null==
e&&(e=0);null==d&&(d=0);null==c&&(c=0);b=d;var f=e;null==f&&(f=0);null==b&&(b=0);null==c&&(c=0);d=c;e=b;c=f;b=this.obj.getInvPos();f=a.x*b._12+a.y*b._22+a.z*b._32+b._42;var g=a.x*b._13+a.y*b._23+a.z*b._33+b._43;a.x=a.x*b._11+a.y*b._21+a.z*b._31+b._41;a.y=f;a.z=g;f=this.collider.contains(a);b=a;b.x=d;b.y=e;b.z=c;return f},inFrustum:function(a,b){if(null==b)return this.collider.inFrustum(a,this.obj.getAbsPos());var c=Bc.TMP_MAT,d=this.obj.getAbsPos(),e=b._11,f=b._12,g=b._13,h=b._21,k=b._22,l=b._23,
m=b._31,p=b._32,t=b._33,n=b._41,r=b._42;b=b._43;var y=d._11,q=d._12,u=d._13,v=d._21,w=d._22,x=d._23,z=d._31,A=d._32,B=d._33,C=d._41,E=d._42;d=d._43;c._11=e*y+f*v+g*z;c._12=e*q+f*w+g*A;c._13=e*u+f*x+g*B;c._14=0;c._21=h*y+k*v+l*z;c._22=h*q+k*w+l*A;c._23=h*u+k*x+l*B;c._24=0;c._31=m*y+p*v+t*z;c._32=m*q+p*w+t*A;c._33=m*u+p*x+t*B;c._34=0;c._41=n*y+r*v+b*z+C;c._42=n*q+r*w+b*A+E;c._43=n*u+r*x+b*B+d;c._44=1;return this.collider.inFrustum(a,c)},inSphere:function(a){var b=this.obj.getInvPos(),c=a.x,d=a.y,e=
a.z,f=a.r,g=a.x,h=a.y,k=a.z;null==k&&(k=0);null==h&&(h=0);null==g&&(g=0);var l=h;null==k&&(k=0);null==l&&(l=0);null==g&&(g=0);h=g;var m=k;k=h*b._11+l*b._21+m*b._31+b._41;g=h*b._12+l*b._22+m*b._32+b._42;h=h*b._13+l*b._23+m*b._33+b._43;l=Math.sqrt(b._11*b._11+b._12*b._12+b._13*b._13);m=Math.sqrt(b._21*b._21+b._22*b._22+b._23*b._23);var p=Math.sqrt(b._31*b._31+b._32*b._32+b._33*b._33);0>b._11*(b._22*b._33-b._23*b._32)+b._12*(b._23*b._31-b._21*b._33)+b._13*(b._21*b._32-b._22*b._31)&&(l*=-1,m*=-1,p*=-1);
a.x=k;a.y=g;a.z=h;a.r*=Math.max(Math.max(l,m),p);b=this.collider.inSphere(a);a.x=c;a.y=d;a.z=e;a.r=f;return b},dimension:function(){var a=this.obj.getAbsPos();var b=Math.sqrt(a._11*a._11+a._12*a._12+a._13*a._13);var c=Math.sqrt(a._21*a._21+a._22*a._22+a._23*a._23);var d=Math.sqrt(a._31*a._31+a._32*a._32+a._33*a._33);0>a._11*(a._22*a._33-a._23*a._32)+a._12*(a._23*a._31-a._21*a._33)+a._13*(a._21*a._32-a._22*a._31)&&(b*=-1,c*=-1,d*=-1);return this.collider.dimension()*Math.max(Math.max(b,c),d)},closestPoint:function(a){throw u.thrown("Not implemented");
},makeDebugObj:function(){var a=this.collider.makeDebugObj();null!=a&&a.set_follow(this.obj);return a},__class__:Bc});var ri=function(){this.hx=this.hy=this.hz=.5;this.zz=1;this.yz=this.zx=this.zy=0;this.yy=1;this.xy=this.xz=this.yx=0;this.xx=1;this.centerX=this.centerY=this.centerZ=0};z["h3d.col.OrientedBounds"]=ri;ri.__name__="h3d.col.OrientedBounds";ri.__super__=Jb;ri.prototype=J(Jb.prototype,{setMatrix:function(a){var b=Math.sqrt(a._11*a._11+a._12*a._12+a._13*a._13);var c=Math.sqrt(a._21*a._21+
a._22*a._22+a._23*a._23);var d=Math.sqrt(a._31*a._31+a._32*a._32+a._33*a._33);0>a._11*(a._22*a._33-a._23*a._32)+a._12*(a._23*a._31-a._21*a._33)+a._13*(a._21*a._32-a._22*a._31)&&(b*=-1,c*=-1,d*=-1);var e=1/b,f=1/c,g=1/d;this.centerX=a._41;this.centerY=a._42;this.centerZ=a._43;this.hx=b/2;this.hy=c/2;this.hz=d/2;this.xx=a._11*e;this.xy=a._12*e;this.xz=a._13*e;this.yx=a._21*f;this.yy=a._22*f;this.yz=a._23*f;this.zx=a._31*g;this.zy=a._32*g;this.zz=a._33*g},setEulerAngles:function(a,b,c){var d=Math.cos(a);
a=Math.sin(a);var e=Math.cos(b);b=Math.sin(b);var f=Math.cos(c);c=Math.sin(c);this.xx=e*f;this.xy=a*b*f+d*c;this.xz=-d*b*f+a*c;this.yx=-e*c;this.yy=-a*b*c+d*f;this.yz=d*b*c+a*f;this.zx=b;this.zy=-a*e;this.zz=d*e},collideOrientedBounds:function(a){var b=this.xx,c=this.xy,d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&
(b=0);var h=b,k=c,l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=b,p=c,t=d;b=a.xx;c=a.xy;d=a.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=b,r=c,y=d;b=a.yx;c=a.yy;d=a.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var q=b,u=c,v=d;b=a.zx;c=a.zy;d=a.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&
(c=0);null==b&&(b=0);var w=e*n+f*r+g*y,x=e*q+f*u+g*v,z=e*b+f*c+g*d,A=h*n+k*r+l*y,B=h*q+k*u+l*v,C=h*b+k*c+l*d;n=m*n+p*r+t*y;q=m*q+p*u+t*v;u=m*b+p*c+t*d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);v=b;r=c;y=d;b=a.centerX;c=a.centerY;d=a.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b-=v;c-=r;d-=y;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);h=b*h+c*k+d*l;m=b*m+c*p+d*t;b=b*e+c*f+d*g;c=h;d=m;e=(0>w?-w:w)+1E-10;f=(0>x?-x:x)+1E-10;g=(0>z?-z:z)+1E-10;m=(0>A?-A:A)+1E-10;p=(0>B?-B:B)+1E-10;t=(0>C?-C:C)+1E-10;h=(0>n?-n:n)+1E-10;k=(0>q?-q:q)+1E-10;l=(0>u?-u:u)+1E-10;v=this.hx;r=a.hx*e+a.hy*f+a.hz*g;y=b;if((0>y?-y:y)>v+r)return!1;v=this.hy;r=a.hx*m+a.hy*p+a.hz*t;y=c;if((0>y?-y:y)>v+r)return!1;v=this.hz;r=a.hx*h+a.hy*k+a.hz*l;y=d;if((0>y?-y:y)>v+r)return!1;v=this.hx*e+this.hy*m+this.hz*h;r=a.hx;y=b*w+c*A+d*n;if((0>y?-y:
y)>v+r)return!1;v=this.hx*f+this.hy*p+this.hz*k;r=a.hy;y=b*x+c*B+d*q;if((0>y?-y:y)>v+r)return!1;v=this.hx*g+this.hy*t+this.hz*l;r=a.hz;y=b*z+c*C+d*u;if((0>y?-y:y)>v+r)return!1;v=this.hy*h+this.hz*m;r=a.hy*g+a.hz*f;y=d*A-c*n;if((0>y?-y:y)>v+r)return!1;v=this.hy*k+this.hz*p;r=a.hx*g+a.hz*e;y=d*B-c*q;if((0>y?-y:y)>v+r)return!1;v=this.hy*l+this.hz*t;r=a.hx*f+a.hy*e;y=d*C-c*u;if((0>y?-y:y)>v+r)return!1;v=this.hx*h+this.hz*e;r=a.hy*t+a.hz*p;y=b*n-d*w;if((0>y?-y:y)>v+r)return!1;v=this.hx*k+this.hz*f;r=a.hx*
t+a.hz*m;y=b*q-d*x;if((0>y?-y:y)>v+r)return!1;v=this.hx*l+this.hz*g;r=a.hx*p+a.hy*m;y=b*u-d*z;if((0>y?-y:y)>v+r)return!1;v=this.hx*m+this.hy*e;r=a.hy*l+a.hz*k;y=c*w-b*A;if((0>y?-y:y)>v+r)return!1;v=this.hx*p+this.hy*f;r=a.hx*l+a.hz*h;y=c*x-b*B;if((0>y?-y:y)>v+r)return!1;v=this.hx*t+this.hy*g;r=a.hx*k+a.hy*h;y=c*z-b*C;return(0>y?-y:y)>v+r?!1:!0},rayIntersection:function(a,b){var c=a.px-this.centerX,d=a.py-this.centerY,e=a.pz-this.centerZ;var f=c*this.xx+d*this.xy+e*this.xz;b=c*this.yx+d*this.yy+e*
this.yz;c=c*this.zx+d*this.zy+e*this.zz;var g=a.lx*this.xx+a.ly*this.xy+a.lz*this.xz;d=a.lx*this.yx+a.ly*this.yy+a.lz*this.yz;a=a.lx*this.zx+a.ly*this.zy+a.lz*this.zz;e=0;var h=Infinity;if(1E-10>(0>g?-g:g)){if(f<-this.hx||f>this.hx)return-1}else{var k=1/g;g=(-this.hx-f)*k;k*=this.hx-f;g>k&&(f=k,k=g,g=f);g>e&&(e=g);k<h&&(h=k);if(e>h)return-1}if(1E-10>(0>d?-d:d)){if(b<-this.hy||b>this.hy)return-1}else if(k=1/d,g=(-this.hy-b)*k,k*=this.hy-b,g>k&&(f=k,k=g,g=f),g>e&&(e=g),k<h&&(h=k),e>h)return-1;if(1E-10>
(0>a?-a:a)){if(c<-this.hz||c>this.hz)return-1}else if(k=1/a,g=(-this.hz-c)*k,k*=this.hz-c,g>k&&(f=k,k=g,g=f),g>e&&(e=g),k<h&&(h=k),e>h)return-1;return e},contains:function(a){var b=a.x-this.centerX;var c=a.y-this.centerY;var d=a.z-this.centerZ;a=b*this.xx+c*this.xy+d*this.xz;var e=b*this.yx+c*this.yy+d*this.yz;b=b*this.zx+c*this.zy+d*this.zz;c=this.hx;-1E-10<(0>c?-c:c)-(0>a?-a:a)?(c=this.hy,a=-1E-10<(0>c?-c:c)-(0>e?-e:e)):a=!1;return a?(c=this.hz,-1E-10<(0>c?-c:c)-(0>b?-b:b)):!1},inFrustum:function(a,
b){if(null!=b)throw u.thrown("Not implemented");return a.hasOrientedBounds(this)},inSphere:function(a){var b=a.x,c=a.y,d=a.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;a=a.r*a.r;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=
b,p=c,t=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=b,r=c,y=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var q=-1*this.hx;h*=q;k*=q;l*=q;q=-1*this.hy;m*=q;p*=q;t*=q;q=-1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=t;null==d&&(d=0);null==c&&(c=
0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=r*q;d+=y*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.zx;c=this.zy;
d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;r=c;y=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=1*this.hx;h*=q;k*=q;l*=q;q=-1*this.hy;m*=q;p*=q;t*=q;q=-1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=t;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);b+=n*q;c+=r*q;d+=y*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);
null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;r=c;y=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=-1*this.hx;h*=q;k*=q;l*=q;q=1*this.hy;m*=q;p*=q;t*=q;q=-1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=t;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=r*q;d+=
y*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&
(c=0);null==b&&(b=0);n=b;r=c;y=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=1*this.hx;h*=q;k*=q;l*=q;q=1*this.hy;m*=q;p*=q;t*=q;q=-1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=t;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=r*q;d+=y*q;null==d&&(d=0);null==c&&(c=0);null==
b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;r=c;y=d;b=this.centerX;
c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=-1*this.hx;h*=q;k*=q;l*=q;q=-1*this.hy;m*=q;p*=q;t*=q;q=1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=t;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=r*q;d+=y*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&
(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;r=c;y=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=
0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=1*this.hx;h*=q;k*=q;l*=q;q=-1*this.hy;m*=q;p*=q;t*=q;q=1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=t;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=r*q;d+=y*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;
b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;r=c;y=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);
null==c&&(c=0);null==b&&(b=0);q=-1*this.hx;h*=q;k*=q;l*=q;q=1*this.hy;m*=q;p*=q;t*=q;q=1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=t;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=r*q;d+=y*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;if(b*b+c*c+d*d>a)return!1;b=this.xx;c=this.xy;d=this.xz;null==d&&
(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=b;r=c;y=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);q=1*this.hx;
h*=q;k*=q;l*=q;q=1*this.hy;m*=q;p*=q;t*=q;q=1*this.hz;b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m;c+=p;d+=t;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=n*q;c+=r*q;d+=y*q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e-b;c=f-c;d=g-d;return b*b+c*c+d*d>a?!1:!0},dimension:function(){var a=this.hx,b=this.hy,c=this.hz;b=b<c?c:b;return 2*(a<b?b:
a)},getVertice:function(a){var b=this.xx,c=this.xy,d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=b,p=c,t=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=(2*(a&1)-1)*this.hx;e*=n;f*=n;g*=n;n=(2*(a>>1&1)-1)*this.hy;h*=n;k*=n;l*=n;n=(2*(a>>2&1)-1)*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=t*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,d)},getVertices:function(a){a=null!=
a?a:[];var b=this.xx,c=this.xy,d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=b,p=c,t=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&
(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=-1*this.hx;e*=n;f*=n;g*=n;n=-1*this.hy;h*=n;k*=n;l*=n;n=-1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=t*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new I(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==
d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=1*this.hx;e*=n;f*=n;g*=n;n=-1*this.hy;h*=n;k*=n;l*=
n;n=-1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=t*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new I(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=
0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=-1*this.hx;e*=n;f*=n;g*=n;n=1*this.hy;h*=n;k*=n;l*=n;n=-1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==
b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=t*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new I(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==
d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=1*this.hx;e*=n;f*=n;g*=n;n=1*this.hy;h*=n;k*=n;l*=n;n=-1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&
(b=0);b+=m*n;c+=p*n;d+=t*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new I(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.centerX;
c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=-1*this.hx;e*=n;f*=n;g*=n;n=-1*this.hy;h*=n;k*=n;l*=n;n=1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=t*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new I(b,c,d));b=this.xx;c=this.xy;
d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==
b&&(b=0);n=1*this.hx;e*=n;f*=n;g*=n;n=-1*this.hy;h*=n;k*=n;l*=n;n=1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=t*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new I(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;
g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=-1*this.hx;e*=n;f*=n;g*=n;n=1*this.hy;h*=n;k*=n;l*=n;n=1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=t*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new I(b,c,d));b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;f=c;g=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==
b&&(b=0);h=b;k=c;l=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);n=1*this.hx;e*=n;f*=n;g*=n;n=1*this.hy;h*=n;k*=n;l*=n;n=1*this.hz;b+=e;c+=f;d+=g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=h;c+=k;d+=l;null==d&&(d=0);null==c&&(c=
0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=m*n;c+=p*n;d+=t*n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.push(new I(b,c,d));return a},closestPoint:function(a){throw u.thrown("not implemented");},testPlane:function(a){var b=a.nx,c=a.ny,d=a.nz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=this.xx;c=this.xy;d=this.xz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,
k=c,l=d;b=this.yx;c=this.yy;d=this.yz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=b,p=c,t=d;b=this.zx;c=this.zy;d=this.zz;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=b,r=c,y=d;b=this.centerX;c=this.centerY;d=this.centerZ;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);h=e*h+f*k+g*l;m=e*m+f*p+g*t;n=e*n+f*r+g*y;return e*b+f*c+g*d-a.d+(this.hx*(0>h?-h:h)+this.hy*
(0>m?-m:m)+this.hz*(0>n?-n:n))},makeDebugObj:function(){var a=new Ed,b=this.getVertices();a.lineStyle(1,16777215,1);a.moveTo(b[0].x,b[0].y,b[0].z);a.lineTo(b[4].x,b[4].y,b[4].z);a.moveTo(b[1].x,b[1].y,b[1].z);a.lineTo(b[5].x,b[5].y,b[5].z);a.moveTo(b[2].x,b[2].y,b[2].z);a.lineTo(b[6].x,b[6].y,b[6].z);a.moveTo(b[3].x,b[3].y,b[3].z);a.lineTo(b[7].x,b[7].y,b[7].z);a.moveTo(b[0].x,b[0].y,b[0].z);a.lineTo(b[1].x,b[1].y,b[1].z);a.lineTo(b[3].x,b[3].y,b[3].z);a.lineTo(b[2].x,b[2].y,b[2].z);a.lineTo(b[0].x,
b[0].y,b[0].z);a.moveTo(b[4].x,b[4].y,b[4].z);a.lineTo(b[5].x,b[5].y,b[5].z);a.lineTo(b[7].x,b[7].y,b[7].z);a.lineTo(b[6].x,b[6].y,b[6].z);a.lineTo(b[4].x,b[4].y,b[4].z);return a},__class__:ri});var bb=function(a,b,c,d){this.nx=a;this.ny=b;this.nz=c;this.d=d};z["h3d.col.Plane"]=bb;bb.__name__="h3d.col.Plane";bb.fromPoints=function(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=b.z-a.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;var g=e,h=f;d=c.x-a.x;e=c.y-a.y;f=
c.z-a.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c=d;var k=e;e=f;d=g*e-h*k;e=h*c-b*e;f=b*k-g*c;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;g=e;h=f;return new bb(b,g,h,b*a.x+g*a.y+h*a.z)};bb.fromNormalPoint=function(a,b){return new bb(a.x,a.y,a.z,a.x*b.x+a.y*b.y+a.z*b.z)};bb.X=function(a){null==a&&(a=0);return new bb(1,0,0,a)};bb.Y=function(a){null==a&&(a=0);return new bb(0,1,0,a)};bb.Z=function(a){null==
a&&(a=0);return new bb(0,0,1,a)};bb.frustumLeft=function(a){return new bb(a._14+a._11,a._24+a._21,a._34+a._31,-(a._44+a._41))};bb.frustumRight=function(a){return new bb(a._14-a._11,a._24-a._21,a._34-a._31,a._41-a._44)};bb.frustumBottom=function(a){return new bb(a._14+a._12,a._24+a._22,a._34+a._32,-(a._44+a._42))};bb.frustumTop=function(a){return new bb(a._14-a._12,a._24-a._22,a._34-a._32,a._42-a._44)};bb.frustumNear=function(a){return new bb(a._13,a._23,a._33,-a._43)};bb.frustumFar=function(a){return new bb(a._14-
a._13,a._24-a._23,a._34-a._33,a._43-a._44)};bb.prototype={getNormal:function(){var a=this.nx,b=this.ny,c=this.nz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},getNormalDistance:function(){return this.d},load:function(a){this.nx=a.nx;this.ny=a.ny;this.nz=a.nz;this.d=a.d},transform:function(a){var b=new ma;b.initInverse(a);b.transpose();var c=this.nx,d=this.ny,e=this.nz;a=-this.d;null==a&&(a=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var f=a;null==f&&(f=1);null==e&&(e=0);null==
d&&(d=0);null==c&&(c=0);a=c;c=d;d=e;e=f;f=a*b._12+c*b._22+d*b._32+e*b._42;var g=a*b._13+c*b._23+d*b._33+e*b._43,h=a*b._14+c*b._24+d*b._34+e*b._44;this.nx=a*b._11+c*b._21+d*b._31+e*b._41;this.ny=f;this.nz=g;this.d=-h},transform3x3:function(a){var b=new ma;b.initInverse3x3(a);b.transpose();var c=this.nx,d=this.ny,e=this.nz;a=-this.d;null==a&&(a=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var f=a;null==f&&(f=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;c=d;d=e;e=f;f=a*b._12+c*b._22+d*b._32+
e*b._42;var g=a*b._13+c*b._23+d*b._33+e*b._43,h=a*b._14+c*b._24+d*b._34+e*b._44;this.nx=a*b._11+c*b._21+d*b._31+e*b._41;this.ny=f;this.nz=g;this.d=-h},transformInverseTranspose:function(a){var b=this.nx,c=this.ny,d=this.nz,e=-this.d;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var f=e;null==f&&(f=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b;b=c;c=d;d=f;f=e*a._12+b*a._22+c*a._32+d*a._42;var g=e*a._13+b*a._23+c*a._33+d*a._43,h=e*a._14+b*a._24+c*a._34+d*a._44;this.nx=e*a._11+b*
a._21+c*a._31+d*a._41;this.ny=f;this.nz=g;this.d=-h},normalize:function(){var a=1/Math.sqrt(this.nx*this.nx+this.ny*this.ny+this.nz*this.nz);this.nx*=a;this.ny*=a;this.nz*=a;this.d*=a},toString:function(){var a=this.nx,b=this.ny,c=this.nz;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return"Plane{"+w.string(new I(a,b,c))+","+X.fmt(this.d)+"}"},distance:function(a){return this.nx*a.x+this.ny*a.y+this.nz*a.z-this.d},side:function(a){return 0<=this.nx*a.x+this.ny*a.y+this.nz*a.z-this.d},project:function(a){var b=
this.nx*a.x+this.ny*a.y+this.nz*a.z-this.d,c=a.x-b*this.nx,d=a.y-b*this.ny;a=a.z-b*this.nz;null==a&&(a=0);null==d&&(d=0);null==c&&(c=0);return new I(c,d,a)},projectTo:function(a,b){var c=this.nx*a.x+this.ny*a.y+this.nz*a.z-this.d;b.x=a.x-c*this.nx;b.y=a.y-c*this.ny;b.z=a.z-c*this.nz},__class__:bb};var Je=function(a){null==a&&(a=!1);this.next=null;this.oriented=a};z["h3d.col.TriPlane"]=Je;Je.__name__="h3d.col.TriPlane";Je.__super__=Jb;Je.prototype=J(Jb.prototype,{init:function(a,b,c){this.p0x=a.x;
this.p0y=a.y;this.p0z=a.z;var d=b.x-a.x,e=b.y-a.y,f=b.z-a.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);b=d;var g=e,h=f;d=c.x-a.x;e=c.y-a.y;f=c.z-a.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c=d;var k=e,l=f;d=g*l-h*k;e=h*c-b*l;f=b*k-g*c;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);this.d=d*a.x+e*a.y+f*a.z;this.nx=d;this.ny=e;this.nz=f;this.d1x=b;this.d1y=g;this.d1z=
h;this.d2x=c;this.d2y=k;this.d2z=l;this.dot00=b*b+g*g+h*h;this.dot01=b*c+g*k+h*l;this.dot11=c*c+k*k+l*l;this.invDenom=1/(this.dot00*this.dot11-this.dot01*this.dot01)},clone:function(){var a=new Je(this.oriented);a.p0x=this.p0x;a.p0y=this.p0y;a.p0z=this.p0z;a.d1x=this.d1x;a.d1y=this.d1y;a.d1z=this.d1z;a.d2x=this.d2x;a.d2y=this.d2y;a.d2z=this.d2z;a.dot00=this.dot00;a.dot01=this.dot01;a.dot11=this.dot11;a.invDenom=this.invDenom;a.nx=this.nx;a.ny=this.ny;a.nz=this.nz;a.d=this.d;null!=this.next&&(a.next=
this.next.clone());return a},load:function(a){this.p0x=a.p0x;this.p0y=a.p0y;this.p0z=a.p0z;this.d1x=a.d1x;this.d1y=a.d1y;this.d1z=a.d1z;this.d2x=a.d2x;this.d2y=a.d2y;this.d2z=a.d2z;this.dot00=a.dot00;this.dot01=a.dot01;this.dot11=a.dot11;this.invDenom=a.invDenom;this.nx=a.nx;this.ny=a.ny;this.nz=a.nz;this.d=a.d},transform:function(a){var b=this.p0x,c=this.p0y,d=this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=this.d1x+this.p0x;c=
this.d1y+this.p0y;d=this.d1z+this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b,k=c,l=d;b=this.d2x+this.p0x;c=this.d2y+this.p0y;d=this.d2z+this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var m=e*a._11+f*a._21+g*a._31+a._41,p=e*a._12+f*a._22+g*a._32+a._42,t=e*a._13+f*a._23+g*a._33+a._43;e=m;f=p;g=t;m=h*a._11+k*a._21+l*a._31+a._41;p=h*a._12+k*a._22+l*a._32+a._42;t=h*a._13+k*a._23+l*a._33+a._43;
h=m;k=p;l=t;m=b*a._11+c*a._21+d*a._31+a._41;p=b*a._12+c*a._22+d*a._32+a._42;t=b*a._13+c*a._23+d*a._33+a._43;this.p0x=e;this.p0y=f;this.p0z=g;b=h-e;c=k-f;d=l-g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a=b;h=c;k=d;b=m-e;c=p-f;d=t-g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);m=b;p=c;t=d;b=h*t-k*p;c=k*m-a*t;d=a*p-h*m;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);
this.d=b*e+c*f+d*g;this.nx=b;this.ny=c;this.nz=d;this.d1x=a;this.d1y=h;this.d1z=k;this.d2x=m;this.d2y=p;this.d2z=t;this.dot00=a*a+h*h+k*k;this.dot01=a*m+h*p+k*t;this.dot11=m*m+p*p+t*t;this.invDenom=1/(this.dot00*this.dot11-this.dot01*this.dot01)},contains:function(a){var b=a.x-this.p0x,c=a.y-this.p0y;a=a.z-this.p0z;null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);var d=c;null==a&&(a=0);null==d&&(d=0);null==b&&(b=0);c=b;b=d;d=a;a=this.d1x*c+this.d1y*b+this.d1z*d;b=this.d2x*c+this.d2y*b+this.d2z*d;c=(this.dot11*
a-this.dot01*b)*this.invDenom;a=(this.dot00*b-this.dot01*a)*this.invDenom;return 0<=c&&0<=a?1>c+a:!1},side:function(a){return 0<=this.nx*a.x+this.ny*a.y+this.nz*a.z-this.d},inFrustum:function(a,b){throw u.thrown("Not implemented");},inSphere:function(a){throw u.thrown("Not implemented");},closestPoint:function(a){var b=this.p0x;var c=this.p0y;var d=this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=a.x-this.p0x;c=a.y-this.p0y;d=a.z-
this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var h=b;var k=c;var l=d;var m=this.d1x*h+this.d1y*k+this.d1z*l;k=this.d2x*h+this.d2y*k+this.d2z*l;h=(this.dot11*m-this.dot01*k)*this.invDenom;l=(this.dot00*k-this.dot01*m)*this.invDenom;if(0<=h&&0<=l&&1>h+l){b=a.x-e;c=a.y-f;d=a.z-g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;b=this.nx;c=this.ny;d=this.nz;null==d&&(d=0);null==c&&(c=0);null==b&&
(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var p=b;var t=c;var n=d;a=p*p+t*t+n*n;a=1E-20>a?0:1/Math.sqrt(a);p*=a;t*=a;n*=a;l=k*p+m*t+h*n;b=p*l;c=t*l;d=n*l;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=k-b;c=m-c;d=h-d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e+b;c=f+c;d=g+d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,d)}b=this.d1x;c=this.d1y;d=this.d1z;null==d&&(d=0);null==c&&
(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;b=this.d2x;c=this.d2y;d=this.d2z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);p=b;t=c;n=d;b=this.p0x;c=this.p0y;d=this.p0z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b+=k;c+=m;d+=h;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var r=b,y=c,q=d;b=a.x-e;c=a.y-f;d=a.z-g;null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);d=(b*k+c*m+d*h)/(k*k+m*m+h*h);0>d?d=0:1<d&&(d=1);b=k*d;c=m*d;d*=h;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e+b;c=f+c;d=g+d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);l=new I(b,c,d);b=p-k;c=t-m;d=n-h;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;b=a.x-r;c=a.y-y;d=a.z-q;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&
(d=0);null==c&&(c=0);null==b&&(b=0);d=(b*k+c*m+d*h)/(k*k+m*m+h*h);0>d?d=0:1<d&&(d=1);b=k*d;c=m*d;d*=h;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=r+b;c=y+c;d=q+d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);r=new I(b,c,d);b=a.x-e;c=a.y-f;d=a.z-g;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);d=(b*p+c*t+d*n)/(p*p+t*t+n*n);0>d?d=0:1<d&&(d=1);b=p*d;c=t*d;d*=n;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==
d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=e+b;c=f+c;d=g+d;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=new I(b,c,d);b=a.x-l.x;c=a.y-l.y;d=a.z-l.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;g=k*k+m*m+h*h;b=a.x-r.x;c=a.y-r.y;d=a.z-r.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;f=k*k+m*m+h*h;b=a.x-e.x;c=a.y-e.y;d=a.z-e.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==
c&&(c=0);null==b&&(b=0);k=b;m=c;h=d;a=g;g=l;f<a&&(a=f,g=r);k*k+m*m+h*h<a&&(g=e);return g},rayIntersection:function(a,b){b=a.lx*this.nx+a.ly*this.ny+a.lz*this.nz;if(0<=b&&this.oriented)return-1;b=(this.d-(a.px*this.nx+a.py*this.ny+a.pz*this.nz))/b;if(0>b&&this.oriented)return-1;var c=a.px+a.lx*b-this.p0x,d=a.py+a.ly*b-this.p0y;a=a.pz+a.lz*b-this.p0z;null==a&&(a=0);null==d&&(d=0);null==c&&(c=0);var e=a;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;c=d;d=this.d1x*a+this.d1y*c+this.d1z*e;c=this.d2x*
a+this.d2y*c+this.d2z*e;a=(this.dot11*d-this.dot01*c)*this.invDenom;d=(this.dot00*c-this.dot01*d)*this.invDenom;return 0<=a&&0<=d&&1>a+d?b:-1},isPointInTriangle:function(a,b,c){a-=this.p0x;b-=this.p0y;c-=this.p0z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=c;c=this.d1x*a+this.d1y*b+this.d1z*d;a=this.d2x*a+this.d2y*b+this.d2z*d;b=(this.dot11*c-this.dot01*a)*this.invDenom;c=(this.dot00*a-this.dot01*c)*this.invDenom;return 0<=b&&0<=c?1>b+c:!1},getPoints:function(){var a=
this.p0x,b=this.p0y,c=this.p0z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=new I(a,b,c);a=this.d1x+this.p0x;b=this.d1y+this.p0y;c=this.d1z+this.p0z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var e=new I(a,b,c);a=this.d2x+this.p0x;b=this.d2y+this.p0y;c=this.d2z+this.p0z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return[d,e,new I(a,b,c)]},makeDebugObj:function(){var a=this.p0x,b=this.p0y,c=this.p0z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var d=new I(a,b,c);a=this.d1x;b=this.d1y;c=this.d1z;
null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);var e=a;null==c&&(c=0);null==b&&(b=0);null==e&&(e=0);var f=e,g=b,h=c;a=this.d2x;b=this.d2y;c=this.d2z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);e=a;null==c&&(c=0);null==b&&(b=0);null==e&&(e=0);var k=b,l=c;a=f+d.x;b=g+d.y;c=h+d.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);f=new I(a,b,c);a=e+d.x;b=k+d.y;c=l+d.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);d=[d,f,new I(a,b,c)];d=new $c(d);d.addNormals();return new Ua(d)},dimension:function(){throw u.thrown("Not implemented");
},__class__:Je});var cf=function(a){null==a&&(a=!1);this.oriented=a};z["h3d.col.Polygon"]=cf;cf.__name__="h3d.col.Polygon";cf.fromPolygon2D=function(a,b,c){var d;null==c&&(c=!0);null==b&&(b=0);var e=new cf;if(Ld.isConvex(a)){var f=a[0];var g=0;for(d=a.length-2;g<d;){var h=g++;var k=a[h+1];var l=a[h+2];h=new Je(c);var m=f.x;var p=f.y;var t=b;null==t&&(t=0);null==p&&(p=0);null==m&&(m=0);null==t&&(t=0);null==p&&(p=0);null==m&&(m=0);var n=k.x;var r=k.y;k=b;null==k&&(k=0);null==r&&(r=0);null==n&&(n=0);
null==k&&(k=0);null==r&&(r=0);null==n&&(n=0);var y=n;var q=l.x;n=l.y;l=b;null==l&&(l=0);null==n&&(n=0);null==q&&(q=0);null==l&&(l=0);null==n&&(n=0);null==q&&(q=0);var u=q;q=n;n=l;h.p0x=m;h.p0y=p;h.p0z=t;l=y-m;y=r-p;r=k-t;null==r&&(r=0);null==y&&(y=0);null==l&&(l=0);k=y;null==r&&(r=0);null==k&&(k=0);null==l&&(l=0);y=u-m;q-=p;u=n-t;null==u&&(u=0);null==q&&(q=0);null==y&&(y=0);n=y;null==u&&(u=0);null==q&&(q=0);null==n&&(n=0);y=k*u-r*q;var v=r*n-l*u;var w=l*q-k*n;null==w&&(w=0);null==v&&(v=0);null==y&&
(y=0);null==w&&(w=0);null==v&&(v=0);null==y&&(y=0);h.d=y*m+v*p+w*t;h.nx=y;h.ny=v;h.nz=w;h.d1x=l;h.d1y=k;h.d1z=r;h.d2x=n;h.d2y=q;h.d2z=u;h.dot00=l*l+k*k+r*r;h.dot01=l*n+k*q+r*u;h.dot11=n*n+q*q+u*u;h.invDenom=1/(h.dot00*h.dot11-h.dot01*h.dot01);h.next=e.triPlanes;e.triPlanes=h}}else{var x=Ld.fastTriangulate(a);g=0;for(d=x.length/3|0;g<d;)h=g++,f=a[x[3*h]],k=a[x[3*h+1]],l=a[x[3*h+2]],h=new Je(c),m=f.x,p=f.y,t=b,null==t&&(t=0),null==p&&(p=0),null==m&&(m=0),null==t&&(t=0),null==p&&(p=0),null==m&&(m=0),
n=k.x,r=k.y,k=b,null==k&&(k=0),null==r&&(r=0),null==n&&(n=0),null==k&&(k=0),null==r&&(r=0),null==n&&(n=0),y=n,q=l.x,n=l.y,l=b,null==l&&(l=0),null==n&&(n=0),null==q&&(q=0),null==l&&(l=0),null==n&&(n=0),null==q&&(q=0),u=q,q=n,n=l,h.p0x=m,h.p0y=p,h.p0z=t,l=y-m,y=r-p,r=k-t,null==r&&(r=0),null==y&&(y=0),null==l&&(l=0),k=y,null==r&&(r=0),null==k&&(k=0),null==l&&(l=0),y=u-m,q-=p,u=n-t,null==u&&(u=0),null==q&&(q=0),null==y&&(y=0),n=y,null==u&&(u=0),null==q&&(q=0),null==n&&(n=0),y=k*u-r*q,v=r*n-l*u,w=l*q-
k*n,null==w&&(w=0),null==v&&(v=0),null==y&&(y=0),null==w&&(w=0),null==v&&(v=0),null==y&&(y=0),h.d=y*m+v*p+w*t,h.nx=y,h.ny=v,h.nz=w,h.d1x=l,h.d1y=k,h.d1z=r,h.d2x=n,h.d2y=q,h.d2z=u,h.dot00=l*l+k*k+r*r,h.dot01=l*n+k*q+r*u,h.dot11=n*n+q*q+u*u,h.invDenom=1/(h.dot00*h.dot11-h.dot01*h.dot01),h.next=e.triPlanes,e.triPlanes=h}return e};cf.__super__=Jb;cf.prototype=J(Jb.prototype,{addBuffers:function(a,b,c){null==c&&(c=3);for(var d=0,e=b.length/3|0;d<e;){var f=3*d++,g=new Je(this.oriented),h=b[f]*c,k=b[f+1]*
c,l=b[f+2]*c,m=a[h];f=a[h+1];h=a[h+2];null==h&&(h=0);null==f&&(f=0);null==m&&(m=0);var p=f,t=h;null==t&&(t=0);null==p&&(p=0);null==m&&(m=0);f=m;h=p;m=t;t=a[k];p=a[k+1];k=a[k+2];null==k&&(k=0);null==p&&(p=0);null==t&&(t=0);var n=k;null==n&&(n=0);null==p&&(p=0);null==t&&(t=0);k=t;var r=n;n=a[l];t=a[l+1];l=a[l+2];null==l&&(l=0);null==t&&(t=0);null==n&&(n=0);var y=t;null==l&&(l=0);null==y&&(y=0);null==n&&(n=0);t=n;n=y;y=l;g.p0x=f;g.p0y=h;g.p0z=m;l=k-f;k=p-h;p=r-m;null==p&&(p=0);null==k&&(k=0);null==l&&
(l=0);null==p&&(p=0);null==k&&(k=0);null==l&&(l=0);t-=f;n-=h;y-=m;null==y&&(y=0);null==n&&(n=0);null==t&&(t=0);null==y&&(y=0);null==n&&(n=0);null==t&&(t=0);var q=k*y-p*n,u=p*t-l*y;r=l*n-k*t;null==r&&(r=0);null==u&&(u=0);null==q&&(q=0);null==r&&(r=0);null==u&&(u=0);null==q&&(q=0);g.d=q*f+u*h+r*m;g.nx=q;g.ny=u;g.nz=r;g.d1x=l;g.d1y=k;g.d1z=p;g.d2x=t;g.d2y=n;g.d2z=y;g.dot00=l*l+k*k+p*p;g.dot01=l*t+k*n+p*y;g.dot11=t*t+n*n+y*y;g.invDenom=1/(g.dot00*g.dot11-g.dot01*g.dot01);g.next=this.triPlanes;this.triPlanes=
g}},isConvex:function(){return!0},clone:function(){var a=new cf(this.oriented),b=this.triPlanes,c=new Je(b.oriented);c.p0x=b.p0x;c.p0y=b.p0y;c.p0z=b.p0z;c.d1x=b.d1x;c.d1y=b.d1y;c.d1z=b.d1z;c.d2x=b.d2x;c.d2y=b.d2y;c.d2z=b.d2z;c.dot00=b.dot00;c.dot01=b.dot01;c.dot11=b.dot11;c.invDenom=b.invDenom;c.nx=b.nx;c.ny=b.ny;c.nz=b.nz;c.d=b.d;if(null!=b.next){b=b.next;var d=new Je(b.oriented);d.p0x=b.p0x;d.p0y=b.p0y;d.p0z=b.p0z;d.d1x=b.d1x;d.d1y=b.d1y;d.d1z=b.d1z;d.d2x=b.d2x;d.d2y=b.d2y;d.d2z=b.d2z;d.dot00=b.dot00;
d.dot01=b.dot01;d.dot11=b.dot11;d.invDenom=b.invDenom;d.nx=b.nx;d.ny=b.ny;d.nz=b.nz;d.d=b.d;null!=b.next&&(d.next=b.next.clone());c.next=d}a.triPlanes=c;return a},transform:function(a){for(var b=this.triPlanes;null!=b;)b.transform(a),b=b.next},getPoints:function(){for(var a=[],b=this.triPlanes;null!=b;)a=a.concat(b.getPoints()),b=b.next;return a},getBounds:function(a){null==a&&(a=new fb);a.xMin=1E20;a.xMax=-1E20;a.yMin=1E20;a.yMax=-1E20;a.zMin=1E20;a.zMax=-1E20;for(var b=this.triPlanes;null!=b;){var c=
b.p0x,d=b.p0y,e=b.p0z;c<a.xMin&&(a.xMin=c);c>a.xMax&&(a.xMax=c);d<a.yMin&&(a.yMin=d);d>a.yMax&&(a.yMax=d);e<a.zMin&&(a.zMin=e);e>a.zMax&&(a.zMax=e);c=b.d1x+b.p0x;d=b.d1y+b.p0y;e=b.d1z+b.p0z;c<a.xMin&&(a.xMin=c);c>a.xMax&&(a.xMax=c);d<a.yMin&&(a.yMin=d);d>a.yMax&&(a.yMax=d);e<a.zMin&&(a.zMin=e);e>a.zMax&&(a.zMax=e);c=b.d2x+b.p0x;d=b.d2y+b.p0y;e=b.d2z+b.p0z;c<a.xMin&&(a.xMin=c);c>a.xMax&&(a.xMax=c);d<a.yMin&&(a.yMin=d);d>a.yMax&&(a.yMax=d);e<a.zMin&&(a.zMin=e);e>a.zMax&&(a.zMax=e);b=b.next}return a},
contains:function(a){if(!this.isConvex())throw u.thrown("Not implemented for concave polygon");for(var b=this.triPlanes;null!=b;){if(0<=b.nx*a.x+b.ny*a.y+b.nz*a.z-b.d)return!1;b=b.next}return!0},rayIntersection:function(a,b){for(var c=this.triPlanes,d=-1;null!=c;){var e=a.lx*c.nx+a.ly*c.ny+a.lz*c.nz;if(0<=e&&c.oriented)e=-1;else if(e=(c.d-(a.px*c.nx+a.py*c.ny+a.pz*c.nz))/e,0>e&&c.oriented)e=-1;else{var f=a.px+a.lx*e-c.p0x,g=a.py+a.ly*e-c.p0y,h=a.pz+a.lz*e-c.p0z;null==h&&(h=0);null==g&&(g=0);null==
f&&(f=0);var k=h;null==k&&(k=0);null==g&&(g=0);null==f&&(f=0);h=f;f=c.d1x*h+c.d1y*g+c.d1z*k;g=c.d2x*h+c.d2y*g+c.d2z*k;h=(c.dot11*f-c.dot01*g)*c.invDenom;f=(c.dot00*g-c.dot01*f)*c.invDenom;e=0<=h&&0<=f&&1>h+f?e:-1}if(0<=e){if(!b)return e;if(0>d||e<d)d=e}c=c.next}return d},inFrustum:function(a,b){throw u.thrown("Not implemented");},inSphere:function(a){throw u.thrown("Not implemented");},closestPoint:function(a){for(var b=this.triPlanes,c=Infinity,d=null;null!=b;){var e=b.closestPoint(a),f=a,g=e.x-
f.x,h=e.y-f.y;f=e.z-f.z;g=g*g+h*h+f*f;g<c&&(c=g,d=e);b=b.next}return d},dimension:function(){var a=this.getBounds(),b=a.xMax-a.xMin,c=a.yMax-a.yMin;a=a.zMax-a.zMin;c=c<a?a:c;return b<c?c:b},makeDebugObj:function(){for(var a=[],b=this.triPlanes;null!=b;){var c=b.p0x,d=b.p0y,e=b.p0z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=new I(c,d,e);e=b.d1x;var f=b.d1y;d=b.d1z;null==d&&(d=0);null==f&&(f=0);null==e&&(e=0);var g=d;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);d=e;e=f;f=g;var h=b.d2x,k=b.d2y;g=
b.d2z;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);var l=g;null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);g=h;h=k;k=l;a.push(c);d+=c.x;e+=c.y;f+=c.z;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);a.push(new I(d,e,f));d=g+c.x;e=h+c.y;c=k+c.z;null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);a.push(new I(d,e,c));b=b.next}a=new $c(a);a.addNormals();a=new Ua(a);this.oriented||a.material.passes.set_culling(Ib.None);return a},__class__:cf});var Fd=function(){};z["h3d.col.PolygonBuffer"]=Fd;Fd.__name__="h3d.col.PolygonBuffer";
Fd.__super__=Jb;Fd.prototype=J(Jb.prototype,{setData:function(a,b,c,d){null==d&&(d=-1);null==c&&(c=0);this.buffer=a;this.indexes=b;this.startIndex=c;this.triCount=0<=d?d:(b.length-c)/3|0},getBounds:function(){for(var a=this.startIndex,b=new fb,c=0,d=3*this.triCount;c<d;){c++;var e=3*this.indexes[a++],f=this.buffer[e++],g=this.buffer[e++];e=this.buffer[e];f<b.xMin&&(b.xMin=f);f>b.xMax&&(b.xMax=f);g<b.yMin&&(b.yMin=g);g>b.yMax&&(b.yMax=g);e<b.zMin&&(b.zMin=e);e>b.zMax&&(b.zMax=e)}return b},getPoints:function(){for(var a,
b=1073741824,c=-1073741824,d=this.startIndex,e=this.startIndex+3*this.triCount;d<e;)a=d++,a=this.indexes[a],a<b&&(b=a),a>c&&(c=a);c=Oj._new(c+1-b);var f=[];d=this.startIndex;for(e=this.startIndex+3*this.triCount;d<e;){a=d++;a=this.indexes[a];var g=a-b;Oj.get(c,g)||(a*=3,f.push(new Zc(this.buffer[a++],this.buffer[a++],this.buffer[a])),Oj.set(c,g))}return f},contains:function(a){var b=this.startIndex;var c=a.x;var d=a.y;var e=a.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);a=c;for(var f=d,g=e,h=0,
k=this.triCount;h<k;){h++;e=3*this.indexes[b++];c=this.buffer[e++];d=this.buffer[e++];e=this.buffer[e];null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var l=3*this.indexes[b++],m=this.buffer[l++],p=this.buffer[l++];l=this.buffer[l];null==l&&(l=0);null==p&&(p=0);null==m&&(m=0);var t=l,n=3*this.indexes[b++];l=this.buffer[n++];var r=this.buffer[n++];n=this.buffer[n];null==n&&(n=0);null==r&&(r=0);null==l&&(l=0);m-=c;p-=d;t-=e;null==t&&(t=0);null==p&&(p=0);null==m&&(m=0);l-=c;r-=d;n-=e;null==n&&(n=0);null==
r&&(r=0);null==l&&(l=0);var y=n;n=p*y-t*r;t=t*l-m*y;m=m*r-p*l;null==m&&(m=0);null==t&&(t=0);null==n&&(n=0);p=n;l=t;if(p*a+l*f+m*g>=p*c+l*d+m*e)return!1}return!0},inFrustum:function(a,b){throw u.thrown("Not implemented");},inSphere:function(a){throw u.thrown("Not implemented");},dimension:function(){var a=this.getBounds(),b=a.xMax-a.xMin,c=a.yMax-a.yMin;a=a.zMax-a.zMin;c=c<a?a:c;return b<c?c:b},isPointInTriangle:function(a,b,c){var d=b.x*a.x+b.y*a.y+b.z*a.z;a=c.x*a.x+c.y*a.y+c.z*a.z;var e=b.x*b.x+
b.y*b.y+b.z*b.z;b=b.x*c.x+b.y*c.y+b.z*c.z;var f=c.x*c.x+c.y*c.y+c.z*c.z;c=1/(e*f-b*b);f=(f*d-b*a)*c;d=(e*a-b*d)*c;return 0<=f&&0<=d?1>f+d:!1},closestPointLine:function(a,b,c){var d=a.x-b.x,e=a.y-b.y;a=a.z-b.z;null==a&&(a=0);null==e&&(e=0);null==d&&(d=0);a=(d*c.x+e*c.y+a*c.z)/(c.x*c.x+c.y*c.y+c.z*c.z);0>a?a=0:1<a&&(a=1);d=c.x*a;e=c.y*a;a*=c.z;null==a&&(a=0);null==e&&(e=0);null==d&&(d=0);return new Zc(b.x+d,b.y+e,b.z+a)},closestPoint:function(a){var b=a.x;var c=a.y;var d=a.z;null==d&&(d=0);null==c&&
(c=0);null==b&&(b=0);for(var e=b,f=c,g=d,h=Infinity,k=null,l=this.startIndex,m=0,p=this.triCount;m<p;){m++;var t=3*this.indexes[l++];b=this.buffer[t++];c=this.buffer[t++];d=this.buffer[t];null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var n=b,r=c,y=d,q=3*this.indexes[l++],u=this.buffer[q++],v=this.buffer[q++],w=this.buffer[q];null==w&&(w=0);null==v&&(v=0);null==u&&(u=0);var x=u,z=v,A=w,B=3*this.indexes[l++],C=this.buffer[B++],E=this.buffer[B++],D=this.buffer[B];null==D&&(D=0);null==E&&(E=0);null==C&&
(C=0);var F=C,H=E,K=D,J=null,M=x-n,L=z-r,P=A-y;null==P&&(P=0);null==L&&(L=0);null==M&&(M=0);var N=M,O=L,Q=P,T=F-n,U=H-r,W=K-y;null==W&&(W=0);null==U&&(U=0);null==T&&(T=0);var R=T,S=U,V=W,X=e-n,Y=f-r,aa=g-y;null==aa&&(aa=0);null==Y&&(Y=0);null==X&&(X=0);var Z=X,ba=Y,ca=aa,da=N*Z+O*ba+Q*ca,fa=R*Z+S*ba+V*ca,ha=N*N+O*O+Q*Q,ea=N*R+O*S+Q*V,ia=R*R+S*S+V*V,ja=1/(ha*ia-ea*ea),la=(ia*da-ea*fa)*ja,ma=(ha*fa-ea*da)*ja;if(0<=la&&0<=ma&&1>la+ma){var ka=O*V-Q*S,na=Q*R-N*V,oa=N*S-O*R;null==oa&&(oa=0);null==na&&(na=
0);null==ka&&(ka=0);var qa=ka,ra=na,sa=oa,pa=qa*qa+ra*ra+sa*sa;pa=1E-20>pa?0:1/Math.sqrt(pa);var ta=qa*pa,ua=ra*pa,va=sa*pa;null==va&&(va=0);null==ua&&(ua=0);null==ta&&(ta=0);var wa=ta,xa=ua,ya=va,za=Z*wa+ba*xa+ca*ya,Aa=wa*za,Ba=xa*za,Ca=ya*za;null==Ca&&(Ca=0);null==Ba&&(Ba=0);null==Aa&&(Aa=0);var Da=Z-Aa,Ea=ba-Ba,Ga=ca-Ca;null==Ga&&(Ga=0);null==Ea&&(Ea=0);null==Da&&(Da=0);J=new Zc(n+Da,r+Ea,y+Ga)}else{var Ha=e-n,Ia=f-r,Ja=g-y;null==Ja&&(Ja=0);null==Ia&&(Ia=0);null==Ha&&(Ha=0);var Fa=(Ha*N+Ia*O+Ja*
Q)/(N*N+O*O+Q*Q);0>Fa?Fa=0:1<Fa&&(Fa=1);var Ka=N*Fa,La=O*Fa,Ma=Q*Fa;null==Ma&&(Ma=0);null==La&&(La=0);null==Ka&&(Ka=0);var Na=new Zc(n+Ka,r+La,y+Ma),Qa=R-N,Ra=S-O,Ua=V-Q;null==Ua&&(Ua=0);null==Ra&&(Ra=0);null==Qa&&(Qa=0);var Pa=Qa,Sa=Ra,Ta=Ua,Wa=e-x,Ya=f-z,Za=g-A;null==Za&&(Za=0);null==Ya&&(Ya=0);null==Wa&&(Wa=0);var Oa=(Wa*Pa+Ya*Sa+Za*Ta)/(Pa*Pa+Sa*Sa+Ta*Ta);0>Oa?Oa=0:1<Oa&&(Oa=1);var $a=Pa*Oa,ab=Sa*Oa,bb=Ta*Oa;null==bb&&(bb=0);null==ab&&(ab=0);null==$a&&($a=0);var Xa=new Zc(x+$a,z+ab,A+bb),cb=e-
n,db=f-r,eb=g-y;null==eb&&(eb=0);null==db&&(db=0);null==cb&&(cb=0);var Va=(cb*R+db*S+eb*V)/(R*R+S*S+V*V);0>Va?Va=0:1<Va&&(Va=1);var fb=R*Va,gb=S*Va,hb=V*Va;null==hb&&(hb=0);null==gb&&(gb=0);null==fb&&(fb=0);var ib=new Zc(n+fb,r+gb,y+hb),jb=e-Na.x,kb=f-Na.y,lb=g-Na.z;null==lb&&(lb=0);null==kb&&(kb=0);null==jb&&(jb=0);var mb=jb,nb=kb,ob=lb,sb=mb*mb+nb*nb+ob*ob,pb=e-Xa.x,qb=f-Xa.y,rb=g-Xa.z;null==rb&&(rb=0);null==qb&&(qb=0);null==pb&&(pb=0);var tb=pb,vb=qb,wb=rb,xb=tb*tb+vb*vb+wb*wb,ub=e-ib.x,yb=f-ib.y,
Ab=g-ib.z;null==Ab&&(Ab=0);null==yb&&(yb=0);null==ub&&(ub=0);var Cb=ub,Db=yb,Fb=Ab,Gb=Cb*Cb+Db*Db+Fb*Fb,Bb=sb;J=Na;xb<Bb&&(Bb=xb,J=Xa);Gb<Bb&&(Bb=Gb,J=ib)}var Hb=J.x-e,Ib=J.y-f,Jb=J.z-g,Kb=Hb*Hb+Ib*Ib+Jb*Jb;Kb<h&&(k=J,h=Kb)}b=k.x;c=k.y;d=k.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);return new I(b,c,d)},rayIntersection:function(a,b){var c=this.startIndex;var d=a.lx;var e=a.ly;var f=a.lz;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);var g=d,h=e,k=f;d=a.px;e=a.py;f=a.pz;null==f&&(f=0);null==e&&(e=
0);null==d&&(d=0);a=d;for(var l=e,m=f,p=-1,t=0,n=this.triCount;t<n;){t++;f=3*this.indexes[c++];d=this.buffer[f++];e=this.buffer[f++];f=this.buffer[f];null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);var r=3*this.indexes[c++],y=this.buffer[r++],q=this.buffer[r++];r=this.buffer[r];null==r&&(r=0);null==q&&(q=0);null==y&&(y=0);var u=r,v=3*this.indexes[c++];r=this.buffer[v++];var w=this.buffer[v++];v=this.buffer[v];null==v&&(v=0);null==w&&(w=0);null==r&&(r=0);y-=d;q-=e;u-=f;null==u&&(u=0);null==q&&(q=0);null==
y&&(y=0);r-=d;w-=e;v-=f;null==v&&(v=0);null==w&&(w=0);null==r&&(r=0);var x=h*v-k*w,z=k*r-g*v,A=g*w-h*r;null==A&&(A=0);null==z&&(z=0);null==x&&(x=0);var B=A;A=y*x+q*z+u*B;if(!(1E-10>A)){A=1/A;d=a-d;e=l-e;var C=m-f;null==C&&(C=0);null==e&&(e=0);null==d&&(d=0);f=e;e=(d*x+f*z+C*B)*A;if(!(0>e||1<e||(x=f*u-C*q,u=C*y-d*u,f=d*q-f*y,null==f&&(f=0),null==u&&(u=0),null==x&&(x=0),d=x,y=u,q=(g*d+h*y+k*f)*A,0>q||1<e+q||(d=(r*d+w*y+v*f)*A,1E-10>d)))){if(!b)return d;if(0>p||d<p)p=d}}}return p},makeDebugObj:function(){for(var a=
[],b=[],c=this.startIndex,d=0,e=this.triCount;d<e;)d++,b.push(this.indexes[c++]),b.push(this.indexes[c++]),b.push(this.indexes[c++]);for(c=0;c<this.buffer.length;){d=this.buffer[c++];e=this.buffer[c++];var f=this.buffer[c++];null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);a.push(new I(d,e,f))}a=new $c(a,b);a.addNormals();return new Ua(a)},__class__:Fd});var bh=function(a,b){this.lastFrame=this.lastBoundsFrame=-1;this.obj=a;this.col=b;a=this.transform=new Fd;var c=b.buffer,d=Array(c.length);Xj.blit(c,
0,d,0,c.length);a.setData(d,b.indexes,b.startIndex,b.triCount);this.currentBounds=new fb};z["h3d.col.SkinCollider"]=bh;bh.__name__="h3d.col.SkinCollider";bh.__super__=Jb;bh.prototype=J(Jb.prototype,{contains:function(a){this.checkBounds();var b=this.currentBounds;if(!(a.x>=b.xMin&&a.x<b.xMax&&a.y>=b.yMin&&a.y<b.yMax&&a.z>=b.zMin&&a.z<b.zMax))return!1;this.applyTransform();return this.transform.contains(a)},inFrustum:function(a,b){this.checkBounds();var c=this.currentBounds;if(null!=b)throw u.thrown("Not implemented");
if(!a.hasBounds(c))return!1;if(null!=b)throw u.thrown("Not implemented");this.applyTransform();return this.transform.inFrustum(a)},inSphere:function(a){this.checkBounds();var b=this.currentBounds,c=a.x,d=a.y,e=a.z;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var f=c,g=d,h=e;e=b.xMin;var k=a.x,l=b.xMax;k=k>l?l:k;c=e<k?k:e;e=b.yMin;k=a.y;l=b.yMax;k=k>l?l:k;d=e<k?k:e;e=b.zMin;k=a.z;l=b.zMax;k=k>l?l:k;e=e<k?k:e;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);
null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b=c-f;g=d-g;h=e-h;if(!(b*b+g*g+h*h<a.r*a.r))return!1;this.applyTransform();throw u.thrown("Not implemented");},rayIntersection:function(a,b){this.checkBounds();if(0>this.currentBounds.rayIntersection(a,!1))return-1;this.applyTransform();return this.transform.rayIntersection(a,b)},dimension:function(){var a=this.currentBounds,b=a.xMax-a.xMin,c=a.yMax-a.yMin;a=a.zMax-a.zMin;c=c<a?a:c;return b<c?c:b},checkBounds:function(){if(this.obj.jointsUpdated||this.lastBoundsFrame!=
this.obj.lastFrame){this.lastBoundsFrame=this.obj.lastFrame;this.obj.syncJoints();var a=this.currentBounds;a.xMin=1E20;a.xMax=-1E20;a.yMin=1E20;a.yMax=-1E20;a.zMin=1E20;a.zMax=-1E20;this.obj.addBoundsRec(this.currentBounds,null)}},applyTransform:function(){if(this.obj.jointsUpdated||this.lastFrame!=this.obj.lastFrame){this.lastFrame=this.obj.lastFrame;this.obj.syncJoints();for(var a=0,b=0,c=this.obj.skinData.bonesPerVertex,d=0,e=this.obj.skinData.vertexCount;d<e;){d++;var f=0,g=0,h=0,k=this.col.buffer[b],
l=this.col.buffer[b+1],m=this.col.buffer[b+2];null==m&&(m=0);null==l&&(l=0);null==k&&(k=0);var p=m;null==p&&(p=0);null==l&&(l=0);null==k&&(k=0);m=k;k=l;l=p;p=0;for(var t=c;p<t;){p++;var n=this.obj.skinData.vertexWeights[a];if(0==n)++a;else{var r=this.obj.skinData.vertexJoints[a++],y=m,q=k,u=l;null==u&&(u=0);null==q&&(q=0);null==y&&(y=0);var v=u;null==v&&(v=0);null==q&&(q=0);null==y&&(y=0);u=y;y=q;q=v;r=this.obj.currentPalette[r];v=u*r._12+y*r._22+q*r._32+r._42;var w=u*r._13+y*r._23+q*r._33+r._43;
u=u*r._11+y*r._21+q*r._31+r._41;y=v;q=w;f+=u*n;g+=y*n;h+=q*n}}this.transform.buffer[b++]=f;this.transform.buffer[b++]=g;this.transform.buffer[b++]=h}}},closestPoint:function(a){throw u.thrown("Not implemented");},makeDebugObj:function(){return new ch(this)},__class__:bh});var Aa=function(a){this.prevAbsPosFrame=-1;this.flags=32768;this.absPos=new ma;this.absPos.identity();this.x=0;var b=1;var c=!0;this.flags=c?this.flags|b:this.flags&~b;c&&0!=(this.flags&131072)&&(this.flags|=262144);this.y=0;b=1;
this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.z=0;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);b=this.scaleX=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);b=this.scaleY=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);b=this.scaleZ=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.qRot=new Hc;b=1;this.flags=(c=null!=this.follow)?
this.flags|b:this.flags&~b;c&&0!=(this.flags&131072)&&(this.flags|=262144);this.flags|=2;this.children=[];null!=a&&a.addChild(this)};z["h3d.scene.Object"]=Aa;Aa.__name__="h3d.scene.Object";Aa.prototype={set_cullingCollider:function(a){this.cullingCollider=a;this.flags&=-4097;return a},get_visible:function(){return 0!=(this.flags&2)},get_allocated:function(){return 0!=(this.flags&32)},get_posChanged:function(){return 0!=(this.flags&1)},get_culled:function(){return 0!=(this.flags&4)},get_followPositionOnly:function(){return 0!=
(this.flags&8)},get_lightCameraCenter:function(){return 0!=(this.flags&16)},get_alwaysSyncAnimation:function(){return 0!=(this.flags&64)},get_inheritCulled:function(){return 0!=(this.flags&128)},get_ignoreBounds:function(){return 0!=(this.flags&512)},get_ignoreCollide:function(){return 0!=(this.flags&1024)},get_modelRoot:function(){return 0!=(this.flags&256)},get_ignoreParentTransform:function(){return 0!=(this.flags&2048)},get_cullingColliderInherited:function(){return 0!=(this.flags&4096)},get_fixedPosition:function(){return 0!=
(this.flags&8192)},get_alwaysSync:function(){return 0!=(this.flags&32768)},get_drawn:function(){return 0!=(this.flags&65536)},set_posChanged:function(a){this.flags=(a=a||null!=this.follow)?this.flags|1:this.flags&-2;a&&0!=(this.flags&131072)&&(this.flags|=262144);return a},set_culled:function(a){this.flags=a?this.flags|4:this.flags&-5;return a},set_visible:function(a){this.flags=a?this.flags|2:this.flags&-3;return a},set_allocated:function(a){this.flags=a?this.flags|32:this.flags&-33;return a},set_followPositionOnly:function(a){this.flags=
a?this.flags|8:this.flags&-9;return a},set_lightCameraCenter:function(a){this.flags=a?this.flags|16:this.flags&-17;return a},set_alwaysSyncAnimation:function(a){this.flags=a?this.flags|64:this.flags&-65;return a},set_ignoreBounds:function(a){this.flags=a?this.flags|512:this.flags&-513;return a},set_inheritCulled:function(a){this.flags=a?this.flags|128:this.flags&-129;return a},set_ignoreCollide:function(a){this.flags=a?this.flags|1024:this.flags&-1025;return a},set_modelRoot:function(a){this.flags=
a?this.flags|256:this.flags&-257;return a},set_ignoreParentTransform:function(a){a!=(0!=(this.flags&2048))&&(this.flags|=1,0!=(this.flags&131072)&&(this.flags|=262144));var b=2048;this.flags=a?this.flags|b:this.flags&~b;return a},set_cullingColliderInherited:function(a){this.flags=a?this.flags|4096:this.flags&-4097;return a},set_fixedPosition:function(a){this.flags=a?this.flags|8192:this.flags&-8193;return a},set_alwaysSync:function(a){this.flags=a?this.flags|32768:this.flags&-32769;return a},set_drawn:function(a){this.flags=
a?this.flags|65536:this.flags&-65537;return a},playAnimation:function(a){return this.currentAnimation=a.createInstance(this)},switchToAnimation:function(a){return this.currentAnimation=a},stopAnimation:function(a){null==a&&(a=!1);this.currentAnimation=null;if(a){a=0;for(var b=this.children;a<b.length;){var c=b[a];++a;c.stopAnimation(!0)}}},applyAnimationTransform:function(a){null==a&&(a=!0);if(null!=this.defaultTransform){var b=this.defaultTransform;var c=Math.sqrt(b._11*b._11+b._12*b._12+b._13*b._13);
var d=Math.sqrt(b._21*b._21+b._22*b._22+b._23*b._23);var e=Math.sqrt(b._31*b._31+b._32*b._32+b._33*b._33);0>b._11*(b._22*b._33-b._23*b._32)+b._12*(b._23*b._31-b._21*b._33)+b._13*(b._21*b._32-b._22*b._31)&&(c*=-1,d*=-1,e*=-1);this.scaleX=c;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleY=d;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleZ=e;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=
262144);this.qRot.initRotateMatrix(this.defaultTransform);this.x=d=this.defaultTransform._41;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.y=d=this.defaultTransform._42;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.z=d=this.defaultTransform._43;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.defaultTransform=null;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&
(this.flags|=262144)}if(a)for(d=0,e=this.children;d<e.length;)a=e[d],++d,a.applyAnimationTransform()},getObjectsCount:function(){for(var a=0,b=0,c=this.children;b<c.length;){var d=c[b];++b;a+=d.getObjectsCount()+1}return a},getMaterialByName:function(a){for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d=d.getMaterialByName(a);if(null!=d)return d}return null},contains:function(a){for(;null!=a;)if(a=a.parent,a==this)return!0;return!1},find:function(a){var b=a(this);if(null!=b)return b;for(var c=
0,d=this.children;c<d.length;)if(b=d[c],++c,b=b.find(a),null!=b)return b;return null},findAll:function(a,b){null==b&&(b=[]);var c=a(this);null!=c&&b.push(c);c=0;for(var d=this.children;c<d.length;){var e=d[c];++c;e.findAll(a,b)}return b},getMaterials:function(a,b){null==b&&(b=!0);null==a&&(a=[]);if(b){b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d.getMaterials(a)}}return a},localToGlobal:function(a){this.syncPos();null==a&&(a=new I(0,0,0));var b=this.absPos,c=a.x*b._12+a.y*b._22+a.z*b._32+
b._42,d=a.x*b._13+a.y*b._23+a.z*b._33+b._43;a.x=a.x*b._11+a.y*b._21+a.z*b._31+b._41;a.y=c;a.z=d;return a},globalToLocal:function(a){var b=this.getInvPos(),c=a.x*b._12+a.y*b._22+a.z*b._32+b._42,d=a.x*b._13+a.y*b._23+a.z*b._33+b._43;a.x=a.x*b._11+a.y*b._21+a.z*b._31+b._41;a.y=c;a.z=d;return a},getInvPos:function(){this.syncPos();null==this.invPos&&(this.invPos=new ma,this.invPos._44=0);0==this.invPos._44&&this.invPos.inverse3x4(this.absPos);return this.invPos},getBounds:function(a,b){null==a&&(a=new fb);
null!=this.parent&&this.parent!=b&&this.parent.syncPos();this.addBoundsRec(a,null==b?null:b.getInvPos());return a},addBoundsRec:function(a,b){var c;if(0!=(this.flags&1)){var d=0;for(c=this.children;d<c.length;){var e=c[d];++d;var f=1;var g=!0;e.flags=g?e.flags|f:e.flags&~f;g&&0!=(e.flags&131072)&&(e.flags|=262144)}f=1;this.flags=(g=null!=this.follow)?this.flags|f:this.flags&~f;g&&0!=(this.flags&131072)&&(this.flags|=262144);this.calcAbsPos()}d=0;for(c=this.children;d<c.length;)e=c[d],++d,e.addBoundsRec(a,
b)},getMeshes:function(a){null==a&&(a=[]);var b=this instanceof Ua?this:null;null!=b&&a.push(b);b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d.getMeshes(a)}return a},getMeshByName:function(a){a=this.getObjectByName(a);return a instanceof Ua?a:null},getObjectByName:function(a){if(this.name==a)return this;for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d=d.getObjectByName(a);if(null!=d)return d}return null},clone:function(a){null==a&&(a=new Aa);var b=this.x;a.x=b;b=1;var c=!0;a.flags=
c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.y;a.y=b;b=1;c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.z;a.z=b;b=1;c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.scaleX;a.scaleX=b;b=1;c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.scaleY;a.scaleY=b;b=1;c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.scaleZ;a.scaleZ=b;b=1;
c=!0;a.flags=c?a.flags|b:a.flags&~b;c&&0!=(a.flags&131072)&&(a.flags|=262144);b=a.qRot;c=this.qRot;b.x=c.x;b.y=c.y;b.z=c.z;b.w=c.w;a.name=this.name;a.set_follow(this.follow);c=0!=(this.flags&8);b=8;a.flags=c?a.flags|b:a.flags&~b;c=0!=(this.flags&2);b=2;a.flags=c?a.flags|b:a.flags&~b;null!=this.defaultTransform&&(b=this.defaultTransform.clone(),a.defaultTransform=b,b=1,c=!0,a.flags=c?a.flags|b:a.flags&~b,c&&0!=(a.flags&131072)&&(a.flags|=262144));b=0;for(c=this.children;b<c.length;){var d=c[b];++b;
d=d.clone();d.parent=a;a.children.push(d)}return a},addChild:function(a){this.addChildAt(a,this.children.length)},addChildAt:function(a,b){var c;0>b&&(b=0);b>this.children.length&&(b=this.children.length);for(c=this;null!=c;){if(c==a)throw u.thrown("Recursive addChild");c=c.parent}if(null!=a.parent){var d=0!=(a.flags&32);a.flags&=-33;a.parent.removeChild(a);c=32;a.flags=d?a.flags|c:a.flags&~c}this.children.splice(b,0,a);if(0==(this.flags&32)&&0!=(a.flags&32))a.onRemove();a.parent=this;a.flags|=1;
0!=(a.flags&131072)&&(a.flags|=262144);if(0!=(this.flags&32))if(0==(a.flags&32))a.onAdd();else a.onParentChanged()},iterVisibleMeshes:function(a){if(0!=(this.flags&2)&&(0==(this.flags&4)||0==(this.flags&128))){if(0==(this.flags&4)){var b=this instanceof Ua?this:null;null!=b&&a(b)}b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d.iterVisibleMeshes(a)}}},onParentChanged:function(){for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;c.onParentChanged()}},onAdd:function(){this.flags|=32;for(var a=
0,b=this.children;a<b.length;){var c=b[a];++a;c.onAdd()}},onRemove:function(){this.flags&=-33;for(var a=this.children.length-1;0<=a;)this.children[a--].onRemove()},removeChild:function(a){if(D.remove(this.children,a)){if(0!=(a.flags&32))a.onRemove();a.parent=null;a.flags|=1;0!=(a.flags&131072)&&(a.flags|=262144)}},removeChildren:function(){for(;0<this.children.length;)this.removeChild(this.children[0])},remove:function(){null!=this.parent&&this.parent.removeChild(this)},getScene:function(){for(var a=
this;null!=a.parent;)a=a.parent;return a instanceof ld?a:null},getAbsPos:function(){this.syncPos();return this.absPos},getRelPos:function(a){if(null==a)return this.getAbsPos();this.syncPos();var b=new ma;b.multiply(this.absPos,a.getInvPos());return b},isMesh:function(){return null!=(this instanceof Ua?this:null)},toMesh:function(){var a=this instanceof Ua?this:null;if(null!=a)return a;throw u.thrown(w.string(this)+" is not a Mesh");},getCollider:function(){if(0!=(this.flags&1024))return null;var a=
[],b=this.getGlobalCollider();null!=b&&a.push(b);b=0;for(var c=this.children;b<c.length;){var d=c[b];++b;d=d.getCollider();if(null!=d){var e=d instanceof wf?d:null;if(null!=e)for(d=0,e=e.colliders;d<e.length;){var f=e[d];++d;a.push(f)}else a.push(d)}}return 0==a.length?null:1==a.length?a[0]:new wf(a)},getGlobalCollider:function(){if(0!=(this.flags&1024))return null;var a=this.getLocalCollider();return null==a?null:new Bc(this,a)},getLocalCollider:function(){return null},draw:function(a){},set_follow:function(a){this.flags|=
1;0!=(this.flags&131072)&&(this.flags|=262144);return this.follow=a},computeVelocity:function(){return-1!=this.prevAbsPosFrame},calcPrevAbsPos:function(){this.computeVelocity()?this.prevAbsPosFrame<ba.frameCount&&(this.prevAbsPosFrame=ba.frameCount,null==this.prevAbsPos?this.prevAbsPos=this.absPos.clone():this.prevAbsPos.load(this.absPos)):this.prevAbsPos=null},calcAbsPos:function(){var a;this.calcPrevAbsPos();this.qRot.toMatrix(this.absPos);this.absPos._11*=this.scaleX;this.absPos._12*=this.scaleX;
this.absPos._13*=this.scaleX;this.absPos._21*=this.scaleY;this.absPos._22*=this.scaleY;this.absPos._23*=this.scaleY;this.absPos._31*=this.scaleZ;this.absPos._32*=this.scaleZ;this.absPos._33*=this.scaleZ;this.absPos._41=this.x;this.absPos._42=this.y;this.absPos._43=this.z;if(null!=this.follow)if(this.follow.syncPos(),0!=(this.flags&8)){var b=a=this.absPos;var c=this.parent.absPos;var d=b._11;var e=b._12;var f=b._13;var g=b._21;var h=b._22;var k=b._23;var l=b._31;var m=b._32;var p=b._33;var t=b._41;
var n=b._42;var r=b._43;var y=c._11;var q=c._12;var u=c._13;var v=c._21;var w=c._22;var x=c._23;var z=c._31;var A=c._32;var B=c._33;var C=c._41;b=c._42;c=c._43;a._11=d*y+e*v+f*z;a._12=d*q+e*w+f*A;a._13=d*u+e*x+f*B;a._14=0;a._21=g*y+h*v+k*z;a._22=g*q+h*w+k*A;a._23=g*u+h*x+k*B;a._24=0;a._31=l*y+m*v+p*z;a._32=l*q+m*w+p*A;a._33=l*u+m*x+p*B;a._34=0;a._41=t*y+n*v+r*z+C;a._42=t*q+n*w+r*A+b;a._43=t*u+n*x+r*B+c;a._44=1;this.absPos._41=this.x+this.follow.absPos._41;this.absPos._42=this.y+this.follow.absPos._42;
this.absPos._43=this.z+this.follow.absPos._43}else this.absPos.multiply3x4(this.absPos,this.follow.absPos);else null!=this.parent&&0==(this.flags&2048)&&(b=a=this.absPos,c=this.parent.absPos,d=b._11,e=b._12,f=b._13,g=b._21,h=b._22,k=b._23,l=b._31,m=b._32,p=b._33,t=b._41,n=b._42,r=b._43,y=c._11,q=c._12,u=c._13,v=c._21,w=c._22,x=c._23,z=c._31,A=c._32,B=c._33,C=c._41,b=c._42,c=c._43,a._11=d*y+e*v+f*z,a._12=d*q+e*w+f*A,a._13=d*u+e*x+f*B,a._14=0,a._21=g*y+h*v+k*z,a._22=g*q+h*w+k*A,a._23=g*u+h*x+k*B,a._24=
0,a._31=l*y+m*v+p*z,a._32=l*q+m*w+p*A,a._33=l*u+m*x+p*B,a._34=0,a._41=t*y+n*v+r*z+C,a._42=t*q+n*w+r*A+b,a._43=t*u+n*x+r*B+c,a._44=1);null!=this.defaultTransform&&(a=this.absPos,b=this.defaultTransform,c=this.absPos,d=b._11,e=b._12,f=b._13,g=b._21,h=b._22,k=b._23,l=b._31,m=b._32,p=b._33,t=b._41,n=b._42,r=b._43,y=c._11,q=c._12,u=c._13,v=c._21,w=c._22,x=c._23,z=c._31,A=c._32,B=c._33,C=c._41,b=c._42,c=c._43,a._11=d*y+e*v+f*z,a._12=d*q+e*w+f*A,a._13=d*u+e*x+f*B,a._14=0,a._21=g*y+h*v+k*z,a._22=g*q+h*w+
k*A,a._23=g*u+h*x+k*B,a._24=0,a._31=l*y+m*v+p*z,a._32=l*q+m*w+p*A,a._33=l*u+m*x+p*B,a._34=0,a._41=t*y+n*v+r*z+C,a._42=t*q+n*w+r*A+b,a._43=t*u+n*x+r*B+c,a._44=1);null!=this.invPos&&(this.invPos._44=0)},sync:function(a){},syncRec:function(a){var b;if(null!=this.currentAnimation){var c=this.parent;for(b=a.elapsedTime;0<b&&null!=this.currentAnimation;)b=this.currentAnimation.update(b);null!=this.currentAnimation&&(a.visibleFlag&&0!=(this.flags&2)&&0==(this.flags&4)||0!=(this.flags&64))&&this.currentAnimation.sync();
if(null==this.parent&&null!=c)return}if(0!=(this.flags&32768)||0==(this.flags&4)&&0!=(this.flags&2)&&a.visibleFlag){c=a.visibleFlag;if(0==(this.flags&2)||0!=(this.flags&4)&&0!=(this.flags&128))a.visibleFlag=!1;null==a.cullingCollider||null!=this.cullingCollider&&0==(this.flags&4096)?0!=(this.flags&4096)&&this.set_cullingCollider(null):(this.set_cullingCollider(a.cullingCollider),this.flags|=4096);var d=a.cullingCollider;0!=(this.flags&128)&&(a.cullingCollider=this.cullingCollider);var e=0!=(this.flags&
1);e&&this.calcAbsPos();if(0!=(this.flags&8192)){if(0!=(this.flags&16384)&&!e&&!a.wasContextLost){a.visibleFlag=c;a.cullingCollider=d;return}this.flags|=16384}this.flags&=-262145;this.flags|=131072;this.sync(a);this.flags&=-131073;e=e||0!=(this.flags&262144);0!=(this.flags&262144)&&this.calcAbsPos();var f=1;this.flags=(b=null!=this.follow)?this.flags|f:this.flags&~f;b&&0!=(this.flags&131072)&&(this.flags|=262144);this.lastFrame=a.frame;for(var g=0,h=this.children.length;g<h;){var k=this.children[g];
if(null==k)break;k.lastFrame!=a.frame&&(e&&(f=1,b=!0,k.flags=b?k.flags|f:k.flags&~f,b&&0!=(k.flags&131072)&&(k.flags|=262144)),k.syncRec(a));this.children[g]!=k?(g=0,h=this.children.length):++g}a.visibleFlag=c;a.cullingCollider=d}},syncPos:function(){var a;null!=this.parent&&this.parent.syncPos();if(0!=(this.flags&1)){var b=1;this.flags=(a=null!=this.follow)?this.flags|b:this.flags&~b;a&&0!=(this.flags&131072)&&(this.flags|=262144);this.calcAbsPos();for(var c=0,d=this.children;c<d.length;){var e=
d[c];++c;b=1;a=!0;e.flags=a?e.flags|b:e.flags&~b;a&&0!=(e.flags&131072)&&(e.flags|=262144)}}},emit:function(a){},emitRec:function(a){var b,c;if(0!=(this.flags&2)&&(0==(this.flags&4)||0==(this.flags&128)||a.computingStatic)){if(0!=(this.flags&1)){null!=this.currentAnimation&&this.currentAnimation.sync();var d=1;this.flags=(b=null!=this.follow)?this.flags|d:this.flags&~d;b&&0!=(this.flags&131072)&&(this.flags|=262144);this.calcAbsPos();var e=0;for(c=this.children;e<c.length;){var f=c[e];++e;d=1;b=!0;
f.flags=b?f.flags|d:f.flags&~d;b&&0!=(f.flags&131072)&&(f.flags|=262144)}}d=a.forcedScreenRatio;0!=(this.flags&65536)&&a.computeVelocity&&0==(this.flags&8192)&&0==(this.flags&4)?this.computeVelocity()||(this.prevAbsPosFrame=0):this.prevAbsPosFrame=-1;this.calcPrevAbsPos();if(0==(this.flags&4)||a.computingStatic)this.emit(a),this.flags&=-65537;e=0;for(c=this.children;e<c.length;)f=c[e],++e,f.emitRec(a);a.forcedScreenRatio=d}},set_x:function(a){this.x=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=
262144);return a},set_y:function(a){this.y=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},set_z:function(a){this.z=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},set_scaleX:function(a){this.scaleX=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},set_scaleY:function(a){this.scaleY=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},set_scaleZ:function(a){this.scaleZ=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=
262144);return a},set_defaultTransform:function(a){this.defaultTransform=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144);return a},setPosition:function(a,b,c){this.x=a;a=1;var d=!0;this.flags=d?this.flags|a:this.flags&~a;d&&0!=(this.flags&131072)&&(this.flags|=262144);this.y=b;a=1;this.flags=(d=!0,this.flags|a);d&&0!=(this.flags&131072)&&(this.flags|=262144);this.z=c;a=1;this.flags=(d=!0,this.flags|a);d&&0!=(this.flags&131072)&&(this.flags|=262144);a=1;this.flags=(d=!0,this.flags|a);
d&&0!=(this.flags&131072)&&(this.flags|=262144)},setTransform:function(a){var b;var c=Math.sqrt(a._11*a._11+a._12*a._12+a._13*a._13);var d=Math.sqrt(a._21*a._21+a._22*a._22+a._23*a._23);var e=Math.sqrt(a._31*a._31+a._32*a._32+a._33*a._33);0>a._11*(a._22*a._33-a._23*a._32)+a._12*(a._23*a._31-a._21*a._33)+a._13*(a._21*a._32-a._22*a._31)&&(c*=-1,d*=-1,e*=-1);this.x=b=a._41;b=1;var f=!0;this.flags=f?this.flags|b:this.flags&~b;f&&0!=(this.flags&131072)&&(this.flags|=262144);this.y=b=a._42;b=1;this.flags=
(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);this.z=b=a._43;b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleX=c;b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleY=d;b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleZ=e;b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144);Aa.tmpMat.load(a);Aa.tmpMat.prependScale(1/c,
1/d,1/e);this.qRot.initRotateMatrix(Aa.tmpMat);b=1;this.flags=(f=!0,this.flags|b);f&&0!=(this.flags&131072)&&(this.flags|=262144)},getTransform:function(a){null==a&&(a=new ma);a.initScale(this.scaleX,this.scaleY,this.scaleZ);this.qRot.toMatrix(Aa.tmpMat);a.multiply3x4(a,Aa.tmpMat);a._41=this.x;a._42=this.y;a._43=this.z;return a},rotate:function(a,b,c,d){null==d&&(d=new Hc);d.initRotation(a,b,c);this.qRot.multiply(d,this.qRot);this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},setRotation:function(a,
b,c){this.qRot.initRotation(a,b,c);this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},setRotationAxis:function(a,b,c,d){this.qRot.initRotateAxis(a,b,c,d);this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},setDirection:function(a,b){this.qRot.initDirection(a,b);this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},getLocalDirection:function(){var a=this.qRot,b=1-2*(a.y*a.y+a.z*a.z),c=2*(a.x*a.y+a.z*a.w);a=2*(a.x*a.z-a.y*a.w);null==a&&(a=0);null==c&&(c=0);null==b&&(b=0);return new I(b,
c,a)},getRotationQuat:function(){return this.qRot},setRotationQuat:function(a){this.qRot=a;this.flags|=1;0!=(this.flags&131072)&&(this.flags|=262144)},scale:function(a){var b;this.scaleX=b=this.scaleX*a;b=1;var c=!0;this.flags=c?this.flags|b:this.flags&~b;c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleY=b=this.scaleY*a;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleZ=b=this.scaleZ*a;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&
(this.flags|=262144);b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144)},setScale:function(a){this.scaleX=a;var b=1;var c=!0;this.flags=c?this.flags|b:this.flags&~b;c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleY=a;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);this.scaleZ=a;b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&(this.flags|=262144);b=1;this.flags=(c=!0,this.flags|b);c&&0!=(this.flags&131072)&&
(this.flags|=262144)},toString:function(){return Z.getClass(this).__name__.split(".").pop()+(null==this.name?"":"("+this.name+")")},getChildAt:function(a){return this.children[a]},getChildIndex:function(a){for(var b=0,c=this.children.length;b<c;){var d=b++;if(this.children[d]==a)return d}return-1},get_numChildren:function(){return this.children.length},iterator:function(){return new si(this.children)},__class__:Aa};var ch=function(a){this.boxes=[];Aa.call(this,null);this.col=a;this.skin=a.obj;this.box=
new xf(16777215,a.currentBounds);this.addChild(this.box);1!=(0!=(this.flags&2048))&&(this.flags|=1,0!=(this.flags&131072)&&(this.flags|=262144));this.flags|=2048;this.createJoints()};z["h3d.col.SkinColliderDebugObj"]=ch;ch.__name__="h3d.col.SkinColliderDebugObj";ch.__super__=Aa;ch.prototype=J(Aa.prototype,{createJoints:function(){for(var a=this.skin.getSkinData().allJoints,b=0;b<a.length;){var c=a[b];++b;var d=new fb;d.xMin=-1;d.yMin=-1;d.zMin=-1;d.xMax=1;d.yMax=1;d.zMax=1;d=new xf(10526880,d,null,
this);if(null!=c.offsets){var e=d.bounds;e.xMin=1E20;e.xMax=-1E20;e.yMin=1E20;e.yMax=-1E20;e.zMin=1E20;e.zMax=-1E20;var f=c.offsets,g=f.xMin;e=f.yMin;var h=f.zMin;null==h&&(h=0);null==e&&(e=0);null==g&&(g=0);f=e;null==h&&(h=0);null==f&&(f=0);null==g&&(g=0);e=d.bounds;var k=c.offsetRay;g-k<e.xMin&&(e.xMin=g-k);g+k>e.xMax&&(e.xMax=g+k);f-k<e.yMin&&(e.yMin=f-k);f+k>e.yMax&&(e.yMax=f+k);h-k<e.zMin&&(e.zMin=h-k);h+k>e.zMax&&(e.zMax=h+k);f=c.offsets;g=f.xMax;e=f.yMax;h=f.zMax;null==h&&(h=0);null==e&&(e=
0);null==g&&(g=0);f=e;null==h&&(h=0);null==f&&(f=0);null==g&&(g=0);e=d.bounds;c=c.offsetRay;g-c<e.xMin&&(e.xMin=g-c);g+c>e.xMax&&(e.xMax=g+c);f-c<e.yMin&&(e.yMin=f-c);f+c>e.yMax&&(e.yMax=f+c);h-c<e.zMin&&(e.zMin=h-c);h+c>e.zMax&&(e.zMax=h+c)}else c=d.bounds,c.xMin=1E20,c.xMax=-1E20,c.yMin=1E20,c.yMax=-1E20,c.zMin=1E20,c.zMax=-1E20,c=d.bounds,-.1<c.xMin&&(c.xMin=-.1),.1>c.xMax&&(c.xMax=.1),-.1<c.yMin&&(c.yMin=-.1),.1>c.yMax&&(c.yMax=.1),-.1<c.zMin&&(c.zMin=-.1),.1>c.zMax&&(c.zMax=.1);this.boxes.push(d)}},
updateJoints:function(){for(var a=0,b=this.boxes.length;a<b;){var c=a++,d=this.skin.skinData.allJoints[c];c=this.boxes[c];null!=d.offsets?c.setTransform(this.skin.currentPalette[d.bindIndex]):c.setTransform(this.skin.jointsData[d.index].currentAbsPose)}},sync:function(a){this.col.checkBounds();this.updateJoints()},__class__:ch});var ud=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=
c;this.r=d};z["h3d.col.Sphere"]=ud;ud.__name__="h3d.col.Sphere";ud.__super__=Jb;ud.prototype=J(Jb.prototype,{load:function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.r=d},getCenter:function(){var a=this.x,b=this.y,c=this.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)},distance:function(a){var b=a.x-this.x,c=a.y-this.y;a=a.z-this.z;b=b*b+c*c+a*a-this.r*this.r;return 0>b?-Math.sqrt(-b):Math.sqrt(b)},distanceSq:function(a){var b=
a.x-this.x,c=a.y-this.y;a=a.z-this.z;return b*b+c*c+a*a-this.r*this.r},contains:function(a){var b=a.x-this.x,c=a.y-this.y;a=a.z-this.z;return 0>b*b+c*c+a*a-this.r*this.r},rayIntersection:function(a,b){b=a.px-this.x;var c=a.py-this.y,d=a.pz-this.z;a=b*a.lx+c*a.ly+d*a.lz;b=b*b+c*c+d*d-this.r*this.r;if(0<b&&0<a)return-1;b=a*a-b;if(0>b)return-1;a=-a-Math.sqrt(b);return 0>a?0:a},inFrustum:function(a,b){return null!=b?this.inFrustumMatrix(a,b):a.hasSphere(this)},inFrustumMatrix:function(a,b){var c=this.x,
d=this.y,e=this.z,f=this.r,g=this.x,h=this.y,k=this.z;null==k&&(k=0);null==h&&(h=0);null==g&&(g=0);var l=k;null==l&&(l=0);null==h&&(h=0);null==g&&(g=0);k=g;g=h;h=l;l=k*b._12+g*b._22+h*b._32+b._42;var m=k*b._13+g*b._23+h*b._33+b._43;this.x=k*b._11+g*b._21+h*b._31+b._41;this.y=l;this.z=m;k=Math.sqrt(b._11*b._11+b._12*b._12+b._13*b._13);g=Math.sqrt(b._21*b._21+b._22*b._22+b._23*b._23);h=Math.sqrt(b._31*b._31+b._32*b._32+b._33*b._33);0>b._11*(b._22*b._33-b._23*b._32)+b._12*(b._23*b._31-b._21*b._33)+b._13*
(b._21*b._32-b._22*b._31)&&(k*=-1,g*=-1,h*=-1);this.r*=Math.abs(Math.max(Math.max(k,g),h));a=a.hasSphere(this);this.x=c;this.y=d;this.z=e;this.r=f;return a},transform:function(a){var b=Math.sqrt(a._11*a._11+a._12*a._12+a._13*a._13);var c=Math.sqrt(a._21*a._21+a._22*a._22+a._23*a._23);var d=Math.sqrt(a._31*a._31+a._32*a._32+a._33*a._33);0>a._11*(a._22*a._33-a._23*a._32)+a._12*(a._23*a._31-a._21*a._33)+a._13*(a._21*a._32-a._22*a._31)&&(b*=-1,c*=-1,d*=-1);var e=0>b?-b:b;b=c;c=0>b?-b:b;e=e<c?c:e;b=d;
c=0>b?-b:b;this.r*=e<c?c:e;c=this.x;b=this.y;d=this.z;null==d&&(d=0);null==b&&(b=0);null==c&&(c=0);e=d;null==e&&(e=0);null==b&&(b=0);null==c&&(c=0);d=c;c=b;b=e;e=d*a._12+c*a._22+b*a._32+a._42;var f=d*a._13+c*a._23+b*a._33+a._43;this.x=d*a._11+c*a._21+b*a._31+a._41;this.y=e;this.z=f},inSphere:function(a){var b=this.x,c=this.y,d=this.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);var e=b,f=c,g=d;b=a.x;c=a.y;d=a.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=
0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);e=b-e;f=c-f;g=d-g;return e*e+f*f+g*g<(a.r+this.r)*(a.r+this.r)},toString:function(){var a=this.x,b=this.y,c=this.z;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return"Sphere{"+w.string(new I(a,b,c))+","+X.fmt(this.r)+"}"},dimension:function(){return this.r},closestPoint:function(a){var b=this.x,c=this.y,d=this.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=a.x-b;c=a.y-c;d=a.z-d;null==d&&(d=0);null==c&&(c=
0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a=b*b+c*c+d*d;a=1E-20>a?0:1/Math.sqrt(a);b*=a;c*=a;d*=a;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a=this.r;b*=a;c*=a;d*=a;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a=b;var e=c,f=d;b=this.x;c=this.y;d=this.z;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);b=a+b;c=e+c;d=f+d;null==d&&(d=0);null==c&&(c=
0);null==b&&(b=0);return new I(b,c,d)},clone:function(){var a=new ud;a.x=this.x;a.y=this.y;a.z=this.z;a.r=this.r;return a},makeDebugObj:function(){var a=Ke.defaultUnitSphere();a=new Ua(a);var b=this.r;var c=a.scaleX*b;a.scaleX=c;c=1;var d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);c=a.scaleY*b;a.scaleY=c;c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);c=a.scaleZ*b;a.scaleZ=c;c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&
(a.flags|=262144);c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);b=this.y;var e=this.z;a.x=this.x;c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);a.y=b;c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);a.z=e;c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);c=1;d=!0;a.flags=d?a.flags|c:a.flags&~c;d&&0!=(a.flags&131072)&&(a.flags|=262144);return a},__class__:ud});var Ta=
L["h3d.impl.Feature"]={__ename__:!0,__constructs__:null,StandardDerivatives:{_hx_name:"StandardDerivatives",_hx_index:0,__enum__:"h3d.impl.Feature",toString:v},FloatTextures:{_hx_name:"FloatTextures",_hx_index:1,__enum__:"h3d.impl.Feature",toString:v},AllocDepthBuffer:{_hx_name:"AllocDepthBuffer",_hx_index:2,__enum__:"h3d.impl.Feature",toString:v},HardwareAccelerated:{_hx_name:"HardwareAccelerated",_hx_index:3,__enum__:"h3d.impl.Feature",toString:v},MultipleRenderTargets:{_hx_name:"MultipleRenderTargets",
_hx_index:4,__enum__:"h3d.impl.Feature",toString:v},Queries:{_hx_name:"Queries",_hx_index:5,__enum__:"h3d.impl.Feature",toString:v},SRGBTextures:{_hx_name:"SRGBTextures",_hx_index:6,__enum__:"h3d.impl.Feature",toString:v},ShaderModel3:{_hx_name:"ShaderModel3",_hx_index:7,__enum__:"h3d.impl.Feature",toString:v},BottomLeftCoords:{_hx_name:"BottomLeftCoords",_hx_index:8,__enum__:"h3d.impl.Feature",toString:v},Wireframe:{_hx_name:"Wireframe",_hx_index:9,__enum__:"h3d.impl.Feature",toString:v},InstancedRendering:{_hx_name:"InstancedRendering",
_hx_index:10,__enum__:"h3d.impl.Feature",toString:v}};Ta.__constructs__=[Ta.StandardDerivatives,Ta.FloatTextures,Ta.AllocDepthBuffer,Ta.HardwareAccelerated,Ta.MultipleRenderTargets,Ta.Queries,Ta.SRGBTextures,Ta.ShaderModel3,Ta.BottomLeftCoords,Ta.Wireframe,Ta.InstancedRendering];Ta.__empty_constructs__=[Ta.StandardDerivatives,Ta.FloatTextures,Ta.AllocDepthBuffer,Ta.HardwareAccelerated,Ta.MultipleRenderTargets,Ta.Queries,Ta.SRGBTextures,Ta.ShaderModel3,Ta.BottomLeftCoords,Ta.Wireframe,Ta.InstancedRendering];
var dh=L["h3d.impl.QueryKind"]={__ename__:!0,__constructs__:null,TimeStamp:{_hx_name:"TimeStamp",_hx_index:0,__enum__:"h3d.impl.QueryKind",toString:v},Samples:{_hx_name:"Samples",_hx_index:1,__enum__:"h3d.impl.QueryKind",toString:v}};dh.__constructs__=[dh.TimeStamp,dh.Samples];dh.__empty_constructs__=[dh.TimeStamp,dh.Samples];var eh=L["h3d.impl.RenderFlag"]={__ename__:!0,__constructs__:null,CameraHandness:{_hx_name:"CameraHandness",_hx_index:0,__enum__:"h3d.impl.RenderFlag",toString:v}};eh.__constructs__=
[eh.CameraHandness];eh.__empty_constructs__=[eh.CameraHandness];var Nd=function(){this.shaderCache=Nd.SHADER_CACHE};z["h3d.impl.Driver"]=Nd;Nd.__name__="h3d.impl.Driver";Nd.setShaderCache=function(a){Nd.SHADER_CACHE=a};Nd.prototype={hasFeature:function(a){return!1},setRenderFlag:function(a,b){},isSupportedFormat:function(a){return!1},isDisposed:function(){return!0},dispose:function(){},begin:function(a){},log:function(a){},generateMipMaps:function(a){throw u.thrown("Mipmaps auto generation is not supported on this platform");
},getNativeShaderCode:function(a){return null},logImpl:function(a){},clear:function(a,b,c){},captureRenderBuffer:function(a){},capturePixels:function(a,b,c,d){throw u.thrown("Can't capture pixels on this platform");},getDriverName:function(a){return"Not available"},init:function(a,b){},resize:function(a,b){},selectShader:function(a){return!1},selectMaterial:function(a){},uploadShaderBuffers:function(a,b){},selectBuffer:function(a){},selectMultiBuffers:function(a,b){},draw:function(a,b,c){},drawInstanced:function(a,
b){},setRenderZone:function(a,b,c,d){},setRenderTarget:function(a,b,c,d){},setRenderTargets:function(a,b){},setDepth:function(a){},allocDepthBuffer:function(a){return null},disposeDepthBuffer:function(a){},getDefaultDepthBuffer:function(){return null},present:function(){},end:function(){},setDebug:function(a){},allocTexture:function(a){return null},allocBuffer:function(a){return null},allocInstanceBuffer:function(a,b){},uploadInstanceBufferBytes:function(a,b,c,d,e){},disposeTexture:function(a){},
disposeBuffer:function(a){},disposeInstanceBuffer:function(a){},uploadIndexData:function(a,b,c,d,e){},uploadBufferData:function(a,b,c,d,e){},uploadBufferBytes:function(a,b,c,d,e){},uploadTextureBitmap:function(a,b,c,d){},uploadTexturePixels:function(a,b,c,d){},readBufferBytes:function(a,b,c,d,e){},onTextureBiasChanged:function(a){},copyTexture:function(a,b){return!1},allocQuery:function(a){return null},deleteQuery:function(a){},beginQuery:function(a){},endQuery:function(a){},queryResultAvailable:function(a){return!0},
queryResult:function(a){return 0},computeDispatch:function(a,b,c){throw u.thrown("Compute shaders are not implemented on this platform");},__class__:Nd};var ti=function(a,b,c){this.s=a;this.kind=b;this.shader=c};z["h3d.impl._GlDriver.CompiledShader"]=ti;ti.__name__="h3d.impl._GlDriver.CompiledShader";ti.prototype={__class__:ti};var ui=function(){};z["h3d.impl._GlDriver.CompiledAttribute"]=ui;ui.__name__="h3d.impl._GlDriver.CompiledAttribute";ui.prototype={__class__:ui};var vi=function(){};z["h3d.impl._GlDriver.CompiledProgram"]=
vi;vi.__name__="h3d.impl._GlDriver.CompiledProgram";vi.prototype={__class__:vi};var fa=function(a){null==a&&(a=0);this.features=new Le;this.maxCompressedTexturesSupport=0;this.rightHanded=this.hasMultiIndirect=!1;this.firstShader=!0;this.boundTextures=[];this.curTargets=[];var b=[];b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);
b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);b.push(0);this.currentDivisor=b;this.curColorMask=-1;this.lastActiveIndex=0;this.curStEnabled=!1;this.curMatBits=this.curStOpBits=this.curStMaskBits=-1;this.maxIdxCurAttribs=0;this.curAttribs=[];Nd.call(this);this.canvas=Gb.getInstance().canvas;a={alpha:!1,stencil:!0,antialias:0<a};fa.ALLOW_WEBGL2&&(this.gl=this.canvas.getContext("webgl2",a));null==this.gl&&(this.gl=yj.getContextWebGL(this.canvas,a));if(null==
this.gl)throw u.thrown("Could not acquire GL context");"undefined"!=typeof WebGLDebugUtils&&(this.gl=WebGLDebugUtils.makeDebugContext(this.gl),this.glDebug=!0);this.commonFB=this.gl.createFramebuffer();this.programs=new Da;this.defStencil=new wa;this.frame=ba.frameCount;a=this.gl.getParameter(7938);b=new nf("ES ([0-9]+\\.[0-9]+)","");b.match(a)&&(this.glES=parseFloat(b.matched(1)));b=new nf("[0-9]+\\.[0-9]+","");a=this.gl.getParameter(35724);b.match(a)&&(this.glES=parseFloat(b.matched(0)),this.shaderVersion=
Math.round(100*parseFloat(b.matched(0))));this.drawMode=4;this.makeFeatures();this.hasFeature(Ta.InstancedRendering)&&3>this.glES&&(a=this.gl.getExtension("ANGLE_instanced_arrays"),this.gl.vertexAttribDivisor=M(a,a.vertexAttribDivisorANGLE),this.gl.drawElementsInstanced=M(a,a.drawElementsInstancedANGLE));Qb.UNROLL_LOOPS=!this.hasFeature(Ta.ShaderModel3);this.gl.pixelStorei(3333,1);this.gl.pixelStorei(3317,1)};z["h3d.impl.GlDriver"]=fa;fa.__name__="h3d.impl.GlDriver";fa.__super__=Nd;fa.prototype=J(Nd.prototype,
{setRenderFlag:function(a,b){this.rightHanded=0<b},logImpl:function(a){console.log(a)},setDebug:function(a){this.debug=a},begin:function(a){this.frame=a;this.resetStream();this.gl.useProgram(null);this.curBuffer=this.curShader=null},makeCompiler:function(){var a=new Xb;a.glES=this.glES;a.version=this.shaderVersion;a.intelDriverFix=this.isIntelGpu;return a},getNativeShaderCode:function(a){if(a.mode==Kb.Compute){var b=a.vertex.data;return this.makeCompiler().run(b)}b=a.vertex.data;var c="// vertex:\n"+
this.makeCompiler().run(b)+"// fragment:\n";b=a.fragment.data;return c+this.makeCompiler().run(b)},getDriverName:function(a){var b=this.gl.getParameter(7937);b=a?b+(" GLv"+w.string(this.gl.getParameter(7938))):b.split("/").shift();b=b.split("WebGL ").join("");return"OpenGL "+b},compileShader:function(a,b){switch(b.kind._hx_index){case 0:var c=35633;break;case 1:c=35632;break;case 4:throw u.thrown("Compute shader is not supported");default:throw u.thrown("assert");}c=this.gl.createShader(c);null==
b.code&&(b.code=a.run(b.data),b.data.funs=null);this.gl.shaderSource(c,b.code);this.gl.compileShader(c);if(1!=this.gl.getShaderParameter(c,35713)){a=this.gl.getShaderInfoLog(c);c=w.parseInt(D.substr(a,9,null));c=null==c?null:b.code.split("\n")[c-1];c=null==c?"":"("+aa.trim(c)+")";b=b.code.split("\n");for(var d=0,e=b.length;d<e;){var f=d++;b[f]=f+1+"\t"+b[f]}throw u.thrown("An error occurred compiling the shaders: "+a+c+"\n\n"+b.join("\n"));}return new ti(c,b.kind,b)},initShader:function(a,b,c,d){switch(b.kind._hx_index){case 0:var e=
"vertex";break;case 1:e="fragment";break;default:e="compute"}b.globals=this.gl.getUniformLocation(a.p,e+"Globals");b.params=this.gl.getUniformLocation(a.p,e+"Params");b.textures=[];var f=0;var g=null;for(var h=0,k="",l=c.textures;null!=l;){var m=l.type;var p=1;switch(m._hx_index){case 15:var t=m.size;0==t._hx_index&&(t=t.v,m=m.t,p=t);break;case 17:m=x.TSampler(tb.T2D,!1)}if(null==g||!la.enumEq(m,g)){g=m;switch(m._hx_index){case 10:t=m.dim;f=m.isArray;switch(t._hx_index){case 1:h=f?35866:3553;break;
case 2:if(0==f)h=32879;else throw u.thrown("Texture not supported "+w.string(m));break;case 3:if(0==f)h=34067;else throw u.thrown("Texture not supported "+w.string(m));break;default:throw u.thrown("Texture not supported "+w.string(m));}k="Textures"+(t==tb.T2D?"":D.substr(L[t.__enum__].__constructs__[t._hx_index]._hx_name,1,null))+(f?"Array":"");break;case 11:throw u.thrown("Texture not supported "+w.string(m));default:throw u.thrown("Unsupported texture type "+w.string(m));}f=0}m=0;for(t=p;m<t;){m++;
p=this.gl.getUniformLocation(a.p,e+k+"["+f+"]");if(null==p)throw u.thrown("Texture "+d.spec.instances[l.instance].shader.data.name+"."+l.name+" is missing from generated shader");b.textures.push({u:p,t:g,mode:h});++f}l=l.next}if(0<c.bufferCount){b.bufferTypes=[];for(e=b.shader.buffers;null!=e;){t=e.type;if(16==t._hx_index)t=t.kind;else throw u.thrown("assert");b.bufferTypes.push(t);e=e.next}t=[];e=0;for(m=c.bufferCount;e<m;){g=e++;switch(b.bufferTypes[g]._hx_index){case 0:g=this.gl.getUniformBlockIndex(a.p,
(c.kind==Ia.Vertex?"vertex_":"")+"uniform_buffer"+g);break;case 1:throw u.thrown("Storage buffer not supported in WebGL");case 2:throw u.thrown("RW buffer not supported in WebGL");default:throw u.thrown("assert");}t.push(g)}b.buffers=t;h=0;b.kind==Ia.Fragment&&(h=d.vertex.bufferCount);t=0;for(e=c.bufferCount;t<e;)switch(g=t++,b.bufferTypes[g]._hx_index){case 0:this.gl.uniformBlockBinding(a.p,b.buffers[g],g+h);break;case 1:case 2:break;default:throw u.thrown("assert");}}},selectShader:function(a){var b=
this.programs.h[a.id];if(null==b){b=new vi;var c=this.makeCompiler();b.vertex=this.compileShader(c,a.vertex);null!=a.fragment&&(b.fragment=this.compileShader(c,a.fragment));b.p=this.gl.createProgram();this.gl.attachShader(b.p,b.vertex.s);null!=b.fragment&&this.gl.attachShader(b.p,b.fragment.s);var d=null;try{this.gl.linkProgram(b.p),1!=this.gl.getProgramParameter(b.p,35714)&&(d=this.gl.getProgramInfoLog(b.p))}catch(t){throw a=u.caught(t).unwrap(),u.thrown("Shader linkage error: "+w.string(a)+" ("+
this.getDriverName(!1)+")");}this.gl.deleteShader(b.vertex.s);null!=b.fragment&&this.gl.deleteShader(b.fragment.s);if(null!=d)throw this.gl.deleteProgram(b.p),u.thrown("Program linkage failure: "+d+"\nVertex=\n"+a.vertex.code+(null==a.fragment?"":"\n\nFragment=\n"+a.fragment.code));this.firstShader=!1;this.initShader(b,b.vertex,a.vertex,a);null!=b.fragment&&this.initShader(b,b.fragment,a.fragment,a);b.attribs=[];b.hasAttribIndex=0;d=[];for(var e=0,f=a.vertex.data.vars;e<f.length;){var g=f[e];++e;
if(1==g.kind._hx_index){var h=Jc.fromHXSL(g.type),k=this.gl.getAttribLocation(b.p,c.varNames.h.hasOwnProperty(g.id)?c.varNames.h[g.id]:g.name);if(!(0>k)){if(32<=k)throw u.thrown("assert");var l=new ui;l.type=5126;l.index=k;l.size=h==Z.__cast(9,cc)?1:h;k=g.type;9==k._hx_index&&(k=k.size,l.type=5120,l.size=k);l.divisor=0;if(null!=g.qualifiers){k=0;for(var m=g.qualifiers;k<m.length;){var p=m[k];++k;9==p._hx_index&&(l.divisor=p.v)}}b.attribs.push(l);b.hasAttribIndex|=1<<l.index;d.push(new Ma(g.name,h,
0))}}}b.format=N.make(d);this.programs.h[a.id]=b}if(this.curShader==b)return!1;this.setProgram(b);return!0},setProgram:function(a){this.gl.useProgram(a.p);for(var b=0,c=a.attribs;b<c.length;){var d=c[b];++b;this.curAttribs[d.index]||(this.gl.enableVertexAttribArray(d.index),this.curAttribs[d.index]=!0,this.maxIdxCurAttribs<d.index&&(this.maxIdxCurAttribs=d.index))}var e=0;b=0;for(c=this.maxIdxCurAttribs+1;b<c;)d=b++,this.curAttribs[d]&&0==(a.hasAttribIndex&1<<d)?(this.gl.disableVertexAttribArray(d),
this.curAttribs[d]=!1):this.curAttribs[d]&&(e=d);this.maxIdxCurAttribs=e;this.curShader=a;this.curBuffer=null;b=0;for(c=this.boundTextures.length;b<c;)d=b++,this.boundTextures[d]=null},uploadShaderBuffers:function(a,b){this.uploadBuffer(a,this.curShader.vertex,a.vertex,b);null!=this.curShader.fragment&&this.uploadBuffer(a,this.curShader.fragment,a.fragment,b)},uploadBuffer:function(a,b,c,d){switch(d){case 0:null!=b.globals&&(c=c.globals.subarray(0,4*b.shader.globalsSize),this.gl.uniform4fv(b.globals,
c));break;case 1:null!=b.params&&(c=c.params.subarray(0,4*b.shader.paramsSize),this.gl.uniform4fv(b.params,c));break;case 2:var e=0;for(d=b.textures.length;e<d;){var f=e++;var g=c.tex[f],h=b.textures[f];if(null==g||null==g.t&&(g.isDepth()||null==g.realloc))if(g=h.t,10==g._hx_index){var k=g.isArray;if(3==g.dim._hx_index)if(0==k)g=Y.defaultCubeTexture();else throw u.thrown("Missing texture");else if(0==k)g=ad.loadingTextureColor,g=Y.fromColor(g,(g>>>24)/255);else throw u.thrown("Missing texture");}else throw u.thrown("Missing texture");
if(null!=g&&null==g.t&&null!=g.realloc&&(k=this.curShader,g.alloc(),g.realloc(),this.curShader!=k)){this.setProgram(k);this.uploadShaderBuffers(a,0);this.uploadShaderBuffers(a,1);this.uploadShaderBuffers(a,2);return}g.set_lastFrame(this.frame);if(null!=h.u){f=b.kind==Ia.Fragment?this.curShader.vertex.textures.length+f:f;if(this.boundTextures[f]!=g.t){this.boundTextures[f]=g.t;k=this.getBindType(g);if(k!=h.mode)throw u.thrown("Texture format mismatch: "+w.string(g)+" should be "+w.string(h.t));this.gl.activeTexture(33984+
f);this.gl.uniform1i(h.u,f);this.gl.bindTexture(k,g.t.t);this.lastActiveIndex=f}k=g.mipMap._hx_index;var l=g.filter._hx_index;f=g.wrap._hx_index;var m=k|l<<3|f<<6;m!=g.t.bits&&(g.t.bits=m,l=fa.TFILTERS[k][l],k=h.mode,this.gl.texParameteri(k,10240,l[0]),this.gl.texParameteri(k,10241,l[1]),this.gl.texParameteri(k,34892,0),f=fa.TWRAP[f],this.gl.texParameteri(k,10242,f),this.gl.texParameteri(k,10243,f));g.t.startMip!=g.startingMip&&(this.gl.texParameteri(h.mode,33084,g.startingMip),g.t.startMip=g.startingMip)}}break;
case 3:if(null!=b.buffers)for(a=0,b.kind==Ia.Fragment&&null!=this.curShader.vertex.buffers&&(a=this.curShader.vertex.buffers.length),e=0,d=b.buffers.length;e<d;)switch(f=e++,b.bufferTypes[f]._hx_index){case 0:this.gl.bindBufferBase(35345,f+a,c.buffers[f].vbuf);break;case 1:this.gl.bindBufferBase(37074,f+a,c.buffers[f].vbuf);break;case 2:if(0==(c.buffers[f].flags&1<<$a.ReadWriteBuffer._hx_index))throw u.thrown("Buffer was allocated without ReadWriteBuffer flag");this.gl.bindBufferBase(37074,f+a,c.buffers[f].vbuf);
break;default:throw u.thrown("assert");}}},selectMaterial:function(a){var b=a.bits;if(null==this.curTarget==this.rightHanded)switch(a.culling._hx_index){case 1:b=b&-4|2;break;case 2:b=b&-4|1}this.selectMaterialBits(b);if(this.curColorMask!=a.colorMask){b=a.colorMask;this.gl.colorMask(0!=(b&1),0!=(b&2),0!=(b&4),0!=(b&8));if(0<b>>4)throw u.thrown("GL ColorMaski support requires hlsdl 1.14+");this.curColorMask=b}b=this.defStencil;null==a.stencil?this.curStEnabled&&(this.gl.disable(2960),this.curStEnabled=
!1):(b=a.stencil,this.curStEnabled||(this.gl.enable(2960),this.curStEnabled=!0));this.selectStencilBits(b.opBits,b.maskBits)},selectMaterialBits:function(a){var b=a^this.curMatBits;0>this.curMatBits&&(b=-1);if(0!=b){this.drawMode=0!=(a&268435456)?3:4;if(0!=(b&3)){var c=a&3;0==c?this.gl.disable(2884):((0>this.curMatBits||0==(this.curMatBits&3))&&this.gl.enable(2884),this.gl.cullFace(fa.FACES[c]))}if(0!=(b&4194240)){c=a>>6&15;var d=a>>10&15,e=a>>14&15,f=a>>18&15;c==e&&d==f?0==c&&1==d?this.gl.disable(3042):
((0>this.curMatBits||0==(this.curMatBits>>6&15)&&1==(this.curMatBits>>10&15))&&this.gl.enable(3042),this.gl.blendFunc(fa.BLEND[c],fa.BLEND[d])):((0>this.curMatBits||0==(this.curMatBits>>6&15)&&1==(this.curMatBits>>10&15))&&this.gl.enable(3042),this.gl.blendFuncSeparate(fa.BLEND[c],fa.BLEND[d],fa.BLEND[e],fa.BLEND[f]))}0!=(b&264241152)&&(c=a>>22&7,d=a>>25&7,c==d?this.gl.blendEquation(fa.OP[c]):this.gl.blendEquationSeparate(fa.OP[c],fa.OP[d]));0!=(b&4)&&this.gl.depthMask(0!=(a>>2&1));0!=(b&56)&&(b=
a>>3&7,0==b?this.gl.disable(2929):((0>this.curMatBits||0==(this.curMatBits>>3&7))&&this.gl.enable(2929),this.gl.depthFunc(fa.COMPARE[b])));this.curMatBits=a}},selectStencilBits:function(a,b){var c=a^this.curStOpBits,d=b^this.curStMaskBits;0!=(c|d)&&(0!=(c&4088)&&this.gl.stencilOpSeparate(fa.FACES[2],fa.STENCIL_OP[a>>6&7],fa.STENCIL_OP[a>>9&7],fa.STENCIL_OP[a>>3&7]),0!=(c&16744448)&&this.gl.stencilOpSeparate(fa.FACES[1],fa.STENCIL_OP[a>>18&7],fa.STENCIL_OP[a>>21&7],fa.STENCIL_OP[a>>15&7]),0!=(c&7|
d&16711935)&&this.gl.stencilFuncSeparate(fa.FACES[2],fa.COMPARE[a&7],b>>16&255,b&255),0!=(c&28672|d&16711935)&&this.gl.stencilFuncSeparate(fa.FACES[1],fa.COMPARE[a>>12&7],b>>16&255,b&255),0!=(d&65280)&&(c=b>>8&255,this.gl.stencilMaskSeparate(fa.FACES[2],c),this.gl.stencilMaskSeparate(fa.FACES[1],c)),this.curStOpBits=a,this.curStMaskBits=b)},clear:function(a,b,c){var d=0;null!=a&&(this.gl.colorMask(!0,!0,!0,!0),this.curColorMask=15,this.gl.clearColor(a.x,a.y,a.z,a.w),d|=16384);null!=b&&(this.gl.depthMask(!0),
0<=this.curMatBits&&(this.curMatBits|=4),this.gl.clearDepth(b),d|=256);null!=c&&(this.selectStencilBits(this.defStencil.opBits,this.defStencil.maskBits),this.gl.clearStencil(c),d|=1024);0!=d&&this.gl.clear(d);null!=this.curTarget&&(this.curTarget.flags|=1<<O.WasCleared._hx_index)},resize:function(a,b){if(""==this.canvas.style.width){var c=a/window.devicePixelRatio|0;this.canvas.style.width=c+"px";c=b/window.devicePixelRatio|0;this.canvas.style.height=c+"px"}this.canvas.width=a;this.canvas.height=
b;this.bufferWidth=a;this.bufferHeight=b;this.gl.viewport(0,0,a,b);null!=this.defaultDepth&&(this.disposeDepthBuffer(this.defaultDepth),this.defaultDepth.width=this.bufferWidth,this.defaultDepth.height=this.bufferHeight,this.defaultDepth.t=this.allocDepthBuffer(this.defaultDepth))},getChannels:function(a){switch(a.internalFmt){case 6407:return 6407;case 6408:return 6408;case 32857:return 6408;case 6403:case 33321:case 33322:case 33325:case 33326:return 6403;case 33319:case 33323:case 33324:case 33327:case 33328:return 33319;
case 34836:case 34842:return 6408;case 35898:return 6407;case 35904:case 35905:return 6407;case 32859:case 33777:case 33778:case 33779:case 36492:return 6408;case 32852:case 34837:case 34843:case 36495:return 6407;default:throw u.thrown("Invalid format "+a.internalFmt);}},isSupportedFormat:function(a){switch(a._hx_index){case 2:return!0;case 3:case 4:return this.hasFeature(Ta.FloatTextures);case 14:case 15:return this.hasFeature(Ta.SRGBTextures);case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 16:case 17:return 3<=
this.glES;case 22:return a.v<=this.maxCompressedTexturesSupport;default:return!1}},getBindType:function(a){return 0!=(a.flags&1<<O.Is3D._hx_index)?32879:0!=(a.flags&1<<O.Cube._hx_index)?34067:0!=(a.flags&1<<O.IsArray._hx_index)?35866:3553},allocTexture:function(a){fa.outOfMemoryCheck&&this.gl.getError();var b=this.gl.createTexture();var c=this.getBindType(a);b={t:b,width:a.width,height:a.height,internalFmt:6408,pixelFmt:5121,bits:-1,bind:c,bias:0,startMip:a.startingMip};var d=a.format;switch(d._hx_index){case 1:b.internalFmt=
32856;break;case 2:break;case 3:if(this.hasFeature(Ta.FloatTextures))b.pixelFmt=5131,b.internalFmt=34842;else throw u.thrown("Unsupported texture format "+w.string(a.format));break;case 4:if(this.hasFeature(Ta.FloatTextures))b.internalFmt=34836,b.pixelFmt=5126;else throw u.thrown("Unsupported texture format "+w.string(a.format));break;case 5:b.internalFmt=33321;break;case 6:b.internalFmt=33325;b.pixelFmt=5131;break;case 7:b.internalFmt=33326;b.pixelFmt=5126;break;case 8:b.internalFmt=33323;break;
case 9:b.internalFmt=33327;b.pixelFmt=5131;break;case 10:b.internalFmt=33328;b.pixelFmt=5126;break;case 11:b.internalFmt=6407;break;case 12:b.internalFmt=34843;b.pixelFmt=5131;break;case 13:b.internalFmt=34837;b.pixelFmt=5126;break;case 14:b.internalFmt=35905;break;case 16:b.internalFmt=32857;b.pixelFmt=33640;break;case 17:b.internalFmt=35898;b.pixelFmt=35899;break;case 18:b.internalFmt=33322;b.pixelFmt=5123;break;case 19:b.internalFmt=33324;b.pixelFmt=5123;break;case 20:b.internalFmt=32852;b.pixelFmt=
5123;break;case 21:b.internalFmt=32859;b.pixelFmt=5123;break;case 22:d=d.v;if(d<=this.maxCompressedTexturesSupport){if(0!=(a.width&3)||0!=(a.height&3))throw u.thrown("Compressed texture "+w.string(a)+" has size "+a.width+"x"+a.height+" - must be a multiple of 4");switch(d){case 1:b.internalFmt=33777;break;case 2:b.internalFmt=33778;break;case 3:b.internalFmt=33779;break;case 6:b.internalFmt=36495;break;case 7:b.internalFmt=36492;break;default:throw u.thrown("Unsupported texture format "+w.string(a.format));
}}else throw u.thrown("Unsupported texture format "+w.string(a.format));break;default:throw u.thrown("Unsupported texture format "+w.string(a.format));}if(5123==b.pixelFmt&&!this.has16Bits)throw u.thrown("16 bit textures requires EXT_texture_norm16 extension");a.set_lastFrame(this.frame);a.flags&=-1-(1<<O.WasCleared._hx_index);this.gl.bindTexture(c,b.t);d=!1;this.gl.texParameteri(c,33084,a.startingMip);this.gl.texParameteri(c,33085,a.get_mipLevels()-1);var e=6408==b.internalFmt?32856:b.internalFmt;
0==(a.flags&1<<O.IsArray._hx_index)&&0==(a.flags&1<<O.Is3D._hx_index)||0!=(a.flags&1<<O.Cube._hx_index)?this.gl.texStorage2D(c,a.get_mipLevels(),e,b.width,b.height):this.gl.texStorage3D(c,a.get_mipLevels(),e,b.width,b.height,a.get_layerCount());if(fa.outOfMemoryCheck)if(c=this.gl.getError(),1285==c)d=!0;else if(0!=c)throw u.thrown("Failed to alloc texture "+w.string(a.format)+"(error "+c+")");this.restoreBind();return d?(this.gl.deleteTexture(b.t),null):b},restoreBind:function(){var a=this.boundTextures[this.lastActiveIndex];
null==a?this.gl.bindTexture(3553,null):this.gl.bindTexture(a.bind,a.t)},allocDepthBuffer:function(a){var b={t:this.gl.createTexture(),width:a.width,height:a.height,internalFmt:6408,pixelFmt:5121,bits:-1,bind:3553,bias:0,startMip:0},c=6402;switch(a.format._hx_index){case 23:b.internalFmt=33189;break;case 24:if(3<=this.glES)b.internalFmt=6402;else throw u.thrown("Unsupported depth format "+w.string(a.format));break;case 25:b.internalFmt=35056;b.pixelFmt=34042;c=34041;break;case 26:b.internalFmt=36012;
break;default:throw u.thrown("Unsupported depth format "+w.string(a.format));}a.set_lastFrame(this.frame);a.flags&=-1-(1<<O.WasCleared._hx_index);this.gl.bindTexture(b.bind,b.t);this.gl.texParameteri(b.bind,10241,9728);this.gl.texParameteri(b.bind,10240,9728);this.gl.texParameteri(b.bind,10242,33071);this.gl.texParameteri(b.bind,10243,33071);this.gl.texImage2D(b.bind,0,b.internalFmt,b.width,b.height,0,c,b.pixelFmt,null);this.restoreBind();return b},disposeDepthBuffer:function(a){null!=a.t&&null!=
a.t.t&&(this.gl.deleteTexture(a.t.t),a.t=null)},getDefaultDepthBuffer:function(){if(null!=this.defaultDepth)return this.defaultDepth;this.defaultDepth=new Y(0,0,null,F.Depth24Stencil8);this.defaultDepth.name="defaultDepthBuffer";this.defaultDepth.width=this.bufferWidth;this.defaultDepth.height=this.bufferHeight;this.defaultDepth.t=this.allocDepthBuffer(this.defaultDepth);return this.defaultDepth},discardError:function(){fa.outOfMemoryCheck&&this.gl.getError()},allocBuffer:function(a){fa.outOfMemoryCheck&&
this.gl.getError();var b=this.gl.createBuffer(),c=0!=(a.flags&1<<$a.IndexBuffer._hx_index)?34963:34962;this.gl.bindBuffer(c,b);if(0==a.vertices*a.format.stride)throw u.thrown("assert");this.gl.bufferData(c,a.vertices*a.format.strideBytes,0!=(a.flags&1<<$a.Dynamic._hx_index)?35048:35044);var d=fa.outOfMemoryCheck&&1285==this.gl.getError();this.gl.bindBuffer(c,null);0!=(a.flags&1<<$a.IndexBuffer._hx_index)&&(this.curIndexBuffer=null);return d?(this.gl.deleteBuffer(b),null):b},disposeTexture:function(a){var b=
a.t;if(null!=b){a.t=null;a=0;for(var c=this.boundTextures.length;a<c;){var d=a++;this.boundTextures[d]==b&&(this.boundTextures[d]=null)}this.gl.deleteTexture(b.t)}},disposeBuffer:function(a){this.gl.deleteBuffer(a.vbuf)},generateMipMaps:function(a){var b=this.getBindType(a);this.gl.bindTexture(b,a.t.t);this.gl.generateMipmap(b);this.restoreBind()},uploadTextureBitmap:function(a,b,c,d){a.format!=F.RGBA||1!=a.get_layerCount()?(b=b.getPixels(),this.uploadTexturePixels(a,b,c,d),b.dispose()):(d=b.ctx,
this.gl.bindTexture(3553,a.t.t),this.gl.texSubImage2D(3553,c,0,0,this.getChannels(a.t),a.t.pixelFmt,d.getImageData(0,0,b.ctx.canvas.width,b.ctx.canvas.height)),this.restoreBind())},resetStream:function(){},streamData:function(a,b,c){return a},uploadTexturePixels:function(a,b,c,d){var e=3553;0!=(a.flags&1<<O.Cube._hx_index)&&(e=fa.CUBE_FACES[d]);0!=(a.flags&1<<O.IsArray._hx_index)?e=35866:0!=(a.flags&1<<O.Is3D._hx_index)&&(e=32879);var f=this.getBindType(a);this.gl.bindTexture(f,a.t.t);b.convert(a.format);
f=b.dataSize;switch(a.format._hx_index){case 4:case 7:case 10:case 13:f=new Float32Array(b.bytes.b.buffer,b.offset,f>>2);break;case 16:case 17:f=new Uint32Array(b.bytes.b.buffer,b.offset,f>>2);break;case 3:case 6:case 9:case 12:case 18:case 19:case 20:case 21:f=new Uint16Array(b.bytes.b.buffer,b.offset,f>>1);break;default:f=new Uint8Array(b.bytes.b.buffer,b.offset,f)}22==a.format._hx_index?0!=(a.flags&1<<O.IsArray._hx_index)||0!=(a.flags&1<<O.Is3D._hx_index)?this.gl.compressedTexSubImage3D(e,c,0,
0,d,b.width,b.height,1,a.t.internalFmt,f):this.gl.compressedTexSubImage2D(e,c,0,0,b.width,b.height,a.t.internalFmt,f):0!=(a.flags&1<<O.IsArray._hx_index)||0!=(a.flags&1<<O.Is3D._hx_index)?this.gl.texSubImage3D(e,c,0,0,d,b.width,b.height,1,this.getChannels(a.t),a.t.pixelFmt,f):this.gl.texSubImage2D(e,c,0,0,b.width,b.height,this.getChannels(a.t),a.t.pixelFmt,f);a.flags|=1<<O.WasCleared._hx_index;this.restoreBind()},uploadBufferData:function(a,b,c,d,e){var f=a.format.strideBytes;this.gl.bindBuffer(34962,
a.vbuf);a=new Float32Array(d.array.buffer,4*e,c*f>>2);this.gl.bufferSubData(34962,b*f,a);this.gl.bindBuffer(34962,null)},uploadBufferBytes:function(a,b,c,d,e){var f=a.format.strideBytes,g=0!=(a.flags&1<<$a.IndexBuffer._hx_index)?34963:34962;this.gl.bindBuffer(g,a.vbuf);c=new Uint8Array(d.b.bufferValue,e,c*f);this.gl.bufferSubData(g,b*f,c);this.gl.bindBuffer(g,null);0!=(a.flags&1<<$a.IndexBuffer._hx_index)&&(this.curIndexBuffer=null)},readBufferBytes:function(a,b,c,d,e){var f=a.format.strideBytes;
c*=f;var g=0!=(a.flags&1<<$a.IndexBuffer._hx_index)?34963:34962;this.gl.bindBuffer(g,a.vbuf);this.gl.getBufferSubData(g,b*f,d.b,e,c);this.gl.bindBuffer(g,null)},uploadIndexData:function(a,b,c,d,e){var f=a.format.strideBytes>>1;this.gl.bindBuffer(34963,a.vbuf);a=new Uint16Array(d);c=new Uint16Array(a.buffer,e<<f,c);this.gl.bufferSubData(34963,b<<f,c);this.gl.bindBuffer(34963,null);this.curIndexBuffer=null},updateDivisor:function(a){this.currentDivisor[a.index]!=a.divisor&&(this.currentDivisor[a.index]=
a.divisor,this.gl.vertexAttribDivisor(a.index,a.divisor))},selectBuffer:function(a){if(a!=this.curBuffer){if(null==this.curShader)throw u.thrown("No shader selected");this.gl.bindBuffer(34962,a.vbuf);this.curBuffer=a;var b=a.format.strideBytes;a=a.format.resolveMapping(this.curShader.format);for(var c=0,d=this.curShader.attribs;c<d.length;){var e=d[c],f=c++;f=a[f];var g=!1,h=this.gl,k=e.index,l=e.size;switch(f&7){case 0:var m=e.type;break;case 1:m=5131;break;case 2:g=!0;m=5121;break;case 3:g=!0,m=
5120}h.vertexAttribPointer(k,l,m,g,b,f>>16);this.currentDivisor[e.index]!=e.divisor&&(this.currentDivisor[e.index]=e.divisor,this.gl.vertexAttribDivisor(e.index,e.divisor))}}},selectMultiBuffers:function(a,b){var c=this.curShader.format,d=a.mappings[c.uid];null==d&&(d=a.makeMapping(c));a=d;c=0;for(d=this.curShader.attribs;c<d.length;){var e=d[c],f=c++;f=a[f];var g=b[f>>3&255];this.curBuffer!=g&&(this.gl.bindBuffer(34962,g.vbuf),this.curBuffer=g);var h=!1,k=this.gl,l=e.index,m=e.size;switch(f&7){case 0:var p=
e.type;break;case 1:p=5131;break;case 2:h=!0;p=5121;break;case 3:h=!0,p=5120}k.vertexAttribPointer(l,m,p,h,g.format.strideBytes,f>>16);this.currentDivisor[e.index]!=e.divisor&&(this.currentDivisor[e.index]=e.divisor,this.gl.vertexAttribDivisor(e.index,e.divisor))}},draw:function(a,b,c){a!=this.curIndexBuffer&&(this.curIndexBuffer=a,this.gl.bindBuffer(34963,a.vbuf));4==a.format.strideBytes?this.gl.drawElements(this.drawMode,3*c,5125,4*b):this.gl.drawElements(this.drawMode,3*c,5123,2*b)},allocInstanceBuffer:function(a,
b){for(var c=[],d=0,e=a.commandCount;d<e;){var f=20*d++,g=b.getInt32(f),h=b.getInt32(f+4),k=b.getInt32(f+8),l=b.getInt32(f+12);f=b.getInt32(f+16);if(0!=l||0!=f)throw u.thrown("baseVertex and baseInstance must be zero on this platform");c.push(g);c.push(k);c.push(h)}a.data=c},uploadInstanceBufferBytes:function(a,b,c,d,e){a=new Uint8Array(d.b.bufferValue,e,20*c);this.gl.bufferSubData(34962,20*b,a);this.gl.bindBuffer(34962,null)},disposeInstanceBuffer:function(a){a.data=null},drawInstanced:function(a,
b){a!=this.curIndexBuffer&&(this.curIndexBuffer=a,this.gl.bindBuffer(34963,a.vbuf));if(4==a.format.strideBytes){a=5125;var c=4}else a=5123,c=2;var d=b.data;if(null!=d)for(var e=b=0,f=d.length/3|0;e<f;)e++,this.gl.drawElementsInstanced(this.drawMode,d[b++],a,d[b++]*c,d[b++]);else this.gl.drawElementsInstanced(this.drawMode,b.indexCount,a,b.startIndex*c,b.commandCount)},end:function(){},present:function(){},isDisposed:function(){return this.gl.isContextLost()},setRenderZone:function(a,b,c,d){0==a&&
0==b&&0>c&&0>d?this.gl.disable(3089):(this.gl.enable(3089),null==this.curTarget&&(b=this.bufferHeight-(b+d)),this.gl.scissor(a,b,c,d))},setDrawBuffers:function(a){3<=this.glES?this.gl.drawBuffers(fa.CBUFFERS[a]):null!=this.mrtExt&&this.mrtExt.drawBuffersWEBGL(fa.CBUFFERS[a])},unbindTargets:function(){if(null!=this.curTarget&&1<this.numTargets){for(;1<this.numTargets;)this.gl.framebufferTexture2D(36160,36064+--this.numTargets,3553,null,0),this.curTargets[this.numTargets]=null;this.setDrawBuffers(1)}},
capturePixels:function(a,b,c,d){if(null!=d){d.xMax>a.width&&(d.xMax=a.width);d.yMax>a.height&&(d.yMax=a.height);0>d.xMin&&(d.xMin=0);0>d.yMin&&(d.yMin=0);var e=d.xMax-d.xMin;var f=d.yMax-d.yMin;var g=d.xMin;d=d.yMin}else e=a.width,f=a.height,d=g=0;e>>=c;f>>=c;0==e&&(e=1);0==f&&(f=1);var h=ya.alloc(e,f,a.format),k=this.curTarget,l=this.numTargets,m=this.curTargetLayer,p=this.curTargetMip;if(1<l){var t=this.numTargets=1;for(f=l;t<f;)e=t++,this.curTargets[e]==a&&this.gl.framebufferTexture2D(36160,36064+
e,3553,null,0)}this.setRenderTarget(a,b,c);this.captureSubRenderBuffer(h,g,d);this.setRenderTarget(k,m,p);if(1<l){t=1;for(f=l;t<f;)e=t++,this.curTargets[e]==a&&this.gl.framebufferTexture2D(36160,36064+e,3553,a.t.t,0);this.setDrawBuffers(l);this.numTargets=l}return h},setRenderTarget:function(a,b,c,d){null==d&&(d=rc.ReadWrite);null==c&&(c=0);null==b&&(b=0);this.unbindTargets();this.curTarget=a;if(null==a)this.gl.bindFramebuffer(36160,null),this.gl.viewport(0,0,this.bufferWidth,this.bufferHeight);else{if(null!=
a.depthBuffer&&(a.depthBuffer.width!=a.width||a.depthBuffer.height!=a.height))throw u.thrown("Invalid depth buffer size : does not match render target size");if(0<c&&1==this.glES)throw u.thrown("Cannot render to mipLevel in WebGL1, use upload() instead");null==a.t&&a.alloc();if(0!=(a.flags&1<<O.MipMapped._hx_index)&&0==(a.flags&1<<O.WasCleared._hx_index)){var e=this.getBindType(a);this.gl.bindTexture(e,a.t.t);this.gl.generateMipmap(e);this.restoreBind()}a.set_lastFrame(this.frame);this.curTargetLayer=
b;this.curTargetMip=c;this.gl.bindFramebuffer(36160,this.commonFB);0!=(a.flags&1<<O.IsArray._hx_index)?this.gl.framebufferTextureLayer(36160,36064,a.t.t,c,b):this.gl.framebufferTexture2D(36160,36064,0!=(a.flags&1<<O.Cube._hx_index)?fa.CUBE_FACES[b]:3553,a.t.t,c);this.setPolygonOffset(a.depthBuffer);this.setDepthClamp(a.depthBuffer);null!=a.depthBuffer&&d!=rc.NotBound?a.depthBuffer.hasStencil()&&a.depthBuffer.format==F.Depth24Stencil8?this.gl.framebufferTexture2D(36160,33306,3553,a.depthBuffer.t.t,
0):(this.gl.framebufferTexture2D(36160,33306,3553,null,0),this.gl.framebufferTexture2D(36160,36096,3553,a.depthBuffer.t.t,0),this.gl.framebufferTexture2D(36160,36128,3553,a.depthBuffer.hasStencil()?a.depthBuffer.t.t:null,0)):(this.gl.framebufferTexture2D(36160,33306,3553,null,0),this.gl.framebufferTexture2D(36160,36096,3553,null,0),this.gl.framebufferTexture2D(36160,36128,3553,null,0));b=a.width>>c;0==b&&(b=1);c=a.height>>c;0==c&&(c=1);this.gl.viewport(0,0,b,c);c=0;for(b=this.boundTextures.length;c<
b;)d=c++,this.boundTextures[d]=null;0==(a.flags&1<<O.WasCleared._hx_index)&&(a.flags|=1<<O.WasCleared._hx_index,this.clear(fa.BLACK));if(this.glDebug&&(a=this.gl.checkFramebufferStatus(36160),36053!=a))throw u.thrown("Invalid frame buffer: "+a);}},setRenderTargets:function(a,b){null==b&&(b=rc.ReadWrite);this.unbindTargets();this.setRenderTarget(a[0],null,null,b);if(!(2>a.length)){this.numTargets=a.length;b=!1;for(var c=1,d=a.length;c<d;){var e=c++,f=a[e];null==f.t&&f.alloc();this.gl.framebufferTexture2D(36160,
36064+e,3553,f.t.t,0);this.curTargets[e]=f;f.set_lastFrame(this.frame);0==(f.flags&1<<O.WasCleared._hx_index)&&(f.flags|=1<<O.WasCleared._hx_index,b=!0)}this.setDrawBuffers(a.length);b&&this.clear(fa.BLACK)}},setDepth:function(a){this.unbindTargets();this.curTarget=a;a.set_lastFrame(this.frame);this.curTargetMip=this.curTargetLayer=0;this.gl.bindFramebuffer(36160,this.commonFB);this.gl.framebufferTexture2D(36160,36064,3553,null,0);this.setPolygonOffset(a);this.setDepthClamp(a);a.hasStencil()&&a.format==
F.Depth24Stencil8?this.gl.framebufferTexture2D(36160,33306,3553,a.t.t,0):(this.gl.framebufferTexture2D(36160,33306,3553,null,0),this.gl.framebufferTexture2D(36160,36096,3553,a.t.t,0),this.gl.framebufferTexture2D(36160,36128,3553,a.hasStencil()?a.t.t:null,0));var b=a.width;0==b&&(b=1);a=a.height;0==a&&(a=1);this.gl.viewport(0,0,b,a);b=0;for(a=this.boundTextures.length;b<a;){var c=b++;this.boundTextures[c]=null}if(this.glDebug&&(b=this.gl.checkFramebufferStatus(36160),36053!=b))throw u.thrown("Invalid frame buffer: "+
b);},onTextureBiasChanged:function(a){this.setPolygonOffset(a)},setPolygonOffset:function(a){null==a||0==a.depthBias&&0==a.slopeScaledBias?this.gl.disable(32823):(this.gl.enable(32823),this.gl.polygonOffset(a.slopeScaledBias,a.depthBias))},setDepthClamp:function(a){},init:function(a,b){null==b&&(b=!1);if("complete"==window.document.readyState)Ad.delay(function(){a(!1)},1);else{var c=null;c=function(){window.removeEventListener("load",c);a(!1)};window.addEventListener("load",c)}},hasFeature:function(a){return this.features.get(a)},
makeFeatures:function(){for(var a=0,b=Ta.__empty_constructs__.slice();a<b.length;){var c=b[a];++a;this.features.set(c,this.checkFeature(c))}null!=this.gl.getExtension("WEBGL_compressed_texture_s3tc")&&(this.maxCompressedTexturesSupport=3,null!=this.gl.getExtension("EXT_texture_compression_bptc")&&(this.maxCompressedTexturesSupport=7));3>this.glES&&this.gl.getExtension("WEBGL_depth_texture");this.has16Bits=null!=this.gl.getExtension("EXT_texture_norm16")},checkFeature:function(a){switch(a._hx_index){case 0:return 3<=
this.glES?!0:null!=this.gl.getExtension("OES_standard_derivatives");case 1:return 3<=this.glES?null!=this.gl.getExtension("EXT_color_buffer_float")?null!=this.gl.getExtension("OES_texture_float_linear"):!1:null!=this.gl.getExtension("OES_texture_float")&&null!=this.gl.getExtension("OES_texture_float_linear")&&null!=this.gl.getExtension("OES_texture_half_float")?null!=this.gl.getExtension("OES_texture_half_float_linear"):!1;case 4:return 3<=this.glES?!0:null==this.mrtExt?null!=(this.mrtExt=this.gl.getExtension("WEBGL_draw_buffers")):
!0;case 6:return 3<=this.glES?!0:null!=this.gl.getExtension("EXT_sRGB");case 7:return 3<=this.glES?!0:!1;case 2:case 3:case 8:case 9:return!0;case 10:return 3<=this.glES?!0:null!=this.gl.getExtension("ANGLE_instanced_arrays");default:return!1}},uploadTextureVideoElement:function(a,b,c,d){var e=0!=(a.flags&1<<O.Cube._hx_index),f=this.getBindType(a);if(0!=(a.flags&1<<O.IsArray._hx_index))throw u.thrown("TODO:texImage3D");d=e?fa.CUBE_FACES[d]:3553;this.gl.bindTexture(f,a.t.t);this.gl.texSubImage2D(d,
c,0,0,b.videoWidth,b.videoHeight,this.getChannels(a.t),a.t.pixelFmt,b);this.restoreBind()},captureRenderBuffer:function(a){this.captureSubRenderBuffer(a,0,0)},captureSubRenderBuffer:function(a,b,c){if(null==this.curTarget)throw u.thrown("Can't capture main render buffer in GL");this.gl.getError();var d=a.bytes.b;switch(this.curTarget.format._hx_index){case 4:case 7:case 10:case 13:d=new Float32Array(d.buffer);break;case 16:case 17:d=new Uint32Array(d.buffer);break;case 3:case 6:case 9:case 12:case 18:case 19:case 20:case 21:d=
new Uint16Array(d.buffer)}this.gl.readPixels(b,c,a.width,a.height,this.getChannels(this.curTarget.t),this.curTarget.t.pixelFmt,d);b=this.gl.getError();if(0!=b)throw u.thrown("Failed to capture pixels (error "+b+")");a.set_innerFormat(this.curTarget.format)},__class__:fa});var jg=function(){this.offset=this.triCount=0};z["h3d.impl.InstanceBuffer"]=jg;jg.__name__="h3d.impl.InstanceBuffer";jg.prototype={setCommand:function(a,b,c){null==c&&(c=0);this.commandCount=a;this.indexCount=b;this.triCount=a*b/
3|0;this.startIndex=c},updateTriCount:function(a,b){for(var c=this.triCount=0;c<a;){var d=c++,e=b.getInt32(d*jg.ELEMENT_SIZE);d=b.getInt32(d*jg.ELEMENT_SIZE+4);this.triCount+=e*d/3|0}},uploadBytes:function(a,b){this.updateTriCount(a,b);this.commandCount=a;this.indexCount=0;this.driver=na.CURRENT.driver;this.driver.uploadInstanceBufferBytes(this,0,a,b,0)},allocFromBytes:function(a,b){this.dispose();this.updateTriCount(a,b);this.commandCount=this.maxCommandCount=a;this.indexCount=0;this.driver=na.CURRENT.driver;
this.driver.allocInstanceBuffer(this,b)},dispose:function(){null!=this.data&&this.driver.disposeInstanceBuffer(this)},__class__:jg};var bf=function(a){this.lastAutoDispose=0;this.autoDisposeCooldown=60;this.usedMemory=this.texMemory=0;this.driver=a};z["h3d.impl.MemoryManager"]=bf;bf.__name__="h3d.impl.MemoryManager";bf.enableTrackAlloc=function(a){rd.ENABLED=null!=a?a:!0};bf.prototype={init:function(){this.textures=[];this.buffers=[];this.initIndexes()},initIndexes:function(){for(var a,b=[],c=0;65532>
c;)a=c++,b.push(a);this.triIndexes16=$d.alloc(b);b=[];for(c=0;10922>c;)a=c++,a<<=2,b.push(a),b.push(a+1),b.push(a+2),b.push(a+2),b.push(a+1),b.push(a+3);b.push(65532);this.quadIndexes16=$d.alloc(b)},garbage:function(){},getTriIndexes:function(a){if(65532>=a)return this.triIndexes16;if(null==this.triIndexes32||this.triIndexes32.vertices<a){for(var b=131072;b<a;)b<<=1;a=new S(new ArrayBuffer(b<<2));for(var c=0,d=b;c<d;){var e=c++;a.setInt32(e<<2,e)}null!=this.triIndexes32&&this.triIndexes32.dispose();
this.triIndexes32=$d._new(b,!0);this.triIndexes32.uploadBytes(a,0,b)}return this.triIndexes32},getQuadIndexes:function(a){var b=6*(a+3>>2);if(65532>=b)return this.quadIndexes16;if(null==this.quadIndexes32||this.quadIndexes32.vertices<a){for(a=131072;a<b;)a<<=1;b=new S(new ArrayBuffer(a<<2));for(var c=0,d=0,e=a/6|0;d<e;){var f=d++<<2;b.setInt32(c++<<2,f);b.setInt32(c++<<2,f+1);b.setInt32(c++<<2,f+2);b.setInt32(c++<<2,f+2);b.setInt32(c++<<2,f+1);b.setInt32(c++<<2,f+3)}null!=this.quadIndexes32&&this.quadIndexes32.dispose();
this.quadIndexes32=$d._new(a,!0);this.quadIndexes32.uploadBytes(b,0,a)}return this.quadIndexes32},allocBuffer:function(a){if(null==a.vbuf){var b=a.vertices*a.format.strideBytes;if(0!=b){for(;4294967296<this.usedMemory+b||null==(a.vbuf=this.driver.allocBuffer(a));){if(this.driver.isDisposed())return;var c=this.usedMemory;this.garbage();if(this.usedMemory==c)throw u.thrown("Memory full ("+Math.ceil(c/1024)+" KB,"+this.buffers.length+" buffers)");}this.usedMemory+=b;this.buffers.push(a)}}},freeBuffer:function(a){null!=
a.vbuf&&(this.driver.disposeBuffer(a),a.vbuf=null,D.remove(this.buffers,a)&&(this.usedMemory-=a.vertices*a.format.strideBytes))},memSize:function(a){if(0!=(a.flags&1<<O.AsyncLoading._hx_index)&&0!=(a.flags&1<<O.Loading._hx_index))return 4;var b=ya.calcDataSize(a.width,a.height,a.format);if(0<a.get_mipLevels())for(var c=1,d=a.get_mipLevels();c<d;){var e=c++,f=a.width>>e;0==f&&(f=1);e=a.height>>e;0==e&&(e=1);b+=ya.calcDataSize(f,e,a.format)}return b*a.get_layerCount()},cleanTextures:function(a){null==
a&&(a=!0);this.textures.sort(M(this,this.sortByLRU));for(var b=0,c=this.textures;b<c.length;){var d=c[b];++b;if(null!=d.realloc&&(null!=d.t||!d.isDepth()&&null!=d.realloc)&&(a||d._lastFrame<ba.frameCount-3600)&&d._lastFrame!=Y.PREVENT_AUTO_DISPOSE)return d.dispose(),!0}return!1},sortByLRU:function(a,b){return a._lastFrame-b._lastFrame},deleteTexture:function(a){D.remove(this.textures,a)&&(this.driver.disposeTexture(a),this.texMemory-=this.memSize(a))},allocTexture:function(a){for(;;){var b=!0;ba.frameCount>
this.lastAutoDispose+this.autoDisposeCooldown&&(b=this.cleanTextures(!1),this.lastAutoDispose=ba.frameCount);a.t=a.isDepth()?this.driver.allocDepthBuffer(a):this.driver.allocTexture(a);if(null!=a.t)break;if(this.driver.isDisposed())return;for(;this.cleanTextures(!1););if(!b&&!this.cleanTextures(!0))throw u.thrown("Maximum texture memory reached");}this.textures.push(a);this.texMemory+=this.memSize(a)},onContextLost:function(){this.dispose();this.initIndexes()},dispose:function(){null!=this.triIndexes16&&
this.triIndexes16.dispose();null!=this.quadIndexes16&&this.quadIndexes16.dispose();null!=this.triIndexes32&&this.triIndexes32.dispose();null!=this.quadIndexes32&&this.quadIndexes32.dispose();this.quadIndexes32=this.triIndexes32=this.quadIndexes16=this.triIndexes16=null;for(var a=0,b=this.textures.slice();a<b.length;){var c=b[a];++a;c.dispose()}a=0;for(b=this.buffers.slice();a<b.length;)c=b[a],++a,c.dispose();this.buffers=[];this.textures=[];this.texMemory=this.usedMemory=0},stats:function(){for(var a=
0,b=0,c=this.buffers;b<c.length;){var d=c[b];++b;a+=d.vertices*d.format.strideBytes}return{bufferCount:this.buffers.length,bufferMemory:a,totalMemory:this.usedMemory+this.texMemory,textureCount:this.textures.length,textureMemory:this.texMemory}},allocStats:function(){for(var a,b,c,d,e,f=Object.create(null),g=[],h=0,k=this.textures;h<k.length;)if(a=k[h],++h,null!=a.allocPos){e="$"+a.allocPos.position;d=f[e];null==d&&(d={position:a.allocPos.position,count:0,size:0,tex:!0,stacks:[]},f[e]=d,g.push(d));
d.count++;e=this.memSize(a);d.size+=e;var l=a.name;d=d.stacks;c=a.allocPos.stack.join("\n");for(b=0;b<d.length;)a=d[b],++b,a.stack==c&&(a.size+=e,a.count++,a.stats.push({name:l,size:e}),c=null);null!=c&&d.push({stats:[{name:l,size:e}],stack:c,count:1,size:e})}h=0;for(k=this.buffers;h<k.length;)if(l=k[h],++h,null!=l.allocPos){e=l.allocPos.position;d=f[e];null==d&&(d={position:e,count:0,size:0,tex:!1,stacks:[]},f[e]=d,g.push(d));d.count++;e=l.vertices*l.format.stride*4;d.size+=e;d=d.stacks;c=l.allocPos.stack.join("\n");
for(b=0;b<d.length;)a=d[b],++b,a.stack==c&&(a.size+=e,a.count++,a.stats.push({name:"buffer",size:e}),c=null);null!=c&&d.push({stats:[{name:"buffer",size:e}],stack:c,count:1,size:e})}g.sort(function(a,b){return b.size-a.size});return g},__class__:bf};var ah=function(){Nd.call(this)};z["h3d.impl.NullDriver"]=ah;ah.__name__="h3d.impl.NullDriver";ah.__super__=Nd;ah.prototype=J(Nd.prototype,{hasFeature:function(a){return!0},isSupportedFormat:function(a){return!0},logImpl:function(a){Ka.trace(a,{fileName:"h3d/impl/NullDriver.hx",
lineNumber:23,className:"h3d.impl.NullDriver",methodName:"logImpl"})},isDisposed:function(){return!1},getDriverName:function(a){return"NullDriver"},init:function(a,b){a(!1)},selectShader:function(a){if(this.cur==a)return!1;this.cur=a;return!0},allocTexture:function(a){return{}},allocBuffer:function(a){return{}},__class__:ah});var wc=L["h3d.impl.Step"]={__ename__:!0,__constructs__:null,MainDraw:{_hx_name:"MainDraw",_hx_index:0,__enum__:"h3d.impl.Step",toString:v},Decals:{_hx_name:"Decals",_hx_index:1,
__enum__:"h3d.impl.Step",toString:v},Shadows:{_hx_name:"Shadows",_hx_index:2,__enum__:"h3d.impl.Step",toString:v},Lighting:{_hx_name:"Lighting",_hx_index:3,__enum__:"h3d.impl.Step",toString:v},Forward:{_hx_name:"Forward",_hx_index:4,__enum__:"h3d.impl.Step",toString:v},BeforeTonemapping:{_hx_name:"BeforeTonemapping",_hx_index:5,__enum__:"h3d.impl.Step",toString:v},AfterTonemapping:{_hx_name:"AfterTonemapping",_hx_index:6,__enum__:"h3d.impl.Step",toString:v},Overlay:{_hx_name:"Overlay",_hx_index:7,
__enum__:"h3d.impl.Step",toString:v},Custom:(A=function(a){return{_hx_index:8,name:a,__enum__:"h3d.impl.Step",toString:v}},A._hx_name="Custom",A.__params__=["name"],A)};wc.__constructs__=[wc.MainDraw,wc.Decals,wc.Shadows,wc.Lighting,wc.Forward,wc.BeforeTonemapping,wc.AfterTonemapping,wc.Overlay,wc.Custom];wc.__empty_constructs__=[wc.MainDraw,wc.Decals,wc.Shadows,wc.Lighting,wc.Forward,wc.BeforeTonemapping,wc.AfterTonemapping,wc.Overlay];var wi=function(){};z["h3d.impl.RendererFX"]=wi;wi.__name__=
"h3d.impl.RendererFX";wi.__isInterface__=!0;wi.prototype={__class__:wi};var zj=function(a,b){this.file=a;this.outputFile=null!=b?b:a;this.sourceFile=a+".source"};z["h3d.impl.ShaderCache"]=zj;zj.__name__="h3d.impl.ShaderCache";zj.prototype={disableSave:function(){this.outputFile=null},initEmpty:function(){this.data=new La;this.sources=new La},load:function(){this.data=new La;try{this.loadFile(this.file)}catch(a){}if(this.outputFile!=this.file)try{this.loadFile(this.outputFile)}catch(a){}if(this.keepSource)try{this.loadSources()}catch(a){}},
loadFile:function(a){throw u.thrown("Cannot load shader cache with this platform");},loadSources:function(){throw u.thrown("Cannot load shader cache with this platform");},resolveShaderBinary:function(a,b){null==b&&(b="");null==this.data&&this.load();var c=this.data;a=b+vd.encode(a);return c.h[a]},saveCompiledShader:function(a,b,c,d){null==d&&(d=!0);null==c&&(c="");null!=this.outputFile&&(null==this.data&&this.load(),c+=vd.encode(a),this.data.h[c]!=b||this.keepSource&&this.sources.h[c]!=a)&&(this.data.h[c]=
b,d&&this.save(),this.keepSource&&(this.sources.h[c]=a,this.saveSources()))},save:function(){var a=new Rc,b=this.data,c=ge.array({iterator:function(){return new Ze(b.h)}});c.sort(ua.compare);for(var d=0;d<c.length;){var e=c[d];++d;a.writeInt32(e.length);a.writeString(e);e=Cc.encode(this.data.h[e]);a.writeInt32(e.length);a.writeString(e);a.writeByte(10)}},saveSources:function(){var a=new Rc,b=this.sources,c=ge.array({iterator:function(){return new Ze(b.h)}});c.sort(ua.compare);for(var d=0;d<c.length;){var e=
c[d];++d;a.writeInt32(e.length);a.writeString(e);e=this.sources.h[e];a.writeInt32(e.length);a.writeString(e);a.writeByte(10);a.writeByte(10)}},__class__:zj};var Wc=function(){this.position=0;this.cache=[];this.defaultFormat=Y.nativeFormat;this.defaultDepthBuffer=Y.getDefaultDepth();if(0>Wc.checkFlags){for(var a=0,b=[O.Cube,O.MipMapped,O.ManualMipMapGen,O.Dynamic,O.IsArray],c=0;c<b.length;){var d=b[c];++c;a|=1<<d._hx_index}Wc.checkFlags=a}};z["h3d.impl.TextureCache"]=Wc;Wc.__name__="h3d.impl.TextureCache";
Wc.prototype={get:function(a){null==a&&(a=0);return this.cache[a]},getNamed:function(a){for(var b=0,c=this.position;b<c;){var d=b++;if(this.cache[d].name==a)return this.cache[d]}return null},set:function(a,b){this.cache[b]=a},begin:function(){for(;this.cache.length>this.position;){var a=this.cache.pop();null!=a&&a.dispose()}this.position=0},matchTargetFlags:function(a,b){var c=0;if(null!=b)for(var d=0;d<b.length;){var e=b[d];++d;c|=1<<e._hx_index}return(a.flags&Wc.checkFlags)==(c&Wc.checkFlags)},
lookupTarget:function(a,b,c,d,e){for(var f=this.cache[this.position],g=this.position+1,h=this.cache.length;g<h;){var k=g++,l=this.cache[k];if(null!=l&&(null!=l.t||!l.isDepth()&&null!=l.realloc)&&l.width==b&&l.height==c&&l.format==d){var m=0;if(null!=e)for(var p=0;p<e.length;){var t=e[p];++p;m|=1<<t._hx_index}if((l.flags&Wc.checkFlags)==(m&Wc.checkFlags))return this.cache[this.position]=l,this.cache[k]=f,l}}null!=f&&f.name==a&&(f.dispose(),f=null);null==e&&(e=[]);-1==e.indexOf(O.Target)&&e.push(O.Target);
a=new Y(b,c,e,d);a.realloc=function(){};null!=f?this.cache.splice(this.position,0,a):this.cache[this.position]=a;return a},allocTarget:function(a,b,c,d,e,f){null==d&&(d=!0);var g=this.cache[this.position];null==e&&(e=this.defaultFormat);if(null==g||null==g.t&&(g.isDepth()||null==g.realloc)||g.width!=b||g.height!=c||g.format!=e)var h=!0;else{h=0;if(null!=f)for(var k=0;k<f.length;){var l=f[k];++k;h|=1<<l._hx_index}h=(g.flags&Wc.checkFlags)!=(h&Wc.checkFlags)}h&&(g=this.lookupTarget(a,b,c,e,f));g.depthBuffer=
d?this.defaultDepthBuffer:null;g.setName(a);this.position++;return g},allocTargetScale:function(a,b,c,d){null==c&&(c=!0);var e=na.CURRENT;return this.allocTarget(a,Math.ceil(e.width*b),Math.ceil(e.height*b),c,d)},allocTileTarget:function(a,b,c,d){null==c&&(c=!1);return this.allocTarget(a,Math.ceil(b.width+b.x)-Math.floor(b.x),Math.ceil(b.height+b.y)-Math.floor(b.y),c,d)},dispose:function(){for(var a=0,b=this.cache;a<b.length;){var c=b[a];++a;c.dispose()}this.cache=[]},__class__:Wc};var yf=function(){};
z["hxd.impl.AnyProps"]=yf;yf.__name__="hxd.impl.AnyProps";yf.prototype={set_props:function(a){this.props=a;this.refreshProps();return a},setDefaultProps:function(a){this.set_props(this.getDefaultProps(a))},getDefaultProps:function(a){return{}},refreshProps:function(){},__class__:yf};var wd=function(a){null!=a&&this.addPass(new ja("default",null)).addShader(a)};z["h3d.mat.BaseMaterial"]=wd;wd.__name__="h3d.mat.BaseMaterial";wd.__super__=yf;wd.prototype=J(yf.prototype,{addPass:function(a){for(var b=
null,c=this.passes;null!=c;)b=c,c=c.nextPass;null==b?this.passes=a:b.nextPass=a;a.nextPass=null;return a},removePass:function(a){for(var b=null,c=this.passes;null!=c;){if(c==a)return null==b?this.passes=a.nextPass:b.nextPass=a.nextPass,a.nextPass=null,!0;b=c;c=c.nextPass}return!1},get_mainPass:function(){return this.passes},getPasses:function(){for(var a=this.passes,b=[];null!=a;)b.push(a),a=a.nextPass;return b},getPass:function(a){for(var b=this.passes;null!=b;){if(b.name==a)return b;b=b.nextPass}return null},
allocPass:function(a,b){null==b&&(b=!0);var c=this.getPass(a);if(null!=c)return c;c=new ja(a,null,b?this.passes:null);b&&null!=this.passes&&c.set_batchMode(this.passes.batchMode);this.addPass(c);return c},clone:function(a){null==a&&(a=new wd);a.passes.load(this.passes);a.name=this.name;a.set_props(this.props);return a},__class__:wd});var Ib=L["h3d.mat.Face"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h3d.mat.Face",toString:v},Back:{_hx_name:"Back",_hx_index:1,__enum__:"h3d.mat.Face",
toString:v},Front:{_hx_name:"Front",_hx_index:2,__enum__:"h3d.mat.Face",toString:v},Both:{_hx_name:"Both",_hx_index:3,__enum__:"h3d.mat.Face",toString:v}};Ib.__constructs__=[Ib.None,Ib.Back,Ib.Front,Ib.Both];Ib.__empty_constructs__=[Ib.None,Ib.Back,Ib.Front,Ib.Both];var ea=L["h3d.mat.Blend"]={__ename__:!0,__constructs__:null,One:{_hx_name:"One",_hx_index:0,__enum__:"h3d.mat.Blend",toString:v},Zero:{_hx_name:"Zero",_hx_index:1,__enum__:"h3d.mat.Blend",toString:v},SrcAlpha:{_hx_name:"SrcAlpha",_hx_index:2,
__enum__:"h3d.mat.Blend",toString:v},SrcColor:{_hx_name:"SrcColor",_hx_index:3,__enum__:"h3d.mat.Blend",toString:v},DstAlpha:{_hx_name:"DstAlpha",_hx_index:4,__enum__:"h3d.mat.Blend",toString:v},DstColor:{_hx_name:"DstColor",_hx_index:5,__enum__:"h3d.mat.Blend",toString:v},OneMinusSrcAlpha:{_hx_name:"OneMinusSrcAlpha",_hx_index:6,__enum__:"h3d.mat.Blend",toString:v},OneMinusSrcColor:{_hx_name:"OneMinusSrcColor",_hx_index:7,__enum__:"h3d.mat.Blend",toString:v},OneMinusDstAlpha:{_hx_name:"OneMinusDstAlpha",
_hx_index:8,__enum__:"h3d.mat.Blend",toString:v},OneMinusDstColor:{_hx_name:"OneMinusDstColor",_hx_index:9,__enum__:"h3d.mat.Blend",toString:v},ConstantColor:{_hx_name:"ConstantColor",_hx_index:10,__enum__:"h3d.mat.Blend",toString:v},ConstantAlpha:{_hx_name:"ConstantAlpha",_hx_index:11,__enum__:"h3d.mat.Blend",toString:v},OneMinusConstantColor:{_hx_name:"OneMinusConstantColor",_hx_index:12,__enum__:"h3d.mat.Blend",toString:v},OneMinusConstantAlpha:{_hx_name:"OneMinusConstantAlpha",_hx_index:13,__enum__:"h3d.mat.Blend",
toString:v},SrcAlphaSaturate:{_hx_name:"SrcAlphaSaturate",_hx_index:14,__enum__:"h3d.mat.Blend",toString:v}};ea.__constructs__=[ea.One,ea.Zero,ea.SrcAlpha,ea.SrcColor,ea.DstAlpha,ea.DstColor,ea.OneMinusSrcAlpha,ea.OneMinusSrcColor,ea.OneMinusDstAlpha,ea.OneMinusDstColor,ea.ConstantColor,ea.ConstantAlpha,ea.OneMinusConstantColor,ea.OneMinusConstantAlpha,ea.SrcAlphaSaturate];ea.__empty_constructs__=[ea.One,ea.Zero,ea.SrcAlpha,ea.SrcColor,ea.DstAlpha,ea.DstColor,ea.OneMinusSrcAlpha,ea.OneMinusSrcColor,
ea.OneMinusDstAlpha,ea.OneMinusDstColor,ea.ConstantColor,ea.ConstantAlpha,ea.OneMinusConstantColor,ea.OneMinusConstantAlpha,ea.SrcAlphaSaturate];var nb=L["h3d.mat.Compare"]={__ename__:!0,__constructs__:null,Always:{_hx_name:"Always",_hx_index:0,__enum__:"h3d.mat.Compare",toString:v},Never:{_hx_name:"Never",_hx_index:1,__enum__:"h3d.mat.Compare",toString:v},Equal:{_hx_name:"Equal",_hx_index:2,__enum__:"h3d.mat.Compare",toString:v},NotEqual:{_hx_name:"NotEqual",_hx_index:3,__enum__:"h3d.mat.Compare",
toString:v},Greater:{_hx_name:"Greater",_hx_index:4,__enum__:"h3d.mat.Compare",toString:v},GreaterEqual:{_hx_name:"GreaterEqual",_hx_index:5,__enum__:"h3d.mat.Compare",toString:v},Less:{_hx_name:"Less",_hx_index:6,__enum__:"h3d.mat.Compare",toString:v},LessEqual:{_hx_name:"LessEqual",_hx_index:7,__enum__:"h3d.mat.Compare",toString:v}};nb.__constructs__=[nb.Always,nb.Never,nb.Equal,nb.NotEqual,nb.Greater,nb.GreaterEqual,nb.Less,nb.LessEqual];nb.__empty_constructs__=[nb.Always,nb.Never,nb.Equal,nb.NotEqual,
nb.Greater,nb.GreaterEqual,nb.Less,nb.LessEqual];var gb=L["h3d.mat.StencilOp"]={__ename__:!0,__constructs__:null,Keep:{_hx_name:"Keep",_hx_index:0,__enum__:"h3d.mat.StencilOp",toString:v},Zero:{_hx_name:"Zero",_hx_index:1,__enum__:"h3d.mat.StencilOp",toString:v},Replace:{_hx_name:"Replace",_hx_index:2,__enum__:"h3d.mat.StencilOp",toString:v},Increment:{_hx_name:"Increment",_hx_index:3,__enum__:"h3d.mat.StencilOp",toString:v},IncrementWrap:{_hx_name:"IncrementWrap",_hx_index:4,__enum__:"h3d.mat.StencilOp",
toString:v},Decrement:{_hx_name:"Decrement",_hx_index:5,__enum__:"h3d.mat.StencilOp",toString:v},DecrementWrap:{_hx_name:"DecrementWrap",_hx_index:6,__enum__:"h3d.mat.StencilOp",toString:v},Invert:{_hx_name:"Invert",_hx_index:7,__enum__:"h3d.mat.StencilOp",toString:v}};gb.__constructs__=[gb.Keep,gb.Zero,gb.Replace,gb.Increment,gb.IncrementWrap,gb.Decrement,gb.DecrementWrap,gb.Invert];gb.__empty_constructs__=[gb.Keep,gb.Zero,gb.Replace,gb.Increment,gb.IncrementWrap,gb.Decrement,gb.DecrementWrap,gb.Invert];
var Me=L["h3d.mat.MipMap"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h3d.mat.MipMap",toString:v},Nearest:{_hx_name:"Nearest",_hx_index:1,__enum__:"h3d.mat.MipMap",toString:v},Linear:{_hx_name:"Linear",_hx_index:2,__enum__:"h3d.mat.MipMap",toString:v}};Me.__constructs__=[Me.None,Me.Nearest,Me.Linear];Me.__empty_constructs__=[Me.None,Me.Nearest,Me.Linear];var sd=L["h3d.mat.Filter"]={__ename__:!0,__constructs__:null,Nearest:{_hx_name:"Nearest",_hx_index:0,__enum__:"h3d.mat.Filter",
toString:v},Linear:{_hx_name:"Linear",_hx_index:1,__enum__:"h3d.mat.Filter",toString:v}};sd.__constructs__=[sd.Nearest,sd.Linear];sd.__empty_constructs__=[sd.Nearest,sd.Linear];var Fe=L["h3d.mat.Wrap"]={__ename__:!0,__constructs__:null,Clamp:{_hx_name:"Clamp",_hx_index:0,__enum__:"h3d.mat.Wrap",toString:v},Repeat:{_hx_name:"Repeat",_hx_index:1,__enum__:"h3d.mat.Wrap",toString:v}};Fe.__constructs__=[Fe.Clamp,Fe.Repeat];Fe.__empty_constructs__=[Fe.Clamp,Fe.Repeat];var Ub=L["h3d.mat.Operation"]={__ename__:!0,
__constructs__:null,Add:{_hx_name:"Add",_hx_index:0,__enum__:"h3d.mat.Operation",toString:v},Sub:{_hx_name:"Sub",_hx_index:1,__enum__:"h3d.mat.Operation",toString:v},ReverseSub:{_hx_name:"ReverseSub",_hx_index:2,__enum__:"h3d.mat.Operation",toString:v},Min:{_hx_name:"Min",_hx_index:3,__enum__:"h3d.mat.Operation",toString:v},Max:{_hx_name:"Max",_hx_index:4,__enum__:"h3d.mat.Operation",toString:v}};Ub.__constructs__=[Ub.Add,Ub.Sub,Ub.ReverseSub,Ub.Min,Ub.Max];Ub.__empty_constructs__=[Ub.Add,Ub.Sub,
Ub.ReverseSub,Ub.Min,Ub.Max];var O=L["h3d.mat.TextureFlags"]={__ename__:!0,__constructs__:null,Target:{_hx_name:"Target",_hx_index:0,__enum__:"h3d.mat.TextureFlags",toString:v},Cube:{_hx_name:"Cube",_hx_index:1,__enum__:"h3d.mat.TextureFlags",toString:v},MipMapped:{_hx_name:"MipMapped",_hx_index:2,__enum__:"h3d.mat.TextureFlags",toString:v},ManualMipMapGen:{_hx_name:"ManualMipMapGen",_hx_index:3,__enum__:"h3d.mat.TextureFlags",toString:v},IsNPOT:{_hx_name:"IsNPOT",_hx_index:4,__enum__:"h3d.mat.TextureFlags",
toString:v},NoAlloc:{_hx_name:"NoAlloc",_hx_index:5,__enum__:"h3d.mat.TextureFlags",toString:v},Dynamic:{_hx_name:"Dynamic",_hx_index:6,__enum__:"h3d.mat.TextureFlags",toString:v},AlphaPremultiplied:{_hx_name:"AlphaPremultiplied",_hx_index:7,__enum__:"h3d.mat.TextureFlags",toString:v},WasCleared:{_hx_name:"WasCleared",_hx_index:8,__enum__:"h3d.mat.TextureFlags",toString:v},Loading:{_hx_name:"Loading",_hx_index:9,__enum__:"h3d.mat.TextureFlags",toString:v},Serialize:{_hx_name:"Serialize",_hx_index:10,
__enum__:"h3d.mat.TextureFlags",toString:v},IsArray:{_hx_name:"IsArray",_hx_index:11,__enum__:"h3d.mat.TextureFlags",toString:v},AsyncLoading:{_hx_name:"AsyncLoading",_hx_index:12,__enum__:"h3d.mat.TextureFlags",toString:v},LazyLoading:{_hx_name:"LazyLoading",_hx_index:13,__enum__:"h3d.mat.TextureFlags",toString:v},Writable:{_hx_name:"Writable",_hx_index:14,__enum__:"h3d.mat.TextureFlags",toString:v},Is3D:{_hx_name:"Is3D",_hx_index:15,__enum__:"h3d.mat.TextureFlags",toString:v}};O.__constructs__=
[O.Target,O.Cube,O.MipMapped,O.ManualMipMapGen,O.IsNPOT,O.NoAlloc,O.Dynamic,O.AlphaPremultiplied,O.WasCleared,O.Loading,O.Serialize,O.IsArray,O.AsyncLoading,O.LazyLoading,O.Writable,O.Is3D];O.__empty_constructs__=[O.Target,O.Cube,O.MipMapped,O.ManualMipMapGen,O.IsNPOT,O.NoAlloc,O.Dynamic,O.AlphaPremultiplied,O.WasCleared,O.Loading,O.Serialize,O.IsArray,O.AsyncLoading,O.LazyLoading,O.Writable,O.Is3D];var ad=function(){};z["h3d.mat.Defaults"]=ad;ad.__name__="h3d.mat.Defaults";ad.get_shadowShader=function(){var a=
ad.shadowShader;null==a&&(a=new zf,ad.set_shadowShader(a),ad.shadowShader.setPriority(-1));return a};ad.set_shadowShader=function(a){return ad.shadowShader=a};ad.makeVolumeDecal=function(a){return new df(a.xMax-a.xMin,a.yMax-a.yMin)};var Af=function(a){this.mshader=new Gd;this.set_blendMode(xa.None);wd.call(this,this.mshader);this.set_texture(a)};z["h3d.mat.Material"]=Af;Af.__name__="h3d.mat.Material";Af.create=function(a){var b=Od.current.createMaterial();b.set_texture(a);b.set_props(b.getDefaultProps());
return b};Af.__super__=wd;Af.prototype=J(wd.prototype,{get_specularPower:function(){return this.mshader.specularPower__},set_specularPower:function(a){return this.mshader.specularPower__=a},get_specularAmount:function(){return this.mshader.specularAmount__},set_specularAmount:function(a){return this.mshader.specularAmount__=a},get_color:function(){return this.mshader.color__},set_color:function(a){return this.mshader.color__=a},get_shadows:function(){return this.castShadows?this.receiveShadows:!1},
set_shadows:function(a){this.set_castShadows(a);this.set_receiveShadows(a);return a},set_castShadows:function(a){if(this.castShadows==a)return a;null!=this.passes&&(a?this.addPass(new ja("shadow",null,this.passes)).set_isStatic(this.staticShadows):this.removePass(this.getPass("shadow")));return this.castShadows=a},set_receiveShadows:function(a){if(a==this.receiveShadows)return a;if(null!=this.passes){var b=ad.get_shadowShader();a?this.passes.addShader(b):this.passes.removeShader(b)}return this.receiveShadows=
a},set_staticShadows:function(a){var b=this.getPass("shadow");null!=b&&b.set_isStatic(a);return this.staticShadows=a},clone:function(a){a=null==a?new Af:a;wd.prototype.clone.call(this,a);a.set_castShadows(this.castShadows);a.set_receiveShadows(this.receiveShadows);a.set_texture(this.get_texture());a.set_specularTexture(this.get_specularTexture());a.set_normalMap(this.get_normalMap());if(null!=this.textureShader){var b=a.textureShader;b.constModified=!0;b.additive__=this.textureShader.additive__;b=
a.textureShader;b.constModified=!0;b.killAlpha__=this.textureShader.killAlpha__;a.textureShader.killAlphaThreshold__=this.textureShader.killAlphaThreshold__}b=this.mshader.color__;var c=b.x,d=b.y,e=b.z;b=b.w;null==b&&(b=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=new T(c,d,e,b);a.mshader.color__=c;a.set_blendMode(this.blendMode);return a},set_blendMode:function(a){if(null!=this.passes)switch(this.passes.setBlendMode(a),a._hx_index){case 0:this.passes.set_depthWrite(!0);this.passes.setPassName("default");
break;case 1:this.passes.set_depthWrite(!0);this.passes.setPassName("alpha");break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:this.passes.set_depthWrite(!1),this.passes.setPassName("additive")}return this.blendMode=a},get_specularTexture:function(){return null==this.specularShader?null:this.specularShader.texture__},get_texture:function(){return null==this.textureShader?null:this.textureShader.texture__},set_texture:function(a){null==a?null!=this.textureShader&&(this.passes.removeShader(this.textureShader),
this.textureShader=null):(null==this.textureShader&&(this.textureShader=new Ne,this.passes.addShader(this.textureShader)),this.textureShader.texture__=a);return a},get_normalMap:function(){return null==this.normalShader?null:this.normalShader.texture__},set_normalMap:function(a){null==a?null!=this.normalShader&&(this.passes.removeShader(this.normalShader),this.normalShader=null):(null==this.normalShader&&(this.normalShader=new ef,null!=this.textureShader?this.passes.addShaderAtIndex(this.normalShader,
this.passes.getShaderIndex(this.textureShader)+1):this.passes.addShader(this.normalShader)),this.normalShader.texture__=a);return a},set_specularTexture:function(a){null==a?null!=this.specularShader&&(this.passes.removeShader(this.specularShader),this.specularShader=null):(null==this.specularShader&&(this.specularShader=new Hd,this.passes.addShader(this.specularShader)),this.specularShader.texture__=a);return a},getDefaultModelProps:function(){var a=this.getDefaultProps();switch(this.blendMode._hx_index){case 0:break;
case 1:a.kind="Alpha";break;case 2:a.kind="Add";a.culling=!1;a.shadows=!1;a.light=!1;break;default:throw u.thrown("Unsupported HMD material "+w.string(this.blendMode));}return a},getDefaultProps:function(a){if(null==a)a={kind:"Opaque",shadows:!0,culling:!0,light:!0};else switch(a){case "particles3D":case "trail3D":a={kind:"Alpha",shadows:!1,culling:!1,light:!0};break;case "ui":a={kind:"Alpha",shadows:!1,culling:!1,light:!1};break;default:a={kind:"Opaque",shadows:!0,culling:!0,light:!0}}return a},
refreshProps:function(){if(null!=this.props&&null!=this.passes){var a=this.props;switch(a.kind){case "Add":this.set_blendMode(xa.Add);break;case "Alpha":this.set_blendMode(xa.Alpha);break;case "AlphaKill":case "Hidden":case "Opaque":this.set_blendMode(xa.None);break;case "SoftAdd":this.set_blendMode(xa.SoftAdd)}var b=this.textureShader;null!=b&&(b.constModified=!0,b.killAlpha__="AlphaKill"==a.kind,b.killAlphaThreshold__=.5);this.passes.set_culling("Hidden"==a.kind?Ib.Both:a.culling?Ib.Back:Ib.None);
this.passes.set_enableLights(a.light);a=a.shadows;this.set_castShadows(a);this.set_receiveShadows(a);this.castShadows&&this.receiveShadows&&this.getPass("shadow").set_culling(this.passes.culling)}},__class__:Af});var xi=function(){this.db=new La};z["h3d.mat.MaterialDatabase"]=xi;xi.__name__="h3d.mat.MaterialDatabase";xi.prototype={getFilePath:function(a){var b=a.entry.get_directory();return null==b||""==b?"materials.props":a.entry.get_directory()+"/materials.props"},getModelData:function(a){if(null==
a)return null;var b=this.db,c=a.entry.get_directory();b=b.h[c];if(null!=b)return b.v;b=this.getFilePath(a);try{var d=bd.currentInstance.load(b);var e=JSON.parse(d.toText())}catch(f){if(u.caught(f).unwrap()instanceof kg)e={};else throw f;}b=this.db;c=a.entry.get_directory();b.h[c]={v:e};return e},saveData:function(a,b){a=this.getFilePath(a);throw u.thrown("Can't save material props database "+a);},loadMatProps:function(a,b){var c=this.getModelData(a.model);if(null==c)return c;c=c.materials;if(null==
c)return c;c=ua.field(c,b.name);return null==c?c:null!=a.model&&(b=ua.field(c,a.name+"/"+a.model.entry.name),null!=b)?b:ua.field(c,a.name)},saveMatProps:function(a,b,c){b=["materials",b.name,a.name];var d=this.getModelData(a.model);if(null!=d){for(var e=d,f=[],g=0,h=b.length-1;g<h;){var k=g++,l=ua.field(d,b[k]);null==l&&(l={},d[b[k]]=l);f.push(d);d=l}g=a.props;h="modelSpec"==g.__refMode;k=b.pop();h||ua.deleteField(d,k);l=k+"/"+(null!=a.model?a.model.entry.name:"");ua.deleteField(d,l);null==c&&(c=
a.getDefaultProps());if(null==g||(null==c?"null":w.string(c))==(null==g?"null":w.string(g)))for(;0<b.length;){c=b.pop();d=f.pop();if(0!=ua.fields(ua.field(d,c)).length)break;ua.deleteField(d,c)}else d[h?l:k]=g;this.getFilePath(a.model);0==ua.fields(e).length&&(e=null);this.saveData(a.model,e)}},__class__:xi};var Od=function(a){null==this.database&&(this.database=new xi);this.name=a};z["h3d.mat.MaterialSetup"]=Od;Od.__name__="h3d.mat.MaterialSetup";Od.prototype={createRenderer:function(){return new fh},
createLightSystem:function(){return new gh},createMaterial:function(){return new Af},getDefaults:function(a){null==this.emptyMat&&(this.emptyMat=this.createMaterial());return this.emptyMat.getDefaultProps(a)},loadMaterialProps:function(a){return this.database.loadMatProps(a,this)},saveMaterialProps:function(a,b){this.database.saveMatProps(a,this,b)},customMeshInit:function(a){},__class__:Od};var ja=function(a,b,c){this.bits=this.rendererFlags=this.layer=0;this.parentPass=c;this.shaders=b;this.setPassName(a);
this.set_culling(Ib.Back);a=ea.One;b=ea.Zero;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.depth(!0,nb.Less);this.set_blendOp(this.set_blendAlphaOp(Ub.Add));this.colorMask=15};z["h3d.mat.Pass"]=ja;ja.__name__="h3d.mat.Pass";ja.getEnableLights=function(a){return a&1};ja.getDynamicParameters=function(a){return a>>1&1};ja.getIsStatic=function(a){return a>>2&1};ja.getBatchMode=function(a){return a>>3&1};ja.getCulling=function(a){return a&3};ja.getDepthWrite=
function(a){return a>>2&1};ja.getDepthTest=function(a){return a>>3&7};ja.getBlendSrc=function(a){return a>>6&15};ja.getBlendDst=function(a){return a>>10&15};ja.getBlendAlphaSrc=function(a){return a>>14&15};ja.getBlendAlphaDst=function(a){return a>>18&15};ja.getBlendOp=function(a){return a>>22&7};ja.getBlendAlphaOp=function(a){return a>>25&7};ja.getWireframe=function(a){return a>>28&1};ja.getCulled=function(a){return a>>29&1};ja.getReserved=function(a){return a>>30&1};ja.prototype={load:function(a){this.name=
a.name;this.passId=a.passId;this.bits=a.bits;this.set_enableLights(a.enableLights);this.set_dynamicParameters(a.dynamicParameters);this.set_culling(a.culling);this.set_depthWrite(a.depthWrite);this.set_depthTest(a.depthTest);this.set_blendSrc(a.blendSrc);this.set_blendDst(a.blendDst);this.set_blendOp(a.blendOp);this.set_blendAlphaSrc(a.blendAlphaSrc);this.set_blendAlphaDst(a.blendAlphaDst);this.set_blendAlphaOp(a.blendAlphaOp);this.colorMask=a.colorMask;null!=a.stencil&&(null==this.stencil&&(this.stencil=
new wa),this.stencil.load(a.stencil))},setPassName:function(a){this.name=a;this.passId=za.allocID(a)},blend:function(a,b){this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b)},setBlendMode:function(a){this.set_blendOp(Ub.Add);this.set_blendAlphaOp(Ub.Add);switch(a._hx_index){case 0:a=ea.One;var b=ea.Zero;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);break;case 1:a=ea.SrcAlpha;b=ea.OneMinusSrcAlpha;this.set_blendSrc(a);
this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendAlphaSrc(ea.One);break;case 2:a=ea.SrcAlpha;b=ea.One;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendAlphaSrc(ea.One);break;case 3:a=ea.One;b=ea.OneMinusSrcAlpha;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);break;case 4:a=ea.OneMinusDstColor;b=ea.One;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);
this.set_blendAlphaDst(b);this.set_blendAlphaSrc(ea.One);break;case 5:a=ea.DstColor;b=ea.Zero;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendAlphaSrc(ea.One);break;case 6:a=ea.DstColor;b=ea.OneMinusSrcAlpha;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);break;case 7:a=ea.Zero;b=ea.OneMinusSrcColor;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);
break;case 8:a=ea.One;b=ea.OneMinusSrcColor;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);break;case 9:a=ea.SrcAlpha;b=ea.One;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendOp(Ub.ReverseSub);this.set_blendAlphaOp(Ub.ReverseSub);break;case 10:b=a=ea.One;this.set_blendSrc(a);this.set_blendAlphaSrc(a);this.set_blendDst(b);this.set_blendAlphaDst(b);this.set_blendAlphaOp(Ub.Max);this.set_blendOp(Ub.Max);
break;case 11:b=a=ea.One,this.set_blendSrc(a),this.set_blendAlphaSrc(a),this.set_blendDst(b),this.set_blendAlphaDst(b),this.set_blendAlphaOp(Ub.Min),this.set_blendOp(Ub.Min)}},depth:function(a,b){this.set_depthWrite(a);this.set_depthTest(b)},setColorMask:function(a,b,c,d){this.colorMask=(a?1:0)|(b?2:0)|(c?4:0)|(d?8:0)},setColorChannel:function(a){switch(a._hx_index){case 1:this.setColorMask(!0,!1,!1,!1);break;case 2:this.setColorMask(!1,!0,!1,!1);break;case 3:this.setColorMask(!1,!1,!0,!1);break;
case 4:this.setColorMask(!1,!1,!1,!0);break;default:throw u.thrown("Unsupported channel "+w.string(a));}},setColorMaski:function(a,b,c,d,e){if(8<e)throw u.thrown("Color mask i supports 8 Render target");this.colorMask|=((a?1:0)|(b?2:0)|(c?4:0)|(d?8:0))<<4*e},resetRendererFlags:function(){this.rendererFlags=0},addShader:function(a){if(null==a)return null;this.shaders=Fb.addSort(a,this.shaders);this.resetRendererFlags();return a},addSelfShader:function(a){if(null==a)return null;this.selfShadersChanged=
!0;this.selfShaders=Fb.addSort(a,this.selfShaders);this.resetRendererFlags();return a},addShaderAtIndex:function(a,b){for(var c=null,d=this.shaders;0<b&&d!=this.parentShaders;)c=d,d=d.next,--b;null==c?this.shaders=new Fb(a,d):c.next=new Fb(a,d);return a},getShaderIndex:function(a){for(var b=0,c=this.shaders;c!=this.parentShaders;){if(c.s==a)return b;c=c.next;++b}return-1},removeShader:function(a){for(var b=this.shaders,c=null,d=!1;null!=b;){if(b.s==a){this.resetRendererFlags();this.selfShadersCache==
b&&(this.selfShadersCache=this.selfShadersCache.next);null==c?this.shaders=b.next:c.next=b.next;d=!0;break}c=b;b=b.next}b=this.selfShaders;for(c=null;null!=b;){if(b.s==a)return this.resetRendererFlags(),this.selfShadersCache==b&&(this.selfShadersCache=this.selfShadersCache.next),null==c?this.selfShaders=b.next:c.next=b.next,!0;c=b;b=b.next}return d},removeShaders:function(a){for(var b=this.shaders,c=null;null!=b;)Z.__instanceof(b.s,a)?(this.resetRendererFlags(),this.selfShadersCache==b&&(this.selfShadersCache=
this.selfShadersCache.next),null==c?this.shaders=b.next:c.next=b.next):c=b,b=b.next;b=this.selfShaders;for(c=null;null!=b;)Z.__instanceof(b.s,a)?(this.resetRendererFlags(),this.selfShadersCache==b&&(this.selfShadersCache=this.selfShadersCache.next),null==c?this.selfShaders=b.next:c.next=b.next):c=b,b=b.next},getShader:function(a){var b=this._getShader(a,this.shaders);return null!=b?b:this._getShader(a,this.selfShaders)},_getShader:function(a,b){for(;null!=b&&b!=this.parentShaders;){var c=b.s;c=Z.__downcastCheck(c,
a)?c:null;if(null!=c)return c;b=b.next}return null},getShaderByName:function(a){var b=this._getShaderByName(a,this.shaders);return null!=b?b:this._getShaderByName(a,this.selfShaders)},_getShaderByName:function(a,b){for(;null!=b&&b!=this.parentShaders;){if(b.s.shader.data.name==a)return b.s;b=b.next}return null},getShaders:function(){return new pf(this.shaders,this.parentShaders)},checkInfiniteLoop:function(){for(var a=[],b=this.selfShaders;null!=b;){for(var c=0;c<a.length;){var d=a[c];++c;if(d==b)throw u.thrown("infinite loop");
}a.push(b);b=b.next}},selfShadersRec:function(a){if(null==this.selfShaders)return this.shaders;if(!this.selfShadersChanged&&!a&&this.shaders==this.selfShadersCache)return this.selfShaders;a=this.selfShaders;for(var b=null;null!=a&&a!=this.selfShadersCache;)b=a,a=a.next;this.selfShadersCache=this.shaders;null!=b?b.next=this.selfShadersCache:this.selfShaders=this.shaders;return this.selfShaders},getShadersRec:function(){if(null==this.parentPass||this.parentShaders==this.parentPass.shaders)return this.selfShadersRec(!1);
for(var a=this.shaders,b=null;null!=a&&a!=this.parentShaders;)b=a,a=a.next;a!=this.parentShaders&&(b=null);this.parentShaders=this.parentPass.shaders;null==b?this.shaders=this.parentShaders:b.next=this.parentShaders;return this.selfShadersRec(!0)},clone:function(){var a=new ja(this.name,this.shaders.clone());a.selfShaders=this.selfShaders;a.bits=this.bits;a.set_enableLights(this.enableLights);null!=this.stencil&&(a.stencil=this.stencil.clone());return a},set_enableLights:function(a){this.flags=this.flags&
-2|(a?1:0);return this.enableLights=a},set_dynamicParameters:function(a){this.flags=this.flags&-3|(a?1:0)<<1;return this.dynamicParameters=a},set_isStatic:function(a){this.flags=this.flags&-5|(a?1:0)<<2;return this.isStatic=a},set_batchMode:function(a){this.flags=this.flags&-9|(a?1:0)<<3;return this.batchMode=a},set_culling:function(a){this.bits=this.bits&-4|a._hx_index;return this.culling=a},set_depthWrite:function(a){this.bits=this.bits&-5|(a?1:0)<<2;return this.depthWrite=a},set_depthTest:function(a){this.bits=
this.bits&-57|a._hx_index<<3;return this.depthTest=a},set_blendSrc:function(a){this.bits=this.bits&-961|a._hx_index<<6;return this.blendSrc=a},set_blendDst:function(a){this.bits=this.bits&-15361|a._hx_index<<10;return this.blendDst=a},set_blendAlphaSrc:function(a){this.bits=this.bits&-245761|a._hx_index<<14;return this.blendAlphaSrc=a},set_blendAlphaDst:function(a){this.bits=this.bits&-3932161|a._hx_index<<18;return this.blendAlphaDst=a},set_blendOp:function(a){this.bits=this.bits&-29360129|a._hx_index<<
22;return this.blendOp=a},set_blendAlphaOp:function(a){this.bits=this.bits&-234881025|a._hx_index<<25;return this.blendAlphaOp=a},set_wireframe:function(a){this.bits=this.bits&-268435457|(a?1:0)<<28;return this.wireframe=a},set_culled:function(a){this.bits=this.bits&-536870913|(a?1:0)<<29;return this.culled=a},set_reserved:function(a){this.bits=this.bits&-1073741825|(a?1:0)<<30;return this.reserved=a},loadFlags:function(a){this.flags=a;this.set_enableLights(0!=(this.flags&1));this.set_dynamicParameters(0!=
(this.flags>>1&1));this.set_isStatic(0!=(this.flags>>2&1));this.set_batchMode(0!=(this.flags>>3&1))},loadBits:function(a){this.bits=a;this.set_culling(la.createEnumIndex(Ib,this.bits&3));this.set_depthWrite(0!=(this.bits>>2&1));this.set_depthTest(la.createEnumIndex(nb,this.bits>>3&7));this.set_blendSrc(la.createEnumIndex(ea,this.bits>>6&15));this.set_blendDst(la.createEnumIndex(ea,this.bits>>10&15));this.set_blendAlphaSrc(la.createEnumIndex(ea,this.bits>>14&15));this.set_blendAlphaDst(la.createEnumIndex(ea,
this.bits>>18&15));this.set_blendOp(la.createEnumIndex(Ub,this.bits>>22&7));this.set_blendAlphaOp(la.createEnumIndex(Ub,this.bits>>25&7));this.set_wireframe(0!=(this.bits>>28&1));this.set_culled(0!=(this.bits>>29&1));this.set_reserved(0!=(this.bits>>30&1))},__class__:ja};var wa=function(){this.maskBits=this.opBits=0;this.setOp(gb.Keep,gb.Keep,gb.Keep);this.setFunc(nb.Always)};z["h3d.mat.Stencil"]=wa;wa.__name__="h3d.mat.Stencil";wa.getReadMask=function(a){return a&255};wa.getWriteMask=function(a){return a>>
8&255};wa.getReference=function(a){return a>>16&255};wa.getFrontTest=function(a){return a&7};wa.getFrontPass=function(a){return a>>3&7};wa.getFrontSTfail=function(a){return a>>6&7};wa.getFrontDPfail=function(a){return a>>9&7};wa.getBackTest=function(a){return a>>12&7};wa.getBackPass=function(a){return a>>15&7};wa.getBackSTfail=function(a){return a>>18&7};wa.getBackDPfail=function(a){return a>>21&7};wa.prototype={setFront:function(a,b,c){this.set_frontSTfail(a);this.set_frontDPfail(b);this.set_frontPass(c)},
setBack:function(a,b,c){this.set_backSTfail(a);this.set_backDPfail(b);this.set_backPass(c)},setOp:function(a,b,c){this.setFront(a,b,c);this.setBack(a,b,c)},setFunc:function(a,b,c,d){null==d&&(d=255);null==c&&(c=255);null==b&&(b=0);this.set_frontTest(this.set_backTest(a));this.set_reference(b);this.set_readMask(c);this.set_writeMask(d)},clone:function(){var a=new wa;a.opBits=this.opBits;a.maskBits=this.maskBits;return a},load:function(a){this.opBits=a.opBits;this.maskBits=a.maskBits},set_readMask:function(a){this.maskBits=
this.maskBits&-256|a&255;return this.readMask=a},set_writeMask:function(a){this.maskBits=this.maskBits&-65281|(a&255)<<8;return this.writeMask=a},set_reference:function(a){this.maskBits=this.maskBits&-16711681|(a&255)<<16;return this.reference=a},set_frontTest:function(a){this.opBits=this.opBits&-8|a._hx_index;return this.frontTest=a},set_frontPass:function(a){this.opBits=this.opBits&-57|a._hx_index<<3;return this.frontPass=a},set_frontSTfail:function(a){this.opBits=this.opBits&-449|a._hx_index<<
6;return this.frontSTfail=a},set_frontDPfail:function(a){this.opBits=this.opBits&-3585|a._hx_index<<9;return this.frontDPfail=a},set_backTest:function(a){this.opBits=this.opBits&-28673|a._hx_index<<12;return this.backTest=a},set_backPass:function(a){this.opBits=this.opBits&-229377|a._hx_index<<15;return this.backPass=a},set_backSTfail:function(a){this.opBits=this.opBits&-1835009|a._hx_index<<18;return this.backSTfail=a},set_backDPfail:function(a){this.opBits=this.opBits&-14680065|a._hx_index<<21;
return this.backDPfail=a},loadOpBits:function(a){this.opBits=a;this.set_frontTest(la.createEnumIndex(nb,this.opBits&7));this.set_frontPass(la.createEnumIndex(gb,this.opBits>>3&7));this.set_frontSTfail(la.createEnumIndex(gb,this.opBits>>6&7));this.set_frontDPfail(la.createEnumIndex(gb,this.opBits>>9&7));this.set_backTest(la.createEnumIndex(nb,this.opBits>>12&7));this.set_backPass(la.createEnumIndex(gb,this.opBits>>15&7));this.set_backSTfail(la.createEnumIndex(gb,this.opBits>>18&7));this.set_backDPfail(la.createEnumIndex(gb,
this.opBits>>21&7))},loadMaskBits:function(a){this.maskBits=a;this.set_readMask(this.maskBits&255);this.set_writeMask(this.maskBits>>8&255);this.set_reference(this.maskBits>>16&255)},__class__:wa};var F=L["hxd.PixelFormat"]={__ename__:!0,__constructs__:null,ARGB:{_hx_name:"ARGB",_hx_index:0,__enum__:"hxd.PixelFormat",toString:v},BGRA:{_hx_name:"BGRA",_hx_index:1,__enum__:"hxd.PixelFormat",toString:v},RGBA:{_hx_name:"RGBA",_hx_index:2,__enum__:"hxd.PixelFormat",toString:v},RGBA16F:{_hx_name:"RGBA16F",
_hx_index:3,__enum__:"hxd.PixelFormat",toString:v},RGBA32F:{_hx_name:"RGBA32F",_hx_index:4,__enum__:"hxd.PixelFormat",toString:v},R8:{_hx_name:"R8",_hx_index:5,__enum__:"hxd.PixelFormat",toString:v},R16F:{_hx_name:"R16F",_hx_index:6,__enum__:"hxd.PixelFormat",toString:v},R32F:{_hx_name:"R32F",_hx_index:7,__enum__:"hxd.PixelFormat",toString:v},RG8:{_hx_name:"RG8",_hx_index:8,__enum__:"hxd.PixelFormat",toString:v},RG16F:{_hx_name:"RG16F",_hx_index:9,__enum__:"hxd.PixelFormat",toString:v},RG32F:{_hx_name:"RG32F",
_hx_index:10,__enum__:"hxd.PixelFormat",toString:v},RGB8:{_hx_name:"RGB8",_hx_index:11,__enum__:"hxd.PixelFormat",toString:v},RGB16F:{_hx_name:"RGB16F",_hx_index:12,__enum__:"hxd.PixelFormat",toString:v},RGB32F:{_hx_name:"RGB32F",_hx_index:13,__enum__:"hxd.PixelFormat",toString:v},SRGB:{_hx_name:"SRGB",_hx_index:14,__enum__:"hxd.PixelFormat",toString:v},SRGB_ALPHA:{_hx_name:"SRGB_ALPHA",_hx_index:15,__enum__:"hxd.PixelFormat",toString:v},RGB10A2:{_hx_name:"RGB10A2",_hx_index:16,__enum__:"hxd.PixelFormat",
toString:v},RG11B10UF:{_hx_name:"RG11B10UF",_hx_index:17,__enum__:"hxd.PixelFormat",toString:v},R16U:{_hx_name:"R16U",_hx_index:18,__enum__:"hxd.PixelFormat",toString:v},RG16U:{_hx_name:"RG16U",_hx_index:19,__enum__:"hxd.PixelFormat",toString:v},RGB16U:{_hx_name:"RGB16U",_hx_index:20,__enum__:"hxd.PixelFormat",toString:v},RGBA16U:{_hx_name:"RGBA16U",_hx_index:21,__enum__:"hxd.PixelFormat",toString:v},S3TC:(A=function(a){return{_hx_index:22,v:a,__enum__:"hxd.PixelFormat",toString:v}},A._hx_name="S3TC",
A.__params__=["v"],A),Depth16:{_hx_name:"Depth16",_hx_index:23,__enum__:"hxd.PixelFormat",toString:v},Depth24:{_hx_name:"Depth24",_hx_index:24,__enum__:"hxd.PixelFormat",toString:v},Depth24Stencil8:{_hx_name:"Depth24Stencil8",_hx_index:25,__enum__:"hxd.PixelFormat",toString:v},Depth32:{_hx_name:"Depth32",_hx_index:26,__enum__:"hxd.PixelFormat",toString:v}};F.__constructs__=[F.ARGB,F.BGRA,F.RGBA,F.RGBA16F,F.RGBA32F,F.R8,F.R16F,F.R32F,F.RG8,F.RG16F,F.RG32F,F.RGB8,F.RGB16F,F.RGB32F,F.SRGB,F.SRGB_ALPHA,
F.RGB10A2,F.RG11B10UF,F.R16U,F.RG16U,F.RGB16U,F.RGBA16U,F.S3TC,F.Depth16,F.Depth24,F.Depth24Stencil8,F.Depth32];F.__empty_constructs__=[F.ARGB,F.BGRA,F.RGBA,F.RGBA16F,F.RGBA32F,F.R8,F.R16F,F.R32F,F.RG8,F.RG16F,F.RG32F,F.RGB8,F.RGB16F,F.RGB32F,F.SRGB,F.SRGB_ALPHA,F.RGB10A2,F.RG11B10UF,F.R16U,F.RG16U,F.RGB16U,F.RGBA16U,F.Depth16,F.Depth24,F.Depth24Stencil8,F.Depth32];var Y=function(a,b,c,d){this.depthClamp=!1;this.startingMip=this.lodBias=this.depthBias=this.slopeScaledBias=0;null==d&&(d=Y.nativeFormat);
this.id=++Y.UID;this.format=d;this.flags=0;if(null!=c)for(d=0;d<c.length;){var e=c[d];++d;this.flags|=1<<e._hx_index}this.mem=na.CURRENT.mem;for(d=c=1;c<a;)c<<=1;for(;d<b;)d<<=1;if(c!=a||d!=b)this.flags|=1<<O.IsNPOT._hx_index;this.width=a;this.height=b;0!=(this.flags&1<<O.MipMapped._hx_index)?this.set_mipMap(Y.TRILINEAR_FILTERING_ENABLED?Me.Linear:Me.Nearest):this.set_mipMap(Me.None);this.set_filter(sd.Linear);this.set_wrap(Y.DEFAULT_WRAP);this.bits&=32767;this.allocPos=rd.make();0==(this.flags&1<<
O.NoAlloc._hx_index)&&0<this.width&&this.alloc()};z["h3d.mat.Texture"]=Y;Y.__name__="h3d.mat.Texture";Y.getDefaultDepth=function(){return na.CURRENT.driver.getDefaultDepthBuffer()};Y.fromBitmap=function(a){var b=new Y(a.ctx.canvas.width,a.ctx.canvas.height);b.uploadBitmap(a);return b};Y.fromPixels=function(a,b){b=new Y(a.width,a.height,null,null!=b?b:a.innerFormat);b.uploadPixels(a);return b};Y.fromColor=function(a,b){null==b&&(b=1);var c=na.CURRENT,d=255*b|0;0>d?d=0:255<d&&(d=255);d=a&16777215|d<<
24;var e=c.textureColorCache.h[d];if(null!=e)return e;e=new Y(1,1,null);e.clear(a,b);e.realloc=function(){e.clear(a,b)};return c.textureColorCache.h[d]=e};Y.genDisc=function(a,b,c){null==c&&(c=1);return Y.genTexture(0,a,b,c)};Y.genTexture=function(a,b,c,d){var e=na.CURRENT;d=255*d|0;0>d?d=0:255<d&&(d=255);c=c&16777215|d<<24;d=(b<<16|a)+","+c;var f=Y.genTextureKeys.h[d],g=null==f?null:e.resCache.h[f.__id__];if(null!=g)return g;null==f&&(f={},Y.genTextureKeys.h[d]=f);g=new Y(b,b,[O.Target]);g.realloc=
function(){Y.drawGenTexture(g,c,a)};Y.drawGenTexture(g,c,a);e.resCache.set(f,g);return g};Y.drawGenTexture=function(a,b,c){var d=new Lb(new Oe),e=na.CURRENT,f=d.shader;f.constModified=!0;f.mode__=c;f=d.shader.color__;f.x=(b>>16&255)/255;f.y=(b>>8&255)/255;f.z=(b&255)/255;f.w=(b>>>24)/255;e.pushTarget(a);d.render();e.popTarget()};Y.defaultCubeTexture=function(){var a=na.CURRENT,b=a.resCache.h[Y.__id__];if(null!=b)return b;b=new Y(1,1,[O.Cube]);b.clear(2105376);b.realloc=function(){b.clear(2105376)};
a.resCache.set(Y,b);return b};Y.genChecker=function(a){var b=na.CURRENT,c=Y.checkerTextureKeys.h[a],d=null==c?null:b.resCache.h[c.__id__];if(null!=d&&(null!=d.t||!d.isDepth()&&null!=d.realloc))return d;null==c&&(c={},Y.checkerTextureKeys.h[a]=c);var e=d=new Y(a,a,[O.NoAlloc]);d.realloc=function(){Y.allocChecker(e,a)};b.resCache.set(c,d);return d};Y.genNoise=function(a){var b=na.CURRENT,c=Y.noiseTextureKeys.h[a],d=null==c?null:b.resCache.h[c.__id__];if(null!=d&&(null!=d.t||!d.isDepth()&&null!=d.realloc))return d;
null==c&&(c={},Y.noiseTextureKeys.h[a]=c);var e=d=new Y(a,a,[O.NoAlloc]);d.realloc=function(){Y.allocNoise(e,a)};b.resCache.set(c,d);return d};Y.allocNoise=function(a,b){for(var c=new be(b,b),d=0;d<b;)for(var e=d++,f=0,g=b;f<g;){var h=f++,k=w.random(256);c.setPixel(e,h,-16777216|k|k<<8|k<<16)}a.uploadBitmap(c);c.ctx=null;c.pixel=null};Y.allocChecker=function(a,b){var c=new be(b,b);c.clear(-1);for(var d=0,e=b>>1;d<e;)for(var f=d++,g=0,h=b>>1;g<h;){var k=g++;c.setPixel(f,k,-16777216);c.setPixel(f+(b>>
1),k+(b>>1),-16777216)}a.uploadBitmap(c);c.ctx=null;c.pixel=null};Y.prototype={set_lastFrame:function(a){this._lastFrame!=Y.PREVENT_AUTO_DISPOSE&&(this._lastFrame=a);return this._lastFrame},get_lastFrame:function(){return this._lastFrame},get_mipLevels:function(){if(0==(this.flags&1<<O.MipMapped._hx_index))return 1;if(0<this.customMipLevels)return this.customMipLevels;for(var a=1,b=this.width,c=this.height;1<=b>>a||1<=c>>a;)++a;return a},get_layerCount:function(){return 0!=(this.flags&1<<O.Cube._hx_index)?
6:1},alloc:function(){null==this.t&&this.mem.allocTexture(this)},isSRGB:function(){switch(this.format._hx_index){case 14:case 15:return!0;default:return!1}},checkAlloc:function(){null==this.t&&null!=this.realloc&&(this.alloc(),this.realloc())},clone:function(){this.checkAlloc();if(null==this.t)throw u.thrown("Can't clone disposed texture");var a=this._lastFrame;this.preventAutoDispose();var b=[],c=O.Target;0!=(this.flags&1<<c._hx_index)&&b.push(c);c=O.Cube;0!=(this.flags&1<<c._hx_index)&&b.push(c);
c=O.MipMapped;0!=(this.flags&1<<c._hx_index)&&b.push(c);c=O.IsArray;0!=(this.flags&1<<c._hx_index)&&b.push(c);b=new Y(this.width,this.height,b,this.format);b.name=this.name;0!=(this.flags&1<<O.Cube._hx_index)?le.run(this,b):sc.run(this,b);this.set_lastFrame(a);return b},preventAutoDispose:function(){this.set_lastFrame(Y.PREVENT_AUTO_DISPOSE)},preventForcedDispose:function(){this.set_lastFrame(Y.PREVENT_FORCED_DISPOSE)},waitLoad:function(a){0==(this.flags&1<<O.Loading._hx_index)?a():(null==this.waitLoads&&
(this.waitLoads=[]),this.waitLoads.push(a))},toString:function(){var a=this.name;null==this.name&&(a="Texture_"+this.id,null!=this.allocPos&&(a+="("+this.allocPos.position+")"));return a=0!=(this.flags&1<<O.Is3D._hx_index)?a+("("+this.width+"x"+this.height+"x"+this.get_layerCount()+")"):a+("("+this.width+"x"+this.height+")")},setName:function(a){this.name=a},set_depthBias:function(a){a!=this.depthBias&&(this.depthBias=a,na.CURRENT.onTextureBiasChanged(this));return this.depthBias},set_slopeScaledBias:function(a){a!=
this.slopeScaledBias&&(this.slopeScaledBias=a,na.CURRENT.onTextureBiasChanged(this));return this.slopeScaledBias},set_mipMap:function(a){this.bits=this.bits&-4|a._hx_index;return this.mipMap=a},set_filter:function(a){this.bits=this.bits&-25|a._hx_index<<3;return this.filter=a},set_wrap:function(a){this.bits=this.bits&-193|a._hx_index<<6;return this.wrap=a},isDisposed:function(){return null==this.t?this.isDepth()?!0:null==this.realloc:!1},resize:function(a,b){this.dispose();for(var c=1,d=1;c<a;)c<<=
1;for(;d<b;)d<<=1;this.flags=c!=a||d!=b?this.flags|1<<O.IsNPOT._hx_index:this.flags&-1-(1<<O.IsNPOT._hx_index);this.width=a;this.height=b;0==(this.flags&1<<O.NoAlloc._hx_index)&&this.alloc()},clearF:function(a,b,c,d,e){null==e&&(e=-1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.alloc();if(0==(this.flags&1<<O.Target._hx_index))throw u.thrown("Texture should be target");var f=na.CURRENT;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);d=new T(a,b,c,d);if(0>e)for(e=0,
a=this.get_layerCount();e<a;)c=e++,f.pushTarget(this,c),f.clearF(d),f.popTarget();else f.pushTarget(this,e),f.clearF(d),f.popTarget()},clear:function(a,b,c){null==c&&(c=-1);null==b&&(b=1);this.alloc();if(0!=this.width&&0!=this.height)if(1!=this.width||1!=this.height){var d=na.CURRENT;a|=(255*(0>b?0:1<b?1:b)|0)<<24;if(0>c){var e=0;for(b=this.get_layerCount();e<b;)c=e++,d.pushTarget(this,c),d.clear(a),d.popTarget()}else d.pushTarget(this,c),d.clear(a),d.popTarget()}else{d=ya.alloc(this.width,this.height,
Y.nativeFormat);var f=0,g=a&255,h=a>>8&255;a=a>>16&255;var k=255*b|0;0>k?k=0:255<k&&(k=255);switch(Y.nativeFormat._hx_index){case 1:b=a;a=g;g=b;break;case 2:break;default:throw u.thrown("TODO");}e=0;for(b=this.width*this.height;e<b;)e++,d.bytes.b[f++]=a,d.bytes.b[f++]=h,d.bytes.b[f++]=g,d.bytes.b[f++]=k;if(0>c)for(e=0,b=this.get_layerCount();e<b;)c=e++,this.uploadPixels(d,0,c);else this.uploadPixels(d,0,c);d.dispose()}},checkSize:function(a,b,c){var d=this.width>>c;0==d&&(d=1);c=this.height>>c;0==
c&&(c=1);if(a!=d||b!=c)throw u.thrown("Invalid upload size : "+a+"x"+b+" should be "+d+"x"+c);},checkMipMapGen:function(a,b){0==a&&0!=(this.flags&1<<O.MipMapped._hx_index)&&0==(this.flags&1<<O.ManualMipMapGen._hx_index)&&b==this.get_layerCount()-1&&this.mem.driver.generateMipMaps(this)},uploadBitmap:function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.alloc();this.checkSize(a.ctx.canvas.width,a.ctx.canvas.height,b);this.mem.driver.uploadTextureBitmap(this,a,b,c);this.flags|=1<<O.WasCleared._hx_index;
this.checkMipMapGen(b,c)},uploadPixels:function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.alloc();this.checkSize(a.width,a.height,b);this.mem.driver.uploadTexturePixels(this,a,b,c);this.flags|=1<<O.WasCleared._hx_index;this.checkMipMapGen(b,c)},dispose:function(){null!=this.t&&this.mem.deleteTexture(this)},hasStencil:function(){return 25==this.format._hx_index?!0:!1},isDepth:function(){switch(this.format._hx_index){case 23:case 24:case 25:case 26:return!0;default:return!1}},capturePixels:function(a,
b,c){null==b&&(b=0);null==a&&(a=0);var d=this._lastFrame;this.preventAutoDispose();a=this.mem.driver.capturePixels(this,a,b,c);this.set_lastFrame(d);return a},__class__:Y};var lg=function(a,b,c,d,e){this.layers=c;null==d&&(d=[]);d.push(O.IsArray);Y.call(this,a,b,d,e)};z["h3d.mat.TextureArray"]=lg;lg.__name__="h3d.mat.TextureArray";lg.__super__=Y;lg.prototype=J(Y.prototype,{get_layerCount:function(){return this.layers},clone:function(){var a=this._lastFrame;this.preventAutoDispose();var b=new lg(this.width,
this.height,this.layers,null,this.format);sc.run(this,b);this.set_lastFrame(a);return b},toString:function(){return Y.prototype.toString.call(this)+"["+this.layers+"]"},__class__:lg});var Lb=function(a,b){this.shader=a;this.output=new bg(b);this.pass=new ja("screenfx",new Fb(a));this.pass.set_culling(Ib.None);this.pass.depth(!1,nb.Always)};z["h3d.pass.ScreenFx"]=Lb;Lb.__name__="h3d.pass.ScreenFx";Lb.run=function(a,b,c){var d=na.CURRENT;d.pushTarget(b,c);(new Lb(a)).render();d.popTarget()};Lb.prototype=
{get_engine:function(){null==this._engine&&(this._engine=na.CURRENT);return this._engine},copy:function(a,b){sc.run(a,b)},addShader:function(a){return this.pass.addShader(a)},removeShader:function(a){return this.pass.removeShader(a)},getShader:function(a){return this.pass.getShader(a)},render:function(){null==this.primitive&&(this.primitive=Pe.get());this.shader.flipY__=this.get_engine().driver.hasFeature(Ta.BottomLeftCoords)&&null!=this.get_engine().getCurrentTarget()?-1:1;var a=this.pass.shaders,
b=jb.get(),c=!1;null==b&&(c=!0,b=new jb,b.setCurrent());var d=this.output.compileShaders(b.globals,a);this.get_engine().selectMaterial(this.pass);this.get_engine().selectShader(d);var e=b.shaderBuffers;e.vertex.grow(d.vertex);null!=d.fragment&&e.fragment.grow(d.fragment);b.fillGlobals(e,d);b.fillParams(e,d,a);this.get_engine().uploadShaderBuffers(e,0);this.get_engine().uploadShaderBuffers(e,1);this.get_engine().uploadShaderBuffers(e,2);this.get_engine().uploadShaderBuffers(e,3);this.primitive.render(this.get_engine());
c&&b.clearCurrent()},dispose:function(){},__class__:Lb};var mg=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=1);null==a&&(a=1);this.cubeDir=[Ac.L([0,0,-1,0,0,-1,0,0,1,0,0,0]),Ac.L([0,0,1,0,0,-1,0,0,-1,0,0,0]),Ac.L([1,0,0,0,0,0,1,0,0,1,0,0]),Ac.L([1,0,0,0,0,0,-1,0,0,-1,0,0]),Ac.L([1,0,0,0,0,-1,0,0,0,0,1,0]),Ac.L([-1,0,0,0,0,-1,0,0,0,0,-1,0])];Lb.call(this,new ff);this.set_radius(a);this.set_quality(d);this.set_gain(b);this.set_linear(c)};z["h3d.pass.Blur"]=mg;mg.__name__="h3d.pass.Blur";
mg.__super__=Lb;mg.prototype=J(Lb.prototype,{set_radius:function(a){if(this.radius==a)return a;this.values=null;return this.radius=a},set_quality:function(a){if(this.quality==a)return a;this.values=null;return this.quality=a},set_gain:function(a){if(this.gain==a)return a;this.values=null;return this.gain=a},set_linear:function(a){if(this.linear==a)return a;this.values=null;return this.linear=a},gauss:function(a,b){if(0>=b)return 0==a?1:0;b*=b;return Math.pow(2.718281828459,-(a*a)/(2*b))/Math.sqrt(2*
Math.PI*b)},calcValues:function(){var a;this.values=[];this.offsets=[];var b=0,c=this.quality;c=.7*(0>c?0:1<c?1:c)+.3;if(0<this.radius){var d=this.radius-1;var e=Math.ceil((1>d?1:d)*c/2)}else e=0;d=Math.sqrt(this.radius);var f=0;for(a=e+1;f<a;){e=f++;var g=2*e,h=0==e?0:2*e-1,k=this.gauss(g,d),l=this.gauss(h,d),m=k+l;this.values[e]=m;this.offsets[e]=0==e?0:(k*g+l*h)/(m*e*Math.sqrt(c));b+=m;0<e&&(b+=m)}for(f=.01/c*this.values[0];2<this.values.length;){e=this.values[this.values.length-1];if(e>f)break;
b-=2*e;this.values.pop()}b/=this.gain;f=0;for(a=this.values.length;f<a;)e=f++,this.values[e]/=b;if(0<this.linear)for(b=this.gain/(2*this.values.length-1),f=0,a=this.values.length;f<a;)e=f++,d=this.values[e],this.values[e]=d+this.linear*(b-d),d=this.offsets[e],this.offsets[e]=d+this.linear*((0==e?0:(2*e-.5)/(e*c))-d)},getKernelSize:function(){null==this.values&&this.calcValues();return 0>=this.radius?0:2*this.values.length-1},apply:function(a,b,c){if(0>=this.radius&&null==this.shader.fixedColor__)null!=
c&&sc.run(b,c);else{null==c&&(c=b);null==this.values&&this.calcValues();var d=0!=(b.flags&1<<O.Cube._hx_index),e=d?6:1;a=a.textures.allocTarget(b.name+"BlurTmp",b.width,b.height,!1,b.format,d?[O.Cube]:null);var f=this.shader;f.constModified=!0;f.Quality__=this.values.length;this.shader.values__=this.values;this.shader.offsets__=this.offsets;d?(this.shader.cubeTexture__=b,f=this.shader,f.constModified=!0,f.isCube__=!0):(this.shader.texture__=b,f=this.shader,f.constModified=!0,f.isCube__=!1);f=this.shader.pixel__;
var g=1/b.width,h=0;null==h&&(h=0);null==g&&(g=0);f.x=g;f.y=h;g=f.z=0;for(h=e;g<h;)f=g++,this.get_engine().pushTarget(a,f),d&&(this.shader.cubeDir__=this.cubeDir[f]),this.render(),this.get_engine().popTarget();d?this.shader.cubeTexture__=a:this.shader.texture__=a;f=this.shader.pixel__;g=0;h=1/b.height;null==h&&(h=0);null==g&&(g=0);f.x=g;f.y=h;f.z=0;b=c.depthBuffer;c.depthBuffer=null;g=0;for(h=e;g<h;)f=g++,this.get_engine().pushTarget(c,f),d&&(this.shader.cubeDir__=this.cubeDir[f]),this.render(),this.get_engine().popTarget();
c.depthBuffer=b}},__class__:mg});var ka=function(){this.priority=0;this.initialize()};z["hxsl.Shader"]=ka;ka.__name__="hxsl.Shader";ka.prototype={initialize:function(){this.constModified=!0;if(null==this.shader){var a=Z.getClass(this);this.shader=a._SHADER;if(null==this.shader){for(var b=a;null!=b&&null==b.SRC;)b=b.__super__;if(null==b)throw u.thrown(a.__name__+" has no shader source");this.shader=b._SHADER;null==this.shader&&(this.shader=new Qb(b.SRC,b._MODULE),b._SHADER=this.shader)}}},setPriority:function(a){this.priority=
a},getParamValue:function(a){throw u.thrown("assert");},getParamFloatValue:function(a){throw u.thrown("assert");},setParamIndexValue:function(a,b){throw u.thrown("assert");},setParamIndexFloatValue:function(a,b){throw u.thrown("assert");},updateConstants:function(a){throw u.thrown("assert");},updateConstantsFinal:function(a){for(var b=this.shader.consts;null!=b;){if(0!=b.globalId){var c=a.map.h[b.globalId],d=b.v.type;switch(d._hx_index){case 1:d=c;if(0!=d>>>b.bits)throw u.thrown("Constant "+b.v.name+
" is outside range ("+d+" > "+((1<<b.bits)-1)+")");this.constBits|=d<<b.pos;break;case 2:c&&(this.constBits|=1<<b.pos);break;case 17:d=d.size;if(null==c){b=b.next;continue}var e=c.channel;if(null==c.texture)e=hb.Unknown;else if(null==e||e==hb.Unknown)switch(d){case 1:if(c.texture.format==Y.nativeFormat)e=hb.PackedFloat;else throw u.thrown("Constant "+b.v.name+" does not define channel select value");break;case 3:if(c.texture.format==Y.nativeFormat)e=hb.PackedNormal;else throw u.thrown("Constant "+
b.v.name+" does not define channel select value");break;default:throw u.thrown("Constant "+b.v.name+" does not define channel select value");}this.constBits|=(a.allocChannelID(c.texture)<<3|e._hx_index)<<b.pos;break;default:throw u.thrown("assert");}}b=b.next}a=this.shader;b=this.constBits;d=a.instanceCache.h[b];this.instance=null==d?a.makeInstance(b):d},clone:function(){return this},toString:function(){return Z.getClass(this).__name__},__class__:ka};var Xa=function(){this.flipY__=0;ka.call(this)};
z["h3d.shader.ScreenShader"]=Xa;Xa.__name__="h3d.shader.ScreenShader";Xa.__super__=ka;Xa.prototype=J(ka.prototype,{get_flipY:function(){return this.flipY__},set_flipY:function(a){return this.flipY__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.flipY__:null},getParamFloatValue:function(a){return 0==a?this.flipY__:0},setParamIndexValue:function(a,b){0==a&&(this.flipY__=b)},setParamIndexFloatValue:function(a,b){0==a&&(this.flipY__=
b)},clone:function(){var a=Object.create(Xa.prototype);a.shader=this.shader;a.flipY__=this.flipY__;return a},__class__:Xa});var Id=function(){this.color__=new T(0,0,0,1);Xa.call(this)};z["h3d.pass._Border.BorderShader"]=Id;Id.__name__="h3d.pass._Border.BorderShader";Id.__super__=Xa;Id.prototype=J(Xa.prototype,{get_color:function(){return this.color__},set_color:function(a){return this.color__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;
case 1:return this.color__}return null},getParamFloatValue:function(a){return 0==a?this.flipY__:0},clone:function(){var a=Object.create(Id.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.color__=this.color__;return a},__class__:Id});var ng=function(a,b,c){null==c&&(c=1);Lb.call(this,new Id);this.width=a;this.height=b;this.size=c;a=this.shader.color__;var d=c=b=1,e=1;null==e&&(e=1);null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=e};z["h3d.pass.Border"]=ng;ng.__name__="h3d.pass.Border";
ng.__super__=Lb;ng.prototype=J(Lb.prototype,{createPrimitive:function(){var a=Xd._new(0),b=0/this.width*2-1;if(a.pos==a.array.length){var c=a.array.length<<1;128>c&&(c=128);c=new Float32Array(c);c.set(a.array);a.array=c}a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),
a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;var d=this.size;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.size;b=this.width/
this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&
(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=this.size/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),
a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=this.size/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height-
this.size;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height-this.size;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==
a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=0/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<
1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=(this.width-this.size)/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),
a.array=c);a.array[a.pos++]=b;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-0/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=(this.width-this.size)/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=
b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;d=this.height;b=this.width/this.width*2-1;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;b=1-d/this.height*2;a.pos==a.array.length&&(c=a.array.length<<1,128>c&&(c=128),c=new Float32Array(c),c.set(a.array),a.array=c);a.array[a.pos++]=b;this.primitive=new hh({vbuf:a,format:N.make([new Ma("position",
2,0)])},!0)},render:function(){null==this.primitive&&this.createPrimitive();Lb.prototype.render.call(this)},dispose:function(){null!=this.primitive&&this.primitive.dispose();Lb.prototype.dispose.call(this)},__class__:ng});var Qe=function(){this.layer__=0;Xa.call(this)};z["h3d.pass._Copy.ArrayCopyShader"]=Qe;Qe.__name__="h3d.pass._Copy.ArrayCopyShader";Qe.__super__=Xa;Qe.prototype=J(Xa.prototype,{get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},get_layer:function(){return this.layer__},
set_layer:function(a){return this.layer__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.texture__;case 2:return this.layer__}return null},getParamFloatValue:function(a){switch(a){case 0:return this.flipY__;case 2:return this.layer__}return 0},clone:function(){var a=Object.create(Qe.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.texture__=this.texture__;a.layer__=this.layer__;
return a},__class__:Qe});var gf=function(){Lb.call(this,new Qe)};z["h3d.pass.ArrayCopy"]=gf;gf.__name__="h3d.pass.ArrayCopy";gf.run=function(a,b,c,d,e,f){var g=na.CURRENT;if(null==c||null==a||null!=d&&d!=xa.None||null!=e||!g.driver.copyTexture(a,c)){var h=g.resCache.h[gf.__id__];null==h&&(h=new gf,g.resCache.set(gf,h));h.apply(a,b,c,d,e,f)}};gf.__super__=Lb;gf.prototype=J(Lb.prototype,{apply:function(a,b,c,d,e,f){null!=c&&this.get_engine().pushTarget(c,null!=f?f:0);this.shader.texture__=a;this.shader.layer__=
b;if(null!=e){null!=d&&e.setBlendMode(d);for(a=e.shaders;null!=a.next;)a=a.next;a.next=this.pass.shaders;b=this.pass;this.pass=e;this.render();this.pass=b;a.next=null}else this.pass.setBlendMode(null==d?xa.None:d),this.render();this.shader.texture__=null;this.shader.layer__=0;null!=c&&this.get_engine().popTarget()},__class__:gf});var Re=function(){Xa.call(this)};z["h3d.pass._Copy.CopyShader"]=Re;Re.__name__="h3d.pass._Copy.CopyShader";Re.__super__=Xa;Re.prototype=J(Xa.prototype,{get_texture:function(){return this.texture__},
set_texture:function(a){return this.texture__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.texture__}return null},getParamFloatValue:function(a){return 0==a?this.flipY__:0},clone:function(){var a=Object.create(Re.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.texture__=this.texture__;return a},__class__:Re});var sc=function(){Lb.call(this,new Re)};z["h3d.pass.Copy"]=sc;sc.__name__=
"h3d.pass.Copy";sc.run=function(a,b,c,d,e){var f=na.CURRENT;if(null==b||null==a||null!=c&&c!=xa.None||null!=d||null!=e||!f.driver.copyTexture(a,b)){var g=f.resCache.h[sc.__id__];null==g&&(g=new sc,f.resCache.set(sc,g));g.apply(a,b,c,d,e)}};sc.__super__=Lb;sc.prototype=J(Lb.prototype,{apply:function(a,b,c,d,e){null!=b&&this.get_engine().pushTarget(b,null!=e?e:0,null,rc.NotBound);this.shader.texture__=a;if(null!=d){null!=c&&d.setBlendMode(c);for(a=d.shaders;null!=a.next;)a=a.next;a.next=this.pass.shaders;
c=this.pass;this.pass=d;this.render();this.pass=c;a.next=null}else this.pass.setBlendMode(null==c?xa.None:c),this.render();this.shader.texture__=null;null!=b&&this.get_engine().popTarget()},__class__:sc});var me=function(){this.mat__=new ma;Xa.call(this)};z["h3d.pass._CubeCopy.CubeCopyShader"]=me;me.__name__="h3d.pass._CubeCopy.CubeCopyShader";me.__super__=Xa;me.prototype=J(Xa.prototype,{get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},get_mat:function(){return this.mat__},
set_mat:function(a){return this.mat__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.texture__;case 2:return this.mat__}return null},getParamFloatValue:function(a){return 0==a?this.flipY__:0},clone:function(){var a=Object.create(me.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.texture__=this.texture__;a.mat__=this.mat__;return a},__class__:me});var le=function(){this.cubeDir=
[Ac.L([0,0,-1,0,0,-1,0,0,1,0,0,0]),Ac.L([0,0,1,0,0,-1,0,0,-1,0,0,0]),Ac.L([1,0,0,0,0,0,1,0,0,1,0,0]),Ac.L([1,0,0,0,0,0,-1,0,0,-1,0,0]),Ac.L([1,0,0,0,0,-1,0,0,0,0,1,0]),Ac.L([-1,0,0,0,0,-1,0,0,0,0,-1,0])];Lb.call(this,new me)};z["h3d.pass.CubeCopy"]=le;le.__name__="h3d.pass.CubeCopy";le.run=function(a,b,c,d){null==d&&(d=0);var e=na.CURRENT;if(null==b||null==a||null!=c&&c!=xa.None||0!=d||!e.driver.copyTexture(a,b)){var f=e.resCache.h[le.__id__];null==f&&(f=new le,e.resCache.set(le,f));f.apply(a,b,c,
d)}};le.__super__=Lb;le.prototype=J(Lb.prototype,{apply:function(a,b,c,d){null==d&&(d=0);this.shader.texture__=a;null!=b&&this.get_engine().pushTarget(b,0,d);this.shader.mat__=this.cubeDir[0];this.pass.setBlendMode(null==c?xa.None:c);this.render();null!=b&&this.get_engine().popTarget();null!=b&&this.get_engine().pushTarget(b,1,d);this.shader.mat__=this.cubeDir[1];this.pass.setBlendMode(null==c?xa.None:c);this.render();null!=b&&this.get_engine().popTarget();null!=b&&this.get_engine().pushTarget(b,
2,d);this.shader.mat__=this.cubeDir[2];this.pass.setBlendMode(null==c?xa.None:c);this.render();null!=b&&this.get_engine().popTarget();null!=b&&this.get_engine().pushTarget(b,3,d);this.shader.mat__=this.cubeDir[3];this.pass.setBlendMode(null==c?xa.None:c);this.render();null!=b&&this.get_engine().popTarget();null!=b&&this.get_engine().pushTarget(b,4,d);this.shader.mat__=this.cubeDir[4];this.pass.setBlendMode(null==c?xa.None:c);this.render();null!=b&&this.get_engine().popTarget();null!=b&&this.get_engine().pushTarget(b,
5,d);this.shader.mat__=this.cubeDir[5];this.pass.setBlendMode(null==c?xa.None:c);this.render();null!=b&&this.get_engine().popTarget();this.shader.texture__=null},__class__:le});var Rb=function(a,b){this.defaultSort=(A=new yi,M(A,A.sort));this.name=a;this.output=new bg(b)};z["h3d.pass.Output"]=Rb;Rb.__name__="h3d.pass.Output";Rb.prototype={get_globals:function(){return this.ctx.globals},setContext:function(a){this.ctx=a},dispose:function(){},processShaders:function(a,b){for(a=this.ctx.extraShaders;null!=
a;)b=this.ctx.allocShaderList(a.s,b),a=a.next;return b},setupShaders:function(a){var b=!1;for(a=a.current;null!=a;){var c=a;a=a.next;var d=c.pass.getShadersRec();d=this.processShaders(c,d);c.pass.enableLights&&null!=this.ctx.lightSystem&&(b||(this.ctx.lightSystem.initGlobals(this.ctx.globals),b=!0),d=this.ctx.lightSystem.computeLight(c.obj,d));c.shader=this.output.compileShaders(this.ctx.globals,d,c.pass.batchMode?Kb.Batch:Kb.Default);c.shaders=d;var e=c.shader.fragment.textures;if(null!=e?15==e.type._hx_index:
1)c.texture=0;else{var f=this.ctx,g=!0;null==g&&(g=!1);if(null!=e.perObjectGlobal){g=f.globals.map.h[e.perObjectGlobal.gid];if(null==g)throw u.thrown("Missing global value "+e.perObjectGlobal.path+" for shader "+f.shaderInfo(d,e.perObjectGlobal.path));e=17==e.type._hx_index?g.texture:g}else{for(f=e.instance;0<--f;)d=d.next;f=d.s.getParamValue(e.index);if(null==f&&!g)throw u.thrown("Missing param value "+w.string(d.s)+"."+e.name);e=f}c.texture=null==e?0:e.id}}},log:function(a){},drawObject:function(a){this.ctx.drawPass=
a;this.ctx.engine.selectMaterial(a.pass);a.obj.flags|=65536;a.obj.draw(this.ctx)},draw:function(a,b){if(null!=a.current){this.ctx.setupTarget();this.setupShaders(a);null==b?this.defaultSort(a):b(a);b=this.ctx.shaderBuffers;var c=null;for(a=a.current;null!=a;){var d=a;a=a.next;var e=this.ctx;var f=d.obj.prevAbsPos;e.globals.map.h[e.globalPreviousModelView_id]=null!=f?f:d.obj.absPos;e=this.ctx;e.globals.map.h[e.globalModelView_id]=d.obj.absPos;d.shader.globals.h.hasOwnProperty(this.ctx.globalModelViewInverse_id)&&
(e=this.ctx,f=d.obj.getInvPos(),e.globals.map.h[e.globalModelViewInverse_id]=f);if(c!=d.shader){c=d.shader;if(null!=Rb.onShaderError)try{this.ctx.engine.selectShader(d.shader)}catch(g){e=u.caught(g).unwrap();Rb.onShaderError(e,d);continue}else this.ctx.engine.selectShader(d.shader);e=d.shader;b.vertex.grow(e.vertex);null!=e.fragment&&b.fragment.grow(e.fragment);this.ctx.fillGlobals(b,d.shader);this.ctx.engine.uploadShaderBuffers(b,0)}d.pass.dynamicParameters||(this.ctx.fillParams(b,d.shader,d.shaders),
this.ctx.engine.uploadShaderBuffers(b,1),this.ctx.engine.uploadShaderBuffers(b,2),this.ctx.engine.uploadShaderBuffers(b,3));this.drawObject(d)}e=this.ctx;e.cachedPos=0;e.drawPass=null}},__class__:Rb};var ne=function(a){this.pcfQuality=this.pcfScale=1;this.bias=.01;this.power=30;this.samplingKind=ce.None;this.size=1024;this.mode=Cb.None;this.enabled=!0;this.updateStatic=!1;null==this.format&&(this.format=F.R16F);na.CURRENT.driver.isSupportedFormat(this.format)||(this.format=Y.nativeFormat);Rb.call(this,
"shadow",this.getOutputs());this.light=a;this.blur=new mg(5);this.blur.set_quality(.5);a=this.blur.shader;a.constModified=!0;a.isDepth__=this.format==Y.nativeFormat};z["h3d.pass.Shadows"]=ne;ne.__name__="h3d.pass.Shadows";ne.__super__=Rb;ne.prototype=J(Rb.prototype,{set_mode:function(a){if(a!=Cb.None)throw u.thrown("Shadow mode "+w.string(a)+" not supported for "+w.string(this.light));return this.mode=a},set_enabled:function(a){return this.enabled=a},set_size:function(a){a!=this.size&&null!=this.staticTexture&&
(this.staticTexture.dispose(),this.staticTexture=null);return this.size=a},dispose:function(){Rb.prototype.dispose.call(this);this.blur.dispose();null!=this.staticTexture&&this.staticTexture.dispose()},getShadowProj:function(){return this.lightCamera.m},getShadowTex:function(){return null},isUsingWorldDist:function(){return!1},getOutputs:function(){return this.isUsingWorldDist()?[dc.Swiz(dc.Value("output.worldDist",1),[sa.X,sa.X,sa.X,sa.X])]:this.format==Y.nativeFormat?[dc.PackFloat(dc.Value("output.depth"))]:
[dc.Swiz(dc.Value("output.depth",1),[sa.X,sa.X,sa.X,sa.X])]},loadStaticData:function(a){return!1},saveStaticData:function(){return null},computeStatic:function(a){throw u.thrown("Not implemented");},needStaticUpdate:function(){switch(this.mode._hx_index){case 1:case 3:this.updateStatic=!0}},createDefaultShadowMap:function(){var a=Y.fromColor(16777215);a.name="defaultShadowMap";return a},syncEarlyExit:function(){this.syncShader(null==this.staticTexture?this.createDefaultShadowMap():this.staticTexture)},
syncShader:function(a){},filterPasses:function(a){var b,c;if(this.ctx.computingStatic||this.updateStatic)switch(this.mode._hx_index){case 0:return!1;case 1:var d=c=null;var e=a.discarded;var f=a.lastDisc;for(b=a.current;null!=b;)1==b.pass.isStatic?null==c?c=d=b:d=d.next=b:null==e?e=f=b:f=f.next=b,b=b.next;null!=d&&(d.next=null);null!=f&&(f.next=null);a.current=c;a.discarded=e;a.lastDisc=f;return!0;case 2:return!1;case 3:d=c=null;e=a.discarded;f=a.lastDisc;for(b=a.current;null!=b;)1==b.pass.isStatic?
null==c?c=d=b:d=d.next=b:null==e?e=f=b:f=f.next=b,b=b.next;null!=d&&(d.next=null);null!=f&&(f.next=null);a.current=c;a.discarded=e;a.lastDisc=f;return!0}else switch(this.mode._hx_index){case 0:return!1;case 1:return this.syncEarlyExit(),!1;case 2:return!0;case 3:d=c=null;e=a.discarded;f=a.lastDisc;for(b=a.current;null!=b;)0==b.pass.isStatic?null==c?c=d=b:d=d.next=b:null==e?e=f=b:f=f.next=b,b=b.next;null!=d&&(d.next=null);null!=f&&(f.next=null);a.current=c;a.discarded=e;a.lastDisc=f;return!0}},cullPasses:function(a,
b){for(var c=null,d=!0,e=null,f=null,g=a.discarded,h=a.lastDisc,k=a.current;null!=k;){var l=k.obj.cullingCollider;null==l?l=!0:(l!=c&&(c=l,d=b(l)),l=d);l?null==e?e=f=k:f=f.next=k:null==g?g=h=k:h=h.next=k;k=k.next}null!=f&&(f.next=null);null!=h&&(h.next=null);a.current=e;a.discarded=g;a.lastDisc=h},__class__:ne});var Te=function(a){this.maxDist=this.minDist=-1;this.autoZPlanes=!1;this.autoShrink=!0;this.mergePass=new Lb(new Se);ne.call(this,a);this.lightCamera=new gg;this.lightCamera.orthoBounds=new fb;
this.shader=this.dshader=new oe;this.border=new ng(this.size,this.size)};z["h3d.pass.DirShadowMap"]=Te;Te.__name__="h3d.pass.DirShadowMap";Te.__super__=ne;Te.prototype=J(ne.prototype,{set_mode:function(a){var b=this.dshader;b.constModified=!0;b.enable__=a!=Cb.None;return this.mode=a},set_enabled:function(a){var b=this.dshader;b.constModified=!0;b.enable__=a&&this.mode!=Cb.None;return this.enabled=a},set_size:function(a){null!=this.border&&this.size!=a&&(this.border.dispose(),this.border=new ng(a,
a));return ne.prototype.set_size.call(this,a)},dispose:function(){ne.prototype.dispose.call(this);null!=this.depth&&this.depth.dispose();null!=this.border&&this.border.dispose()},getShadowTex:function(){return this.dshader.shadowMap__},calcShadowBounds:function(a){var b,c=this,d=a.orthoBounds,e=-1E9,f=1E9;if(this.autoShrink){var g=new ma,h=Ac.I(),k=this.autoZPlanes?new fb:null;(null!=this.boundingObject?this.boundingObject:this.ctx.scene).iterVisibleMeshes(function(b){if(null!=b.primitive&&b.material.castShadows){var l=
b.primitive.getBounds();if(!(l.xMin>l.xMax)){b=b.primitive instanceof ih?h:b.getAbsPos();c.autoZPlanes&&(k.load(l),k.transform(b),k.zMax>e&&(e=k.zMax),k.zMin<f&&(f=k.zMin));g.multiply3x4(b,a.mcam);var m=l.xMin,n=l.yMin;b=l.zMin;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);var p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;var r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=
m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMin;n=l.yMin;b=l.zMax;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMin;n=l.yMax;b=l.zMin;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);
p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMin;n=l.yMax;b=l.zMax;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+
r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMax;n=l.yMin;b=l.zMin;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=
r);m=l.xMax;n=l.yMin;b=l.zMax;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMax;n=l.yMax;b=l.zMin;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=
b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r);m=l.xMax;n=l.yMax;b=l.zMax;null==b&&(b=0);null==n&&(n=0);null==m&&(m=0);p=b;null==p&&(p=0);null==n&&(n=0);null==m&&(m=0);b=m;m=n;r=p;n=b*g._11+m*g._21+r*g._31+g._41;p=b*g._12+m*g._22+r*g._32+g._42;r=b*g._13+m*g._23+r*g._33+g._43;b=n;m=p;b<d.xMin&&(d.xMin=b);b>d.xMax&&(d.xMax=
b);m<d.yMin&&(d.yMin=m);m>d.yMax&&(d.yMax=m);r<d.zMin&&(d.zMin=r);r>d.zMax&&(d.zMax=r)}}})}else this.mode==Cb.Dynamic&&(d.xMin=-1E20,d.xMax=1E20,d.yMin=-1E20,d.yMax=1E20,d.zMin=-1E20,d.zMax=1E20);if(this.mode==Cb.Dynamic){var l=new fb;var m=0>this.minDist?this.ctx.camera.zNear:this.minDist;var p=0>this.maxDist?this.ctx.camera.zFar:this.maxDist;var t=m;var n=c.ctx.camera.unproject(-1,-1,c.ctx.camera.distanceToDepth(t));var r=n.x;var y=n.y;n=n.z;null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);null==n&&
(n=0);null==y&&(y=0);null==r&&(r=0);var q=r;var u=y;var v=n;if(c.autoShrink&&c.autoZPlanes){n=c.ctx.camera.pos;r=n.x;y=n.y;n=n.z;null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);var w=n;n=new Pb;n.px=r;n.py=y;n.pz=w;n.lx=q-r;n.ly=u-y;n.lz=v-w;n.normalize();w=e;null==w&&(w=0);var x=b=0;r=1;y=n.lx*b+n.ly*x+n.lz*r;r=w-(n.px*b+n.py*x+n.pz*r);x=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y;w=1;0<x&&x*w>t*w&&(r=n.px+x*n.lx,y=n.py+x*n.ly,n=n.pz+x*n.lz,null==n&&(n=0),
null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),q=r,u=y,v=n)}y=a.mcam;n=q*y._11+u*y._21+v*y._31+y._41;t=q*y._12+u*y._22+v*y._32+y._42;u=q*y._13+u*y._23+v*y._33+y._43;r=n;y=t;n=u;r<l.xMin&&(l.xMin=r);r>l.xMax&&(l.xMax=r);y<l.yMin&&(l.yMin=y);y>l.yMax&&(l.yMax=y);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);t=m;n=c.ctx.camera.unproject(-1,1,c.ctx.camera.distanceToDepth(t));r=n.x;y=n.y;n=n.z;null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);null==n&&(n=0);null==y&&(y=0);null==r&&(r=
0);q=r;u=y;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,r=n.x,y=n.y,n=n.z,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),w=n,n=new Pb,n.px=r,n.py=y,n.pz=w,n.lx=q-r,n.ly=u-y,n.lz=v-w,n.normalize(),w=e,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),x=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,w=1,0<x&&x*w>t*w&&(r=n.px+x*n.lx,y=n.py+x*n.ly,n=n.pz+x*n.lz,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&
(y=0),null==r&&(r=0),q=r,u=y,v=n));y=a.mcam;n=q*y._11+u*y._21+v*y._31+y._41;t=q*y._12+u*y._22+v*y._32+y._42;u=q*y._13+u*y._23+v*y._33+y._43;r=n;y=t;n=u;r<l.xMin&&(l.xMin=r);r>l.xMax&&(l.xMax=r);y<l.yMin&&(l.yMin=y);y>l.yMax&&(l.yMax=y);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);t=m;n=c.ctx.camera.unproject(1,-1,c.ctx.camera.distanceToDepth(t));r=n.x;y=n.y;n=n.z;null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);q=r;u=y;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,
r=n.x,y=n.y,n=n.z,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),w=n,n=new Pb,n.px=r,n.py=y,n.pz=w,n.lx=q-r,n.ly=u-y,n.lz=v-w,n.normalize(),w=e,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),x=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,w=1,0<x&&x*w>t*w&&(r=n.px+x*n.lx,y=n.py+x*n.ly,n=n.pz+x*n.lz,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),q=r,u=y,v=n));y=a.mcam;n=q*y._11+u*y._21+v*
y._31+y._41;t=q*y._12+u*y._22+v*y._32+y._42;u=q*y._13+u*y._23+v*y._33+y._43;r=n;y=t;n=u;r<l.xMin&&(l.xMin=r);r>l.xMax&&(l.xMax=r);y<l.yMin&&(l.yMin=y);y>l.yMax&&(l.yMax=y);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);t=m;n=c.ctx.camera.unproject(1,1,c.ctx.camera.distanceToDepth(t));r=n.x;y=n.y;n=n.z;null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);q=r;u=y;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,r=n.x,y=n.y,n=n.z,null==n&&(n=0),null==y&&(y=0),null==
r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),w=n,n=new Pb,n.px=r,n.py=y,n.pz=w,n.lx=q-r,n.ly=u-y,n.lz=v-w,n.normalize(),w=e,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),x=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,w=1,0<x&&x*w>t*w&&(r=n.px+x*n.lx,y=n.py+x*n.ly,n=n.pz+x*n.lz,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),q=r,u=y,v=n));y=a.mcam;n=q*y._11+u*y._21+v*y._31+y._41;t=q*y._12+u*y._22+v*y._32+y._42;u=q*y._13+
u*y._23+v*y._33+y._43;r=n;y=t;n=u;r<l.xMin&&(l.xMin=r);r>l.xMax&&(l.xMax=r);y<l.yMin&&(l.yMin=y);y>l.yMax&&(l.yMax=y);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);t=p;n=c.ctx.camera.unproject(-1,-1,c.ctx.camera.distanceToDepth(t));r=n.x;y=n.y;n=n.z;null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);q=r;u=y;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,r=n.x,y=n.y,n=n.z,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=
0),w=n,n=new Pb,n.px=r,n.py=y,n.pz=w,n.lx=q-r,n.ly=u-y,n.lz=v-w,n.normalize(),w=f,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),x=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,w=-1,0<x&&x*w>t*w&&(r=n.px+x*n.lx,y=n.py+x*n.ly,n=n.pz+x*n.lz,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),q=r,u=y,v=n));y=a.mcam;n=q*y._11+u*y._21+v*y._31+y._41;t=q*y._12+u*y._22+v*y._32+y._42;u=q*y._13+u*y._23+v*y._33+y._43;r=n;y=t;n=u;r<l.xMin&&(l.xMin=
r);r>l.xMax&&(l.xMax=r);y<l.yMin&&(l.yMin=y);y>l.yMax&&(l.yMax=y);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);t=p;n=c.ctx.camera.unproject(-1,1,c.ctx.camera.distanceToDepth(t));r=n.x;y=n.y;n=n.z;null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);q=r;u=y;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,r=n.x,y=n.y,n=n.z,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),w=n,n=new Pb,n.px=r,n.py=y,n.pz=w,n.lx=q-r,n.ly=u-
y,n.lz=v-w,n.normalize(),w=f,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),x=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,w=-1,0<x&&x*w>t*w&&(r=n.px+x*n.lx,y=n.py+x*n.ly,n=n.pz+x*n.lz,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),q=r,u=y,v=n));y=a.mcam;n=q*y._11+u*y._21+v*y._31+y._41;t=q*y._12+u*y._22+v*y._32+y._42;u=q*y._13+u*y._23+v*y._33+y._43;r=n;y=t;n=u;r<l.xMin&&(l.xMin=r);r>l.xMax&&(l.xMax=r);y<l.yMin&&(l.yMin=y);y>l.yMax&&
(l.yMax=y);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);t=p;n=c.ctx.camera.unproject(1,-1,c.ctx.camera.distanceToDepth(t));r=n.x;y=n.y;n=n.z;null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);q=r;u=y;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,r=n.x,y=n.y,n=n.z,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),w=n,n=new Pb,n.px=r,n.py=y,n.pz=w,n.lx=q-r,n.ly=u-y,n.lz=v-w,n.normalize(),w=f,null==w&&(w=0),x=b=0,r=1,
y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),x=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,w=-1,0<x&&x*w>t*w&&(r=n.px+x*n.lx,y=n.py+x*n.ly,n=n.pz+x*n.lz,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),q=r,u=y,v=n));y=a.mcam;n=q*y._11+u*y._21+v*y._31+y._41;t=q*y._12+u*y._22+v*y._32+y._42;u=q*y._13+u*y._23+v*y._33+y._43;r=n;y=t;n=u;r<l.xMin&&(l.xMin=r);r>l.xMax&&(l.xMax=r);y<l.yMin&&(l.yMin=y);y>l.yMax&&(l.yMax=y);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=
n);t=p;n=c.ctx.camera.unproject(1,1,c.ctx.camera.distanceToDepth(t));r=n.x;y=n.y;n=n.z;null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);null==n&&(n=0);null==y&&(y=0);null==r&&(r=0);q=r;u=y;v=n;c.autoShrink&&c.autoZPlanes&&(n=c.ctx.camera.pos,r=n.x,y=n.y,n=n.z,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),w=n,n=new Pb,n.px=r,n.py=y,n.pz=w,n.lx=q-r,n.ly=u-y,n.lz=v-w,n.normalize(),w=f,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),x=
1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,w=-1,0<x&&x*w>t*w&&(r=n.px+x*n.lx,y=n.py+x*n.ly,n=n.pz+x*n.lz,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),q=r,u=y,v=n));y=a.mcam;n=q*y._11+u*y._21+v*y._31+y._41;t=q*y._12+u*y._22+v*y._32+y._42;u=q*y._13+u*y._23+v*y._33+y._43;r=n;y=t;n=u;r<l.xMin&&(l.xMin=r);r>l.xMax&&(l.xMax=r);y<l.yMin&&(l.yMin=y);y>l.yMax&&(l.yMax=y);n<l.zMin&&(l.zMin=n);n>l.zMax&&(l.zMax=n);this.autoShrink?(l.zMin=d.zMin,d.intersection(d,l),
this.autoZPlanes&&(n=a.target,w=a.pos,r=n.x-w.x,y=n.y-w.y,n=n.z-w.z,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),q=r,u=y,v=n,w=q*q+u*u+v*v,w=1E-20>w?0:1/Math.sqrt(w),r=q*w,y=u*w,n=v*w,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),p=r,m=y,l=n,v=1E9,n=d.xMin,t=d.yMin,r=n,y=t,n=d.zMin,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),u=r,q=y,r=n,y=a.getInverseView(),n=u*y._11+
q*y._21+r*y._31+y._41,t=u*y._12+q*y._22+r*y._32+y._42,u=u*y._13+q*y._23+r*y._33+y._43,r=n,y=t,n=u,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),u=r,q=y,t=n,n=new Pb,n.px=u,n.py=q,n.pz=t,n.lx=p,n.ly=m,n.lz=l,n.normalize(),w=e,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),u=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,u<v&&(v=u),n=d.xMin,t=d.yMax,r=n,y=t,n=d.zMin,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==
y&&(y=0),null==r&&(r=0),u=r,q=y,r=n,y=a.getInverseView(),n=u*y._11+q*y._21+r*y._31+y._41,t=u*y._12+q*y._22+r*y._32+y._42,u=u*y._13+q*y._23+r*y._33+y._43,r=n,y=t,n=u,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),u=r,q=y,t=n,n=new Pb,n.px=u,n.py=q,n.pz=t,n.lx=p,n.ly=m,n.lz=l,n.normalize(),w=e,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),u=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,u<v&&(v=u),n=d.xMax,t=d.yMin,r=n,y=t,n=d.zMin,
null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),u=r,q=y,r=n,y=a.getInverseView(),n=u*y._11+q*y._21+r*y._31+y._41,t=u*y._12+q*y._22+r*y._32+y._42,u=u*y._13+q*y._23+r*y._33+y._43,r=n,y=t,n=u,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),u=r,q=y,t=n,n=new Pb,n.px=u,n.py=q,n.pz=t,n.lx=p,n.ly=m,n.lz=l,n.normalize(),w=e,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),u=1E-10>(0>y?-y:y)?1E-10>
(0>r?-r:r)?0:-1:r/y,u<v&&(v=u),n=d.xMax,t=d.yMax,r=n,y=t,n=d.zMin,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),u=r,q=y,r=n,y=a.getInverseView(),n=u*y._11+q*y._21+r*y._31+y._41,t=u*y._12+q*y._22+r*y._32+y._42,u=u*y._13+q*y._23+r*y._33+y._43,r=n,y=t,n=u,null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),null==n&&(n=0),null==y&&(y=0),null==r&&(r=0),u=r,q=y,t=n,n=new Pb,n.px=u,n.py=q,n.pz=t,n.lx=p,n.ly=m,n.lz=l,n.normalize(),w=e,null==w&&(w=0),x=b=0,r=1,y=n.lx*b+
n.ly*x+n.lz*r,r=w-(n.px*b+n.py*x+n.pz*r),u=1E-10>(0>y?-y:y)?1E-10>(0>r?-r:r)?0:-1:r/y,u<v&&(v=u),d.zMin+=v)):d.load(l)}d.scaleCenter(1.01)},syncShader:function(a){var b=this.dshader;b.constModified=!0;b.shadowMap__=a;b=this.dshader;b.constModified=!0;b.shadowMapChannel__=this.format==Y.nativeFormat?hb.PackedFloat:hb.R;this.dshader.shadowBias__=this.bias;this.dshader.shadowPower__=this.power;this.dshader.shadowProj__=this.getShadowProj();b=this.dshader;b.constModified=!0;b.USE_ESM__=this.samplingKind==
ce.ESM;this.dshader.shadowPower__=this.power;b=this.dshader;b.constModified=!0;b.USE_PCF__=this.samplingKind==ce.PCF;b=this.dshader.shadowRes__;var c=a.width;a=a.height;null==a&&(a=0);null==c&&(c=0);b.x=c;b.y=a;b.z=0;this.dshader.pcfScale__=this.pcfScale;this.dshader.set_pcfQuality(this.pcfQuality)},saveStaticData:function(){if(this.mode!=Cb.Mixed&&this.mode!=Cb.Static)return null;if(null==this.staticTexture)throw u.thrown("Data not computed");var a=bi.run(this.staticTexture.capturePixels().bytes,
9),b=new Vd;b.addInt32(this.staticTexture.width);b.addFloat(this.lightCamera.pos.x);b.addFloat(this.lightCamera.pos.y);b.addFloat(this.lightCamera.pos.z);b.addFloat(this.lightCamera.target.x);b.addFloat(this.lightCamera.target.y);b.addFloat(this.lightCamera.target.z);b.addFloat(this.lightCamera.orthoBounds.xMin);b.addFloat(this.lightCamera.orthoBounds.yMin);b.addFloat(this.lightCamera.orthoBounds.zMin);b.addFloat(this.lightCamera.orthoBounds.xMax);b.addFloat(this.lightCamera.orthoBounds.yMax);b.addFloat(this.lightCamera.orthoBounds.zMax);
b.addInt32(a.length);b.add(a);return b.getBytes()},loadStaticData:function(a){if(this.mode!=Cb.Mixed&&this.mode!=Cb.Static||null==a)return!1;var b=new Zb(a);a=b.readInt32();if(a!=this.size)return!1;this.lightCamera.pos.x=b.readFloat();this.lightCamera.pos.y=b.readFloat();this.lightCamera.pos.z=b.readFloat();this.lightCamera.target.x=b.readFloat();this.lightCamera.target.y=b.readFloat();this.lightCamera.target.z=b.readFloat();this.lightCamera.orthoBounds.xMin=b.readFloat();this.lightCamera.orthoBounds.yMin=
b.readFloat();this.lightCamera.orthoBounds.zMin=b.readFloat();this.lightCamera.orthoBounds.xMax=b.readFloat();this.lightCamera.orthoBounds.yMax=b.readFloat();this.lightCamera.orthoBounds.zMax=b.readFloat();this.lightCamera.update();var c=b.readInt32();b=new ya(a,a,ci.run(b.read(c)),this.format);null!=this.staticTexture&&this.staticTexture.dispose();this.staticTexture=new Y(a,a,[O.Target],this.format);this.staticTexture.uploadPixels(b);this.staticTexture.name="staticTexture";this.staticTexture.preventAutoDispose();
this.syncShader(this.staticTexture);return!0},processShadowMap:function(a,b,c){var d=this.ctx;var e=d.globals.map.h[d.cameraViewProj_id];d=this.ctx;var f=this.getShadowProj();d.globals.map.h[d.cameraViewProj_id]=f;b.isDepth()?(this.ctx.engine.pushDepth(b),this.ctx.engine.clear(null,1)):(this.ctx.engine.pushTarget(b),this.ctx.engine.clear(16777215,1));ne.prototype.draw.call(this,a,c);d=this.ctx.computingStatic||this.updateStatic;a=0<this.blur.radius&&(this.mode!=Cb.Mixed||!d);null==this.border||a||
this.border.render();this.ctx.engine.popTarget();this.mode!=Cb.Mixed||d||null==this.staticTexture?d=!1:(d=this.staticTexture,d=!(null==d.t&&(d.isDepth()||null==d.realloc)));if(d){if(this.staticTexture.width!=b.width)throw u.thrown("Static shadow map doesnt match dynamic shadow map");d=this.ctx.textures.allocTarget("mergedDirShadowMap",this.size,this.size,!1,this.format);this.mergePass.shader.texA__=b;this.mergePass.shader.texB__=this.staticTexture;this.ctx.engine.pushTarget(d);this.mergePass.render();
this.ctx.engine.popTarget();b=d}a&&(b.isDepth()&&(d=this.ctx.textures.allocTarget("dirShadowMapFloat",this.size,this.size,!1,this.format),sc.run(b,d),b=d),this.blur.apply(this.ctx,b),null!=this.border&&(this.ctx.engine.pushTarget(b),this.border.render(),this.ctx.engine.popTarget()));d=this.ctx;d.globals.map.h[d.cameraViewProj_id]=e;return b},draw:function(a,b){var c;if(this.enabled&&this.filterPasses(a)){var d=this.ctx.computingStatic||this.updateStatic;if(this.mode!=Cb.Mixed||d){var e=this.ctx.camera.target;
d=null==this.light?this.ctx.lightSystem.shadowLight:this.light;var f=null==d?null:d.getShadowDirection();if(null==f){d=this.lightCamera.target;var g=c=0;f=-1;null==f&&(f=0);null==g&&(g=0);null==c&&(c=0);d.x=c;d.y=g;d.z=f}else d=this.lightCamera.target,c=f.x,g=f.y,f=f.z,null==f&&(f=0),null==g&&(g=0),null==c&&(c=0),d.x=c,d.y=g,d.z=f,d=this.lightCamera.target,g=d.x*d.x+d.y*d.y+d.z*d.z,g=1E-20>g?0:1/Math.sqrt(g),d.x*=g,d.y*=g,d.z*=g;this.lightCamera.target.x+=e.x;this.lightCamera.target.y+=e.y;this.lightCamera.target.z+=
e.z;d=this.lightCamera.pos;d.x=e.x;d.y=e.y;d.z=e.z;this.lightCamera.update();d=this.lightCamera.orthoBounds;d.xMin=1E20;d.xMax=-1E20;d.yMin=1E20;d.yMax=-1E20;d.zMin=1E20;d.zMax=-1E20;null!=a.current&&this.calcShadowBounds(this.lightCamera);this.lightCamera.update()}e=null;g=!0;f=c=null;for(var h=a.discarded,k=a.lastDisc,l=a.current;null!=l;)d=l.obj.cullingCollider,null==d?d=!0:(d!=e&&(e=d,g=d.inFrustum(this.lightCamera.frustum)),d=g),d?null==c?c=f=l:f=f.next=l:null==h?h=k=l:k=k.next=l,l=l.next;null!=
f&&(f.next=null);null!=k&&(k.next=null);a.current=c;a.discarded=h;a.lastDisc=k;e=this.ctx.textures.allocTarget("dirShadowMap",this.size,this.size,!1,this.format);null!=this.depth&&this.depth.width==this.size&&this.depth.height==this.size?(d=this.depth,d=null==d.t&&(d.isDepth()||null==d.realloc)):d=!0;d&&(null!=this.depth&&this.depth.dispose(),this.depth=new Y(this.size,this.size,null,F.Depth24Stencil8),this.depth.name="dirShadowMapDepth");e.depthBuffer=this.depth;e=this.processShadowMap(a,e,b);this.syncShader(e);
this.updateStatic=!1}},computeStatic:function(a){if(this.mode==Cb.Static||this.mode==Cb.Mixed){this.draw(a);a=this.staticTexture;this.staticTexture=this.dshader.shadowMap__.clone();this.staticTexture.name="StaticDirShadowMap";this.staticTexture.preventAutoDispose();var b=this.dshader;b.constModified=!0;b.shadowMap__=this.staticTexture;null!=a&&a.dispose()}},drawDebug:function(){null==this.g&&(this.g=new Ed(this.ctx.scene),this.g.name="frustumDebug",this.g.material.passes.setPassName("overlay"),this.g.flags|=
512);this.debug&&(this.g.clear(),this.drawBounds(this.lightCamera.getInverseViewProj(),16777215))},drawBounds:function(a,b){var c=-1,d=1,e=0;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var f=new I(c,d,e);c=f;d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;var g=c.x*a._13+c.y*a._23+c.z*a._33+a._43,h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;d=c=1;e=0;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var k=new I(c,d,e);c=k;d=c.x*a._11+c.y*a._21+c.z*a._31+
a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;c=1;d=-1;e=0;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var l=new I(c,d,e);c=l;d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;d=c=-1;e=0;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);var m=new I(c,d,e);c=m;d=c.x*a._11+c.y*
a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;var p=[f,k,l,m];c=-1;e=d=1;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=f=new I(c,d,e);d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;e=d=c=1;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=k=new I(c,d,e);
d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;c=1;d=-1;e=1;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=l=new I(c,d,e);d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;d=c=-1;e=1;null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);c=m=new I(c,
d,e);d=c.x*a._11+c.y*a._21+c.z*a._31+a._41;e=c.x*a._12+c.y*a._22+c.z*a._32+a._42;g=c.x*a._13+c.y*a._23+c.z*a._33+a._43;h=1/(c.x*a._14+c.y*a._24+c.z*a._34+a._44);c.x=d*h;c.y=e*h;c.z=g*h;a=[f,k,l,m];this.g.lineStyle(1,b);b=p[p.length-1];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);for(f=0;f<p.length;)b=p[f],++f,this.g.lineTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);b=a[a.length-1];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);
for(f=0;f<a.length;)b=a[f],++f,this.g.lineTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);b=p[0];f=a[0];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);this.g.lineTo(f.x-this.ctx.scene.x,f.y-this.ctx.scene.y,f.z-this.ctx.scene.z);b=p[1];f=a[1];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);this.g.lineTo(f.x-this.ctx.scene.x,f.y-this.ctx.scene.y,f.z-this.ctx.scene.z);b=p[2];f=a[2];this.g.moveTo(b.x-this.ctx.scene.x,b.y-
this.ctx.scene.y,b.z-this.ctx.scene.z);this.g.lineTo(f.x-this.ctx.scene.x,f.y-this.ctx.scene.y,f.z-this.ctx.scene.z);b=p[3];f=a[3];this.g.moveTo(b.x-this.ctx.scene.x,b.y-this.ctx.scene.y,b.z-this.ctx.scene.z);this.g.lineTo(f.x-this.ctx.scene.x,f.y-this.ctx.scene.y,f.z-this.ctx.scene.z)},__class__:Te});var jh=function(a,b){null==a&&(a=1024);null!=b&&(this.format=b);Te.call(this,null);this.set_size(a);this.color=new I(0,0,0);this.set_mode(Cb.Dynamic);this.shadowMapId=za.allocID("shadow.map");this.shadowProjId=
za.allocID("shadow.proj");this.shadowColorId=za.allocID("shadow.color");this.shadowPowerId=za.allocID("shadow.power");this.shadowBiasId=za.allocID("shadow.bias")};z["h3d.pass.DefaultShadowMap"]=jh;jh.__name__="h3d.pass.DefaultShadowMap";jh.__super__=Te;jh.prototype=J(Te.prototype,{draw:function(a,b){Te.prototype.draw.call(this,a,b);this.ctx.globals.map.h[this.shadowMapId]={texture:this.dshader.shadowMap__,channel:this.format==Y.nativeFormat?hb.PackedFloat:hb.R};a=this.ctx.globals;b=this.shadowProjId;
var c=this.getShadowProj();a.map.h[b]=c;this.ctx.globals.map.h[this.shadowColorId]=this.color;this.ctx.globals.map.h[this.shadowPowerId]=this.power;this.ctx.globals.map.h[this.shadowBiasId]=this.bias},__class__:jh});var bg=function(a){this.shaderCache=xd.get();this.currentOutput=new Fb(null);this.setOutput(a)};z["h3d.pass.OutputShader"]=bg;bg.__name__="h3d.pass.OutputShader";bg.prototype={setOutput:function(a){null==a&&(a=[dc.Value("output.color")]);this.currentOutput.s=this.shaderCache.getLinkShader(a)},
compileShaders:function(a,b,c){null==c&&(c=Kb.Default);a.maxChannels=0;for(var d=b;null!=d;){var e=d.s;d=d.next;e.updateConstants(a)}this.currentOutput.next=b;e=this.shaderCache.link(this.currentOutput,c);this.currentOutput.next=null;return e},__class__:bg};var kh=function(a){this.o=a};z["h3d.pass.PassListIterator"]=kh;kh.__name__="h3d.pass.PassListIterator";kh.prototype={hasNext:function(){return null!=this.o},next:function(){var a=this.o;this.o=this.o.next;return a},__class__:kh};var lh=function(a){this.current=
a;this.discarded=this.lastDisc=null};z["h3d.pass.PassList"]=lh;lh.__name__="h3d.pass.PassList";lh.prototype={init:function(a){this.current=a;this.discarded=this.lastDisc=null},reset:function(){null!=this.discarded&&(this.lastDisc.next=this.current,this.current=this.discarded,this.discarded=this.lastDisc=null)},count:function(){for(var a=this.current,b=0;null!=a;)++b,a=a.next;return b},save:function(){return this.lastDisc},load:function(a){this.lastDisc!=a&&(this.lastDisc.next=this.current,null==a?
(this.current=this.discarded,this.discarded=null):(this.current=a.next,a.next=null),this.lastDisc=a)},isEmpty:function(){return null==this.current},clear:function(){if(null!=this.current){null==this.discarded?this.discarded=this.current:this.lastDisc.next=this.current;for(var a=this.current;null!=a.next;)a=a.next;this.lastDisc=a;this.current=null}},sort:function(a){var b=this.current;if(null==b)a=null;else{for(var c=1,d,e,f,g,h,k,l;;){g=b;l=b=null;for(d=0;null!=g;){++d;h=g;f=e=0;for(k=c;f<k&&(f++,
++e,h=h.next,null!=h););for(f=c;0<e||0<f&&null!=h;)0==e?(k=h,h=h.next,--f):0==f||null==h||0>=a(g,h)?(k=g,g=g.next,--e):(k=h,h=h.next,--f),null!=l?l.next=k:b=k,l=k;g=h}l.next=null;if(1>=d)break;c*=2}a=b}this.current=a},filter:function(a){for(var b=null,c=null,d=this.discarded,e=this.lastDisc,f=this.current;null!=f;)a(f)?null==b?b=c=f:c=c.next=f:null==d?d=e=f:e=e.next=f,f=f.next;null!=c&&(c.next=null);null!=e&&(e.next=null);this.current=b;this.discarded=d;this.lastDisc=e},iterator:function(){return new kh(this.current)},
getFiltered:function(){return new kh(this.discarded)},__class__:lh};var zi=function(){this.texture=0};z["h3d.pass.PassObject"]=zi;zi.__name__="h3d.pass.PassObject";zi.prototype={__class__:zi};var Cb=L["h3d.pass.RenderMode"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h3d.pass.RenderMode",toString:v},Static:{_hx_name:"Static",_hx_index:1,__enum__:"h3d.pass.RenderMode",toString:v},Dynamic:{_hx_name:"Dynamic",_hx_index:2,__enum__:"h3d.pass.RenderMode",toString:v},Mixed:{_hx_name:"Mixed",
_hx_index:3,__enum__:"h3d.pass.RenderMode",toString:v}};Cb.__constructs__=[Cb.None,Cb.Static,Cb.Dynamic,Cb.Mixed];Cb.__empty_constructs__=[Cb.None,Cb.Static,Cb.Dynamic,Cb.Mixed];var ce=L["h3d.pass.ShadowSamplingKind"]={__ename__:!0,__constructs__:null,None:{_hx_name:"None",_hx_index:0,__enum__:"h3d.pass.ShadowSamplingKind",toString:v},PCF:{_hx_name:"PCF",_hx_index:1,__enum__:"h3d.pass.ShadowSamplingKind",toString:v},ESM:{_hx_name:"ESM",_hx_index:2,__enum__:"h3d.pass.ShadowSamplingKind",toString:v}};
ce.__constructs__=[ce.None,ce.PCF,ce.ESM];ce.__empty_constructs__=[ce.None,ce.PCF,ce.ESM];var yi=function(){this.shaderCount=this.textureCount=1;this.shaderIdMap=[];this.textureIdMap=[]};z["h3d.pass.SortByMaterial"]=yi;yi.__name__="h3d.pass.SortByMaterial";yi.prototype={sort:function(a){for(var b,c=this.shaderCount,d=this.textureCount,e=a.current;null!=e;){b=e;e=e.next;if(this.shaderIdMap[b.shader.id]<c||null==this.shaderIdMap[b.shader.id])this.shaderIdMap[b.shader.id]=this.shaderCount++;if(this.textureIdMap[b.texture]<
d||null==this.textureIdMap[b.shader.id])this.textureIdMap[b.texture]=this.textureCount++}c=a.current;if(null==c)b=null;else{d=1;for(var f,g,h,k,l;;){b=c;l=c=null;for(e=0;null!=b;){++e;h=b;g=f=0;for(k=d;g<k&&(g++,++f,h=h.next,null!=h););for(g=d;0<f||0<g&&null!=h;)0==f?(k=h,h=h.next,--g):(0!=g&&null!=h?(b.pass.layer!=h.pass.layer?k=b.pass.layer-h.pass.layer:(k=this.shaderIdMap[b.shader.id]-this.shaderIdMap[h.shader.id],k=0!=k?k:this.textureIdMap[b.texture]-this.textureIdMap[h.texture]),k=0>=k):k=!0,
k?(k=b,b=b.next,--f):(k=h,h=h.next,--g)),null!=l?l.next=k:c=k,l=k;b=h}l.next=null;if(1>=e)break;d*=2}b=c}a.current=b},__class__:yi};var ec=function(a,b){this.isStatic=!0;this.hasTangents=!1;this.bufPos=this.idxPos=this.startIndex=0;Wa.call(this);this.format=a;this.buffers=[];this.allIndexes=[];this.bounds=new fb;this.allocator=b;if(3>a.stride)throw u.thrown("Minimum stride = 3");this.allocPos=rd.make()};z["h3d.prim.BigPrimitive"]=ec;ec.__name__="h3d.prim.BigPrimitive";ec.__super__=Wa;ec.prototype=
J(Wa.prototype,{begin:function(a,b){var c;this.startIndex=this.bufPos/this.format.stride|0;if(65535<=this.startIndex+a){if(65535<=a)throw u.thrown("Too many vertices in begin()");this.flush()}if(null==this.tmpBuf&&(this.tmpBuf=ec.PREV_BUFFER,null==this.tmpBuf?this.tmpBuf=Xd._new(0):ec.PREV_BUFFER=null,this.isStatic)){var d=this.tmpBuf;var e=d.pos;for(c=65535*this.format.stride;e<c;){e++;if(d.pos==d.array.length){var f=d.array.length<<1;128>f&&(f=128);f=new Float32Array(f);f.set(d.array);d.array=f}d.array[d.pos++]=
0}}if(!this.isStatic)for(d=this.tmpBuf,e=d.pos,c=a*this.format.stride+this.bufPos;e<c;)e++,d.pos==d.array.length&&(f=d.array.length<<1,128>f&&(f=128),f=new Float32Array(f),f.set(d.array),d.array=f),d.array[d.pos++]=0;null==this.tmpIdx&&(this.tmpIdx=ec.PREV_INDEX,null==this.tmpIdx?this.tmpIdx=[]:ec.PREV_INDEX=null);if(this.idxPos+b>this.tmpIdx.length){a=0==this.tmpIdx.length?1024:this.tmpIdx.length;for(b=this.idxPos+b;a<b;)a<<=1;for(d=this.tmpIdx;d.length<a;)d.push(0)}},addPoint:function(a,b,c){this.tmpBuf.array[this.bufPos++]=
a;this.tmpBuf.array[this.bufPos++]=b;this.tmpBuf.array[this.bufPos++]=c;var d=this.bounds;a<d.xMin&&(d.xMin=a);a>d.xMax&&(d.xMax=a);b<d.yMin&&(d.yMin=b);b>d.yMax&&(d.yMax=b);c<d.zMin&&(d.zMin=c);c>d.zMax&&(d.zMax=c)},addBounds:function(a,b,c){var d=this.bounds;a<d.xMin&&(d.xMin=a);a>d.xMax&&(d.xMax=a);b<d.yMin&&(d.yMin=b);b>d.yMax&&(d.yMax=b);c<d.zMin&&(d.zMin=c);c>d.zMax&&(d.zMax=c)},addVertexValue:function(a){this.tmpBuf.array[this.bufPos++]=a},addIndex:function(a){this.tmpIdx[this.idxPos++]=a+
this.startIndex},triCount:function(){for(var a=0,b=0,c=this.allIndexes;b<c.length;){var d=c[b];++b;a+=d.vertices}a+=this.idxPos;return a/3|0},vertexCount:function(){for(var a=0,b=0,c=this.buffers;b<c.length;){var d=c[b];++b;a+=d.vertices}return a+=this.bufPos/this.format.stride|0},flush:function(){if(null!=this.tmpBuf){if(0<this.bufPos&&0<this.idxPos){this.flushing=!0;var a=null!=this.allocator?this.allocator.ofSubFloats(this.tmpBuf,this.bufPos/this.format.stride|0,this.format):$b.ofSubFloats(this.tmpBuf,
this.bufPos/this.format.stride|0,this.format);this.buffers.push(a);var b=null!=this.allocator?this.allocator.ofIndexes(this.tmpIdx,this.idxPos):$d.alloc(this.tmpIdx,0,this.idxPos);this.allIndexes.push(b);this.flushing=!1;a.allocPos=this.allocPos;b.allocPos=this.allocPos}if(null==ec.PREV_BUFFER||ec.PREV_BUFFER.pos<this.tmpBuf.pos)ec.PREV_BUFFER=this.tmpBuf;if(null==ec.PREV_INDEX||ec.PREV_INDEX.length<this.tmpIdx.length)ec.PREV_INDEX=this.tmpIdx;this.tmpIdx=this.tmpBuf=null;this.startIndex=this.idxPos=
this.bufPos=0}},render:function(a){null!=this.tmpBuf&&this.flush();for(var b=0,c=this.buffers.length;b<c;){var d=b++;a.renderIndexed(this.buffers[d],this.allIndexes[d])}},getBounds:function(){return this.bounds},dispose:function(){this.clear()},clear:function(){if(this.flushing)throw u.thrown("Cannot clear() BigPrimitive while it's flushing");var a=this.bounds;a.xMin=1E20;a.xMax=-1E20;a.yMin=1E20;a.yMax=-1E20;a.zMin=1E20;a.zMax=-1E20;a=0;for(var b=this.buffers;a<b.length;){var c=b[a];++a;null!=this.allocator?
this.allocator.disposeBuffer(c):c.dispose()}a=0;for(b=this.allIndexes;a<b.length;)c=b[a],++a,null!=this.allocator?this.allocator.disposeIndexBuffer(c):c.dispose();this.buffers=[];this.allIndexes=[];this.idxPos=this.bufPos=0;this.tmpIdx=this.tmpBuf=null},add:function(a,b,c,d,e,f,g,h){null==h&&(h=-1);null==g&&(g=1);null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);this.addSub(a,b,0,0,a.pos/(0>h?this.format.stride:h)|0,b.length/3|0,c,d,e,f,g,h)},addSub:function(a,b,c,d,e,f,g,h,k,l,m,p,t,n,
r,y){null==r&&(r=1);null==n&&(n=0);null==t&&(t=0);null==p&&(p=-1);null==m&&(m=1);null==l&&(l=0);null==k&&(k=0);null==h&&(h=0);null==g&&(g=0);0>p&&(p=this.format.stride);if(p<this.format.stride)throw u.thrown("only stride >= "+this.format.stride+" allowed");this.begin(e,3*f);var q=this.startIndex,v=Math.cos(l),w=Math.sin(l),x=this.bufPos,z=this.tmpBuf;for(l=0;l<e;){var A=l++;A=(A+c)*p;var B=a.array[A++],C=a.array[A++],E=a.array[A++];if(null!=y){var D=B;null==E&&(E=0);null==C&&(C=0);null==D&&(D=0);
B=E;null==B&&(B=0);null==C&&(C=0);null==D&&(D=0);E=D;D=C;C=B;B=E*y._12+D*y._22+C*y._32+y._42;var F=E*y._13+D*y._23+C*y._33+y._43;E=E*y._11+D*y._21+C*y._31+y._41;D=B;C=F;z.array[x++]=E;z.array[x++]=D;z.array[x++]=C;B=this.bounds;E<B.xMin&&(B.xMin=E);E>B.xMax&&(B.xMax=E);D<B.yMin&&(B.yMin=D);D>B.yMax&&(B.yMax=D);C<B.zMin&&(B.zMin=C);C>B.zMax&&(B.zMax=C)}else D=g+(B*v-C*w)*m,C=h+(B*w+C*v)*m,E=k+E*m,z.array[x++]=D,z.array[x++]=C,z.array[x++]=E,B=this.bounds,D<B.xMin&&(B.xMin=D),D>B.xMax&&(B.xMax=D),C<
B.yMin&&(B.yMin=C),C>B.yMax&&(B.yMax=C),E<B.zMin&&(B.zMin=E),E>B.zMax&&(B.zMax=E);E=this.format.stride;if(6<=E)if(F=a.array[A++],C=a.array[A++],D=a.array[A++],null!=y){B=F;null==D&&(D=0);null==C&&(C=0);null==B&&(B=0);F=D;null==F&&(F=0);null==C&&(C=0);null==B&&(B=0);D=B;B=F;F=D*y._12+C*y._22+B*y._32;var H=D*y._13+C*y._23+B*y._33;D=D*y._11+C*y._21+B*y._31;C=F;B=H;F=D*D+C*C+B*B;F=1E-20>F?0:1/Math.sqrt(F);D*=F;C*=F;B*=F;z.array[x++]=D;z.array[x++]=C;z.array[x++]=B}else B=F*v-C*w,C=F*w+C*v,z.array[x++]=
B,z.array[x++]=C,z.array[x++]=D;if(this.hasTangents){F=a.array[A++];C=a.array[A++];D=a.array[A++];if(null!=y){B=F;null==D&&(D=0);null==C&&(C=0);null==B&&(B=0);F=D;null==F&&(F=0);null==C&&(C=0);null==B&&(B=0);D=B;B=F;F=D*D+C*C+B*B;H=D*y._12+C*y._22+B*y._32;var I=D*y._13+C*y._23+B*y._33;D=D*y._11+C*y._21+B*y._31;C=H;B=I;H=D*D+C*C+B*B;H=1E-20>H?0:1/Math.sqrt(H);D*=H;C*=H;B*=H;.5>F&&(D*=.5,C*=.5,B*=.5);z.array[x++]=D;z.array[x++]=C;z.array[x++]=B}else B=F*v-C*w,C=F*w+C*v,z.array[x++]=B,z.array[x++]=C,
z.array[x++]=D;E-=3}switch(E){case 3:case 6:continue;case 4:case 7:z.array[x++]=a.array[A++]+t;break;case 5:case 8:case 9:case 10:z.array[x++]=a.array[A++]+t;z.array[x++]=a.array[A++]+n;for(D=8;D<E;)D++,z.array[x++]=a.array[A++];break;default:for(z.array[x++]=a.array[A++]+t,z.array[x++]=a.array[A++]+n,z.array[x++]=a.array[A++]*r,z.array[x++]=a.array[A++]*r,z.array[x++]=a.array[A++]*r,D=11;D<E;)D++,z.array[x++]=a.array[A++]}}this.bufPos=x;q-=c;l=0;for(e=3*f;l<e;)A=l++,a=b[A+3*d]+q,this.tmpIdx[this.idxPos++]=
a},__class__:ec});var Ai=function(a){this.shapesBytes=[];this.inputMapping=[];this.hmdModel=a;if(a.get_data().vertexFormat.hasLowPrecision)throw u.thrown("Blend shape doesn't support low precision");a.get_data();var b=a.get_data().vertexFormat;a.get_data();var c=0;var d=0;for(var e=a.lib.header.geometries;d<e.length;){var f=e[d];var g=d++;f==a.get_data()&&(c=g)}g=[];f=0;for(d=a.lib.header.shapes;f<d.length;){var h=d[f];++f;h.geom==c&&g.push(h)}this.shapes=g;this.weights=[];g=0;for(f=this.shapes.length;g<
f;)h=g++,e=this.shapes[h],d=e.vertexCount*e.vertexFormat.strideBytes,h=new S(new ArrayBuffer(d)),a.lib.resource.entry.readBytes(h,0,a.dataPosition+e.vertexPosition,d),d=a.get_data().vertexCount<<2,c=new S(new ArrayBuffer(d)),a.lib.resource.entry.readBytes(c,0,a.dataPosition+e.remapPosition,d),this.shapesBytes.push({vertexBytes:h,remapBytes:c}),this.inputMapping.push(new La),this.weights.push(0);d=0;for(e=b.inputs;d<e.length;)for(a=e[d++],g=0,f=this.shapes.length;g<f;){h=g++;c=b=0;for(var k=this.shapes[h].vertexFormat.inputs;c<
k.length;){var l=k[c++];l.name==a.name&&(this.inputMapping[h].h[l.name]=b);l=l.type;b+=l==Z.__cast(9,cc)?1:l}}};z["h3d.prim.Blendshape"]=Ai;Ai.__name__="h3d.prim.Blendshape";Ai.prototype={setBlendshapeAmount:function(a,b){if(a>=this.weights.length)throw u.thrown("Blendshape at index "+a+" doesn't exist (there is only "+this.weights.length+" blendshapes).");this.weights[a]=b;this.uploadBlendshapeBytes()},getBlendshapeCount:function(){return null==this.hmdModel.lib.header.shapes?0:this.shapes.length},
uploadBlendshapeBytes:function(){null!=this.hmdModel.buffer&&null!=this.hmdModel.buffer.vbuf||this.hmdModel.alloc(na.CURRENT);var a=65536<this.hmdModel.get_data().vertexCount,b=this.hmdModel.get_data().vertexFormat,c=this.hmdModel.get_data().vertexCount*b.strideBytes,d=new S(new ArrayBuffer(c));this.hmdModel.lib.resource.entry.readBytes(d,0,this.hmdModel.dataPosition+this.hmdModel.get_data().vertexPosition,c);var e=new S(new ArrayBuffer(d.length));e.fill(0,d.length,0);c=0;for(var f=this.shapes.length;c<
f;)for(var g=c++,h=this.shapesBytes[g],k=0,l=0;k<this.shapes[g].indexCount;){for(var m=h.remapBytes.getInt32(l<<2),p=!1;!p;){(p=0!=m>>31)&&(m^=-2147483648);for(var t=0,n=0,r=0,y=this.shapes[g].vertexFormat.inputs;r<y.length;){var q=y[r++],u=0,v=q.type;for(v=v==Z.__cast(9,cc)?1:v;u<v;){var w=u++,x=d.getFloat(m*b.stride+this.inputMapping[g].h[q.name]+w<<2),z=h.vertexBytes.getFloat(k*this.shapes[g].vertexFormat.stride+n+w<<2);x=x+this.weights[g]*(x+z-x)-x;w=m*b.stride+this.inputMapping[g].h[q.name]+
w<<2;e.setFloat(w,e.getFloat(w)+x)}q=q.type;n+=q==Z.__cast(9,cc)?1:q;++t}++l;l<this.hmdModel.get_data().vertexCount&&(m=h.remapBytes.getInt32(l<<2))}++k}b=new S(new ArrayBuffer(d.length));b.blit(0,d,0,d.length);c=0;for(f=e.length/4|0;c<f;)d=c++,b.setFloat(d<<2,b.getFloat(d<<2)+e.getFloat(d<<2));this.hmdModel.buffer.uploadBytes(b,0,this.hmdModel.get_data().vertexCount);this.hmdModel.indexCount=0;this.hmdModel.indexesTriPos=[];c=0;for(f=this.hmdModel.get_data().indexCounts;c<f.length;)d=f[c],++c,this.hmdModel.indexesTriPos.push(this.hmdModel.indexCount/
3|0),this.hmdModel.indexCount+=d;c=(a?4:2)*this.hmdModel.indexCount;b=this.hmdModel.lib.resource.entry.fetchBytes(this.hmdModel.dataPosition+this.hmdModel.get_data().indexPosition,c);this.hmdModel.indexes.uploadBytes(b,0,this.hmdModel.indexCount)},__class__:Ai};var og=function(a,b){this.hmdModel=a;this.data=b};z["h3d.prim.Collider"]=og;og.__name__="h3d.prim.Collider";og.fromHmd=function(a){for(var b=a.lib.header,c=0,d=b.models;c<d.length;){var e=d[c];++c;if(b.geometries[e.geometry]==a.get_data())return new og(a,
b.colliders[e.collider])}return null};og.prototype={getBuffers:function(){for(var a=this.hmdModel.dataPosition+this.data.vertexPosition,b=this.hmdModel.dataPosition+this.data.indexPosition,c=[],d=0,e=this.data.vertexCounts.length;d<e;){var f=d++,g=this.data.vertexCounts[f],h=this.data.indexCounts[f],k=65536<g;f=12*g;var l=new S(new ArrayBuffer(f));this.hmdModel.lib.resource.entry.readBytes(l,0,a,f);var m=new mh;m.vertexes=Array(3*g);var p=0;for(g*=3;p<g;){var t=p++;m.vertexes[t]=l.getFloat(4*t)}l=
h*(k?4:2);p=new S(new ArrayBuffer(l));this.hmdModel.lib.resource.entry.readBytes(p,0,b,l);m.indexes=Array(h);g=k?4:2;if(k)for(k=0;k<h;)t=k++,m.indexes[t]=p.getInt32(t*g);else for(k=0;k<h;)t=k++,m.indexes[t]=p.getUInt16(t*g);c.push(m);a+=f;b+=l}return c},__class__:og};var Kc=function(){Wa.call(this)};z["h3d.prim.MeshPrimitive"]=Kc;Kc.__name__="h3d.prim.MeshPrimitive";Kc.__super__=Wa;Kc.prototype=J(Wa.prototype,{hasInput:function(a){return null!=this.resolveBuffer(a)},resolveBuffer:function(a){if(null!=
this.buffers){for(var b=0,c=this.buffers;b<c.length;){var d=c[b];++b;if(d.format.hasInput(a))return d}return null}return null!=this.buffer&&this.buffer.format.hasInput(a)?this.buffer:null},removeBuffer:function(a){null!=this.buffers?(D.remove(this.buffers,a),a==this.buffer&&(this.buffer=this.buffers[this.buffers.length-1]),1==this.buffers.length&&(this.formats=this.buffers=null)):this.buffer==a&&(this.buffer=null)},addBuffer:function(a){if(null==this.buffer)this.buffer=a;else{if(null==this.buffers){if(a==
this.buffer)throw u.thrown("Duplicate addBuffer()");this.buffers=[this.buffer]}else if(0<=this.buffers.indexOf(a))throw u.thrown("Duplicate addBuffer()");this.buffers.unshift(a);a=[];for(var b=0,c=this.buffers;b<c.length;){var d=c[b];++b;a.push(d.format)}this.formats=cd.make(a)}},dispose:function(){Wa.prototype.dispose.call(this);if(null!=this.buffers){for(var a=0,b=this.buffers;a<b.length;){var c=b[a];++a;c.dispose()}this.formats=this.buffers=null}},render:function(a){null!=this.indexes&&null!=this.indexes.vbuf&&
null!=this.buffer&&null!=this.buffer.vbuf||this.alloc(a);null!=this.buffers?a.renderMultiBuffers(this.formats,this.buffers,this.indexes):a.renderIndexed(this.buffer,this.indexes)},__class__:Kc});var $c=function(a,b){this.translatedX=this.translatedY=this.translatedZ=0;this.scaled=1;Wa.call(this);this.points=a;this.idx=b};z["h3d.prim.Polygon"]=$c;$c.__name__="h3d.prim.Polygon";$c.__super__=Kc;$c.prototype=J(Kc.prototype,{getBounds:function(){for(var a=new fb,b=0,c=this.points;b<c.length;){var d=c[b];
++b;d.x<a.xMin&&(a.xMin=d.x);d.x>a.xMax&&(a.xMax=d.x);d.y<a.yMin&&(a.yMin=d.y);d.y>a.yMax&&(a.yMax=d.y);d.z<a.zMin&&(a.zMin=d.z);d.z>a.zMax&&(a.zMax=d.z)}return a},alloc:function(a){this.dispose();a=N.get_POS3D();null!=this.normals&&(a=a.append("normal",3));null!=this.tangents&&(a=a.append("tangent",3));null!=this.uvs&&(a=a.append("uv",2));null!=this.colors&&(a=a.append("color",3));for(var b=Xd._new(0),c=0,d=this.points.length;c<d;){var e=c++,f=this.points[e],g=f.x;if(b.pos==b.array.length){var h=
b.array.length<<1;128>h&&(h=128);h=new Float32Array(h);h.set(b.array);b.array=h}b.array[b.pos++]=g;g=f.y;b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h);b.array[b.pos++]=g;f=f.z;b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g);b.array[b.pos++]=f;null!=this.normals&&(f=this.normals[e],g=f.x,b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),
b.array=h),b.array[b.pos++]=g,g=f.y,b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h),b.array[b.pos++]=g,f=f.z,b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=f);null!=this.tangents&&(f=this.tangents[e],g=f.x,b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h),b.array[b.pos++]=g,g=f.y,b.pos==b.array.length&&(h=b.array.length<<
1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h),b.array[b.pos++]=g,f=f.z,b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=f);null!=this.uvs&&(f=this.uvs[e],g=f.u,b.pos==b.array.length&&(h=b.array.length<<1,128>h&&(h=128),h=new Float32Array(h),h.set(b.array),b.array=h),b.array[b.pos++]=g,f=f.v,b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=
f);null!=this.colors&&(e=this.colors[e],f=e.x,b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=f,f=e.y,b.pos==b.array.length&&(g=b.array.length<<1,128>g&&(g=128),g=new Float32Array(g),g.set(b.array),b.array=g),b.array[b.pos++]=f,e=e.z,b.pos==b.array.length&&(f=b.array.length<<1,128>f&&(f=128),f=new Float32Array(f),f.set(b.array),b.array=f),b.array[b.pos++]=e)}this.buffer=$b.ofFloats(b,a);null!=this.idx&&(this.indexes=$d.alloc(this.idx))},
unindex:function(){var a;if(null!=this.idx&&this.points.length!=this.idx.length){var b=[];var c=0;for(a=this.idx.length;c<a;){var d=c++;var e=this.points[this.idx[d]];var f=e.x;d=e.y;e=e.z;null==e&&(e=0);null==d&&(d=0);null==f&&(f=0);b.push(new I(f,d,e))}if(null!=this.normals){var g=[];c=0;for(a=this.idx.length;c<a;)d=c++,e=this.normals[this.idx[d]],f=e.x,d=e.y,e=e.z,null==e&&(e=0),null==d&&(d=0),null==f&&(f=0),g.push(new I(f,d,e));this.normals=g}if(null!=this.tangents){g=[];c=0;for(a=this.idx.length;c<
a;)d=c++,e=this.tangents[this.idx[d]],f=e.x,d=e.y,e=e.z,null==e&&(e=0),null==d&&(d=0),null==f&&(f=0),g.push(new I(f,d,e));this.tangents=g}if(null!=this.colors){g=[];c=0;for(a=this.idx.length;c<a;)d=c++,e=this.colors[this.idx[d]],f=e.x,d=e.y,e=e.z,null==e&&(e=0),null==d&&(d=0),null==f&&(f=0),g.push(new I(f,d,e));this.colors=g}if(null!=this.uvs){g=[];c=0;for(a=this.idx.length;c<a;)d=c++,g.push(this.uvs[this.idx[d]].clone());this.uvs=g}this.points=b;this.idx=null}},translate:function(a,b,c){this.translatedX+=
a;this.translatedY+=b;this.translatedZ+=c;for(var d=0,e=this.points;d<e.length;){var f=e[d];++d;f.x+=a;f.y+=b;f.z+=c}},scale:function(a){this.scaled*=a;for(var b=0,c=this.points;b<c.length;){var d=c[b];++b;d.x*=a;d.y*=a;d.z*=a}},addNormals:function(){this.normals=[];for(var a=0,b=this.points.length;a<b;){var c=a++;this.normals[c]=new I(0,0,0)}a=c=0;for(b=this.triCount();a<b;){a++;if(null==this.idx){++c;var d=c-1;++c;var e=c-1;++c;var f=c-1}else d=this.idx[c++],e=this.idx[c++],f=this.idx[c++];var g=
this.points[d],h=this.points[e],k=this.points[f],l=h.x-g.x,m=h.y-g.y;h=h.z-g.z;null==h&&(h=0);null==m&&(m=0);null==l&&(l=0);var p=m,t=h;null==t&&(t=0);null==p&&(p=0);null==l&&(l=0);m=l;h=p;l=t;t=k.x-g.x;p=k.y-g.y;g=k.z-g.z;null==g&&(g=0);null==p&&(p=0);null==t&&(t=0);k=t;t=g;null==t&&(t=0);null==p&&(p=0);null==k&&(k=0);g=k;k=p;p=h*t-l*k;l=l*g-m*t;m=m*k-h*g;null==m&&(m=0);null==l&&(l=0);null==p&&(p=0);h=p;null==m&&(m=0);null==l&&(l=0);null==h&&(h=0);this.normals[d].x+=h;this.normals[d].y+=l;this.normals[d].z+=
m;this.normals[e].x+=h;this.normals[e].y+=l;this.normals[e].z+=m;this.normals[f].x+=h;this.normals[f].y+=l;this.normals[f].z+=m}a=0;for(b=this.normals;a<b.length;)c=b[a],++a,d=c.x*c.x+c.y*c.y+c.z*c.z,d=1E-20>d?0:1/Math.sqrt(d),c.x*=d,c.y*=d,c.z*=d},addTangents:function(){null==this.normals&&this.addNormals();null==this.uvs&&this.addUVs();this.tangents=[];for(var a=0,b=this.points.length;a<b;){var c=a++;this.tangents[c]=new I(0,0,0)}a=c=0;for(b=this.triCount();a<b;){a++;if(null==this.idx){++c;var d=
c-1;++c;var e=c-1;++c;var f=c-1}else d=this.idx[c++],e=this.idx[c++],f=this.idx[c++];var g=this.points[d],h=this.points[e],k=this.points[f];var l=this.uvs[d];var m=this.uvs[e];var p=this.uvs[f];var t=this.normals[d],n=h.x-g.x;var r=h.y-g.y;h=h.z-g.z;null==h&&(h=0);null==r&&(r=0);null==n&&(n=0);var y=r,q=h;null==q&&(q=0);null==y&&(y=0);null==n&&(n=0);r=n;h=y;n=q;q=k.x-g.x;y=k.y-g.y;g=k.z-g.z;null==g&&(g=0);null==y&&(y=0);null==q&&(q=0);k=q;q=g;null==q&&(q=0);null==y&&(y=0);null==k&&(k=0);g=k;k=y;y=
q;p=p.v-l.v;r*=p;h*=p;n*=p;l=m.v-l.v;g*=l;k*=l;y*=l;l=r-g;m=h-k;p=n-y;null==p&&(p=0);null==m&&(m=0);null==l&&(l=0);l=new I(l,m,p);r=t;p=r.y*l.z-r.z*l.y;m=r.z*l.x-r.x*l.z;l=r.x*l.y-r.y*l.x;null==l&&(l=0);null==m&&(m=0);null==p&&(p=0);r=l;null==r&&(r=0);null==m&&(m=0);null==p&&(p=0);l=p;p=l*l+m*m+r*r;p=1E-20>p?0:1/Math.sqrt(p);l*=p;m*=p;r*=p;p=m*t.z-r*t.y;r=r*t.x-l*t.z;t=l*t.y-m*t.x;null==t&&(t=0);null==r&&(r=0);null==p&&(p=0);t=l=new I(p,r,t);m=t.x*t.x+t.y*t.y+t.z*t.z;m=1E-20>m?0:1/Math.sqrt(m);t.x*=
m;t.y*=m;t.z*=m;this.tangents[d].x+=l.x;this.tangents[d].y+=l.y;this.tangents[d].z+=l.z;this.tangents[e].x+=l.x;this.tangents[e].y+=l.y;this.tangents[e].z+=l.z;this.tangents[f].x+=l.x;this.tangents[f].y+=l.y;this.tangents[f].z+=l.z}a=0;for(b=this.tangents;a<b.length;)l=b[a],++a,r=l,p=r.x*r.x+r.y*r.y+r.z*r.z,p=1E-20>p?0:1/Math.sqrt(p),r.x*=p,r.y*=p,r.z*=p},addUVs:function(){this.uvs=[];for(var a=0,b=this.points.length;a<b;){var c=a++;this.uvs[c]=new Ga(this.points[c].x,this.points[c].y)}},uvScale:function(a,
b){if(null==this.uvs)throw u.thrown("Missing UVs");for(var c=new vc,d=0,e=this.uvs;d<e.length;){var f=e[d];++d;null==c.h.__keys__[f.__id__]&&(c.set(f,!0),f.u*=a,f.v*=b)}},triCount:function(){var a=Kc.prototype.triCount.call(this);return 0!=a?a:(null==this.idx?this.points.length:this.idx.length)/3|0},vertexCount:function(){return this.points.length},getCollider:function(){for(var a=Array(3*this.points.length),b=Array(this.idx.length),c=0,d=0,e=this.points;d<e.length;){var f=e[d];++d;a[c++]=f.x;a[c++]=
f.y;a[c++]=f.z}d=0;for(e=this.idx.length;d<e;)c=d++,b[c]=this.idx[c];d=new cf;d.addBuffers(a,b);return d},render:function(a){null!=this.buffer&&null!=this.buffer.vbuf||this.alloc(a);var b=this.indexes,c=this.triCount();null==b&&(b=a.mem.getTriIndexes(3*c));null!=this.buffers?a.renderMultiBuffers(this.formats,this.buffers,b,0,c):a.renderIndexed(this.buffer,b,0,c)},__class__:$c});var ke=function(a,b,c,d){null==d&&(d=!1);null==c&&(c=1);null==b&&(b=1);null==a&&(a=1);this.sizeX=a;this.sizeY=b;this.sizeZ=
c;var e=0,f=0,g=0;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var h=new I(e,f,g);e=a;g=f=0;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var k=new I(e,f,g);e=0;f=b;g=0;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var l=new I(e,f,g);f=e=0;g=c;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var m=new I(e,f,g);e=a;f=b;g=0;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var p=new I(e,f,g);e=a;f=0;g=c;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var t=new I(e,f,g);e=0;f=b;g=c;null==g&&(g=0);null==f&&(f=0);null==
e&&(e=0);var n=new I(e,f,g);e=a;f=b;g=c;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);e=[h,k,l,m,p,t,n,new I(e,f,g)];f=[];f.push(0);f.push(1);f.push(5);f.push(0);f.push(5);f.push(3);f.push(1);f.push(4);f.push(7);f.push(1);f.push(7);f.push(5);f.push(3);f.push(5);f.push(7);f.push(3);f.push(7);f.push(6);f.push(0);f.push(6);f.push(2);f.push(0);f.push(3);f.push(6);f.push(2);f.push(7);f.push(4);f.push(2);f.push(6);f.push(7);f.push(0);f.push(4);f.push(1);f.push(0);f.push(2);f.push(4);$c.call(this,e,f);d&&
this.translate(.5*-a,.5*-b,.5*-c)};z["h3d.prim.Cube"]=ke;ke.__name__="h3d.prim.Cube";ke.defaultUnitCube=function(){var a=na.CURRENT,b=a.resCache.h[ke.__id__];if(null!=b)return b;b=new ke(1,1,1);b.translate(-.5,-.5,-.5);b.unindex();b.addNormals();b.addUniformUVs(1);b.addTangents();a.resCache.set(ke,b);return b};ke.__super__=$c;ke.prototype=J($c.prototype,{addUVs:function(){this.unindex();var a=new Ga(0,1),b=new Ga(1,1),c=new Ga(0,0),d=new Ga(1,0);this.uvs=[b,a,c,b,c,d,b,a,c,b,c,d,b,a,c,b,c,d,a,d,b,
a,c,d,a,d,b,a,c,d,a,d,b,a,c,d]},addUniformUVs:function(a){null==a&&(a=1);this.unindex();this.uvs=[new Ga(a*this.sizeX,a*this.sizeZ),new Ga(0,a*this.sizeZ),new Ga(0,0),new Ga(a*this.sizeX,a*this.sizeZ),new Ga(0,0),new Ga(a*this.sizeX,0),new Ga(a*this.sizeY,a*this.sizeZ),new Ga(0,a*this.sizeZ),new Ga(0,0),new Ga(a*this.sizeY,a*this.sizeZ),new Ga(0,0),new Ga(a*this.sizeY,0),new Ga(a*this.sizeX,a*this.sizeY),new Ga(0,a*this.sizeY),new Ga(0,0),new Ga(a*this.sizeX,a*this.sizeY),new Ga(0,0),new Ga(a*this.sizeX,
0),new Ga(0,a*this.sizeZ),new Ga(a*this.sizeY,0),new Ga(a*this.sizeY,a*this.sizeZ),new Ga(0,a*this.sizeZ),new Ga(0,0),new Ga(a*this.sizeY,0),new Ga(0,a*this.sizeZ),new Ga(a*this.sizeX,0),new Ga(a*this.sizeX,a*this.sizeZ),new Ga(0,a*this.sizeZ),new Ga(0,0),new Ga(a*this.sizeX,0),new Ga(0,a*this.sizeY),new Ga(a*this.sizeX,0),new Ga(a*this.sizeX,a*this.sizeY),new Ga(0,a*this.sizeY),new Ga(0,0),new Ga(a*this.sizeX,0)]},getCollider:function(){var a=this.translatedX,b=this.translatedY,c=this.translatedZ,
d=this.sizeX*this.scaled,e=this.sizeY*this.scaled,f=this.sizeZ*this.scaled,g=new fb;g.xMin=a;g.yMin=b;g.zMin=c;g.xMax=a+d;g.yMax=b+e;g.zMax=c+f;return g},__class__:ke});var pe=function(a,b,c,d){this.lodConfig=null;Wa.call(this);this.lods=[a];if(null!=d)for(a=0;a<d.length;){var e=d[a];++a;this.lods.push(c.header.geometries[e.geometry])}this.dataPosition=b;this.lib=c;null!=c.header.shapes&&0<c.header.shapes.length&&(this.blendshape=new Ai(this));null!=c.header.colliders&&0<c.header.colliders.length&&
(this.colliderData=og.fromHmd(this))};z["h3d.prim.HMDModel"]=pe;pe.__name__="h3d.prim.HMDModel";pe.__super__=Kc;pe.prototype=J(Kc.prototype,{get_data:function(){return this.lods[0]},hasInput:function(a){return Kc.prototype.hasInput.call(this,a)?!0:this.get_data().vertexFormat.hasInput(a)},triCount:function(){return this.get_data().get_indexCount()/3|0},vertexCount:function(){return this.get_data().vertexCount},getBounds:function(){return this.get_data().bounds},selectMaterial:function(a,b){this.curMaterial=
a+b*this.get_data().indexCounts.length},getMaterialIndexStart:function(a,b){null==b&&(b=0);return 3*this.indexesTriPos[a+b*this.get_data().indexCounts.length]},getMaterialIndexCount:function(a,b){null==b&&(b=0);return this.lods[b].indexCounts[a]},getDataBuffers:function(a,b,c){return this.lib.getBuffers(this.get_data(),a,b,c)},loadSkin:function(a){this.lib.loadSkin(this.get_data(),a)},alloc:function(a){var b,c;this.dispose();var d=0,e=this.get_data().vertexFormat;this.indexCount=0;this.indexesTriPos=
[];var f=0;for(c=this.lods;f<c.length;){var g=c[f];++f;d+=g.vertexCount;var h=0;for(b=g.indexCounts;h<b.length;)g=b[h],++h,this.indexesTriPos.push(this.indexCount/3|0),this.indexCount+=g}this.buffer=new $b(d,e);d=65536<d;this.indexes=$d._new(this.indexCount,d);for(var k=d?4:2,l=this.lib.resource.entry,m=0,p=0,t=0,n=this.lods;t<n.length;){g=n[t];b=t++;if(g.vertexFormat!=e){a="LOD"+b+" has a different vertex format, has ";d=0;for(g=g.vertexFormat.inputs;d<g.length;)k=g[d++],a+=k.name+" ";a+=", wants ";
g=0;for(e=e.inputs;g<e.length;)d=e[g++],a+=d.name+" ";throw u.thrown(a);}b=g.vertexCount*e.strideBytes;b=l.fetchBytes(this.dataPosition+g.vertexPosition,b);a.driver.uploadBufferBytes(this.buffer,m,g.vertexCount,b,0);var r=g.get_indexCount(),q=65536<g.vertexCount;b=(q?4:2)*r;var v=l.fetchBytes(this.dataPosition+g.indexPosition,b),w=d!=q?new S(new ArrayBuffer(r*k)):v;if(d)for(f=0,c=r;f<c;)b=f++,q?w.setInt32(b<<2,v.getInt32(b<<2)+m):w.setInt32(b<<2,v.getUInt16(b<<1)+m);else for(h=0,b=r;h<b;)c=h++,q?
w.setUInt16(c<<1,v.getInt32(c<<2)+m):w.setUInt16(c<<1,v.getUInt16(c<<1)+m);a.driver.uploadBufferBytes(this.indexes,p,r,w,0);m+=g.vertexCount;p+=r}null!=this.normalsRecomputed&&(e=this.normalsRecomputed,this.normalsRecomputed=null,this.recomputeNormals(e))},recomputeNormals:function(a){if(null==this.normalsRecomputed&&(null==a||!this.get_data().vertexFormat.hasInput(a))){null==a&&(a="normal");for(var b=Xd._new(0),c=0,d=this.lods;c<d.length;){var e=d[c];++c;for(var f=this.lib.getBuffers(e,N.get_POS3D()),
g=[],h=[],k={},l=0,m=e.vertexCount;l<m;){var p=l++,t=!1,n=f.vertexes[3*p],r=f.vertexes[3*p+1];p=f.vertexes[3*p+2];var q=10.01*(n+r+p)|0,u=k[q];if(null==u)u=[],k[q]=u;else for(q=0;q<u.length;){var v=u[q];++q;var w=h[v];if(w.x==n&&w.y==r&&w.z==p){g.push(v);t=!0;break}}t||(g.push(h.length),u.push(h.length),t=n,null==p&&(p=0),null==r&&(r=0),null==t&&(t=0),h.push(new I(t,r,p)))}k=[];l=0;for(f=f.indexes;l<f.length;)m=f[l],++l,k.push(g[m]);h=new $c(h,k);h.addNormals();k=f=b.pos;for(l=3*e.vertexCount;k<l;)k++,
b.pos==b.array.length&&(m=b.array.length<<1,128>m&&(m=128),m=new Float32Array(m),m.set(b.array),b.array=m),b.array[b.pos++]=0;l=k=0;for(e=e.vertexCount;l<e;)m=l++,m=h.normals[g[m]],b.array[f+k++]=m.x,b.array[f+k++]=m.y,b.array[f+k++]=m.z}b=$b.ofFloats(b,N.make([new Ma(a,3,0)]));this.addBuffer(b);this.normalsRecomputed=a}},addTangents:function(){if(!this.hasInput("tangent")){for(var a=Xd._new(0),b=0,c=this.lods;b<c.length;){var d=c[b];++b;for(var e=this.lib.getBuffers(d,N.get_POS3D()),f=[],g=[],h=
0,k=d.vertexCount;h<k;){var l=h++,m=!1,p=e.vertexes[3*l],t=e.vertexes[3*l+1];l=e.vertexes[3*l+2];for(var n=0,r=g.length;n<r;){var q=n++,u=g[q];if(u.x==p&&u.y==t&&u.z==l){f.push(q);m=!0;break}}m||(f.push(g.length),m=p,null==l&&(l=0),null==t&&(t=0),null==m&&(m=0),g.push(new I(m,t,l)))}h=[];k=0;for(e=e.indexes;k<e.length;)t=e[k],++k,h.push(f[t]);g=new $c(g,h);g.addNormals();g.addTangents();h=e=a.pos;for(k=3*d.vertexCount;h<k;)h++,a.pos==a.array.length&&(t=a.array.length<<1,128>t&&(t=128),t=new Float32Array(t),
t.set(a.array),a.array=t),a.array[a.pos++]=0;k=h=0;for(d=d.vertexCount;k<d;)t=k++,t=g.tangents[f[t]],a.array[e+h++]=t.x,a.array[e+h++]=t.y,a.array[e+h++]=t.z}a=$b.ofFloats(a,N.make([new Ma("tangent",3,0)]));this.addBuffer(a)}},render:function(a){if(0>this.curMaterial)Kc.prototype.render.call(this,a);else{var b=this.get_data().indexCounts.length,c=this.curMaterial/this.get_data().indexCounts.length|0;null!=this.indexes&&null!=this.indexes.vbuf||this.alloc(a);null==this.buffers?a.renderIndexed(this.buffer,
this.indexes,this.indexesTriPos[this.curMaterial],this.lods[c].indexCounts[this.curMaterial%b]/3|0):a.renderMultiBuffers(this.formats,this.buffers,this.indexes,this.indexesTriPos[this.curMaterial],this.lods[c].indexCounts[this.curMaterial%b]/3|0);this.curMaterial=-1}},initCollider:function(a){var b=this.get_data().bounds,c=b.xMax-b.xMin,d=b.yMax-b.yMin,e=b.zMax-b.zMin;b=new ud(.5*(b.xMin+b.xMax),.5*(b.yMin+b.yMax),.5*(b.zMin+b.zMax),.5*Math.sqrt(c*c+d*d+e*e));if(null==this.colliderData){var f=this.lib.getBuffers(this.get_data(),
N.get_POS3D());a.setData(f.vertexes,f.indexes);null==this.collider&&(this.collider=new vf(b,a))}else{c=this.colliderData.getBuffers();d=[];d.length=c.length;for(e=0;e<c.length;){f=c[e];var g=e++,h=new Fd;h.source=a.source;h.setData(f.vertexes,f.indexes);d[g]=h}a=new wf(d);this.collider=new vf(b,a)}},getCollider:function(){if(null!=this.collider)return this.collider;var a=new Fd;a.source={entry:this.lib.resource.entry,geometryName:null};for(var b=0,c=this.lib.header.models;b<c.length;){var d=c[b];
++b;if(this.lib.header.geometries[d.geometry]==this.get_data()){a.source.geometryName=d.name;break}}this.initCollider(a);return this.collider},lodCount:function(){return this.lods.length},screenRatioToLod:function(a){var b=this.lodCount();if(0<=this.forcedLod)return a=this.forcedLod,a>b?b:a;if(1==b)return 0;var c=this.getLodConfig();if(null!=c){var d=c.length>b-1;if(d&&a<c[c.length-1])return b;var e=0,f=0;for(b=d?b-1:c.length;f<b;){d=f++;if(0==c[d])break;if(c[d]>a)++e;else break}return e}return 0},
getLodConfig:function(){if(null!=this.lodConfig)return this.lodConfig;var a=this.lib.resource.entry.get_directory();0>a.indexOf("res/")&&(a="res/"+a);return this.lodConfig=Pa.current.getDefaultLodConfig(a)},__class__:pe});var ih=function(){Wa.call(this);var a=this.bounds=new fb;0<a.xMin&&(a.xMin=0);0>a.xMax&&(a.xMax=0);0<a.yMin&&(a.yMin=0);0>a.yMax&&(a.yMax=0);0<a.zMin&&(a.zMin=0);0>a.zMax&&(a.zMax=0);this.tmpBounds=new fb};z["h3d.prim.Instanced"]=ih;ih.__name__="h3d.prim.Instanced";ih.__super__=
Wa;ih.prototype=J(Wa.prototype,{setMesh:function(a){0<this.refCount&&(null!=this.primitive&&this.primitive.decref(),a.incref());this.primitive=a;this.baseBounds=a.getBounds();null!=a.buffer&&null!=a.indexes||a.alloc(na.CURRENT)},initBounds:function(){var a=this.bounds;a.xMin=1E20;a.xMax=-1E20;a.yMin=1E20;a.yMax=-1E20;a.zMin=1E20;a.zMax=-1E20},addInstanceBounds:function(a){this.tmpBounds.load(this.baseBounds);this.tmpBounds.transform(a);a=this.bounds;var b=this.tmpBounds;b.xMin<a.xMin&&(a.xMin=b.xMin);
b.xMax>a.xMax&&(a.xMax=b.xMax);b.yMin<a.yMin&&(a.yMin=b.yMin);b.yMax>a.yMax&&(a.yMax=b.yMax);b.zMin<a.zMin&&(a.zMin=b.zMin);b.zMax>a.zMax&&(a.zMax=b.zMax)},dispose:function(){},incref:function(){0==this.refCount&&null!=this.primitive&&this.primitive.incref();Wa.prototype.incref.call(this)},decref:function(){Wa.prototype.decref.call(this);0==this.refCount&&null!=this.primitive&&this.primitive.decref()},getBounds:function(){return this.bounds},screenRatioToLod:function(a){return this.primitive.screenRatioToLod(a)},
setCommand:function(a,b,c){b>this.primitive.lodCount()-1?this.commands.setCommand(0,0,0):this.commands.setCommand(c,this.primitive.getMaterialIndexCount(a,b),this.primitive.getMaterialIndexStart(a,b))},render:function(a){null!=this.primitive.buffer&&null!=this.primitive.buffer.vbuf||this.primitive.alloc(a);a.needFlushTarget&&a.doFlushTarget();null==this.primitive.buffers?a.driver.selectBuffer(this.primitive.buffer):a.driver.selectMultiBuffers(this.primitive.formats,this.primitive.buffers);var b=this.primitive.indexes;
null==b&&(b=a.mem.getTriIndexes(3*this.triCount()));a.renderInstanced(b,this.commands)},__class__:ih});var Pa=function(){};z["h3d.prim.ModelDatabase"]=Pa;Pa.__name__="h3d.prim.ModelDatabase";Pa.customizeLodConfig=function(a){return a};Pa.prototype={get_baseDir:function(){return""},getFilePath:function(a){return null==a||""==a?Pa.FILE_NAME:a+"/"+Pa.FILE_NAME},getRootData:function(a){if(null==a)return null;var b=Pa.db.h[a];if(null!=b)return b;b=this.getFilePath(a);try{var c=JSON.parse(bd.currentInstance.load(b).toText())}catch(d){if(u.caught(d).unwrap()instanceof
kg)c={};else throw d;}return Pa.db.h[a]=c},getModelData:function(a,b,c){b=b+"/"+c;a=this.getRootData(a);this.cleanOldModelData(a,b);return ua.field(a,b)},saveModelData:function(a,b,c,d){var e=this.getFilePath(a);a=this.getRootData(a);b=b+"/"+c;null==d||0==ua.fields(d).length?ua.deleteField(a,b):a[b]=d;throw u.thrown("Can't save model props database "+e);},getDefaultLodConfig:function(a){a=Pa.baseLodConfig;return a=Pa.customizeLodConfig(a)},cleanOldModelData:function(a,b){var c=ua.field(a,Pa.LOD_CONFIG);
if(null!=c){for(var d=0,e=ua.fields(c);d<e.length;){var f=e[d];++d;if(!(0>b.indexOf(f))){var g={lodConfig:ua.field(c,f)};a[b]=g;ua.deleteField(c,f);a[Pa.LOD_CONFIG]=c}}null!=c&&0!=ua.fields(c).length||ua.deleteField(a,Pa.LOD_CONFIG)}},loadLodConfig:function(a,b){b=ua.field(b,Pa.LOD_CONFIG);null!=b&&null!=a.hmd&&(a.hmd.lodConfig=b)},loadDynamicBonesConfig:function(a,b){b=ua.field(b,Pa.DYN_BONES_CONFIG);if(null!=b&&null!=a.skin){for(var c=a.skin.getSkinData(),d=0,e=c.allJoints;d<e.length;){var f=e[d];
++d;a:{for(var g=0;g<b.length;){var h=b[g];++g;if(h.name==f.name)break a}h=null}if(null!=h){g=new ae;g.index=f.index;g.name=f.name;g.bindIndex=f.bindIndex;g.splitIndex=f.splitIndex;g.defMat=f.defMat;g.transPos=f.transPos;g.parent=f.parent;g.follow=f.follow;g.subs=f.subs;g.offsets=f.offsets;g.offsetRay=f.offsetRay;g.retargetAnim=f.retargetAnim;g.damping=h.damping;g.resistance=h.resistance;g.slackness=h.slackness;g.stiffness=h.stiffness;g.additive=h.additive;var k;if(null==h.lockAxis)var l=k=0,m=0;
else k=h.lockAxis,k=null!=k?k.x:null,l=h.lockAxis,l=null!=l?l.y:null,m=h.lockAxis,m=null!=m?m.z:null;null==m&&(m=0);null==l&&(l=0);null==k&&(k=0);k=new I(k,l,m);g.lockAxis=k;k=h.globalForce.x;l=h.globalForce.y;h=h.globalForce.z;null==h&&(h=0);null==l&&(l=0);null==k&&(k=0);g.globalForce=new I(k,l,h);c.allJoints[f.index]=g;h=f.parent;null!=h&&h.subs.push(g);h=f.parent;null!=h&&D.remove(h.subs,f);if(null!=g.subs)for(f=0,h=g.subs;f<h.length;)k=h[f],++f,k.parent=g}}a.skin.setSkinData(c)}},saveLodConfig:function(a,
b){var c,d=!0,e=this.getDefaultLodConfig(a.resourceDirectory);if(null!=a.hmd.lodConfig){e.length!=a.hmd.lodConfig.length&&(d=!1);var f=0;for(c=a.hmd.lodConfig.length;f<c;){var g=f++;if(e[g]!=a.hmd.lodConfig[g]){d=!1;break}}}if(d)ua.deleteField(b,Pa.LOD_CONFIG);else{d=[];f=0;for(c=a.hmd.lodCount();f<c;)g=f++,d[g]=g>=a.hmd.lodConfig.length?0:a.hmd.lodConfig[g];b[Pa.LOD_CONFIG]=d}},saveDynamicBonesConfig:function(a,b){if(null!=a.skin){var c=[],d=0;for(a=a.skin.getSkinData().allJoints;d<a.length;){var e=
a[d];++d;e=e instanceof ae?e:null;null!=e&&c.push({name:e.name,slackness:e.slackness,stiffness:e.stiffness,resistance:e.resistance,damping:e.damping,additive:e.additive,globalForce:e.globalForce,lockAxis:e.lockAxis})}0==c.length?ua.deleteField(b,Pa.DYN_BONES_CONFIG):b[Pa.DYN_BONES_CONFIG]=c}},loadModelProps:function(a){var b=this.getModelData(a.resourceDirectory,a.resourceName,a.objectName);null!=b&&(this.loadLodConfig(a,b),this.loadDynamicBonesConfig(a,b))},saveModelProps:function(a){var b=this.getModelData(a.resourceDirectory,
a.resourceName,a.objectName);null==b&&(b={});this.saveLodConfig(a,b);this.saveDynamicBonesConfig(a,b);this.saveModelData(a.resourceDirectory,a.resourceName,a.objectName,b)},__class__:Pa};var Pe=function(){Wa.call(this)};z["h3d.prim.Plane2D"]=Pe;Pe.__name__="h3d.prim.Plane2D";Pe.get=function(){var a=na.CURRENT,b=a.resCache.h[Pe.__id__];null==b&&(b=new Pe,a.resCache.set(Pe,b));return b};Pe.__super__=Wa;Pe.prototype=J(Wa.prototype,{triCount:function(){return 2},vertexCount:function(){return 4},alloc:function(a){a=
Xd._new(0);if(a.pos==a.array.length){var b=a.array.length<<1;128>b&&(b=128);b=new Float32Array(b);b.set(a.array);a.array=b}a.array[a.pos++]=-1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=-1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=0;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);
a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=-1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=0;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=
b);a.array[a.pos++]=0;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=-1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=
b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=b);a.array[a.pos++]=1;a.pos==a.array.length&&(b=a.array.length<<1,128>b&&(b=128),b=new Float32Array(b),b.set(a.array),a.array=
b);a.array[a.pos++]=0;this.buffer=$b.ofFloats(a,N.get_XY_UV())},render:function(a){null!=this.buffer&&null!=this.buffer.vbuf||this.alloc(a);var b=this.buffer;a.renderBuffer(b,a.mem.getQuadIndexes(b.vertices),2,0,-1)},__class__:Pe});var hh=function(a,b){null==b&&(b=!1);Wa.call(this);this.onContextLost=function(){return a};this.bounds=a.bounds;this.alloc(null);b||(this.onContextLost=null)};z["h3d.prim.RawPrimitive"]=hh;hh.__name__="h3d.prim.RawPrimitive";hh.__super__=Wa;hh.prototype=J(Wa.prototype,
{alloc:function(a){if(null==this.onContextLost)throw u.thrown("Cannot realloc "+w.string(this));a=this.onContextLost();this.buffer=$b.ofFloats(a.vbuf,a.format);this.vcount=this.buffer.vertices;this.tcount=null!=a.ibuf?a.ibuf.length/3|0:this.vcount/3|0;null!=a.ibuf?this.indexes=$d.alloc(a.ibuf):null!=this.indexes&&(this.indexes.dispose(),this.indexes=null)},getBounds:function(){if(null==this.bounds)throw u.thrown("Bounds not defined for "+w.string(this));return this.bounds},triCount:function(){return this.tcount},
vertexCount:function(){return this.vcount},__class__:hh});var Ke=function(a,b,c,d){var e;null==d&&(d=1);null==c&&(c=6);null==b&&(b=8);null==a&&(a=1);this.ray=a;this.segsH=c;this.segsW=b;this.portion=d;for(var f=2*Math.PI/b,g=[],h=[],k=0,l=c+1;k<l;){var m=k++;var p=m/c*Math.PI*d;m=Math.sin(p);var t=Math.cos(p);var n=e=0;for(p=b+1;n<p;){n++;var r=m*Math.cos(e)*a,q=m*Math.sin(e)*a,u=t*a;null==u&&(u=0);null==q&&(q=0);null==r&&(r=0);g.push(new I(r,q,u));e+=f}}k=0;for(l=c;k<l;)for(m=k++,n=0,p=b;n<p;)if(e=
n++,a=e+1+m*(b+1),f=e+m*(b+1),t=e+(m+1)*(b+1),e=e+1+(m+1)*(b+1),0!=m&&(h.push(a),h.push(f),h.push(e)),m!=c-1||1!=d)h.push(f),h.push(t),h.push(e);$c.call(this,g,h)};z["h3d.prim.Sphere"]=Ke;Ke.__name__="h3d.prim.Sphere";Ke.defaultUnitSphere=function(){var a=na.CURRENT,b=a.resCache.h[Ke.__id__];if(null!=b)return b;b=new Ke(1,16,16);b.addNormals();b.addUVs();a.resCache.set(Ke,b);return b};Ke.__super__=$c;Ke.prototype=J($c.prototype,{getCollider:function(){return new ud(this.translatedX,this.translatedY,
this.translatedZ,this.ray*this.scaled)},addNormals:function(){this.normals=this.points},addUVs:function(){this.uvs=[];for(var a=0,b=this.segsH+1;a<b;)for(var c=a++,d=0,e=this.segsW+1;d<e;){var f=d++;this.uvs.push(new Ga(1-f/this.segsW,c/this.segsH))}},__class__:Ke});var Ga=function(a,b){this.u=a;this.v=b};z["h3d.prim.UV"]=Ga;Ga.__name__="h3d.prim.UV";Ga.prototype={clone:function(){return new Ga(this.u,this.v)},toString:function(){return"{"+X.fmt(this.u)+","+X.fmt(this.v)+"}"},__class__:Ga};var Ua=
function(a,b,c){this.curScreenRatio=1;this.inheritLod=!1;Aa.call(this,c);this.set_primitive(a);null==b&&(b=Od.current.createMaterial(),b.set_props(b.getDefaultProps()));this.material=b};z["h3d.scene.Mesh"]=Ua;Ua.__name__="h3d.scene.Mesh";Ua.screenRatio=function(a,b,c){var d=a;var e=d._41;var f=d._42;var g=d._43;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);var h=e;var k=f;var l=g;d=a;a=Math.sqrt(d._11*d._11+d._12*d._12+d._13*d._13);var m=Math.sqrt(d._21*d._21+d._22*d._22+d._23*d._23);f=Math.sqrt(d._31*
d._31+d._32*d._32+d._33*d._33);0>d._11*(d._22*d._33-d._23*d._32)+d._12*(d._23*d._31-d._21*d._33)+d._13*(d._21*d._32-d._22*d._31)&&(a*=-1,m*=-1,f*=-1);e=b.xMax-b.xMin;d=b.yMax-b.yMin;g=b.zMax-b.zMin;b=d<g?g:d;d=a;a=m;g=f;f=a<g?g:a;b=(e<b?b:e)*(d<f?f:d)/2;null==c.directions&&(c.directions=new ma,c.directions._44=0);0==c.directions._44&&c.calcDirections();e=c.directions._21;f=c.directions._22;d=c.directions._23;null==c.directions&&(c.directions=new ma,c.directions._44=0);0==c.directions._44&&c.calcDirections();
g=c.directions._31;m=c.directions._32;a=c.directions._33;e=g-e;f=m-f;g=a-d;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);e=m;f=a;a=e*e+f*f+d*d;a=1E-20>a?0:1/Math.sqrt(a);e*=a;f*=a;g=d*a;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);var p=m,t=a,n=d;e=p*b;f=t*b;g=n*b;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);e=h+m;f=k+a;g=l+d;null==
g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);var r=m,q=a,u=d;e=p*b;f=t*b;g=n*b;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);e=h-m;f=k-a;g=l-d;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);m=e;a=f;d=g;null==d&&(d=0);null==a&&(a=0);null==m&&(m=0);h=!1;null==h&&(h=!0);e=r;f=q;g=u;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);l=e;k=f;b=c.m;e=l*b._11+k*b._21+g*b._31+b._41;f=l*b._12+k*b._22+g*b._32+
b._42;b=1/(l*b._14+k*b._24+g*b._34+b._44);l=.5*(e*b+1);k=.5*(-(f*b)+1);h&&(l=Math.round(l),k=Math.round(k));h=!1;null==h&&(h=!0);e=m;f=a;g=d;null==g&&(g=0);null==f&&(f=0);null==e&&(e=0);d=e;a=f;m=g;b=c.m;e=d*b._11+a*b._21+m*b._31+b._41;f=d*b._12+a*b._22+m*b._32+b._42;b=1/(d*b._14+a*b._24+m*b._34+b._44);d=.5*(e*b+1);a=.5*(-(f*b)+1);h&&(d=Math.round(d),a=Math.round(a));e=d-l;g=a-k;c=e<g?g:e;return c*c};Ua.__super__=Aa;Ua.prototype=J(Aa.prototype,{getMeshMaterials:function(){return[this.material]},addBoundsRec:function(a,
b){Aa.prototype.addBoundsRec.call(this,a,b);if(null!=this.primitive&&0==(this.flags&512)){var c=this.primitive.getBounds();if(null==b)var d=this.absPos;else Ua.tmpMat.multiply(this.absPos,b),d=Ua.tmpMat;b=new fb;b.xMin=c.xMin;b.xMax=c.xMax;b.yMin=c.yMin;b.yMax=c.yMax;b.zMin=c.zMin;b.zMax=c.zMax;b.transform(d);b.xMin<a.xMin&&(a.xMin=b.xMin);b.xMax>a.xMax&&(a.xMax=b.xMax);b.yMin<a.yMin&&(a.yMin=b.yMin);b.yMax>a.yMax&&(a.yMax=b.yMax);b.zMin<a.zMin&&(a.zMin=b.zMin);b.zMax>a.zMax&&(a.zMax=b.zMax)}},clone:function(a){a=
null==a?new Ua(null,this.material):a;a.set_primitive(this.primitive);a.material=this.material.clone();Aa.prototype.clone.call(this,a);return a},getLocalCollider:function(){return this.primitive.getCollider()},draw:function(a){this.primitive.selectMaterial(0,this.primitive.screenRatioToLod(this.curScreenRatio));this.primitive.render(a.engine)},calcScreenRatio:function(a){if(null!=this.primitive&&1!=this.primitive.lodCount())if(0<=a.forcedScreenRatio)this.curScreenRatio=a.forcedScreenRatio;else{var b=
this.primitive.getBounds();null==b?this.curScreenRatio=1:(this.curScreenRatio=Ua.screenRatio(this.getAbsPos(),b,a.camera),this.inheritLod&&(a.forcedScreenRatio=this.curScreenRatio))}},emit:function(a){this.calcScreenRatio(a);if(!(this.primitive.screenRatioToLod(this.curScreenRatio)>=this.primitive.lodCount()))for(var b=this.material.passes;null!=b;)b.culled||(a.emitPass(b,this).index=0),b=b.nextPass},getMaterialByName:function(a){return null!=this.material&&this.material.name==a?this.material:Aa.prototype.getMaterialByName.call(this,
a)},getMaterials:function(a,b){null==b&&(b=!0);null==a&&(a=[]);null!=this.material&&0>a.indexOf(this.material)&&a.push(this.material);return Aa.prototype.getMaterials.call(this,a,b)},onAdd:function(){Aa.prototype.onAdd.call(this);null!=this.primitive&&this.primitive.incref()},onRemove:function(){null!=this.primitive&&this.primitive.decref();Aa.prototype.onRemove.call(this)},set_primitive:function(a){a!=this.primitive&&0!=(this.flags&32)&&(null!=this.primitive&&this.primitive.decref(),null!=a&&a.incref());
return this.primitive=a},__class__:Ua});var Ed=function(a){this.curX=this.curY=this.curZ=this.curR=this.lineSize=0;this.bprim=new ec(N.get_POS3D_NORMAL_UV_RGBA());this.bprim.isStatic=!1;Ua.call(this,this.bprim,null,a);this.tmpPoints=[];this.lineShader=new Ue;this.lineShader.setPriority(-100);a=this.material;a.set_castShadows(!1);a.set_receiveShadows(!1);this.material.passes.set_enableLights(!1);this.material.passes.addShader(this.lineShader);a=new qe;a.setPriority(-100);this.material.passes.addShader(a);
this.material.passes.set_culling(Ib.None)};z["h3d.scene.Graphics"]=Ed;Ed.__name__="h3d.scene.Graphics";Ed.__super__=Ua;Ed.prototype=J(Ua.prototype,{onRemove:function(){Ua.prototype.onRemove.call(this);this.bprim.clear()},set_is3D:function(a){if(this.is3D==a)return a;a?(this.material.set_texture(Y.fromColor(-1)),this.material.passes.removeShader(this.lineShader)):(this.material.set_texture(null),this.material.passes.addShader(this.lineShader));this.bprim.clear();this.tmpPoints=[];return this.is3D=
a},flushLine:function(){var a=this.tmpPoints,b=a.length-1,c=a[b],d=a[0],e=d.x==c.x&&d.y==c.y&&d.z==c.z,f=a.length;if(e)d!=c&&(--f,--b,c=a[b]);else{var g=a[b-1];null==g&&(g=d);a.push(new Bf(2*c.x-g.x,2*c.y-g.y,2*c.z-g.z,0,0,0,0));g=a[1];null==g&&(g=d);c=new Bf(2*d.x-g.x,2*d.y-g.y,2*d.z-g.z,0,0,0,0)}for(var h=g=this.bprim.vertexCount(),k=0,l=0,m=f;l<m;){var p=l++,t=a[(p+1)%a.length],n=c.y-d.y,r=d.x-c.x,q=1/Math.sqrt(n*n+r*r);c=d.y-t.y;var u=t.x-d.x,v=1/Math.sqrt(c*c+u*u);c=n*q+c*v;u=r*q+u*v;v=1/Math.sqrt(c*
c+u*u);c*=v;u*=v;n=.5*this.lineSize/(c*n*q+u*r*q);c*=n;u*=n;n=p<f-1||e;this.bprim.begin(2,n?6:0);r=this.bprim;r.tmpBuf.array[r.bufPos++]=d.x+c;r=this.bprim;r.tmpBuf.array[r.bufPos++]=d.y+u;r=this.bprim;r.tmpBuf.array[r.bufPos++]=d.z;r=this.bprim;r.tmpBuf.array[r.bufPos++]=0;r=this.bprim;r.tmpBuf.array[r.bufPos++]=0;r=this.bprim;r.tmpBuf.array[r.bufPos++]=1;r=this.bprim;r.tmpBuf.array[r.bufPos++]=0;r=this.bprim;r.tmpBuf.array[r.bufPos++]=k;r=this.bprim;r.tmpBuf.array[r.bufPos++]=d.r;r=this.bprim;r.tmpBuf.array[r.bufPos++]=
d.g;r=this.bprim;r.tmpBuf.array[r.bufPos++]=d.b;r=this.bprim;r.tmpBuf.array[r.bufPos++]=d.a;r=this.bprim;r.tmpBuf.array[r.bufPos++]=d.x-c;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.y-u;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.z;c=this.bprim;c.tmpBuf.array[c.bufPos++]=0;c=this.bprim;c.tmpBuf.array[c.bufPos++]=0;c=this.bprim;c.tmpBuf.array[c.bufPos++]=1;c=this.bprim;c.tmpBuf.array[c.bufPos++]=1;c=this.bprim;c.tmpBuf.array[c.bufPos++]=k;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.r;c=this.bprim;c.tmpBuf.array[c.bufPos++]=
d.g;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.b;c=this.bprim;c.tmpBuf.array[c.bufPos++]=d.a;k=1-k;n&&(p=p==b?g-h:2,n=this.bprim,n.tmpIdx[n.idxPos++]=n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=1+n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=p+n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=p+n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=1+n.startIndex,n=this.bprim,n.tmpIdx[n.idxPos++]=p+1+n.startIndex);h+=2;c=d;d=t}},flush:function(){0!=this.tmpPoints.length&&this.is3D&&(this.flushLine(),this.tmpPoints=
[])},sync:function(a){Ua.prototype.sync.call(this,a);this.flush();this.bprim.flush()},draw:function(a){this.flush();this.bprim.flush();Ua.prototype.draw.call(this,a)},clear:function(){this.flush();this.bprim.clear()},lineStyle:function(a,b,c){null==c&&(c=1);null==b&&(b=0);null==a&&(a=0);this.flush();0<a&&this.lineSize!=a&&(this.lineSize=a,this.is3D||(this.lineShader.width__=this.lineSize));this.setColor(b,c)},setColorF:function(a,b,c,d){null==d&&(d=1);this.curA=d;this.curR=a;this.curG=b;this.curB=
c},setColor:function(a,b){null==b&&(b=1);this.curA=b;this.curR=(a>>16&255)/255;this.curG=(a>>8&255)/255;this.curB=(a&255)/255},drawLine:function(a,b){this.moveTo(a.x,a.y,a.z);this.lineTo(b.x,b.y,b.z)},moveTo:function(a,b,c){this.is3D?(this.flush(),this.lineTo(a,b,c)):(this.curX=a,this.curY=b,this.curZ=c)},addVertex:function(a,b,c,d,e,f,g){this.tmpPoints.push(new Bf(a,b,c,d,e,f,g))},lineTo:function(a,b,c){if(this.is3D){var d=this.curX;var e=this.curY;var f=this.curZ;var g=this.bprim.bounds;d<g.xMin&&
(g.xMin=d);d>g.xMax&&(g.xMax=d);e<g.yMin&&(g.yMin=e);e>g.yMax&&(g.yMax=e);f<g.zMin&&(g.zMin=f);f>g.zMax&&(g.zMax=f);g=this.bprim.bounds;a<g.xMin&&(g.xMin=a);a>g.xMax&&(g.xMax=a);b<g.yMin&&(g.yMin=b);b>g.yMax&&(g.yMax=b);c<g.zMin&&(g.zMin=c);c>g.zMax&&(g.zMax=c);this.tmpPoints.push(new Bf(a,b,c,this.curR,this.curG,this.curB,this.curA))}else{this.bprim.begin(4,6);var h=a-this.curX,k=b-this.curY,l=c-this.curZ;d=this.curX;e=this.curY;f=this.curZ;g=this.bprim.bounds;d<g.xMin&&(g.xMin=d);d>g.xMax&&(g.xMax=
d);e<g.yMin&&(g.yMin=e);e>g.yMax&&(g.yMax=e);f<g.zMin&&(g.zMin=f);f>g.zMax&&(g.zMax=f);g=this.bprim.bounds;a<g.xMin&&(g.xMin=a);a>g.xMax&&(g.xMax=a);b<g.yMin&&(g.yMin=b);b>g.yMax&&(g.yMax=b);c<g.zMin&&(g.zMin=c);c>g.zMax&&(g.zMax=c);g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curX;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curY;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curZ;g=this.bprim;g.tmpBuf.array[g.bufPos++]=h;g=this.bprim;g.tmpBuf.array[g.bufPos++]=k;g=this.bprim;g.tmpBuf.array[g.bufPos++]=
l;g=this.bprim;g.tmpBuf.array[g.bufPos++]=0;g=this.bprim;g.tmpBuf.array[g.bufPos++]=0;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curR;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curG;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curB;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curA;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curX;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curY;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curZ;g=this.bprim;g.tmpBuf.array[g.bufPos++]=h;g=this.bprim;g.tmpBuf.array[g.bufPos++]=
k;g=this.bprim;g.tmpBuf.array[g.bufPos++]=l;g=this.bprim;g.tmpBuf.array[g.bufPos++]=0;g=this.bprim;g.tmpBuf.array[g.bufPos++]=1;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curR;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curG;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curB;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curA;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curX;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curY;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curZ;g=this.bprim;g.tmpBuf.array[g.bufPos++]=
h;g=this.bprim;g.tmpBuf.array[g.bufPos++]=k;g=this.bprim;g.tmpBuf.array[g.bufPos++]=l;g=this.bprim;g.tmpBuf.array[g.bufPos++]=1;g=this.bprim;g.tmpBuf.array[g.bufPos++]=0;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curR;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curG;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curB;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curA;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curX;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curY;g=this.bprim;g.tmpBuf.array[g.bufPos++]=
this.curZ;g=this.bprim;g.tmpBuf.array[g.bufPos++]=h;g=this.bprim;g.tmpBuf.array[g.bufPos++]=k;g=this.bprim;g.tmpBuf.array[g.bufPos++]=l;g=this.bprim;g.tmpBuf.array[g.bufPos++]=1;g=this.bprim;g.tmpBuf.array[g.bufPos++]=1;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curR;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curG;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curB;g=this.bprim;g.tmpBuf.array[g.bufPos++]=this.curA;g=this.bprim;g.tmpIdx[g.idxPos++]=g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=
1+g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=2+g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=2+g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=3+g.startIndex;g=this.bprim;g.tmpIdx[g.idxPos++]=1+g.startIndex;this.curX=a;this.curY=b;this.curZ=c}},__class__:Ed});var xf=function(a,b,c,d){null==c&&(c=!0);null==a&&(a=-65536);this.prevXMax=this.prevYMax=this.prevZMax=-1E9;this.prevXMin=this.prevYMin=this.prevZMin=1E9;this.thickness=1;Ed.call(this,d);this.color=a;this.bounds=b;c||this.material.passes.depth(!0,
nb.Always)};z["h3d.scene.Box"]=xf;xf.__name__="h3d.scene.Box";xf.__super__=Ed;xf.prototype=J(Ed.prototype,{clone:function(a){if(null==a){var b=this.color;a=this.bounds;var c=new fb;c.xMin=a.xMin;c.xMax=a.xMax;c.yMin=a.yMin;c.yMax=a.yMax;c.zMin=a.zMin;c.zMax=a.zMax;c=new xf(b,c,this.material.passes.depthWrite,null)}else c=a;Ed.prototype.clone.call(this,c);a=this.bounds;b=new fb;b.xMin=a.xMin;b.xMax=a.xMax;b.yMin=a.yMin;b.yMax=a.yMax;b.zMin=a.zMin;b.zMax=a.zMax;c.bounds=b;c.prevXMin=this.prevXMin;c.prevYMin=
this.prevYMin;c.prevZMin=this.prevZMin;c.prevXMax=this.prevXMax;c.prevYMax=this.prevYMax;c.prevZMax=this.prevZMax;return c},getLocalCollider:function(){return null},sync:function(a){if(null==this.bounds){if(-.5==this.prevXMin&&-.5==this.prevYMin&&-.5==this.prevZMin&&.5==this.prevXMax&&.5==this.prevYMax&&.5==this.prevZMax)return;this.prevZMin=this.prevYMin=this.prevXMin=-.5;this.prevZMax=this.prevYMax=this.prevXMax=.5}else{if(this.prevXMin==this.bounds.xMin&&this.prevYMin==this.bounds.yMin&&this.prevZMin==
this.bounds.zMin&&this.prevXMax==this.bounds.xMax&&this.prevYMax==this.bounds.yMax&&this.prevZMax==this.bounds.zMax)return;this.prevXMin=this.bounds.xMin;this.prevYMin=this.bounds.yMin;this.prevZMin=this.bounds.zMin;this.prevXMax=this.bounds.xMax;this.prevYMax=this.bounds.yMax;this.prevZMax=this.bounds.zMax}this.clear();this.lineStyle(this.thickness,this.color);this.moveTo(this.prevXMin,this.prevYMin,this.prevZMin);this.lineTo(this.prevXMax,this.prevYMin,this.prevZMin);this.lineTo(this.prevXMax,this.prevYMax,
this.prevZMin);this.lineTo(this.prevXMin,this.prevYMax,this.prevZMin);this.lineTo(this.prevXMin,this.prevYMin,this.prevZMin);this.lineTo(this.prevXMin,this.prevYMin,this.prevZMax);this.lineTo(this.prevXMax,this.prevYMin,this.prevZMax);this.lineTo(this.prevXMax,this.prevYMax,this.prevZMax);this.lineTo(this.prevXMin,this.prevYMax,this.prevZMax);this.lineTo(this.prevXMin,this.prevYMin,this.prevZMax);this.moveTo(this.prevXMax,this.prevYMin,this.prevZMin);this.lineTo(this.prevXMax,this.prevYMin,this.prevZMax);
this.moveTo(this.prevXMin,this.prevYMax,this.prevZMin);this.lineTo(this.prevXMin,this.prevYMax,this.prevZMax);this.moveTo(this.prevXMax,this.prevYMax,this.prevZMin);this.lineTo(this.prevXMax,this.prevYMax,this.prevZMax);Ed.prototype.sync.call(this,a)},__class__:xf});var Bf=function(a,b,c,d,e,f,g){this.x=a;this.y=b;this.z=c;this.r=d;this.g=e;this.b=f;this.a=g};z["h3d.scene._Graphics.GPoint"]=Bf;Bf.__name__="h3d.scene._Graphics.GPoint";Bf.prototype={__class__:Bf};var Cf=function(a,b){this.hitPoint=
new T(0,0,0,1);this.mouseDownButton=this.lastClickFrame=-1;this.cancelEvents=this.propagateEvents=this.enableRightButton=this.allowMultiClick=this.isAbsoluteShape=this.emittedLastFrame=!1;Aa.call(this,b);this.shape=a;this.set_cursor(zc.Button)};z["h3d.scene.Interactive"]=Cf;Cf.__name__="h3d.scene.Interactive";Cf.__interfaces__=[$f];Cf.setupDebugMaterial=function(a){a=a.getMaterials();for(var b=0;b<a.length;){var c=a[b];++b;na.CURRENT.driver.hasFeature(Ta.Wireframe)&&c.passes.set_wireframe(!0);c.set_castShadows(!1);
c.set_receiveShadows(!1);c.mshader.color__.w=.7;c.set_blendMode(xa.Alpha)}};Cf.__super__=Aa;Cf.prototype=J(Aa.prototype,{getPoint:function(a,b){var c=a.px,d=a.py,e=a.pz,f=a.lx,g=a.ly,h=a.lz,k=this.getInvPos(),l=a.px,m=a.py,p=a.pz;null==p&&(p=0);null==m&&(m=0);null==l&&(l=0);var t=l;l=m;m=p;null==m&&(m=0);null==l&&(l=0);null==t&&(t=0);p=t;t=l;var n=m;m=p*k._11+t*k._21+n*k._31+k._41;l=p*k._12+t*k._22+n*k._32+k._42;p=p*k._13+t*k._23+n*k._33+k._43;a.px=m;a.py=l;a.pz=p;l=a.lx;m=a.ly;p=a.lz;null==p&&(p=
0);null==m&&(m=0);null==l&&(l=0);t=l;l=m;m=p;null==m&&(m=0);null==l&&(l=0);null==t&&(t=0);p=t;t=l;n=m;m=p*k._11+t*k._21+n*k._31;l=p*k._12+t*k._22+n*k._32;p=p*k._13+t*k._23+n*k._33;a.lx=m;a.ly=l;a.lz=p;a.normalize();k=this.shape.rayIntersection(a,b);if(0>k)return a.px=c,a.py=d,a.pz=e,a.lx=f,a.ly=g,a.lz=h,null;l=a.px+k*a.lx;m=a.py+k*a.ly;p=a.pz+k*a.lz;null==p&&(p=0);null==m&&(m=0);null==l&&(l=0);b=new I(l,m,p);k=this.getAbsPos();m=b.x*k._11+b.y*k._21+b.z*k._31+k._41;l=b.x*k._12+b.y*k._22+b.z*k._32+
k._42;p=b.x*k._13+b.y*k._23+b.z*k._33+k._43;b.x=m;b.y=l;b.z=p;a.px=c;a.py=d;a.pz=e;a.lx=f;a.ly=g;a.lz=h;return b},get_showDebug:function(){return null!=this.debugObj},set_showDebug:function(a){if(!a){if(null!=this.debugObj){var b=this.debugObj;null!=b&&null!=b.parent&&b.parent.removeChild(b)}this.debugObj=null;return!1}if(null!=this.debugObj)return!0;this.debugObj=this.shape.makeDebugObj();if(null!=this.debugObj){Cf.setupDebugMaterial(this.debugObj);b=this.debugObj;var c=this.isAbsoluteShape;c!=(0!=
(b.flags&2048))&&(b.flags|=1,0!=(b.flags&131072)&&(b.flags|=262144));a=2048;b.flags=c?b.flags|a:b.flags&~a;this.addChild(this.debugObj)}return null!=this.debugObj},onAdd:function(){this.scene=this.getScene();null!=this.scene&&this.scene.addEventTarget(this);Aa.prototype.onAdd.call(this)},onRemove:function(){null!=this.scene&&(this.scene.removeEventTarget(this),this.scene=null);Aa.prototype.onRemove.call(this)},sync:function(a){Aa.prototype.sync.call(this,a);this.emittedLastFrame=!1},emit:function(a){Aa.prototype.emit.call(this,
a);this.emittedLastFrame=!0},preventClick:function(){this.mouseDownButton=-1},getInteractiveScene:function(){return this.scene},handleEvent:function(a){this.propagateEvents&&(a.propagate=!0);this.cancelEvents&&(a.cancel=!0);switch(a.kind._hx_index){case 0:if(this.enableRightButton||0==a.button)this.mouseDownButton=a.button,this.onPush(a),a.cancel&&(this.mouseDownButton=-1);break;case 1:if(this.enableRightButton||0==a.button){this.onRelease(a);var b=ba.frameCount;this.mouseDownButton!=a.button||this.lastClickFrame==
b&&!this.allowMultiClick||(this.onClick(a),this.lastClickFrame=b)}this.mouseDownButton=-1;break;case 2:this.onMove(a);break;case 3:this.onOver(a);break;case 4:this.onOut(a);break;case 5:this.onWheel(a);break;case 6:this.onFocus(a);break;case 7:this.onFocusLost(a);break;case 8:this.onKeyDown(a);break;case 9:this.onKeyUp(a);break;case 10:if(this.enableRightButton||0==a.button)if(this.onRelease(a),this.mouseDownButton==a.button)this.onReleaseOutside(a);this.mouseDownButton=-1;break;case 11:this.onTextInput(a);
break;case 12:this.onCheck(a)}},set_cursor:function(a){this.cursor=a;null!=this.scene&&null!=this.scene.events&&this.scene.events.updateCursor(this);return a},focus:function(){null!=this.scene&&null!=this.scene.events&&this.scene.events.focus(this)},blur:function(){this.hasFocus()&&this.scene.events.blur()},isOver:function(){return null!=this.scene&&null!=this.scene.events?-1!=this.scene.events.overList.indexOf(this):!1},hasFocus:function(){return null!=this.scene&&null!=this.scene.events?this.scene.events.currentFocus==
this:!1},onOver:function(a){},onOut:function(a){},onPush:function(a){},onRelease:function(a){},onReleaseOutside:function(a){},onClick:function(a){},onMove:function(a){},onWheel:function(a){},onFocus:function(a){},onFocusLost:function(a){},onKeyUp:function(a){},onKeyDown:function(a){},onCheck:function(a){},onTextInput:function(a){},__class__:Cf});var Df=function(a,b){Aa.call(this,b);this.shader=a};z["h3d.scene.Light"]=Df;Df.__name__="h3d.scene.Light";Df.__super__=Aa;Df.prototype=J(Aa.prototype,{get_color:function(){return new I(0,
0,0)},set_color:function(a){return a},emit:function(a){a.emitLight(this)},getShadowDirection:function(){return null},__class__:Df});var pg=function(){this.drawPasses=0};z["h3d.scene.LightSystem"]=pg;pg.__name__="h3d.scene.LightSystem";pg.prototype={initGlobals:function(a){},initLights:function(a){this.ctx=a;if(null==this.shadowLight||0==(this.shadowLight.flags&32))for(a=a.lights;null!=a;){if(null!=a.getShadowDirection()){this.shadowLight=a;break}a=a.next}},computeLight:function(a,b){return b},dispose:function(){},
__class__:pg};var Lc=function(a,b,c){Ua.call(this,a,null==b?null:b[0],c);this.materials=null==b?[this.material]:b};z["h3d.scene.MultiMaterial"]=Lc;Lc.__name__="h3d.scene.MultiMaterial";Lc.__super__=Ua;Lc.prototype=J(Ua.prototype,{getMeshMaterials:function(){return this.materials.slice()},clone:function(a){a=null==a?new Lc(null,this.materials):a;a.materials=[];for(var b=0,c=this.materials;b<c.length;){var d=c[b];++b;a.materials.push(null==d?null:d.clone())}Ua.prototype.clone.call(this,a);a.material=
a.materials[0];return a},emit:function(a){this.calcScreenRatio(a);if(!(this.primitive.screenRatioToLod(this.curScreenRatio)>=this.primitive.lodCount()))for(var b=0,c=this.materials.length;b<c;){var d=b++,e=this.materials[d];if(null!=e)for(null==d&&(d=0),e=e.passes;null!=e;)e.culled||(a.emitPass(e,this).index=d),e=e.nextPass}},getMaterialByName:function(a){for(var b=0,c=this.materials;b<c.length;){var d=c[b];++b;if(null!=d&&d.name==a)return d}return Ua.prototype.getMaterialByName.call(this,a)},getMaterials:function(a,
b){var c;null==b&&(b=!0);null==a&&(a=[]);var d=0;for(c=this.materials;d<c.length;){var e=c[d];++d;null!=e&&0>a.indexOf(e)&&a.push(e)}if(b)for(d=0,c=this.children;d<c.length;)b=c[d],++d,b.getMaterials(a);return a},draw:function(a){1<this.materials.length&&this.primitive.selectMaterial(a.drawPass.index,this.primitive.screenRatioToLod(this.curScreenRatio));this.primitive.render(a.engine)},__class__:Lc});var Aj=function(a,b){this.gid=a;this.value=b};z["h3d.scene._RenderContext.SharedGlobal"]=Aj;Aj.__name__=
"h3d.scene._RenderContext.SharedGlobal";Aj.prototype={__class__:Aj};var qg=function(a){this.cameraFrustumUploaded=!1;this.cameraFrustumBuffer=null;this.tmpComputeLink=new Fb(null,null);this.forcedScreenRatio=-1;jb.call(this);this.scene=a;this.cachedShaderList=[];this.cachedPassObjects=[];this.initGlobals()};z["h3d.scene.RenderContext"]=qg;qg.__name__="h3d.scene.RenderContext";qg.__super__=jb;qg.prototype=J(jb.prototype,{setCamera:function(a){this.camera=a;var b=a.mcam;this.globals.map.h[this.cameraView_id]=
b;b=a.zNear;this.globals.map.h[this.cameraNear_id]=b;b=a.zFar;this.globals.map.h[this.cameraFar_id]=b;b=a.mproj;this.globals.map.h[this.cameraProj_id]=b;b=a.pos;this.globals.map.h[this.cameraPos_id]=b;var c=a.mproj._11;var d=a.mproj._22;var e=a.mproj._33;b=a.mproj._44;null==b&&(b=1);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b=new T(c,d,e,b);this.globals.map.h[this.cameraProjDiag_id]=b;null==this.globals.map.h[this.cameraPreviousViewProj_id]&&(b=a.m.clone(),this.globals.map.h[this.cameraPreviousViewProj_id]=
b);null==this.globals.map.h[this.cameraJitterOffsets_id]&&(b=e=d=c=0,null==b&&(b=1),null==e&&(e=0),null==d&&(d=0),null==c&&(c=0),b=new T(c,d,e,b),this.globals.map.h[this.cameraJitterOffsets_id]=b);b=a.m;this.globals.map.h[this.cameraViewProj_id]=b;b=this.camera.getInverseViewProj();this.globals.map.h[this.cameraInverseViewProj_id]=b},setupTarget:function(){var a=this.engine.driver.hasFeature(Ta.BottomLeftCoords)&&null!=this.engine.getCurrentTarget()?-1:1;this.globals.map.h[this.cameraProjFlip_id]=
a},getCurrentPixelSize:function(){var a=this.engine.getCurrentTarget(),b=2/(null==a?this.engine.width:a.width);a=2/(null==a?this.engine.height:a.height);null==a&&(a=0);null==b&&(b=0);return new I(b,a,0)},emit:function(a,b,c){null==c&&(c=0);for(a=a.passes;null!=a;)a.culled||(this.emitPass(a,b).index=c),a=a.nextPass},start:function(){this.drawPass=null;this.passes=[];this.lights=null;this.cachedPos=0;this.visibleFlag=!0;this.forcedScreenRatio=-1;this.time+=this.elapsedTime;this.frame++;this.setCurrent();
this.engine=na.CURRENT;var a=this.time;this.globals.map.h[this.globalTime_id]=a;a=this.getCurrentPixelSize();this.globals.map.h[this.pixelSize_id]=a;this.setCamera(this.scene.camera)},nextPass:function(){this.cachedPos=0;this.drawPass=null},getGlobal:function(a){return this.globals.get(a)},setGlobal:function(a,b){this.globals.set(a,b)},emitPass:function(a,b){0==(a.rendererFlags&1)&&this.scene.renderer.setPassFlags(a);var c=this.allocPool;null==c?(c=new zi,c.nextAlloc=this.allocFirst,this.allocFirst=
c):this.allocPool=c.nextAlloc;c.pass=a;c.obj=b;this.passes.length<=a.passId&&(this.passes.length=a.passId);c.next=this.passes[a.passId];return this.passes[a.passId]=c},allocShaderList:function(a,b){var c=this.cachedShaderList[this.cachedPos++];null==c&&(c=new Fb(null),this.cachedShaderList[this.cachedPos-1]=c);c.s=a;c.next=b;return c},computeList:function(a){if(null!=this.computeLink)throw u.thrown("Use computeDispatch to dispatch computeList");this.computeLink=a},computeDispatch:function(a,b,c,d){null==
d&&(d=1);null==c&&(c=1);null==b&&(b=1);if(0>=b||0>=c||0>=d)throw u.thrown("Can't use zero or negative work groups count");var e=jb.get();e!=this&&this.start();this.globals.maxChannels=0;null!=a&&(this.tmpComputeLink.s=a,this.computeLink=this.tmpComputeLink);for(a=this.computeLink;null!=a;){var f=a.s;a=a.next;f.updateConstants(this.globals)}a=xd.get().link(this.computeLink,Kb.Compute);this.engine.driver.selectShader(a);f=this.shaderBuffers;f.vertex.grow(a.vertex);null!=a.fragment&&f.fragment.grow(a.fragment);
this.fillGlobals(f,a);this.engine.uploadShaderBuffers(f,0);this.fillParams(f,a,this.computeLink,!0);this.engine.uploadShaderBuffers(f,1);this.engine.uploadShaderBuffers(f,2);this.engine.uploadShaderBuffers(f,3);this.engine.driver.computeDispatch(b,c,d);this.engine.dispatches++;this.computeLink==this.tmpComputeLink&&(this.tmpComputeLink.s=null);this.computeLink=null;e!=this&&(this.done(),null!=e&&e.setCurrent())},emitLight:function(a){a.next=this.lights;this.lights=a},getCameraFrustumBuffer:function(){null==
this.cameraFrustumBuffer&&(this.cameraFrustumBuffer=Ob.get().allocBuffer(6,N.get_VEC4_DATA(),2));if(!this.cameraFrustumUploaded){var a=new S(new ArrayBuffer(96)),b=this.camera.frustum,c=b.pleft;a.setFloat(0,c.nx);a.setFloat(4,c.ny);a.setFloat(8,c.nz);a.setFloat(12,c.d);c=b.pright;a.setFloat(16,c.nx);a.setFloat(20,c.ny);a.setFloat(24,c.nz);a.setFloat(28,c.d);c=b.ptop;a.setFloat(32,c.nx);a.setFloat(36,c.ny);a.setFloat(40,c.nz);a.setFloat(44,c.d);c=b.pbottom;a.setFloat(48,c.nx);a.setFloat(52,c.ny);a.setFloat(56,
c.nz);a.setFloat(60,c.d);c=b.pfar;a.setFloat(64,c.nx);a.setFloat(68,c.ny);a.setFloat(72,c.nz);a.setFloat(76,c.d);c=b.pnear;a.setFloat(80,c.nx);a.setFloat(84,c.ny);a.setFloat(88,c.nz);a.setFloat(92,c.d);this.cameraFrustumBuffer.uploadBytes(a,0,6);this.cameraFrustumUploaded=!0}return this.cameraFrustumBuffer},uploadParams:function(){this.fillParams(this.shaderBuffers,this.drawPass.shader,this.drawPass.shaders);this.engine.uploadShaderBuffers(this.shaderBuffers,1);this.engine.uploadShaderBuffers(this.shaderBuffers,
2);this.engine.uploadShaderBuffers(this.shaderBuffers,3)},done:function(){this.drawPass=null;for(var a=this.allocFirst;null!=a&&a!=this.allocPool;)a.obj=null,a.pass=null,a.shader=null,a.shaders=null,a.next=null,a.index=0,a.texture=0,a=a.nextAlloc;null!=this.allocPool&&(this.allocFirst=this.allocFirst.nextAlloc);this.allocPool=this.allocFirst;a=0;for(var b=this.cachedShaderList;a<b.length;){var c=b[a];++a;c.s=null;c.next=null}this.passes=[];this.lights=null;this.cameraFrustumUploaded=!1;this.globals.map.h[this.cameraPreviousViewProj_id].load(this.globals.map.h[this.cameraViewProj_id]);
this.computeVelocity=!1;this.clearCurrent()},dispose:function(){jb.prototype.dispose.call(this);null!=this.cameraFrustumBuffer&&Ob.get().disposeBuffer(this.cameraFrustumBuffer)},get_cameraView:function(){return this.globals.map.h[this.cameraView_id]},set_cameraView:function(a){return this.globals.map.h[this.cameraView_id]=a},get_cameraNear:function(){return this.globals.map.h[this.cameraNear_id]},set_cameraNear:function(a){return this.globals.map.h[this.cameraNear_id]=a},get_cameraFar:function(){return this.globals.map.h[this.cameraFar_id]},
set_cameraFar:function(a){return this.globals.map.h[this.cameraFar_id]=a},get_cameraProj:function(){return this.globals.map.h[this.cameraProj_id]},set_cameraProj:function(a){return this.globals.map.h[this.cameraProj_id]=a},get_cameraPos:function(){return this.globals.map.h[this.cameraPos_id]},set_cameraPos:function(a){return this.globals.map.h[this.cameraPos_id]=a},get_cameraProjDiag:function(){return this.globals.map.h[this.cameraProjDiag_id]},set_cameraProjDiag:function(a){return this.globals.map.h[this.cameraProjDiag_id]=
a},get_cameraProjFlip:function(){return this.globals.map.h[this.cameraProjFlip_id]},set_cameraProjFlip:function(a){return this.globals.map.h[this.cameraProjFlip_id]=a},get_cameraViewProj:function(){return this.globals.map.h[this.cameraViewProj_id]},set_cameraViewProj:function(a){return this.globals.map.h[this.cameraViewProj_id]=a},get_cameraInverseViewProj:function(){return this.globals.map.h[this.cameraInverseViewProj_id]},set_cameraInverseViewProj:function(a){return this.globals.map.h[this.cameraInverseViewProj_id]=
a},get_cameraPreviousViewProj:function(){return this.globals.map.h[this.cameraPreviousViewProj_id]},set_cameraPreviousViewProj:function(a){return this.globals.map.h[this.cameraPreviousViewProj_id]=a},get_cameraJitterOffsets:function(){return this.globals.map.h[this.cameraJitterOffsets_id]},set_cameraJitterOffsets:function(a){return this.globals.map.h[this.cameraJitterOffsets_id]=a},get_globalTime:function(){return this.globals.map.h[this.globalTime_id]},set_globalTime:function(a){return this.globals.map.h[this.globalTime_id]=
a},get_pixelSize:function(){return this.globals.map.h[this.pixelSize_id]},set_pixelSize:function(a){return this.globals.map.h[this.pixelSize_id]=a},get_globalModelView:function(){return this.globals.map.h[this.globalModelView_id]},set_globalModelView:function(a){return this.globals.map.h[this.globalModelView_id]=a},get_globalModelViewInverse:function(){return this.globals.map.h[this.globalModelViewInverse_id]},set_globalModelViewInverse:function(a){return this.globals.map.h[this.globalModelViewInverse_id]=
a},get_globalPreviousModelView:function(){return this.globals.map.h[this.globalPreviousModelView_id]},set_globalPreviousModelView:function(a){return this.globals.map.h[this.globalPreviousModelView_id]=a},initGlobals:function(){this.cameraView_id=za.allocID("camera.view");this.cameraNear_id=za.allocID("camera.zNear");this.cameraFar_id=za.allocID("camera.zFar");this.cameraProj_id=za.allocID("camera.proj");this.cameraPos_id=za.allocID("camera.position");this.cameraProjDiag_id=za.allocID("camera.projDiag");
this.cameraProjFlip_id=za.allocID("camera.projFlip");this.cameraViewProj_id=za.allocID("camera.viewProj");this.cameraInverseViewProj_id=za.allocID("camera.inverseViewProj");this.cameraPreviousViewProj_id=za.allocID("camera.previousViewProj");this.cameraJitterOffsets_id=za.allocID("camera.jitterOffsets");this.globalTime_id=za.allocID("global.time");this.pixelSize_id=za.allocID("global.pixelSize");this.globalModelView_id=za.allocID("global.modelView");this.globalModelViewInverse_id=za.allocID("global.modelViewInverse");
this.globalPreviousModelView_id=za.allocID("global.previousModelView")},__class__:qg});var Bi=function(){this.passes=new lh};z["h3d.scene.PassObjects"]=Bi;Bi.__name__="h3d.scene.PassObjects";Bi.prototype={__class__:Bi};var rg=L["h3d.scene.RenderMode"]={__ename__:!0,__constructs__:null,Default:{_hx_name:"Default",_hx_index:0,__enum__:"h3d.scene.RenderMode",toString:v},LightProbe:{_hx_name:"LightProbe",_hx_index:1,__enum__:"h3d.scene.RenderMode",toString:v}};rg.__constructs__=[rg.Default,rg.LightProbe];
rg.__empty_constructs__=[rg.Default,rg.LightProbe];var Mc=function(){this.shadows=!0;this.renderMode=rg.Default;this.effects=[];this.hasSetTarget=this.debugging=!1;this.emptyPasses=new lh;this.allPasses=[];this.passObjects=new La;this.set_props(this.getDefaultProps());var a=this;this.frontToBack=function(b){a.depthSort(!0,b)};var b=this;this.backToFront=function(a){b.depthSort(!1,a)}};z["h3d.scene.Renderer"]=Mc;Mc.__name__="h3d.scene.Renderer";Mc.__super__=yf;Mc.prototype=J(yf.prototype,{getEffect:function(a){for(var b=
0,c=this.effects;b<c.length;){var d=c[b];++b;d=Z.__downcastCheck(d,a)?d:null;if(null!=d)return d}return null},dispose:function(){for(var a=0,b=this.allPasses;a<b.length;){var c=b[a];++a;c.dispose()}a=0;for(b=this.effects;a<b.length;)c=b[a],++a,c.dispose();null!=this.ctx.lightSystem&&this.ctx.lightSystem.dispose();this.passObjects=new La},mark:function(a){},addShader:function(a){},getPass:function(a){for(var b=0,c=this.allPasses;b<c.length;){var d=c[b];++b;if(Z.__instanceof(d,a))return d}return null},
getPassByName:function(a){for(var b=0,c=this.allPasses;b<c.length;){var d=c[b];++b;if(d.name==a)return d}return null},hasFeature:function(a){return na.CURRENT.driver.hasFeature(a)},getLightSystem:function(){return this.ctx.scene.lightSystem},depthSort:function(a,b){var c,d;var e=this.ctx.camera.m;for(d=b.current;null!=d;){var f=d;d=d.next;var g=f.obj.absPos._41*e._13+f.obj.absPos._42*e._23+f.obj.absPos._43*e._33+e._43;var h=f.obj.absPos._41*e._14+f.obj.absPos._42*e._24+f.obj.absPos._43*e._34+e._44;
f.depth=0<h?g/h:-g/h}if(a){var k=b.current;if(null==k)f=null;else{for(h=1;;){f=k;a=k=null;for(g=0;null!=f;){++g;e=f;var l=d=0;for(c=h;l<c&&(l++,++d,e=e.next,null!=e););for(l=h;0<d||0<l&&null!=e;)0==d?(c=e,e=e.next,--l):0==l||null==e||0>=(f.pass.layer!=e.pass.layer?f.pass.layer-e.pass.layer:f.depth==e.depth?0:f.depth>e.depth?1:-1)?(c=f,f=f.next,--d):(c=e,e=e.next,--l),null!=a?a.next=c:k=c,a=c;f=e}a.next=null;if(1>=g)break;h*=2}f=k}}else if(k=b.current,null==k)f=null;else{for(h=1;;){f=k;a=k=null;for(g=
0;null!=f;){++g;e=f;l=d=0;for(c=h;l<c&&(l++,++d,e=e.next,null!=e););for(l=h;0<d||0<l&&null!=e;)0==d?(c=e,e=e.next,--l):0==l||null==e||0>=(f.pass.layer!=e.pass.layer?f.pass.layer-e.pass.layer:f.depth==e.depth?0:f.depth<e.depth?1:-1)?(c=f,f=f.next,--d):(c=e,e=e.next,--l),null!=a?a.next=c:k=c,a=c;f=e}a.next=null;if(1>=g)break;h*=2}f=k}b.current=f},clear:function(a,b,c){this.ctx.engine.clear(a,b,c)},allocTarget:function(a,b,c,d){null==c&&(c=1);null==b&&(b=!0);return this.ctx.textures.allocTarget(a,Math.round(this.ctx.engine.width*
c),Math.round(this.ctx.engine.height*c),b,d)},copy:function(a,b,c){sc.run(a,b,c)},setTarget:function(a,b){null==b&&(b=rc.ReadWrite);this.hasSetTarget&&this.ctx.engine.popTarget();this.ctx.engine.pushTarget(a,null,null,b);this.hasSetTarget=!0},setTargets:function(a,b){null==b&&(b=rc.ReadWrite);this.hasSetTarget&&this.ctx.engine.popTarget();this.ctx.engine.pushTargets(a,b);this.hasSetTarget=!0},setDepth:function(a){this.hasSetTarget&&this.ctx.engine.popTarget();this.ctx.engine.pushDepth(a);this.hasSetTarget=
!0},resetTarget:function(){this.hasSetTarget&&(this.ctx.engine.popTarget(),this.hasSetTarget=!1)},has:function(a){return null!=this.passObjects.h[a]},setPassFlags:function(a){a.rendererFlags|=1},get:function(a){a=this.passObjects.h[a];if(null==a)return this.emptyPasses;a.rendered=!0;return a.passes},draw:function(a){this.defaultPass.draw(this.get(a))},render:function(){throw u.thrown("Not implemented");},computeStatic:function(){throw u.thrown("Not implemented");},start:function(){},startEffects:function(){for(var a=
0,b=this.effects;a<b.length;){var c=b[a];++a;c.enabled&&c.start(this)}},process:function(a){this.hasSetTarget=!1;for(var b=0,c=this.allPasses;b<c.length;){var d=c[b];++b;d.setContext(this.ctx)}for(b=0;b<a.length;)d=a[b],++b,this.passObjects.h[d.name]=d;this.ctx.textures.begin();this.ctx.computingStatic?this.computeStatic():this.render();this.resetTarget();for(b=0;b<a.length;)d=a[b],++b,this.passObjects.h[d.name]=null},computeDispatch:function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=1);
this.ctx.computeDispatch(a,b,c,d)},__class__:Mc});var ld=function(a,b){null==b&&(b=!0);null==a&&(a=!0);this.prevEngine=null;this.interactiveOffset=0;this.ratioX=this.ratioY=1;this.offsetX=this.offsetY=0;Aa.call(this,null);this.window=Gb.getInstance();this.eventListeners=[];this.hitInteractives=[];this.interactives=[];this.camera=new gg;var c=na.CURRENT;null!=c&&(this.camera.screenRatio=c.width/c.height);this.ctx=new qg(this);a&&this.set_renderer(Od.current.createRenderer());b&&(this.lightSystem=Od.current.createLightSystem())};
z["h3d.scene.Scene"]=ld;ld.__name__="h3d.scene.Scene";ld.__interfaces__=[dg,ye];ld.__super__=Aa;ld.prototype=J(Aa.prototype,{setEvents:function(a){this.events=a},addEventListener:function(a){this.eventListeners.push(a)},removeEventListener:function(a){for(var b=0,c=this.eventListeners;b<c.length;){var d=c[b];++b;if(d==a)return D.remove(this.eventListeners,d),!0}return!1},dispatchListeners:function(a){for(var b=0,c=this.eventListeners;b<c.length;){var d=c[b];++b;d(a);if(!a.propagate)break}},set_renderer:function(a){this.renderer=
a;null!=a&&(a.ctx=this.ctx);return a},sortHitPointByCameraDistance:function(a,b){return a.hitPoint.w>b.hitPoint.w?-1:1},dispatchEvent:function(a,b){b.handleEvent(a)},isInteractiveVisible:function(a){for(;a!=this;){if(null==a||0==(a.flags&2))return!1;a=a.parent}return!0},handleEvent:function(a,b){var c;if(0==this.interactives.length)return null;if(0==this.hitInteractives.length){var d=a.relX-this.offsetX;var e=a.relY-this.offsetY;var f=this.ratioX*this.window.get_width();b=this.ratioY*this.window.get_height();
var g=2*(d/f-.5);b=2*-(e/b-.5);f=this.camera.unproject(g,b,0);b=this.camera.unproject(g,b,1);d=f.x;e=f.y;var h=f.z;null==h&&(h=0);null==e&&(e=0);null==d&&(d=0);var k=d;d=e;e=h;null==e&&(e=0);null==d&&(d=0);null==k&&(k=0);f=k;g=d;var l=e;d=b.x;e=b.y;h=b.z;null==h&&(h=0);null==e&&(e=0);null==d&&(d=0);k=d;d=e;e=h;null==e&&(e=0);null==d&&(d=0);null==k&&(k=0);var m=k,p=d,t=e;b=new Pb;b.px=f;b.py=g;b.pz=l;b.lx=m-f;b.ly=p-g;b.lz=t-l;b.normalize();0!=this.interactiveOffset&&(b.px+=b.lx*this.interactiveOffset,
b.py+=b.ly*this.interactiveOffset,b.pz+=b.lz*this.interactiveOffset);m=b.px;p=b.py;t=b.pz;var n=b.lx,r=b.ly,q=b.lz,u=-2147483648;l=0;for(g=this.interactives;l<g.length;)if(f=g[l],++l,!(f.priority<u)){for(c=f;null!=c&&0!=(c.flags&2);)c=c.parent;if(null==c){if(!f.isAbsoluteShape){c=f.getInvPos();d=b.px;e=b.py;h=b.pz;null==h&&(h=0);null==e&&(e=0);null==d&&(d=0);k=d;d=e;e=h;null==e&&(e=0);null==d&&(d=0);null==k&&(k=0);var v=e;h=k*c._11+d*c._21+v*c._31+c._41;e=k*c._12+d*c._22+v*c._32+c._42;v=k*c._13+d*
c._23+v*c._33+c._43;k=h;d=e;b.px=k;b.py=d;b.pz=v;e=b.lx;d=b.ly;k=b.lz;null==k&&(k=0);null==d&&(d=0);null==e&&(e=0);null==k&&(k=0);null==d&&(d=0);null==e&&(e=0);v=k;h=e*c._11+d*c._21+v*c._31;k=e*c._12+d*c._22+v*c._32;c=e*c._13+d*c._23+v*c._33;e=h;d=k;v=c;b.lx=e;b.ly=d;b.lz=v;b.normalize()}if(b.lx!=b.lx)b.px=m,b.py=p,b.pz=t,b.lx=n,b.ly=r,b.lz=q;else if(e=f.shape.rayIntersection(b,f.bestMatch),0>e)b.px=m,b.py=p,b.pz=t,b.lx=n,b.ly=r,b.lz=q;else{c=b.px+e*b.lx;d=b.py+e*b.ly;e=b.pz+e*b.lz;null==e&&(e=0);
null==d&&(d=0);null==c&&(c=0);null==e&&(e=0);null==d&&(d=0);null==c&&(c=0);b.px=m;b.py=p;b.pz=t;b.lx=n;b.ly=r;b.lz=q;f.hitPoint.x=c;f.hitPoint.y=d;f.hitPoint.z=e;if(f.priority>u){for(;0<this.hitInteractives.length;)this.hitInteractives.pop();u=f.priority}this.hitInteractives.push(f)}}}if(0==this.hitInteractives.length)return null;if(1<this.hitInteractives.length){l=0;for(g=this.hitInteractives;l<g.length;)f=g[l],++l,c=f.invPos,u=0,null==f.preciseShape&&f.bestMatch||(f.isAbsoluteShape||(d=b.px,e=b.py,
h=b.pz,null==h&&(h=0),null==e&&(e=0),null==d&&(d=0),k=d,d=e,e=h,null==e&&(e=0),null==d&&(d=0),null==k&&(k=0),v=e,h=k*c._11+d*c._21+v*c._31+c._41,e=k*c._12+d*c._22+v*c._32+c._42,v=k*c._13+d*c._23+v*c._33+c._43,k=h,d=e,b.px=k,b.py=d,b.pz=v,e=b.lx,d=b.ly,k=b.lz,null==k&&(k=0),null==d&&(d=0),null==e&&(e=0),null==k&&(k=0),null==d&&(d=0),null==e&&(e=0),v=k,h=e*c._11+d*c._21+v*c._31,k=e*c._12+d*c._22+v*c._32,c=e*c._13+d*c._23+v*c._33,e=h,d=k,v=c,b.lx=e,b.ly=d,b.lz=v,b.normalize()),c=f.preciseShape,e=(null!=
c?c:f.shape).rayIntersection(b,!0),0<e?(c=b.px+e*b.lx,d=b.py+e*b.ly,e=b.pz+e*b.lz,null==e&&(e=0),null==d&&(d=0),null==c&&(c=0),null==e&&(e=0),null==d&&(d=0),null==c&&(c=0),f.hitPoint.x=c,f.hitPoint.y=d,f.hitPoint.z=e):u=1,b.px=m,b.py=p,b.pz=t,b.lx=n,b.ly=r,b.lz=q),e=f.hitPoint,d=e.x,c=e.y,e=e.z,null==e&&(e=0),null==c&&(c=0),null==d&&(d=0),k=c,h=e,null==h&&(h=0),null==k&&(k=0),null==d&&(d=0),c=d,e=k,d=h,f.isAbsoluteShape||(k=f.absPos,h=c*k._12+e*k._22+d*k._32+1*k._42,v=c*k._13+e*k._23+d*k._33+1*k._43,
c=c*k._11+e*k._21+d*k._31+1*k._41,e=h,d=v),k=this.camera.m,d=1/(c*k._14+e*k._24+d*k._34+1*k._44)*(c*k._13+e*k._23+d*k._33+1*k._43),f.hitPoint.w=d+u;this.hitInteractives.sort(M(this,this.sortHitPointByCameraDistance))}this.hitInteractives.unshift(null)}for(;0<this.hitInteractives.length;){f=this.hitInteractives.pop();if(null==f)break;a.relX=f.hitPoint.x;a.relY=f.hitPoint.y;a.relZ=f.hitPoint.z;f.handleEvent(a);if(a.cancel)a.cancel=!1,a.propagate=!1;else{if(!a.propagate)for(;0<this.hitInteractives.length;)this.hitInteractives.pop();
return f}}return null},clone:function(a){a=null==a?new ld:a;a.camera=this.camera.clone();Aa.prototype.clone.call(this,a);return a},dispose:function(){if(0!=(this.flags&32))this.onRemove();this.ctx.dispose();null!=this.renderer&&(this.renderer.dispose(),this.set_renderer(new Mc))},addEventTarget:function(a){if(0<=this.interactives.indexOf(a))throw u.thrown("assert");this.interactives.push(a)},removeEventTarget:function(a){if(D.remove(this.interactives,a)){if(null!=this.events)this.events.onRemove(a);
D.remove(this.hitInteractives,a)}},setElapsedTime:function(a){this.ctx.elapsedTime=a},syncOnly:function(a){var b=na.CURRENT;this.setElapsedTime(a);a=b.getCurrentTarget();this.camera.screenRatio=null==a?b.width/b.height:a.width/a.height;this.camera.update();this.ctx.start();this.syncRec(this.ctx);this.ctx.done()},computeStatic:function(){var a=this.ctx.elapsedTime;this.ctx.elapsedTime=0;this.ctx.computingStatic=!0;this.render(na.CURRENT);this.ctx.computingStatic=!1;this.ctx.elapsedTime=a},onContextLost:function(){this.ctx.wasContextLost=
!0},render:function(a){if(0==(this.flags&32))this.onAdd();var b=a.getCurrentTarget();this.camera.screenRatio=null==b?a.width/a.height:b.width/b.height;this.camera.update();this.camera.rightHanded&&a.driver.setRenderFlag(eh.CameraHandness,1);this.ctx.start();this.renderer.start();this.renderer.startEffects();this.mark("sync");this.syncRec(this.ctx);this.mark("emit");this.emitRec(this.ctx);var c=[],d=-1;b=0;for(var e=this.ctx.passes.length;b<e;){var f=b++;var g=this.ctx.passes[f];if(null!=g){var h=
this.ctx.cachedPassObjects[++d];null==h&&(h=new Bi,this.ctx.cachedPassObjects[d]=h);h.name=g.pass.name;f=h.passes;f.current=g;f.discarded=f.lastDisc=null;c.push(h)}}null!=this.lightSystem&&(this.ctx.lightSystem=this.lightSystem,this.lightSystem.initLights(this.ctx));this.renderer.process(c);this.camera.rightHanded&&a.driver.setRenderFlag(eh.CameraHandness,0);this.ctx.done();this.ctx.wasContextLost=!1;b=0;for(e=d;b<e;)a=b++,a=this.ctx.cachedPassObjects[a],a.name=null,f=a.passes,f.current=null,f.discarded=
f.lastDisc=null},mark:function(a){this.renderer.mark(a)},setOutputTarget:function(a,b){if(null!=b){if(null!=this.prevDB)throw u.thrown("missing setOutputTarget()");a.pushTarget(b);a.width=b.width;a.height=b.height;this.prevDB=this.ctx.textures.defaultDepthBuffer;this.prevEngine=a;this.ctx.textures.defaultDepthBuffer=b.depthBuffer}else this.prevEngine.popTarget(),this.prevEngine.width=this.prevDB.width,this.prevEngine.height=this.prevDB.height,this.ctx.textures.defaultDepthBuffer=this.prevDB,this.prevEngine=
this.prevDB=null},__class__:ld});var sf=function(a,b){Aa.call(this,null);this.name=b.name;this.skin=a;this.lastFrame=-2;this.parent=a;this.index=b.index};z["h3d.scene.Joint"]=sf;sf.__name__="h3d.scene.Joint";sf.__super__=Aa;sf.prototype=J(Aa.prototype,{getObjectByName:function(a){var b=this.skin.getSkinData();a=b.namedJoints.h[a];if(null==a)return null;b=b.allJoints[this.index];if(b.index!=this.index)throw u.thrown("assert");for(var c=a.parent;null!=c;){if(c==b)return a=new sf(this.skin,a),a.parent=
this,a;c=c.parent}return null},syncPos:function(){for(var a=this.skin;null!=a;){if(0!=(a.flags&1)){this.update();break}a=a.parent}this.lastFrame!=this.skin.lastFrame&&(this.lastFrame=this.skin.lastFrame,this.absPos.load(this.skin.jointsData[this.index].currentAbsPose))},update:function(){this.skin.getAbsPos();this.skin.syncJoints();this.lastFrame=-1},__class__:sf});var Ie=function(){this.currentAbsPose=Ac.I()};z["h3d.scene.JointData"]=Ie;Ie.__name__="h3d.scene.JointData";Ie.prototype={sync:function(a,
b){if(null==b.follow){var c=this.currentAbsPose;var d=this.currentRelPose;var e=b.bindIndex;null==d?d=b.defMat:b.retargetAnim&&a.enableRetargeting&&(fc.TMP_MAT.load(d),d=fc.TMP_MAT,d._41=b.defMat._41,d._42=b.defMat._42,d._43=b.defMat._43);if(null==b.parent){var f=c;var g=a.absPos}else f=c,g=a.jointsData[b.parent.index].currentAbsPose;var h=d._11;var k=d._12;var l=d._13;var m=d._21;var p=d._22;var t=d._23;var n=d._31;var r=d._32;var q=d._33;var u=d._41;var v=d._42;var w=d._43;var x=g._11;var z=g._12;
var A=g._13;var B=g._21;var C=g._22;var D=g._23;var E=g._31;var F=g._32;var H=g._33;var I=g._41;d=g._42;g=g._43;f._11=h*x+k*B+l*E;f._12=h*z+k*C+l*F;f._13=h*A+k*D+l*H;f._14=0;f._21=m*x+p*B+t*E;f._22=m*z+p*C+t*F;f._23=m*A+p*D+t*H;f._24=0;f._31=n*x+r*B+q*E;f._32=n*z+r*C+q*F;f._33=n*A+r*D+q*H;f._34=0;f._41=u*x+v*B+w*E+I;f._42=u*z+v*C+w*F+d;f._43=u*A+v*D+w*H+g;f._44=1;null!=this.additivePose&&(f=c,d=this.additivePose,h=d._11,k=d._12,l=d._13,m=d._21,p=d._22,t=d._23,n=d._31,r=d._32,q=d._33,u=d._41,v=d._42,
w=d._43,x=c._11,z=c._12,A=c._13,B=c._21,C=c._22,D=c._23,E=c._31,F=c._32,H=c._33,I=c._41,d=c._42,g=c._43,f._11=h*x+k*B+l*E,f._12=h*z+k*C+l*F,f._13=h*A+k*D+l*H,f._14=0,f._21=m*x+p*B+t*E,f._22=m*z+p*C+t*F,f._23=m*A+p*D+t*H,f._24=0,f._31=n*x+r*B+q*E,f._32=n*z+r*C+q*F,f._33=n*A+r*D+q*H,f._34=0,f._41=u*x+v*B+w*E+I,f._42=u*z+v*C+w*F+d,f._43=u*A+v*D+w*H+g,f._44=1);0<=e&&(f=a.currentPalette[e],d=b.transPos,h=d._11,k=d._12,l=d._13,m=d._21,p=d._22,t=d._23,n=d._31,r=d._32,q=d._33,u=d._41,v=d._42,w=d._43,x=c._11,
z=c._12,A=c._13,B=c._21,C=c._22,D=c._23,E=c._31,F=c._32,H=c._33,I=c._41,d=c._42,g=c._43,f._11=h*x+k*B+l*E,f._12=h*z+k*C+l*F,f._13=h*A+k*D+l*H,f._14=0,f._21=m*x+p*B+t*E,f._22=m*z+p*C+t*F,f._23=m*A+p*D+t*H,f._24=0,f._31=n*x+r*B+q*E,f._32=n*z+r*C+q*F,f._33=n*A+r*D+q*H,f._34=0,f._41=u*x+v*B+w*E+I,f._42=u*z+v*C+w*F+d,f._43=u*A+v*D+w*H+g,f._44=1)}},__class__:Ie};var Fa=function(){this.f=-1;Ie.call(this);var a=0,b=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.speed=new I(a,b,c)};z["h3d.scene.DynamicJointData"]=
Fa;Fa.__name__="h3d.scene.DynamicJointData";Fa.__super__=Ie;Fa.prototype=J(Ie.prototype,{load:function(a){null!=a.currentRelPose&&(null==this.currentRelPose&&(this.currentRelPose=new ma),this.currentRelPose.load(a.currentRelPose));null!=a.currentAbsPose&&(null==this.currentAbsPose&&(this.currentAbsPose=new ma),this.currentAbsPose.load(a.currentAbsPose));null!=a.additivePose&&(null==this.additivePose&&(this.additivePose=new ma),this.additivePose.load(a.additivePose));null!=a.absPos&&(null==this.absPos&&
(this.absPos=new ma),this.absPos.load(a.absPos));var b=this.speed;a=a.speed;b.x=a.x;b.y=a.y;b.z=a.z},sync:function(a,b){Ie.prototype.sync.call(this,a,b);this.f!=ba.frameCount?(this.f=ba.frameCount,null==this.initialState&&(this.initialState=new Fa),this.initialState.load(this)):this.load(this.initialState);this.computeDyn(a,b);this.computeRotationDyn(a,b.parent)},computeDyn:function(a,b){var c=a.jointsData[b.index];c=c instanceof Fa?c:null;var d=null==c.absPos?c.currentAbsPose:c.absPos,e=b.defMat;
var f=Fa.newWorldPos;var g=d;var h=g._41;var k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);f.x=h;f.y=k;f.z=g;f=Fa.expectedPos;g=d;h=g._41;k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);f.x=h;f.y=k;f.z=g;var l=b.globalForce;var m=f=this.speed;g=1-b.resistance;h=l.x*g;k=l.y*g;g*=l.z;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);var p=h;var t=k;l=g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);h=m.x+p;k=m.y+t;g=m.z+l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;t=k;l=g;
null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);f.x=p;f.y=t;f.z=l;m=c.speed;g=1-b.damping;m.x*=g;m.y*=g;m.z*=g;f=c.speed;f.x*f.x+f.y*f.y+f.z*f.z>ae.SLEEP_THRESHOLD&&(m=f=Fa.newWorldPos,l=c.speed,k=ba.dt,h=0,t=ba.maxDeltaTime,null==t&&(t=1),null==h&&(h=0),g=k<h?h:k>t?t:k,h=l.x*g,k=l.y*g,g*=l.z,null==g&&(g=0),null==k&&(k=0),null==h&&(h=0),p=h,t=k,l=g,null==l&&(l=0),null==t&&(t=0),null==p&&(p=0),h=m.x+p,k=m.y+t,g=m.z+l,null==g&&(g=0),null==k&&(k=0),null==h&&(h=0),p=h,t=k,l=g,null==l&&(l=0),null==t&&(t=
0),null==p&&(p=0),f.x=p,f.y=t,f.z=l);f=c.speed;f.x*f.x+f.y*f.y+f.z*f.z>ae.MAX_THRESHOLD&&(f=Fa.newWorldPos,g=c.currentAbsPose,h=g._41,k=g._42,g=g._43,null==g&&(g=0),null==k&&(k=0),null==h&&(h=0),f.x=h,f.y=k,f.z=g,d.load(c.currentAbsPose),f=c.speed,g=k=h=0,null==g&&(g=0),null==k&&(k=0),null==h&&(h=0),f.x=h,f.y=k,f.z=g);fc.TMP_MAT.multiply(e,a.jointsData[b.parent.index].currentAbsPose);f=Fa.expectedPos;g=fc.TMP_MAT;h=g._41;k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);f.x=h;f.y=k;f.z=
g;m=f=Fa.newWorldPos;k=Fa.expectedPos;l=b.stiffness;var n=m.x;f.x=n+l*(k.x-n);n=m.y;f.y=n+l*(k.y-n);n=m.z;f.z=n+l*(k.z-n);m=Fa.newWorldPos;f=a.jointsData[b.parent.index].currentAbsPose;h=f._41;k=f._42;g=f._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);h=m.x-h;k=m.y-k;g=m.z-g;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;t=k;l=g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);m=p;var r=t,q=l;l=m*m+r*r+q*q;l=1E-20>l?0:1/Math.sqrt(l);h=m*l;k=r*l;g=q*l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=
h;t=k;l=g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);f=e;h=f._41;k=f._42;g=f._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);m=h;r=k;q=g;e=Math.sqrt(m*m+r*r+q*q);f=a.jointsData[b.parent.index].currentAbsPose;n=Math.sqrt(f._11*f._11+f._12*f._12+f._13*f._13);0>f._11*(f._22*f._33-f._23*f._32)+f._12*(f._23*f._31-f._21*f._33)+f._13*(f._21*f._32-f._22*f._31)&&(n*=-1);f=Fa.expectedPos;g=a.jointsData[b.parent.index].currentAbsPose;h=g._41;k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);m=
h;r=k;q=g;h=p*e;k=t*e;g=l*e;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;t=k;l=g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);g=n;h=p*g;k=t*g;g*=l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;t=k;l=g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);h=m+p;k=r+t;g=q+l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;t=k;l=g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);f.x=p;f.y=t;f.z=l;f=Fa.newWorldPos;m=Fa.expectedPos;k=Fa.newWorldPos;l=b.slackness;n=m.x;f.x=n+l*(k.x-n);n=m.y;f.y=n+l*(k.y-n);n=
m.z;f.z=n+l*(k.z-n);a.jointsData[b.parent.index].currentAbsPose.getInverse(fc.TMP_MAT);f=Fa.tmpVec;g=Fa.newWorldPos;f.x=g.x;f.y=g.y;f.z=g.z;m=Fa.tmpVec;k=fc.TMP_MAT;f=m.x*k._11+m.y*k._21+m.z*k._31+k._41;e=m.x*k._12+m.y*k._22+m.z*k._32+k._42;k=m.x*k._13+m.y*k._23+m.z*k._33+k._43;m.x=f;m.y=e;m.z=k;f=Fa.tmpVec2;g=c.currentAbsPose;h=g._41;k=g._42;g=g._43;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);f.x=h;f.y=k;f.z=g;m=Fa.tmpVec2;k=fc.TMP_MAT;f=m.x*k._11+m.y*k._21+m.z*k._31+k._41;e=m.x*k._12+m.y*k._22+
m.z*k._32+k._42;k=m.x*k._13+m.y*k._23+m.z*k._33+k._43;m.x=f;m.y=e;m.z=k;0<b.lockAxis.x&&(Fa.tmpVec.x=Fa.tmpVec2.x);0<b.lockAxis.y&&(Fa.tmpVec.y=Fa.tmpVec2.y);0<b.lockAxis.z&&(Fa.tmpVec.z=Fa.tmpVec2.z);m=Fa.tmpVec;k=a.jointsData[b.parent.index].currentAbsPose;f=m.x*k._11+m.y*k._21+m.z*k._31+k._41;e=m.x*k._12+m.y*k._22+m.z*k._32+k._42;k=m.x*k._13+m.y*k._23+m.z*k._33+k._43;m.x=f;m.y=e;m.z=k;f=Fa.newWorldPos;g=Fa.tmpVec;f.x=g.x;f.y=g.y;f.z=g.z;m=f=c.speed;l=Fa.newWorldPos;g=d;h=g._41;k=g._42;g=g._43;
null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);h=l.x-h;k=l.y-k;g=l.z-g;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;t=k;l=g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);g=1/ba.dt;h=p*g;k=t*g;g*=l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;t=k;l=g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);h=m.x+p;k=m.y+t;g=m.z+l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;t=k;l=g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);h=.5*p;k=.5*t;g=.5*l;null==g&&(g=0);null==k&&(k=0);null==h&&(h=0);p=h;t=k;l=
g;null==l&&(l=0);null==t&&(t=0);null==p&&(p=0);f.x=p;f.y=t;f.z=l;f=c.currentAbsPose;g=Fa.newWorldPos;f._41=g.x;f._42=g.y;f._43=g.z;null==c.absPos&&(c.absPos=new ma);c.absPos.load(c.currentAbsPose);null==c.relPos&&(c.relPos=new ma);a.jointsData[b.parent.index].currentAbsPose.getInverse(fc.TMP_MAT);c.relPos.multiply(c.absPos,fc.TMP_MAT);if(0<=b.bindIndex){f=a.currentPalette[b.bindIndex];n=b.transPos;q=c.currentAbsPose;b=n._11;d=n._12;e=n._13;m=n._21;k=n._22;h=n._23;l=n._31;t=n._32;p=n._33;g=n._41;r=
n._42;n=n._43;var u=q._11,v=q._12,w=q._13,x=q._21,z=q._22,A=q._23,B=q._31,C=q._32,D=q._33,E=q._41,F=q._42;q=q._43;f._11=b*u+d*x+e*B;f._12=b*v+d*z+e*C;f._13=b*w+d*A+e*D;f._14=0;f._21=m*u+k*x+h*B;f._22=m*v+k*z+h*C;f._23=m*w+k*A+h*D;f._24=0;f._31=l*u+t*x+p*B;f._32=l*v+t*z+p*C;f._33=l*w+t*A+p*D;f._34=0;f._41=g*u+r*x+n*B+E;f._42=g*v+r*z+n*C+F;f._43=g*w+r*A+n*D+q;f._44=1}f=c.speed;0!=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z)&&(a.forceJointsUpdateOnFrame=ba.frameCount+1)},computeRotationDyn:function(a,b){if(null==
b.follow){var c=a.jointsData[b.index];var d=a.jointsData[b.index];var e=d instanceof Fa?d:null;if(1==b.subs.length){d=b.subs[0];var f=d instanceof ae?d:null;if(null==f)return;d=a.jointsData[f.index];var g=d instanceof Fa?d:null;d=Fa.tmpVec;var h=f.defMat;var k=h._41;f=h._42;h=h._43;null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);var l=k*k+f*f+h*h;l=1E-20>l?0:1/Math.sqrt(l);k*=l;f*=l;h*=l;null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);d.x=k;d.y=f;d.z=h;d=Fa.tmpVec2;
h=g.relPos;k=h._41;f=h._42;h=h._43;null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);l=k*k+f*f+h*h;l=1E-20>l?0:1/Math.sqrt(l);k*=l;f*=l;h*=l;null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);null==h&&(h=0);null==f&&(f=0);null==k&&(k=0);d.x=k;d.y=f;d.z=h;Fa.tmpQ.initMoveTo(Fa.tmpVec,Fa.tmpVec2);Fa.tmpQ.toMatrix(fc.TMP_MAT);c.currentAbsPose.multiply(fc.TMP_MAT,c.currentAbsPose)}if(0<=b.bindIndex){d=a.currentPalette[b.bindIndex];var m=b.transPos,p=c.currentAbsPose;c=m._11;a=m._12;b=m._13;g=m._21;f=m._22;k=m._23;
h=m._31;l=m._32;var t=m._33,n=m._41,r=m._42;m=m._43;var q=p._11,u=p._12,v=p._13,w=p._21,x=p._22,z=p._23,A=p._31,B=p._32,C=p._33,D=p._41,E=p._42;p=p._43;d._11=c*q+a*w+b*A;d._12=c*u+a*x+b*B;d._13=c*v+a*z+b*C;d._14=0;d._21=g*q+f*w+k*A;d._22=g*u+f*x+k*B;d._23=g*v+f*z+k*C;d._24=0;d._31=h*q+l*w+t*A;d._32=h*u+l*x+t*B;d._33=h*v+l*z+t*C;d._34=0;d._41=n*q+r*w+m*A+D;d._42=n*u+r*x+m*B+E;d._43=n*v+r*z+m*C+p;d._44=1}null!=e&&e.absPos.load(e.currentAbsPose)}},__class__:Fa});var fc=function(a,b,c){this.enableRetargeting=
this.prevEnableRetargeting=!0;this.prevJointsFrame=this.forceJointsUpdateOnFrame=-1;Lc.call(this,null,b,c);null!=a&&this.setSkinData(a)};z["h3d.scene.Skin"]=fc;fc.__name__="h3d.scene.Skin";fc.__super__=Lc;fc.prototype=J(Lc.prototype,{clone:function(a){a=null==a?new fc(null,this.materials.slice()):a;Lc.prototype.clone.call(this,a);a.setSkinData(this.skinData);a.jointsData=[];for(var b=0,c=this.jointsData;b<c.length;){var d=c[b];++b;a.jointsData.push(ua.copy(d))}return a},addBoundsRec:function(a,b){var c=
this.primitive;this.set_primitive(null);Lc.prototype.addBoundsRec.call(this,a,b);this.set_primitive(c);if(0==(this.flags&512)){this.syncJoints();null==this.skinData.vertexWeights&&Z.__cast(this.primitive,pe).loadSkin(this.skinData);var d=this.getAbsPos();c=Math.sqrt(d._11*d._11+d._12*d._12+d._13*d._13);var e=Math.sqrt(d._21*d._21+d._22*d._22+d._23*d._23);var f=Math.sqrt(d._31*d._31+d._32*d._32+d._33*d._33);0>d._11*(d._22*d._33-d._23*d._32)+d._12*(d._23*d._31-d._21*d._33)+d._13*(d._21*d._32-d._22*
d._31)&&(c*=-1,e*=-1,f*=-1);c=Math.max(Math.max(c,e),f);e=0;for(f=this.skinData.allJoints;e<f.length;){var g=f[e];++e;if(!(0>g.offsetRay)){var h=this.currentPalette[g.bindIndex];d=g.offsets;var k=d.xMin;var l=d.yMin;d=d.zMin;null==d&&(d=0);null==l&&(l=0);null==k&&(k=0);var m=d;null==m&&(m=0);null==l&&(l=0);null==k&&(k=0);d=k;k=m;if(null!=h){m=d*h._12+l*h._22+k*h._32+h._42;var p=d*h._13+l*h._23+k*h._33+h._43;d=d*h._11+l*h._21+k*h._31+h._41;l=m;k=p;null!=b&&(m=d*b._12+l*b._22+k*b._32+b._42,p=d*b._13+
l*b._23+k*b._33+b._43,d=d*b._11+l*b._21+k*b._31+b._41,l=m,k=p);m=g.offsetRay*c;d-m<a.xMin&&(a.xMin=d-m);d+m>a.xMax&&(a.xMax=d+m);l-m<a.yMin&&(a.yMin=l-m);l+m>a.yMax&&(a.yMax=l+m);k-m<a.zMin&&(a.zMin=k-m);k+m>a.zMax&&(a.zMax=k+m);l=g.offsets;k=l.xMax;d=l.yMax;l=l.zMax;null==l&&(l=0);null==d&&(d=0);null==k&&(k=0);m=d;p=l;null==p&&(p=0);null==m&&(m=0);null==k&&(k=0);d=k;l=m;k=p;m=d*h._12+l*h._22+k*h._32+h._42;p=d*h._13+l*h._23+k*h._33+h._43;d=d*h._11+l*h._21+k*h._31+h._41;l=m;k=p;null!=b&&(h=d*b._12+
l*b._22+k*b._32+b._42,m=d*b._13+l*b._23+k*b._33+b._43,d=d*b._11+l*b._21+k*b._31+b._41,l=h,k=m);h=d;d=l;l=k;g=g.offsetRay*c;h-g<a.xMin&&(a.xMin=h-g);h+g>a.xMax&&(a.xMax=h+g);d-g<a.yMin&&(a.yMin=d-g);d+g>a.yMax&&(a.yMax=d+g);l-g<a.zMin&&(a.zMin=l-g);l+g>a.zMax&&(a.zMax=l+g)}}}}},getCurrentSkeletonBounds:function(){this.syncJoints();for(var a=new fb,b=0,c=this.skinData.allJoints;b<c.length;){var d=c[b];++b;if(!(0>d.bindIndex)){var e=this.jointsData[d.index].currentAbsPose;d=e._41;var f=e._42;e=e._43;
d<a.xMin&&(a.xMin=d);d>a.xMax&&(a.xMax=d);f<a.yMin&&(a.yMin=f);f>a.yMax&&(a.yMax=f);e<a.zMin&&(a.zMin=e);e>a.zMax&&(a.zMax=e)}}return a},getObjectByName:function(a){if(null!=this.skinData&&this.skinData.name==a)return this;var b=Lc.prototype.getObjectByName.call(this,a);return null!=b?b:null!=this.skinData&&(a=this.skinData.namedJoints.h[a],null!=a)?new sf(this,a):null},getLocalCollider:function(){throw u.thrown("Not implemented");},getGlobalCollider:function(){var a=Z.__cast(this.primitive.getCollider(),
vf);Z.__cast(this.primitive,pe).loadSkin(this.skinData);return new bh(this,Z.__cast(a.b,Fd))},calcAbsPos:function(){Lc.prototype.calcAbsPos.call(this);this.jointsUpdated=!0},getSkinData:function(){return this.skinData},getJointRelPosition:function(a,b){null==b&&(b=!1);a=this.skinData.namedJoints.h[a];if(null==a)return null;if(b)return this.jointsData[a.index].additivePose;b=this.jointsData[a.index].currentRelPose;return null!=b?b:a.defMat},setJointRelPosition:function(a,b,c){null==c&&(c=!1);a=this.skinData.namedJoints.h[a];
null!=a&&(c?this.jointsData[a.index].additivePose=b:this.jointsData[a.index].currentRelPose=b,this.jointsUpdated=!0)},setSkinData:function(a,b){null==b&&(b=!0);this.skinData=a;this.jointsUpdated=!0;this.set_primitive(a.primitive);if(b){a=!1;var c=0;for(b=this.materials;c<b.length;){var d=b[c];++c;if(null!=d&&null!=d.get_normalMap()){a=!0;break}}b=this.skinShader=a?new hf:new Ve;b.constModified=!0;b.fourBonesByVertex__=4==this.skinData.bonesPerVertex;d=0;if(null!=this.skinData.splitJoints)for(c=0,
b=this.skinData.splitJoints;c<b.length;)a=b[c],++c,a.joints.length>d&&(d=a.joints.length);else d=this.skinData.boundJoints.length;this.skinShader.MaxBones__<d&&(b=this.skinShader,b.constModified=!0,b.MaxBones__=d);c=0;for(b=this.materials;c<b.length;)d=b[c],++c,null!=d&&(a=d.passes.getShader(hf),null!=a&&d.passes.removeShader(a),null!=d.get_normalMap()?d.passes.addShaderAtIndex(this.skinShader,d.passes.getShaderIndex(d.normalShader)+1):d.passes.addShader(this.skinShader),null!=this.skinData.splitJoints&&
d.passes.set_dynamicParameters(!0))}this.jointsData=[];this.currentPalette=[];this.prevSplitPalette=this.prevPalette=null;this.paletteChanged=!0;this.makeJointsData();c=0;for(b=this.skinData.boundJoints.length;c<b;)c++,this.currentPalette.push(Ac.I());if(null!=this.skinData.splitJoints)for(this.splitPalette=[],c=0,b=this.skinData.splitJoints;c<b.length;){var e=b[c];++c;a=this.splitPalette;d=[];var f=0;for(e=e.joints;f<e.length;){var g=e[f];++f;d.push(this.currentPalette[g.bindIndex])}a.push(d)}else this.splitPalette=
null},makeJointsData:function(){for(var a=0,b=this.skinData.allJoints;a<b.length;){var c=b[a];++a;this.jointsData[c.index]=c.makeRuntimeData()}},sync:function(a){(a.visibleFlag||0!=(this.flags&64))&&this.syncJoints()},syncJoints:function(){if(this.jointsUpdated||this.forceJointsUpdateOnFrame==ba.frameCount){if(this.computeVelocity()){this.syncPrevJoints();var a=this.skinShader;a.constModified=!0;a.calcPrevPos__=!0}else this.prevPalette=this.prevSplitPalette=null,a=this.skinShader,a.constModified=
!0,a.calcPrevPos__=!1;a=this.skinShader;var b=this.computeVelocity();a.constModified=!0;a.calcPrevPos__=b;a=0;for(b=this.skinData.allJoints;a<b.length;){var c=b[a];++a;this.jointsData[c.index].sync(this,c)}this.skinShader.bonesMatrixes__=this.currentPalette;this.jointsUpdated=!1;this.prevEnableRetargeting=this.enableRetargeting}},syncPrevJoints:function(){var a;if(this.prevJointsFrame!=ba.frameCount){this.prevJointsFrame=ba.frameCount;if(null==this.prevPalette){this.prevPalette=[];var b=0;for(a=this.currentPalette.length;b<
a;)b++,this.prevPalette.push(Ac.I());if(null!=this.splitPalette)for(this.prevSplitPalette=[],b=0,a=this.skinData.splitJoints;b<a.length;){var c=a[b];++b;var d=this.prevSplitPalette,e=[],f=0;for(c=c.joints;f<c.length;){var g=c[f];++f;e.push(this.prevPalette[g.bindIndex])}d.push(e)}}a=0;for(b=this.currentPalette;a<b.length;)d=b[a],e=a++,this.prevPalette[e].load(d);this.skinShader.prevBonesMatrixes__=this.prevPalette}},emit:function(a){var b;this.calcScreenRatio(a);this.syncJoints();if(null==this.splitPalette)Lc.prototype.emit.call(this,
a);else{var c=0;for(b=this.splitPalette.length;c<b;){var d=c++;var e=this.materials[this.skinData.splitJoints[d].material];if(null!=e)for(null==d&&(d=0),e=e.passes;null!=e;)e.culled||(a.emitPass(e,this).index=d),e=e.nextPass}}if(this.showJoints){null==this.jointsGraphics&&(this.jointsGraphics=new Ed(this),this.jointsGraphics.material.passes.depth(!1,nb.Always),this.jointsGraphics.material.passes.setPassName("alpha"));for(b=this;null!=b.parent;)b=b.parent;this.jointsGraphics.set_follow(b);a=this.jointsGraphics;
a.clear();c=0;for(b=this.skinData.allJoints;c<b.length;){d=b[c];++c;e=this.jointsData[d.index].currentAbsPose;var f=null==d.parent?this.absPos:this.jointsData[d.parent.index].currentAbsPose;a.lineStyle(1,null==d.parent?-16776961:-256);a.moveTo(f._41,f._42,f._43);a.lineTo(e._41,e._42,e._43)}}else null!=this.jointsGraphics&&(b=this.jointsGraphics,null!=b&&null!=b.parent&&b.parent.removeChild(b),this.jointsGraphics=null)},draw:function(a){if(null==this.splitPalette)Lc.prototype.draw.call(this,a);else{var b=
a.drawPass.index;this.skinShader.bonesMatrixes__=this.splitPalette[b];null!=this.prevSplitPalette&&(this.skinShader.prevBonesMatrixes__=this.prevSplitPalette[b]);this.primitive.selectMaterial(b,this.primitive.screenRatioToLod(this.curScreenRatio));a.uploadParams();this.primitive.render(a.engine)}},__class__:fc});var sg=function(a,b){this.priority=0;this.cullingDistance=-1;Df.call(this,a,b)};z["h3d.scene.fwd.Light"]=sg;sg.__name__="h3d.scene.fwd.Light";sg.__super__=Df;sg.prototype=J(Df.prototype,{get_enableSpecular:function(){return!1},
set_enableSpecular:function(a){if(a)throw u.thrown("Not implemented for this light");return!1},__class__:sg});var gh=function(){this.perPixelLighting=!0;this.maxLightsPerObject=6;this.drawPasses=0;var a=.5,b=.5,c=.5;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.ambientLight=new I(a,b,c);this.ambientShader=new dd;this.set_additiveLighting(!0)};z["h3d.scene.fwd.LightSystem"]=gh;gh.__name__="h3d.scene.fwd.LightSystem";gh.__super__=pg;gh.prototype=J(pg.prototype,{get_additiveLighting:function(){var a=
this.ambientShader;return(a instanceof dd?a:null).additive__},set_additiveLighting:function(a){var b=this.ambientShader;b=b instanceof dd?b:null;b.constModified=!0;return b.additive__=a},initLights:function(a){this.lightCount=0;this.ctx=a;this.cullLights();pg.prototype.initLights.call(this,a);if(this.lightCount<=this.maxLightsPerObject){var b=a.lights,c=M(this,this.sortLight);if(null==b)b=null;else for(var d=1,e,f,g,h,k,l,m;;){h=b;m=b=null;for(e=0;null!=h;){++e;k=h;g=f=0;for(l=d;g<l&&(g++,++f,k=k.next,
null!=k););for(g=d;0<f||0<g&&null!=k;)0==f?(l=k,k=k.next,--g):0==g||null==k||0>=c(h,k)?(l=h,h=h.next,--f):(l=k,k=k.next,--g),null!=m?m.next=l:b=l,m=l;h=k}m.next=null;if(1>=e)break;d*=2}a.lights=b}},initGlobals:function(a){a.set("global.ambientLight",this.ambientLight);a.set("global.perPixelLighting",this.perPixelLighting)},cullLights:function(){for(var a=this.ctx.lights,b=null,c=new ud;null!=a;){var d=a instanceof sg?a:null;null!=d&&(c.x=d.absPos._41,c.y=d.absPos._42,c.z=d.absPos._43,c.r=d.cullingDistance);
null==d||0<d.cullingDistance&&!this.ctx.computingStatic&&!this.ctx.camera.frustum.hasSphere(c)?null==b?this.ctx.lights=a.next:b.next=a.next:(this.lightCount++,d.objectDistance=0,b=a);a=a.next}},sortLight:function(a,b){var c=a.priority-b.priority;return 0!=c?-c:a.objectDistance<b.objectDistance?-1:1},computeLight:function(a,b){if(this.lightCount>this.maxLightsPerObject){for(var c=this.ctx.lights;null!=c;){var d=c instanceof sg?c:null;if(0!=(a.flags&16))var e=d.absPos._41-this.ctx.camera.target.x,f=
d.absPos._42-this.ctx.camera.target.y,g=d.absPos._43-this.ctx.camera.target.z;else e=d.absPos._41-a.absPos._41,f=d.absPos._42-a.absPos._42,g=d.absPos._43-a.absPos._43;null==g&&(g=0);d.objectDistance=e*e+f*f+g*g;c=c.next}d=this.ctx.lights;a=M(this,this.sortLight);if(null==d)d=null;else{c=1;for(var h,k,l,m;;){g=d;m=d=null;for(e=0;null!=g;){++e;k=g;h=f=0;for(l=c;h<l&&(h++,++f,k=k.next,null!=k););for(h=c;0<f||0<h&&null!=k;)0==f?(l=k,k=k.next,--h):0==h||null==k||0>=a(g,k)?(l=g,g=g.next,--f):(l=k,k=k.next,
--h),null!=m?m.next=l:d=l,m=l;g=k}m.next=null;if(1>=e)break;c*=2}}this.ctx.lights=d}b=this.ctx.allocShaderList(this.ambientShader,b);d=this.ctx.lights;for(a=0;null!=d&&a++!=this.maxLightsPerObject;)b=this.ctx.allocShaderList(d.shader,b),d=d.next;return b},__class__:gh});var nh=function(){this.enableSky=!1;Rb.call(this,"depth",[dc.PackFloat(dc.Value("output.depth"))]);this.depthMapId=za.allocID("depthMap")};z["h3d.scene.fwd.DepthPass"]=nh;nh.__name__="h3d.scene.fwd.DepthPass";nh.__super__=Rb;nh.prototype=
J(Rb.prototype,{draw:function(a,b){var c=this.ctx.textures.allocTarget("depthMap",this.ctx.engine.width,this.ctx.engine.height,!0);this.ctx.engine.pushTarget(c);this.ctx.engine.clear(this.enableSky?0:16711680,1);Rb.prototype.draw.call(this,a,b);this.ctx.engine.popTarget();this.ctx.globals.map.h[this.depthMapId]={texture:c}},__class__:nh});var oh=function(){Rb.call(this,"normal",[dc.PackNormal(dc.Value("output.normal"))]);this.normalMapId=za.allocID("normalMap")};z["h3d.scene.fwd.NormalPass"]=oh;oh.__name__=
"h3d.scene.fwd.NormalPass";oh.__super__=Rb;oh.prototype=J(Rb.prototype,{draw:function(a,b){var c=this.ctx.textures.allocTarget("normalMap",this.ctx.engine.width,this.ctx.engine.height);this.ctx.engine.pushTarget(c);this.ctx.engine.clear(8421504,1);Rb.prototype.draw.call(this,a,b);this.ctx.engine.popTarget();this.ctx.globals.map.h[this.normalMapId]=c},__class__:oh});var fh=function(){this.shadow=new jh(1024);this.normal=new oh;this.depth=new nh;Mc.call(this);this.defaultPass=new Rb("default");this.allPasses=
[this.defaultPass,this.depth,this.normal,this.shadow]};z["h3d.scene.fwd.Renderer"]=fh;fh.__name__="h3d.scene.fwd.Renderer";fh.__super__=Mc;fh.prototype=J(Mc.prototype,{get_def:function(){return this.defaultPass},renderPass:function(a,b,c){a.draw(b,c)},getPassByName:function(a){return"alpha"==a||"additive"==a?this.defaultPass:Mc.prototype.getPassByName.call(this,a)},render:function(){this.has("shadow")&&this.renderPass(this.shadow,this.get("shadow"));this.has("depth")&&this.renderPass(this.depth,this.get("depth"));
this.has("normal")&&this.renderPass(this.normal,this.get("normal"));this.renderPass(this.defaultPass,this.get("default"));this.renderPass(this.defaultPass,this.get("alpha"),this.backToFront);this.renderPass(this.defaultPass,this.get("additive"))},__class__:fh});var dd=function(){ka.call(this)};z["h3d.shader.AmbientLight"]=dd;dd.__name__="h3d.shader.AmbientLight";dd.__super__=ka;dd.prototype=J(ka.prototype,{get_additive:function(){return this.additive__},set_additive:function(a){this.constModified=
!0;return this.additive__=a},updateConstants:function(a){this.constBits=0;this.additive__&&(this.constBits|=2);this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.additive__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.additive__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(dd.prototype);a.shader=this.shader;a.additive__=this.additive__;return a},__class__:dd});var af=function(){this.viewportB__=
new I(0,0,0);this.viewportA__=new I(0,0,0);this.halfPixelInverse__=new I(0,0,0);this.uvPos__=new T(0,0,0,1);this.filterMatrixB__=new I(0,0,0);this.filterMatrixA__=new I(0,0,0);this.absoluteMatrixB__=new I(0,0,0);this.absoluteMatrixA__=new I(0,0,0);this.color__=new T(0,0,0,1);this.zValue__=0;ka.call(this)};z["h3d.shader.Base2d"]=af;af.__name__="h3d.shader.Base2d";af.__super__=ka;af.prototype=J(ka.prototype,{get_zValue:function(){return this.zValue__},set_zValue:function(a){return this.zValue__=a},
get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},get_isRelative:function(){return this.isRelative__},set_isRelative:function(a){this.constModified=!0;return this.isRelative__=a},get_color:function(){return this.color__},set_color:function(a){return this.color__=a},get_absoluteMatrixA:function(){return this.absoluteMatrixA__},set_absoluteMatrixA:function(a){return this.absoluteMatrixA__=a},get_absoluteMatrixB:function(){return this.absoluteMatrixB__},set_absoluteMatrixB:function(a){return this.absoluteMatrixB__=
a},get_filterMatrixA:function(){return this.filterMatrixA__},set_filterMatrixA:function(a){return this.filterMatrixA__=a},get_filterMatrixB:function(){return this.filterMatrixB__},set_filterMatrixB:function(a){return this.filterMatrixB__=a},get_hasUVPos:function(){return this.hasUVPos__},set_hasUVPos:function(a){this.constModified=!0;return this.hasUVPos__=a},get_uvPos:function(){return this.uvPos__},set_uvPos:function(a){return this.uvPos__=a},get_killAlpha:function(){return this.killAlpha__},set_killAlpha:function(a){this.constModified=
!0;return this.killAlpha__=a},get_pixelAlign:function(){return this.pixelAlign__},set_pixelAlign:function(a){this.constModified=!0;return this.pixelAlign__=a},get_halfPixelInverse:function(){return this.halfPixelInverse__},set_halfPixelInverse:function(a){return this.halfPixelInverse__=a},get_viewportA:function(){return this.viewportA__},set_viewportA:function(a){return this.viewportA__=a},get_viewportB:function(){return this.viewportB__},set_viewportB:function(a){return this.viewportB__=a},updateConstants:function(a){this.constBits=
0;this.isRelative__&&(this.constBits|=1);this.hasUVPos__&&(this.constBits|=2);this.killAlpha__&&(this.constBits|=4);this.pixelAlign__&&(this.constBits|=8);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.zValue__;case 1:return this.texture__;case 2:return this.isRelative__;case 3:return this.color__;case 4:return this.absoluteMatrixA__;case 5:return this.absoluteMatrixB__;case 6:return this.filterMatrixA__;case 7:return this.filterMatrixB__;case 8:return this.hasUVPos__;
case 9:return this.uvPos__;case 10:return this.killAlpha__;case 11:return this.pixelAlign__;case 12:return this.halfPixelInverse__;case 13:return this.viewportA__;case 14:return this.viewportB__}return null},getParamFloatValue:function(a){return 0==a?this.zValue__:0},setParamIndexValue:function(a,b){switch(a){case 0:this.zValue__=b;break;case 1:this.texture__=b;break;case 2:this.isRelative__=b;break;case 3:this.color__=b;break;case 4:this.absoluteMatrixA__=b;break;case 5:this.absoluteMatrixB__=b;
break;case 6:this.filterMatrixA__=b;break;case 7:this.filterMatrixB__=b;break;case 8:this.hasUVPos__=b;break;case 9:this.uvPos__=b;break;case 10:this.killAlpha__=b;break;case 11:this.pixelAlign__=b;break;case 12:this.halfPixelInverse__=b;break;case 13:this.viewportA__=b;break;case 14:this.viewportB__=b}},setParamIndexFloatValue:function(a,b){0==a&&(this.zValue__=b)},clone:function(){var a=Object.create(af.prototype);a.shader=this.shader;a.zValue__=this.zValue__;a.texture__=this.texture__;a.isRelative__=
this.isRelative__;a.color__=this.color__;a.absoluteMatrixA__=this.absoluteMatrixA__;a.absoluteMatrixB__=this.absoluteMatrixB__;a.filterMatrixA__=this.filterMatrixA__;a.filterMatrixB__=this.filterMatrixB__;a.hasUVPos__=this.hasUVPos__;a.uvPos__=this.uvPos__;a.killAlpha__=this.killAlpha__;a.pixelAlign__=this.pixelAlign__;a.halfPixelInverse__=this.halfPixelInverse__;a.viewportA__=this.viewportA__;a.viewportB__=this.viewportB__;return a},__class__:af});var Gd=function(){this.specularColor__=new I(0,0,
0);this.specularPower__=this.specularAmount__=0;this.color__=new T(0,0,0,1);ka.call(this);var a=this.color__,b=1,c=1,d=1;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;a.w=1;a=this.specularColor__;d=c=b=1;null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);a.x=b;a.y=c;a.z=d;this.specularPower__=50;this.specularAmount__=1};z["h3d.shader.BaseMesh"]=Gd;Gd.__name__="h3d.shader.BaseMesh";Gd.__super__=ka;Gd.prototype=J(ka.prototype,{get_color:function(){return this.color__},set_color:function(a){return this.color__=
a},get_specularPower:function(){return this.specularPower__},set_specularPower:function(a){return this.specularPower__=a},get_specularAmount:function(){return this.specularAmount__},set_specularAmount:function(a){return this.specularAmount__=a},get_specularColor:function(){return this.specularColor__},set_specularColor:function(a){return this.specularColor__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.color__;
case 1:return this.specularPower__;case 2:return this.specularAmount__;case 3:return this.specularColor__}return null},getParamFloatValue:function(a){switch(a){case 1:return this.specularPower__;case 2:return this.specularAmount__}return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.color__=b;break;case 1:this.specularPower__=b;break;case 2:this.specularAmount__=b;break;case 3:this.specularColor__=b}},setParamIndexFloatValue:function(a,b){switch(a){case 1:this.specularPower__=b;break;
case 2:this.specularAmount__=b}},clone:function(){var a=Object.create(Gd.prototype);a.shader=this.shader;a.color__=this.color__;a.specularPower__=this.specularPower__;a.specularAmount__=this.specularAmount__;a.specularColor__=this.specularColor__;return a},__class__:Gd});var ff=function(){this.cubeDir__=new ma;this.depthThresholdMaxDist__=0;this.depthThreshold__=1;this.fixedColor__=new T(0,0,0,1);this.pixel__=new I(0,0,0);this.offsets__=[];this.values__=[];this.Quality__=0;this.inverseProj__=new ma;
Xa.call(this)};z["h3d.shader.Blur"]=ff;ff.__name__="h3d.shader.Blur";ff.__super__=Xa;ff.prototype=J(Xa.prototype,{get_inverseProj:function(){return this.inverseProj__},set_inverseProj:function(a){return this.inverseProj__=a},get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},get_depthTexture:function(){return this.depthTexture__},set_depthTexture:function(a){return this.depthTexture__=a},get_Quality:function(){return this.Quality__},set_Quality:function(a){this.constModified=
!0;return this.Quality__=a},get_isDepth:function(){return this.isDepth__},set_isDepth:function(a){this.constModified=!0;return this.isDepth__=a},get_values:function(){return this.values__},set_values:function(a){return this.values__=a},get_offsets:function(){return this.offsets__},set_offsets:function(a){return this.offsets__=a},get_pixel:function(){return this.pixel__},set_pixel:function(a){return this.pixel__=a},get_hasFixedColor:function(){return this.hasFixedColor__},set_hasFixedColor:function(a){this.constModified=
!0;return this.hasFixedColor__=a},get_smoothFixedColor:function(){return this.smoothFixedColor__},set_smoothFixedColor:function(a){this.constModified=!0;return this.smoothFixedColor__=a},get_fixedColor:function(){return this.fixedColor__},set_fixedColor:function(a){return this.fixedColor__=a},get_isDepthDependant:function(){return this.isDepthDependant__},set_isDepthDependant:function(a){this.constModified=!0;return this.isDepthDependant__=a},get_depthThreshold:function(){return this.depthThreshold__},
set_depthThreshold:function(a){return this.depthThreshold__=a},get_depthThresholdMaxDist:function(){return this.depthThresholdMaxDist__},set_depthThresholdMaxDist:function(a){return this.depthThresholdMaxDist__=a},get_isCube:function(){return this.isCube__},set_isCube:function(a){this.constModified=!0;return this.isCube__=a},get_cubeTexture:function(){return this.cubeTexture__},set_cubeTexture:function(a){return this.cubeTexture__=a},get_cubeDir:function(){return this.cubeDir__},set_cubeDir:function(a){return this.cubeDir__=
a},updateConstants:function(a){this.constBits=0;var b=this.Quality__;if(0!=b>>>8)throw u.thrown("Quality is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.isDepth__&&(this.constBits|=256);this.hasFixedColor__&&(this.constBits|=512);this.smoothFixedColor__&&(this.constBits|=1024);this.isDepthDependant__&&(this.constBits|=2048);this.isCube__&&(this.constBits|=4096);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.inverseProj__;
case 2:return this.texture__;case 3:return this.depthTexture__;case 4:return this.Quality__;case 5:return this.isDepth__;case 6:return this.values__;case 7:return this.offsets__;case 8:return this.pixel__;case 9:return this.hasFixedColor__;case 10:return this.smoothFixedColor__;case 11:return this.fixedColor__;case 12:return this.isDepthDependant__;case 13:return this.depthThreshold__;case 14:return this.depthThresholdMaxDist__;case 15:return this.isCube__;case 16:return this.cubeTexture__;case 17:return this.cubeDir__}return null},
getParamFloatValue:function(a){switch(a){case 0:return this.flipY__;case 4:return this.Quality__;case 13:return this.depthThreshold__;case 14:return this.depthThresholdMaxDist__}return 0},clone:function(){var a=Object.create(ff.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.inverseProj__=this.inverseProj__;a.texture__=this.texture__;a.depthTexture__=this.depthTexture__;a.Quality__=this.Quality__;a.isDepth__=this.isDepth__;a.values__=this.values__;a.offsets__=this.offsets__;a.pixel__=this.pixel__;
a.hasFixedColor__=this.hasFixedColor__;a.smoothFixedColor__=this.smoothFixedColor__;a.fixedColor__=this.fixedColor__;a.isDepthDependant__=this.isDepthDependant__;a.depthThreshold__=this.depthThreshold__;a.depthThresholdMaxDist__=this.depthThresholdMaxDist__;a.isCube__=this.isCube__;a.cubeTexture__=this.cubeTexture__;a.cubeDir__=this.cubeDir__;return a},__class__:ff});var ph=function(){this.globals=new Float32Array(0);this.params=new Float32Array(0);this.tex=[]};z["h3d.shader.ShaderBuffers"]=ph;ph.__name__=
"h3d.shader.ShaderBuffers";ph.prototype={grow:function(a){var b=a.globalsSize<<2,c=a.paramsSize<<2,d=a.texturesCount;a=a.bufferCount;this.globals.length<b&&(this.globals=new Float32Array(b));this.params.length<c&&(this.params=new Float32Array(c));this.tex.length<d&&(this.tex=Array(d));0<a&&(null==this.buffers||this.buffers.length<a)&&(this.buffers=Array(a))},__class__:ph};var gi=function(){this.vertex=new ph;this.fragment=new ph};z["h3d.shader.Buffers"]=gi;gi.__name__="h3d.shader.Buffers";gi.prototype=
{grow:function(a){this.vertex.grow(a.vertex);null!=a.fragment&&this.fragment.grow(a.fragment)},__class__:gi};var Be=function(a){null==a&&(a=0);this.color__=new I(0,0,0);ka.call(this);var b=this.color__;b.x=(a>>16&255)/255;b.y=(a>>8&255)/255;b.z=(a&255)/255};z["h3d.shader.ColorAdd"]=Be;Be.__name__="h3d.shader.ColorAdd";Be.__super__=ka;Be.prototype=J(ka.prototype,{get_color:function(){return this.color__},set_color:function(a){return this.color__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},
getParamValue:function(a){return 0==a?this.color__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.color__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Be.prototype);a.shader=this.shader;a.color__=this.color__;return a},__class__:Be});var Ce=function(a){null==a&&(a=0);this.colorKey__=new T(0,0,0,1);ka.call(this);var b=this.colorKey__;b.x=(a>>16&255)/255;b.y=(a>>8&255)/255;b.z=(a&255)/255;b.w=(a>>>24)/255};z["h3d.shader.ColorKey"]=
Ce;Ce.__name__="h3d.shader.ColorKey";Ce.__super__=ka;Ce.prototype=J(ka.prototype,{get_colorKey:function(){return this.colorKey__},set_colorKey:function(a){return this.colorKey__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.colorKey__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.colorKey__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Ce.prototype);
a.shader=this.shader;a.colorKey__=this.colorKey__;return a},__class__:Ce});var De=function(a){this.enabled__=!0;this.matrix__=new ma;ka.call(this);null!=a?this.matrix__.loadValues(a):this.matrix__.identity()};z["h3d.shader.ColorMatrix"]=De;De.__name__="h3d.shader.ColorMatrix";De.__super__=ka;De.prototype=J(ka.prototype,{get_matrix:function(){return this.matrix__},set_matrix:function(a){return this.matrix__=a},get_enabled:function(){return this.enabled__},set_enabled:function(a){this.constModified=
!0;return this.enabled__=a},updateConstants:function(a){this.constBits=0;this.enabled__&&(this.constBits|=1);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.matrix__;case 1:return this.enabled__}return null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.matrix__=b;break;case 1:this.enabled__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(De.prototype);a.shader=this.shader;a.matrix__=
this.matrix__;a.enabled__=this.enabled__;return a},__class__:De});var oe=function(){this.poissonDisk__=[];this.shadowBias__=0;this.shadowProj__=new ma;this.shadowMapChannel__=hb.Unknown;this.shadowRes__=new I(0,0,0);this.shadowPower__=this.PCF_SAMPLES__=this.pcfScale__=0;ka.call(this);this.set_pcfQuality(1)};z["h3d.shader.DirShadow"]=oe;oe.__name__="h3d.shader.DirShadow";oe.__super__=ka;oe.prototype=J(ka.prototype,{set_pcfQuality:function(a){switch(a){case 2:var b=-.326;var c=-.406;null==c&&(c=0);
null==b&&(b=0);var d=new T(b,c,0,1);b=-.84;c=-.074;null==c&&(c=0);null==b&&(b=0);var e=new T(b,c,0,1);b=-.696;c=.457;null==c&&(c=0);null==b&&(b=0);var f=new T(b,c,0,1);b=-.203;c=.621;null==c&&(c=0);null==b&&(b=0);var g=new T(b,c,0,1);b=.962;c=-.195;null==c&&(c=0);null==b&&(b=0);var h=new T(b,c,0,1);b=.473;c=-.48;null==c&&(c=0);null==b&&(b=0);var k=new T(b,c,0,1);b=.519;c=.767;null==c&&(c=0);null==b&&(b=0);var l=new T(b,c,0,1);b=.185;c=-.893;null==c&&(c=0);null==b&&(b=0);var m=new T(b,c,0,1);b=.507;
c=.064;null==c&&(c=0);null==b&&(b=0);var p=new T(b,c,0,1);b=.896;c=.412;null==c&&(c=0);null==b&&(b=0);var t=new T(b,c,0,1);b=-.322;c=-.933;null==c&&(c=0);null==b&&(b=0);var n=new T(b,c,0,1);b=-.792;c=-.598;null==c&&(c=0);null==b&&(b=0);b=[d,e,f,g,h,k,l,m,p,t,n,new T(b,c,0,1)];break;case 3:b=-.613392;c=.617481;null==c&&(c=0);null==b&&(b=0);d=new T(b,c,0,1);b=.170019;c=-.040254;null==c&&(c=0);null==b&&(b=0);e=new T(b,c,0,1);b=-.299417;c=.791925;null==c&&(c=0);null==b&&(b=0);f=new T(b,c,0,1);b=.64568;
c=.49321;null==c&&(c=0);null==b&&(b=0);g=new T(b,c,0,1);b=-.651784;c=.717887;null==c&&(c=0);null==b&&(b=0);h=new T(b,c,0,1);b=.421003;c=.02707;null==c&&(c=0);null==b&&(b=0);k=new T(b,c,0,1);b=-.817194;c=-.271096;null==c&&(c=0);null==b&&(b=0);l=new T(b,c,0,1);b=-.705374;c=-.668203;null==c&&(c=0);null==b&&(b=0);m=new T(b,c,0,1);b=.97705;c=-.108615;null==c&&(c=0);null==b&&(b=0);p=new T(b,c,0,1);b=.063326;c=.142369;null==c&&(c=0);null==b&&(b=0);t=new T(b,c,0,1);b=.203528;c=.214331;null==c&&(c=0);null==
b&&(b=0);n=new T(b,c,0,1);b=-.667531;c=.32609;null==c&&(c=0);null==b&&(b=0);var r=new T(b,c,0,1);b=-.098422;c=-.295755;null==c&&(c=0);null==b&&(b=0);var q=new T(b,c,0,1);b=-.885922;c=.215369;null==c&&(c=0);null==b&&(b=0);var u=new T(b,c,0,1);b=.566637;c=.605213;null==c&&(c=0);null==b&&(b=0);var v=new T(b,c,0,1);b=.039766;c=-.3961;null==c&&(c=0);null==b&&(b=0);var w=new T(b,c,0,1);b=.751946;c=.453352;null==c&&(c=0);null==b&&(b=0);var x=new T(b,c,0,1);b=.078707;c=-.715323;null==c&&(c=0);null==b&&(b=
0);var z=new T(b,c,0,1);b=-.075838;c=-.529344;null==c&&(c=0);null==b&&(b=0);var A=new T(b,c,0,1);b=.724479;c=-.580798;null==c&&(c=0);null==b&&(b=0);var B=new T(b,c,0,1);b=.222999;c=-.215125;null==c&&(c=0);null==b&&(b=0);var C=new T(b,c,0,1);b=-.467574;c=-.405438;null==c&&(c=0);null==b&&(b=0);var D=new T(b,c,0,1);b=-.248268;c=-.814753;null==c&&(c=0);null==b&&(b=0);var E=new T(b,c,0,1);b=.354411;c=-.88757;null==c&&(c=0);null==b&&(b=0);var F=new T(b,c,0,1);b=.175817;c=.382366;null==c&&(c=0);null==b&&
(b=0);var H=new T(b,c,0,1);b=.487472;c=-.063082;null==c&&(c=0);null==b&&(b=0);var I=new T(b,c,0,1);b=-.084078;c=.898312;null==c&&(c=0);null==b&&(b=0);var J=new T(b,c,0,1);b=.488876;c=-.783441;null==c&&(c=0);null==b&&(b=0);var K=new T(b,c,0,1);b=.470016;c=.217933;null==c&&(c=0);null==b&&(b=0);var M=new T(b,c,0,1);b=-.69689;c=-.549791;null==c&&(c=0);null==b&&(b=0);var L=new T(b,c,0,1);b=-.149693;c=.605762;null==c&&(c=0);null==b&&(b=0);var N=new T(b,c,0,1);b=.034211;c=.97998;null==c&&(c=0);null==b&&
(b=0);var O=new T(b,c,0,1);b=.503098;c=-.308878;null==c&&(c=0);null==b&&(b=0);var P=new T(b,c,0,1);b=-.016205;c=-.872921;null==c&&(c=0);null==b&&(b=0);var Q=new T(b,c,0,1);b=.385784;c=-.393902;null==c&&(c=0);null==b&&(b=0);var R=new T(b,c,0,1);b=-.146886;c=-.859249;null==c&&(c=0);null==b&&(b=0);var S=new T(b,c,0,1);b=.643361;c=.164098;null==c&&(c=0);null==b&&(b=0);var U=new T(b,c,0,1);b=.634388;c=-.049471;null==c&&(c=0);null==b&&(b=0);var V=new T(b,c,0,1);b=-.688894;c=.007843;null==c&&(c=0);null==
b&&(b=0);var W=new T(b,c,0,1);b=.464034;c=-.188818;null==c&&(c=0);null==b&&(b=0);var X=new T(b,c,0,1);b=-.44084;c=.137486;null==c&&(c=0);null==b&&(b=0);var Y=new T(b,c,0,1);b=.364483;c=.511704;null==c&&(c=0);null==b&&(b=0);var Z=new T(b,c,0,1);b=.034028;c=.325968;null==c&&(c=0);null==b&&(b=0);var aa=new T(b,c,0,1);b=.099094;c=-.308023;null==c&&(c=0);null==b&&(b=0);var ba=new T(b,c,0,1);b=.69396;c=-.366253;null==c&&(c=0);null==b&&(b=0);var ca=new T(b,c,0,1);b=.678884;c=-.204688;null==c&&(c=0);null==
b&&(b=0);var da=new T(b,c,0,1);b=.001801;c=.780328;null==c&&(c=0);null==b&&(b=0);var ea=new T(b,c,0,1);b=.145177;c=-.898984;null==c&&(c=0);null==b&&(b=0);var fa=new T(b,c,0,1);b=.062655;c=-.611866;null==c&&(c=0);null==b&&(b=0);var ha=new T(b,c,0,1);b=.315226;c=-.604297;null==c&&(c=0);null==b&&(b=0);var ia=new T(b,c,0,1);b=-.780145;c=.486251;null==c&&(c=0);null==b&&(b=0);var ja=new T(b,c,0,1);b=-.371868;c=.882138;null==c&&(c=0);null==b&&(b=0);var ka=new T(b,c,0,1);b=.200476;c=.49443;null==c&&(c=0);
null==b&&(b=0);var la=new T(b,c,0,1);b=-.494552;c=-.711051;null==c&&(c=0);null==b&&(b=0);var ma=new T(b,c,0,1);b=.612476;c=.705252;null==c&&(c=0);null==b&&(b=0);var na=new T(b,c,0,1);b=-.578845;c=-.768792;null==c&&(c=0);null==b&&(b=0);var oa=new T(b,c,0,1);b=-.772454;c=-.090976;null==c&&(c=0);null==b&&(b=0);var pa=new T(b,c,0,1);b=.50444;c=.372295;null==c&&(c=0);null==b&&(b=0);var qa=new T(b,c,0,1);b=.155736;c=.065157;null==c&&(c=0);null==b&&(b=0);var ra=new T(b,c,0,1);b=.391522;c=.849605;null==c&&
(c=0);null==b&&(b=0);var sa=new T(b,c,0,1);b=-.620106;c=-.328104;null==c&&(c=0);null==b&&(b=0);var ta=new T(b,c,0,1);b=.789239;c=-.419965;null==c&&(c=0);null==b&&(b=0);var ua=new T(b,c,0,1);b=-.545396;c=.538133;null==c&&(c=0);null==b&&(b=0);var va=new T(b,c,0,1);b=-.178564;c=-.596057;null==c&&(c=0);null==b&&(b=0);b=[d,e,f,g,h,k,l,m,p,t,n,r,q,u,v,w,x,z,A,B,C,D,E,F,H,I,J,K,M,L,N,O,P,Q,R,S,U,V,W,X,Y,Z,aa,ba,ca,da,ea,fa,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,new T(b,c,0,1)];break;default:b=-.942,
c=-.399,null==c&&(c=0),null==b&&(b=0),d=new T(b,c,0,1),b=.945,c=-.768,null==c&&(c=0),null==b&&(b=0),e=new T(b,c,0,1),b=-.094,c=-.929,null==c&&(c=0),null==b&&(b=0),f=new T(b,c,0,1),b=.344,c=.293,null==c&&(c=0),null==b&&(b=0),b=[d,e,f,new T(b,c,0,1)]}this.poissonDisk__=b;this.constModified=!0;this.PCF_SAMPLES__=this.poissonDisk__.length;return a},get_enable:function(){return this.enable__},set_enable:function(a){this.constModified=!0;return this.enable__=a},get_USE_ESM:function(){return this.USE_ESM__},
set_USE_ESM:function(a){this.constModified=!0;return this.USE_ESM__=a},get_shadowPower:function(){return this.shadowPower__},set_shadowPower:function(a){return this.shadowPower__=a},get_USE_PCF:function(){return this.USE_PCF__},set_USE_PCF:function(a){this.constModified=!0;return this.USE_PCF__=a},get_PCF_SAMPLES:function(){return this.PCF_SAMPLES__},set_PCF_SAMPLES:function(a){this.constModified=!0;return this.PCF_SAMPLES__=a},get_pcfScale:function(){return this.pcfScale__},set_pcfScale:function(a){return this.pcfScale__=
a},get_shadowRes:function(){return this.shadowRes__},set_shadowRes:function(a){return this.shadowRes__=a},get_shadowMap:function(){return this.shadowMap__},set_shadowMap:function(a){this.constModified=!0;return this.shadowMap__=a},get_shadowMapChannel:function(){return this.shadowMapChannel__},set_shadowMapChannel:function(a){this.constModified=!0;return this.shadowMapChannel__=a},get_shadowProj:function(){return this.shadowProj__},set_shadowProj:function(a){return this.shadowProj__=a},get_shadowBias:function(){return this.shadowBias__},
set_shadowBias:function(a){return this.shadowBias__=a},get_poissonDisk:function(){return this.poissonDisk__},set_poissonDisk:function(a){return this.poissonDisk__=a},updateConstants:function(a){this.constBits=0;this.enable__&&(this.constBits|=1);this.USE_ESM__&&(this.constBits|=2);this.USE_PCF__&&(this.constBits|=4);var b=this.PCF_SAMPLES__;if(0!=b>>>8)throw u.thrown("PCF_SAMPLES is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b<<3;if(null==this.shadowMap__)this.shadowMapChannel__=
hb.Unknown;else if(this.shadowMapChannel__==hb.Unknown)if(this.shadowMap__.format==Y.nativeFormat)this.shadowMapChannel__=hb.PackedFloat;else throw u.thrown("shadowMapChannel is not set");this.constBits|=(a.allocChannelID(this.shadowMap__)<<3|this.shadowMapChannel__._hx_index)<<11;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.enable__;case 1:return this.USE_ESM__;case 2:return this.shadowPower__;case 3:return this.USE_PCF__;case 4:return this.PCF_SAMPLES__;case 5:return this.pcfScale__;
case 6:return this.shadowRes__;case 7:return this.shadowMap__;case 8:return this.shadowProj__;case 9:return this.shadowBias__;case 10:return this.poissonDisk__}return null},getParamFloatValue:function(a){switch(a){case 2:return this.shadowPower__;case 4:return this.PCF_SAMPLES__;case 5:return this.pcfScale__;case 9:return this.shadowBias__}return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.enable__=b;break;case 1:this.USE_ESM__=b;break;case 2:this.shadowPower__=b;break;case 3:this.USE_PCF__=
b;break;case 4:this.PCF_SAMPLES__=b;break;case 5:this.pcfScale__=b;break;case 6:this.shadowRes__=b;break;case 7:this.shadowMap__=b;break;case 8:this.shadowProj__=b;break;case 9:this.shadowBias__=b;break;case 10:this.poissonDisk__=b}},setParamIndexFloatValue:function(a,b){switch(a){case 2:this.shadowPower__=b;break;case 5:this.pcfScale__=b;break;case 9:this.shadowBias__=b}},clone:function(){var a=Object.create(oe.prototype);a.shader=this.shader;a.enable__=this.enable__;a.USE_ESM__=this.USE_ESM__;a.shadowPower__=
this.shadowPower__;a.USE_PCF__=this.USE_PCF__;a.PCF_SAMPLES__=this.PCF_SAMPLES__;a.pcfScale__=this.pcfScale__;a.shadowRes__=this.shadowRes__;a.shadowMap__=this.shadowMap__;a.shadowProj__=this.shadowProj__;a.shadowBias__=this.shadowBias__;a.poissonDisk__=this.poissonDisk__;return a},__class__:oe});var Oe=function(){this.color__=new T(0,0,0,1);this.mode__=0;Xa.call(this)};z["h3d.shader.GenTexture"]=Oe;Oe.__name__="h3d.shader.GenTexture";Oe.__super__=Xa;Oe.prototype=J(Xa.prototype,{get_mode:function(){return this.mode__},
set_mode:function(a){this.constModified=!0;return this.mode__=a},get_color:function(){return this.color__},set_color:function(a){return this.color__=a},updateConstants:function(a){this.constBits=0;var b=this.mode__;if(0!=b>>>8)throw u.thrown("mode is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.mode__;case 2:return this.color__}return null},getParamFloatValue:function(a){switch(a){case 0:return this.flipY__;
case 1:return this.mode__}return 0},clone:function(){var a=Object.create(Oe.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.mode__=this.mode__;a.color__=this.color__;return a},__class__:Oe});var Ue=function(a,b){null==b&&(b=1);null==a&&(a=1.5);this.lengthScale__=this.width__=0;ka.call(this);this.width__=a;this.lengthScale__=b};z["h3d.shader.LineShader"]=Ue;Ue.__name__="h3d.shader.LineShader";Ue.__super__=ka;Ue.prototype=J(ka.prototype,{get_lengthScale:function(){return this.lengthScale__},
set_lengthScale:function(a){return this.lengthScale__=a},get_width:function(){return this.width__},set_width:function(a){return this.width__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.lengthScale__;case 1:return this.width__}return null},getParamFloatValue:function(a){switch(a){case 0:return this.lengthScale__;case 1:return this.width__}return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.lengthScale__=
b;break;case 1:this.width__=b}},setParamIndexFloatValue:function(a,b){switch(a){case 0:this.lengthScale__=b;break;case 1:this.width__=b}},clone:function(){var a=Object.create(Ue.prototype);a.shader=this.shader;a.lengthScale__=this.lengthScale__;a.width__=this.width__;return a},__class__:Ue});var Se=function(){Xa.call(this)};z["h3d.shader.MinMaxShader"]=Se;Se.__name__="h3d.shader.MinMaxShader";Se.__super__=Xa;Se.prototype=J(Xa.prototype,{get_texA:function(){return this.texA__},set_texA:function(a){return this.texA__=
a},get_texB:function(){return this.texB__},set_texB:function(a){return this.texB__=a},get_isMax:function(){return this.isMax__},set_isMax:function(a){this.constModified=!0;return this.isMax__=a},updateConstants:function(a){this.constBits=0;this.isMax__&&(this.constBits|=1);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.texA__;case 2:return this.texB__;case 3:return this.isMax__}return null},getParamFloatValue:function(a){return 0==a?
this.flipY__:0},clone:function(){var a=Object.create(Se.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.texA__=this.texA__;a.texB__=this.texB__;a.isMax__=this.isMax__;return a},__class__:Se});var Ef=function(){this.mat__=new ma;Xa.call(this)};z["h3d.shader.CubeMinMaxShader"]=Ef;Ef.__name__="h3d.shader.CubeMinMaxShader";Ef.__super__=Xa;Ef.prototype=J(Xa.prototype,{get_texA:function(){return this.texA__},set_texA:function(a){return this.texA__=a},get_texB:function(){return this.texB__},set_texB:function(a){return this.texB__=
a},get_isMax:function(){return this.isMax__},set_isMax:function(a){this.constModified=!0;return this.isMax__=a},get_mat:function(){return this.mat__},set_mat:function(a){return this.mat__=a},updateConstants:function(a){this.constBits=0;this.isMax__&&(this.constBits|=1);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.flipY__;case 1:return this.texA__;case 2:return this.texB__;case 3:return this.isMax__;case 4:return this.mat__}return null},getParamFloatValue:function(a){return 0==
a?this.flipY__:0},clone:function(){var a=Object.create(Ef.prototype);a.shader=this.shader;a.flipY__=this.flipY__;a.texA__=this.texA__;a.texB__=this.texB__;a.isMax__=this.isMax__;a.mat__=this.mat__;return a},__class__:Ef});var ef=function(a){ka.call(this);this.texture__=a};z["h3d.shader.NormalMap"]=ef;ef.__name__="h3d.shader.NormalMap";ef.__super__=ka;ef.prototype=J(ka.prototype,{get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},updateConstants:function(a){this.constBits=
0;this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.texture__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.texture__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(ef.prototype);a.shader=this.shader;a.texture__=this.texture__;return a},__class__:ef});var zf=function(){ka.call(this)};z["h3d.shader.Shadow"]=zf;zf.__name__="h3d.shader.Shadow";zf.__super__=ka;zf.prototype=J(ka.prototype,{updateConstants:function(a){this.constBits=
0;this.updateConstantsFinal(a)},getParamValue:function(a){return null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){},setParamIndexFloatValue:function(a,b){},__class__:zf});var Cd=function(){this.smoothing__=.041666666666666664;this.alphaCutoff__=.5;this.autoSmoothing__=!1;this.channel__=0;ka.call(this)};z["h3d.shader.SignedDistanceField"]=Cd;Cd.__name__="h3d.shader.SignedDistanceField";Cd.__super__=ka;Cd.prototype=J(ka.prototype,{get_channel:function(){return this.channel__},
set_channel:function(a){this.constModified=!0;return this.channel__=a},get_autoSmoothing:function(){return this.autoSmoothing__},set_autoSmoothing:function(a){this.constModified=!0;return this.autoSmoothing__=a},get_alphaCutoff:function(){return this.alphaCutoff__},set_alphaCutoff:function(a){return this.alphaCutoff__=a},get_smoothing:function(){return this.smoothing__},set_smoothing:function(a){return this.smoothing__=a},updateConstants:function(a){this.constBits=0;var b=this.channel__;if(0!=b>>>
8)throw u.thrown("channel is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.autoSmoothing__&&(this.constBits|=256);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.channel__;case 1:return this.autoSmoothing__;case 2:return this.alphaCutoff__;case 3:return this.smoothing__}return null},getParamFloatValue:function(a){switch(a){case 0:return this.channel__;case 2:return this.alphaCutoff__;case 3:return this.smoothing__}return 0},
setParamIndexValue:function(a,b){switch(a){case 0:this.channel__=b;break;case 1:this.autoSmoothing__=b;break;case 2:this.alphaCutoff__=b;break;case 3:this.smoothing__=b}},setParamIndexFloatValue:function(a,b){switch(a){case 2:this.alphaCutoff__=b;break;case 3:this.smoothing__=b}},clone:function(){var a=Object.create(Cd.prototype);a.shader=this.shader;a.channel__=this.channel__;a.autoSmoothing__=this.autoSmoothing__;a.alphaCutoff__=this.alphaCutoff__;a.smoothing__=this.smoothing__;return a},__class__:Cd});
var tg=function(){ka.call(this)};z["h3d.shader.Utils"]=tg;tg.__name__="h3d.shader.Utils";tg.__super__=ka;tg.prototype=J(ka.prototype,{updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){},setParamIndexFloatValue:function(a,b){},__class__:tg});var yd=function(){this.prevBonesMatrixes__=[];this.bonesMatrixes__=[];this.fourBonesByVertex__=this.calcPrevPos__=!1;this.MaxBones__=
0;ka.call(this);this.constModified=!0;this.MaxBones__=34};z["h3d.shader.SkinBase"]=yd;yd.__name__="h3d.shader.SkinBase";yd.__super__=ka;yd.prototype=J(ka.prototype,{get_MaxBones:function(){return this.MaxBones__},set_MaxBones:function(a){this.constModified=!0;return this.MaxBones__=a},get_fourBonesByVertex:function(){return this.fourBonesByVertex__},set_fourBonesByVertex:function(a){this.constModified=!0;return this.fourBonesByVertex__=a},get_calcPrevPos:function(){return this.calcPrevPos__},set_calcPrevPos:function(a){this.constModified=
!0;return this.calcPrevPos__=a},get_bonesMatrixes:function(){return this.bonesMatrixes__},set_bonesMatrixes:function(a){return this.bonesMatrixes__=a},get_prevBonesMatrixes:function(){return this.prevBonesMatrixes__},set_prevBonesMatrixes:function(a){return this.prevBonesMatrixes__=a},updateConstants:function(a){this.constBits=0;var b=this.MaxBones__;if(0!=b>>>8)throw u.thrown("MaxBones is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.fourBonesByVertex__&&(this.constBits|=
256);this.calcPrevPos__&&(this.constBits|=512);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.MaxBones__;case 1:return this.fourBonesByVertex__;case 2:return this.calcPrevPos__;case 3:return this.bonesMatrixes__;case 4:return this.prevBonesMatrixes__}return null},getParamFloatValue:function(a){return 0==a?this.MaxBones__:0},setParamIndexValue:function(a,b){switch(a){case 0:this.MaxBones__=b;break;case 1:this.fourBonesByVertex__=b;break;case 2:this.calcPrevPos__=
b;break;case 3:this.bonesMatrixes__=b;break;case 4:this.prevBonesMatrixes__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(yd.prototype);a.shader=this.shader;a.MaxBones__=this.MaxBones__;a.fourBonesByVertex__=this.fourBonesByVertex__;a.calcPrevPos__=this.calcPrevPos__;a.bonesMatrixes__=this.bonesMatrixes__;a.prevBonesMatrixes__=this.prevBonesMatrixes__;return a},__class__:yd});var Ve=function(){yd.call(this)};z["h3d.shader.Skin"]=Ve;Ve.__name__="h3d.shader.Skin";
Ve.__super__=yd;Ve.prototype=J(yd.prototype,{updateConstants:function(a){this.constBits=0;var b=this.MaxBones__;if(0!=b>>>8)throw u.thrown("MaxBones is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.fourBonesByVertex__&&(this.constBits|=256);this.calcPrevPos__&&(this.constBits|=512);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.MaxBones__;case 1:return this.fourBonesByVertex__;case 2:return this.calcPrevPos__;case 3:return this.bonesMatrixes__;
case 4:return this.prevBonesMatrixes__}return null},getParamFloatValue:function(a){return 0==a?this.MaxBones__:0},clone:function(){var a=Object.create(Ve.prototype);a.shader=this.shader;a.MaxBones__=this.MaxBones__;a.fourBonesByVertex__=this.fourBonesByVertex__;a.calcPrevPos__=this.calcPrevPos__;a.bonesMatrixes__=this.bonesMatrixes__;a.prevBonesMatrixes__=this.prevBonesMatrixes__;return a},__class__:Ve});var hf=function(){yd.call(this)};z["h3d.shader.SkinTangent"]=hf;hf.__name__="h3d.shader.SkinTangent";
hf.__super__=yd;hf.prototype=J(yd.prototype,{updateConstants:function(a){this.constBits=0;var b=this.MaxBones__;if(0!=b>>>8)throw u.thrown("MaxBones is out of range "+b+">255, consider using @const(MAX_VALUE)");this.constBits|=b;this.fourBonesByVertex__&&(this.constBits|=256);this.calcPrevPos__&&(this.constBits|=512);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.MaxBones__;case 1:return this.fourBonesByVertex__;case 2:return this.calcPrevPos__;case 3:return this.bonesMatrixes__;
case 4:return this.prevBonesMatrixes__}return null},getParamFloatValue:function(a){return 0==a?this.MaxBones__:0},clone:function(){var a=Object.create(hf.prototype);a.shader=this.shader;a.MaxBones__=this.MaxBones__;a.fourBonesByVertex__=this.fourBonesByVertex__;a.calcPrevPos__=this.calcPrevPos__;a.bonesMatrixes__=this.bonesMatrixes__;a.prevBonesMatrixes__=this.prevBonesMatrixes__;return a},__class__:hf});var Hd=function(a){ka.call(this);this.texture__=a};z["h3d.shader.SpecularTexture"]=Hd;Hd.__name__=
"h3d.shader.SpecularTexture";Hd.__super__=ka;Hd.prototype=J(ka.prototype,{get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.texture__:null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){0==a&&(this.texture__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Hd.prototype);a.shader=
this.shader;a.texture__=this.texture__;return a},__class__:Hd});var Ne=function(a){this.killAlphaThreshold__=0;ka.call(this);this.texture__=a;this.killAlphaThreshold__=ad.defaultKillAlphaThreshold};z["h3d.shader.Texture"]=Ne;Ne.__name__="h3d.shader.Texture";Ne.__super__=ka;Ne.prototype=J(ka.prototype,{get_additive:function(){return this.additive__},set_additive:function(a){this.constModified=!0;return this.additive__=a},get_killAlpha:function(){return this.killAlpha__},set_killAlpha:function(a){this.constModified=
!0;return this.killAlpha__=a},get_specularAlpha:function(){return this.specularAlpha__},set_specularAlpha:function(a){this.constModified=!0;return this.specularAlpha__=a},get_killAlphaThreshold:function(){return this.killAlphaThreshold__},set_killAlphaThreshold:function(a){return this.killAlphaThreshold__=a},get_texture:function(){return this.texture__},set_texture:function(a){return this.texture__=a},updateConstants:function(a){this.constBits=0;this.additive__&&(this.constBits|=1);this.killAlpha__&&
(this.constBits|=2);this.specularAlpha__&&(this.constBits|=4);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.additive__;case 1:return this.killAlpha__;case 2:return this.specularAlpha__;case 3:return this.killAlphaThreshold__;case 4:return this.texture__}return null},getParamFloatValue:function(a){return 3==a?this.killAlphaThreshold__:0},setParamIndexValue:function(a,b){switch(a){case 0:this.additive__=b;break;case 1:this.killAlpha__=b;break;case 2:this.specularAlpha__=
b;break;case 3:this.killAlphaThreshold__=b;break;case 4:this.texture__=b}},setParamIndexFloatValue:function(a,b){3==a&&(this.killAlphaThreshold__=b)},clone:function(){var a=Object.create(Ne.prototype);a.shader=this.shader;a.additive__=this.additive__;a.killAlpha__=this.killAlpha__;a.specularAlpha__=this.specularAlpha__;a.killAlphaThreshold__=this.killAlphaThreshold__;a.texture__=this.texture__;return a},__class__:Ne});var Md=function(a,b,c,d){null==d&&(d=1);null==c&&(c=1);null==b&&(b=0);null==a&&
(a=0);this.uvScale__=new I(0,0,0);this.uvDelta__=new I(0,0,0);ka.call(this);var e=this.uvDelta__;null==b&&(b=0);null==a&&(a=0);e.x=a;e.y=b;e.z=0;e=this.uvScale__;a=c;b=d;null==b&&(b=0);null==a&&(a=0);e.x=a;e.y=b;e.z=0};z["h3d.shader.UVDelta"]=Md;Md.__name__="h3d.shader.UVDelta";Md.__super__=ka;Md.prototype=J(ka.prototype,{get_uvDelta:function(){return this.uvDelta__},set_uvDelta:function(a){return this.uvDelta__=a},get_uvScale:function(){return this.uvScale__},set_uvScale:function(a){return this.uvScale__=
a},updateConstants:function(a){this.constBits=0;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.uvDelta__;case 1:return this.uvScale__}return null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.uvDelta__=b;break;case 1:this.uvScale__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(Md.prototype);a.shader=this.shader;a.uvDelta__=this.uvDelta__;a.uvScale__=this.uvScale__;return a},
__class__:Md});var qe=function(){ka.call(this)};z["h3d.shader.VertexColorAlpha"]=qe;qe.__name__="h3d.shader.VertexColorAlpha";qe.__super__=ka;qe.prototype=J(ka.prototype,{get_additive:function(){return this.additive__},set_additive:function(a){this.constModified=!0;return this.additive__=a},updateConstants:function(a){this.constBits=0;this.additive__&&(this.constBits|=1);this.updateConstantsFinal(a)},getParamValue:function(a){return 0==a?this.additive__:null},getParamFloatValue:function(a){return 0},
setParamIndexValue:function(a,b){0==a&&(this.additive__=b)},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(qe.prototype);a.shader=this.shader;a.additive__=this.additive__;return a},__class__:qe});var df=function(a,b){this.isCentered__=!0;this.tangent__=new I(0,0,0);this.normal__=new I(0,0,0);this.scale__=new I(0,0,0);ka.call(this);var c=this.normal__,d=0,e=0,f=1;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c=this.tangent__;d=1;f=e=0;null==f&&(f=0);null==
e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=f;c=this.scale__;d=1/a;e=1/b;null==e&&(e=0);null==d&&(d=0);c.x=d;c.y=e;c.z=0};z["h3d.shader.VolumeDecal"]=df;df.__name__="h3d.shader.VolumeDecal";df.__super__=ka;df.prototype=J(ka.prototype,{get_scale:function(){return this.scale__},set_scale:function(a){return this.scale__=a},get_normal:function(){return this.normal__},set_normal:function(a){return this.normal__=a},get_tangent:function(){return this.tangent__},set_tangent:function(a){return this.tangent__=
a},get_isCentered:function(){return this.isCentered__},set_isCentered:function(a){this.constModified=!0;return this.isCentered__=a},updateConstants:function(a){this.constBits=0;this.isCentered__&&(this.constBits|=64);this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.scale__;case 1:return this.normal__;case 2:return this.tangent__;case 3:return this.isCentered__}return null},getParamFloatValue:function(a){return 0},setParamIndexValue:function(a,b){switch(a){case 0:this.scale__=
b;break;case 1:this.normal__=b;break;case 2:this.tangent__=b;break;case 3:this.isCentered__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(df.prototype);a.shader=this.shader;a.scale__=this.scale__;a.normal__=this.normal__;a.tangent__=this.tangent__;a.isCentered__=this.isCentered__;return a},__class__:df});var ed=L["haxe.StackItem"]={__ename__:!0,__constructs__:null,CFunction:{_hx_name:"CFunction",_hx_index:0,__enum__:"haxe.StackItem",toString:v},Module:(A=function(a){return{_hx_index:1,
m:a,__enum__:"haxe.StackItem",toString:v}},A._hx_name="Module",A.__params__=["m"],A),FilePos:(A=function(a,b,c,d){return{_hx_index:2,s:a,file:b,line:c,column:d,__enum__:"haxe.StackItem",toString:v}},A._hx_name="FilePos",A.__params__=["s","file","line","column"],A),Method:(A=function(a,b){return{_hx_index:3,classname:a,method:b,__enum__:"haxe.StackItem",toString:v}},A._hx_name="Method",A.__params__=["classname","method"],A),LocalFunction:(A=function(a){return{_hx_index:4,v:a,__enum__:"haxe.StackItem",
toString:v}},A._hx_name="LocalFunction",A.__params__=["v"],A)};ed.__constructs__=[ed.CFunction,ed.Module,ed.FilePos,ed.Method,ed.LocalFunction];ed.__empty_constructs__=[ed.CFunction];var Yj={callStack:function(){return Vb.toHaxe(Vb.callStack())}},jf=function(){};z["haxe.IMap"]=jf;jf.__name__="haxe.IMap";jf.__isInterface__=!0;jf.prototype={__class__:jf};var Jd=function(){};z["haxe.EntryPoint"]=Jd;Jd.__name__="haxe.EntryPoint";Jd.processEvents=function(){for(;;){var a=Jd.pending.shift();if(null==a)break;
a()}a=xc.tick();return xc.hasEvents()||0!=Jd.threadCount?a:-1};Jd.run=function(){var a=Jd.processEvents();if("undefined"!=typeof window){var b=window;b=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame;null!=b?b(Jd.run):0<=a&&setTimeout(Jd.run,1E3*a)}else 0<=a&&setTimeout(Jd.run,1E3*a)};var Tj={from:function(a){a=1<<a._hx_index;null==a&&(a=0);return a}},u=function(a,b,c){Error.call(this,a);this.message=a;this.__previousException=b;this.__nativeException=null!=c?c:
this};z["haxe.Exception"]=u;u.__name__="haxe.Exception";u.caught=function(a){return a instanceof u?a:a instanceof Error?new u(a.message,null,a):new ug(a,null,a)};u.thrown=function(a){return a instanceof u?a.get_native():a instanceof Error?a:new ug(a)};u.__super__=Error;u.prototype=J(Error.prototype,{unwrap:function(){return this.__nativeException},toString:function(){return this.get_message()},get_message:function(){return this.message},get_native:function(){return this.__nativeException},__class__:u});
var qh=function(a,b){this.high=a;this.low=b};z["haxe._Int64.___Int64"]=qh;qh.__name__="haxe._Int64.___Int64";qh.prototype={__class__:qh};var Ka=function(){};z["haxe.Log"]=Ka;Ka.__name__="haxe.Log";Ka.formatOutput=function(a,b){var c=w.string(a);if(null==b)return c;var d=b.fileName+":"+b.lineNumber;if(null!=b.customParams){var e=0;for(b=b.customParams;e<b.length;)a=b[e],++e,c+=", "+w.string(a)}return d+": "+c};Ka.trace=function(a,b){a=Ka.formatOutput(a,b);"undefined"!=typeof console&&null!=console.log&&
console.log(a)};var Ci=function(a,b){this.isBlocking=!0;this.f=a;this.priority=b;this.nextRun=-Infinity};z["haxe.MainEvent"]=Ci;Ci.__name__="haxe.MainEvent";Ci.prototype={stop:function(){null!=this.f&&(this.f=null,this.nextRun=-Infinity,null==this.prev?xc.pending=this.next:this.prev.next=this.next,null!=this.next&&(this.next.prev=this.prev))},__class__:Ci};var xc=function(){};z["haxe.MainLoop"]=xc;xc.__name__="haxe.MainLoop";xc.hasEvents=function(){for(var a=xc.pending;null!=a;){if(a.isBlocking)return!0;
a=a.next}return!1};xc.add=function(a,b){null==b&&(b=0);if(null==a)throw u.thrown("Event function is null");a=new Ci(a,b);b=xc.pending;null!=b&&(b.prev=a);a.next=b;return xc.pending=a};xc.sortEvents=function(){var a=xc.pending;if(null!=a){for(var b=1,c,d,e,f,g,h,k;;){f=a;k=a=null;for(c=0;null!=f;){++c;g=f;e=d=0;for(h=b;e<h&&(e++,++d,g=g.next,null!=g););for(e=b;0<d||0<e&&null!=g;)0==d?(h=g,g=g.next,--e):0==e||null==g||f.priority>g.priority||f.priority==g.priority&&f.nextRun<=g.nextRun?(h=f,f=f.next,
--d):(h=g,g=g.next,--e),null!=k?k.next=h:a=h,h.prev=k,k=h;f=g}k.next=null;if(1>=c)break;b*=2}a.prev=null;xc.pending=a}};xc.tick=function(){xc.sortEvents();for(var a=xc.pending,b=D.now()/1E3,c=1E9;null!=a;){var d=a.next,e=a.nextRun-b;0>=e?(c=0,null!=a.f&&a.f()):c>e&&(c=e);a=d}return c};var Vb=function(){};z["haxe.NativeStackTrace"]=Vb;Vb.__name__="haxe.NativeStackTrace";Vb.callStack=function(){var a=Error(""),b=Vb.tryHaxeStack(a);if("undefined"==typeof b){try{throw a;}catch(c){}b=a.stack}return Vb.normalize(b,
2)};Vb.toHaxe=function(a,b){null==b&&(b=0);if(null==a)return[];if("string"==typeof a){a=a.split("\n");"Error"==a[0]&&a.shift();for(var c=[],d=0,e=a.length;d<e;){var f=d++;if(!(b>f)){var g=a[f];f=g.match(/^    at ([$A-Za-z0-9_. ]+) \(([^)]+):([0-9]+):([0-9]+)\)$/);if(null!=f){g=f[1].split(".");"$hxClasses"==g[0]&&g.shift();var h=g.pop(),k=f[2],l=w.parseInt(f[3]);f=w.parseInt(f[4]);c.push(ed.FilePos("Anonymous function"==h?ed.LocalFunction():"Global code"==h?null:ed.Method(g.join("."),h),k,l,f))}else c.push(ed.Module(aa.trim(g)))}}return c}return 0<
b&&Array.isArray(a)?a.slice(b):a};Vb.tryHaxeStack=function(a){if(null==a)return[];var b=Error.prepareStackTrace;Error.prepareStackTrace=Vb.prepareHxStackTrace;a=a.stack;Error.prepareStackTrace=b;return a};Vb.prepareHxStackTrace=function(a,b){a=[];for(var c=0;c<b.length;){var d=b[c];++c;null!=Vb.wrapCallSite&&(d=Vb.wrapCallSite(d));var e=null,f=d.getFunctionName();if(null!=f){var g=f.lastIndexOf(".");0<=g?(e=f.substring(0,g),f=f.substring(g+1),e=ed.Method(e,f)):e=ed.Method(null,f)}f=d.getFileName();
g=null==f?-1:f.indexOf("file:");null!=Vb.wrapCallSite&&0<g&&(f=f.substring(g+6));a.push(ed.FilePos(e,f,d.getLineNumber(),d.getColumnNumber()))}return a};Vb.normalize=function(a,b){null==b&&(b=0);if(Array.isArray(a)&&0<b)return a.slice(b);if("string"==typeof a){switch(a.substring(0,6)){case "Error\n":case "Error:":++b}return Vb.skipLines(a,b)}return a};Vb.skipLines=function(a,b,c){null==c&&(c=0);return 0<b?(c=a.indexOf("\n",c),0>c?"":Vb.skipLines(a,--b,c+1)):a.substring(c)};var Ad=function(a){var b=
this;this.id=setInterval(function(){b.run()},a)};z["haxe.Timer"]=Ad;Ad.__name__="haxe.Timer";Ad.delay=function(a,b){var c=new Ad(b);c.run=function(){c.stop();a()};return c};Ad.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:Ad};var rh=function(){};z["haxe._Unserializer.DefaultResolver"]=rh;rh.__name__="haxe._Unserializer.DefaultResolver";rh.prototype={resolveClass:function(a){return z[a]},resolveEnum:function(a){return L[a]},__class__:rh};
var Dc=function(a){this.buf=a;this.length=this.buf.length;this.pos=0;this.scache=[];this.cache=[];a=Dc.DEFAULT_RESOLVER;null==a&&(a=new rh,Dc.DEFAULT_RESOLVER=a);this.resolver=a};z["haxe.Unserializer"]=Dc;Dc.__name__="haxe.Unserializer";Dc.initCodes=function(){for(var a=[],b=0,c=Dc.BASE64.length;b<c;){var d=b++;a[Dc.BASE64.charCodeAt(d)]=d}return a};Dc.run=function(a){return(new Dc(a)).unserialize()};Dc.prototype={readDigits:function(){for(var a=0,b=!1,c=this.pos;;){var d=this.buf.charCodeAt(this.pos);
if(d!=d)break;if(45==d){if(this.pos!=c)break;b=!0}else{if(48>d||57<d)break;a=10*a+(d-48)}this.pos++}b&&(a*=-1);return a},readFloat:function(){for(var a=this.pos;;){var b=this.buf.charCodeAt(this.pos);if(b!=b)break;if(43<=b&&58>b||101==b||69==b)this.pos++;else break}return parseFloat(D.substr(this.buf,a,this.pos-a))},unserializeObject:function(a){for(;;){if(this.pos>=this.length)throw u.thrown("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var b=this.unserialize();if("string"!=typeof b)throw u.thrown("Invalid object key");
var c=this.unserialize();a[b]=c}this.pos++},unserializeEnum:function(a,b){if(58!=this.buf.charCodeAt(this.pos++))throw u.thrown("Invalid enum format");var c=this.readDigits();if(0==c)return la.createEnum(a,b);for(var d=[];0<c--;)d.push(this.unserialize());return la.createEnum(a,b,d)},unserialize:function(){switch(this.buf.charCodeAt(this.pos++)){case 65:var a=this.unserialize();var b=this.resolver.resolveClass(a);if(null==b)throw u.thrown("Class not found "+a);return b;case 66:a=this.unserialize();
b=this.resolver.resolveEnum(a);if(null==b)throw u.thrown("Enum not found "+a);return b;case 67:a=this.unserialize();b=this.resolver.resolveClass(a);if(null==b)throw u.thrown("Class not found "+a);b=Object.create(b.prototype);this.cache.push(b);b.hxUnserialize(this);if(103!=this.buf.charCodeAt(this.pos++))throw u.thrown("Invalid custom data");return b;case 77:a=new vc;for(this.cache.push(a);104!=this.buf.charCodeAt(this.pos);)b=this.unserialize(),a.set(b,this.unserialize());this.pos++;return a;case 82:b=
this.readDigits();if(0>b||b>=this.scache.length)throw u.thrown("Invalid string reference");return this.scache[b];case 97:a=[];for(this.cache.push(a);;){b=this.buf.charCodeAt(this.pos);if(104==b){this.pos++;break}117==b?(this.pos++,b=this.readDigits(),a[a.length+b-1]=null):a.push(this.unserialize())}return a;case 98:a=new La;for(this.cache.push(a);104!=this.buf.charCodeAt(this.pos);){b=this.unserialize();var c=this.unserialize();a.h[b]=c}this.pos++;return a;case 99:a=this.unserialize();b=this.resolver.resolveClass(a);
if(null==b)throw u.thrown("Class not found "+a);b=Object.create(b.prototype);this.cache.push(b);this.unserializeObject(b);return b;case 100:return this.readFloat();case 102:return!1;case 105:return this.readDigits();case 106:a=this.unserialize();c=this.resolver.resolveEnum(a);if(null==c)throw u.thrown("Enum not found "+a);this.pos++;for(var d=this.readDigits(),e=c.__constructs__,f=Array(e.length),g=0,h=e.length;g<h;)b=g++,f[b]=e[b]._hx_name;b=f[d];if(null==b)throw u.thrown("Unknown enum index "+a+
"@"+d);b=this.unserializeEnum(c,b);this.cache.push(b);return b;case 107:return NaN;case 108:b=new nc;for(this.cache.push(b);104!=this.buf.charCodeAt(this.pos);)b.add(this.unserialize());this.pos++;return b;case 109:return-Infinity;case 110:return null;case 111:return b={},this.cache.push(b),this.unserializeObject(b),b;case 112:return Infinity;case 113:a=new Da;this.cache.push(a);for(b=this.buf.charCodeAt(this.pos++);58==b;)b=this.readDigits(),c=this.unserialize(),a.h[b]=c,b=this.buf.charCodeAt(this.pos++);
if(104!=b)throw u.thrown("Invalid IntMap format");return a;case 114:b=this.readDigits();if(0>b||b>=this.cache.length)throw u.thrown("Invalid reference");return this.cache[b];case 115:a=this.readDigits();c=this.buf;if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<a)throw u.thrown("Invalid bytes length");d=Dc.CODES;null==d&&(d=Dc.initCodes(),Dc.CODES=d);b=this.pos;e=a&3;f=b+(a-e);g=new S(new ArrayBuffer(3*(a>>2)+(2<=e?e-1:0)));for(h=0;b<f;){var k=d[c.charCodeAt(b++)];var l=d[c.charCodeAt(b++)];
g.b[h++]=k<<2|l>>4;k=d[c.charCodeAt(b++)];g.b[h++]=l<<4|k>>2;l=d[c.charCodeAt(b++)];g.b[h++]=k<<6|l}2<=e&&(k=d[c.charCodeAt(b++)],l=d[c.charCodeAt(b++)],g.b[h++]=k<<2|l>>4,3==e&&(k=d[c.charCodeAt(b++)],g.b[h++]=l<<4|k>>2));this.pos+=a;this.cache.push(g);return g;case 116:return!0;case 118:return 48<=this.buf.charCodeAt(this.pos)&&57>=this.buf.charCodeAt(this.pos)&&48<=this.buf.charCodeAt(this.pos+1)&&57>=this.buf.charCodeAt(this.pos+1)&&48<=this.buf.charCodeAt(this.pos+2)&&57>=this.buf.charCodeAt(this.pos+
2)&&48<=this.buf.charCodeAt(this.pos+3)&&57>=this.buf.charCodeAt(this.pos+3)&&45==this.buf.charCodeAt(this.pos+4)?(b=D.strDate(D.substr(this.buf,this.pos,19)),this.pos+=19):b=new Date(this.readFloat()),this.cache.push(b),b;case 119:a=this.unserialize();c=this.resolver.resolveEnum(a);if(null==c)throw u.thrown("Enum not found "+a);b=this.unserializeEnum(c,this.unserialize());this.cache.push(b);return b;case 120:throw u.thrown(this.unserialize());case 121:a=this.readDigits();if(58!=this.buf.charCodeAt(this.pos++)||
this.length-this.pos<a)throw u.thrown("Invalid string length");b=D.substr(this.buf,this.pos,a);this.pos+=a;b=decodeURIComponent(b.split("+").join(" "));this.scache.push(b);return b;case 122:return 0}this.pos--;throw u.thrown("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos);},__class__:Dc};var ug=function(a,b,c){u.call(this,String(a),b,c);this.value=a};z["haxe.ValueException"]=ug;ug.__name__="haxe.ValueException";ug.__super__=u;ug.prototype=J(u.prototype,{unwrap:function(){return this.value},
__class__:ug});var Ff=function(){this.a1=1;this.a2=0};z["haxe.crypto.Adler32"]=Ff;Ff.__name__="haxe.crypto.Adler32";Ff.read=function(a){var b=new Ff,c=a.readByte(),d=a.readByte(),e=a.readByte();a=a.readByte();b.a1=e<<8|a;b.a2=c<<8|d;return b};Ff.prototype={update:function(a,b,c){var d=this.a1,e=this.a2,f=b;for(b+=c;f<b;)c=f++,d=(d+a.b[c])%65521,e=(e+d)%65521;this.a1=d;this.a2=e},equals:function(a){return a.a1==this.a1?a.a2==this.a2:!1},__class__:Ff};var S=function(a){this.length=a.byteLength;this.b=
new Uint8Array(a);this.b.bufferValue=a;a.hxBytes=this;a.bytes=this.b};z["haxe.io.Bytes"]=S;S.__name__="haxe.io.Bytes";S.ofString=function(a,b){if(b==Gf.RawNative){for(var c=new Uint8Array(a.length<<1),d=0,e=a.length;d<e;){var f=d++;b=a.charCodeAt(f);c[f<<1]=b&255;c[f<<1|1]=b>>8}return new S(c.buffer)}c=[];for(f=0;f<a.length;)b=a.charCodeAt(f++),55296<=b&&56319>=b&&(b=b-55232<<10|a.charCodeAt(f++)&1023),127>=b?c.push(b):(2047>=b?c.push(192|b>>6):(65535>=b?c.push(224|b>>12):(c.push(240|b>>18),c.push(128|
b>>12&63)),c.push(128|b>>6&63)),c.push(128|b&63));return new S((new Uint8Array(c)).buffer)};S.ofData=function(a){var b=a.hxBytes;return null!=b?b:new S(a)};S.prototype={blit:function(a,b,c,d){if(0>a||0>c||0>d||a+d>this.length||c+d>b.length)throw u.thrown(yb.OutsideBounds);0==c&&d==b.b.byteLength?this.b.set(b.b,a):this.b.set(b.b.subarray(c,c+d),a)},fill:function(a,b,c){for(var d=0;d<b;)d++,this.b[a++]=c},sub:function(a,b){if(0>a||0>b||a+b>this.length)throw u.thrown(yb.OutsideBounds);return new S(this.b.buffer.slice(a+
this.b.byteOffset,a+this.b.byteOffset+b))},getFloat:function(a){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));return this.data.getFloat32(a,!0)},setFloat:function(a,b){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));this.data.setFloat32(a,b,!0)},getUInt16:function(a){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));return this.data.getUint16(a,!0)},setUInt16:function(a,
b){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));this.data.setUint16(a,b,!0)},getInt32:function(a){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));return this.data.getInt32(a,!0)},setInt32:function(a,b){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength));this.data.setInt32(a,b,!0)},getString:function(a,b,c){if(0>a||0>b||a+b>this.length)throw u.thrown(yb.OutsideBounds);
null==c&&(c=Gf.UTF8);var d="",e=this.b,f=a;a+=b;switch(c._hx_index){case 0:for(;f<a;){c=e[f++];if(128>c){if(0==c)break}else if(224>c)c=(c&63)<<6|e[f++]&127;else if(240>c)b=e[f++],c=(c&31)<<12|(b&127)<<6|e[f++]&127;else{b=e[f++];var g=e[f++];c=(c&15)<<18|(b&127)<<12|(g&127)<<6|e[f++]&127}d+=String.fromCodePoint(c)}break;case 1:for(;f<a;)c=e[f++]|e[f++]<<8,d+=String.fromCodePoint(c)}return d},toString:function(){return this.getString(0,this.length)},__class__:S};var Gf=L["haxe.io.Encoding"]={__ename__:!0,
__constructs__:null,UTF8:{_hx_name:"UTF8",_hx_index:0,__enum__:"haxe.io.Encoding",toString:v},RawNative:{_hx_name:"RawNative",_hx_index:1,__enum__:"haxe.io.Encoding",toString:v}};Gf.__constructs__=[Gf.UTF8,Gf.RawNative];Gf.__empty_constructs__=[Gf.UTF8,Gf.RawNative];var Cc=function(){};z["haxe.crypto.Base64"]=Cc;Cc.__name__="haxe.crypto.Base64";Cc.encode=function(a,b){null==b&&(b=!0);var c=(new sh(Cc.BYTES)).encodeBytes(a).toString();if(b)switch(a.length%3){case 1:c+="==";break;case 2:c+="="}return c};
Cc.decode=function(a,b){null==b&&(b=!0);if(b)for(;61==D.cca(a,a.length-1);)a=D.substr(a,0,-1);return(new sh(Cc.BYTES)).decodeBytes(S.ofString(a))};var sh=function(a){for(var b=a.length,c=1;b>1<<c;)++c;if(8<c||b!=1<<c)throw u.thrown("BaseCode : base length must be a power of two.");this.base=a;this.nbits=c};z["haxe.crypto.BaseCode"]=sh;sh.__name__="haxe.crypto.BaseCode";sh.prototype={encodeBytes:function(a){for(var b=this.nbits,c=this.base,d=8*a.length/b|0,e=new S(new ArrayBuffer(d+(0==8*a.length%
b?0:1))),f=0,g=0,h=(1<<b)-1,k=0,l=0;l<d;){for(;g<b;)g+=8,f<<=8,f|=a.b[k++];g-=b;e.b[l++]=c.b[f>>g&h]}0<g&&(e.b[l++]=c.b[f<<b-g&h]);return e},initTable:function(){for(var a,b=[],c=0;256>c;)a=c++,b[a]=-1;c=0;for(var d=this.base.length;c<d;)a=c++,b[this.base.b[a]]=a;this.tbl=b},decodeBytes:function(a){var b=this.nbits;null==this.tbl&&this.initTable();for(var c=this.tbl,d=a.length*b>>3,e=new S(new ArrayBuffer(d)),f=0,g=0,h=0,k=0;k<d;){for(;8>g;){g+=b;f<<=b;var l=c[a.b[h++]];if(-1==l)throw u.thrown("BaseCode : invalid encoded char");
f|=l}g-=8;e.b[k++]=f>>g&255}return e},__class__:sh};var vd=function(){};z["haxe.crypto.Md5"]=vd;vd.__name__="haxe.crypto.Md5";vd.encode=function(a){var b=new vd;a=b.doEncode(vd.str2blks(a));return b.hex(a)};vd.str2blks=function(a){var b=S.ofString(a),c=(b.length+8>>6)+1;a=[];for(var d=0,e=16*c;d<e;){var f=d++;a[f]=0}f=0;e=b.length;for(d=8*e;f<e;)a[f>>2]|=b.b[f]<<(d+f)%4*8,++f;a[f>>2]|=128<<(d+f)%4*8;f=16*c-2;a[f]=d&255;a[f]|=(d>>>8&255)<<8;a[f]|=(d>>>16&255)<<16;a[f]|=(d>>>24&255)<<24;return a};vd.prototype=
{bitOR:function(a,b){return(a>>>1|b>>>1)<<1|a&1|b&1},bitXOR:function(a,b){return(a>>>1^b>>>1)<<1|a&1^b&1},bitAND:function(a,b){return(a>>>1&b>>>1)<<1|a&1&b&1},addme:function(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535},hex:function(a){for(var b="",c=0;c<a.length;){var d=a[c];++c;b+="0123456789abcdef".charAt(d>>4&15)+"0123456789abcdef".charAt(d&15);b+="0123456789abcdef".charAt(d>>12&15)+"0123456789abcdef".charAt(d>>8&15);b+="0123456789abcdef".charAt(d>>20&15)+"0123456789abcdef".charAt(d>>
16&15);b+="0123456789abcdef".charAt(d>>28&15)+"0123456789abcdef".charAt(d>>24&15)}return b},rol:function(a,b){return a<<b|a>>>32-b},cmn:function(a,b,c,d,e,f){return this.addme(this.rol(this.addme(this.addme(b,a),this.addme(d,f)),e),c)},ff:function(a,b,c,d,e,f,g){return this.cmn(this.bitOR(this.bitAND(b,c),this.bitAND(~b,d)),a,b,e,f,g)},gg:function(a,b,c,d,e,f,g){return this.cmn(this.bitOR(this.bitAND(b,d),this.bitAND(c,~d)),a,b,e,f,g)},hh:function(a,b,c,d,e,f,g){return this.cmn(this.bitXOR(this.bitXOR(b,
c),d),a,b,e,f,g)},ii:function(a,b,c,d,e,f,g){return this.cmn(this.bitXOR(c,this.bitOR(b,~d)),a,b,e,f,g)},doEncode:function(a){for(var b=1732584193,c=-271733879,d=-1732584194,e=271733878,f=0;f<a.length;){var g=b,h=c,k=d,l=e;b=this.ff(b,c,d,e,a[f],7,-680876936);e=this.ff(e,b,c,d,a[f+1],12,-389564586);d=this.ff(d,e,b,c,a[f+2],17,606105819);c=this.ff(c,d,e,b,a[f+3],22,-1044525330);b=this.ff(b,c,d,e,a[f+4],7,-176418897);e=this.ff(e,b,c,d,a[f+5],12,1200080426);d=this.ff(d,e,b,c,a[f+6],17,-1473231341);c=
this.ff(c,d,e,b,a[f+7],22,-45705983);b=this.ff(b,c,d,e,a[f+8],7,1770035416);e=this.ff(e,b,c,d,a[f+9],12,-1958414417);d=this.ff(d,e,b,c,a[f+10],17,-42063);c=this.ff(c,d,e,b,a[f+11],22,-1990404162);b=this.ff(b,c,d,e,a[f+12],7,1804603682);e=this.ff(e,b,c,d,a[f+13],12,-40341101);d=this.ff(d,e,b,c,a[f+14],17,-1502002290);c=this.ff(c,d,e,b,a[f+15],22,1236535329);b=this.gg(b,c,d,e,a[f+1],5,-165796510);e=this.gg(e,b,c,d,a[f+6],9,-1069501632);d=this.gg(d,e,b,c,a[f+11],14,643717713);c=this.gg(c,d,e,b,a[f],
20,-373897302);b=this.gg(b,c,d,e,a[f+5],5,-701558691);e=this.gg(e,b,c,d,a[f+10],9,38016083);d=this.gg(d,e,b,c,a[f+15],14,-660478335);c=this.gg(c,d,e,b,a[f+4],20,-405537848);b=this.gg(b,c,d,e,a[f+9],5,568446438);e=this.gg(e,b,c,d,a[f+14],9,-1019803690);d=this.gg(d,e,b,c,a[f+3],14,-187363961);c=this.gg(c,d,e,b,a[f+8],20,1163531501);b=this.gg(b,c,d,e,a[f+13],5,-1444681467);e=this.gg(e,b,c,d,a[f+2],9,-51403784);d=this.gg(d,e,b,c,a[f+7],14,1735328473);c=this.gg(c,d,e,b,a[f+12],20,-1926607734);b=this.hh(b,
c,d,e,a[f+5],4,-378558);e=this.hh(e,b,c,d,a[f+8],11,-2022574463);d=this.hh(d,e,b,c,a[f+11],16,1839030562);c=this.hh(c,d,e,b,a[f+14],23,-35309556);b=this.hh(b,c,d,e,a[f+1],4,-1530992060);e=this.hh(e,b,c,d,a[f+4],11,1272893353);d=this.hh(d,e,b,c,a[f+7],16,-155497632);c=this.hh(c,d,e,b,a[f+10],23,-1094730640);b=this.hh(b,c,d,e,a[f+13],4,681279174);e=this.hh(e,b,c,d,a[f],11,-358537222);d=this.hh(d,e,b,c,a[f+3],16,-722521979);c=this.hh(c,d,e,b,a[f+6],23,76029189);b=this.hh(b,c,d,e,a[f+9],4,-640364487);
e=this.hh(e,b,c,d,a[f+12],11,-421815835);d=this.hh(d,e,b,c,a[f+15],16,530742520);c=this.hh(c,d,e,b,a[f+2],23,-995338651);b=this.ii(b,c,d,e,a[f],6,-198630844);e=this.ii(e,b,c,d,a[f+7],10,1126891415);d=this.ii(d,e,b,c,a[f+14],15,-1416354905);c=this.ii(c,d,e,b,a[f+5],21,-57434055);b=this.ii(b,c,d,e,a[f+12],6,1700485571);e=this.ii(e,b,c,d,a[f+3],10,-1894986606);d=this.ii(d,e,b,c,a[f+10],15,-1051523);c=this.ii(c,d,e,b,a[f+1],21,-2054922799);b=this.ii(b,c,d,e,a[f+8],6,1873313359);e=this.ii(e,b,c,d,a[f+
15],10,-30611744);d=this.ii(d,e,b,c,a[f+6],15,-1560198380);c=this.ii(c,d,e,b,a[f+13],21,1309151649);b=this.ii(b,c,d,e,a[f+4],6,-145523070);e=this.ii(e,b,c,d,a[f+11],10,-1120210379);d=this.ii(d,e,b,c,a[f+2],15,718787259);c=this.ii(c,d,e,b,a[f+9],21,-343485551);b=this.addme(b,g);c=this.addme(c,h);d=this.addme(d,k);e=this.addme(e,l);f+=16}return[b,c,d,e]},__class__:vd};var xb=function(){};z["haxe.ds.ArraySort"]=xb;xb.__name__="haxe.ds.ArraySort";xb.sort=function(a,b){xb.rec(a,b,0,a.length)};xb.rec=function(a,
b,c,d){var e=c+d>>1;if(12>d-c){if(!(d<=c))for(e=c+1;e<d;)for(var f=e++;f>c;){if(0>b(a[f],a[f-1]))xb.swap(a,f-1,f);else break;--f}}else xb.rec(a,b,c,e),xb.rec(a,b,e,d),xb.doMerge(a,b,c,e,d,e-c,d-e)};xb.doMerge=function(a,b,c,d,e,f,g){if(0!=f&&0!=g)if(2==f+g)0>b(a[d],a[c])&&xb.swap(a,d,c);else{if(f>g){var h=f>>1;var k=c+h;var l=xb.lower(a,b,d,e,k);var m=l-d}else m=g>>1,l=d+m,k=xb.upper(a,b,c,d,l),h=k-c;xb.rotate(a,b,k,d,l);d=k+m;xb.doMerge(a,b,c,k,d,h,m);xb.doMerge(a,b,d,l,e,f-h,g-m)}};xb.rotate=function(a,
b,c,d,e){if(c!=d&&d!=e)for(b=xb.gcd(e-c,d-c);0!=b--;){for(var f=a[c+b],g=d-c,h=c+b,k=c+b+g;k!=c+b;)a[h]=a[k],h=k,k=e-k>g?k+g:c+(g-(e-k));a[h]=f}};xb.gcd=function(a,b){for(;0!=b;){var c=a%b;a=b;b=c}return a};xb.upper=function(a,b,c,d,e){d-=c;for(var f,g;0<d;)f=d>>1,g=c+f,0>b(a[e],a[g])?d=f:(c=g+1,d=d-f-1);return c};xb.lower=function(a,b,c,d,e){d-=c;for(var f,g;0<d;)f=d>>1,g=c+f,0>b(a[g],a[e])?(c=g+1,d=d-f-1):d=f;return c};xb.swap=function(a,b,c){var d=a[b];a[b]=a[c];a[c]=d};var vg=function(){};z["haxe.ds.BalancedTree"]=
vg;vg.__name__="haxe.ds.BalancedTree";vg.__interfaces__=[jf];vg.prototype={set:function(a,b){this.root=this.setLoop(a,b,this.root)},get:function(a){for(var b=this.root;null!=b;){var c=this.compare(a,b.key);if(0==c)return b.value;b=0>c?b.left:b.right}return null},keys:function(){var a=[];this.keysLoop(this.root,a);return new Sd(a)},setLoop:function(a,b,c){if(null==c)return new fd(null,a,b,null);var d=this.compare(a,c.key);if(0==d)return new fd(c.left,a,b,c.right,null==c?0:c._height);if(0>d)return a=
this.setLoop(a,b,c.left),this.balance(a,c.key,c.value,c.right);a=this.setLoop(a,b,c.right);return this.balance(c.left,c.key,c.value,a)},keysLoop:function(a,b){null!=a&&(this.keysLoop(a.left,b),b.push(a.key),this.keysLoop(a.right,b))},balance:function(a,b,c,d){var e=null==a?0:a._height;var f=null==d?0:d._height;return e>f+2?(f=a.left,e=a.right,(null==f?0:f._height)>=(null==e?0:e._height)?new fd(a.left,a.key,a.value,new fd(a.right,b,c,d)):new fd(new fd(a.left,a.key,a.value,a.right.left),a.right.key,
a.right.value,new fd(a.right.right,b,c,d))):f>e+2?(f=d.right,e=d.left,(null==f?0:f._height)>(null==e?0:e._height)?new fd(new fd(a,b,c,d.left),d.key,d.value,d.right):new fd(new fd(a,b,c,d.left.left),d.left.key,d.left.value,new fd(d.left.right,d.key,d.value,d.right))):new fd(a,b,c,d,(e>f?e:f)+1)},compare:function(a,b){return ua.compare(a,b)},__class__:vg};var fd=function(a,b,c,d,e){null==e&&(e=-1);this.left=a;this.key=b;this.value=c;this.right=d;-1==e?(a=this.left,b=this.right,a=(null==a?0:a._height)>
(null==b?0:b._height)?this.left:this.right,this._height=(null==a?0:a._height)+1):this._height=e};z["haxe.ds.TreeNode"]=fd;fd.__name__="haxe.ds.TreeNode";fd.prototype={__class__:fd};var Le=function(){};z["haxe.ds.EnumValueMap"]=Le;Le.__name__="haxe.ds.EnumValueMap";Le.__interfaces__=[jf];Le.__super__=vg;Le.prototype=J(vg.prototype,{compare:function(a,b){var c=a._hx_index-b._hx_index;if(0!=c)return c;a=la.enumParameters(a);b=la.enumParameters(b);return 0==a.length&&0==b.length?0:this.compareArgs(a,
b)},compareArgs:function(a,b){var c=a.length-b.length;if(0!=c)return c;c=0;for(var d=a.length;c<d;){var e=c++;e=this.compareArg(a[e],b[e]);if(0!=e)return e}return 0},compareArg:function(a,b){return ua.isEnumValue(a)&&ua.isEnumValue(b)?this.compare(a,b):a instanceof Array&&b instanceof Array?this.compareArgs(a,b):ua.compare(a,b)},__class__:Le});var Da=function(){this.h={}};z["haxe.ds.IntMap"]=Da;Da.__name__="haxe.ds.IntMap";Da.__interfaces__=[jf];Da.prototype={get:function(a){return this.h[a]},remove:function(a){if(!this.h.hasOwnProperty(a))return!1;
delete this.h[a];return!0},keys:function(){var a=[],b;for(b in this.h)this.h.hasOwnProperty(b)&&a.push(+b);return new Sd(a)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var a=this.it.next();return this.ref[a]}}},__class__:Da};var nc=function(){this.length=0};z["haxe.ds.List"]=nc;nc.__name__="haxe.ds.List";nc.prototype={add:function(a){a=new th(a,null);null==this.h?this.h=a:this.q.next=a;this.q=a;this.length++},push:function(a){this.h=
a=new th(a,this.h);null==this.q&&(this.q=a);this.length++},remove:function(a){for(var b=null,c=this.h;null!=c;){if(c.item==a)return null==b?this.h=c.next:b.next=c.next,this.q==c&&(this.q=b),this.length--,!0;b=c;c=c.next}return!1},__class__:nc};var th=function(a,b){this.item=a;this.next=b};z["haxe.ds._List.ListNode"]=th;th.__name__="haxe.ds._List.ListNode";th.prototype={__class__:th};var vc=function(){this.h={__keys__:{}}};z["haxe.ds.ObjectMap"]=vc;vc.__name__="haxe.ds.ObjectMap";vc.__interfaces__=
[jf];vc.prototype={set:function(a,b){var c=a.__id__;null==c&&(c=a.__id__=W.$haxeUID++);this.h[c]=b;this.h.__keys__[c]=a},get:function(a){return this.h[a.__id__]},remove:function(a){a=a.__id__;if(null==this.h.__keys__[a])return!1;delete this.h[a];delete this.h.__keys__[a];return!0},keys:function(){var a=[],b;for(b in this.h.__keys__)this.h.hasOwnProperty(b)&&a.push(this.h.__keys__[b]);return new Sd(a)},__class__:vc};var La=function(){this.h=Object.create(null)};z["haxe.ds.StringMap"]=La;La.__name__=
"haxe.ds.StringMap";La.__interfaces__=[jf];La.prototype={get:function(a){return this.h[a]},keys:function(){return new Ze(this.h)},iterator:function(){return new Di(this.h)},__class__:La};var Ze=function(a){this.h=a;this.keys=Object.keys(a);this.length=this.keys.length;this.current=0};z["haxe.ds._StringMap.StringMapKeyIterator"]=Ze;Ze.__name__="haxe.ds._StringMap.StringMapKeyIterator";Ze.prototype={hasNext:function(){return this.current<this.length},next:function(){return this.keys[this.current++]},
__class__:Ze};var Di=function(a){this.h=a;this.keys=Object.keys(a);this.length=this.keys.length;this.current=0};z["haxe.ds._StringMap.StringMapValueIterator"]=Di;Di.__name__="haxe.ds._StringMap.StringMapValueIterator";Di.prototype={hasNext:function(){return this.current<this.length},next:function(){return this.h[this.keys[this.current++]]},__class__:Di};var Xj={blit:function(a,b,c,d,e){var f;if(a==c)if(b<d){var g=b+e;b=d+e;for(f=0;f<e;)f++,--g,--b,a[b]=a[g]}else{if(b>d)for(g=b,b=d,f=0;f<e;)f++,a[b]=
a[g],++g,++b}else for(f=0;f<e;)g=f++,c[d+g]=a[b+g]}},Hf=function(a,b,c){u.call(this,a,b);this.posInfos=null==c?{fileName:"(unknown)",lineNumber:0,className:"(unknown)",methodName:"(unknown)"}:c};z["haxe.exceptions.PosException"]=Hf;Hf.__name__="haxe.exceptions.PosException";Hf.__super__=u;Hf.prototype=J(u.prototype,{toString:function(){return""+u.prototype.toString.call(this)+" in "+this.posInfos.className+"."+this.posInfos.methodName+" at "+this.posInfos.fileName+":"+this.posInfos.lineNumber},__class__:Hf});
var If=function(a,b,c){null==a&&(a="Not implemented");Hf.call(this,a,b,c)};z["haxe.exceptions.NotImplementedException"]=If;If.__name__="haxe.exceptions.NotImplementedException";If.__super__=Hf;If.prototype=J(Hf.prototype,{__class__:If});var Vd=function(){this.size=this.pos=0};z["haxe.io.BytesBuffer"]=Vd;Vd.__name__="haxe.io.BytesBuffer";Vd.prototype={addByte:function(a){this.pos==this.size&&this.grow(1);this.view.setUint8(this.pos++,a)},add:function(a){this.pos+a.length>this.size&&this.grow(a.length);
if(0!=this.size){var b=new Uint8Array(a.b.buffer,a.b.byteOffset,a.length);this.u8.set(b,this.pos);this.pos+=a.length}},addInt32:function(a){this.pos+4>this.size&&this.grow(4);this.view.setInt32(this.pos,a,!0);this.pos+=4},addFloat:function(a){this.pos+4>this.size&&this.grow(4);this.view.setFloat32(this.pos,a,!0);this.pos+=4},addDouble:function(a){this.pos+8>this.size&&this.grow(8);this.view.setFloat64(this.pos,a,!0);this.pos+=8},addBytes:function(a,b,c){if(0>b||0>c||b+c>a.length)throw u.thrown(yb.OutsideBounds);
this.pos+c>this.size&&this.grow(c);0!=this.size&&(a=new Uint8Array(a.b.buffer,a.b.byteOffset+b,c),this.u8.set(a,this.pos),this.pos+=c)},grow:function(a){var b=this.pos+a;for(a=0==this.size?16:this.size;a<b;)a=3*a>>1;b=new ArrayBuffer(a);var c=new Uint8Array(b);0<this.size&&c.set(this.u8);this.size=a;this.buffer=b;this.u8=c;this.view=new DataView(this.buffer)},getBytes:function(){if(0==this.size)return new S(new ArrayBuffer(0));var a=new S(this.buffer);a.length=this.pos;return a},__class__:Vd};var Jf=
function(){};z["haxe.io.Input"]=Jf;Jf.__name__="haxe.io.Input";Jf.prototype={readByte:function(){throw new If(null,null,{fileName:"haxe/io/Input.hx",lineNumber:53,className:"haxe.io.Input",methodName:"readByte"});},readBytes:function(a,b,c){var d=c,e=a.b;if(0>b||0>c||b+c>a.length)throw u.thrown(yb.OutsideBounds);try{for(;0<d;)e[b]=this.readByte(),++b,--d}catch(f){if(!(u.caught(f).unwrap()instanceof Fc))throw f;}return c-d},set_bigEndian:function(a){return this.bigEndian=a},readFullBytes:function(a,
b,c){for(;0<c;){var d=this.readBytes(a,b,c);if(0==d)throw u.thrown(yb.Blocked);b+=d;c-=d}},read:function(a){for(var b=new S(new ArrayBuffer(a)),c=0;0<a;){var d=this.readBytes(b,c,a);if(0==d)throw u.thrown(yb.Blocked);c+=d;a-=d}return b},readUntil:function(a){for(var b=new Vd,c;;){c=this.readByte();if(c==a)break;b.addByte(c)}return b.getBytes().toString()},readLine:function(){var a=new Vd;try{for(;;){var b=this.readByte();if(10==b)break;a.addByte(b)}var c=a.getBytes().toString();13==D.cca(c,c.length-
1)&&(c=D.substr(c,0,-1))}catch(d){if(b=u.caught(d).unwrap(),b instanceof Fc){if(c=a.getBytes().toString(),0==c.length)throw u.thrown(b);}else throw d;}return c},readFloat:function(){return ob.i32ToFloat(this.readInt32())},readDouble:function(){var a=this.readInt32(),b=this.readInt32();return this.bigEndian?ob.i64ToDouble(b,a):ob.i64ToDouble(a,b)},readInt8:function(){var a=this.readByte();return 128<=a?a-256:a},readInt16:function(){var a=this.readByte(),b=this.readByte();a=this.bigEndian?b|a<<8:a|
b<<8;return 0!=(a&32768)?a-65536:a},readUInt16:function(){var a=this.readByte(),b=this.readByte();return this.bigEndian?b|a<<8:a|b<<8},readUInt24:function(){var a=this.readByte(),b=this.readByte(),c=this.readByte();return this.bigEndian?c|b<<8|a<<16:a|b<<8|c<<16},readInt32:function(){var a=this.readByte(),b=this.readByte(),c=this.readByte(),d=this.readByte();return this.bigEndian?d|c<<8|b<<16|a<<24:a|b<<8|c<<16|d<<24},readString:function(a,b){var c=new S(new ArrayBuffer(a));this.readFullBytes(c,0,
a);return c.getString(0,a,b)},__class__:Jf};var Zb=function(a,b,c){null==b&&(b=0);null==c&&(c=a.length-b);if(0>b||0>c||b+c>a.length)throw u.thrown(yb.OutsideBounds);this.b=a.b;this.pos=b;this.totlen=this.len=c};z["haxe.io.BytesInput"]=Zb;Zb.__name__="haxe.io.BytesInput";Zb.__super__=Jf;Zb.prototype=J(Jf.prototype,{set_position:function(a){0>a?a=0:a>this.totlen&&(a=this.totlen);this.len=this.totlen-a;return this.pos=a},readByte:function(){if(0==this.len)throw u.thrown(new Fc);this.len--;return this.b[this.pos++]},
readBytes:function(a,b,c){if(0>b||0>c||b+c>a.length)throw u.thrown(yb.OutsideBounds);if(0==this.len&&0<c)throw u.thrown(new Fc);this.len<c&&(c=this.len);var d=this.b;a=a.b;for(var e=0,f=c;e<f;){var g=e++;a[b+g]=d[this.pos+g]}this.pos+=c;this.len-=c;return c},__class__:Zb});var uh=function(){};z["haxe.io.Output"]=uh;uh.__name__="haxe.io.Output";uh.prototype={writeByte:function(a){throw new If(null,null,{fileName:"haxe/io/Output.hx",lineNumber:47,className:"haxe.io.Output",methodName:"writeByte"});
},writeBytes:function(a,b,c){if(0>b||0>c||b+c>a.length)throw u.thrown(yb.OutsideBounds);a=a.b;for(var d=c;0<d;)this.writeByte(a[b]),++b,--d;return c},flush:function(){},close:function(){},set_bigEndian:function(a){return this.bigEndian=a},write:function(a){for(var b=a.length,c=0;0<b;){var d=this.writeBytes(a,c,b);if(0==d)throw u.thrown(yb.Blocked);c+=d;b-=d}},writeFullBytes:function(a,b,c){for(;0<c;){var d=this.writeBytes(a,b,c);b+=d;c-=d}},writeFloat:function(a){this.writeInt32(ob.floatToI32(a))},
writeDouble:function(a){a=ob.doubleToI64(a);this.bigEndian?(this.writeInt32(a.high),this.writeInt32(a.low)):(this.writeInt32(a.low),this.writeInt32(a.high))},writeInt8:function(a){if(-128>a||128<=a)throw u.thrown(yb.Overflow);this.writeByte(a&255)},writeInt16:function(a){if(-32768>a||32768<=a)throw u.thrown(yb.Overflow);this.writeUInt16(a&65535)},writeUInt16:function(a){if(0>a||65536<=a)throw u.thrown(yb.Overflow);this.bigEndian?(this.writeByte(a>>8),this.writeByte(a&255)):(this.writeByte(a&255),
this.writeByte(a>>8))},writeInt32:function(a){this.bigEndian?(this.writeByte(a>>>24),this.writeByte(a>>16&255),this.writeByte(a>>8&255),this.writeByte(a&255)):(this.writeByte(a&255),this.writeByte(a>>8&255),this.writeByte(a>>16&255),this.writeByte(a>>>24))},writeString:function(a,b){a=S.ofString(a,b);this.writeFullBytes(a,0,a.length)},__class__:uh};var Rc=function(){this.b=new Vd};z["haxe.io.BytesOutput"]=Rc;Rc.__name__="haxe.io.BytesOutput";Rc.__super__=uh;Rc.prototype=J(uh.prototype,{writeByte:function(a){this.b.addByte(a)},
writeBytes:function(a,b,c){this.b.addBytes(a,b,c);return c},getBytes:function(){return this.b.getBytes()},__class__:Rc});var Fc=function(){};z["haxe.io.Eof"]=Fc;Fc.__name__="haxe.io.Eof";Fc.prototype={toString:function(){return"Eof"},__class__:Fc};var yb=L["haxe.io.Error"]={__ename__:!0,__constructs__:null,Blocked:{_hx_name:"Blocked",_hx_index:0,__enum__:"haxe.io.Error",toString:v},Overflow:{_hx_name:"Overflow",_hx_index:1,__enum__:"haxe.io.Error",toString:v},OutsideBounds:{_hx_name:"OutsideBounds",
_hx_index:2,__enum__:"haxe.io.Error",toString:v},Custom:(A=function(a){return{_hx_index:3,e:a,__enum__:"haxe.io.Error",toString:v}},A._hx_name="Custom",A.__params__=["e"],A)};yb.__constructs__=[yb.Blocked,yb.Overflow,yb.OutsideBounds,yb.Custom];yb.__empty_constructs__=[yb.Blocked,yb.Overflow,yb.OutsideBounds];var ob=function(){};z["haxe.io.FPHelper"]=ob;ob.__name__="haxe.io.FPHelper";ob.i32ToFloat=function(a){ob.helper.setInt32(0,a,!0);return ob.helper.getFloat32(0,!0)};ob.floatToI32=function(a){ob.helper.setFloat32(0,
a,!0);return ob.helper.getInt32(0,!0)};ob.i64ToDouble=function(a,b){ob.helper.setInt32(0,a,!0);ob.helper.setInt32(4,b,!0);return ob.helper.getFloat64(0,!0)};ob.doubleToI64=function(a){var b=ob.i64tmp;ob.helper.setFloat64(0,a,!0);b.low=ob.helper.getInt32(0,!0);b.high=ob.helper.getInt32(4,!0);return b};var Sa=function(a){switch(a){case ".":case "..":this.dir=a;this.file="";return}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");b<c?(this.dir=D.substr(a,0,c),a=D.substr(a,c+1,null),this.backslash=!0):c<
b?(this.dir=D.substr(a,0,b),a=D.substr(a,b+1,null)):this.dir=null;b=a.lastIndexOf(".");-1!=b?(this.ext=D.substr(a,b+1,null),this.file=D.substr(a,0,b)):(this.ext=null,this.file=a)};z["haxe.io.Path"]=Sa;Sa.__name__="haxe.io.Path";Sa.directory=function(a){a=new Sa(a);return null==a.dir?"":a.dir};Sa.extension=function(a){a=new Sa(a);return null==a.ext?"":a.ext};Sa.withExtension=function(a,b){a=new Sa(a);a.ext=b;return a.toString()};Sa.join=function(a){for(var b=[],c=0;c<a.length;){var d=a[c];++c;null!=
d&&""!=d&&b.push(d)}a=b;if(0==a.length)return"";d=a[0];b=1;for(c=a.length;b<c;){var e=b++;d=Sa.addTrailingSlash(d);d+=a[e]}return Sa.normalize(d)};Sa.normalize=function(a){a=a.split("\\").join("/");if("/"==a)return"/";for(var b=[],c=0,d=a.split("/");c<d.length;){var e=d[c];++c;".."==e&&0<b.length&&".."!=b[b.length-1]?b.pop():""==e?(0<b.length||47==D.cca(a,0))&&b.push(e):"."!=e&&b.push(e)}a="";d=c=!1;e=0;for(b=b.join("/");e<b.length;){var f=b,g=e++,h=f.charCodeAt(g);55296<=h&&56319>=h&&(h=h-55232<<
10|f.charCodeAt(g+1)&1023);f=h;65536<=f&&++e;switch(f){case 47:c?(c=!1,d&&(a+="/",d=!1),a+=String.fromCodePoint(f)):d=!0;break;case 58:a+=":";c=!0;break;default:c=!1,d&&(a+="/",d=!1),a+=String.fromCodePoint(f)}}return a};Sa.addTrailingSlash=function(a){if(0==a.length)return"/";var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");return b<c?c!=a.length-1?a+"\\":a:b!=a.length-1?a+"/":a};Sa.prototype={toString:function(){return(null==this.dir?"":this.dir+(this.backslash?"\\":"/"))+this.file+(null==this.ext?
"":"."+this.ext)},__class__:Sa};var Sd=function(a){this.current=0;this.array=a};z["haxe.iterators.ArrayIterator"]=Sd;Sd.__name__="haxe.iterators.ArrayIterator";Sd.prototype={hasNext:function(){return this.current<this.array.length},next:function(){return this.array[this.current++]},__class__:Sd};var ha=L["haxe.macro.Binop"]={__ename__:!0,__constructs__:null,OpAdd:{_hx_name:"OpAdd",_hx_index:0,__enum__:"haxe.macro.Binop",toString:v},OpMult:{_hx_name:"OpMult",_hx_index:1,__enum__:"haxe.macro.Binop",
toString:v},OpDiv:{_hx_name:"OpDiv",_hx_index:2,__enum__:"haxe.macro.Binop",toString:v},OpSub:{_hx_name:"OpSub",_hx_index:3,__enum__:"haxe.macro.Binop",toString:v},OpAssign:{_hx_name:"OpAssign",_hx_index:4,__enum__:"haxe.macro.Binop",toString:v},OpEq:{_hx_name:"OpEq",_hx_index:5,__enum__:"haxe.macro.Binop",toString:v},OpNotEq:{_hx_name:"OpNotEq",_hx_index:6,__enum__:"haxe.macro.Binop",toString:v},OpGt:{_hx_name:"OpGt",_hx_index:7,__enum__:"haxe.macro.Binop",toString:v},OpGte:{_hx_name:"OpGte",_hx_index:8,
__enum__:"haxe.macro.Binop",toString:v},OpLt:{_hx_name:"OpLt",_hx_index:9,__enum__:"haxe.macro.Binop",toString:v},OpLte:{_hx_name:"OpLte",_hx_index:10,__enum__:"haxe.macro.Binop",toString:v},OpAnd:{_hx_name:"OpAnd",_hx_index:11,__enum__:"haxe.macro.Binop",toString:v},OpOr:{_hx_name:"OpOr",_hx_index:12,__enum__:"haxe.macro.Binop",toString:v},OpXor:{_hx_name:"OpXor",_hx_index:13,__enum__:"haxe.macro.Binop",toString:v},OpBoolAnd:{_hx_name:"OpBoolAnd",_hx_index:14,__enum__:"haxe.macro.Binop",toString:v},
OpBoolOr:{_hx_name:"OpBoolOr",_hx_index:15,__enum__:"haxe.macro.Binop",toString:v},OpShl:{_hx_name:"OpShl",_hx_index:16,__enum__:"haxe.macro.Binop",toString:v},OpShr:{_hx_name:"OpShr",_hx_index:17,__enum__:"haxe.macro.Binop",toString:v},OpUShr:{_hx_name:"OpUShr",_hx_index:18,__enum__:"haxe.macro.Binop",toString:v},OpMod:{_hx_name:"OpMod",_hx_index:19,__enum__:"haxe.macro.Binop",toString:v},OpAssignOp:(A=function(a){return{_hx_index:20,op:a,__enum__:"haxe.macro.Binop",toString:v}},A._hx_name="OpAssignOp",
A.__params__=["op"],A),OpInterval:{_hx_name:"OpInterval",_hx_index:21,__enum__:"haxe.macro.Binop",toString:v},OpArrow:{_hx_name:"OpArrow",_hx_index:22,__enum__:"haxe.macro.Binop",toString:v},OpIn:{_hx_name:"OpIn",_hx_index:23,__enum__:"haxe.macro.Binop",toString:v},OpNullCoal:{_hx_name:"OpNullCoal",_hx_index:24,__enum__:"haxe.macro.Binop",toString:v}};ha.__constructs__=[ha.OpAdd,ha.OpMult,ha.OpDiv,ha.OpSub,ha.OpAssign,ha.OpEq,ha.OpNotEq,ha.OpGt,ha.OpGte,ha.OpLt,ha.OpLte,ha.OpAnd,ha.OpOr,ha.OpXor,
ha.OpBoolAnd,ha.OpBoolOr,ha.OpShl,ha.OpShr,ha.OpUShr,ha.OpMod,ha.OpAssignOp,ha.OpInterval,ha.OpArrow,ha.OpIn,ha.OpNullCoal];ha.__empty_constructs__=[ha.OpAdd,ha.OpMult,ha.OpDiv,ha.OpSub,ha.OpAssign,ha.OpEq,ha.OpNotEq,ha.OpGt,ha.OpGte,ha.OpLt,ha.OpLte,ha.OpAnd,ha.OpOr,ha.OpXor,ha.OpBoolAnd,ha.OpBoolOr,ha.OpShl,ha.OpShr,ha.OpUShr,ha.OpMod,ha.OpInterval,ha.OpArrow,ha.OpIn,ha.OpNullCoal];var gd=L["haxe.macro.Unop"]={__ename__:!0,__constructs__:null,OpIncrement:{_hx_name:"OpIncrement",_hx_index:0,__enum__:"haxe.macro.Unop",
toString:v},OpDecrement:{_hx_name:"OpDecrement",_hx_index:1,__enum__:"haxe.macro.Unop",toString:v},OpNot:{_hx_name:"OpNot",_hx_index:2,__enum__:"haxe.macro.Unop",toString:v},OpNeg:{_hx_name:"OpNeg",_hx_index:3,__enum__:"haxe.macro.Unop",toString:v},OpNegBits:{_hx_name:"OpNegBits",_hx_index:4,__enum__:"haxe.macro.Unop",toString:v},OpSpread:{_hx_name:"OpSpread",_hx_index:5,__enum__:"haxe.macro.Unop",toString:v}};gd.__constructs__=[gd.OpIncrement,gd.OpDecrement,gd.OpNot,gd.OpNeg,gd.OpNegBits,gd.OpSpread];
gd.__empty_constructs__=[gd.OpIncrement,gd.OpDecrement,gd.OpNot,gd.OpNeg,gd.OpNegBits,gd.OpSpread];var vh=function(a,b,c){u.call(this,a,c);this.pos=b};z["haxe.macro.Error"]=vh;vh.__name__="haxe.macro.Error";vh.__super__=u;vh.prototype=J(u.prototype,{__class__:vh});var wg={resolve:function(a,b){var c=a.elementsNamed(b).next();if(null==c){if(a.nodeType==R.Document)a="Document";else{if(a.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==a.nodeType?"null":db.toString(a.nodeType)));
a=a.nodeName}throw u.thrown(a+" is missing element "+b);}if(c.nodeType!=R.Document&&c.nodeType!=R.Element)throw u.thrown("Invalid nodeType "+(null==c.nodeType?"null":db.toString(c.nodeType)));return c}},pb={resolve:function(a,b){if(a.nodeType==R.Document)throw u.thrown("Cannot access document attribute "+b);var c=a.get(b);if(null==c){if(a.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==a.nodeType?"null":db.toString(a.nodeType)));throw u.thrown(a.nodeName+" is missing attribute "+
b);}return c}},Zj={resolve:function(a,b){return a.elementsNamed(b).hasNext()}},Sb=function(a,b,c){this.xml=b;this.message=a;this.position=c;this.lineNumber=1;for(a=this.positionAtLine=0;a<c;){var d=a++;d=b.charCodeAt(d);10==d?(this.lineNumber++,this.positionAtLine=0):13!=d&&this.positionAtLine++}};z["haxe.xml.XmlParserException"]=Sb;Sb.__name__="haxe.xml.XmlParserException";Sb.prototype={toString:function(){return Z.getClass(this).__name__+": "+this.message+" at line "+this.lineNumber+" char "+this.positionAtLine},
__class__:Sb};var xe=function(){};z["haxe.xml.Parser"]=xe;xe.__name__="haxe.xml.Parser";xe.parse=function(a,b){null==b&&(b=!1);var c=R.createDocument();xe.doParse(a,b,0,c);return c};xe.doParse=function(a,b,c,d){null==c&&(c=0);var e=null,f=1,g=1,h=null,k=0,l=0,m=0,p=new Pc;var t=1;for(var n=-1;c<a.length;){var r=a.charCodeAt(c);switch(f){case 0:switch(r){case 9:case 10:case 13:case 32:break;default:f=g;continue}break;case 1:if(60==r)f=0,g=2;else{k=c;f=13;continue}break;case 2:switch(r){case 33:if(91==
a.charCodeAt(c+1)){c+=2;if("CDATA["!=D.substr(a,c,6).toUpperCase())throw u.thrown(new Sb("Expected <![CDATA[",a,c));c+=5;f=17}else if(68==a.charCodeAt(c+1)||100==a.charCodeAt(c+1)){if("OCTYPE"!=D.substr(a,c+2,6).toUpperCase())throw u.thrown(new Sb("Expected <!DOCTYPE",a,c));c+=8;f=16}else{if(45!=a.charCodeAt(c+1)||45!=a.charCodeAt(c+2))throw u.thrown(new Sb("Expected \x3c!--",a,c));c+=2;f=15}k=c+1;break;case 47:if(null==d)throw u.thrown(new Sb("Expected node name",a,c));k=c+1;f=0;g=10;break;case 63:f=
14;k=c;break;default:f=3;k=c;continue}break;case 3:if(!(97<=r&&122>=r||65<=r&&90>=r||48<=r&&57>=r||58==r||46==r||95==r||45==r)){if(c==k)throw u.thrown(new Sb("Expected node name",a,c));e=R.createElement(D.substr(a,k,c-k));d.addChild(e);++l;f=0;g=4;continue}break;case 4:switch(r){case 47:f=11;break;case 62:f=9;break;default:f=5;k=c;continue}break;case 5:if(!(97<=r&&122>=r||65<=r&&90>=r||48<=r&&57>=r||58==r||46==r||95==r||45==r)){if(k==c)throw u.thrown(new Sb("Expected attribute name",a,c));h=D.substr(a,
k,c-k);if(e.exists(h))throw u.thrown(new Sb("Duplicate attribute ["+h+"]",a,c));f=0;g=6;continue}break;case 6:if(61==r)f=0,g=7;else throw u.thrown(new Sb("Expected =",a,c));break;case 7:switch(r){case 34:case 39:p=new Pc;f=8;k=c+1;n=r;break;default:throw u.thrown(new Sb('Expected "',a,c));}break;case 8:switch(r){case 38:t=c-k;p.b+=null==t?D.substr(a,k,null):D.substr(a,k,t);f=18;t=8;k=c+1;break;case 60:case 62:if(b)throw u.thrown(new Sb("Invalid unescaped "+String.fromCodePoint(r)+" in attribute value",
a,c));r==n&&(g=c-k,p.b+=null==g?D.substr(a,k,null):D.substr(a,k,g),g=p.b,p=new Pc,e.set(h,g),f=0,g=4);break;default:r==n&&(g=c-k,p.b+=null==g?D.substr(a,k,null):D.substr(a,k,g),g=p.b,p=new Pc,e.set(h,g),f=0,g=4)}break;case 9:k=c=xe.doParse(a,b,c,e);f=1;break;case 10:if(!(97<=r&&122>=r||65<=r&&90>=r||48<=r&&57>=r||58==r||46==r||95==r||45==r)){if(k==c)throw u.thrown(new Sb("Expected node name",a,c));g=D.substr(a,k,c-k);if(null==d||0!=d.nodeType)throw u.thrown(new Sb("Unexpected </"+g+">, tag is not open",
a,c));if(d.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==d.nodeType?"null":db.toString(d.nodeType)));if(g!=d.nodeName){if(d.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==d.nodeType?"null":db.toString(d.nodeType)));throw u.thrown(new Sb("Expected </"+d.nodeName+">",a,c));}f=0;g=12;continue}break;case 11:if(62==r)f=1;else throw u.thrown(new Sb("Expected >",a,c));break;case 12:if(62==r)return 0==l&&d.addChild(R.createPCData("")),
c;throw u.thrown(new Sb("Expected >",a,c));case 13:60==r?(g=c-k,p.b+=null==g?D.substr(a,k,null):D.substr(a,k,g),g=R.createPCData(p.b),p=new Pc,d.addChild(g),++l,f=0,g=2):38==r&&(t=c-k,p.b+=null==t?D.substr(a,k,null):D.substr(a,k,t),f=18,t=13,k=c+1);break;case 14:63==r&&62==a.charCodeAt(c+1)&&(++c,f=D.substr(a,k+1,c-k-2),d.addChild(R.createProcessingInstruction(f)),++l,f=1);break;case 15:45==r&&45==a.charCodeAt(c+1)&&62==a.charCodeAt(c+2)&&(d.addChild(R.createComment(D.substr(a,k,c-k))),++l,c+=2,f=
1);break;case 16:91==r?++m:93==r?--m:62==r&&0==m&&(d.addChild(R.createDocType(D.substr(a,k,c-k))),++l,f=1);break;case 17:93==r&&93==a.charCodeAt(c+1)&&62==a.charCodeAt(c+2)&&(f=R.createCData(D.substr(a,k,c-k)),d.addChild(f),++l,c+=2,f=1);break;case 18:if(59==r){k=D.substr(a,k,c-k);if(35==k.charCodeAt(0))k=120==k.charCodeAt(1)?w.parseInt("0"+D.substr(k,1,k.length-1)):w.parseInt(D.substr(k,1,k.length-1)),p.b+=String.fromCodePoint(k);else if(Object.prototype.hasOwnProperty.call(xe.escapes.h,k))p.b+=
w.string(xe.escapes.h[k]);else{if(b)throw u.thrown(new Sb("Undefined entity: "+k,a,c));p.b+=w.string("&"+k+";")}k=c+1;f=t}else if(!(97<=r&&122>=r||65<=r&&90>=r||48<=r&&57>=r||58==r||46==r||95==r||45==r)&&35!=r){if(b)throw u.thrown(new Sb("Invalid character in entity: "+String.fromCodePoint(r),a,c));p.b+=String.fromCodePoint(38);f=c-k;p.b+=null==f?D.substr(a,k,null):D.substr(a,k,f);--c;k=c+1;f=t}}++c}1==f&&(k=c,f=13);if(13==f){if(0==d.nodeType){if(d.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+
(null==d.nodeType?"null":db.toString(d.nodeType)));throw u.thrown(new Sb("Unclosed node <"+d.nodeName+">",a,c));}if(c!=k||0==l)t=c-k,p.b+=null==t?D.substr(a,k,null):D.substr(a,k,t),d.addChild(R.createPCData(p.b));return c}if(!b&&18==f&&13==t)return p.b+=String.fromCodePoint(38),t=c-k,p.b+=null==t?D.substr(a,k,null):D.substr(a,k,t),d.addChild(R.createPCData(p.b)),c;throw u.thrown(new Sb("Unexpected end",a,c));};var Uf=function(a){this.output=new Pc;this.pretty=a};z["haxe.xml.Printer"]=Uf;Uf.__name__=
"haxe.xml.Printer";Uf.print=function(a,b){null==b&&(b=!1);b=new Uf(b);b.writeNode(a,"");return b.output.b};Uf.prototype={writeNode:function(a,b){var c;switch(a.nodeType){case 0:this.output.b+=w.string(b+"<");if(a.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==a.nodeType?"null":db.toString(a.nodeType)));this.output.b+=w.string(a.nodeName);for(c=a.attributes();c.hasNext();){var d=c.next();this.output.b+=w.string(" "+d+'="');d=aa.htmlEscape(a.get(d),!0);this.output.b+=
w.string(d);this.output.b+='"'}if(this.hasChildren(a)){this.output.b+=">";this.pretty&&(this.output.b+="\n");if(a.nodeType!=R.Document&&a.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element or Document but found "+(null==a.nodeType?"null":db.toString(a.nodeType)));var e=0;for(d=a.children;e<d.length;)c=d[e++],this.writeNode(c,this.pretty?b+"\t":b);this.output.b+=w.string(b+"</");if(a.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element but found "+(null==a.nodeType?
"null":db.toString(a.nodeType)));this.output.b+=w.string(a.nodeName);this.output.b+=">"}else this.output.b+="/>";this.pretty&&(this.output.b+="\n");break;case 1:if(a.nodeType==R.Document||a.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+(null==a.nodeType?"null":db.toString(a.nodeType)));a=a.nodeValue;0!=a.length&&(d=b+aa.htmlEscape(a),this.output.b+=w.string(d),this.pretty&&(this.output.b+="\n"));break;case 2:this.output.b+=w.string(b+"<![CDATA[");if(a.nodeType==R.Document||a.nodeType==
R.Element)throw u.thrown("Bad node type, unexpected "+(null==a.nodeType?"null":db.toString(a.nodeType)));this.output.b+=w.string(a.nodeValue);this.output.b+="]]\x3e";this.pretty&&(this.output.b+="\n");break;case 3:if(a.nodeType==R.Document||a.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+(null==a.nodeType?"null":db.toString(a.nodeType)));a=a.nodeValue;a=a.replace(/[\n\r\t]+/g,"");this.output.b+=null==b?"null":""+b;d=aa.trim("\x3c!--"+a+"--\x3e");this.output.b+=w.string(d);this.pretty&&
(this.output.b+="\n");break;case 4:if(a.nodeType==R.Document||a.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+(null==a.nodeType?"null":db.toString(a.nodeType)));this.output.b+=w.string("<!DOCTYPE "+a.nodeValue+">");this.pretty&&(this.output.b+="\n");break;case 5:if(a.nodeType==R.Document||a.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+(null==a.nodeType?"null":db.toString(a.nodeType)));this.output.b+=w.string("<?"+a.nodeValue+"?>");this.pretty&&(this.output.b+=
"\n");break;case 6:if(a.nodeType!=R.Document&&a.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element or Document but found "+(null==a.nodeType?"null":db.toString(a.nodeType)));e=0;for(d=a.children;e<d.length;)c=d[e++],this.writeNode(c,b)}},hasChildren:function(a){if(a.nodeType!=R.Document&&a.nodeType!=R.Element)throw u.thrown("Bad node type, expected Element or Document but found "+(null==a.nodeType?"null":db.toString(a.nodeType)));var b=0;for(a=a.children;b<a.length;){var c=a[b++];
switch(c.nodeType){case 0:case 1:return!0;case 2:case 3:if(c.nodeType==R.Document||c.nodeType==R.Element)throw u.thrown("Bad node type, unexpected "+(null==c.nodeType?"null":db.toString(c.nodeType)));if(0!=aa.ltrim(c.nodeValue).length)return!0}}return!1},__class__:Uf};var bi=function(){};z["haxe.zip.Compress"]=bi;bi.__name__="haxe.zip.Compress";bi.run=function(a,b){throw new If("Not implemented for this platform",null,{fileName:"haxe/zip/Compress.hx",lineNumber:39,className:"haxe.zip.Compress",methodName:"run"});
};var hd=L["haxe.zip.Huffman"]={__ename__:!0,__constructs__:null,Found:(A=function(a){return{_hx_index:0,i:a,__enum__:"haxe.zip.Huffman",toString:v}},A._hx_name="Found",A.__params__=["i"],A),NeedBit:(A=function(a,b){return{_hx_index:1,left:a,right:b,__enum__:"haxe.zip.Huffman",toString:v}},A._hx_name="NeedBit",A.__params__=["left","right"],A),NeedBits:(A=function(a,b){return{_hx_index:2,n:a,table:b,__enum__:"haxe.zip.Huffman",toString:v}},A._hx_name="NeedBits",A.__params__=["n","table"],A)};hd.__constructs__=
[hd.Found,hd.NeedBit,hd.NeedBits];hd.__empty_constructs__=[];var Ei=function(){};z["haxe.zip.HuffTools"]=Ei;Ei.__name__="haxe.zip.HuffTools";Ei.prototype={treeDepth:function(a){switch(a._hx_index){case 0:return 0;case 1:var b=a.right;a=this.treeDepth(a.left);b=this.treeDepth(b);return 1+(a<b?a:b);case 2:throw u.thrown("assert");}},treeCompress:function(a){var b=this.treeDepth(a);if(0==b)return a;if(1==b){if(1==a._hx_index)return b=a.right,hd.NeedBit(this.treeCompress(a.left),this.treeCompress(b));
throw u.thrown("assert");}for(var c=[],d=0,e=1<<b;d<e;)d++,c.push(hd.Found(-1));this.treeWalk(c,0,0,b,a);return hd.NeedBits(b,c)},treeWalk:function(a,b,c,d,e){if(1==e._hx_index){var f=e.left,g=e.right;0<d?(this.treeWalk(a,b,c+1,d-1,f),this.treeWalk(a,b|1<<c,c+1,d-1,g)):a[b]=this.treeCompress(e)}else a[b]=this.treeCompress(e)},treeMake:function(a,b,c,d){if(d>b)throw u.thrown("Invalid huffman");var e=c<<5|d;if(a.h.hasOwnProperty(e))return hd.Found(a.h[e]);c<<=1;++d;return hd.NeedBit(this.treeMake(a,
b,c,d),this.treeMake(a,b,c|1,d))},make:function(a,b,c,d){if(1==c)return hd.NeedBit(hd.Found(0),hd.Found(0));var e=[],f=[];if(32<d)throw u.thrown("Invalid huffman");for(var g=0,h=d;g<h;)g++,e.push(0),f.push(0);g=0;for(h=c;g<h;){var k=g++;k=a[k+b];if(k>=d)throw u.thrown("Invalid huffman");e[k]++}var l=0;g=1;for(h=d-1;g<h;)k=g++,l=l+e[k]<<1,f[k]=l;e=new Da;g=0;for(h=c;g<h;)k=g++,c=a[k+b],0!=c&&(l=f[c-1],f[c-1]=l+1,e.h[l<<5|c]=k);return this.treeCompress(hd.NeedBit(this.treeMake(e,d,0,1),this.treeMake(e,
d,1,1)))},__class__:Ei};var Fi=function(a){this.buffer=new S(new ArrayBuffer(65536));this.pos=0;a&&(this.crc=new Ff)};z["haxe.zip._InflateImpl.Window"]=Fi;Fi.__name__="haxe.zip._InflateImpl.Window";Fi.prototype={slide:function(){null!=this.crc&&this.crc.update(this.buffer,0,32768);var a=new S(new ArrayBuffer(65536));this.pos-=32768;a.blit(0,this.buffer,32768,this.pos);this.buffer=a},addBytes:function(a,b,c){65536<this.pos+c&&this.slide();this.buffer.blit(this.pos,a,b,c);this.pos+=c},addByte:function(a){65536==
this.pos&&this.slide();this.buffer.b[this.pos]=a;this.pos++},getLastChar:function(){return this.buffer.b[this.pos-1]},available:function(){return this.pos},checksum:function(){null!=this.crc&&this.crc.update(this.buffer,0,this.pos);return this.crc},__class__:Fi};var eb=L["haxe.zip._InflateImpl.State"]={__ename__:!0,__constructs__:null,Head:{_hx_name:"Head",_hx_index:0,__enum__:"haxe.zip._InflateImpl.State",toString:v},Block:{_hx_name:"Block",_hx_index:1,__enum__:"haxe.zip._InflateImpl.State",toString:v},
CData:{_hx_name:"CData",_hx_index:2,__enum__:"haxe.zip._InflateImpl.State",toString:v},Flat:{_hx_name:"Flat",_hx_index:3,__enum__:"haxe.zip._InflateImpl.State",toString:v},Crc:{_hx_name:"Crc",_hx_index:4,__enum__:"haxe.zip._InflateImpl.State",toString:v},Dist:{_hx_name:"Dist",_hx_index:5,__enum__:"haxe.zip._InflateImpl.State",toString:v},DistOne:{_hx_name:"DistOne",_hx_index:6,__enum__:"haxe.zip._InflateImpl.State",toString:v},Done:{_hx_name:"Done",_hx_index:7,__enum__:"haxe.zip._InflateImpl.State",
toString:v}};eb.__constructs__=[eb.Head,eb.Block,eb.CData,eb.Flat,eb.Crc,eb.Dist,eb.DistOne,eb.Done];eb.__empty_constructs__=[eb.Head,eb.Block,eb.CData,eb.Flat,eb.Crc,eb.Dist,eb.DistOne,eb.Done];var gc=function(a,b,c){null==c&&(c=!0);null==b&&(b=!0);this.isFinal=!1;this.htools=new Ei;this.huffman=this.buildFixedHuffman();this.huffdist=null;this.dist=this.len=0;this.state=b?eb.Head:eb.Block;this.input=a;this.needed=this.nbits=this.bits=0;this.output=null;this.outpos=0;this.lengths=[];this.lengths.push(-1);
this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.lengths.push(-1);this.window=new Fi(c)};z["haxe.zip.InflateImpl"]=gc;gc.__name__="haxe.zip.InflateImpl";gc.run=function(a,
b){null==b&&(b=65536);var c=new S(new ArrayBuffer(b)),d=new Vd;for(a=new gc(a);;){var e=a.readBytes(c,0,b);d.addBytes(c,0,e);if(e<b)break}return d.getBytes()};gc.prototype={buildFixedHuffman:function(){if(null!=gc.FIXED_HUFFMAN)return gc.FIXED_HUFFMAN;for(var a=[],b=0;288>b;){var c=b++;a.push(143>=c?8:255>=c?9:279>=c?7:8)}gc.FIXED_HUFFMAN=this.htools.make(a,0,288,10);return gc.FIXED_HUFFMAN},readBytes:function(a,b,c){this.needed=c;this.outpos=b;this.output=a;if(0<c)for(;this.inflateLoop(););return c-
this.needed},getBits:function(a){for(;this.nbits<a;)this.bits|=this.input.readByte()<<this.nbits,this.nbits+=8;var b=this.bits&(1<<a)-1;this.nbits-=a;this.bits>>=a;return b},getBit:function(){0==this.nbits&&(this.nbits=8,this.bits=this.input.readByte());var a=1==(this.bits&1);this.nbits--;this.bits>>=1;return a},getRevBits:function(a){return 0==a?0:this.getBit()?1<<a-1|this.getRevBits(a-1):this.getRevBits(a-1)},resetBits:function(){this.nbits=this.bits=0},addBytes:function(a,b,c){this.window.addBytes(a,
b,c);this.output.blit(this.outpos,a,b,c);this.needed-=c;this.outpos+=c},addByte:function(a){this.window.addByte(a);this.output.b[this.outpos]=a;this.needed--;this.outpos++},addDistOne:function(a){for(var b=this.window.getLastChar(),c=0;c<a;)c++,this.addByte(b)},addDist:function(a,b){this.addBytes(this.window.buffer,this.window.pos-a,b)},applyHuffman:function(a){switch(a._hx_index){case 0:var b=a.i;return b;case 1:return b=a.left,a=a.right,this.applyHuffman(this.getBit()?a:b);case 2:return b=a.n,this.applyHuffman(a.table[this.getBits(b)])}},
inflateLengths:function(a,b){for(var c=0,d=0;c<b;){var e=this.applyHuffman(this.huffman);switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:d=e;a[c]=e;++c;break;case 16:e=c+3+this.getBits(2);if(e>b)throw u.thrown("Invalid data");for(;c<e;)a[c]=d,++c;break;case 17:c+=3+this.getBits(3);if(c>b)throw u.thrown("Invalid data");break;case 18:c+=11+this.getBits(7);if(c>b)throw u.thrown("Invalid data");break;default:throw u.thrown("Invalid data");
}}},inflateLoop:function(){switch(this.state._hx_index){case 0:var a=this.input.readByte();if(8!=(a&15))throw u.thrown("Invalid data");var b=this.input.readByte(),c=0!=(b&32);if(0!=((a<<8)+b)%31)throw u.thrown("Invalid data");if(c)throw u.thrown("Unsupported dictionary");this.state=eb.Block;return!0;case 1:switch(this.isFinal=this.getBit(),this.getBits(2)){case 0:this.len=this.input.readUInt16();if(this.input.readUInt16()!=65535-this.len)throw u.thrown("Invalid data");this.state=eb.Flat;a=this.inflateLoop();
this.resetBits();return a;case 1:return this.huffman=this.buildFixedHuffman(),this.huffdist=null,this.state=eb.CData,!0;case 2:a=this.getBits(5)+257;b=this.getBits(5)+1;var d=this.getBits(4)+4;c=0;for(var e=d;c<e;){var f=c++;this.lengths[gc.CODE_LENGTHS_POS[f]]=this.getBits(3)}c=d;for(e=19;c<e;)f=c++,this.lengths[gc.CODE_LENGTHS_POS[f]]=0;this.huffman=this.htools.make(this.lengths,0,19,8);f=[];c=0;for(e=a+b;c<e;)c++,f.push(0);this.inflateLengths(f,a+b);this.huffdist=this.htools.make(f,a,b,16);this.huffman=
this.htools.make(f,0,a,16);this.state=eb.CData;return!0;default:throw u.thrown("Invalid data");}case 2:b=this.applyHuffman(this.huffman);if(256>b)return this.addByte(b),0<this.needed;if(256==b)this.state=this.isFinal?eb.Crc:eb.Block;else{b-=257;a=gc.LEN_EXTRA_BITS_TBL[b];if(-1==a)throw u.thrown("Invalid data");this.len=gc.LEN_BASE_VAL_TBL[b]+this.getBits(a);b=null==this.huffdist?this.getRevBits(5):this.applyHuffman(this.huffdist);a=gc.DIST_EXTRA_BITS_TBL[b];if(-1==a)throw u.thrown("Invalid data");
this.dist=gc.DIST_BASE_VAL_TBL[b]+this.getBits(a);if(this.dist>this.window.available())throw u.thrown("Invalid data");this.state=1==this.dist?eb.DistOne:eb.Dist}return!0;case 3:return a=this.len<this.needed?this.len:this.needed,b=this.input.read(a),this.len-=a,this.addBytes(b,0,a),0==this.len&&(this.state=this.isFinal?eb.Crc:eb.Block),0<this.needed;case 4:a=this.window.checksum();if(null==a)return this.state=eb.Done,!0;b=Ff.read(this.input);if(!a.equals(b))throw u.thrown("Invalid CRC");this.state=
eb.Done;return!0;case 5:for(;0<this.len&&0<this.needed;)a=this.len<this.dist?this.len:this.dist,a=this.needed<a?this.needed:a,this.addDist(this.dist,a),this.len-=a;0==this.len&&(this.state=eb.CData);return 0<this.needed;case 6:return a=this.len<this.needed?this.len:this.needed,this.addDistOne(a),this.len-=a,0==this.len&&(this.state=eb.CData),0<this.needed;case 7:return!1}},__class__:gc};var ci=function(){};z["haxe.zip.Uncompress"]=ci;ci.__name__="haxe.zip.Uncompress";ci.run=function(a,b){return gc.run(new Zb(a),
b)};var xg=function(){this.chunks=[];this.currentData=null;this.available=this.length=this.currentOffset=0};z["hx.ws.Buffer"]=xg;xg.__name__="hx.ws.Buffer";xg.prototype={writeByte:function(a){var b=new S(new ArrayBuffer(1));b.b[0]=a;this.writeBytes(b)},writeShort:function(a){var b=new S(new ArrayBuffer(2));b.b[0]=a>>8&255;b.b[1]=a&255;this.writeBytes(b)},writeInt:function(a){var b=new S(new ArrayBuffer(4));b.b[0]=a>>24&255;b.b[1]=a>>16&255;b.b[2]=a>>8&255;b.b[3]=a&255;this.writeBytes(b)},writeBytes:function(a){this.chunks.push(a);
this.length=this.available+=a.length},readAllAvailableBytes:function(){return this.readBytes(this.available)},readLine:function(){var a=this.readUntil("\n");return null==a?null:aa.trim(a.toString())},readLinesUntil:function(a){a=this.readUntil(a);return null==a?null:aa.trim(a.toString()).split("\n")},readUntil:function(a){for(var b=a.length,c=0,d=this.available-b;c<d;){for(var e=c++,f=!0,g=0,h=b;g<h;){var k=g++;if(this.peekByte(this.currentOffset+e+k+1)!=D.cca(a,k)){f=!1;break}}if(f)return this.readBytes(e+
b+1)}return null},readBytes:function(a){a=Math.min(a,this.available)|0;for(var b=new S(new ArrayBuffer(a)),c=0;c<a;){var d=c++,e=this.readByte();b.b[d]=e}return b},readUnsignedShort:function(){var a=this.readByte(),b=this.readByte();return a<<8|b},readUnsignedInt:function(){var a=this.readByte(),b=this.readByte(),c=this.readByte(),d=this.readByte();return a<<24|b<<16|c<<8|d},readByte:function(){if(0>=this.available)throw u.thrown("No bytes available");for(;null==this.currentData||this.currentOffset>=
this.currentData.length;)this.currentOffset=0,this.currentData=this.chunks.shift();this.available--;this.length=this.available;return this.currentData.b[this.currentOffset++]},peekByte:function(a){if(0>=this.available)throw u.thrown("No bytes available");var b=this.chunks[0];null==b&&(b=this.currentData);for(var c=0;a>=b.length;)a-=b.length,++c,b=this.chunks[c];return b.b[a]},peekUntil:function(a){var b=this.currentOffset,c=this.chunks[0];null==c&&(c=this.currentData);for(var d=0;b>=c.length;)b-=
c.length,++d,c=this.chunks[d];for(;b<c.length;){if(c.b[b]==a)return b+1;++b}return-1},endsWith:function(a){for(var b=this.available-a.length,c=this.currentOffset;b<this.available;){if(this.peekByte(b)!=D.cca(a,c))return!1;++b;++c}return!0},__class__:xg};var Bb=function(){};z["hx.ws.Log"]=Bb;Bb.__name__="hx.ws.Log";Bb.info=function(a,b){1==(Bb.mask&1)&&(null!=b?Bb.logFn("INFO  :: ID-"+b+" :: "+a):Bb.logFn("INFO  :: "+a))};Bb.debug=function(a,b){16==(Bb.mask&16)&&(null!=b?Bb.logFn("DEBUG :: ID-"+b+
" :: "+a):Bb.logFn("DEBUG :: "+a))};Bb.data=function(a,b){256==(Bb.mask&256)&&(null!=b?Bb.logFn("DATA  :: ID-"+b+"\n------------------------------\n"+a+"\n------------------------------"):Bb.logFn(""+a))};var wh=L["hx.ws.MessageType"]={__ename__:!0,__constructs__:null,BytesMessage:(A=function(a){return{_hx_index:0,content:a,__enum__:"hx.ws.MessageType",toString:v}},A._hx_name="BytesMessage",A.__params__=["content"],A),StrMessage:(A=function(a){return{_hx_index:1,content:a,__enum__:"hx.ws.MessageType",
toString:v}},A._hx_name="StrMessage",A.__params__=["content"],A)};wh.__constructs__=[wh.BytesMessage,wh.StrMessage];wh.__empty_constructs__=[];var Th=function(a,b){null==b&&(b=!0);this._ws=this._onmessage=null;this._url=a;b&&this.open();this.set_binaryType("arraybuffer")};z["hx.ws.WebSocket"]=Th;Th.__name__="hx.ws.WebSocket";Th.prototype={open:function(){if(null!=this._ws)throw u.thrown("Socket already connected");this._ws=new WebSocket(this._url)},get_onopen:function(){return this._ws.onopen},set_onopen:function(a){return this._ws.onopen=
a},get_onclose:function(){return this._ws.onclose},set_onclose:function(a){return this._ws.onclose=a},get_onerror:function(){return this._ws.onerror},set_onerror:function(a){return this._ws.onerror=a},get_onmessage:function(){return this._onmessage},set_onmessage:function(a){var b=this;this._onmessage=a;this._ws.onmessage=function(a){if(null!=b._onmessage)if(a.data instanceof ArrayBuffer){var c=new xg;c.writeBytes(S.ofData(a.data));b._onmessage(wh.BytesMessage(c))}else b._onmessage(wh.StrMessage(a.data))};
return a},get_binaryType:function(){return this._ws.binaryType},set_binaryType:function(a){return this._ws.binaryType=a},close:function(){this._ws.close()},send:function(a){a instanceof S?(a=Z.__cast(a,S),this._ws.send(a.b.bufferValue)):a instanceof xg?(a=Z.__cast(a,xg),this._ws.send(a.readAllAvailableBytes().b.bufferValue)):this._ws.send(a)},__class__:Th};var be=function(a,b){if(-101!=a||-102!=b){var c=window.document.createElement("canvas");c.width=a;c.height=b;this.ctx=c.getContext("2d",null)}};
z["hxd.BitmapData"]=be;be.__name__="hxd.BitmapData";be.notImplemented=function(){throw u.thrown("Not implemented");};be.fromNative=function(a){var b=new be(-101,-102);b.ctx=a;return b};be.prototype={clear:function(a){this.fill(0,0,this.ctx.canvas.width,this.ctx.canvas.height,a)},fill:function(a,b,c,d,e){this.ctx.fillStyle="rgba("+(e>>16&255)+", "+(e>>8&255)+", "+(e&255)+", "+(e>>>24)/255+")";this.ctx.fillRect(a,b,c,d)},draw:function(a,b,c,d,e,f,g,h){this.drawScaled(a,b,f,g,c,d,e,f,g,h)},drawScaled:function(a,
b,c,d,e,f,g,h,k,l,m){throw u.thrown("Not implemented");},line:function(a,b,c,d,e){var f=d-b;if(0==c-a){if(d<b){var g=b;b=d;d=g}0>b&&(b=0);d>this.ctx.canvas.height-1&&(d=this.ctx.canvas.height-1);var h=b;for(c=d+1;h<c;)g=h++,this.setPixel(a,g,e)}else if(0==f)for(c<a&&(g=a,a=c,c=g),0>a&&(a=0),c>this.ctx.canvas.width-1&&(c=this.ctx.canvas.width-1),h=a,c+=1;h<c;){var k=h++;this.setPixel(k,b,e)}else{if(a<c){if(a>=this.ctx.canvas.width||0>c)return;var l=1;var m=0;var p=this.ctx.canvas.width-1}else{if(c>=
this.ctx.canvas.width||0>a)return;l=-1;c=-c;a=-a;m=1-this.ctx.canvas.width;p=0}if(b<d){if(b>=this.ctx.canvas.height||0>d)return;var t=1;var n=0;var r=this.ctx.canvas.height-1}else{if(d>=this.ctx.canvas.width||0>b)return;t=-1;d=-d;b=-b;n=1-this.ctx.canvas.height;r=0}var q=c-a;f=d-b;var u=q<<1,v=f<<1;k=a;g=b;if(q>=f){var w=v-q;var x=!1;if(b<n){h=u*(n-b)-q;b=h/v;k+=b|0;if(k>p)return;k>=m&&(h-=b*v,w-=(h|0)+q,g=n,0<h&&(++k,w+=v),x=!0)}if(!x&&a<m){h=v*(m-a);g+=h/u|0;h%=u;if(g>r||g==r&&h>q)return;k=m;w+=
h|0;h>=q&&(++g,w-=u)}d>r&&(h=u*(r-d)+q,b=h/v,c+=b|0,0==h-b*v&&--c);c>p?c=p+1:++c;-1==l&&(k=-k,c=-c);-1==t&&(g=-g);for(u-=v;k!=c;)this.setPixel(k,g,e),0<=w?(g+=t,w-=u):w+=v,k+=l}else{w=u-f;x=!1;if(a<m){h=v*(m-a)-f;a=h/u;g+=a|0;if(g>r)return;g>=n&&(h-=a*u,w-=(h|0)+f,k=m,0<h&&(++g,w+=u),x=!0)}if(!x&&b<n){h=u*(n-b);k+=h/v|0;h%=v;if(k>p||k==p&&h>f)return;g=n;w+=h|0;h>=f&&(++k,w-=v)}c>p&&(h=v*(p-c)+f,a=h/u,d+=a|0,0==h-a*u&&--d);d>r?d=r+1:++d;-1==l&&(k=-k);-1==t&&(g=-g,d=-d);for(v-=u;g!=d;)this.setPixel(k,
g,e),0<=w?(k+=l,w-=v):w+=u,g+=t}}},dispose:function(){this.pixel=this.ctx=null},clone:function(){return this.sub(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},sub:function(a,b,c,d){var e=window.document.createElement("canvas");e.width=c;e.height=d;e=e.getContext("2d",null);e.drawImage(this.ctx.canvas,a,b,c,d,0,0,c,d);return be.fromNative(e)},lock:function(){null==this.lockImage&&(this.lockImage=this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height))},unlock:function(){null!=
this.lockImage&&(this.ctx.putImageData(this.lockImage,0,0),this.lockImage=null)},getPixel:function(a,b){var c=this.lockImage;if(null!=c)var d=a+b*c.width<<2;else d=0,c=this.ctx.getImageData(a,b,1,1);return c.data[d]<<16|c.data[d|1]<<8|c.data[d|2]|c.data[d|3]<<24},setPixel:function(a,b,c){var d=this.lockImage;null!=d?(a=a+b*d.width<<2,d.data[a]=c>>16&255,d.data[a|1]=c>>8&255,d.data[a|2]=c&255,d.data[a|3]=c>>>24&255):(d=this.pixel,null==d&&(this.pixel=d=this.ctx.createImageData(1,1)),d.data[0]=c>>16&
255,d.data[1]=c>>8&255,d.data[2]=c&255,d.data[3]=c>>>24&255,this.ctx.putImageData(d,a,b))},get_width:function(){return this.ctx.canvas.width},get_height:function(){return this.ctx.canvas.height},getPixels:function(){var a=this.ctx.canvas.width,b=this.ctx.canvas.height,c=this.ctx.getImageData(0,0,a,b).data.buffer;return new ya(a,b,S.ofData(c),F.RGBA)},setPixels:function(a){if(a.width!=this.ctx.canvas.width||a.height!=this.ctx.canvas.height)throw u.thrown("Invalid pixels size");var b=this.ctx.createImageData(a.width,
a.height);a.convert(F.RGBA);for(var c=0,d=a.width*a.height*4;c<d;){var e=c++;b.data[e]=a.bytes.b[e]}this.ctx.putImageData(b,0,0)},toNative:function(){return this.ctx},toPNG:function(){var a=this.getPixels(),b=a.toPNG();a.dispose();return b},__class__:be};var qc={_new:function(a){return a},getSize:function(a){return qc.SIZES[a]},toInt:function(a){return a},fromInt:function(a){return a},toString:function(a){switch(a){case 0:return"F32";case 1:return"F16";case 2:return"U8";case 3:return"S8"}}},Jc={_new:function(a){return a},
getSize:function(a){return a==Z.__cast(9,cc)?1:a},toInt:function(a){return a},toString:function(a){switch(a){case 1:return"DFloat";case 2:return"DVec2";case 3:return"DVec3";case 4:return"DVec4";case 9:return"DBytes4";case 16:return"DMat4"}},fromInt:function(a){return a},fromHXSL:function(a){switch(a._hx_index){case 3:return 1;case 5:var b=a.t;switch(a.size){case 2:if(1==b._hx_index)return 2;throw u.thrown("Unsupported buffer type "+w.string(a));case 3:if(1==b._hx_index)return 3;throw u.thrown("Unsupported buffer type "+
w.string(a));case 4:if(1==b._hx_index)return 4;throw u.thrown("Unsupported buffer type "+w.string(a));default:throw u.thrown("Unsupported buffer type "+w.string(a));}case 7:return 16;case 9:if(4==a.size)return 9;throw u.thrown("Unsupported buffer type "+w.string(a));default:throw u.thrown("Unsupported buffer type "+w.string(a));}}},Ma=function(a,b,c){null==c&&(c=0);this.name=a;this.type=b;this.precision=c};z["hxd.BufferInput"]=Ma;Ma.__name__="hxd.BufferInput";Ma.prototype={getBytesSize:function(){var a=
this.type;return(a==Z.__cast(9,cc)?1:a)*qc.SIZES[this.precision]},equals:function(a){return this.type==a.type&&this.name==a.name?this.precision==a.precision:!1},__class__:Ma};var Uj={_new:function(a,b,c){return a<<3|c|b<<16},get_bufferIndex:function(a){return a>>3&255},get_precision:function(a){return a&7},get_offset:function(a){return a>>16}},N=function(a){this.uid=N._UID++;this.stride=this.strideBytes=0;this.inputs=a.slice();this.hasLowPrecision=!1;for(var b=0;b<a.length;){var c=a[b];++b;var d=
c.type;this.stride+=d==Z.__cast(9,cc)?1:d;d=c.type;this.strideBytes+=(d==Z.__cast(9,cc)?1:d)*qc.SIZES[c.precision];0!=(this.strideBytes&3)&&(this.strideBytes+=4-(this.strideBytes&3));0!=c.precision&&(this.hasLowPrecision=!0)}};z["hxd.BufferFormat"]=N;N.__name__="hxd.BufferFormat";N.get_COMPRESSED_CONFIG=function(){null==N.COMPRESSED_CONFIG&&(N.COMPRESSED_CONFIG=N.make([new Ma("data",4,1),new Ma("color",4,1),new Ma("position",2,1),new Ma("normal",3,3),new Ma("uv",2,1),new Ma("position",3,1)]),N.COMPRESSED_CONFIG.compressed=
N.COMPRESSED_CONFIG);return N.COMPRESSED_CONFIG};N.get_H2D=function(){return N.get_XY_UV_RGBA()};N.get_XY_UV_RGBA=function(){null==N.XY_UV_RGBA&&(N.XY_UV_RGBA=N.make([new Ma("position",2,0),new Ma("uv",2,0),new Ma("color",4,0)]));return N.XY_UV_RGBA};N.get_XY_UV=function(){null==N.XY_UV&&(N.XY_UV=N.make([new Ma("position",2,0),new Ma("uv",2,0)]));return N.XY_UV};N.get_POS3D=function(){null==N.POS3D&&(N.POS3D=N.make([new Ma("position",3,0)]));return N.POS3D};N.get_POS3D_NORMAL=function(){null==N.POS3D_NORMAL&&
(N.POS3D_NORMAL=N.make([new Ma("position",3,0),new Ma("normal",3,0)]));return N.POS3D_NORMAL};N.get_POS3D_NORMAL_UV=function(){null==N.POS3D_NORMAL_UV&&(N.POS3D_NORMAL_UV=N.make([new Ma("position",3,0),new Ma("normal",3,0),new Ma("uv",2,0)]));return N.POS3D_NORMAL_UV};N.get_POS3D_NORMAL_UV_RGBA=function(){null==N.POS3D_NORMAL_UV_RGBA&&(N.POS3D_NORMAL_UV_RGBA=N.get_POS3D_NORMAL_UV().append("color",4));return N.POS3D_NORMAL_UV_RGBA};N.get_POS3D_UV=function(){null==N.POS3D_UV&&(N.POS3D_UV=N.make([new Ma("position",
3,0),new Ma("uv",2,0)]));return N.POS3D_UV};N.get_VEC4_DATA=function(){null==N.VEC4_DATA&&(N.VEC4_DATA=N.make([new Ma("data",4,0)]));return N.VEC4_DATA};N.get_MAT4_DATA=function(){null==N.MAT4_DATA&&(N.MAT4_DATA=N.make([new Ma("data",16,0)]));return N.MAT4_DATA};N.get_INDEX16=function(){null==N.INDEX16&&(N.INDEX16=N.make([new Ma("index",1,1)]),N.INDEX16.strideBytes=2);return N.INDEX16};N.get_INDEX32=function(){null==N.INDEX32&&(N.INDEX32=N.make([new Ma("index",1,0)]));return N.INDEX32};N.fromID=function(a){for(var b=
N.ALL_FORMATS.h,c=Object.keys(b),d=c.length,e=0;e<d;)for(var f=b[c[e++]],g=0;g<f.length;){var h=f[g];++g;if(h.uid==a)return h}return null};N.make=function(a){for(var b,c,d=[],e=0;e<a.length;)b=a[e],++e,d.push(b.name);e=d.join("|");d=N.ALL_FORMATS.h[e];null==d&&(d=[],N.ALL_FORMATS.h[e]=d);for(e=0;e<d.length;){c=d[e];++e;for(var f=!0,g=0,h=a.length;g<h;){b=g++;var k=a[b];b=c.inputs[b];if(k.type!=b.type||k.name!=b.name||k.precision!=b.precision){f=!1;break}}if(f)return c}c=new N(a);d.push(c);return c};
N.float32to16=function(a,b){null==b&&(b=!1);var c=ob.floatToI32(a);a=(c&-2147483648)>>>16;var d=(c&2139095040)>>>23;c&=8388607;return 112<d?a|d-112<<10&31744|c>>13:113>d&&101<d&&!b?a|(8384512+c>>125-d)+1>>1:143<d?a|32767:0};N.float16to32=function(a){var b=(a&32768)<<16,c=(a&1023)<<13;a=(a&31744)>>10;if(0!=a)return ob.i32ToFloat(b|a+112<<23|c);if(0==c)return 0;a=ob.floatToI32(c)>>23;return ob.i32ToFloat(b|a-37<<23|c<<150-a&8380416)};N.float32toS8=function(a){a=Math.floor(128*a);return 127<=a?127:-127>=
a?128:0<=a?a:127+a|128};N.floatS8to32=function(a){return 0!=(a&128)?-1*(127-(a&127))/128:(a&127)/128};N.float32toU8=function(a){return 0>a?0:1<=a?255:Math.floor(256*a)};N.floatU8to32=function(a){return(a&255)/255};N.prototype={getInput:function(a){for(var b=0,c=this.inputs;b<c.length;){var d=c[b];++b;if(d.name==a)return d}return null},getCompressed:function(){if(null!=this.compressed)return this.compressed;var a=[],b=[];a.length=this.inputs.length;b.length=this.inputs.length;for(var c=0,d=0,e=this.inputs;d<
e.length;){var f=e[d],g=d++;var h=!1;for(var k=0,l=N.get_COMPRESSED_CONFIG().inputs;k<l.length;){var m=l[k],p=k++;if(f.type==m.type&&0==ua.compare(f.name,m.name)){h=m.type;c+=(h==Z.__cast(9,cc)?1:h)*qc.SIZES[m.precision];0!=(c&3)&&(c+=4-(c&3));a[g]=new Ma(m.name,m.type,m.precision);b[g]={compressedIndex:p,index:g};h=!0;break}}h||(h=f.type,c+=(h==Z.__cast(9,cc)?1:h)*qc.SIZES[f.precision],0!=(c&3)&&(c+=4-(c&3)),a[g]=new Ma(f.name,f.type,f.precision),b[g]={compressedIndex:-1,index:g})}d=c;0!=(d&7)&&
(d+=8-(d&7));if(d!=c)for(b.sort(function(a,b){return b.compressedIndex-a.compressedIndex}),e=0;e<b.length;){g=b[e];++e;f=a[g.index];h=f.type;h=(h==Z.__cast(9,cc)?1:h)*qc.SIZES[f.precision];0!=(h&3)&&(h+=4-(h&3));p=c-h;for(k=c;c<d&&0<f.precision;)k=c,--f.precision,h=f.type,c=p+(h==Z.__cast(9,cc)?1:h)*qc.SIZES[f.precision],0!=(c&3)&&(c+=4-(c&3));c>d&&(f.precision+=1,c=k);a[g.index]=f;if(c==d)break}this.compressed=N.make(a);return this.compressed.compressed=this.compressed},calculateInputOffset:function(a){for(var b=
0,c=0,d=this.inputs;c<d.length;){var e=d[c];++c;if(e.name==a)return b;var f=e.type;b+=(f==Z.__cast(9,cc)?1:f)*qc.SIZES[e.precision];0!=(b&3)&&(b+=4-(b&3))}throw u.thrown("Input not found : "+a);},hasInput:function(a,b){for(var c=0,d=this.inputs;c<d.length;){var e=d[c];++c;if(e.name==a)return null!=b?b==e.type:!0}return!1},append:function(a,b){var c=this.inputs.slice();c.push(new Ma(a,b,0));return N.make(c)},pop:function(){var a=this.inputs.slice();a.pop();return N.make(a)},isSubSet:function(a){if(a==
this)return!0;if(this.inputs.length>=a.inputs.length)return!1;for(var b=0,c=this.inputs.length;b<c;){var d=b++,e=this.inputs[d];d=a.inputs[d];if(e.name!=d.name||e.type!=d.type)return!1}return!0},resolveMapping:function(a){var b=null==this.mappings?null:this.mappings[a.uid];if(null!=b)return b;b=[];for(var c=0,d=a.inputs;c<d.length;){var e=d[c];++c;for(var f=!1,g=0,h=this.inputs;g<h.length;){var k=h[g];++g;if(k.name==e.name&&k.type==e.type){b.push(Uj._new(0,this.calculateInputOffset(k.name),k.precision));
f=!0;break}}if(!f)throw u.thrown("Missing buffer input '"+e.name+"'");}null==this.mappings&&(this.mappings=[]);return this.mappings[a.uid]=b},getInputs:function(){return new Sd(this.inputs)},toString:function(){for(var a=[],b=0,c=this.inputs;b<c.length;){var d=c[b];++b;a.push(d.name+":"+Jc.toString(d.type)+(0==d.precision?"":"."+qc.toString(d.precision).toLowerCase()))}return a.toString()},__class__:N};var cd=function(a){this.mappings=[];this.uid=cd._UID++;this.formats=a};z["hxd.MultiFormat"]=cd;
cd.__name__="hxd.MultiFormat";cd.make=function(a){if(a.length>cd.MAX_FORMATS){var b=[];for(var c=0;c<a.length;){var d=a[c];++c;b.push(d.toString())}throw u.thrown("Too many formats (addBuffer leak?) "+w.string(b));}c={found:null,nexts:cd.CACHE};for(b=0;b<a.length;){d=a[b];++b;var e=c.nexts.h[d.uid];null==e&&(e={found:null,nexts:new Da},c.nexts.h[d.uid]=e);c=e}null==c.found&&(c.found=new cd(a));return c.found};cd.prototype={resolveMapping:function(a){var b=this.mappings[a.uid];null==b&&(b=this.makeMapping(a));
return b},makeMapping:function(a){for(var b=[],c=0,d=a.inputs;c<d.length;){for(var e=d[c++],f=!1,g=null,h=0,k=this.formats;h<k.length;){var l=k[h],m=h++,p=l;l=p.getInput(e.name);if(null!=l&&(g=l,l.type==e.type)){f=p.calculateInputOffset(l.name);b.push(Uj._new(m,f,l.precision));f=!0;break}}if(!f){if(null!=g)throw u.thrown("Shader buffer "+e.name+" was requested with "+(null==e.type?"null":Jc.toString(e.type))+" but found with "+(null==g.type?"null":Jc.toString(g.type)));throw u.thrown("Missing shader buffer "+
e.name);}}return this.mappings[a.uid]=b},__class__:cd};var wb=function(){this.map=new Da;for(var a=0;94>a;){var b=a++;this.map.h[65281+b]=33+b}a=192;for(var c=199;a<c;)b=a++,this.map.h[b]=65;a=224;for(c=231;a<c;)b=a++,this.map.h[b]=97;a=200;for(c=204;a<c;)b=a++,this.map.h[b]=69;a=232;for(c=236;a<c;)b=a++,this.map.h[b]=101;a=204;for(c=208;a<c;)b=a++,this.map.h[b]=73;a=236;for(c=240;a<c;)b=a++,this.map.h[b]=105;a=210;for(c=215;a<c;)b=a++,this.map.h[b]=79;a=242;for(c=247;a<c;)b=a++,this.map.h[b]=111;
a=217;for(c=221;a<c;)b=a++,this.map.h[b]=85;a=249;for(c=253;a<c;)b=a++,this.map.h[b]=117;this.map.h[199]=67;this.map.h[231]=67;this.map.h[208]=68;this.map.h[222]=100;this.map.h[209]=78;this.map.h[241]=110;this.map.h[221]=89;this.map.h[253]=121;this.map.h[255]=121;this.map.h[8364]=69;this.map.h[12288]=32;this.map.h[160]=32;this.map.h[171]=34;this.map.h[187]=34;this.map.h[8220]=34;this.map.h[8221]=34;this.map.h[8222]=34;this.map.h[8216]=39;this.map.h[8217]=39;this.map.h[180]=39;this.map.h[8216]=39;
this.map.h[8249]=60;this.map.h[8250]=62;this.map.h[8211]=45};z["hxd.Charset"]=wb;wb.__name__="hxd.Charset";wb.getDefault=function(){null==wb.inst&&(wb.inst=new wb);return wb.inst};wb.prototype={resolveChar:function(a,b){for(;null!=a;){var c=b.h[a];if(null!=c)return c;a=this.map.h[a]}return null},isCJK:function(a){return 11904<=a&&42191>=a||63744<=a&&64255>=a?!0:131072<=a?262141>=a:!1},isSpace:function(a){return 32!=a?12288==a:!0},isBreakChar:function(a){return this.isSpace(a)?!0:this.isCJK(a)},isComplementChar:function(a){return wb.complementChars.h.hasOwnProperty(a)},
__class__:wb};var zc=L["hxd.Cursor"]={__ename__:!0,__constructs__:null,Default:{_hx_name:"Default",_hx_index:0,__enum__:"hxd.Cursor",toString:v},Button:{_hx_name:"Button",_hx_index:1,__enum__:"hxd.Cursor",toString:v},Move:{_hx_name:"Move",_hx_index:2,__enum__:"hxd.Cursor",toString:v},TextInput:{_hx_name:"TextInput",_hx_index:3,__enum__:"hxd.Cursor",toString:v},Hide:{_hx_name:"Hide",_hx_index:4,__enum__:"hxd.Cursor",toString:v},Custom:(A=function(a){return{_hx_index:5,custom:a,__enum__:"hxd.Cursor",
toString:v}},A._hx_name="Custom",A.__params__=["custom"],A),Callback:(A=function(a){return{_hx_index:6,f:a,__enum__:"hxd.Cursor",toString:v}},A._hx_name="Callback",A.__params__=["f"],A)};zc.__constructs__=[zc.Default,zc.Button,zc.Move,zc.TextInput,zc.Hide,zc.Custom,zc.Callback];zc.__empty_constructs__=[zc.Default,zc.Button,zc.Move,zc.TextInput,zc.Hide];var xh=function(a,b,c,d){this.frames=a;this.speed=b;this.offsetX=c;this.offsetY=d;this.frameDelay=1/b;this.frameIndex=this.frameTime=0};z["hxd.CustomCursor"]=
xh;xh.__name__="hxd.CustomCursor";xh.getNativeCursor=function(a){var b=new xh([],0,0,0);b.alloc=[a];return zc.Custom(b)};xh.prototype={reset:function(){this.frameIndex=this.frameTime=0},update:function(a){a=this.frameTime+a;for(var b=this.frameDelay,c=this.frameIndex;a>=b;)a-=b,++c;this.frameTime=a;c>=this.frames.length&&(c%=this.frames.length);return c!=this.frameIndex?this.frameIndex=c:-1},dispose:function(){for(var a=0,b=this.frames;a<b.length;){var c=b[a];++a;c.ctx=null;c.pixel=null}this.frames=
[];null!=this.alloc&&(this.alloc=null)},__class__:xh};var yh=function(a){this.file=a};z["hxd.DroppedFile"]=yh;yh.__name__="hxd.DroppedFile";yh.prototype={__class__:yh};var Gi=function(a,b,c){this.files=a;this.dropX=b;this.dropY=c};z["hxd.DropFileEvent"]=Gi;Gi.__name__="hxd.DropFileEvent";Gi.prototype={get_file:function(){return this.files[0]},__class__:Gi};var va=L["hxd.EventKind"]={__ename__:!0,__constructs__:null,EPush:{_hx_name:"EPush",_hx_index:0,__enum__:"hxd.EventKind",toString:v},ERelease:{_hx_name:"ERelease",
_hx_index:1,__enum__:"hxd.EventKind",toString:v},EMove:{_hx_name:"EMove",_hx_index:2,__enum__:"hxd.EventKind",toString:v},EOver:{_hx_name:"EOver",_hx_index:3,__enum__:"hxd.EventKind",toString:v},EOut:{_hx_name:"EOut",_hx_index:4,__enum__:"hxd.EventKind",toString:v},EWheel:{_hx_name:"EWheel",_hx_index:5,__enum__:"hxd.EventKind",toString:v},EFocus:{_hx_name:"EFocus",_hx_index:6,__enum__:"hxd.EventKind",toString:v},EFocusLost:{_hx_name:"EFocusLost",_hx_index:7,__enum__:"hxd.EventKind",toString:v},EKeyDown:{_hx_name:"EKeyDown",
_hx_index:8,__enum__:"hxd.EventKind",toString:v},EKeyUp:{_hx_name:"EKeyUp",_hx_index:9,__enum__:"hxd.EventKind",toString:v},EReleaseOutside:{_hx_name:"EReleaseOutside",_hx_index:10,__enum__:"hxd.EventKind",toString:v},ETextInput:{_hx_name:"ETextInput",_hx_index:11,__enum__:"hxd.EventKind",toString:v},ECheck:{_hx_name:"ECheck",_hx_index:12,__enum__:"hxd.EventKind",toString:v}};va.__constructs__=[va.EPush,va.ERelease,va.EMove,va.EOver,va.EOut,va.EWheel,va.EFocus,va.EFocusLost,va.EKeyDown,va.EKeyUp,
va.EReleaseOutside,va.ETextInput,va.ECheck];va.__empty_constructs__=[va.EPush,va.ERelease,va.EMove,va.EOver,va.EOut,va.EWheel,va.EFocus,va.EFocusLost,va.EKeyDown,va.EKeyUp,va.EReleaseOutside,va.ETextInput,va.ECheck];var ub=function(a,b,c){null==c&&(c=0);null==b&&(b=0);this.button=0;this.kind=a;this.relX=b;this.relY=c};z["hxd.Event"]=ub;ub.__name__="hxd.Event";ub.prototype={toString:function(){var a=w.string(this.kind)+"["+(this.relX|0)+","+(this.relY|0)+"]";switch(this.kind._hx_index){case 5:var b=
",wheelDelta="+this.wheelDelta;break;case 8:case 9:b=",keyCode="+this.keyCode;break;case 0:case 1:case 10:b=",button="+this.button;break;case 11:b=",charCode="+this.charCode;break;case 2:case 3:case 4:case 6:case 7:case 12:b=""}return a+b},__class__:ub};var Xd={_new:function(a){return{pos:a,array:new Float32Array(new ArrayBuffer(a<<2))}},get_length:function(a){return a.pos},set_length:function(a,b){if(a.pos!=b){var c=new Float32Array(b);c.set(a.array);a.array=c}return a.pos=b},push:function(a,b){if(a.pos==
a.array.length){var c=a.array.length<<1;128>c&&(c=128);c=new Float32Array(c);c.set(a.array);a.array=c}a.array[a.pos++]=b},get:function(a,b){return a.array[b]},set:function(a,b,c){return a.array[b]=c},toF32Array:function(a){return a.array},toArray:function(a){for(var b=[],c=0,d=a.pos;c<d;){var e=c++;b.push(a.array[e])}return b}},Bj=function(a){this.b=a;this.len=this.b.pos;this.pos=0};z["hxd._FloatBuffer.InnerIterator"]=Bj;Bj.__name__="hxd._FloatBuffer.InnerIterator";Bj.prototype={hasNext:function(){return this.pos<
this.len},next:function(){return this.b.array[this.pos++]},__class__:Bj};var Cj=function(a){this.b=a;this.len=this.b.length;this.pos=0};z["hxd._IndexBuffer.InnerIterator"]=Cj;Cj.__name__="hxd._IndexBuffer.InnerIterator";Cj.prototype={hasNext:function(){return this.pos<this.len},next:function(){return this.b[this.pos++]},__class__:Cj};var H=function(){};z["hxd.Key"]=H;H.__name__="hxd.Key";H.isDown=function(a){return 0<H.keyPressed[a]};H.getFrame=function(){return ba.frameCount+2};H.isPressed=function(a){return H.keyPressed[a]==
ba.frameCount+2-1};H.isReleased=function(a){return H.keyPressed[a]==-(ba.frameCount+2)+1};H.initialize=function(){H.initDone&&H.dispose();H.initDone=!0;H.keyPressed=[];Gb.getInstance().addEventTarget(H.onEvent)};H.dispose=function(){H.initDone&&(Gb.getInstance().removeEventTarget(H.onEvent),H.initDone=!1,H.keyPressed=[])};H.onEvent=function(a){switch(a.kind._hx_index){case 0:5>a.button&&(H.keyPressed[a.button]=ba.frameCount+2);break;case 1:5>a.button&&(H.keyPressed[a.button]=-(ba.frameCount+2));break;
case 5:H.keyPressed[0<a.wheelDelta?6:5]=ba.frameCount+2;break;case 8:if(!H.ALLOW_KEY_REPEAT&&0<H.keyPressed[a.keyCode])break;H.keyPressed[a.keyCode]=ba.frameCount+2;break;case 9:H.keyPressed[a.keyCode]=-(ba.frameCount+2);break;case 10:H.keyPressed=[]}};H.getKeyName=function(a){switch(a){case 0:return"MouseLeft";case 1:return"MouseRight";case 2:return"MouseMiddle";case 3:return"Mouse3";case 4:return"Mouse4";case 8:return"Backspace";case 9:return"Tab";case 13:return"Enter";case 16:return"Shift";case 17:return"Ctrl";
case 18:return"Alt";case 19:return"PauseBreak";case 20:return"CapsLock";case 27:return"Escape";case 32:return"Space";case 33:return"PageUp";case 34:return"PageDown";case 35:return"End";case 36:return"Home";case 37:return"Left";case 38:return"Up";case 39:return"Right";case 40:return"Down";case 45:return"Insert";case 46:return"Delete";case 91:return"LeftWindowKey";case 92:return"RightWindowKey";case 93:return"ContextMenu";case 106:return"NumPad*";case 107:return"NumPad+";case 108:return"NumPadEnter";
case 109:return"NumPad-";case 110:return"NumPad.";case 111:return"NumPad/";case 144:return"NumLock";case 145:return"ScrollLock";case 186:return"Semicolon";case 187:return"Equals";case 188:return"Comma";case 189:return"Minus";case 190:return"Period";case 191:return"Slash";case 192:return"Tilde";case 219:return"BracketLeft";case 220:return"Backslash";case 221:return"BracketRight";case 222:return"Quote";case 226:return"IntlBackslash";case 272:return"LShift";case 273:return"LCtrl";case 274:return"LAlt";
case 528:return"RShift";case 529:return"RCtrl";case 530:return"RAlt";default:return 48<=a&&57>=a?""+(a-48):96<=a&&105>=a?"NumPad"+(a-96):65<=a&&90>=a?String.fromCodePoint(65+a-65):112<=a&&135>=a?"F"+(a-112+1):null}};var X=function(){};z["hxd.Math"]=X;X.__name__="hxd.Math";X.get_POSITIVE_INFINITY=function(){return Infinity};X.get_NEGATIVE_INFINITY=function(){return-Infinity};X.get_NaN=function(){return NaN};X.isNaN=function(a){return isNaN(a)};X.fmt=function(a){if(0>a){var b=-1;a=-a}else b=1;if(isNaN(a)||
!isFinite(a))return a;var c=4-Math.log(a)/Math.log(10)|0;if(1>c)c=1;else if(10<=c)return 0;c=Math.pow(10,c);return Math.floor(a*c+.49999)*b/c};X.floor=function(a){return Math.floor(a)};X.ceil=function(a){return Math.ceil(a)};X.round=function(a){return Math.round(a)};X.clamp=function(a,b,c){null==c&&(c=1);null==b&&(b=0);return a<b?b:a>c?c:a};X.pow=function(a,b){return Math.pow(a,b)};X.cos=function(a){return Math.cos(a)};X.sin=function(a){return Math.sin(a)};X.tan=function(a){return Math.tan(a)};X.acos=
function(a){return Math.acos(a)};X.asin=function(a){return Math.asin(a)};X.atan=function(a){return Math.atan(a)};X.sqrt=function(a){return Math.sqrt(a)};X.invSqrt=function(a){return 1/Math.sqrt(a)};X.atan2=function(a,b){return Math.atan2(a,b)};X.abs=function(a){return 0>a?-a:a};X.max=function(a,b){return a<b?b:a};X.min=function(a,b){return a>b?b:a};X.iabs=function(a){return 0>a?-a:a};X.imax=function(a,b){return a<b?b:a};X.imin=function(a,b){return a>b?b:a};X.iclamp=function(a,b,c){return a<b?b:a>
c?c:a};X.lerp=function(a,b,c){return a+c*(b-a)};X.inverseLerp=function(a,b,c){return(c-a)/(b-a)};X.ease=function(a,b,c,d){var e=Math.pow(c,1+d);return a+e/(e+Math.pow(1-c,d+1))*(b-a)};X.easeFactor=function(a,b){var c=Math.pow(a,1+b);return c/(c+Math.pow(1-a,b+1))};X.lerpTime=function(a,b,c,d){return a+(1-Math.pow(1-c,d*ba.wantedFPS))*(b-a)};X.bitCount=function(a){a-=a>>1&1431655765;a=(a&858993459)+(a>>2&858993459);return 16843009*(a+(a>>4)&252645135)>>24};X.isPOT=function(a){return 0==(a&a-1)};X.nextPOT=
function(a){--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;return++a};X.distanceSq=function(a,b,c){null==c&&(c=0);return a*a+b*b+c*c};X.distance=function(a,b,c){null==c&&(c=0);null==c&&(c=0);return Math.sqrt(a*a+b*b+c*c)};X.colorLerp=function(a,b,c){return((a>>>24)*(1-c)+(b>>>24)*c|0)<<24|((a>>16&255)*(1-c)+(b>>16&255)*c|0)<<16|((a>>8&255)*(1-c)+(b>>8&255)*c|0)<<8|(a&255)*(1-c)+(b&255)*c|0};X.angle=function(a){a%=6.283185307179586;3.141592653589793<a?a-=6.283185307179586:-3.141592653589793>=a&&(a+=
6.283185307179586);return a};X.angleLerp=function(a,b,c){b=(b-a)%6.283185307179586;3.141592653589793<b?b-=6.283185307179586:-3.141592653589793>=b&&(b+=6.283185307179586);return a+b*c};X.angleMove=function(a,b,c){var d=(b-a)%6.283185307179586;3.141592653589793<d?d-=6.283185307179586:-3.141592653589793>=d&&(d+=6.283185307179586);return d>-c&&d<c?b:a+(0>d?-c:c)};X.valueMove=function(a,b,c){a<b?(a+=c,a>b&&(a=b)):a>b&&(a-=c,a<b&&(a=b));return a};X.shuffle=function(a){for(var b=a.length,c=0;c<b;){c++;var d=
w.random(b),e=w.random(b),f=a[d];a[d]=a[e];a[e]=f}};X.random=function(a){null==a&&(a=1);return Math.random()*a};X.srand=function(a){null==a&&(a=1);return 2*(Math.random()-.5)*a};X.b2f=function(a){return.00392156862745098*(a&255)};X.f2b=function(a){return 255*(0>a?0:1<a?1:a)|0};X.umod=function(a,b){a%=b;return 0<=a?a:a+b};X.ufmod=function(a,b){a%=b;return 0<=a?a:a+b};X.degToRad=function(a){return 3.141592653589793*a/180};X.radToDeg=function(a){return 180*a/3.141592653589793};var zd=L["hxd.Flags"]=
{__ename__:!0,__constructs__:null,ReadOnly:{_hx_name:"ReadOnly",_hx_index:0,__enum__:"hxd.Flags",toString:v},AlphaPremultiplied:{_hx_name:"AlphaPremultiplied",_hx_index:1,__enum__:"hxd.Flags",toString:v}};zd.__constructs__=[zd.ReadOnly,zd.AlphaPremultiplied];zd.__empty_constructs__=[zd.ReadOnly,zd.AlphaPremultiplied];var ak={getPixel:function(a,b,c){a=a.bytes.getInt32((b+c*a.width<<2)+a.offset);return a>>>24|a>>8&65280|a<<8&16711680|a<<24},setPixel:function(a,b,c,d){a.bytes.setInt32((b+c*a.width<<
2)+a.offset,d>>>24|d>>8&65280|d<<8&16711680|d<<24)},fromPixels:function(a){a.convert(F.ARGB);return a}},ya=function(a,b,c,d,e){null==e&&(e=0);this.width=a;this.height=b;this.bytes=c;this.set_innerFormat(d);this.offset=e;a=0;null==a&&(a=0);this.flags=a};z["hxd.Pixels"]=ya;ya.__name__="hxd.Pixels";ya.switchEndian=function(a){return a>>>24|a>>8&65280|a<<8&16711680|a<<24};ya.switchBR=function(a){return a&-16711936|a<<16&16711680|a>>16&255};ya.calcDataSize=function(a,b,c){return 22==c._hx_index?(b+3>>
2<<2)*ya.calcStride(a,c):b*ya.calcStride(a,c)};ya.calcStride=function(a,b){switch(b._hx_index){case 3:case 21:var c=8;break;case 4:c=16;break;case 5:c=1;break;case 6:case 18:c=2;break;case 7:c=4;break;case 8:c=2;break;case 9:case 19:c=4;break;case 10:c=8;break;case 11:c=3;break;case 12:case 20:c=6;break;case 13:c=12;break;case 0:case 1:case 2:case 14:case 15:c=4;break;case 16:c=4;break;case 17:c=4;break;case 22:return b=b.v,a=a+3>>2,1==b||4==b?a<<1:a<<2;case 23:c=2;break;case 24:c=3;break;case 25:case 26:c=
4}return a*c};ya.isFloatFormat=function(a){switch(a._hx_index){case 3:case 6:case 9:case 12:return!0;case 4:case 7:case 10:case 13:return!0;case 22:return 6==a.v?!0:!1;default:return!1}};ya.getChannelOffset=function(a,b){switch(a._hx_index){case 0:return[1,2,3,0][b];case 1:return[2,1,0,3][b];case 4:return 4*b;case 8:case 9:case 10:case 19:return a=ya.calcStride(1,a),[0,a,-1,-1][b];case 2:case 14:case 15:return b;case 16:case 17:throw u.thrown("Bit packed format");case 5:case 6:case 7:case 18:return 0==
b?0:-1;case 11:case 12:case 13:case 20:return a=ya.calcStride(1,a),[0,a,a<<1,-1][b];case 3:case 21:return 2*b;case 22:throw u.thrown("Not supported");case 23:case 24:case 25:case 26:throw u.thrown("Not supported");}};ya.alloc=function(a,b,c){return new ya(a,b,new S(new ArrayBuffer(ya.calcDataSize(a,b,c))),c)};ya.toDDSLayers=function(a,b){var c,d;null==b&&(b=!1);if(0==a.length)throw u.thrown("Must contain at least one image");var e=a[0],f=e.innerFormat,g=[],h=0;for(c=0;c<a.length;){var k=a[c];++c;
if(!la.enumEq(k.innerFormat,f))throw u.thrown("All images must be of the same pixel format");h+=k.dataSize;var l=!1;for(d=0;d<g.length;){var m=g[d];++d;if(m[0].width==k.width&&m[0].height==k.height){m.push(k);l=!0;break}}l||g.push([k])}g.sort(function(a,b){return b[0].width*b[0].height-a[0].width*a[0].height});k=g[0].length;m=g[0][0].width;var p=g[0][0].height;c=1;for(d=g.length;c<d;){l=c++;var t=g[l];if(t.length!=k)throw u.thrown("Invalid number of mipmaps at level "+l+": "+t.length+" should be "+
k);var n=m>>l;0==n&&(n=1);var r=p>>l;0==r&&(r=1);var q=t[0].width;t=t[0].height;if(q!=n||t!=r)throw u.thrown("Invalid mip level size "+l+": "+q+"x"+t+" should be "+n+"x"+r);}h+=128;(d=1<k&&!b)&&(h+=20);h=new S(new ArrayBuffer(h));n=0;h.setInt32(n,542327876);n+=4;h.setInt32(n,124);n+=4;h.setInt32(n,135183);n+=4;h.setInt32(n,p);n+=4;h.setInt32(n,m);n+=4;h.setInt32(n,e.stride);n+=4;h.setInt32(n,1);n+=4;h.setInt32(n,g.length);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,
0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,32);n+=4;if(d)h.setInt32(n,4),n+=4,h.setInt32(n,808540228),n+=4,h.setInt32(n,0),n+=4,h.setInt32(n,0),n+=4,h.setInt32(n,0),n+=4,h.setInt32(n,0),n+=4,h.setInt32(n,0),n+=4;else switch(f._hx_index){case 0:case 1:case 2:h.setInt32(n,65);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,32);n+=4;c=ya.getChannelOffset(f,0);h.setInt32(n,255<<8*c);n+=
4;c=ya.getChannelOffset(f,1);h.setInt32(n,255<<8*c);n+=4;c=ya.getChannelOffset(f,2);h.setInt32(n,255<<8*c);n+=4;c=ya.getChannelOffset(f,3);h.setInt32(n,255<<8*c);n+=4;break;default:h.setInt32(n,4);n+=4;switch(f._hx_index){case 3:c=113;break;case 4:c=116;break;case 6:c=111;break;case 7:c=114;break;case 9:c=112;break;case 10:c=115;break;default:throw u.thrown("Unsupported format "+w.string(f));}h.setInt32(n,c);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;
h.setInt32(n,0);n+=4}h.setInt32(n,d?4096:(1==a.length?0:8)|4096|(1==g.length?0:4194304));n+=4;h.setInt32(n,b?1536|(1<k?2048:0)|(2<k?4096:0)|(3<k?8192:0)|(4<k?16384:0)|(5<k?32768:0):0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,0);n+=4;if(d){switch(f._hx_index){case 2:h.setInt32(n,28);n+=4;break;case 22:switch(f.v){case 1:c=71;break;case 2:c=74;break;case 3:c=77;break;case 7:c=98;break;default:throw u.thrown("Unnsupported format "+w.string(f));}h.setInt32(n,c);n+=4;break;default:throw u.thrown("Unsupported DXT10 format "+
w.string(f));}h.setInt32(n,3);n+=4;h.setInt32(n,0);n+=4;h.setInt32(n,k);n+=4;h.setInt32(n,0);n+=4}c=0;for(d=k;c<d;)for(l=c++,a=0,b=g.length;a<b;)f=a++,k=g[f][l],h.blit(n,k.bytes,k.offset,k.dataSize),n+=k.dataSize;return h};ya.prototype={get_format:function(){return this.innerFormat},set_innerFormat:function(a){this.innerFormat=a;this.stride=ya.calcStride(this.width,a);this.dataSize=ya.calcDataSize(this.width,this.height,a);this.bytesPerPixel=ya.calcStride(1,a);return a},invalidFormat:function(){throw u.thrown("Unsupported format for this operation : "+
w.string(this.innerFormat));},sub:function(a,b,c,d){if(0>a||0>b||a+c>this.width||b+d>this.height)throw u.thrown("Pixels.sub() outside bounds");for(var e=new S(new ArrayBuffer(d*this.stride)),f=ya.calcStride(c,this.innerFormat),g=0,h=0;h<d;){var k=h++;e.blit(g,this.bytes,(a+(b+k)*this.width)*this.bytesPerPixel+this.offset,f);g+=f}return new ya(c,d,e,this.innerFormat)},blit:function(a,b,c,d,e,f,g){if(0>a||0>b||a+f>this.width||b+g>this.height)throw u.thrown("Pixels.blit() outside bounds");if(0>d||0>
d||d+f>c.width||e+g>c.height)throw u.thrown("Pixels.blit() outside src bounds");0!=(this.flags&1<<zd.ReadOnly._hx_index)&&this.copyInner();c.convert(this.innerFormat);var h=this.bytesPerPixel;if(0==h)throw u.thrown("assert");f=ya.calcStride(f,this.innerFormat);for(var k=0;k<g;){var l=k++;this.bytes.blit((a+(l+b)*this.width)*h+this.offset,c.bytes,(d+(l+e)*c.width)*h+c.offset,f)}},clear:function(a,b){null==b&&(b=0);var c=b;0!=(this.flags&1<<zd.ReadOnly._hx_index)&&this.copyInner();if((a&255)==(a>>8&
255)&&(a&65535)==a>>>16&&0==c)this.bytes.fill(this.offset,this.width*this.height*this.bytesPerPixel,a&255);else{switch(this.innerFormat._hx_index){case 0:a=a>>>24|a>>8&65280|a<<8&16711680|a<<24;c=c>>>24|c>>8&65280|c<<8&16711680|c<<24;break;case 1:break;case 2:a=a&-16711936|a<<16&16711680|a>>16&255;c=c&-16711936|c<<16&16711680|c>>16&255;break;default:this.invalidFormat()}var d=this.offset;if(0==c){var e=0;for(b=this.width*this.height;e<b;)e++,this.bytes.setInt32(d,a),d+=4}else for(e=0,b=this.width*
this.height;e<b;)e++,this.bytes.setInt32(d,a|this.bytes.getInt32(d)&c),d+=4}},toVector:function(){var a,b=Array(this.width*this.height),c=0,d=this.offset;switch(this.innerFormat._hx_index){case 0:for(var e=0,f=this.height;e<f;){e++;var g=0;for(a=this.width;g<a;){g++;var h=this.bytes.getInt32(d);b[c++]=h>>>24|h>>8&65280|h<<8&16711680|h<<24;d+=4}d+=0}break;case 1:e=0;for(f=this.height;e<f;){e++;g=0;for(a=this.width;g<a;)g++,b[c++]=this.bytes.getInt32(d),d+=4;d+=0}break;case 2:e=0;for(f=this.height;e<
f;){e++;g=0;for(a=this.width;g<a;)g++,h=this.bytes.getInt32(d),b[c++]=h&-16711936|h<<16&16711680|h>>16&255,d+=4;d+=0}break;default:this.invalidFormat()}return b},makeSquare:function(a){for(var b=this.width,c=this.height,d=0==b?0:1,e=0==c?0:1;d<b;)d<<=1;for(;e<c;)e<<=1;if(b==d&&c==e)return this;for(var f=this.bytesPerPixel,g=new S(new ArrayBuffer(d*e*f)),h=0,k=this.offset,l=0,m=c;l<m;){l++;g.blit(h,this.bytes,k,b*f);h+=b*f;k+=b*f;for(var p=0,t=(d-b)*f>>2;p<t;)p++,g.setInt32(h,0),h+=4}l=0;for(m=(e-
c)*d*f>>2;l<m;)l++,g.setInt32(h,0),h+=4;if(a)return new ya(d,e,g,this.innerFormat);this.bytes=g;this.width=d;this.height=e;return this},copyInner:function(){var a=this.bytes;this.bytes=new S(new ArrayBuffer(this.dataSize));this.bytes.blit(0,a,this.offset,this.dataSize);this.offset=0;this.flags&=-1-(1<<zd.ReadOnly._hx_index)},willChange:function(){0!=(this.flags&1<<zd.ReadOnly._hx_index)&&this.copyInner()},flipY:function(){0!=(this.flags&1<<zd.ReadOnly._hx_index)&&this.copyInner();0!=this.stride%4&&
this.invalidFormat();for(var a=0,b=this.height>>1;a<b;){var c=a++,d=c*this.stride+this.offset;c=(this.height-1-c)*this.stride+this.offset;for(var e=0,f=this.stride>>2;e<f;){e++;var g=this.bytes.getInt32(d),h=this.bytes.getInt32(c);this.bytes.setInt32(d,h);this.bytes.setInt32(c,g);d+=4;c+=4}}},convert:function(a){if(this.innerFormat!=a&&!la.enumEq(this.innerFormat,a)){0!=(this.flags&1<<zd.ReadOnly._hx_index)&&this.copyInner();var b=this.bytes.b;var c=this.innerFormat;switch(c._hx_index){case 0:switch(a._hx_index){case 1:var d=
0;for(c=this.width*this.height;d<c;){var e=d++;e=(e<<2)+this.offset;var f=b[e];var g=b[e+1];var h=b[e+2];var k=b[e+3];b[e++]=k;b[e++]=h;b[e++]=g;b[e]=f}break;case 2:d=0;for(c=this.width*this.height;d<c;)e=d++,e=(e<<2)+this.offset,f=b[e],k=b[e+1],b[e]=k,k=b[e+2],b[e+1]=k,k=b[e+3],b[e+2]=k,b[e+3]=f;break;default:throw u.thrown("Cannot convert from "+w.string(this.innerFormat)+" to "+w.string(a));}break;case 1:switch(a._hx_index){case 0:d=0;for(c=this.width*this.height;d<c;)e=d++,e=(e<<2)+this.offset,
f=b[e],g=b[e+1],h=b[e+2],k=b[e+3],b[e++]=k,b[e++]=h,b[e++]=g,b[e]=f;break;case 2:d=0;for(c=this.width*this.height;d<c;)e=d++,e=(e<<2)+this.offset,k=b[e],g=b[e+2],b[e]=g,b[e+2]=k;break;default:throw u.thrown("Cannot convert from "+w.string(this.innerFormat)+" to "+w.string(a));}break;case 2:switch(a._hx_index){case 0:d=0;for(c=this.width*this.height;d<c;)e=d++,e=(e<<2)+this.offset,f=b[e+3],k=b[e+2],b[e+3]=k,k=b[e+1],b[e+2]=k,k=b[e],b[e+1]=k,b[e]=f;break;case 1:d=0;for(c=this.width*this.height;d<c;)e=
d++,e=(e<<2)+this.offset,k=b[e],g=b[e+2],b[e]=g,b[e+2]=k;break;case 5:g=new S(new ArrayBuffer(this.width*this.height));f=g.b;d=0;for(c=this.width*this.height;d<c;)e=d++,k=b[e<<2],f[e]=k;this.bytes=g;break;default:throw u.thrown("Cannot convert from "+w.string(this.innerFormat)+" to "+w.string(a));}break;case 4:if(7==a._hx_index){g=new S(new ArrayBuffer(this.height*this.width*4));d=0;for(c=this.width*this.height;d<c;)e=d++,g.setFloat(e<<2,this.bytes.getFloat(e<<4));this.bytes=g}else throw u.thrown("Cannot convert from "+
w.string(this.innerFormat)+" to "+w.string(a));break;case 7:switch(a._hx_index){case 1:case 2:f=this.bytes;d=e=0;for(c=this.width*this.height;d<c;)d++,k=255*f.getFloat(e)|0,0>k?k=0:255<k&&(k=255),b[e++]=k,b[e++]=k,b[e++]=k,b[e++]=255;break;default:throw u.thrown("Cannot convert from "+w.string(this.innerFormat)+" to "+w.string(a));}break;case 18:if(7==a._hx_index){g=new S(new ArrayBuffer(this.width*this.height*4));f=this.bytes;d=0;for(c=this.width*this.height;d<c;)e=d++,b=f.getUInt16(e<<1),g.setFloat(e<<
2,b/65535);this.bytes=g}else throw u.thrown("Cannot convert from "+w.string(this.innerFormat)+" to "+w.string(a));break;case 22:if(22==a._hx_index){if(k=a.v,f=c.v,f!=k)throw u.thrown("Cannot convert from "+w.string(this.innerFormat)+" to "+w.string(a));}else throw u.thrown("Cannot convert from "+w.string(this.innerFormat)+" to "+w.string(a));break;default:throw u.thrown("Cannot convert from "+w.string(this.innerFormat)+" to "+w.string(a));}this.set_innerFormat(a)}},getPixel:function(a,b){a=(a+b*this.width)*
this.bytesPerPixel+this.offset;switch(this.innerFormat._hx_index){case 0:return a=this.bytes.getInt32(a),a>>>24|a>>8&65280|a<<8&16711680|a<<24;case 1:return this.bytes.getInt32(a);case 2:return a=this.bytes.getInt32(a),a&-16711936|a<<16&16711680|a>>16&255;case 5:return this.bytes.b[a];case 8:return a=this.bytes.getUInt16(a),(a&255)<<8|a>>8;default:return this.invalidFormat(),0}},setPixel:function(a,b,c){a=(a+b*this.width)*this.bytesPerPixel+this.offset;0!=(this.flags&1<<zd.ReadOnly._hx_index)&&this.copyInner();
switch(this.innerFormat._hx_index){case 0:this.bytes.setInt32(a,c>>>24|c>>8&65280|c<<8&16711680|c<<24);break;case 1:this.bytes.setInt32(a,c);break;case 2:this.bytes.setInt32(a,c&-16711936|c<<16&16711680|c>>16&255);break;case 5:this.bytes.b[a]=c;break;case 8:this.bytes.setUInt16(a,(c&255)<<8|(c&65280)>>8);break;default:this.invalidFormat()}},getPixelF:function(a,b,c){null==c&&(c=new T(0,0,0,1));var d=(a+b*this.width)*this.bytesPerPixel+this.offset;switch(this.innerFormat._hx_index){case 4:var e=c;
a=this.bytes.getFloat(d);b=this.bytes.getFloat(d+4);var f=this.bytes.getFloat(d+8);d=this.bytes.getFloat(d+12);null==d&&(d=1);null==f&&(f=0);null==b&&(b=0);null==a&&(a=0);e.x=a;e.y=b;e.z=f;e.w=d;return c;case 7:return e=c,a=this.bytes.getFloat(d),d=f=b=0,null==d&&(d=1),null==f&&(f=0),null==b&&(b=0),null==a&&(a=0),e.x=a,e.y=b,e.z=f,e.w=d,c;case 10:return e=c,a=this.bytes.getFloat(d),b=this.bytes.getFloat(d+4),d=f=0,null==d&&(d=1),null==f&&(f=0),null==b&&(b=0),null==a&&(a=0),e.x=a,e.y=b,e.z=f,e.w=d,
c;case 18:return e=c,a=this.bytes.getUInt16(d)/65535,d=f=b=0,null==d&&(d=1),null==f&&(f=0),null==b&&(b=0),null==a&&(a=0),e.x=a,e.y=b,e.z=f,e.w=d,c;default:return e=c,d=this.getPixel(a,b),e.x=(d>>16&255)/255,e.y=(d>>8&255)/255,e.z=(d&255)/255,e.w=(d>>>24)/255,c}},setPixelF:function(a,b,c){0!=(this.flags&1<<zd.ReadOnly._hx_index)&&this.copyInner();var d=(a+b*this.width)*this.bytesPerPixel+this.offset;switch(this.innerFormat._hx_index){case 4:this.bytes.setFloat(d,c.x);this.bytes.setFloat(d+4,c.y);this.bytes.setFloat(d+
8,c.z);this.bytes.setFloat(d+12,c.w);break;case 7:this.bytes.setFloat(d,c.x);break;default:d=c.w;var e=c.x,f=c.y;c=c.z;this.setPixel(a,b,(255*(0>d?0:1<d?1:d)+.499|0)<<24|(255*(0>e?0:1<e?1:e)+.499|0)<<16|(255*(0>f?0:1<f?1:f)+.499|0)<<8|255*(0>c?0:1<c?1:c)+.499|0)}},dispose:function(){this.bytes=null},toString:function(){return"Pixels("+this.width+"x"+this.height+" "+w.string(this.innerFormat)+")"},toPNG:function(a){null==a&&(a=9);0!=this.offset&&(this.bytes=this.bytes.sub(this.offset,ya.calcDataSize(this.width,
this.height,this.innerFormat)),this.offset=0);switch(this.innerFormat._hx_index){case 0:a=Hb.build32ARGB(this.width,this.height,this.bytes,a);break;case 5:a=Hb.buildGrey(this.width,this.height,this.bytes,a);break;default:this.convert(F.BGRA),a=Hb.build32BGRA(this.width,this.height,this.bytes,a)}var b=new Rc;(new $h(b)).write(a);return b.getBytes()},toDDS:function(){return ya.toDDSLayers([this])},clone:function(){var a=new ya(this.width,this.height,null,this.innerFormat);a.flags=this.flags;a.flags&=
-1-(1<<zd.ReadOnly._hx_index);null!=this.bytes&&(a.bytes=new S(new ArrayBuffer(this.dataSize)),a.bytes.blit(0,this.bytes,this.offset,this.dataSize));return a},__class__:ya};var Uh=function(a){this.defaultCursor=zc.Default;this.enablePhysicalMouse=this.mouseCheckMove=!0;this.isOut=!1;this.onOver=new ub(va.EOver);this.onOut=new ub(va.EOut);this.checkPos=new ub(va.ECheck);this.focusLost=new ub(va.EFocusLost);this.lastTouch=0;this.overIndex=this.mouseX=this.mouseY=-1;this.scenes=[];this.pendingEvents=
[];this.pushList=[];this.overList=[];this.overCandidates=[];null==a&&(a=Gb.getInstance());this.window=a;a.addEventTarget(M(this,this.onEvent))};z["hxd.SceneEvents"]=Uh;Uh.__name__="hxd.SceneEvents";Uh.prototype={setMousePos:function(a,b){this.mouseX=a;this.mouseY=b},onRemove:function(a){a==this.currentFocus&&(this.currentFocus=null);if(0<=this.overIndex){var b=this.overList.indexOf(a);0<=b&&(D.remove(this.overList,a),b<this.overIndex&&this.overIndex--)}else D.remove(this.overList,a),this.selectCursor();
D.remove(this.pushList,a)},addScene:function(a,b){a.setEvents(this);null==b?this.scenes.push(a):this.scenes.splice(b,0,a)},removeScene:function(a){D.remove(this.scenes,a)&&a.setEvents(null)},dispose:function(){this.window.removeEventTarget(M(this,this.onEvent))},focus:function(a){if(this.currentFocus!=a)if(null==a)this.blur();else{if(null!=this.currentFocus&&(this.blur(),null!=this.currentFocus))return;var b=new ub(va.EFocus);a.handleEvent(b);b.cancel||(this.currentFocus=a)}},blur:function(){null!=
this.currentFocus&&(this.focusLost.cancel=!1,this.currentFocus.handleEvent(this.focusLost),this.focusLost.cancel||(this.currentFocus=null))},checkFocus:function(){if(null!=this.currentFocus){var a=this.currentFocus.getInteractiveScene();null==a?this.currentFocus=null:a.isInteractiveVisible(this.currentFocus)||this.blur()}},emitEvent:function(a){var b,c,d,e=a.relX,f=a.relY,g=0,h=!1,k=!1,l=d=!1,m=!1,p=!1;this.overIndex=0;switch(a.kind._hx_index){case 0:l=m=!0;break;case 1:l=!0;break;case 5:case 8:case 9:case 11:if(null!=
this.currentFocus&&(a.relX=a.relY=0,this.currentFocus.handleEvent(a),a.relX=e,a.relY=f,!a.propagate))return;break;case 2:case 12:d=k=!0}var t=0;for(c=this.scenes;t<c.length;){var n=c[t];++t;for(b=null;;){b=n.handleEvent(a,b);if(null==b){a.relX=e;a.relY=f;break}if(k){if(d){d=this.overList.indexOf(b);if(-1==d)this.overCandidates.length==g?this.overCandidates[g]={i:b,s:n,x:a.relX,y:a.relY,z:a.relZ}:(d=this.overCandidates[g],d.i=b,d.s=n,d.x=a.relX,d.y=a.relY,d.z=a.relZ),++g,this.overList.splice(this.overIndex++,
0,b),p=!0;else{if(d<this.overIndex){do this.overList[d]=this.overList[d+1],++d;while(d<this.overIndex);this.overList[this.overIndex]=b;p=!0}else if(d>this.overIndex){do this.overList[d]=this.overList[d-1],--d;while(d>this.overIndex);this.overList[this.overIndex]=b;p=!0}this.overIndex++}d=a.propagate}}else l&&(a.kind==va.EPush?this.pushList.push(b):D.remove(this.pushList,b)),m&&b==this.currentFocus&&(m=!1);a.relX=e;a.relY=f;if(!a.propagate){h=!0;break}a.propagate=!1}if(h)break}m&&null!=this.currentFocus&&
this.blur();if(k){if(this.overIndex<this.overList.length){for(;this.overIndex<this.overList.length;)this.overList.pop().handleEvent(this.onOut);p=!0}if(0!=g){b=0;n=this.onOver;do d=this.overCandidates[b++],n.relX=d.x,n.relY=d.y,n.relZ=d.z,d.s.isInteractiveVisible(d.i)?d.i.handleEvent(n):D.remove(this.overList,d.i),d.i=null,d.s=null;while(b<g)}}this.overIndex=-1;p&&this.selectCursor();h||a==this.checkPos||(a.kind==va.EPush?this.pushList.push(null):a.kind==va.ERelease&&D.remove(this.pushList,null),
this.dispatchListeners(a));if(a.kind==va.ERelease&&0<this.pushList.length){t=0;for(c=this.pushList;t<c.length;)b=c[t],++t,null==b?(a.kind=va.EReleaseOutside,this.dispatchListeners(a),a.kind=va.ERelease):(n=b.getInteractiveScene(),null!=n&&(a.kind=va.EReleaseOutside,n.dispatchEvent(a,b),a.kind=va.ERelease,a.relX=e,a.relY=f));this.pushList=[]}},checkEvents:function(){var a=this.pendingEvents,b=!this.mouseCheckMove,c=null==this.currentFocus;if(0<a.length){this.pendingEvents=[];for(var d=0;d<a.length;){var e=
a[d];++d;var f=e.relX,g=e.relY;switch(e.kind._hx_index){case 0:case 1:this.mouseX=e.relX;this.mouseY=e.relY;this.lastTouch=e.touchId;break;case 2:b=!0;this.mouseX=e.relX;this.mouseY=e.relY;this.lastTouch=e.touchId;break;case 3:this.isOut=!1;this.selectCursor();continue;case 4:this.isOut=!0;if(0<this.overList.length){for(e=this.overList.length-1;0<=e;)this.onOut.cancel=!1,this.overList[e].handleEvent(this.onOut),D.remove(this.overList,this.overList[e]),--e;this.selectCursor()}continue;case 5:case 8:case 9:case 11:c||
(c=!0,this.checkFocus())}if(null!=this.currentDrag&&(null==this.currentDrag.ref||this.currentDrag.ref==e.touchId)){e.propagate=!0;e.cancel=!1;this.currentDrag.f(e);e.relX=f;e.relY=g;if(!e.propagate)continue;e.propagate=!1}this.emitEvent(e)}}c||this.checkFocus();b||this.isOut||null!=this.currentDrag||(this.checkPos.relX=this.mouseX,this.checkPos.relY=this.mouseY,this.checkPos.touchId=this.lastTouch,this.checkPos.cancel=!1,this.checkPos.propagate=!1,this.emitEvent(this.checkPos))},startCapture:function(a,
b,c){if(null!=this.currentDrag&&null!=this.currentDrag.onCancel)this.currentDrag.onCancel();this.currentDrag={f:a,ref:c,onCancel:b}},stopCapture:function(){if(null!=this.currentDrag&&null!=this.currentDrag.onCancel)this.currentDrag.onCancel();this.currentDrag=null},startDrag:function(a,b,c){this.startCapture(a,b,null!=c?c.touchId:null)},stopDrag:function(){this.stopCapture()},getFocus:function(){return this.currentFocus},updateCursor:function(a){-1!=this.overList.indexOf(a)&&this.selectCursor()},
set_defaultCursor:function(a){if(la.enumEq(a,this.defaultCursor))return a;this.defaultCursor=a;this.selectCursor();return a},selectCursor:function(){for(var a=this.defaultCursor,b=0,c=this.overList;b<c.length;){var d=c[b];++b;if(null!=d.cursor){a=d.cursor;break}}6==a._hx_index?(a=a.f,a()):ia.setCursor(a)},onEvent:function(a){(this.enablePhysicalMouse||a.kind!=va.EMove)&&this.pendingEvents.push(a)},dispatchListeners:function(a){var b=a.relX,c=a.relY;a.propagate=!0;for(var d=0,e=this.scenes;d<e.length;){var f=
e[d];++d;a.cancel=!1;f.dispatchListeners(a);a.relX=b;a.relY=c;if(!a.propagate)break}},__class__:Uh};var hc=L["hxd.Platform"]={__ename__:!0,__constructs__:null,IOS:{_hx_name:"IOS",_hx_index:0,__enum__:"hxd.Platform",toString:v},Android:{_hx_name:"Android",_hx_index:1,__enum__:"hxd.Platform",toString:v},WebGL:{_hx_name:"WebGL",_hx_index:2,__enum__:"hxd.Platform",toString:v},PC:{_hx_name:"PC",_hx_index:3,__enum__:"hxd.Platform",toString:v},Console:{_hx_name:"Console",_hx_index:4,__enum__:"hxd.Platform",
toString:v},FlashPlayer:{_hx_name:"FlashPlayer",_hx_index:5,__enum__:"hxd.Platform",toString:v}};hc.__constructs__=[hc.IOS,hc.Android,hc.WebGL,hc.PC,hc.Console,hc.FlashPlayer];hc.__empty_constructs__=[hc.IOS,hc.Android,hc.WebGL,hc.PC,hc.Console,hc.FlashPlayer];var je=L["hxd.SystemValue"]={__ename__:!0,__constructs__:null,IsTouch:{_hx_name:"IsTouch",_hx_index:0,__enum__:"hxd.SystemValue",toString:v},IsWindowed:{_hx_name:"IsWindowed",_hx_index:1,__enum__:"hxd.SystemValue",toString:v},IsMobile:{_hx_name:"IsMobile",
_hx_index:2,__enum__:"hxd.SystemValue",toString:v}};je.__constructs__=[je.IsTouch,je.IsWindowed,je.IsMobile];je.__empty_constructs__=[je.IsTouch,je.IsWindowed,je.IsMobile];var ba=function(){};z["hxd.Timer"]=ba;ba.__name__="hxd.Timer";ba.update=function(){ba.frameCount++;var a=D.now()/1E3;ba.elapsedTime=a-ba.lastTimeStamp;ba.lastTimeStamp=a;ba.elapsedTime<ba.maxDeltaTime?(a=ba.elapsedTime,ba.currentDT=a+ba.smoothFactor*(ba.currentDT-a)):ba.elapsedTime=1/ba.wantedFPS;ba.dt=ba.currentDT};ba.get_tmod=
function(){return ba.dt*ba.wantedFPS};ba.set_tmod=function(a){ba.dt=a/ba.wantedFPS;return a};ba.fps=function(){return 1/ba.currentDT};ba.skip=function(){ba.lastTimeStamp=D.now()/1E3};ba.reset=function(){ba.lastTimeStamp=D.now()/1E3;ba.dt=ba.currentDT=1/ba.wantedFPS};var Gb=function(a,b){this.canLockMouse=!0;this.discardMouseUp=-1;this.discardMouseCaptureEvent=!0;this.useScreenPixels=rf.get_supported();this.curMouseX=this.curMouseY=0;this.mouseMode=ic.Absolute;var c=this,d=null!=a;this.eventTargets=
new nc;this.resizeEvents=new nc;this.dropTargets=new nc;if(rf.get_supported()){if(null==a){a=window.document.getElementById("webgl");if(null==a)throw u.thrown("Missing canvas #webgl");"1"==a.getAttribute("globalEvents")&&(b=!0)}this.canvas=a;this.propagateKeyEvents=b;var e=a.getAttribute("propagateKeyEvents");null!=e&&(this.propagateKeyEvents="0"!=e&&"false"!=e);this.element=(this.focused=b)?window:a;this.canvasPos=a.getBoundingClientRect();d?a.addEventListener("mousemove",M(this,this.onMouseMove)):
window.addEventListener("mousemove",M(this,this.onMouseMove));this.element.addEventListener("mousedown",M(this,this.onMouseDown));this.element.addEventListener("mouseup",M(this,this.onMouseUp));this.element.addEventListener("mouseleave",M(this,this.onMouseLeave));this.element.addEventListener("wheel",M(this,this.onMouseWheel));this.element.addEventListener("touchstart",M(this,this.onTouchStart));this.element.addEventListener("touchmove",M(this,this.onTouchMove));this.element.addEventListener("touchend",
M(this,this.onTouchEnd));this.element.addEventListener("keydown",M(this,this.onKeyDown));this.element.addEventListener("keyup",M(this,this.onKeyUp));this.element.addEventListener("keypress",M(this,this.onKeyPress));var f=this;this.element.addEventListener("blur",function(){f.onFocus(!1)});var g=this;this.element.addEventListener("focus",function(){g.onFocus(!0)});null!=window.ResizeObserver&&(this.observer=new ResizeObserver(function(a){c.checkResize()}),this.observer.observe(a));window.addEventListener("resize",
M(this,this.checkResize));window.document.addEventListener("pointerlockchange",M(this,this.onPointerLockChange));a.addEventListener("contextmenu",function(a){a.stopPropagation();2==a.button&&a.preventDefault();return!1});b?(a.addEventListener("mousedown",function(a){c.onMouseDown(a);a.stopPropagation();a.preventDefault()}),this.element.addEventListener("contextmenu",function(a){a.stopPropagation();a.preventDefault();return!1})):(null==a.getAttribute("tabindex")&&a.setAttribute("tabindex","1"),a.style.outline=
"none");this.curW=this.get_width();this.curH=this.get_height()}else this.canvasPos={width:0,top:0,left:0,height:0}};z["hxd.Window"]=Gb;Gb.__name__="hxd.Window";Gb.getInstance=function(){null==Gb.inst&&(Gb.inst=new Gb);return Gb.inst};Gb.prototype={checkResize:function(){this.canvasPos=this.canvas.getBoundingClientRect();var a=this.get_width(),b=this.get_height();if(this.curW!=a||this.curH!=b)this.curW=a,this.curH=b,this.onResize(null)},dispose:function(){Gb.inst==this&&(Gb.inst=null);null!=window.ResizeObserver&&
null!=this.observer&&(this.observer.disconnect(),this.observer=null)},onClose:function(){return!0},onMouseModeChange:function(a,b){return null},event:function(a){for(var b=this.eventTargets.h;null!=b;){var c=b.item;b=b.next;c(a)}},addEventTarget:function(a){this.eventTargets.add(a)},removeEventTarget:function(a){for(var b=this.eventTargets.h;null!=b;){var c=b.item;b=b.next;if(c==a){this.eventTargets.remove(c);break}}},addResizeEvent:function(a){this.resizeEvents.push(a)},removeResizeEvent:function(a){for(var b=
this.resizeEvents.h;null!=b;){var c=b.item;b=b.next;if(c==a){this.resizeEvents.remove(a);break}}},onResize:function(a){for(a=this.resizeEvents.h;null!=a;){var b=a.item;a=a.next;b()}},resize:function(a,b){},addDragAndDropTarget:function(a){if(0==this.dropTargets.length){var b=this.canvas;b.addEventListener("dragover",M(this,this.handleDragAndDropEvent));b.addEventListener("drop",M(this,this.handleDragAndDropEvent))}this.dropTargets.add(a)},removeDragAndDropTarget:function(a){for(var b=this.dropTargets.h;null!=
b;){var c=b.item;b=b.next;if(c==a){this.dropTargets.remove(a);break}}0==this.dropTargets.length&&(a=this.canvas,a.removeEventListener("dragover",M(this,this.handleDragAndDropEvent)),a.removeEventListener("drop",M(this,this.handleDragAndDropEvent)))},handleDragAndDropEvent:function(a){a.preventDefault();if("dragover"!=a.type&&null!=a.dataTransfer&&0!=a.dataTransfer.files.length){for(var b=[],c=0,d=a.dataTransfer.files;c<d.length;){var e=d[c];++c;b.push(new zh(e))}a=new Gi(b,Math.round((a.clientX-this.canvasPos.left)*
this.getPixelRatio()),Math.round((a.clientY-this.canvasPos.top)*this.getPixelRatio()));for(b=this.dropTargets.h;null!=b;)c=b.item,b=b.next,c(a)}},setFullScreen:function(a){var b=window.document,c=b.documentElement;b.fullscreenElement==c!=a&&(a?c.requestFullscreen():b.exitFullscreen())},setCursorPos:function(a,b,c){null==c&&(c=!1);if(this.mouseMode==ic.Absolute)throw u.thrown("setCursorPos only allowed in relative mouse modes on this platform.");this.curMouseX=a+this.canvasPos.left;this.curMouseY=
b+this.canvasPos.top;c&&this.event(new ub(va.EMove,a,b))},setCurrent:function(){Gb.inst=this},getPixelRatio:function(){return this.useScreenPixels?window.devicePixelRatio:1},get_width:function(){return Math.round(this.canvasPos.width*this.getPixelRatio())},get_height:function(){return Math.round(this.canvasPos.height*this.getPixelRatio())},get_mouseX:function(){return Math.round((this.curMouseX-this.canvasPos.left)*this.getPixelRatio())},get_mouseY:function(){return Math.round((this.curMouseY-this.canvasPos.top)*
this.getPixelRatio())},get_mouseLock:function(){return 2==this.mouseMode._hx_index?!0:!1},set_mouseLock:function(a){return la.enumEq(this.set_mouseMode(a?ic.AbsoluteUnbound(!0):ic.Absolute),ic.AbsoluteUnbound(!0))},get_mouseClip:function(){return!1},set_mouseClip:function(a){if(a)throw u.thrown("Can't clip cursor on this platform.");return!1},set_mouseMode:function(a){if(la.enumEq(a,this.mouseMode))return a;var b=this.onMouseModeChange(this.mouseMode,a);null!=b&&(a=b);b=this.pointerLockTarget=null!=
this.canvas?this.canvas:window.document.documentElement;a==ic.Absolute?b.ownerDocument.pointerLockElement==b&&b.ownerDocument.exitPointerLock():this.canLockMouse&&b.ownerDocument.pointerLockElement!=b&&b.requestPointerLock();return this.mouseMode=a},get_vsync:function(){return!0},set_vsync:function(a){if(!a)throw u.thrown("Can't disable vsync on this platform");return!0},onPointerLockChange:function(a){this.mouseMode!=ic.Absolute&&this.pointerLockTarget.ownerDocument.pointerLockElement!=this.pointerLockTarget&&
(this.canLockMouse=!1,this.set_mouseMode(ic.Absolute),this.canLockMouse=!0)},onMouseDown:function(a){if(this.mouseMode==ic.Absolute){if(a.clientX!=this.curMouseX||a.clientY!=this.curMouseY)this.onMouseMove(a)}else{if(this.pointerLockTarget.ownerDocument.pointerLockElement!=this.pointerLockTarget&&(this.pointerLockTarget.requestPointerLock(),this.discardMouseCaptureEvent)){this.discardMouseUp=a.button;return}if(0!=a.movementX||0!=a.movementY)this.onMouseMove(a)}var b=new ub(va.EPush,this.get_mouseX(),
this.get_mouseY());a=a.button;switch(a){case 1:a=2;break;case 2:a=1}b.button=a;this.event(b)},onMouseUp:function(a){if(this.discardMouseUp==a.button)this.discardMouseUp=-1;else{if(this.mouseMode==ic.Absolute?a.clientX!=this.curMouseX||a.clientY!=this.curMouseY:0!=a.movementX||0!=a.movementY)this.onMouseMove(a);var b=new ub(va.ERelease,this.get_mouseX(),this.get_mouseY());a=a.button;switch(a){case 1:a=2;break;case 2:a=1}b.button=a;this.event(b)}},onMouseLeave:function(a){var b=new ub(va.EReleaseOutside,
this.get_mouseX(),this.get_mouseY());a=a.button;switch(a){case 1:a=2;break;case 2:a=1}b.button=a;this.event(b)},onMouseMove:function(a){var b=this.mouseMode;switch(b._hx_index){case 0:this.curMouseX=a.clientX;this.curMouseY=a.clientY;this.event(new ub(va.EMove,this.get_mouseX(),this.get_mouseY()));break;case 1:b=b.callback;if(this.pointerLockTarget.ownerDocument.pointerLockElement!=this.pointerLockTarget)break;a=new ub(va.EMove,a.movementX,a.movementY);b(a);!a.cancel&&a.propagate&&(a.cancel=!1,a.propagate=
!1,a.relX=this.curMouseX,a.relY=this.curMouseY,this.event(a));break;case 2:this.pointerLockTarget.ownerDocument.pointerLockElement==this.pointerLockTarget&&(this.curMouseX+=a.movementX,this.curMouseY+=a.movementY,this.event(new ub(va.EMove,this.get_mouseX(),this.get_mouseY())))}},onMouseWheel:function(a){a.preventDefault();var b=new ub(va.EWheel,this.get_mouseX(),this.get_mouseY());b.wheelDelta=a.deltaY/120;this.event(b)},onTouchStart:function(a){a.preventDefault();var b=0;for(a=a.changedTouches;b<
a.length;){var c=a[b];++b;var d=Math.round((c.clientX-this.canvasPos.left)*this.getPixelRatio());var e=Math.round((c.clientY-this.canvasPos.top)*this.getPixelRatio());d=new ub(va.EPush,d,e);d.touchId=c.identifier;this.event(d)}},onTouchMove:function(a){a.preventDefault();var b=0;for(a=a.changedTouches;b<a.length;){var c=a[b];++b;var d=Math.round((c.clientX-this.canvasPos.left)*this.getPixelRatio());var e=Math.round((c.clientY-this.canvasPos.top)*this.getPixelRatio());d=new ub(va.EMove,d,e);d.touchId=
c.identifier;this.event(d)}},onTouchEnd:function(a){a.preventDefault();var b=0;for(a=a.changedTouches;b<a.length;){var c=a[b];++b;var d=Math.round((c.clientX-this.canvasPos.left)*this.getPixelRatio());var e=Math.round((c.clientY-this.canvasPos.top)*this.getPixelRatio());d=new ub(va.ERelease,d,e);d.touchId=c.identifier;this.event(d)}},onKeyUp:function(a){var b=new ub(va.EKeyUp,this.get_mouseX(),this.get_mouseY());b.keyCode=a.keyCode;this.event(b);this.propagateKeyEvents||(a.preventDefault(),a.stopPropagation())},
onKeyDown:function(a){var b=new ub(va.EKeyDown,this.get_mouseX(),this.get_mouseY());b.keyCode=a.keyCode;this.event(b);if(!this.propagateKeyEvents){switch(b.keyCode){case 8:case 9:case 16:case 17:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:a.preventDefault()}a.stopPropagation()}},onKeyPress:function(a){var b=new ub(va.ETextInput,this.get_mouseX(),this.get_mouseY());b.charCode=a.charCode;this.event(b);this.propagateKeyEvents||(a.preventDefault(),a.stopPropagation())},onFocus:function(a){this.event(new ub(a?
va.EFocus:va.EFocusLost));this.focused=a},get_isFocused:function(){return this.focused},get_displayMode:function(){return null!=window.document.fullscreenElement?Yc.Borderless:Yc.Windowed},set_displayMode:function(a){if(!rf.get_supported())return a;var b=window.document,c=b.documentElement;if(b.fullscreenElement==c==(a!=Yc.Windowed))return Yc.Windowed;a!=Yc.Windowed?c.requestFullscreen():b.exitFullscreen();return a},get_title:function(){return window.document.title},set_title:function(a){return window.document.title=
a},__class__:Gb};var rf=function(){};z["js.Browser"]=rf;rf.__name__="js.Browser";rf.get_supported=function(){return"undefined"!=typeof window&&"undefined"!=typeof window.location?"string"==typeof window.location.protocol:!1};var ia=function(){};z["hxd.System"]=ia;ia.__name__="hxd.System";ia.timeoutTick=function(){};ia.getCurrentLoop=function(){return ia.loopFunc};ia.setLoop=function(a){ia.loopInit||(ia.loopInit=!0,ia.browserLoop());ia.loopFunc=a};ia.browserLoop=function(){if(rf.get_supported()){var a=
window,b=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame;0<ia.fpsLimit?window.setTimeout(function(){return b(ia.browserLoop)},1E3/ia.fpsLimit):b(ia.browserLoop)}else throw u.thrown("Cannot use browserLoop without Browser support nor defining nodejs + hxnodejs");null!=ia.loopFunc&&ia.loopFunc()};ia.start=function(a){a()};ia.setNativeCursor=function(a){if(null==ia.currentNativeCursor||!la.enumEq(a,ia.currentNativeCursor)){ia.currentNativeCursor=a;ia.currentCustomCursor=
null;var b=Gb.getInstance().canvas;if(null!=b){switch(a._hx_index){case 0:var c="default";break;case 1:c="pointer";break;case 2:c="move";break;case 3:c="text";break;case 4:c="none";break;case 5:c=a.custom;if(null==c.alloc){c.alloc=[];a=0;for(var d=c.frames;a<d.length;){var e=d[a];++a;c.alloc.push('url("'+e.ctx.canvas.toDataURL("image/png")+'") '+c.offsetX+" "+c.offsetY+", default")}}1<c.frames.length&&(ia.currentCustomCursor=c,c.reset());c=c.alloc[c.frameIndex];break;case 6:throw u.thrown("assert");
}b.style.cursor=c}}};ia.getDeviceName=function(){return"Unknown"};ia.getDefaultFrameRate=function(){return 60};ia.getValue=function(a){switch(a._hx_index){case 0:return ia.get_platform()!=hc.Android?ia.get_platform()==hc.IOS:!0;case 1:return!0;case 2:return ia.get_platform()!=hc.Android?ia.get_platform()==hc.IOS:!0}};ia.exit=function(){};ia.openURL=function(a){window.open(a,"_blank")};ia.updateCursor=function(){if(null!=ia.currentCustomCursor){var a=ia.currentCustomCursor.update(ba.elapsedTime);if(-1!=
a){var b=Gb.getInstance().canvas;null!=b&&(b.style.cursor=ia.currentCustomCursor.alloc[a])}}};ia.getClipboardText=function(){return null};ia.setClipboardText=function(a){return!1};ia.getLocale=function(){return W.navigator.language+"_"+W.navigator.language.toUpperCase()};ia.get_width=function(){return Math.round(window.document.body.clientWidth*window.devicePixelRatio)};ia.get_height=function(){return Math.round(window.document.body.clientHeight*window.devicePixelRatio)};ia.get_lang=function(){return W.navigator.language};
ia.get_platform=function(){var a=W.navigator.userAgent.toLowerCase();return 0<=a.indexOf("android")?hc.Android:0<=a.indexOf("ipad")||0<=a.indexOf("iphone")||0<=a.indexOf("ipod")?hc.IOS:hc.PC};ia.get_screenDPI=function(){return 72};ia.get_allowTimeout=function(){return!1};ia.set_allowTimeout=function(a){return!1};var Yc=L["hxd.DisplayMode"]={__ename__:!0,__constructs__:null,Windowed:{_hx_name:"Windowed",_hx_index:0,__enum__:"hxd.DisplayMode",toString:v},Borderless:{_hx_name:"Borderless",_hx_index:1,
__enum__:"hxd.DisplayMode",toString:v},Fullscreen:{_hx_name:"Fullscreen",_hx_index:2,__enum__:"hxd.DisplayMode",toString:v},FullscreenResize:{_hx_name:"FullscreenResize",_hx_index:3,__enum__:"hxd.DisplayMode",toString:v}};Yc.__constructs__=[Yc.Windowed,Yc.Borderless,Yc.Fullscreen,Yc.FullscreenResize];Yc.__empty_constructs__=[Yc.Windowed,Yc.Borderless,Yc.Fullscreen,Yc.FullscreenResize];var zh=function(a){this.file=a.name;this.native=a};z["hxd._Window.NativeDroppedFile"]=zh;zh.__name__="hxd._Window.NativeDroppedFile";
zh.__super__=yh;zh.prototype=J(yh.prototype,{getBytes:function(a){var b=new FileReader;b.onload=function(c){a(S.ofData(b.result))};b.onerror=function(b){a(null)};b.readAsArrayBuffer(this.native)},__class__:zh});var bc=L["hxd.clipper.ClipType"]={__ename__:!0,__constructs__:null,Intersection:{_hx_name:"Intersection",_hx_index:0,__enum__:"hxd.clipper.ClipType",toString:v},Union:{_hx_name:"Union",_hx_index:1,__enum__:"hxd.clipper.ClipType",toString:v},Difference:{_hx_name:"Difference",_hx_index:2,__enum__:"hxd.clipper.ClipType",
toString:v},Xor:{_hx_name:"Xor",_hx_index:3,__enum__:"hxd.clipper.ClipType",toString:v}};bc.__constructs__=[bc.Intersection,bc.Union,bc.Difference,bc.Xor];bc.__empty_constructs__=[bc.Intersection,bc.Union,bc.Difference,bc.Xor];var tc=L["hxd.clipper._Clipper.EdgeSide"]={__ename__:!0,__constructs__:null,Left:{_hx_name:"Left",_hx_index:0,__enum__:"hxd.clipper._Clipper.EdgeSide",toString:v},Right:{_hx_name:"Right",_hx_index:1,__enum__:"hxd.clipper._Clipper.EdgeSide",toString:v}};tc.__constructs__=[tc.Left,
tc.Right];tc.__empty_constructs__=[tc.Left,tc.Right];var Wb=L["hxd.clipper._Clipper.Direction"]={__ename__:!0,__constructs__:null,RightToLeft:{_hx_name:"RightToLeft",_hx_index:0,__enum__:"hxd.clipper._Clipper.Direction",toString:v},LeftToRight:{_hx_name:"LeftToRight",_hx_index:1,__enum__:"hxd.clipper._Clipper.Direction",toString:v}};Wb.__constructs__=[Wb.RightToLeft,Wb.LeftToRight];Wb.__empty_constructs__=[Wb.RightToLeft,Wb.LeftToRight];var de=function(){var a=[];this.polygon=null==a?[]:a;this.childs=
[]};z["hxd.clipper._Clipper.PolyNode"]=de;de.__name__="hxd.clipper._Clipper.PolyNode";de.prototype={isHoleNode:function(){for(var a=!0,b=this.parent;null!=b;)a=!a,b=b.parent;return a},get_childCount:function(){return this.childs.length},get_contour:function(){return this.polygon},addChild:function(a){var b=this.childs.length;this.childs.push(a);a.parent=this;a.index=b},getNext:function(){return 0<this.childs.length?this.childs[0]:this.getNextSiblingUp()},getNextSiblingUp:function(){return null==this.parent?
null:this.index==this.parent.childs.length-1?this.parent.getNextSiblingUp():this.parent.childs[this.index+1]},isHole:function(){return this.isHoleNode()},__class__:de};var Hi=function(){de.call(this);this.allPolys=[]};z["hxd.clipper._Clipper.PolyTree"]=Hi;Hi.__name__="hxd.clipper._Clipper.PolyTree";Hi.__super__=de;Hi.prototype=J(de.prototype,{toPolygons:function(a){a=[];this.addRec(this,a)},addRec:function(a,b){0<a.polygon.length&&b.push(a.polygon);var c=0;for(a=a.childs;c<a.length;){var d=a[c];++c;
this.addRec(d,b)}},clear:function(){this.allPolys=[];this.childs=[]},getFirst:function(){return 0<this.childs.length?this.childs[0]:null},get_total:function(){var a=this.allPolys.length;0<a&&this.childs[0]!=this.allPolys[0]&&--a;return a},__class__:Hi});var Dj=function(a){this.val=a};z["hxd.clipper._Clipper.Ref"]=Dj;Dj.__name__="hxd.clipper._Clipper.Ref";Dj.prototype={__class__:Dj};var Ii=function(){};z["hxd.clipper._Clipper.TEdge"]=Ii;Ii.__name__="hxd.clipper._Clipper.TEdge";Ii.prototype={get_top:function(){return new V(this.topX,
this.topY)},get_bot:function(){return new V(this.botX,this.botY)},get_curr:function(){return new V(this.currX,this.currY)},set_top:function(a){this.topX=a.x;this.topY=a.y;return a},set_bot:function(a){this.botX=a.x;this.botY=a.y;return a},set_curr:function(a){this.currX=a.x;this.currY=a.y;return a},__class__:Ii};var Ji=function(){};z["hxd.clipper._Clipper.IntersectNode"]=Ji;Ji.__name__="hxd.clipper._Clipper.IntersectNode";Ji.prototype={__class__:Ji};var Ah=function(){};z["hxd.clipper._Clipper.LocalMinima"]=
Ah;Ah.__name__="hxd.clipper._Clipper.LocalMinima";Ah.prototype={__class__:Ah};var yg=function(){};z["hxd.clipper._Clipper.Scanbeam"]=yg;yg.__name__="hxd.clipper._Clipper.Scanbeam";yg.prototype={__class__:yg};var Ki=function(){};z["hxd.clipper._Clipper.OutRec"]=Ki;Ki.__name__="hxd.clipper._Clipper.OutRec";Ki.prototype={__class__:Ki};var Kf=function(){};z["hxd.clipper._Clipper.OutPt"]=Kf;Kf.__name__="hxd.clipper._Clipper.OutPt";Kf.prototype={__class__:Kf};var Bh=function(){};z["hxd.clipper._Clipper.Join"]=
Bh;Bh.__name__="hxd.clipper._Clipper.Join";Bh.prototype={__class__:Bh};var id=function(){this.m_edges=[];this.m_CurrentLM=this.m_MinimaList=null};z["hxd.clipper._Clipper.ClipperBase"]=id;id.__name__="hxd.clipper._Clipper.ClipperBase";id.nearZero=function(a){return-1E-20<a?1E-20>a:!1};id.getBounds=function(a){var b=new Li;var c=0;for(var d=a.length;c<d&&0==a[c].length;)++c;b.left=b.right=a[c][0].x;b.top=b.bottom=a[c][0].y;for(var e=0;e<d;){c=e++;var f=0;c=a[c];for(var g=c.length;f<g;){var h=c[f++];
h.x<b.left?b.left=h.x:h.x>b.right&&(b.right=h.x);h.y<b.top?b.top=h.y:h.y>b.bottom&&(b.bottom=h.y)}}return b};id.prototype={isHorizontal:function(a){return 0==a.deltaY},abs:function(a){return 0>a?-a:a},PointIsVertex:function(a,b){var c=b;do{var d=c.pt;if(d.x==a.x&&d.y==a.y)return!0;c=c.next}while(c!=b);return!1},PointOnLineSegment:function(a,b,c){return a.x==b.x&&a.y==b.y||a.x==c.x&&a.y==c.y?!0:a.x>b.x==a.x<c.x&&a.y>b.y==a.y<c.y?(a.x-b.x)*(c.y-b.y)==(c.x-b.x)*(a.y-b.y):!1},PointOnPolygon:function(a,
b){var c=b;do{if(this.PointOnLineSegment(a,c.pt,c.next.pt))return!0;c=c.next}while(c!=b);return!1},SlopesEqual:function(a,b){return a.deltaY*b.deltaX==a.deltaX*b.deltaY},SlopesEqual3:function(a,b,c){return 0==(a.y-b.y)*(b.x-c.x)-(a.x-b.x)*(b.y-c.y)},clear:function(){this.disposeLocalMinimaList();this.m_edges=[]},disposeLocalMinimaList:function(){for(;null!=this.m_MinimaList;){var a=this.m_MinimaList.next;this.m_MinimaList=null;this.m_MinimaList=a}this.m_CurrentLM=null},addPolygons:function(a,b){for(var c=
!1,d=0,e=a.length;d<e;){var f=a[d++];this.addPolygon(f,b)&&(c=!0)}return c},addPolygon:function(a,b){var c;for(c=a.length-1;0<c&&a[c]==a[0];)--c;for(;0<c&&a[c]==a[c-1];)--c;if(2>c)return!1;var d=[];var e=0;for(var f=c+1;e<f;)e++,d.push(new Ii);f=!0;var g=d[1];e=a[1];g.currX=e.x;g.currY=e.y;e=d[0];g=a[0];e.next=d[1];e.prev=d[c];e.currX=g.x;e.currY=g.y;e.outIdx=-1;e=d[c];g=a[c];e.next=d[0];e.prev=d[c-1];e.currX=g.x;e.currY=g.y;e.outIdx=-1;for(--c;0<c;)e=d[c],g=a[c],e.next=d[c+1],e.prev=d[c-1],e.currX=
g.x,e.currY=g.y,e.outIdx=-1,--c;for(e=c=a=d[0];;)if(e.currX==e.next.currX&&e.currY==e.next.currY){if(e==e.next)break;e==a&&(a=e.next);c=e=this.RemoveEdge(e)}else{if(e.prev==e.next)break;g=e.prev;var h=g.currX,k=g.currY;null==k&&(k=0);null==h&&(h=0);g=h;h=k;k=e.currX;var l=e.currY;null==l&&(l=0);null==k&&(k=0);var m=e.next,p=m.currX;m=m.currY;null==m&&(m=0);null==p&&(p=0);0==(h-l)*(k-p)-(g-k)*(l-m)?this.preserveCollinear?(g=e.prev,g=new V(g.currX,g.currY),h=new V(e.currX,e.currY),k=e.next,g=!this.Pt2IsBetweenPt1AndPt3(g,
h,new V(k.currX,k.currY))):g=!0:g=!1;if(g)e==a&&(a=e.next),e=this.RemoveEdge(e),c=e=e.prev;else if(e=e.next,e==c)break}if(e.prev==e.next)return!1;e=a;do e.currY>=e.next.currY?(e.botX=e.currX,e.botY=e.currY,e.topX=e.next.currX,e.topY=e.next.currY):(e.topX=e.currX,e.topY=e.currY,e.botX=e.next.currX,e.botY=e.next.currY),this.SetDx(e),e.polyType=b,e=e.next,e.currY!=a.currY&&(f=!1);while(e!=a);if(f)return!1;this.m_edges.push(d);d=null;e.prev.botX==e.prev.topX&&e.prev.botY==e.prev.topY&&(e=e.next);for(f=
null;;){e=this.FindNextLocMin(e);if(e==d)break;else null==d&&(d=e);if(e==f)throw u.thrown("!");f=e;a=new Ah;a.next=null;a.y=e.botY;e.dx<e.prev.dx?(a.leftBound=e.prev,a.rightBound=e,b=!1):(a.leftBound=e,a.rightBound=e.prev,b=!0);a.leftBound.side=tc.Left;a.rightBound.side=tc.Right;a.leftBound.windDelta=a.leftBound.next==a.rightBound?-1:1;a.rightBound.windDelta=-a.leftBound.windDelta;e=this.ProcessBound(a.leftBound,b);-2==e.outIdx&&(e=this.ProcessBound(e,b));c=this.ProcessBound(a.rightBound,!b);-2==
c.outIdx&&(c=this.ProcessBound(c,!b));-2==a.leftBound.outIdx?a.leftBound=null:-2==a.rightBound.outIdx&&(a.rightBound=null);this.InsertLocalMinima(a);b||(e=c)}return!0},InitEdge:function(a,b,c,d){a.next=b;a.prev=c;a.currX=d.x;a.currY=d.y;a.outIdx=-1},InitEdge2:function(a,b){a.currY>=a.next.currY?(a.botX=a.currX,a.botY=a.currY,a.topX=a.next.currX,a.topY=a.next.currY):(a.topX=a.currX,a.topY=a.currY,a.botX=a.next.currX,a.botY=a.next.currY);this.SetDx(a);a.polyType=b},RemoveEdge:function(a){a.prev.next=
a.next;a.next.prev=a.prev;var b=a.next;a.prev=null;return b},FindNextLocMin:function(a){for(var b;;){for(;a.botX!=a.prev.botX||a.botY!=a.prev.botY||a.currX==a.topX&&a.currY==a.topY;)a=a.next;if(-9007199254740992!=a.dx&&-9007199254740992!=a.prev.dx)break;for(;-9007199254740992==a.prev.dx;)a=a.prev;for(b=a;-9007199254740992==a.dx;)a=a.next;if(a.topY!=a.prev.botY){b.prev.botX<a.botX&&(a=b);break}}return a},ProcessBound:function(a,b){var c,d=a;if(-2==d.outIdx){a=d;if(b){for(;a.topY==a.next.botY;)a=a.next;
for(;a!=d&&-9007199254740992==a.dx;)a=a.prev}else{for(;a.topY==a.prev.botY;)a=a.prev;for(;a!=d&&-9007199254740992==a.dx;)a=a.next}if(a==d)d=b?a.next:a.prev;else{a=b?d.next:d.prev;var e=new Ah;e.next=null;e.y=a.botY;e.leftBound=null;e.rightBound=a;a.windDelta=0;d=this.ProcessBound(a,b);this.InsertLocalMinima(e)}return d}-9007199254740992==a.dx&&(e=b?a.prev:a.next,-2!=e.outIdx&&(-9007199254740992==e.dx?e.botX!=a.botX&&e.topX!=a.botX&&this.ReverseHorizontal(a):e.botX!=a.botX&&this.ReverseHorizontal(a)));
e=a;if(b){for(;d.topY==d.next.botY&&-2!=d.next.outIdx;)d=d.next;if(-9007199254740992==d.dx&&-2!=d.next.outIdx){for(c=d;-9007199254740992==c.prev.dx;)c=c.prev;c.prev.topX==d.next.topX?b||(d=c.prev):c.prev.topX>d.next.topX&&(d=c.prev)}for(;a!=d;)a.nextInLML=a.next,-9007199254740992==a.dx&&a!=e&&a.botX!=a.prev.topX&&this.ReverseHorizontal(a),a=a.next;-9007199254740992==a.dx&&a!=e&&a.botX!=a.prev.topX&&this.ReverseHorizontal(a);d=d.next}else{for(;d.topY==d.prev.botY&&-2!=d.prev.outIdx;)d=d.prev;if(-9007199254740992==
d.dx&&-2!=d.prev.outIdx){for(c=d;-9007199254740992==c.next.dx;)c=c.next;c.next.topX==d.prev.topX?b||(d=c.next):c.next.topX>d.prev.topX&&(d=c.next)}for(;a!=d;)a.nextInLML=a.prev,-9007199254740992==a.dx&&a!=e&&a.botX!=a.next.topX&&this.ReverseHorizontal(a),a=a.prev;-9007199254740992==a.dx&&a!=e&&a.botX!=a.next.topX&&this.ReverseHorizontal(a);d=d.prev}return d},ReverseHorizontal:function(a){var b=a.topX;a.topX=a.botX;a.botX=b},Pt2IsBetweenPt1AndPt3:function(a,b,c){return a.x==c.x&&a.y==c.y||a.x==b.x&&
a.y==b.y||c.x==b.x&&c.y==b.y?!1:a.x!=c.x?b.x>a.x==b.x<c.x:b.y>a.y==b.y<c.y},SetDx:function(a){a.deltaX=a.topX-a.botX;a.deltaY=a.topY-a.botY;a.dx=0==a.deltaY?-9007199254740992:a.deltaX/a.deltaY},InsertLocalMinima:function(a){if(null==this.m_MinimaList)this.m_MinimaList=a;else if(a.y>=this.m_MinimaList.y)a.next=this.m_MinimaList,this.m_MinimaList=a;else{for(var b=this.m_MinimaList;null!=b.next&&a.y<b.next.y;)b=b.next;a.next=b.next;b.next=a}},PopLocalMinima:function(){null!=this.m_CurrentLM&&(this.m_CurrentLM=
this.m_CurrentLM.next)},SwapX:function(a){a.currX=a.topX;a.topX=a.botX;a.botX=a.currX},equals:function(a,b){return a.x==b.x?a.y==b.y:!1},Reset:function(){for(var a=this.m_CurrentLM=this.m_MinimaList;null!=a;){var b=a.leftBound;null!=b&&(b.currX=b.botX,b.currY=b.botY,b.side=tc.Left,b.outIdx=-1);b=a.rightBound;null!=b&&(b.currX=b.botX,b.currY=b.botY,b.side=tc.Right,b.outIdx=-1);a=a.next}},__class__:id};var re=L["hxd.clipper.NodeType"]={__ename__:!0,__constructs__:null,Any:{_hx_name:"Any",_hx_index:0,
__enum__:"hxd.clipper.NodeType",toString:v},Open:{_hx_name:"Open",_hx_index:1,__enum__:"hxd.clipper.NodeType",toString:v},Closed:{_hx_name:"Closed",_hx_index:2,__enum__:"hxd.clipper.NodeType",toString:v}};re.__constructs__=[re.Any,re.Open,re.Closed];re.__empty_constructs__=[re.Any,re.Open,re.Closed];var Tb=L["hxd.clipper.ResultKind"]={__ename__:!0,__constructs__:null,All:{_hx_name:"All",_hx_index:0,__enum__:"hxd.clipper.ResultKind",toString:v},NoHoles:{_hx_name:"NoHoles",_hx_index:1,__enum__:"hxd.clipper.ResultKind",
toString:v},HolesOnly:{_hx_name:"HolesOnly",_hx_index:2,__enum__:"hxd.clipper.ResultKind",toString:v}};Tb.__constructs__=[Tb.All,Tb.NoHoles,Tb.HolesOnly];Tb.__empty_constructs__=[Tb.All,Tb.NoHoles,Tb.HolesOnly];var rb=function(){id.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.preserveCollinear=this.strictlySimple=this.reverseSolution=!1;this.resultKind=
Tb.All};z["hxd.clipper.Clipper"]=rb;rb.__name__="hxd.clipper.Clipper";rb.compareY=function(a,b){return 0<=b.pt.y-a.pt.y?1:-1};rb.Orientation=function(a){return 0<=rb.polArea(a)};rb.polArea=function(a){var b=a.length;if(3>b)return 0;for(var c=0,d=b-1,e=0;e<b;){var f=e++;c+=(a[d].x+a[f].x)*(a[d].y-a[f].y);d=f}return.5*-c};rb.SimplifyPolygon=function(a,b){null==b&&(b=Ha.EvenOdd);var c=new rb;c.strictlySimple=!0;c.addPolygon(a,kb.Subject);return c.execute(bc.Union,b,b)};rb.SimplifyPolygons=function(a,
b){null==b&&(b=Ha.EvenOdd);var c=new rb;c.strictlySimple=!0;c.addPolygons(a,kb.Subject);return c.execute(bc.Union,b,b)};rb.MinkowskiSums=function(a,b,c){var d=new rb;d.resultKind=null==c?Tb.All:c;c=0;for(var e=b.length;c<e;){var f=c++,g=d.Minkowski(a,b[f],!0);d.addPolygons(g,kb.Subject);f=d.TranslatePath(b[f],a[0]);d.addPolygon(f,kb.Clip)}return d.execute(bc.Union,Ha.NonZero,Ha.NonZero)};rb.MinkowskiDiff=function(a,b,c){var d=new rb;a=d.Minkowski(a,b,!1);d.resultKind=null==c?Tb.All:c;d.addPolygons(a,
kb.Subject);return d.execute(bc.Union,Ha.NonZero,Ha.NonZero)};rb.__super__=id;rb.prototype=J(id.prototype,{xor:function(a,b){return a?!b:b},DisposeScanbeamList:function(){for(;null!=this.m_Scanbeam;){var a=this.m_Scanbeam.next;this.m_Scanbeam=null;this.m_Scanbeam=a}},Reset:function(){id.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;for(var a=this.m_MinimaList;null!=a;)this.InsertScanbeam(a.y),a=a.next},InsertScanbeam:function(a){if(null==this.m_Scanbeam)this.m_Scanbeam=
new yg,this.m_Scanbeam.next=null,this.m_Scanbeam.y=a;else if(a>this.m_Scanbeam.y){var b=new yg;b.y=a;b.next=this.m_Scanbeam;this.m_Scanbeam=b}else{for(var c=this.m_Scanbeam;null!=c.next&&a<=c.next.y;)c=c.next;a!=c.y&&(b=new yg,b.y=a,b.next=c.next,c.next=b)}},execute:function(a,b,c){null==b&&(b=Ha.EvenOdd);null==c&&(c=Ha.EvenOdd);if(this.m_ExecuteLocked)return[];this.m_ExecuteLocked=!0;var d=[];this.m_SubjFillType=b;this.m_ClipFillType=c;this.m_ClipType=a;this.m_UsingPolyTree=!1;this.ExecuteInternal()&&
(d=this.BuildResult());this.DisposeAllPolyPts();this.m_ExecuteLocked=!1;return d},ExecuteTree:function(a,b,c,d){null==c&&(c=Ha.EvenOdd);null==d&&(d=Ha.EvenOdd);if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=c;this.m_ClipFillType=d;this.m_ClipType=a;this.m_UsingPolyTree=!0;(a=this.ExecuteInternal())&&this.BuildResult2(b);this.m_ExecuteLocked=!1;return a},FixHoleLinkage:function(a){if(null!=a.firstLeft&&(a.isHole==a.firstLeft.isHole||null==a.firstLeft.pts)){for(var b=a.firstLeft;null!=
b&&(b.isHole==a.isHole||null==b.pts);)b=b.firstLeft;a.firstLeft=b}},ExecuteInternal:function(){this.Reset();if(null==this.m_CurrentLM)return!1;var a=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(a);0<this.m_GhostJoins.length&&(this.m_GhostJoins=[]);this.ProcessHorizontals(!1);if(null==this.m_Scanbeam)break;a=this.PopScanbeam();if(!this.ProcessIntersections(a))return!1;this.ProcessEdgesAtTopOfScanbeam(a)}while(null!=this.m_Scanbeam||null!=this.m_CurrentLM);for(var b=0,c=this.m_PolyOuts;b<c.length;)if(a=
c[b],++b,null!=a.pts){var d=this.reverseSolution;(a.isHole?!d:d)==0<this.Area(a)&&this.ReversePolyPtLinks(a.pts)}this.JoinCommonEdges();b=0;for(c=this.m_PolyOuts;b<c.length;)a=c[b],++b,null!=a.pts&&this.FixupOutPolygon(a);this.strictlySimple&&this.DoSimplePolygons();this.m_Joins=[];this.m_GhostJoins=[];return!0},PopScanbeam:function(){var a=this.m_Scanbeam.y;this.m_Scanbeam=this.m_Scanbeam.next;return a},DisposeAllPolyPts:function(){for(var a=0,b=this.m_PolyOuts.length;a<b;){var c=a++;this.DisposeOutRec(c)}this.m_PolyOuts=
[]},DisposeOutRec:function(a){this.m_PolyOuts[a].pts=null;this.m_PolyOuts[a]=null},AddJoin:function(a,b,c){var d=new Bh;d.outPt1=a;d.outPt2=b;d.offPt=c;this.m_Joins.push(d)},AddGhostJoin:function(a,b){var c=new Bh;c.outPt1=a;c.offPt=b;this.m_GhostJoins.push(c)},InsertLocalMinimaIntoAEL:function(a){for(;null!=this.m_CurrentLM&&this.m_CurrentLM.y==a;){var b=this.m_CurrentLM.leftBound,c=this.m_CurrentLM.rightBound;this.PopLocalMinima();var d=null;null==b?(this.InsertEdgeIntoAEL(c),this.SetWindingCount(c),
this.IsContributing(c)&&(d=this.AddOutPt(c,new V(c.botX,c.botY)))):(null==c?(this.InsertEdgeIntoAEL(b),this.SetWindingCount(b),this.IsContributing(b)&&(d=this.AddOutPt(b,new V(b.botX,b.botY)))):(this.InsertEdgeIntoAEL(b),this.InsertEdgeIntoAEL(c,b),this.SetWindingCount(b),c.windCnt=b.windCnt,c.windCnt2=b.windCnt2,this.IsContributing(b)&&(d=this.AddLocalMinPoly(b,c,new V(b.botX,b.botY)))),this.InsertScanbeam(b.topY));null!=c&&(0==c.deltaY?this.AddEdgeToSEL(c):this.InsertScanbeam(c.topY));if(null!=
b&&null!=c){if(null!=d&&0==c.deltaY&&0<this.m_GhostJoins.length&&0!=c.windDelta)for(var e=0,f=this.m_GhostJoins;e<f.length;){var g=f[e];++e;this.HorzSegmentsOverlap(g.outPt1.pt.x,g.offPt.x,c.botX,c.topX)&&this.AddJoin(g.outPt1,d,g.offPt)}0<=b.outIdx&&null!=b.prevInAEL&&b.prevInAEL.currX==b.botX&&0<=b.prevInAEL.outIdx?(e=b.prevInAEL,e=e.deltaY*b.deltaX==e.deltaX*b.deltaY):e=!1;e&&0!=b.windDelta&&0!=b.prevInAEL.windDelta&&(e=this.AddOutPt(b.prevInAEL,new V(b.botX,b.botY)),this.AddJoin(d,e,new V(b.topX,
b.topY)));if(b.nextInAEL!=c&&(0<=c.outIdx&&0<=c.prevInAEL.outIdx?(e=c.prevInAEL,e=e.deltaY*c.deltaX==e.deltaX*c.deltaY):e=!1,e&&0!=c.windDelta&&0!=c.prevInAEL.windDelta&&(e=this.AddOutPt(c.prevInAEL,new V(c.botX,c.botY)),this.AddJoin(d,e,new V(c.topX,c.topY))),d=b.nextInAEL,null!=d))for(;d!=c;)this.IntersectEdges(c,d,new V(b.currX,b.currY)),d=d.nextInAEL}}},InsertEdgeIntoAEL:function(a,b){if(null==this.m_ActiveEdges)a.prevInAEL=null,a.nextInAEL=null,this.m_ActiveEdges=a;else if(null==b&&this.E2InsertsBeforeE1(this.m_ActiveEdges,
a))a.prevInAEL=null,a.nextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.prevInAEL=a;else{null==b&&(b=this.m_ActiveEdges);for(;null!=b.nextInAEL&&!this.E2InsertsBeforeE1(b.nextInAEL,a);)b=b.nextInAEL;a.nextInAEL=b.nextInAEL;null!=b.nextInAEL&&(b.nextInAEL.prevInAEL=a);a.prevInAEL=b;b.nextInAEL=a}},E2InsertsBeforeE1:function(a,b){if(b.currX==a.currX){if(b.topY>a.topY){var c=b.topY;c==a.topY?c=a.topX:(c=a.dx*(c-a.botY),c=a.botX+(0>c?c-.5|0:c+.5|0));return b.topX<c}c=a.topY;c==b.topY?
c=b.topX:(c=b.dx*(c-b.botY),c=b.botX+(0>c?c-.5|0:c+.5|0));return a.topX>c}return b.currX<a.currX},IsEvenOddFillType:function(a){return a.polyType==kb.Subject?this.m_SubjFillType==Ha.EvenOdd:this.m_ClipFillType==Ha.EvenOdd},IsEvenOddAltFillType:function(a){return a.polyType==kb.Subject?this.m_ClipFillType==Ha.EvenOdd:this.m_SubjFillType==Ha.EvenOdd},IsContributing:function(a){if(a.polyType==kb.Subject){var b=this.m_SubjFillType;var c=this.m_ClipFillType}else b=this.m_ClipFillType,c=this.m_SubjFillType;
switch(b._hx_index){case 0:if(0==a.windDelta&&1!=a.windCnt)return!1;break;case 1:b=a.windCnt;if(1!=(0>b?-b:b))return!1;break;case 2:if(1!=a.windCnt)return!1;break;default:if(-1!=a.windCnt)return!1}switch(this.m_ClipType._hx_index){case 0:switch(c._hx_index){case 0:case 1:return 0!=a.windCnt2;case 2:return 0<a.windCnt2;default:return 0>a.windCnt2}case 1:switch(c._hx_index){case 0:case 1:return 0==a.windCnt2;case 2:return 0>=a.windCnt2;default:return 0<=a.windCnt2}case 2:if(a.polyType==kb.Subject)switch(c._hx_index){case 0:case 1:return 0==
a.windCnt2;case 2:return 0>=a.windCnt2;default:return 0<=a.windCnt2}else switch(c._hx_index){case 0:case 1:return 0!=a.windCnt2;case 2:return 0<a.windCnt2;default:return 0>a.windCnt2}case 3:if(0==a.windDelta)switch(c._hx_index){case 0:case 1:return 0==a.windCnt2;case 2:return 0>=a.windCnt2;default:return 0<=a.windCnt2}else return!0}},SetWindingCount:function(a){for(var b=a.prevInAEL;null!=b&&(b.polyType!=a.polyType||0==b.windDelta);)b=b.prevInAEL;if(null==b)a.windCnt=0==a.windDelta?1:a.windDelta,
a.windCnt2=0,b=this.m_ActiveEdges;else{if(0==a.windDelta&&this.m_ClipType!=bc.Union)a.windCnt=1;else if(a.polyType==kb.Subject?this.m_SubjFillType==Ha.EvenOdd:this.m_ClipFillType==Ha.EvenOdd)if(0==a.windDelta){for(var c=!0,d=b.prevInAEL;null!=d;)d.polyType==b.polyType&&0!=d.windDelta&&(c=!c),d=d.prevInAEL;a.windCnt=c?0:1}else a.windCnt=a.windDelta;else a.windCnt=0>b.windCnt*b.windDelta?1<b.windCnt||-1>b.windCnt?0>b.windDelta*a.windDelta?b.windCnt:b.windCnt+a.windDelta:0==a.windDelta?1:a.windDelta:
0==a.windDelta?0>b.windCnt?b.windCnt-1:b.windCnt+1:0>b.windDelta*a.windDelta?b.windCnt:b.windCnt+a.windDelta;a.windCnt2=b.windCnt2;b=b.nextInAEL}if(a.polyType==kb.Subject?this.m_ClipFillType==Ha.EvenOdd:this.m_SubjFillType==Ha.EvenOdd)for(;b!=a;)0!=b.windDelta&&(a.windCnt2=0==a.windCnt2?1:0),b=b.nextInAEL;else for(;b!=a;)a.windCnt2+=b.windDelta,b=b.nextInAEL},AddEdgeToSEL:function(a){null==this.m_SortedEdges?(this.m_SortedEdges=a,a.prevInSEL=null,a.nextInSEL=null):(a.nextInSEL=this.m_SortedEdges,
a.prevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.prevInSEL=a)},CopyAELToSEL:function(){var a=this.m_ActiveEdges;for(this.m_SortedEdges=a;null!=a;)a.prevInSEL=a.prevInAEL,a=a.nextInSEL=a.nextInAEL},SwapPositionsInAEL:function(a,b){if(a.nextInAEL!=a.prevInAEL&&b.nextInAEL!=b.prevInAEL){if(a.nextInAEL==b){var c=b.nextInAEL;null!=c&&(c.prevInAEL=a);var d=a.prevInAEL;null!=d&&(d.nextInAEL=b);b.prevInAEL=d;b.nextInAEL=a;a.prevInAEL=b;a.nextInAEL=c}else b.nextInAEL==a?(c=a.nextInAEL,null!=c&&(c.prevInAEL=
b),d=b.prevInAEL,null!=d&&(d.nextInAEL=a),a.prevInAEL=d,a.nextInAEL=b,b.prevInAEL=a,b.nextInAEL=c):(c=a.nextInAEL,d=a.prevInAEL,a.nextInAEL=b.nextInAEL,null!=a.nextInAEL&&(a.nextInAEL.prevInAEL=a),a.prevInAEL=b.prevInAEL,null!=a.prevInAEL&&(a.prevInAEL.nextInAEL=a),b.nextInAEL=c,null!=b.nextInAEL&&(b.nextInAEL.prevInAEL=b),b.prevInAEL=d,null!=b.prevInAEL&&(b.prevInAEL.nextInAEL=b));null==a.prevInAEL?this.m_ActiveEdges=a:null==b.prevInAEL&&(this.m_ActiveEdges=b)}},SwapPositionsInSEL:function(a,b){if(null!=
a.nextInSEL||null!=a.prevInSEL)if(null!=b.nextInSEL||null!=b.prevInSEL){if(a.nextInSEL==b){var c=b.nextInSEL;null!=c&&(c.prevInSEL=a);var d=a.prevInSEL;null!=d&&(d.nextInSEL=b);b.prevInSEL=d;b.nextInSEL=a;a.prevInSEL=b;a.nextInSEL=c}else b.nextInSEL==a?(c=a.nextInSEL,null!=c&&(c.prevInSEL=b),d=b.prevInSEL,null!=d&&(d.nextInSEL=a),a.prevInSEL=d,a.nextInSEL=b,b.prevInSEL=a,b.nextInSEL=c):(c=a.nextInSEL,d=a.prevInSEL,a.nextInSEL=b.nextInSEL,null!=a.nextInSEL&&(a.nextInSEL.prevInSEL=a),a.prevInSEL=b.prevInSEL,
null!=a.prevInSEL&&(a.prevInSEL.nextInSEL=a),b.nextInSEL=c,null!=b.nextInSEL&&(b.nextInSEL.prevInSEL=b),b.prevInSEL=d,null!=b.prevInSEL&&(b.prevInSEL.nextInSEL=b));null==a.prevInSEL?this.m_SortedEdges=a:null==b.prevInSEL&&(this.m_SortedEdges=b)}},AddLocalMaxPoly:function(a,b,c){this.AddOutPt(a,c);0==b.windDelta&&this.AddOutPt(b,c);a.outIdx==b.outIdx?(a.outIdx=-1,b.outIdx=-1):a.outIdx<b.outIdx?this.AppendPolygon(a,b):this.AppendPolygon(b,a)},AddLocalMinPoly:function(a,b,c){if(0==b.deltaY||a.dx>b.dx){var d=
this.AddOutPt(a,c);b.outIdx=a.outIdx;a.side=tc.Left;b.side=tc.Right;var e=a;a=e.prevInAEL==b?b.prevInAEL:e.prevInAEL}else d=this.AddOutPt(b,c),a.outIdx=b.outIdx,a.side=tc.Right,b.side=tc.Left,e=b,a=e.prevInAEL==a?a.prevInAEL:e.prevInAEL;if(null!=a&&0<=a.outIdx){var f=c.y;f==a.topY?b=a.topX:(f=a.dx*(f-a.botY),b=a.botX+(0>f?f-.5|0:f+.5|0));f=c.y;f==e.topY?f=e.topX:(f=e.dx*(f-e.botY),f=e.botX+(0>f?f-.5|0:f+.5|0));b=b==f}else b=!1;b&&e.deltaY*a.deltaX==e.deltaX*a.deltaY&&0!=e.windDelta&&0!=a.windDelta&&
(c=this.AddOutPt(a,c),this.AddJoin(d,c,new V(e.topX,e.topY)));return d},CreateOutRec:function(){var a=new Ki;a.idx=-1;a.isHole=!1;a.firstLeft=null;a.pts=null;a.bottomPt=null;a.polyNode=null;this.m_PolyOuts.push(a);a.idx=this.m_PolyOuts.length-1;return a},AddOutPt:function(a,b){var c=a.side==tc.Left;if(0>a.outIdx){var d=this.CreateOutRec();var e=new Kf;d.pts=e;e.idx=d.idx;e.pt=new V(b.x,b.y);e.next=e;e.prev=e;this.SetHoleState(a,d);a.outIdx=d.idx;return e}d=this.m_PolyOuts[a.outIdx];e=d.pts;c?(a=e.pt,
a=b.x==a.x&&b.y==a.y):a=!1;if(a)return e;c?a=!1:(a=e.prev.pt,a=b.x==a.x&&b.y==a.y);if(a)return e.prev;a=new Kf;a.idx=d.idx;a.pt=new V(b.x,b.y);a.next=e;a.prev=e.prev;a.prev.next=a;e.prev=a;c&&(d.pts=a);return a},HorzSegmentsOverlap:function(a,b,c,d){if(a>b){var e=a;a=b;b=e}c>d&&(e=c,c=d,d=e);return a<d?c<b:!1},SetHoleState:function(a,b){var c=!1;for(a=a.prevInAEL;null!=a;)0<=a.outIdx&&0!=a.windDelta&&(c=!c,null==b.firstLeft&&(b.firstLeft=this.m_PolyOuts[a.outIdx])),a=a.prevInAEL;c&&(b.isHole=!0)},
GetDx:function(a,b){return a.y==b.y?-9007199254740992:(b.x-a.x)/(b.y-a.y)},FirstIsBottomPt:function(a,b){for(var c,d,e=a.prev;;){d=e.pt;c=a.pt;if(d.x!=c.x||d.y!=c.y||e==a)break;e=e.prev}c=this.GetDx(a.pt,e.pt);var f=0>c?-c:c;for(e=a.next;;){d=e.pt;c=a.pt;if(d.x!=c.x||d.y!=c.y||e==a)break;e=e.next}c=this.GetDx(a.pt,e.pt);a=0>c?-c:c;for(e=b.prev;;){d=e.pt;c=b.pt;if(d.x!=c.x||d.y!=c.y||e==b)break;e=e.prev}c=this.GetDx(b.pt,e.pt);var g=0>c?-c:c;for(e=b.next;;){d=e.pt;c=b.pt;if(d.x!=c.x||d.y!=c.y||e==
b)break;e=e.next}c=this.GetDx(b.pt,e.pt);b=0>c?-c:c;return f>=g&&f>=b?!0:a>=g?a>=b:!1},GetBottomPt:function(a){for(var b=null,c=a.next;c!=a;)c.pt.y>a.pt.y?(a=c,b=null):c.pt.y==a.pt.y&&c.pt.x<=a.pt.x&&(c.pt.x<a.pt.x?(b=null,a=c):c.next!=a&&c.prev!=a&&(b=c)),c=c.next;if(null!=b)for(;b!=c;)for(this.FirstIsBottomPt(c,b)||(a=b),b=b.next;;){var d=b.pt,e=a.pt;if(d.x==e.x&&d.y==e.y)break;b=b.next}return a},GetLowermostRec:function(a,b){null==a.bottomPt&&(a.bottomPt=this.GetBottomPt(a.pts));null==b.bottomPt&&
(b.bottomPt=this.GetBottomPt(b.pts));var c=a.bottomPt,d=b.bottomPt;return c.pt.y>d.pt.y?a:c.pt.y<d.pt.y?b:c.pt.x<d.pt.x?a:c.pt.x>d.pt.x?b:c.next==c?b:d.next==d?a:this.FirstIsBottomPt(c,d)?a:b},Param1RightOfParam2:function(a,b){do if(a=a.firstLeft,a==b)return!0;while(null!=a);return!1},GetOutRec:function(a){for(a=this.m_PolyOuts[a];a!=this.m_PolyOuts[a.idx];)a=this.m_PolyOuts[a.idx];return a},AppendPolygon:function(a,b){var c=this.m_PolyOuts[a.outIdx],d=this.m_PolyOuts[b.outIdx];var e=this.Param1RightOfParam2(c,
d)?d:this.Param1RightOfParam2(d,c)?c:this.GetLowermostRec(c,d);var f=c.pts,g=f.prev,h=d.pts,k=h.prev;a.side==tc.Left?(b.side==tc.Left?(this.ReversePolyPtLinks(h),h.next=f,f.prev=h,g.next=k,k.prev=g,c.pts=k):(k.next=f,f.prev=k,h.prev=g,g.next=h,c.pts=h),f=tc.Left):(b.side==tc.Right?(this.ReversePolyPtLinks(h),g.next=k,k.prev=g,h.next=f,f.prev=h):(g.next=h,h.prev=g,f.prev=k,k.next=f),f=tc.Right);c.bottomPt=null;e==d&&(d.firstLeft!=c&&(c.firstLeft=d.firstLeft),c.isHole=d.isHole);d.pts=null;d.bottomPt=
null;d.firstLeft=c;e=a.outIdx;g=b.outIdx;a.outIdx=-1;b.outIdx=-1;for(a=this.m_ActiveEdges;null!=a;){if(a.outIdx==g){a.outIdx=e;a.side=f;break}a=a.nextInAEL}d.idx=c.idx},ReversePolyPtLinks:function(a){if(null!=a){var b=a;do{var c=b.next;b.next=b.prev;b=b.prev=c}while(b!=a)}},SwapSides:function(a,b){var c=a.side;a.side=b.side;b.side=c},SwapPolyIndexes:function(a,b){var c=a.outIdx;a.outIdx=b.outIdx;b.outIdx=c},IntersectEdges:function(a,b,c){var d=0<=a.outIdx,e=0<=b.outIdx;if(a.polyType==b.polyType)if(a.polyType==
kb.Subject?this.m_SubjFillType==Ha.EvenOdd:this.m_ClipFillType==Ha.EvenOdd){var f=a.windCnt;a.windCnt=b.windCnt;b.windCnt=f}else a.windCnt=0==a.windCnt+b.windDelta?-a.windCnt:a.windCnt+b.windDelta,b.windCnt=0==b.windCnt-a.windDelta?-b.windCnt:b.windCnt-a.windDelta;else a.windCnt2=(b.polyType==kb.Subject?this.m_SubjFillType!=Ha.EvenOdd:this.m_ClipFillType!=Ha.EvenOdd)?a.windCnt2+b.windDelta:0==a.windCnt2?1:0,b.windCnt2=(a.polyType==kb.Subject?this.m_SubjFillType!=Ha.EvenOdd:this.m_ClipFillType!=Ha.EvenOdd)?
b.windCnt2-a.windDelta:0==b.windCnt2?1:0;if(a.polyType==kb.Subject){var g=this.m_SubjFillType;var h=this.m_ClipFillType}else g=this.m_ClipFillType,h=this.m_SubjFillType;if(b.polyType==kb.Subject){var k=this.m_SubjFillType;f=this.m_ClipFillType}else k=this.m_ClipFillType,f=this.m_SubjFillType;switch(g._hx_index){case 2:g=a.windCnt;break;case 3:g=-a.windCnt;break;default:var l=a.windCnt;g=0>l?-l:l}switch(k._hx_index){case 2:k=b.windCnt;break;case 3:k=-b.windCnt;break;default:l=b.windCnt,k=0>l?-l:l}if(d&&
e)0!=g&&1!=g||0!=k&&1!=k||a.polyType!=b.polyType&&this.m_ClipType!=bc.Xor?this.AddLocalMaxPoly(a,b,c):(this.AddOutPt(a,c),this.AddOutPt(b,c),c=a.side,a.side=b.side,b.side=c,this.SwapPolyIndexes(a,b));else if(d){if(0==k||1==k)this.AddOutPt(a,c),c=a.side,a.side=b.side,b.side=c,this.SwapPolyIndexes(a,b)}else if(e){if(0==g||1==g)this.AddOutPt(b,c),c=a.side,a.side=b.side,b.side=c,this.SwapPolyIndexes(a,b)}else if(!(0!=g&&1!=g||0!=k&&1!=k)){switch(h._hx_index){case 2:d=a.windCnt2;break;case 3:d=-a.windCnt2;
break;default:l=a.windCnt2,d=0>l?-l:l}switch(f._hx_index){case 2:e=b.windCnt2;break;case 3:e=-b.windCnt2;break;default:l=b.windCnt2,e=0>l?-l:l}if(a.polyType!=b.polyType)this.AddLocalMinPoly(a,b,c);else if(1==g&&1==k)switch(this.m_ClipType._hx_index){case 0:0<d&&0<e&&this.AddLocalMinPoly(a,b,c);break;case 1:0>=d&&0>=e&&this.AddLocalMinPoly(a,b,c);break;case 2:(a.polyType==kb.Clip&&0<d&&0<e||a.polyType==kb.Subject&&0>=d&&0>=e)&&this.AddLocalMinPoly(a,b,c);break;case 3:this.AddLocalMinPoly(a,b,c)}else c=
a.side,a.side=b.side,b.side=c}},DeleteFromAEL:function(a){var b=a.prevInAEL,c=a.nextInAEL;if(null!=b||null!=c||a==this.m_ActiveEdges)null!=b?b.nextInAEL=c:this.m_ActiveEdges=c,null!=c&&(c.prevInAEL=b),a.nextInAEL=null,a.prevInAEL=null},DeleteFromSEL:function(a){var b=a.prevInSEL,c=a.nextInSEL;if(null!=b||null!=c||a==this.m_SortedEdges)null!=b?b.nextInSEL=c:this.m_SortedEdges=c,null!=c&&(c.prevInSEL=b),a.nextInSEL=null,a.prevInSEL=null},UpdateEdgeIntoAEL:function(a){if(null==a.nextInLML)throw u.thrown("UpdateEdgeIntoAEL: invalid call");
var b=a.prevInAEL,c=a.nextInAEL;a.nextInLML.outIdx=a.outIdx;null!=b?b.nextInAEL=a.nextInLML:this.m_ActiveEdges=a.nextInLML;null!=c&&(c.prevInAEL=a.nextInLML);a.nextInLML.side=a.side;a.nextInLML.windDelta=a.windDelta;a.nextInLML.windCnt=a.windCnt;a.nextInLML.windCnt2=a.windCnt2;a=a.nextInLML;a.currX=a.botX;a.currY=a.botY;a.prevInAEL=b;a.nextInAEL=c;0!=a.deltaY&&this.InsertScanbeam(a.topY);return a},GetHorzDirection:function(a){return a.botX<a.topX?{left:a.botX,right:a.topX,dir:Wb.LeftToRight}:{left:a.topX,
right:a.botX,dir:Wb.RightToLeft}},ProcessHorizontals:function(a){for(var b=this.m_SortedEdges;null!=b;)this.DeleteFromSEL(b),this.ProcessHorizontal(b,a),b=this.m_SortedEdges},ProcessHorizontal:function(a,b){var c=this.GetHorzDirection(a);var d=c.dir;var e=c.left,f=c.right,g=a;for(c=null;null!=g.nextInLML&&0==g.nextInLML.deltaY;)g=g.nextInLML;for(null==g.nextInLML&&(c=this.GetMaximaPair(g));;){for(var h=a==g,k=d==Wb.LeftToRight?a.nextInAEL:a.prevInAEL;null!=k&&!(k.currX==a.topX&&null!=a.nextInLML&&
k.dx<a.nextInLML.dx);){var l=d==Wb.LeftToRight?k.nextInAEL:k.prevInAEL;if(d==Wb.LeftToRight&&k.currX<=f||d==Wb.RightToLeft&&k.currX>=e){if(k==c&&h){if(0<=a.outIdx){d=this.AddOutPt(a,new V(a.topX,a.topY));for(l=this.m_SortedEdges;null!=l;)0<=l.outIdx&&this.HorzSegmentsOverlap(a.botX,a.topX,l.botX,l.topX)&&(b=this.AddOutPt(l,new V(l.botX,l.botY)),this.AddJoin(b,d,new V(l.topX,l.topY))),l=l.nextInSEL;this.AddGhostJoin(d,new V(a.botX,a.botY));this.AddLocalMaxPoly(a,c,new V(a.topX,a.topY))}this.DeleteFromAEL(a);
this.DeleteFromAEL(c);return}if(d==Wb.LeftToRight){var m=new V(k.currX,a.currY);this.IntersectEdges(a,k,m)}else m=new V(k.currX,a.currY),this.IntersectEdges(k,a,m);this.SwapPositionsInAEL(a,k)}else if(d==Wb.LeftToRight&&k.currX>=f||d==Wb.RightToLeft&&k.currX<=e)break;k=l}if(null!=a.nextInLML&&0==a.nextInLML.deltaY)a=this.UpdateEdgeIntoAEL(a),0<=a.outIdx&&this.AddOutPt(a,new V(a.botX,a.botY)),l=this.GetHorzDirection(a),d=l.dir,e=l.left,f=l.right;else break}null!=a.nextInLML?0<=a.outIdx?(d=this.AddOutPt(a,
new V(a.topX,a.topY)),b&&this.AddGhostJoin(d,new V(a.botX,a.botY)),a=this.UpdateEdgeIntoAEL(a),0!=a.windDelta&&(c=a.prevInAEL,l=a.nextInAEL,null!=c&&c.currX==a.botX&&c.currY==a.botY&&0!=c.windDelta&&0<=c.outIdx&&c.currY>c.topY&&a.deltaY*c.deltaX==a.deltaX*c.deltaY?(b=this.AddOutPt(c,new V(a.botX,a.botY)),this.AddJoin(d,b,new V(a.topX,a.topY))):null!=l&&l.currX==a.botX&&l.currY==a.botY&&0!=l.windDelta&&0<=l.outIdx&&l.currY>l.topY&&a.deltaY*l.deltaX==a.deltaX*l.deltaY&&(b=this.AddOutPt(l,new V(a.botX,
a.botY)),this.AddJoin(d,b,new V(a.topX,a.topY))))):this.UpdateEdgeIntoAEL(a):(0<=a.outIdx&&this.AddOutPt(a,new V(a.topX,a.topY)),this.DeleteFromAEL(a))},GetNextInAEL:function(a,b){return b==Wb.LeftToRight?a.nextInAEL:a.prevInAEL},IsMinima:function(a){return null!=a&&a.prev.nextInLML!=a?a.next.nextInLML!=a:!1},IsMaxima:function(a,b){return null!=a&&a.topY==b?null==a.nextInLML:!1},IsIntermediate:function(a,b){return a.topY==b?null!=a.nextInLML:!1},GetMaximaPair:function(a){var b=null;a.next.topX==a.topX&&
a.next.topY==a.topY&&null==a.next.nextInLML?b=a.next:a.prev.topX==a.topX&&a.prev.topY==a.topY&&null==a.prev.nextInLML&&(b=a.prev);return null!=b&&(-2==b.outIdx||b.nextInAEL==b.prevInAEL&&0!=b.deltaY)?null:b},ProcessIntersections:function(a){if(null==this.m_ActiveEdges)return!0;this.BuildIntersectList(a);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1;this.m_SortedEdges=null;return!0},BuildIntersectList:function(a){if(null!=
this.m_ActiveEdges){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!=b;){b.prevInSEL=b.prevInAEL;b.nextInSEL=b.nextInAEL;if(a==b.topY)var c=b.topX;else{var d=b.dx*(a-b.botY);c=b.botX+(0>d?d-.5|0:d+.5|0)}b.currX=c;b=b.nextInAEL}for(c=!0;c&&null!=this.m_SortedEdges;){c=!1;for(b=this.m_SortedEdges;null!=b.nextInSEL;)if(a=b.nextInSEL,b.currX>a.currX){if(b.dx==a.dx)if(c=b.currY,c==b.topY)var e=b.topX;else d=b.dx*(c-b.botY),e=b.botX+(0>d?d-.5|0:d+.5|0);else{if(0==b.deltaX)if(e=b.botX,0==a.deltaY)c=
a.botY;else{var f=a.botY-a.botX/a.dx;c=e/a.dx+f;c=0>c?c-.5|0:c+.5|0}else if(0==a.deltaX)e=a.botX,0==b.deltaY?c=b.botY:(d=b.botY-b.botX/b.dx,c=e/b.dx+d,c=0>c?c-.5|0:c+.5|0);else{d=b.botX-b.botY*b.dx;f=a.botX-a.botY*a.dx;e=(f-d)/(b.dx-a.dx);c=0>e?e-.5|0:e+.5|0;var g=b.dx,h=a.dx;d=(0>g?-g:g)<(0>h?-h:h)?b.dx*e+d:a.dx*e+f;e=0>d?d-.5|0:d+.5|0}if(c<b.topY||c<a.topY)c=b.topY>a.topY?b.topY:a.topY,d=b.dx,f=a.dx,(0>d?-d:d)<(0>f?-f:f)?c==b.topY?e=b.topX:(d=b.dx*(c-b.botY),e=b.botX+(0>d?d-.5|0:d+.5|0)):c==a.topY?
e=a.topX:(d=a.dx*(c-a.botY),e=a.botX+(0>d?d-.5|0:d+.5|0));c>b.currY&&(c=b.currY,d=b.dx,f=a.dx,(0>d?-d:d)>(0>f?-f:f)?c==a.topY?e=a.topX:(d=a.dx*(c-a.botY),e=a.botX+(0>d?d-.5|0:d+.5|0)):c==b.topY?e=b.topX:(d=b.dx*(c-b.botY),e=b.botX+(0>d?d-.5|0:d+.5|0)))}c=new V(e,c);d=new Ji;d.edge1=b;d.edge2=a;d.pt=c;this.m_IntersectList.push(d);this.SwapPositionsInSEL(b,a);c=!0}else b=a;if(null!=b.prevInSEL)b.prevInSEL.nextInSEL=null;else break}this.m_SortedEdges=null}},EdgesAdjacent:function(a){return a.edge1.nextInSEL!=
a.edge2?a.edge1.prevInSEL==a.edge2:!0},IntersectNodeSort:function(a,b){return b.pt.y-a.pt.y|0},FixupIntersectionOrder:function(){this.m_IntersectList.sort(rb.compareY);var a=this.m_ActiveEdges;for(this.m_SortedEdges=a;null!=a;)a.prevInSEL=a.prevInAEL,a=a.nextInSEL=a.nextInAEL;a=this.m_IntersectList.length;for(var b=0;b<a;){var c=b++,d=this.m_IntersectList[c];if(d.edge1.nextInSEL!=d.edge2&&d.edge1.prevInSEL!=d.edge2){for(d=c+1;;){if(d<a){var e=this.m_IntersectList[d];e=!(e.edge1.nextInSEL==e.edge2||
e.edge1.prevInSEL==e.edge2)}else e=!1;if(!e)break;++d}if(d==a)return!1;e=this.m_IntersectList[c];this.m_IntersectList[c]=this.m_IntersectList[d];this.m_IntersectList[d]=e}this.SwapPositionsInSEL(this.m_IntersectList[c].edge1,this.m_IntersectList[c].edge2)}return!0},ProcessIntersectList:function(){for(var a=0,b=this.m_IntersectList.length;a<b;){var c=a++;c=this.m_IntersectList[c];this.IntersectEdges(c.edge1,c.edge2,c.pt);this.SwapPositionsInAEL(c.edge1,c.edge2)}this.m_IntersectList=[]},Round:function(a){return 0>
a?a-.5|0:a+.5|0},TopX:function(a,b){if(b==a.topY)return a.topX;b=a.dx*(b-a.botY);return a.botX+(0>b?b-.5|0:b+.5|0)},IntersectPoint:function(a,b){if(a.dx==b.dx){var c=a.currY;if(c==a.topY)var d=a.topX;else{var e=a.dx*(c-a.botY);d=a.botX+(0>e?e-.5|0:e+.5|0)}return new V(d,c)}if(0==a.deltaX)if(d=a.botX,0==b.deltaY)c=b.botY;else{var f=b.botY-b.botX/b.dx;e=d/b.dx+f;c=0>e?e-.5|0:e+.5|0}else if(0==b.deltaX)d=b.botX,0==a.deltaY?c=a.botY:(e=a.botY-a.botX/a.dx,e=d/a.dx+e,c=0>e?e-.5|0:e+.5|0);else{e=a.botX-
a.botY*a.dx;f=b.botX-b.botY*b.dx;var g=(f-e)/(a.dx-b.dx);c=0>g?g-.5|0:g+.5|0;var h=a.dx;d=b.dx;e=(0>h?-h:h)<(0>d?-d:d)?a.dx*g+e:b.dx*g+f;d=0>e?e-.5|0:e+.5|0}if(c<a.topY||c<b.topY)c=a.topY>b.topY?a.topY:b.topY,h=a.dx,d=b.dx,(0>h?-h:h)<(0>d?-d:d)?c==a.topY?d=a.topX:(e=a.dx*(c-a.botY),d=a.botX+(0>e?e-.5|0:e+.5|0)):c==b.topY?d=b.topX:(e=b.dx*(c-b.botY),d=b.botX+(0>e?e-.5|0:e+.5|0));c>a.currY&&(c=a.currY,h=a.dx,d=b.dx,(0>h?-h:h)>(0>d?-d:d)?c==b.topY?d=b.topX:(e=b.dx*(c-b.botY),d=b.botX+(0>e?e-.5|0:e+.5|
0)):c==a.topY?d=a.topX:(e=a.dx*(c-a.botY),d=a.botX+(0>e?e-.5|0:e+.5|0)));return new V(d,c)},ProcessEdgesAtTopOfScanbeam:function(a){for(var b,c,d,e=this.m_ActiveEdges;null!=e;){if(d=null!=e&&e.topY==a&&null==e.nextInLML)d=this.GetMaximaPair(e),d=null==d||0!=d.deltaY;d?(c=e.prevInAEL,this.DoMaxima(e),e=null==c?this.m_ActiveEdges:c.nextInAEL):(e.topY==a&&null!=e.nextInLML&&0==e.nextInLML.deltaY?(e=this.UpdateEdgeIntoAEL(e),0<=e.outIdx&&this.AddOutPt(e,new V(e.botX,e.botY)),this.AddEdgeToSEL(e)):(a==
e.topY?d=e.topX:(d=e.dx*(a-e.botY),d=e.botX+(0>d?d-.5|0:d+.5|0)),e.currX=d,e.currY=a),this.strictlySimple&&(d=e.prevInAEL,0<=e.outIdx&&0!=e.windDelta&&null!=d&&0<=d.outIdx&&d.currX==e.currX&&0!=d.windDelta&&(c=new V(e.currX,e.currY),d=this.AddOutPt(d,c),b=this.AddOutPt(e,c),this.AddJoin(d,b,c))),e=e.nextInAEL)}this.ProcessHorizontals(!0);for(e=this.m_ActiveEdges;null!=e;)e.topY==a&&null!=e.nextInLML&&(d=null,0<=e.outIdx&&(d=this.AddOutPt(e,new V(e.topX,e.topY))),e=this.UpdateEdgeIntoAEL(e),c=e.prevInAEL,
b=e.nextInAEL,null!=c&&c.currX==e.botX&&c.currY==e.botY&&null!=d&&0<=c.outIdx&&c.currY>c.topY&&e.deltaY*c.deltaX==e.deltaX*c.deltaY&&0!=e.windDelta&&0!=c.windDelta?(b=this.AddOutPt(c,new V(e.botX,e.botY)),this.AddJoin(d,b,new V(e.topX,e.topY))):null!=b&&b.currX==e.botX&&b.currY==e.botY&&null!=d&&0<=b.outIdx&&b.currY>b.topY&&e.deltaY*b.deltaX==e.deltaX*b.deltaY&&0!=e.windDelta&&0!=b.windDelta&&(c=this.AddOutPt(b,new V(e.botX,e.botY)),this.AddJoin(d,c,new V(e.topX,e.topY)))),e=e.nextInAEL},DoMaxima:function(a){var b=
this.GetMaximaPair(a);if(null==b)0<=a.outIdx&&this.AddOutPt(a,new V(a.topX,a.topY)),this.DeleteFromAEL(a);else{for(var c=a.nextInAEL;null!=c&&c!=b;)this.IntersectEdges(a,c,new V(a.topX,a.topY)),this.SwapPositionsInAEL(a,c),c=a.nextInAEL;if(-1==a.outIdx&&-1==b.outIdx)this.DeleteFromAEL(a),this.DeleteFromAEL(b);else if(0<=a.outIdx&&0<=b.outIdx)0<=a.outIdx&&this.AddLocalMaxPoly(a,b,new V(a.topX,a.topY)),this.DeleteFromAEL(a),this.DeleteFromAEL(b);else throw u.thrown("DoMaxima error");}},reversePolygons:function(a){for(var b=
0,c=a.length;b<c;){var d=a[b++];Ge.reverse(d)}},PointCount:function(a){if(null==a)return 0;var b=0,c=a;do++b,c=c.next;while(c!=a);return b},BuildResult:function(){for(var a=[],b=0,c=this.m_PolyOuts;b<c.length;){var d=c[b];++b;if(!(null==d.pts||this.resultKind==Tb.NoHoles&&d.isHole||this.resultKind==Tb.HolesOnly&&!d.isHole)){d=d.pts.prev;var e=this.PointCount(d);if(!(2>e)){for(var f=[],g=0;g<e;)g++,f.push(d.pt),d=d.prev;a.push(f)}}}return a},BuildResult2:function(a){a.clear();for(var b=0,c=this.m_PolyOuts;b<
c.length;){var d=c[b];++b;var e=this.PointCount(d.pts);if(!(3>e)){this.FixHoleLinkage(d);var f=new de;a.allPolys.push(f);d.polyNode=f;d=d.pts.prev;for(var g=0;g<e;)g++,f.polygon.push(d.pt),d=d.prev}}b=0;for(c=this.m_PolyOuts;b<c.length;)d=c[b],++b,null!=d.polyNode&&(null!=d.firstLeft&&null!=d.firstLeft.polyNode?d.firstLeft.polyNode.addChild(d.polyNode):a.addChild(d.polyNode))},FixupOutPolygon:function(a){var b=null;a.bottomPt=null;for(var c=a.pts;;){if(c.prev==c||c.prev==c.next){a.pts=null;return}var d=
c.pt;var e=c.next.pt;d.x!=e.x||d.y!=e.y?(d=c.pt,e=c.prev.pt,d=d.x==e.x&&d.y==e.y):d=!0;if(d)d=!0;else{d=c.prev.pt;e=c.pt;var f=c.next.pt;d=0==(d.y-e.y)*(e.x-f.x)-(d.x-e.x)*(e.y-f.y)&&(!this.preserveCollinear||!this.Pt2IsBetweenPt1AndPt3(c.prev.pt,c.pt,c.next.pt))}if(d)b=null,c.prev.next=c.next,c=c.next.prev=c.prev;else if(c==b)break;else null==b&&(b=c),c=c.next}a.pts=c},DupOutPt:function(a,b){var c=new Kf;c.pt=a.pt;c.idx=a.idx;b?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=a.prev,c.next=
a,a.prev.next=c,a.prev=c);return c},GetOverlap:function(a,b,c,d){if(a<b)if(c<d){var e=a<c?c:a;a=b>d?d:b}else e=a<d?d:a,a=b>c?c:b;else c<d?(e=b<c?c:b,a=a>d?d:a):(e=b<d?d:b,a=a>c?c:a);return{left:e,right:a,done:e<a}},JoinHorz:function(a,b,c,d,e,f){var g=a.pt.x>b.pt.x?Wb.RightToLeft:Wb.LeftToRight;d=c.pt.x>d.pt.x?Wb.RightToLeft:Wb.LeftToRight;if(g==d)return!1;if(g==Wb.LeftToRight){for(;a.next.pt.x<=e.x&&a.next.pt.x>=a.pt.x&&a.next.pt.y==e.y;)a=a.next;f&&a.pt.x!=e.x&&(a=a.next);b=this.DupOutPt(a,!f);
b.pt!=e&&(a=b,a.pt=e,b=this.DupOutPt(a,!f))}else{for(;a.next.pt.x>=e.x&&a.next.pt.x<=a.pt.x&&a.next.pt.y==e.y;)a=a.next;f||a.pt.x==e.x||(a=a.next);b=this.DupOutPt(a,f);b.pt!=e&&(a=b,a.pt=e,b=this.DupOutPt(a,f))}if(d==Wb.LeftToRight){for(;c.next.pt.x<=e.x&&c.next.pt.x>=c.pt.x&&c.next.pt.y==e.y;)c=c.next;f&&c.pt.x!=e.x&&(c=c.next);d=this.DupOutPt(c,!f);d.pt!=e&&(c=d,c.pt=e,d=this.DupOutPt(c,!f))}else{for(;c.next.pt.x>=e.x&&c.next.pt.x<=c.pt.x&&c.next.pt.y==e.y;)c=c.next;f||c.pt.x==e.x||(c=c.next);d=
this.DupOutPt(c,f);d.pt!=e&&(c=d,c.pt=e,d=this.DupOutPt(c,f))}g==Wb.LeftToRight==f?(a.prev=c,c.next=a,b.next=d,d.prev=b):(a.next=c,c.prev=a,b.prev=d,d.next=b);return!0},JoinPoints:function(a,b,c){var d=a.outPt1,e=a.outPt2,f;if(f=a.outPt1.pt.y==a.offPt.y){var g=a.offPt;var h=a.outPt1.pt;var k=g.x==h.x&&g.y==h.y}else k=!1;k?(g=a.offPt,h=a.outPt2.pt,h=g.x==h.x&&g.y==h.y):h=!1;if(h){if(b!=c)return!1;for(k=a.outPt1.next;;){k!=d?(g=k.pt,h=a.offPt,h=g.x==h.x&&g.y==h.y):h=!1;if(!h)break;k=k.next}k=k.pt.y>
a.offPt.y;for(f=a.outPt2.next;;){f!=e?(g=f.pt,h=a.offPt,h=g.x==h.x&&g.y==h.y):h=!1;if(!h)break;f=f.next}if(k==f.pt.y>a.offPt.y)return!1;k?(k=this.DupOutPt(d,!1),f=this.DupOutPt(e,!0),d.prev=e,e.next=d,k.next=f,f.prev=k):(k=this.DupOutPt(d,!0),f=this.DupOutPt(e,!1),d.next=e,e.prev=d,k.prev=f,f.next=k);a.outPt1=d;a.outPt2=k;return!0}if(f){for(k=d;d.prev.pt.y==d.pt.y&&d.prev!=k&&d.prev!=e;)d=d.prev;for(;k.next.pt.y==k.pt.y&&k.next!=d&&k.next!=e;)k=k.next;if(k.next==d||k.next==e)return!1;for(f=e;e.prev.pt.y==
e.pt.y&&e.prev!=f&&e.prev!=k;)e=e.prev;for(;f.next.pt.y==f.pt.y&&f.next!=e&&f.next!=d;)f=f.next;if(f.next==e||f.next==d)return!1;c=this.GetOverlap(d.pt.x,k.pt.x,e.pt.x,f.pt.x);if(!c.done)return!1;b=c.left;c=c.right;d.pt.x>=b&&d.pt.x<=c?(b=d.pt,c=d.pt.x>k.pt.x):e.pt.x>=b&&e.pt.x<=c?(b=e.pt,c=e.pt.x>f.pt.x):k.pt.x>=b&&k.pt.x<=c?(b=k.pt,c=k.pt.x>d.pt.x):(b=f.pt,c=f.pt.x>e.pt.x);a.outPt1=d;a.outPt2=e;return this.JoinHorz(d,k,e,f,b,c)}for(k=d.next;;){g=k.pt;h=d.pt;if(g.x!=h.x||g.y!=h.y||k==d)break;k=k.next}if(k.pt.y<=
d.pt.y){g=d.pt;h=k.pt;var l=a.offPt;var m=0!=(g.y-h.y)*(h.x-l.x)-(g.x-h.x)*(h.y-l.y)}else m=!0;if(m){for(k=d.prev;;){g=k.pt;h=d.pt;if(g.x!=h.x||g.y!=h.y||k==d)break;k=k.prev}k.pt.y<=d.pt.y?(g=d.pt,h=k.pt,l=a.offPt,h=0!=(g.y-h.y)*(h.x-l.x)-(g.x-h.x)*(h.y-l.y)):h=!0;if(h)return!1}for(f=e.next;;){g=f.pt;h=e.pt;if(g.x!=h.x||g.y!=h.y||f==e)break;f=f.next}if(f.pt.y<=e.pt.y){g=e.pt;h=f.pt;l=a.offPt;var p=0!=(g.y-h.y)*(h.x-l.x)-(g.x-h.x)*(h.y-l.y)}else p=!0;if(p){for(f=e.prev;;){g=f.pt;h=e.pt;if(g.x!=h.x||
g.y!=h.y||f==e)break;f=f.prev}f.pt.y<=e.pt.y?(g=e.pt,h=f.pt,l=a.offPt,h=0!=(g.y-h.y)*(h.x-l.x)-(g.x-h.x)*(h.y-l.y)):h=!0;if(h)return!1}if(k==d||f==e||k==f||b==c&&m==p)return!1;m?(k=this.DupOutPt(d,!1),f=this.DupOutPt(e,!0),d.prev=e,e.next=d,k.next=f,f.prev=k):(k=this.DupOutPt(d,!0),f=this.DupOutPt(e,!1),d.next=e,e.prev=d,k.prev=f,f.next=k);a.outPt1=d;a.outPt2=k;return!0},PointInPolygon:function(a,b){var c=0,d=b.length;if(3>d)return 0;for(var e=b[0],f=1,g=d+1;f<g;){var h=f++;h=h==d?b[0]:b[h];if(h.y==
a.y&&(h.x==a.x||e.y==a.y&&h.x>a.x==e.x<a.x))return-1;if(e.y<a.y!=h.y<a.y)if(e.x>=a.x)if(h.x>a.x)c=1-c;else{var k=(e.x-a.x)*(h.y-a.y)-(h.x-a.x)*(e.y-a.y);if(0==k)return-1;0<k==h.y>e.y&&(c=1-c)}else if(h.x>a.x){k=(e.x-a.x)*(h.y-a.y)-(h.x-a.x)*(e.y-a.y);if(0==k)return-1;0<k==h.y>e.y&&(c=1-c)}e=h}return c},PointInPolygon2:function(a,b){var c=0,d=b,e=a.x;a=a.y;var f=b.pt.x,g=b.pt.y;do{b=b.next;var h=b.pt.x,k=b.pt.y;if(k==a&&(h==e||g==a&&h>e==f<e))return-1;if(g<a!=k<a)if(f>=e)if(h>e)c=1-c;else{f=(f-e)*
(k-a)-(h-e)*(g-a);if(0==f)return-1;0<f==k>g&&(c=1-c)}else if(h>e){f=(f-e)*(k-a)-(h-e)*(g-a);if(0==f)return-1;0<f==k>g&&(c=1-c)}f=h;g=k}while(d!=b);return c},Poly2ContainsPoly1:function(a,b){var c=a;do{var d=this.PointInPolygon2(c.pt,b);if(0<=d)return 0<d;c=c.next}while(c!=a);return!0},FixupFirstLefts1:function(a,b){for(var c=0,d=this.m_PolyOuts;c<d.length;){var e=d[c];++c;null!=e.pts&&null!=e.firstLeft&&this.ParseFirstLeft(e.firstLeft)==a&&this.Poly2ContainsPoly1(e.pts,b.pts)&&(e.firstLeft=b)}},FixupFirstLefts2:function(a,
b){for(var c=0,d=this.m_PolyOuts;c<d.length;){var e=d[c];++c;e.firstLeft==a&&(e.firstLeft=b)}},ParseFirstLeft:function(a){for(;null!=a&&null==a.pts;)a=a.firstLeft;return a},JoinCommonEdges:function(){for(var a=0,b=this.m_Joins.length;a<b;){var c=a++,d=this.m_Joins[c];c=this.GetOutRec(d.outPt1.idx);var e=this.GetOutRec(d.outPt2.idx);if(null!=c.pts&&null!=e.pts){var f=c==e?c:this.Param1RightOfParam2(c,e)?e:this.Param1RightOfParam2(e,c)?c:this.GetLowermostRec(c,e);if(this.JoinPoints(d,c,e))if(c==e){c.pts=
d.outPt1;c.bottomPt=null;e=this.CreateOutRec();e.pts=d.outPt2;this.UpdateOutPtIdxs(e);if(this.m_UsingPolyTree){f=0;for(var g=this.m_PolyOuts.length-1;f<g;){var h=f++;h=this.m_PolyOuts[h];null!=h.pts&&this.ParseFirstLeft(h.firstLeft)==c&&h.isHole!=c.isHole&&this.Poly2ContainsPoly1(h.pts,d.outPt2)&&(h.firstLeft=e)}}this.Poly2ContainsPoly1(e.pts,c.pts)?(e.isHole=!c.isHole,e.firstLeft=c,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,c),c=this.reverseSolution,(e.isHole?!c:c)==0<this.Area(e)&&this.ReversePolyPtLinks(e.pts)):
this.Poly2ContainsPoly1(c.pts,e.pts)?(e.isHole=c.isHole,c.isHole=!e.isHole,e.firstLeft=c.firstLeft,c.firstLeft=e,this.m_UsingPolyTree&&this.FixupFirstLefts2(c,e),e=this.reverseSolution,(c.isHole?!e:e)==0<this.Area(c)&&this.ReversePolyPtLinks(c.pts)):(e.isHole=c.isHole,e.firstLeft=c.firstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(c,e))}else e.pts=null,e.bottomPt=null,e.idx=c.idx,c.isHole=f.isHole,f==e&&(c.firstLeft=e.firstLeft),e.firstLeft=c,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,c)}}},
UpdateOutPtIdxs:function(a){var b=a.pts;do b.idx=a.idx,b=b.prev;while(b!=a.pts)},DoSimplePolygons:function(){for(var a=0;a<this.m_PolyOuts.length;){var b=this.m_PolyOuts[a++],c=b.pts;if(null!=c){do{for(var d=c.next;d!=b.pts;){var e=c.pt,f=d.pt;e.x==f.x&&e.y==f.y&&d.next!=c&&d.prev!=c&&(e=c.prev,f=d.prev,c.prev=f,f.next=c,d.prev=e,e.next=d,b.pts=c,e=this.CreateOutRec(),e.pts=d,this.UpdateOutPtIdxs(e),this.Poly2ContainsPoly1(e.pts,b.pts)?(e.isHole=!b.isHole,e.firstLeft=b):this.Poly2ContainsPoly1(b.pts,
e.pts)?(e.isHole=b.isHole,b.isHole=!e.isHole,e.firstLeft=b.firstLeft,b.firstLeft=e):(e.isHole=b.isHole,e.firstLeft=b.firstLeft),d=c);d=d.next}c=c.next}while(c!=b.pts)}}},Area:function(a){var b=a.pts;if(null==b)return 0;var c=0;do c+=(b.pt.x+b.prev.pt.x)*(b.prev.pt.y-b.pt.y),b=b.next;while(b!=a.pts);return c/2},DistanceFromLineSqrd:function(a,b,c){var d=b.y-c.y;c=c.x-b.x;b=d*b.x+c*b.y;b=d*a.x+c*a.y-b;return b*b/(d*d+c*c)},SlopesNearCollinear:function(a,b,c,d){var e=a.x-b.x,f=a.y-b.y;return(0>e?-e:
e)>(0>f?-f:f)?a.x>b.x==a.x<c.x?this.DistanceFromLineSqrd(a,b,c)<d:b.x>a.x==b.x<c.x?this.DistanceFromLineSqrd(b,a,c)<d:this.DistanceFromLineSqrd(c,a,b)<d:a.y>b.y==a.y<c.y?this.DistanceFromLineSqrd(a,b,c)<d:b.y>a.y==b.y<c.y?this.DistanceFromLineSqrd(b,a,c)<d:this.DistanceFromLineSqrd(c,a,b)<d},PointsAreClose:function(a,b,c){var d=a.x-b.x;a=a.y-b.y;return d*d+a*a<=c},ExcludeOp:function(a){var b=a.prev;b.next=a.next;a.next.prev=b;b.idx=0;return b},CleanPolygon:function(a,b){null==b&&(b=1.415);var c=a.length;
if(0==c){var d=null;return null==d?[]:d}var e=[];d=0;for(var f=c;d<f;){var g=d++;e[g]=new Kf;e[g].pt=a[g];e[g].next=e[(g+1)%c];e[g].next.prev=e[g];e[g].idx=0}d=b*b;for(e=e[0];0==e.idx&&e.next!=e.prev;)this.PointsAreClose(e.pt,e.prev.pt,d)?(e=this.ExcludeOp(e),--c):this.PointsAreClose(e.prev.pt,e.next.pt,d)?(this.ExcludeOp(e.next),e=this.ExcludeOp(e),c-=2):this.SlopesNearCollinear(e.prev.pt,e.pt,e.next.pt,d)?(e=this.ExcludeOp(e),--c):(e.idx=1,e=e.next);3>c&&(c=0);d=null;a=null==d?[]:d;d=0;for(f=c;d<
f;)d++,a.push(e.pt),e=e.next;return a},CleanPolygons:function(a,b){null==b&&(b=1.415);for(var c=[],d=0,e=a.length;d<e;){var f=d++;c.push(this.CleanPolygon(a[f],b))}return c},Minkowski:function(a,b,c){var d=a.length,e=b.length;var f=null;for(var g=null==f?[]:f,h=0,k=e;h<k;){f=h++;var l=null;l=null==l?[]:l;for(var m=0,p=a,t=p.length;m<t;){var n=p[m++];c?l.push(new V(b[f].x+n.x,b[f].y+n.y)):l.push(new V(b[f].x-n.x,b[f].y-n.y))}g.push(l)}f=null;a=null==f?[]:f;h=0;for(k=e;h<k;)for(f=h++,b=0,c=d;b<c;)m=
b++,l=null,l=null==l?[]:l,l.push(g[f%e][m%d]),l.push(g[(f+1)%e][m%d]),l.push(g[(f+1)%e][(m+1)%d]),l.push(g[f%e][(m+1)%d]),0<=rb.polArea(l)||Ge.reverse(l),a.push(l);return a},MinkowskiSum:function(a,b,c){a=this.Minkowski(a,b,!0);b=new rb;b.resultKind=null==c?Tb.All:c;b.addPolygons(a,kb.Subject);return b.execute(bc.Union,Ha.NonZero,Ha.NonZero)},TranslatePath:function(a,b){for(var c=[],d=0,e=a.length;d<e;){var f=d++;c.push(new V(a[f].x+b.x,a[f].y+b.y))}return c},PolyTreeToPaths:function(a){var b=[];
this.AddPolyNodeToPaths(a,re.Any,b);return b},AddPolyNodeToPaths:function(a,b,c){if(1!=b._hx_index){0<a.polygon.length&&c.push(a.polygon);var d=0;for(a=a.childs;d<a.length;){var e=a[d];++d;this.AddPolyNodeToPaths(e,b,c)}}},__class__:rb});var ii=function(a,b){null==b&&(b=.25);null==a&&(a=2);this.two_pi=6.283185307179586;this.def_arc_tolerance=.25;this.MiterLimit=a;this.ArcTolerance=b;this.m_lowest=new V(-1,0);this.m_normals=[];this.m_polyNodes=new de;this.resultKind=Tb.All};z["hxd.clipper.ClipperOffset"]=
ii;ii.__name__="hxd.clipper.ClipperOffset";ii.prototype={clear:function(){this.m_polyNodes=new de;this.m_lowest=new V(-1,0)},addPolygon:function(a,b,c){var d=a.length-1;if(!(0>d)){var e=new de;e.jointype=b;e.endtype=c;if(c==ab.ClosedLine||c==ab.ClosedPol)for(;0<d&&a[0]==a[d];)--d;e.polygon.push(a[0]);var f=0;b=0;var g=1;for(d+=1;g<d;){var h=g++;e.polygon[f]!=a[h]&&(++f,e.polygon.push(a[h]),a[h].y>e.polygon[b].y||a[h].y==e.polygon[b].y&&a[h].x<e.polygon[b].x)&&(b=f)}if(!(c==ab.ClosedPol&&2>f)&&(this.m_polyNodes.addChild(e),
c==ab.ClosedPol))if(0>this.m_lowest.x)this.m_lowest=new V(this.m_polyNodes.childs.length-1,b);else if(a=this.m_polyNodes.childs[this.m_lowest.x].polygon[this.m_lowest.y],e.polygon[b].y>a.y||e.polygon[b].y==a.y&&e.polygon[b].x<a.x)this.m_lowest=new V(this.m_polyNodes.childs.length-1,b)}},addPolygons:function(a,b,c){for(var d=0,e=a.length;d<e;){var f=a[d++];this.addPolygon(f,b,c)}},fixOrientations:function(){var a;if(0<=this.m_lowest.x&&!(0<=rb.polArea(this.m_polyNodes.childs[this.m_lowest.x].polygon))){var b=
0;for(a=this.m_polyNodes.childs;b<a.length;){var c=a[b];++b;(c.endtype==ab.ClosedPol||c.endtype==ab.ClosedLine&&0<=rb.polArea(c.polygon))&&Ge.reverse(c.polygon)}}else for(b=0,a=this.m_polyNodes.childs;b<a.length;)c=a[b],++b,c.endtype!=ab.ClosedLine||0<=rb.polArea(c.polygon)||Ge.reverse(c.polygon)},getUnitNormal:function(a,b){var c=b.x-a.x;a=b.y-a.y;if(0==c&&0==a)return new ta(0,0);b=0;null==b&&(b=0);b=1/Math.sqrt(c*c+a*a+b*b);a*=b;c=-(c*b);null==c&&(c=0);null==a&&(a=0);return new ta(a,c)},doOffset:function(a){var b;
this.m_destPolys=[];this.m_delta=a;if(-1E-20<a&&1E-20>a){var c=0;for(b=this.m_polyNodes.childs;c<b.length;){var d=b[c];++c;d.endtype==ab.ClosedPol&&this.m_destPolys.push(d.polygon)}}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var e=0>=this.ArcTolerance?this.def_arc_tolerance:this.ArcTolerance>(0>a?-a:a)*this.def_arc_tolerance?(0>a?-a:a)*this.def_arc_tolerance:this.ArcTolerance;var f=3.141592653589793/Math.acos(1-e/(0>a?-a:a))|0;this.m_sin=Math.sin(this.two_pi/f);
this.m_cos=Math.cos(this.two_pi/f);this.m_StepsPerRad=f/this.two_pi;0>a&&(this.m_sin=-this.m_sin);c=0;for(b=this.m_polyNodes.childs;c<b.length;){d=b[c];++c;this.m_srcPoly=d.polygon;var g=this.m_srcPoly.length;if(!(0==g||0>=a&&(3>g||d.endtype!=ab.ClosedPol))){this.m_destPoly=[];if(1==g)if(d.jointype==Gc.Round){d=1;g=0;var h=1;for(e=f+1;h<e;){h++;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*a),Math.round(this.m_srcPoly[0].y+g*a)));var k=d;d=d*this.m_cos-this.m_sin*g;g=k*this.m_sin+g*
this.m_cos}}else g=d=-1,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*a),Math.round(this.m_srcPoly[0].y+g*a))),0>d?d=1:0>g?g=1:d=-1,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*a),Math.round(this.m_srcPoly[0].y+g*a))),0>d?d=1:0>g?g=1:d=-1,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*a),Math.round(this.m_srcPoly[0].y+g*a))),0>d?d=1:0>g?g=1:d=-1,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*a),Math.round(this.m_srcPoly[0].y+g*a)));else{this.m_normals=
[];h=0;for(e=g-1;h<e;)k=h++,this.m_normals.push(this.getUnitNormal(this.m_srcPoly[k],this.m_srcPoly[k+1]));d.endtype==ab.ClosedLine||d.endtype==ab.ClosedPol?this.m_normals.push(this.getUnitNormal(this.m_srcPoly[g-1],this.m_srcPoly[0])):this.m_normals.push(this.m_normals[g-2]);if(d.endtype==ab.ClosedPol)for(h=g-1,e=0;e<g;)k=e++,h=this.offsetPoint(k,h,d.jointype);else if(d.endtype==ab.ClosedLine){h=g-1;e=0;for(k=g;e<k;){var l=e++;h=this.offsetPoint(l,h,d.jointype)}this.m_destPolys.push(this.m_destPoly);
this.m_destPoly=[];h=this.m_normals[g-1];for(k=g-1;0<k;)l=-this.m_normals[k-1].x,e=-this.m_normals[k-1].y,null==e&&(e=0),null==l&&(l=0),this.m_normals[k]=new ta(l,e),--k;e=-h.x;h=-h.y;null==h&&(h=0);null==e&&(e=0);this.m_normals[0]=new ta(e,h);h=0;for(--g;0<g;)h=this.offsetPoint(g,h,d.jointype),--g}else{h=0;e=1;for(k=g-1;e<k;)l=e++,h=this.offsetPoint(l,h,d.jointype);if(d.endtype==ab.OpenButt)e=g-1,h=new V(Math.round(this.m_srcPoly[e].x+this.m_normals[e].x*a),Math.round(this.m_srcPoly[e].y+this.m_normals[e].y*
a)),this.m_destPoly.push(h),h=new V(Math.round(this.m_srcPoly[e].x-this.m_normals[e].x*a),Math.round(this.m_srcPoly[e].y-this.m_normals[e].y*a)),this.m_destPoly.push(h);else if(e=g-1,h=g-2,this.m_sinA=0,k=-this.m_normals[e].x,l=-this.m_normals[e].y,null==l&&(l=0),null==k&&(k=0),this.m_normals[e]=new ta(k,l),d.endtype==ab.OpenSquare)k=Math.tan(.25*Math.atan2(this.m_sinA,this.m_normals[h].x*this.m_normals[e].x+this.m_normals[h].y*this.m_normals[e].y)),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[e].x+
this.m_delta*(this.m_normals[h].x-this.m_normals[h].y*k)),Math.round(this.m_srcPoly[e].y+this.m_delta*(this.m_normals[h].y+this.m_normals[h].x*k)))),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[e].x+this.m_delta*(this.m_normals[e].x+this.m_normals[e].y*k)),Math.round(this.m_srcPoly[e].y+this.m_delta*(this.m_normals[e].y-this.m_normals[e].x*k))));else{k=Math.atan2(this.m_sinA,this.m_normals[h].x*this.m_normals[e].x+this.m_normals[h].y*this.m_normals[e].y);var m=Math.round(this.m_StepsPerRad*
(0>k?-k:k));k=this.m_normals[h].x;h=this.m_normals[h].y;l=0;for(var p=1>m?1:m;l<p;)l++,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[e].x+k*this.m_delta),Math.round(this.m_srcPoly[e].y+h*this.m_delta))),m=k,k=k*this.m_cos-this.m_sin*h,h=m*this.m_sin+h*this.m_cos;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[e].x+this.m_normals[e].x*this.m_delta),Math.round(this.m_srcPoly[e].y+this.m_normals[e].y*this.m_delta)))}for(h=g-1;0<h;)e=-this.m_normals[h-1].x,k=-this.m_normals[h-1].y,null==k&&
(k=0),null==e&&(e=0),this.m_normals[h]=new ta(e,k),--h;h=-this.m_normals[1].x;e=-this.m_normals[1].y;null==e&&(e=0);null==h&&(h=0);this.m_normals[0]=new ta(h,e);h=g-1;for(g=h-1;0<g;)h=this.offsetPoint(g,h,d.jointype),--g;if(d.endtype==ab.OpenButt)h=new V(Math.round(this.m_srcPoly[0].x-this.m_normals[0].x*a),Math.round(this.m_srcPoly[0].y-this.m_normals[0].y*a)),this.m_destPoly.push(h),h=new V(Math.round(this.m_srcPoly[0].x+this.m_normals[0].x*a),Math.round(this.m_srcPoly[0].y+this.m_normals[0].y*
a)),this.m_destPoly.push(h);else if(this.m_sinA=0,d.endtype==ab.OpenSquare)d=Math.tan(.25*Math.atan2(this.m_sinA,this.m_normals[1].x*this.m_normals[0].x+this.m_normals[1].y*this.m_normals[0].y)),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+this.m_delta*(this.m_normals[1].x-this.m_normals[1].y*d)),Math.round(this.m_srcPoly[0].y+this.m_delta*(this.m_normals[1].y+this.m_normals[1].x*d)))),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+this.m_delta*(this.m_normals[0].x+this.m_normals[0].y*
d)),Math.round(this.m_srcPoly[0].y+this.m_delta*(this.m_normals[0].y-this.m_normals[0].x*d))));else{d=Math.atan2(this.m_sinA,this.m_normals[1].x*this.m_normals[0].x+this.m_normals[1].y*this.m_normals[0].y);e=Math.round(this.m_StepsPerRad*(0>d?-d:d));d=this.m_normals[1].x;g=this.m_normals[1].y;h=0;for(k=1>e?1:e;h<k;)h++,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+d*this.m_delta),Math.round(this.m_srcPoly[0].y+g*this.m_delta))),e=d,d=d*this.m_cos-this.m_sin*g,g=e*this.m_sin+g*this.m_cos;
this.m_destPoly.push(new V(Math.round(this.m_srcPoly[0].x+this.m_normals[0].x*this.m_delta),Math.round(this.m_srcPoly[0].y+this.m_normals[0].y*this.m_delta)))}}}this.m_destPolys.push(this.m_destPoly)}}}},execute:function(a){this.fixOrientations();this.doOffset(a);var b=new rb;b.resultKind=this.resultKind;b.addPolygons(this.m_destPolys,kb.Subject);if(0<a)return b.execute(bc.Union,Ha.Positive,Ha.Positive);a=id.getBounds(this.m_destPolys);var c=[];c.push(new V(a.left-10,a.bottom+10));c.push(new V(a.right+
10,a.bottom+10));c.push(new V(a.right+10,a.top-10));c.push(new V(a.left-10,a.top-10));b.addPolygon(c,kb.Subject);b.reverseSolution=!0;b=b.execute(bc.Union,Ha.Negative,Ha.Negative);0<b.length&&b.shift();return b},offsetPoint:function(a,b,c){this.m_sinA=this.m_normals[b].x*this.m_normals[a].y-this.m_normals[a].x*this.m_normals[b].y;var d=this.m_sinA*this.m_delta;if(1>(0>d?-d:d)){if(0<this.m_normals[b].x*this.m_normals[a].x+this.m_normals[a].y*this.m_normals[b].y)return this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+
this.m_normals[b].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[b].y*this.m_delta))),b}else 1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)d=new V(Math.round(this.m_srcPoly[a].x+this.m_normals[b].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[b].y*this.m_delta)),b=new V(Math.round(this.m_srcPoly[a].x+this.m_normals[a].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[a].y*this.m_delta)),this.m_destPoly.push(d),
c=d.x-b.x,d=d.y-b.y,1<c*c+d*d&&(this.m_destPoly.push(this.m_srcPoly[a]),this.m_destPoly.push(b));else switch(c._hx_index){case 0:c=Math.tan(.25*Math.atan2(this.m_sinA,this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*this.m_normals[a].y));this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[b].x-this.m_normals[b].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[b].y+this.m_normals[b].x*c))));this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+
this.m_delta*(this.m_normals[a].x+this.m_normals[a].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[a].y-this.m_normals[a].x*c))));break;case 1:c=Math.atan2(this.m_sinA,this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*this.m_normals[a].y);var e=Math.round(this.m_StepsPerRad*(0>c?-c:c));c=this.m_normals[b].x;b=this.m_normals[b].y;d=0;for(var f=1>e?1:e;d<f;)d++,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+c*this.m_delta),Math.round(this.m_srcPoly[a].y+b*this.m_delta))),
e=c,c=c*this.m_cos-this.m_sin*b,b=e*this.m_sin+b*this.m_cos;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_normals[a].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[a].y*this.m_delta)));break;case 2:c=1+(this.m_normals[a].x*this.m_normals[b].x+this.m_normals[a].y*this.m_normals[b].y),c>=this.m_miterLim?(c=this.m_delta/c,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+(this.m_normals[b].x+this.m_normals[a].x)*c),Math.round(this.m_srcPoly[a].y+(this.m_normals[b].y+
this.m_normals[a].y)*c)))):(c=Math.tan(.25*Math.atan2(this.m_sinA,this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*this.m_normals[a].y)),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[b].x-this.m_normals[b].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[b].y+this.m_normals[b].x*c)))),this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[a].x+this.m_normals[a].y*c)),Math.round(this.m_srcPoly[a].y+
this.m_delta*(this.m_normals[a].y-this.m_normals[a].x*c)))))}return a},doSquare:function(a,b){var c=Math.tan(.25*Math.atan2(this.m_sinA,this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*this.m_normals[a].y));this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[b].x-this.m_normals[b].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[b].y+this.m_normals[b].x*c))));this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_delta*(this.m_normals[a].x+
this.m_normals[a].y*c)),Math.round(this.m_srcPoly[a].y+this.m_delta*(this.m_normals[a].y-this.m_normals[a].x*c))))},doMiter:function(a,b,c){c=this.m_delta/c;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+(this.m_normals[b].x+this.m_normals[a].x)*c),Math.round(this.m_srcPoly[a].y+(this.m_normals[b].y+this.m_normals[a].y)*c)))},doRound:function(a,b){var c=Math.atan2(this.m_sinA,this.m_normals[b].x*this.m_normals[a].x+this.m_normals[b].y*this.m_normals[a].y),d=Math.round(this.m_StepsPerRad*
(0>c?-c:c));c=this.m_normals[b].x;b=this.m_normals[b].y;for(var e=0,f=1>d?1:d;e<f;)e++,this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+c*this.m_delta),Math.round(this.m_srcPoly[a].y+b*this.m_delta))),d=c,c=c*this.m_cos-this.m_sin*b,b=d*this.m_sin+b*this.m_cos;this.m_destPoly.push(new V(Math.round(this.m_srcPoly[a].x+this.m_normals[a].x*this.m_delta),Math.round(this.m_srcPoly[a].y+this.m_normals[a].y*this.m_delta)))},__class__:ii};var ab=L["hxd.clipper.EndType"]={__ename__:!0,__constructs__:null,
ClosedPol:{_hx_name:"ClosedPol",_hx_index:0,__enum__:"hxd.clipper.EndType",toString:v},ClosedLine:{_hx_name:"ClosedLine",_hx_index:1,__enum__:"hxd.clipper.EndType",toString:v},OpenButt:{_hx_name:"OpenButt",_hx_index:2,__enum__:"hxd.clipper.EndType",toString:v},OpenSquare:{_hx_name:"OpenSquare",_hx_index:3,__enum__:"hxd.clipper.EndType",toString:v},OpenRound:{_hx_name:"OpenRound",_hx_index:4,__enum__:"hxd.clipper.EndType",toString:v}};ab.__constructs__=[ab.ClosedPol,ab.ClosedLine,ab.OpenButt,ab.OpenSquare,
ab.OpenRound];ab.__empty_constructs__=[ab.ClosedPol,ab.ClosedLine,ab.OpenButt,ab.OpenSquare,ab.OpenRound];var Gc=L["hxd.clipper.JoinType"]={__ename__:!0,__constructs__:null,Square:{_hx_name:"Square",_hx_index:0,__enum__:"hxd.clipper.JoinType",toString:v},Round:{_hx_name:"Round",_hx_index:1,__enum__:"hxd.clipper.JoinType",toString:v},Miter:{_hx_name:"Miter",_hx_index:2,__enum__:"hxd.clipper.JoinType",toString:v}};Gc.__constructs__=[Gc.Square,Gc.Round,Gc.Miter];Gc.__empty_constructs__=[Gc.Square,Gc.Round,
Gc.Miter];var Ha=L["hxd.clipper.PolyFillType"]={__ename__:!0,__constructs__:null,EvenOdd:{_hx_name:"EvenOdd",_hx_index:0,__enum__:"hxd.clipper.PolyFillType",toString:v},NonZero:{_hx_name:"NonZero",_hx_index:1,__enum__:"hxd.clipper.PolyFillType",toString:v},Positive:{_hx_name:"Positive",_hx_index:2,__enum__:"hxd.clipper.PolyFillType",toString:v},Negative:{_hx_name:"Negative",_hx_index:3,__enum__:"hxd.clipper.PolyFillType",toString:v}};Ha.__constructs__=[Ha.EvenOdd,Ha.NonZero,Ha.Positive,Ha.Negative];
Ha.__empty_constructs__=[Ha.EvenOdd,Ha.NonZero,Ha.Positive,Ha.Negative];var kb=L["hxd.clipper.PolyType"]={__ename__:!0,__constructs__:null,Subject:{_hx_name:"Subject",_hx_index:0,__enum__:"hxd.clipper.PolyType",toString:v},Clip:{_hx_name:"Clip",_hx_index:1,__enum__:"hxd.clipper.PolyType",toString:v}};kb.__constructs__=[kb.Subject,kb.Clip];kb.__empty_constructs__=[kb.Subject,kb.Clip];var Li=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.left=a;this.top=b;this.right=
c;this.bottom=d};z["hxd.clipper.Rect"]=Li;Li.__name__="hxd.clipper.Rect";Li.prototype={__class__:Li};var Pd=function(){};z["hxd.earcut.EarNode"]=Pd;Pd.__name__="hxd.earcut.EarNode";Pd.prototype={__class__:Pd};var Ug=function(){};z["hxd.earcut.Earcut"]=Ug;Ug.__name__="hxd.earcut.Earcut";Ug.prototype={triangulate_anon_y_Float_x_Float:function(a,b){var c=null!=b&&0<b.length?b[0]:a.length;if(3>c)return[];c=this.setLinkedList_triangulate_T(a,0,c,!0);null!=b&&(c=this.eliminateHoles_triangulate_T(a,b,c));
return this.triangulateNode(c,80<a.length)},triangulate_h2d_GPoint:function(a,b){var c=null!=b&&0<b.length?b[0]:a.length;if(3>c)return[];c=this.setLinkedList_triangulate_T(a,0,c,!0);null!=b&&(c=this.eliminateHoles_triangulate_T(a,b,c));return this.triangulateNode(c,80<a.length)},eliminateHoles_triangulate_T:function(a,b,c){for(var d=[],e=0,f=b.length;e<f;){var g=e++;g=this.setLinkedList_eliminateHoles_T(a,b[g],g==b.length-1?a.length:b[g+1],!1);g==g.next&&(g.steiner=!0);d.push(this.getLeftmost(g))}d.sort(M(this,
this.compareX));for(e=0;e<d.length;)a=d[e],++e,this.eliminateHole(a,c),c=this.filterPoints(c,c.next);return c},setLinkedList_eliminateHoles_T:function(a,b,c,d){var e,f=0,g=c-1;var h=b;for(e=c;h<e;){var k=h++;f+=(a[g].x-a[k].x)*(a[k].y+a[g].y);g=k}var l=this.cache;null==l?(l=new Pd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next;l.i=-1;l.z=-1;l.x=0;l.y=0;l.next=null;l.prev=null;l.steiner=!1;l.prevZ=null;l.nextZ=null;var m=g=l;if(d==0<f)for(h=b,e=c;h<e;)k=h++,l=a[k],c=l.x,d=l.y,l=this.cache,
null==l?(l=new Pd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next,l.i=k,l.z=-1,l.x=c,l.y=d,l.next=null,l.prev=g,l.steiner=!1,l.prevZ=null,l.nextZ=null,null!=g&&(g.next=l),g=l;else for(k=c-1;k>=b;)l=a[k],c=l.x,d=l.y,l=this.cache,null==l?(l=new Pd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next,l.i=k,l.z=-1,l.x=c,l.y=d,l.next=null,l.prev=g,l.steiner=!1,l.prevZ=null,l.nextZ=null,null!=g&&(g.next=l),g=l,--k;g.next=m.next;return g.next.prev=g},setLinkedList_triangulate_T:function(a,
b,c,d){var e,f=0,g=c-1;var h=b;for(e=c;h<e;){var k=h++;f+=(a[g].x-a[k].x)*(a[k].y+a[g].y);g=k}var l=this.cache;null==l?(l=new Pd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next;l.i=-1;l.z=-1;l.x=0;l.y=0;l.next=null;l.prev=null;l.steiner=!1;l.prevZ=null;l.nextZ=null;var m=g=l;if(d==0<f)for(h=b,e=c;h<e;)k=h++,l=a[k],c=l.x,d=l.y,l=this.cache,null==l?(l=new Pd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next,l.i=k,l.z=-1,l.x=c,l.y=d,l.next=null,l.prev=g,l.steiner=!1,l.prevZ=
null,l.nextZ=null,null!=g&&(g.next=l),g=l;else for(k=c-1;k>=b;)l=a[k],c=l.x,d=l.y,l=this.cache,null==l?(l=new Pd,l.allocNext=this.allocated,this.allocated=l):this.cache=l.next,l.i=k,l.z=-1,l.x=c,l.y=d,l.next=null,l.prev=g,l.steiner=!1,l.prevZ=null,l.nextZ=null,null!=g&&(g.next=l),g=l,--k;g.next=m.next;return g.next.prev=g},triangulateNode:function(a,b){this.triangles=[];a=this.filterPoints(a);if(b&&null!=a){var c=a.x;this.minX=c;this.minY=b=a.y;for(var d=a.next;d!=a;){var e=d.x,f=d.y;e<this.minX&&
(this.minX=e);f<this.minY&&(this.minY=f);e>c&&(c=e);f>b&&(b=f);d=d.next}c-=this.minX;b-=this.minY;this.size=c<b?b:c;this.hasSize=!0}else this.hasSize=!1;this.earcutLinked(a);a=this.triangles;this.triangles=null;b=this.allocated;if(null!=this.cache){for(;b!=this.cache;)b=b.allocNext;b=b.allocNext}for(;null!=b;)b.next=this.cache,this.cache=b,b=b.allocNext;return a},eliminateHole:function(a,b){b=this.findHoleBridge(a,b);null!=b&&(a=this.splitPolygon(b,a),this.filterPoints(a,a.next))},findHoleBridge:function(a,
b){var c=b,d=a.x,e=a.y,f=-Infinity,g=null;do{if(e<=c.y&&e>=c.next.y){var h=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);h<=d&&h>f&&(f=h,g=c.x<c.next.x?c:c.next)}c=c.next}while(c!=b);if(null==g)return null;b=g;h=Infinity;for(c=g.next;c!=b;){if(d>=c.x&&c.x>=g.x){var k=e<g.y?d:f;var l=g.x,m=g.y,p=e<g.y?f:d,t=c.x,n=c.y;k=0<=(p-t)*(e-n)-(k-t)*(e-n)&&0<=(k-t)*(m-n)-(l-t)*(e-n)&&0<=(l-t)*(e-n)-(p-t)*(m-n)}else k=!1;k&&(k=e-c.y,k=(0>k?-k:k)/(d-c.x),k<h||k==h&&c.x>g.x?(l=c.prev,m=c.next,0>(c.y-l.y)*(m.x-c.x)-
(c.x-l.x)*(m.y-c.y)?(l=c.next,0<=(a.y-c.y)*(l.x-a.x)-(a.x-c.x)*(l.y-a.y)?(l=c.prev,l=0<=(l.y-c.y)*(a.x-l.x)-(l.x-c.x)*(a.y-l.y)):l=!1):(l=c.prev,0>(a.y-c.y)*(l.x-a.x)-(a.x-c.x)*(l.y-a.y)?l=!0:(l=c.next,l=0>(l.y-c.y)*(a.x-l.x)-(l.x-c.x)*(a.y-l.y)))):l=!1,l&&(g=c,h=k));c=c.next}return g},getLeftmost:function(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!=a);return c},compareX:function(a,b){return 0<a.x-b.x?1:-1},equals:function(a,b){return a.x==b.x?a.y==b.y:!1},area:function(a,b,c){return(b.y-a.y)*
(c.x-b.x)-(b.x-a.x)*(c.y-b.y)},intersects:function(a,b,c,d){return 0<(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)!=0<(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-b.y)?0<(d.y-c.y)*(a.x-d.x)-(d.x-c.x)*(a.y-d.y)!=0<(d.y-c.y)*(b.x-d.x)-(d.x-c.x)*(b.y-d.y):!1},locallyInside:function(a,b){var c=a.prev;var d=a.next;if(0>(a.y-c.y)*(d.x-a.x)-(a.x-c.x)*(d.y-a.y))return d=a.next,0<=(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-b.y)?(d=a.prev,0<=(d.y-a.y)*(b.x-d.x)-(d.x-a.x)*(b.y-d.y)):!1;d=a.prev;if(0>(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-
b.y))return!0;d=a.next;return 0>(d.y-a.y)*(b.x-d.x)-(d.x-a.x)*(b.y-d.y)},filterPoints:function(a,b){if(null==a)return a;null==b&&(b=a);do{var c=!1;if(a.steiner)var d=!1;else if(d=a.next,a.x!=d.x||a.y!=d.y){d=a.prev;var e=a.next;d=0==(a.y-d.y)*(e.x-a.x)-(a.x-d.x)*(e.y-a.y)}else d=!0;if(d){a.next.prev=a.prev;a.prev.next=a.next;null!=a.prevZ&&(a.prevZ.nextZ=a.nextZ);null!=a.nextZ&&(a.nextZ.prevZ=a.prevZ);a=b=a.prev;if(a==a.next)return null;c=!0}else a=a.next}while(c||a!=b);return b},removeNode:function(a){a.next.prev=
a.prev;a.prev.next=a.next;null!=a.prevZ&&(a.prevZ.nextZ=a.nextZ);null!=a.nextZ&&(a.nextZ.prevZ=a.prevZ)},allocNode:function(a,b,c,d){var e=this.cache;null==e?(e=new Pd,e.allocNext=this.allocated,this.allocated=e):this.cache=e.next;e.i=a;e.z=-1;e.x=b;e.y=c;e.next=null;e.prev=d;e.steiner=!1;e.prevZ=null;e.nextZ=null;null!=d&&(d.next=e);return e},earcutLinked:function(a,b){null==b&&(b=0);if(null!=a){0==b&&this.hasSize&&this.indexCurve(a);for(var c=a,d,e;a.prev!=a.next;)if(d=a.prev,e=a.next,this.hasSize?
this.isEarHashed(a):this.isEar(a))this.triangles.push(d.i),this.triangles.push(a.i),this.triangles.push(e.i),a.next.prev=a.prev,a.prev.next=a.next,null!=a.prevZ&&(a.prevZ.nextZ=a.nextZ),null!=a.nextZ&&(a.nextZ.prevZ=a.prevZ),c=a=e.next;else if(a=e,a==c){switch(b){case 0:this.earcutLinked(this.filterPoints(a),1);break;case 1:a=this.cureLocalIntersections(a);this.earcutLinked(a,2);break;case 2:this.splitEarcut(a)}break}}},isEar:function(a){var b=a.prev,c=a.next;if(0<=(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-
a.y))return!1;for(var d=a.next.next;d!=a.prev;){var e=b.x;var f=b.y,g=a.x,h=a.y,k=c.x,l=c.y,m=d.x,p=d.y;0<=(k-m)*(f-p)-(e-m)*(l-p)&&0<=(e-m)*(h-p)-(g-m)*(f-p)&&0<=(g-m)*(l-p)-(k-m)*(h-p)?(e=d.prev,f=d.next,e=0<=(d.y-e.y)*(f.x-d.x)-(d.x-e.x)*(f.y-d.y)):e=!1;if(e)return!1;d=d.next}return!0},isEarHashed:function(a){var b=a.prev,c=a.next;if(0<=(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-a.y))return!1;var d=b.x>a.x?b.x>c.x?b.x:c.x:a.x>c.x?a.x:c.x,e=b.y>a.y?b.y>c.y?b.y:c.y:a.y>c.y?a.y:c.y;var f=32767*((b.x<a.x?
b.x<c.x?b.x:c.x:a.x<c.x?a.x:c.x)-this.minX)/this.size|0;var g=32767*((b.y<a.y?b.y<c.y?b.y:c.y:a.y<c.y?a.y:c.y)-this.minY)/this.size|0;f=(f|f<<8)&16711935;f=(f|f<<4)&252645135;f=(f|f<<2)&858993459;g=(g|g<<8)&16711935;g=(g|g<<4)&252645135;g=(g|g<<2)&858993459;var h=(f|f<<1)&1431655765|((g|g<<1)&1431655765)<<1;f=32767*(d-this.minX)/this.size|0;g=32767*(e-this.minY)/this.size|0;f=(f|f<<8)&16711935;f=(f|f<<4)&252645135;f=(f|f<<2)&858993459;g=(g|g<<8)&16711935;g=(g|g<<4)&252645135;g=(g|g<<2)&858993459;
d=(f|f<<1)&1431655765|((g|g<<1)&1431655765)<<1;for(e=a.nextZ;null!=e&&e.z<=d;){if(e!=a.prev&&e!=a.next){var k=b.x;var l=b.y;var m=a.x;var p=a.y;var t=c.x;var n=c.y;g=e.x;f=e.y;f=0<=(t-g)*(l-f)-(k-g)*(n-f)&&0<=(k-g)*(p-f)-(m-g)*(l-f)&&0<=(m-g)*(n-f)-(t-g)*(p-f)}else f=!1;f?(g=e.prev,f=e.next,f=0<=(e.y-g.y)*(f.x-e.x)-(e.x-g.x)*(f.y-e.y)):f=!1;if(f)return!1;e=e.nextZ}for(e=a.prevZ;null!=e&&e.z>=h;){e!=a.prev&&e!=a.next?(k=b.x,l=b.y,m=a.x,p=a.y,t=c.x,n=c.y,g=e.x,f=e.y,f=0<=(t-g)*(l-f)-(k-g)*(n-f)&&0<=
(k-g)*(p-f)-(m-g)*(l-f)&&0<=(m-g)*(n-f)-(t-g)*(p-f)):f=!1;f?(g=e.prev,f=e.next,f=0<=(e.y-g.y)*(f.x-e.x)-(e.x-g.x)*(f.y-e.y)):f=!1;if(f)return!1;e=e.prevZ}return!0},cureLocalIntersections:function(a){var b=a;do{var c=b.prev,d=b.next.next;var e=b.next;if(0<(b.y-c.y)*(e.x-b.x)-(b.x-c.x)*(e.y-b.y)!=0<(b.y-c.y)*(d.x-b.x)-(b.x-c.x)*(d.y-b.y)&&0<(d.y-e.y)*(c.x-d.x)-(d.x-e.x)*(c.y-d.y)!=0<(d.y-e.y)*(b.x-d.x)-(d.x-e.x)*(b.y-d.y)){e=c.prev;var f=c.next;0>(c.y-e.y)*(f.x-c.x)-(c.x-e.x)*(f.y-c.y)?(e=c.next,0<=
(d.y-c.y)*(e.x-d.x)-(d.x-c.x)*(e.y-d.y)?(e=c.prev,e=0<=(e.y-c.y)*(d.x-e.x)-(e.x-c.x)*(d.y-e.y)):e=!1):(e=c.prev,0>(d.y-c.y)*(e.x-d.x)-(d.x-c.x)*(e.y-d.y)?e=!0:(e=c.next,e=0>(e.y-c.y)*(d.x-e.x)-(e.x-c.x)*(d.y-e.y)))}else e=!1;e?(e=d.prev,f=d.next,0>(d.y-e.y)*(f.x-d.x)-(d.x-e.x)*(f.y-d.y)?(e=d.next,0<=(c.y-d.y)*(e.x-c.x)-(c.x-d.x)*(e.y-c.y)?(e=d.prev,e=0<=(e.y-d.y)*(c.x-e.x)-(e.x-d.x)*(c.y-e.y)):e=!1):(e=d.prev,0>(c.y-d.y)*(e.x-c.x)-(c.x-d.x)*(e.y-c.y)?e=!0:(e=d.next,e=0>(e.y-d.y)*(c.x-e.x)-(e.x-d.x)*
(c.y-e.y)))):e=!1;e&&(this.triangles.push(c.i),this.triangles.push(b.i),this.triangles.push(d.i),b.next.prev=b.prev,b.prev.next=b.next,null!=b.prevZ&&(b.prevZ.nextZ=b.nextZ),null!=b.nextZ&&(b.nextZ.prevZ=b.prevZ),a=b.next,a.next.prev=a.prev,a.prev.next=a.next,null!=a.prevZ&&(a.prevZ.nextZ=a.nextZ),null!=a.nextZ&&(a.nextZ.prevZ=a.prevZ),b=a=d);b=b.next}while(b!=a);return b},splitEarcut:function(a){var b=a;do{for(var c=b.next.next;c!=b.prev;){if(b.i!=c.i&&this.isValidDiagonal(b,c)){a=this.splitPolygon(b,
c);b=this.filterPoints(b,b.next);a=this.filterPoints(a,a.next);this.earcutLinked(b);this.earcutLinked(a);return}c=c.next}b=b.next}while(b!=a)},splitPolygon:function(a,b){var c=a.i,d=a.x,e=a.y,f=null,g=this.cache;null==g?(g=new Pd,g.allocNext=this.allocated,this.allocated=g):this.cache=g.next;g.i=c;g.z=-1;g.x=d;g.y=e;g.next=null;g.prev=f;g.steiner=!1;g.prevZ=null;g.nextZ=null;null!=f&&(f.next=g);var h=g;c=b.i;d=b.x;e=b.y;f=null;g=this.cache;null==g?(g=new Pd,g.allocNext=this.allocated,this.allocated=
g):this.cache=g.next;g.i=c;g.z=-1;g.x=d;g.y=e;g.next=null;g.prev=f;g.steiner=!1;g.prevZ=null;g.nextZ=null;null!=f&&(f.next=g);c=g;d=a.next;e=b.prev;a.next=b;b.prev=a;h.next=d;d.prev=h;c.next=h;h.prev=c;e.next=c;c.prev=e;return c},pointInTriangle:function(a,b,c,d,e,f,g,h){return 0<=(e-g)*(b-h)-(a-g)*(f-h)&&0<=(a-g)*(d-h)-(c-g)*(b-h)?0<=(c-g)*(f-h)-(e-g)*(d-h):!1},isValidDiagonal:function(a,b){if(a.x!=b.x||a.y!=b.y){if(a.next.i==b.i||a.prev.i==b.i||this.intersectsPolygon(a,b))var c=!1;else{var d=a.prev;
c=a.next;0>(a.y-d.y)*(c.x-a.x)-(a.x-d.x)*(c.y-a.y)?(c=a.next,0<=(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)?(c=a.prev,c=0<=(c.y-a.y)*(b.x-c.x)-(c.x-a.x)*(b.y-c.y)):c=!1):(c=a.prev,0>(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)?c=!0:(c=a.next,c=0>(c.y-a.y)*(b.x-c.x)-(c.x-a.x)*(b.y-c.y)))}c?(d=b.prev,c=b.next,0>(b.y-d.y)*(c.x-b.x)-(b.x-d.x)*(c.y-b.y)?(c=b.next,0<=(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-a.y)?(c=b.prev,c=0<=(c.y-b.y)*(a.x-c.x)-(c.x-b.x)*(a.y-c.y)):c=!1):(c=b.prev,0>(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-
a.y)?c=!0:(c=b.next,c=0>(c.y-b.y)*(a.x-c.x)-(c.x-b.x)*(a.y-c.y)))):c=!1;return c?this.middleInside(a,b):!1}return!0},middleInside:function(a,b){var c=a,d=!1,e=(a.x+b.x)/2;b=(a.y+b.y)/2;do c.y>b!=c.next.y>b&&e<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!=a);return d},intersectsPolygon:function(a,b){var c=a;do{if(c.i!=a.i&&c.next.i!=a.i&&c.i!=b.i&&c.next.i!=b.i){var d=c.next;d=0<(d.y-c.y)*(a.x-d.x)-(d.x-c.x)*(a.y-d.y)!=0<(d.y-c.y)*(b.x-d.x)-(d.x-c.x)*(b.y-d.y)&&0<(b.y-a.y)*(c.x-
b.x)-(b.x-a.x)*(c.y-b.y)!=0<(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-b.y)}else d=!1;if(d)return!0;c=c.next}while(c!=a);return!1},zOrder:function(a,b){a=32767*(a-this.minX)/this.size|0;b=32767*(b-this.minY)/this.size|0;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1},indexCurve:function(a){var b=a;do{if(0>b.z){var c=32767*(b.x-this.minX)/this.size|0,d=32767*(b.y-this.minY)/this.size|
0;c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;c=(c|c<<1)&1431655765;d=(d|d<<8)&16711935;d=(d|d<<4)&252645135;d=(d|d<<2)&858993459;d=(d|d<<1)&1431655765;b.z=c|d<<1}b.prevZ=b.prev;b=b.nextZ=b.next}while(b!=a);b.prevZ.nextZ=null;b.prevZ=null;this.sortLinked(b)},sortLinked:function(a){var b,c,d,e=1;do{var f=a;var g=a=null;for(b=0;null!=f;){++b;var h=f;var k=c=0;for(d=e;k<d&&(k++,++c,h=h.nextZ,null!=h););for(d=e;0<c||0<d&&null!=h;)0==c?(k=h,h=h.nextZ,--d):0==d||null==h?(k=f,f=f.nextZ,
--c):f.z<=h.z?(k=f,f=f.nextZ,--c):(k=h,h=h.nextZ,--d),null!=g?g.nextZ=k:a=k,k.prevZ=g,g=k;f=h}g.nextZ=null;e*=2}while(1<b);return a},__class__:Ug};var Mi=function(){};z["hxd.fmt.bfnt.FontParser"]=Mi;Mi.__name__="hxd.fmt.bfnt.FontParser";Mi.parse=function(a,b,c){var d,e,f=null,g=new Xf(null,0),h=g.glyphs;g.baseLine=0;var k=a.getInt32(0);switch(k){case 54938946:a=new Zb(a);a.set_position(a.pos+4);for(d=0;a.pos<a.totlen;){d=a.readByte();k=a.readInt32();var l=a.pos;switch(d){case 1:g.size=g.initSize=
a.readInt16();a.set_position(a.pos+12);g.name=a.readUntil(0);break;case 2:g.lineHeight=a.readUInt16();g.baseLine=a.readUInt16();a.set_position(a.pos+4);d=a.readUInt16();1!=d&&Ka.trace("Warning: BMF format only supports one page at the moment.",{fileName:"hxd/fmt/bfnt/FontParser.hx",lineNumber:220,className:"hxd.fmt.bfnt.FontParser",methodName:"parse"});break;case 3:var m=a.readUntil(0);try{g.tilePath=m,f=c(Sa.join([Sa.directory(b),m]))}catch(Sj){Ka.trace('Warning: Could not find referenced font texture at "'+
m+'", trying to resolve same name as fnt!',{fileName:"hxd/fmt/bfnt/FontParser.hx",lineNumber:26,className:"hxd.fmt.bfnt.FontParser",methodName:"parse"}),g.tilePath=(new Sa(b)).file+".png",f=c(Sa.withExtension(b,"png"))}break;case 4:for(m=k/20|0;0<m;){d=a.readInt32();var p=f.sub(a.readUInt16(),a.readUInt16(),a.readUInt16(),a.readUInt16(),a.readInt16(),a.readInt16());p=new Kd(p,a.readInt16());h.h[d]=p;a.set_position(a.pos+2);--m}break;case 5:for(e=k/10|0;0<e;)d=a.readInt32(),m=a.readInt32(),p=h.h[m],
null!=p?p.addKerning(d,a.readInt16()):a.set_position(a.pos+2),--e}a.set_position(l+k)}break;case 1414415938:return(new zg(new Zb(a))).read(function(a){try{g.tilePath=a,f=c(Sa.join([Sa.directory(b),a]))}catch(hk){Ka.trace('Warning: Could not find referenced font texture at "'+a+'", trying to resolve same name as fnt!',{fileName:"hxd/fmt/bfnt/FontParser.hx",lineNumber:26,className:"hxd.fmt.bfnt.FontParser",methodName:"parse"}),g.tilePath=(new Sa(b)).file+".png",f=c(Sa.withExtension(b,"png"))}return f});
case 1836597052:case 1852794428:l=R.parse(a.toString());var t=l.firstElement();if(t.nodeType!=R.Document&&t.nodeType!=R.Element)throw u.thrown("Invalid nodeType "+(null==t.nodeType?"null":db.toString(t.nodeType)));l=t;if(Zj.resolve(l,"info")){a=wg.resolve(l,"info");g.name=pb.resolve(a,"face");a=pb.resolve(wg.resolve(l,"info"),"size");g.size=g.initSize=w.parseInt(a);a=pb.resolve(wg.resolve(l,"common"),"lineHeight");g.lineHeight=w.parseInt(a);a=pb.resolve(wg.resolve(l,"common"),"base");g.baseLine=w.parseInt(a);
for(a=wg.resolve(l,"pages").elements();a.hasNext();)if(k=a.next(),"0"==pb.resolve(k,"id")){d=pb.resolve(k,"file");try{g.tilePath=d,f=c(Sa.join([Sa.directory(b),d]))}catch(Sj){Ka.trace('Warning: Could not find referenced font texture at "'+d+'", trying to resolve same name as fnt!',{fileName:"hxd/fmt/bfnt/FontParser.hx",lineNumber:26,className:"hxd.fmt.bfnt.FontParser",methodName:"parse"}),g.tilePath=(new Sa(b)).file+".png",f=c(Sa.withExtension(b,"png"))}}else Ka.trace("Warning: BMF format only supports one page at the moment.",
{fileName:"hxd/fmt/bfnt/FontParser.hx",lineNumber:62,className:"hxd.fmt.bfnt.FontParser",methodName:"parse"});for(a=wg.resolve(l,"chars").elements();a.hasNext();){d=a.next();p=f.sub(w.parseInt(pb.resolve(d,"x")),w.parseInt(pb.resolve(d,"y")),w.parseInt(pb.resolve(d,"width")),w.parseInt(pb.resolve(d,"height")),w.parseInt(pb.resolve(d,"xoffset")),w.parseInt(pb.resolve(d,"yoffset")));p=new Kd(p,w.parseInt(pb.resolve(d,"xadvance")));for(m=wg.resolve(l,"kernings").elements();m.hasNext();)e=m.next(),pb.resolve(e,
"second")==pb.resolve(d,"id")&&p.addKerning(w.parseInt(pb.resolve(e,"first")),w.parseInt(pb.resolve(e,"amount")));m=w.parseInt(pb.resolve(d,"id"));h.h[m]=p}}else{g.tilePath=(new Sa(b)).file+".png";f=c(Sa.withExtension(b,"png"));g.name=pb.resolve(l,"family");a=pb.resolve(l,"size");g.size=g.initSize=w.parseInt(a);a=pb.resolve(l,"height");g.lineHeight=w.parseInt(a);k=[];for(a=l.elements();a.hasNext();){d=a.next();m=pb.resolve(d,"rect").split(" ");p=pb.resolve(d,"offset").split(" ");p=f.sub(w.parseInt(m[0]),
w.parseInt(m[1]),w.parseInt(m[2]),w.parseInt(m[3]),w.parseInt(p[0]),w.parseInt(p[1]));p=new Kd(p,w.parseInt(pb.resolve(d,"width")));m=pb.resolve(d,"code");l=aa.startsWith(m,"&#")?w.parseInt(D.substr(m,2,m.length-3)):D.cca(m,0);for(m=d.elements();m.hasNext();)e=m.next(),d=pb.resolve(e,"id"),d=aa.startsWith(d,"&#")?w.parseInt(D.substr(d,2,d.length-3)):D.cca(d,0),e=w.parseInt(pb.resolve(e,"advance")),h.h.hasOwnProperty(d)?h.h[d].addKerning(l,e):k.push({prev:l,next:d,adv:e});h.h[l]=p}for(a=0;a<k.length;)m=
k[a],++a,p=h.h[m.next],null!=p&&p.addKerning(m.prev,m.adv)}break;case 1868983913:k=a.toString().split("\n");m=new nf(' *?([0-9a-zA-Z]+)=("[^"]+"|.+?)(?:[ \r]|$)',"");for(a=d=0;a<k.length;)switch(p=k[a],++a,l=p.indexOf(" "),D.substr(p,0,l)){case "char":var n=t=d=0,r=0,q=0,v=0,x=0;for(e=0;l<p.length&&m.matchSub(p,l);){switch(m.matched(1)){case "height":l=m.matched(2);q=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "id":l=m.matched(2);d=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-
1):l);break;case "width":l=m.matched(2);r=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "x":l=m.matched(2);t=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "xadvance":l=m.matched(2);e=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "xoffset":l=m.matched(2);v=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "y":l=m.matched(2);n=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "yoffset":l=m.matched(2),x=w.parseInt(34==
D.cca(l,0)?l.substring(1,l.length-1):l)}l=m.matchedPos();l=l.pos+l.len}p=f.sub(t,n,r,q,v,x);p=new Kd(p,e);h.h[d]=p;break;case "common":for(;l<p.length&&m.matchSub(p,l);){switch(m.matched(1)){case "base":l=m.matched(2);g.baseLine=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "lineHeight":l=m.matched(2);g.lineHeight=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "pages":l=m.matched(2),d=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l),1!=d&&Ka.trace("Warning: BMF format only supports one page at the moment.",
{fileName:"hxd/fmt/bfnt/FontParser.hx",lineNumber:153,className:"hxd.fmt.bfnt.FontParser",methodName:"parse"})}l=m.matchedPos();l=l.pos+l.len}break;case "info":for(;l<p.length&&m.matchSub(p,l);){switch(m.matched(1)){case "face":l=m.matched(2);g.name=34==D.cca(l,0)?l.substring(1,l.length-1):l;break;case "size":l=m.matched(2),g.size=g.initSize=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l)}l=m.matchedPos();l=l.pos+l.len}break;case "kerning":for(e=t=d=0;l<p.length&&m.matchSub(p,l);){switch(m.matched(1)){case "amount":l=
m.matched(2);e=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "first":l=m.matched(2);d=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l);break;case "second":l=m.matched(2),t=w.parseInt(34==D.cca(l,0)?l.substring(1,l.length-1):l)}l=m.matchedPos();l=l.pos+l.len}p=h.h[t];null!=p&&p.addKerning(d,e);break;case "page":for(;l<p.length&&m.matchSub(p,l);){if("file"==m.matched(1)){l=m.matched(2);d=34==D.cca(l,0)?l.substring(1,l.length-1):l;try{g.tilePath=d,f=c(Sa.join([Sa.directory(b),
d]))}catch(Sj){Ka.trace('Warning: Could not find referenced font texture at "'+d+'", trying to resolve same name as fnt!',{fileName:"hxd/fmt/bfnt/FontParser.hx",lineNumber:26,className:"hxd.fmt.bfnt.FontParser",methodName:"parse"}),g.tilePath=(new Sa(b)).file+".png",f=c(Sa.withExtension(b,"png"))}}l=m.matchedPos();l=l.pos+l.len}}break;default:throw u.thrown("Unknown font signature "+aa.hex(k,8));}null==h.h[32]&&(a=new Kd(f.sub(0,0,0,0),g.size>>1),h.h[32]=a);g.tile=f;0==g.baseLine&&(g.baseLine=g.calcBaseLine());
a=h.h[65533];null==a&&(a=h.h[9633]);null==a&&(a=h.h[63]);null!=a&&(g.defaultChar=a);return g};var zg=function(a){this.i=a};z["hxd.fmt.bfnt.Reader"]=zg;zg.__name__="hxd.fmt.bfnt.Reader";zg.parse=function(a,b){return(new zg(new Zb(a))).read(b)};zg.prototype={read:function(a){if("BFNT"!=this.i.readString(4)||0!=this.i.readByte())throw u.thrown("Not a BFNT file!");var b=this.i.readByte();if(1==b){b=new Xf(this.i.readString(this.i.readUInt16()),this.i.readInt16());b.tilePath=this.i.readString(this.i.readUInt16());
a=b.tile=a(b.tilePath);b.lineHeight=this.i.readInt16();b.baseLine=this.i.readInt16();for(var c=this.i.readInt32(),d;;){d=this.i.readInt32();if(0==d)break;var e=a.sub(this.i.readUInt16(),this.i.readUInt16(),this.i.readUInt16(),this.i.readUInt16(),this.i.readInt16(),this.i.readInt16());e=new Kd(e,this.i.readInt16());b.glyphs.h[d]=e;d==c&&(b.defaultChar=e);for(;;){d=this.i.readInt32();if(0==d)break;e.addKerning(d,this.i.readInt16())}}}else throw u.thrown("Unknown BFNT version: "+b);return b},__class__:zg};
var Ej=function(){};z["hxd.fmt.hdr.Reader"]=Ej;Ej.__name__="hxd.fmt.hdr.Reader";Ej.decode=function(a,b){for(var c,d=new Zb(a),e,f,g=Object.create(null);;){f=d.readLine();if(""==f)break;35!=D.cca(f,0)&&(f=f.split("="),1<f.length&&(g[f.shift()]=f.join("=")))}e=d.readLine().split(" ");f=w.parseInt(e[1]);e=w.parseInt(e[3]);var h="1"==g.GAMMA,k=new S(new ArrayBuffer(e*f*16)),l=1,m=g.EXPOSURE;null!=m&&(m=parseFloat(m),1E-12>m||1E12>m)&&(l=m);var p=b?1:.45454545454545453,t=[];for(b=0;256>b;)c=b++,t.push(Math.pow(c,
p));m=t;t=[];for(b=0;256>b;)c=b++,t.push(Math.pow(Math.pow(2,c-128)/(256*l),p));l=t;t=g.FORMAT;if(null==t)throw u.thrown("Unsupported HDR format "+t);if("32-bit_rle_rgbe"==t)for(d=d.pos,g=new S(new ArrayBuffer(4*e)),t=e>>8|(e&255)<<8,b=0;b<f;){c=b++;p=a.getInt32(d);if(514!=(p&65535)||p>>>16!=t)g.blit(0,a,d,4*e),d+=4*e;else{d+=4;p=0;for(var n=4*e;p<n;){var r=a.b[d++];128<r?(r-=128,g.fill(p,r,a.b[d++])):(g.blit(p,a,d,r),d+=r);p+=r}}p=c*e*16;n=0;for(r=e;n<r;){var q=n++;c=l[g.b[q+3*e]];k.setFloat(p,m[g.b[q]]*
c);p+=4;k.setFloat(p,m[g.b[q+e]]*c);p+=4;k.setFloat(p,m[g.b[q+(e<<1)]]*c);p+=4;k.setFloat(p,1);p+=4}}else throw u.thrown("Unsupported HDR format "+t);return{width:e,height:f,bytes:k,gamma:h}};var jc=L["hxd.fmt.hmd.Property"]={__ename__:!0,__constructs__:null,CameraFOVY:(A=function(a){return{_hx_index:0,v:a,__enum__:"hxd.fmt.hmd.Property",toString:v}},A._hx_name="CameraFOVY",A.__params__=["v"],A),Unused_HasMaterialFlags:{_hx_name:"Unused_HasMaterialFlags",_hx_index:1,__enum__:"hxd.fmt.hmd.Property",
toString:v},HasExtraTextures:{_hx_name:"HasExtraTextures",_hx_index:2,__enum__:"hxd.fmt.hmd.Property",toString:v},FourBonesByVertex:{_hx_name:"FourBonesByVertex",_hx_index:3,__enum__:"hxd.fmt.hmd.Property",toString:v},HasLod:{_hx_name:"HasLod",_hx_index:4,__enum__:"hxd.fmt.hmd.Property",toString:v},HasCollider:{_hx_name:"HasCollider",_hx_index:5,__enum__:"hxd.fmt.hmd.Property",toString:v}};jc.__constructs__=[jc.CameraFOVY,jc.Unused_HasMaterialFlags,jc.HasExtraTextures,jc.FourBonesByVertex,jc.HasLod,
jc.HasCollider];jc.__empty_constructs__=[jc.Unused_HasMaterialFlags,jc.HasExtraTextures,jc.FourBonesByVertex,jc.HasLod,jc.HasCollider];var Ag=function(){};z["hxd.fmt.hmd.Position"]=Ag;Ag.__name__="hxd.fmt.hmd.Position";Ag.prototype={loadQuaternion:function(a){a.x=this.qx;a.y=this.qy;a.z=this.qz;a.w=this.get_qw()},get_qw:function(){var a=1-(this.qx*this.qx+this.qy*this.qy+this.qz*this.qz);return 0>a?-Math.sqrt(-a):Math.sqrt(a)},toMatrix:function(a){null==a&&(a=!1);var b=new ma,c=Ag.QTMP;c.x=this.qx;
c.y=this.qy;c.z=this.qz;c.w=this.get_qw();c.toMatrix(b);a?(b.translate(this.x,this.y,this.z),b.scale(this.sx,this.sy,this.sz)):(b._11*=this.sx,b._12*=this.sx,b._13*=this.sx,b._21*=this.sy,b._22*=this.sy,b._23*=this.sy,b._31*=this.sz,b._32*=this.sz,b._33*=this.sz,b.translate(this.x,this.y,this.z));return b},__class__:Ag};var Ni=function(){};z["hxd.fmt.hmd.Geometry"]=Ni;Ni.__name__="hxd.fmt.hmd.Geometry";Ni.prototype={get_indexCount:function(){for(var a=0,b=0,c=this.indexCounts;b<c.length;){var d=c[b];
++b;a+=d}return a},__class__:Ni};var Oi=function(){};z["hxd.fmt.hmd.BlendShape"]=Oi;Oi.__name__="hxd.fmt.hmd.BlendShape";Oi.prototype={__class__:Oi};var Pi=function(){};z["hxd.fmt.hmd.Collider"]=Pi;Pi.__name__="hxd.fmt.hmd.Collider";Pi.prototype={__class__:Pi};var Qi=function(){};z["hxd.fmt.hmd.Material"]=Qi;Qi.__name__="hxd.fmt.hmd.Material";Qi.prototype={__class__:Qi};var Ri=function(){};z["hxd.fmt.hmd.SkinJoint"]=Ri;Ri.__name__="hxd.fmt.hmd.SkinJoint";Ri.prototype={__class__:Ri};var Si=function(){};
z["hxd.fmt.hmd.SkinSplit"]=Si;Si.__name__="hxd.fmt.hmd.SkinSplit";Si.prototype={__class__:Si};var Ti=function(){};z["hxd.fmt.hmd.Skin"]=Ti;Ti.__name__="hxd.fmt.hmd.Skin";Ti.prototype={__class__:Ti};var Ui=function(){};z["hxd.fmt.hmd.Model"]=Ui;Ui.__name__="hxd.fmt.hmd.Model";Ui.prototype={getObjectName:function(){return null==this.name?this.name:this.name.replace(/_*-*LOD0/,"")},isLOD:function(){return 0>this.name.indexOf("LOD0")},isLOD0:function(a){return null!=this.name&&-1!=this.name.indexOf(a)?
-1!=this.name.indexOf("LOD0"):!1},toLODName:function(a){return this.name+"LOD"+a},getLODInfos:function(){if(null==this.name||3>=this.name.length)return{lodLevel:-1,modelName:null};if("LOD"==D.substr(this.name,0,3)){var a=w.parseInt(D.substr(this.name,3,1));if(null!=a){if(null!=w.parseInt(D.substr(this.name,4,1)))throw u.thrown("Did not expect a second number after LOD in "+this.name);return{lodLevel:a,modelName:D.substr(this.name,3,null)}}}var b=this.name.length-3-1;return"LOD"==D.substr(this.name,
b,3)&&(a=w.parseInt(this.name.charAt(this.name.length-1)),null!=a)?{lodLevel:a,modelName:D.substr(this.name,0,b)}:{lodLevel:-1,modelName:null}},__class__:Ui};var Qa=L["hxd.fmt.hmd.AnimationFlag"]={__ename__:!0,__constructs__:null,HasPosition:{_hx_name:"HasPosition",_hx_index:0,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},HasRotation:{_hx_name:"HasRotation",_hx_index:1,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},HasScale:{_hx_name:"HasScale",_hx_index:2,__enum__:"hxd.fmt.hmd.AnimationFlag",
toString:v},HasUV:{_hx_name:"HasUV",_hx_index:3,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},HasAlpha:{_hx_name:"HasAlpha",_hx_index:4,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},SingleFrame:{_hx_name:"SingleFrame",_hx_index:5,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},HasProps:{_hx_name:"HasProps",_hx_index:6,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v},Reserved:{_hx_name:"Reserved",_hx_index:7,__enum__:"hxd.fmt.hmd.AnimationFlag",toString:v}};Qa.__constructs__=[Qa.HasPosition,
Qa.HasRotation,Qa.HasScale,Qa.HasUV,Qa.HasAlpha,Qa.SingleFrame,Qa.HasProps,Qa.Reserved];Qa.__empty_constructs__=[Qa.HasPosition,Qa.HasRotation,Qa.HasScale,Qa.HasUV,Qa.HasAlpha,Qa.SingleFrame,Qa.HasProps,Qa.Reserved];var Vi=function(){};z["hxd.fmt.hmd.AnimationObject"]=Vi;Vi.__name__="hxd.fmt.hmd.AnimationObject";Vi.prototype={getStride:function(){var a=0;0!=(this.flags&1<<Qa.HasPosition._hx_index)&&(a+=3);0!=(this.flags&1<<Qa.HasRotation._hx_index)&&(a+=3);0!=(this.flags&1<<Qa.HasScale._hx_index)&&
(a+=3);0!=(this.flags&1<<Qa.HasUV._hx_index)&&(a+=2);0!=(this.flags&1<<Qa.HasAlpha._hx_index)&&++a;0!=(this.flags&1<<Qa.HasProps._hx_index)&&(a+=this.props.length);return a},__class__:Vi};var Wi=function(){};z["hxd.fmt.hmd.AnimationEvent"]=Wi;Wi.__name__="hxd.fmt.hmd.AnimationEvent";Wi.prototype={__class__:Wi};var Xi=function(){};z["hxd.fmt.hmd.Animation"]=Xi;Xi.__name__="hxd.fmt.hmd.Animation";Xi.prototype={__class__:Xi};var Ch=function(){};z["hxd.fmt.hmd.Data"]=Ch;Ch.__name__="hxd.fmt.hmd.Data";
Ch.prototype={__class__:Ch};var Dh=function(a,b,c,d){this.size=a;this.offset=b;this.precision=d;this.def=c};z["hxd.fmt.hmd._Library.FormatMap"]=Dh;Dh.__name__="hxd.fmt.hmd._Library.FormatMap";Dh.prototype={__class__:Dh};var mh=function(){};z["hxd.fmt.hmd.GeometryBuffer"]=mh;mh.__name__="hxd.fmt.hmd.GeometryBuffer";mh.prototype={__class__:mh};var Yi=function(a,b){this.resource=a;this.header=b;this.cachedPrimitives=[];this.cachedAnimations=new La;this.cachedSkin=new La};z["hxd.fmt.hmd.Library"]=Yi;
Yi.__name__="hxd.fmt.hmd.Library";Yi.prototype={getData:function(){var a=this.resource.entry,b=new S(new ArrayBuffer(a.get_size()-this.header.dataPosition));a.readFull(b,this.header.dataPosition,b.length);return b},getDefaultFormat:function(a){var b=[new Ma("position",3)],c=[null];3<a&&(b.push(new Ma("normal",3)),c.push(null));6<a&&(b.push(new Ma("uv",2)),c.push(null));if(8<a){b.push(new Ma("color",3));var d=1,e=1,f=1;null==f&&(f=0);null==e&&(e=0);null==d&&(d=0);c.push(new I(d,e,f))}if(11<a)throw u.thrown("Unsupported stride");
return{format:N.make(b),defs:c}},load:function(a,b,c){null==c&&(c=-1);c=0>c?this.header.models:[this.header.models[c]];for(var d=Xd._new(0),e=[],f=a.stride,g=-1,h=0;h<c.length;){var k=c[h];++h;var l=this.header.geometries[k.geometry];if(null!=l){for(var m=0,p=k.materials;m<p.length;){var t=p[m];++m;0>g&&(g=t);if(g!=t)throw u.thrown("Models have several materials");}k=k.position.toMatrix();m=this.getBuffers(l,a,b);l=d.pos/f|0;p=0;for(t=m.vertexes.length/f|0;p<t;){var n=p++*f;var r=m.vertexes[n++];
var q=m.vertexes[n++];var v=m.vertexes[n++];var w=r*k._12+q*k._22+v*k._32+k._42,x=r*k._13+q*k._23+v*k._33+k._43;r=r*k._11+q*k._21+v*k._31+k._41;q=w;v=x;d.pos==d.array.length&&(w=d.array.length<<1,128>w&&(w=128),w=new Float32Array(w),w.set(d.array),d.array=w);d.array[d.pos++]=r;d.pos==d.array.length&&(r=d.array.length<<1,128>r&&(r=128),r=new Float32Array(r),r.set(d.array),d.array=r);d.array[d.pos++]=q;d.pos==d.array.length&&(q=d.array.length<<1,128>q&&(q=128),q=new Float32Array(q),q.set(d.array),d.array=
q);d.array[d.pos++]=v;v=0;for(q=f-3;v<q;)v++,r=m.vertexes[n++],d.pos==d.array.length&&(w=d.array.length<<1,128>w&&(w=128),w=new Float32Array(w),w.set(d.array),d.array=w),d.array[d.pos++]=r}k=0;for(m=m.indexes;k<m.length;)p=m[k],++k,e.push(p+l)}}return{vertex:d,index:e}},getBuffers:function(a,b,c,d){var e,f;0==d&&1==a.indexCounts.length&&(d=null);var g=[];var h=f=0;for(var k=!1,l=0,m=b.inputs;l<m.length;){b=m[l++];var p=a.vertexFormat.getInput(b.name);if(null==p){p=null==c?null:c[f];if(null==p)throw u.thrown("Missing required "+
b.name);var t=b.type;var n=new Dh(t==Z.__cast(9,cc)?1:t,0,p,0)}else{if(p.type!=b.type)throw u.thrown("Requested "+b.name+" "+(null==b.type?"null":Jc.toString(b.type))+" but found "+(null==p.type?"null":Jc.toString(p.type)));n=b.type;n=new Dh(n==Z.__cast(9,cc)?1:n,a.vertexFormat.calculateInputOffset(p.name),null,p.precision);0!=p.precision&&(k=!0)}g.push(n);b=b.type;h+=b==Z.__cast(9,cc)?1:b;++f}c=a.vertexFormat.strideBytes;b=a.vertexCount*c;l=new S(new ArrayBuffer(b));var r=this.resource.entry;r.readFull(l,
this.header.dataPosition+a.vertexPosition,b);f=this.header.dataPosition+a.indexPosition;var q=(m=65536>=a.vertexCount)?2:4;if(null==d)b=a.get_indexCount()*q;else{n=t=0;for(p=d;n<p;)b=n++,t+=a.indexCounts[b];f+=t*q;b=a.indexCounts[d]*q}q=new S(new ArrayBuffer(b));r.readFull(q,f,b);r=new mh;if(null==d){r.vertexes=Array(h*a.vertexCount);r.indexes=Array(a.get_indexCount());var v=0;n=0;for(p=a.vertexCount;n<p;)for(d=n++,a=0;a<g.length;){var w=g[a];++a;if(null==w.def){var x=0;for(e=w.size;x<e;){b=x++;t=
r.vertexes;f=v++;if(k)switch(w.precision){case 0:var z=l.getFloat(d*c+(b<<2)+w.offset);break;case 1:z=N.float16to32(l.getUInt16(d*c+(b<<1)+w.offset));break;case 2:z=(l.b[d*c+b+w.offset]&255)/255;break;case 3:z=N.floatS8to32(l.b[d*c+b+w.offset])}else z=l.getFloat(d*c+(b<<2)+w.offset);t[f]=z}}else switch(w.size){case 1:r.vertexes[v++]=w.def.x;break;case 2:r.vertexes[v++]=w.def.x;r.vertexes[v++]=w.def.y;break;case 3:r.vertexes[v++]=w.def.x;r.vertexes[v++]=w.def.y;r.vertexes[v++]=w.def.z;break;default:r.vertexes[v++]=
w.def.x,r.vertexes[v++]=w.def.y,r.vertexes[v++]=w.def.z,r.vertexes[v++]=w.def.w}}if(m)for(n=h=0,p=r.indexes.length;n<p;)b=n++,r.indexes[b]=q.b[h++]|q.b[h++]<<8;else for(n=0,p=r.indexes.length;n<p;)b=n++,r.indexes[b]=q.getInt32(b<<2)}else{b=a.indexCounts[d];z=Array(a.vertexCount);f=Xd._new(0);r.indexes=Array(b);n=t=h=0;for(p=r.indexes.length;n<p;){b=n++;d=m?q.b[h++]|q.b[h++]<<8:q.getInt32(b<<2);var A=z[d];if(0==A)for(++t,A=t,z[d]=A,a=0;a<g.length;)if(w=g[a],++a,null==w.def)for(x=0,e=w.size;x<e;){var B=
x++;if(k)switch(w.precision){case 0:v=l.getFloat(d*c+(B<<2)+w.offset);break;case 1:v=N.float16to32(l.getUInt16(d*c+(B<<1)+w.offset));break;case 2:v=(l.b[d*c+B+w.offset]&255)/255;break;case 3:v=N.floatS8to32(l.b[d*c+B+w.offset])}else v=l.getFloat(d*c+(B<<2)+w.offset);f.pos==f.array.length&&(B=f.array.length<<1,128>B&&(B=128),B=new Float32Array(B),B.set(f.array),f.array=B);f.array[f.pos++]=v}else switch(w.size){case 1:w=w.def.x;f.pos==f.array.length&&(e=f.array.length<<1,128>e&&(e=128),e=new Float32Array(e),
e.set(f.array),f.array=e);f.array[f.pos++]=w;break;case 2:e=w.def.x;f.pos==f.array.length&&(x=f.array.length<<1,128>x&&(x=128),x=new Float32Array(x),x.set(f.array),f.array=x);f.array[f.pos++]=e;w=w.def.y;f.pos==f.array.length&&(e=f.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(f.array),f.array=e);f.array[f.pos++]=w;break;case 3:e=w.def.x;f.pos==f.array.length&&(x=f.array.length<<1,128>x&&(x=128),x=new Float32Array(x),x.set(f.array),f.array=x);f.array[f.pos++]=e;e=w.def.y;f.pos==f.array.length&&
(x=f.array.length<<1,128>x&&(x=128),x=new Float32Array(x),x.set(f.array),f.array=x);f.array[f.pos++]=e;w=w.def.z;f.pos==f.array.length&&(e=f.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(f.array),f.array=e);f.array[f.pos++]=w;break;default:e=w.def.x,f.pos==f.array.length&&(x=f.array.length<<1,128>x&&(x=128),x=new Float32Array(x),x.set(f.array),f.array=x),f.array[f.pos++]=e,e=w.def.y,f.pos==f.array.length&&(x=f.array.length<<1,128>x&&(x=128),x=new Float32Array(x),x.set(f.array),f.array=
x),f.array[f.pos++]=e,e=w.def.z,f.pos==f.array.length&&(x=f.array.length<<1,128>x&&(x=128),x=new Float32Array(x),x.set(f.array),f.array=x),f.array[f.pos++]=e,w=w.def.w,f.pos==f.array.length&&(e=f.array.length<<1,128>e&&(e=128),e=new Float32Array(e),e.set(f.array),f.array=e),f.array[f.pos++]=w}r.indexes[b]=A-1}t=f;n=[];p=0;for(a=t.pos;p<a;)b=p++,n.push(t.array[b]);r.vertexes=n}return r},makePrimitive:function(a){var b=a.geometry;var c=this.cachedPrimitives[b];if(null!=c)return c;c=null;if(null!=a.lods){if(a.isLOD())return null;
var d=[];c=0;for(var e=a.lods;c<e.length;){var f=e[c];++c;d.push(this.header.models[f])}c=d;this.patchLodsMaterials(a,c)}else{e=a.getLODInfos();if(0<e.lodLevel){d=0;for(c=this.header.models;d<c.length;)if(a=c[d],++d,a.isLOD0(e.modelName))return null;throw u.thrown("No LOD0 found for "+e.modelName+" in "+this.resource.entry.name);}0==e.lodLevel&&(c=this.findLODs(e.modelName,a),this.patchLodsMaterials(a,c))}c=new pe(this.header.geometries[b],this.header.dataPosition,this,c);c.incref();return this.cachedPrimitives[b]=
c},dispose:function(){for(var a=0,b=this.cachedPrimitives;a<b.length;){var c=b[a];++a;null!=c&&c.decref()}this.cachedPrimitives=[]},makeMaterial:function(a,b,c){a=this.header.materials[b];b=Od.current.createMaterial();b.name=a.name;b.model=this.resource;b.set_blendMode(a.blendMode);var d=Od.current.loadMaterialProps(b);null==d&&(d=b.getDefaultModelProps());null!=a.diffuseTexture&&(b.set_texture(c(a.diffuseTexture)),null==b.get_texture()&&b.set_texture(Y.fromColor(16711935)));null!=a.specularTexture&&
b.set_specularTexture(c(a.specularTexture));null!=a.normalMap&&b.set_normalMap(c(a.normalMap));b.set_props(d);return b},makeSkin:function(a,b){var c=this.cachedSkin.h[a.name];if(null!=c)return c;c=new qi(a.name,0,null!=b.props&&0<=b.props.indexOf(jc.FourBonesByVertex)?4:3);c.namedJoints=new La;c.allJoints=[];c.boundJoints=[];c.rootJoints=[];var d=0;for(b=a.joints;d<b.length;){var e=b[d];++d;var f=new uf;f.name=e.name;f.index=c.allJoints.length;f.defMat=e.position.toMatrix();0<=e.bind&&(f.bindIndex=
e.bind,f.transPos=e.transpos.toMatrix(!0),c.boundJoints[f.bindIndex]=f);0<=e.parent?(e=c.allJoints[e.parent],e.subs.push(f),f.parent=e):c.rootJoints.push(f);c.allJoints.push(f);c.namedJoints.h[f.name]=f}if(null!=a.split)for(c.splitJoints=[],d=0,b=a.split;d<b.length;){f=b[d];++d;e=c.splitJoints;for(var g=f.materialIndex,h=[],k=0,l=f.joints;k<l.length;)f=l[k],++k,h.push(c.allJoints[f]);e.push({material:g,joints:h})}return this.cachedSkin.h[a.name]=c},getModelProperty:function(a,b,c){for(var d=0,e=this.header.models;d<
e.length;){var f=e[d];++d;if(f.name==a){if(null!=f.props)for(a=0,f=f.props;a<f.length;)if(d=f[a],++a,d._hx_index==b._hx_index)return la.enumParameters(d)[0];return c}}if(null==c)throw u.thrown("Model "+a+" not found");return c},findLODs:function(a,b){if(null==a)return null;b=[];for(var c=0,d=this.header.models;c<d.length;){var e=d[c];++c;var f=e.getLODInfos();if(!(1>f.lodLevel)&&f.modelName==a){if(null!=b[f.lodLevel-1])throw u.thrown("Multiple LODs with the same level : "+e.name);b[f.lodLevel-1]=
e}}return b},patchLodsMaterials:function(a,b){for(var c=0;c<b.length;){var d=b[c];++c;for(var e=0,f=d.materials;e<f.length;){var g=f[e];++e;if(-1==a.materials.indexOf(g))throw u.thrown("Model "+d.name+" has a material that isn't used by "+a.name+". This is not supported.");}e=this.header.geometries[d.geometry];f=[];for(var h=g=0,k=a.materials.length;h<k;){var l=h++;a.materials[l]==d.materials[g]?(f[l]=e.indexCounts[g],++g):f[l]=0}e.indexCounts=f}},makeObject:function(a){null==a&&(a=function(a){return Y.fromColor(16711935)});
if(0==this.header.models.length)throw u.thrown("This file does not contain any model");for(var b=[],c=0,d=this.header.models;c<d.length;){var e=d[c];++c;if(0>e.geometry)var f=new Aa;else{f=this.makePrimitive(e);if(null==f)continue;if(null!=e.skin){var g=this.makeSkin(e.skin,this.header.geometries[e.geometry]);g.primitive=f;f=[];for(var h=0,k=e.materials;h<k.length;){var l=k[h];++h;f.push(this.makeMaterial(e,l,a))}f=new fc(g,f)}else if(1==e.materials.length)f=new Ua(f,this.makeMaterial(e,e.materials[0],
a));else{g=[];h=0;for(k=e.materials;h<k.length;)l=k[h],++h,g.push(this.makeMaterial(e,l,a));f=new Lc(f,g)}}f.name=e.getObjectName();g=e.position.toMatrix();f.defaultTransform=g;f.flags|=1;0!=(f.flags&131072)&&(f.flags|=262144);b.push(f);e=b[e.parent];null!=e&&e.addChild(f);e=this.resource.entry.get_directory();g=f instanceof Ua?f:null;g=null!=g?g.primitive:null;Pa.current.loadModelProps({resourceDirectory:e,resourceName:this.resource.entry.name,objectName:f.name,hmd:g instanceof pe?g:null,skin:f instanceof
fc?f:null})}a=b[0];null!=a&&(a.flags|=256);return a},loadAnimation:function(a){var b=this.cachedAnimations.h[null==a?"":a];if(null!=b)return b;b=null;if(null==a){if(0==this.header.animations.length)return null;b=this.header.animations[0]}else{for(var c=0,d=this.header.animations;c<d.length;){var e=d[c];++c;if(e.name==a){b=e;break}}if(null==b)throw u.thrown("Animation "+a+" not found !");}c=2>=this.header.version?this.makeLinearAnimation(b):this.makeAnimation(b);c.speed=b.speed;c.loop=b.loop;null!=
b.events&&c.setEvents(b.events);c.resourcePath=this.resource.entry.get_path();this.cachedAnimations.h[b.name]=c;null==a&&(this.cachedAnimations.h[""]=c);return c},makeAnimation:function(a){var b,c=new tf(a.name,a.frames,a.sampling),d=0,e=[],f=[],g=0;for(b=a.objects;g<b.length;){var h=b[g];++g;var k=c.addObject(h.name,0),l=1;0!=(h.flags&1<<Qa.SingleFrame._hx_index)?(k.layout|=1<<Ea.SingleFrame._hx_index,e.push(k),l=0):f.push(k);0!=(h.flags&1<<Qa.HasPosition._hx_index)&&(k.layout|=1<<Ea.Position._hx_index,
d+=3*l);0!=(h.flags&1<<Qa.HasRotation._hx_index)&&(k.layout|=1<<Ea.Rotation._hx_index,d+=3*l);0!=(h.flags&1<<Qa.HasScale._hx_index)&&(k.layout|=1<<Ea.Scale._hx_index,d+=3*l);0!=(h.flags&1<<Qa.HasUV._hx_index)&&(k.layout|=1<<Ea.UV._hx_index,d+=2*l);0!=(h.flags&1<<Qa.HasAlpha._hx_index)&&(k.layout|=1<<Ea.Alpha._hx_index,d+=l);if(0!=(h.flags&1<<Qa.HasProps._hx_index))for(var m=0,p=h.props.length;m<p;){var t=m++,n=k;0<t&&(n=c.addObject(h.name,0),0==l?e.push(n):f.push(n));n.layout|=1<<Ea.Property._hx_index;
n.propName=h.props[t];d+=l}}for(g=h=0;g<e.length;)b=e[g],++g,b.dataOffset=h,h+=b.getStride();e=h;for(g=0;g<f.length;)b=f[g],++g,b.dataOffset=h,h+=b.getStride();f=this.resource.entry;g=new S(new ArrayBuffer(4*(d*a.frames+e)));f.readFull(g,this.header.dataPosition+a.dataPosition,g.length);c.setData(new Float32Array(g.b.buffer),d);return c},makeLinearAnimation:function(a){for(var b=new ig(a.name,a.frames,a.sampling),c=this.resource.entry,d=this.header.dataPosition+a.dataPosition,e=0,f=a.objects;e<f.length;){var g=
f[e];++e;var h=0!=(g.flags&1<<Qa.HasPosition._hx_index),k=0!=(g.flags&1<<Qa.HasRotation._hx_index),l=0!=(g.flags&1<<Qa.HasScale._hx_index);if(h||k||l){var m=a.frames;0!=(g.flags&1<<Qa.SingleFrame._hx_index)&&(m=1);var p=Array(m),t=4*((h?3:0)+(k?3:0)+(l?3:0))*m,n=c.fetchBytes(d,t);d+=t;for(var r=t=0;r<m;){var q=r++,u=new ni;h?(u.tx=n.getFloat(t),t+=4,u.ty=n.getFloat(t),t+=4,u.tz=n.getFloat(t),t+=4):(u.tx=0,u.ty=0,u.tz=0);if(k){u.qx=n.getFloat(t);t+=4;u.qy=n.getFloat(t);t+=4;u.qz=n.getFloat(t);t+=4;
var v=1-(u.qx*u.qx+u.qy*u.qy+u.qz*u.qz);u.qw=0>v?-Math.sqrt(-v):Math.sqrt(v)}else u.qx=0,u.qy=0,u.qz=0,u.qw=1;l?(u.sx=n.getFloat(t),t+=4,u.sy=n.getFloat(t),t+=4,u.sz=n.getFloat(t),t+=4):(u.sx=1,u.sy=1,u.sz=1);p[q]=u}b.addCurve(g.name,p,!0,k,l)}if(0!=(g.flags&1<<Qa.HasUV._hx_index)){h=Array(2*a.frames);l=8*a.frames;k=c.fetchBytes(d,l);d+=l;l=0;for(p=h.length;l<p;)n=l++,h[n]=k.getFloat(4*n);b.addUVCurve(g.name,h)}if(0!=(g.flags&1<<Qa.HasAlpha._hx_index)){h=Array(a.frames);l=4*a.frames;k=c.fetchBytes(d,
l);d+=l;l=0;for(p=h.length;l<p;)n=l++,h[n]=k.getFloat(4*n);b.addAlphaCurve(g.name,h)}if(0!=(g.flags&1<<Qa.HasProps._hx_index))for(h=0,k=g.props;h<k.length;){l=k[h];++h;p=Array(a.frames);t=4*a.frames;n=c.fetchBytes(d,t);d+=t;t=0;for(r=p.length;t<r;)m=t++,p[m]=n.getFloat(4*m);b.addPropCurve(g.name,l,p)}}return b},loadSkin:function(a,b,c){var d,e;null==c&&(c=!0);if(null==b.vertexWeights){var f=b.bonesPerVertex;if(3!=f&&4!=f)throw u.thrown("assert");var g=4==f;b.vertexCount=a.vertexCount;var h=N.make([new Ma("position",
3),new Ma("weights",3),new Ma("indexes",9)]);var k=this.getBuffers(a,h),l=h.stride;b.vertexWeights=Array(b.vertexCount*f);b.vertexJoints=Array(b.vertexCount*f);var m=0;for(e=b.boundJoints;m<e.length;)h=e[m],++m,h.offsets=new fb;var p=k.vertexes,t=1E20,n=-1E20,r=1E20,q=-1E20,v=1E20,w=-1E20;if(null==b.splitJoints){a=[];m=0;for(e=b.boundJoints;m<e.length;)h=e[m],++m,a[h.bindIndex]=h;var x=[{index:0,pos:0,count:k.indexes.length,joints:a}]}else{var z=0;var A=[];m=h=0;for(e=a.indexCounts;m<e.length;){var B=
e[m];++m;A.push(h);h+=B}m=[];e=0;for(d=b.splitJoints;e<d.length;)h=d[e],++e,m.push({index:z,pos:A[z],count:a.indexCounts[z++],joints:h.joints});x=m}for(m=0;m<x.length;)for(a=x[m],++m,e=a.pos,d=a.pos+a.count;e<d;){z=e++;z=k.indexes[z];h=z*l;var C=p[h];if(!isNaN(C)){p[h++]=NaN;B=p[h++];A=p[h++];var D=p[h++];var E=p[h++],F=p[h++],H=0;z*=f;b.vertexWeights[z]=D;b.vertexWeights[z+1]=E;b.vertexWeights[z+2]=F;g&&(H=1-D-E-F,b.vertexWeights[z+3]=H);E=(0==D?1:0)|(0==E?2:0)|(0==F?4:0)|(0==H?8:0);F=ob.floatToI32(p[h++]);
C<t&&(t=C);C>n&&(n=C);B<r&&(r=B);B>q&&(q=B);A<v&&(v=A);A>w&&(w=A);H=0;for(var J=f;H<J;)h=H++,0!=(E&1<<h)?b.vertexJoints[z++]=-1:(h=a.joints[F>>(h<<3)&255],D=h.offsets,C<D.xMin&&(D.xMin=C),C>D.xMax&&(D.xMax=C),B<D.yMin&&(D.yMin=B),B>D.yMax&&(D.yMax=B),A<D.zMin&&(D.zMin=A),A>D.zMax&&(D.zMax=A),b.vertexJoints[z++]=h.bindIndex)}}if(c)for(z=b.allJoints.length-1,e=0,m=(n-t)*(q-r)*(w-v);0<=z;)h=b.allJoints[z--],null!=h.offsets&&null!=h.parent&&null!=h.parent.offsets&&(f=h.parent.offsets,D=h.offsets,a=D.xMax-
D.xMin,c=D.yMax-D.yMin,g=D.zMax-D.zMin,C=.5*(D.xMin+D.xMax),B=.5*(D.yMin+D.yMax),A=.5*(D.zMin+D.zMax),a=.5*Math.sqrt(a*a+c*c+g*g),null==a&&(a=1),null==A&&(A=0),null==B&&(B=0),null==C&&(C=0),c=C,C=A,g=a,null==g&&(g=0),null==C&&(C=0),null==B&&(B=0),null==c&&(c=0),a=c,A=B,f.xMin<=a-g&&f.yMin<=A-g&&f.zMin<=C-g&&f.xMax>=a+g&&f.yMax>=A+g&&f.zMax>=C+g?(h.offsets=null,++e):(c=new fb,c.xMin=f.xMin,c.xMax=f.xMax,c.yMin=f.yMin,c.yMax=f.yMax,c.zMin=f.zMin,c.zMax=f.zMax,B=A,A=g,a-A<c.xMin&&(c.xMin=a-A),a+A>c.xMax&&
(c.xMax=a+A),B-A<c.yMin&&(c.yMin=B-A),B+A>c.yMax&&(c.yMax=B+A),C-A<c.zMin&&(c.zMin=C-A),C+A>c.zMax&&(c.zMax=C+A),(c.xMax-c.xMin)*(c.yMax-c.yMin)*(c.zMax-c.zMin)/((f.xMax-f.xMin)*(f.yMax-f.yMin)*(f.zMax-f.zMin))<Math.sqrt(1.5*m/((c.xMax-c.xMin)*(c.yMax-c.yMin)*(c.zMax-c.zMin)))&&(h.parent.offsets=c,h.offsets=null,++e)));m=0;for(e=b.allJoints;m<e.length;)h=e[m],++m,null==h.offsets?h.offsetRay=-1:(c=h.offsets,C=.5*(c.xMin+c.xMax),B=.5*(c.yMin+c.yMax),A=.5*(c.zMin+c.zMax),null==A&&(A=0),null==B&&(B=0),
null==C&&(C=0),a=C,C=A,null==C&&(C=0),null==B&&(B=0),null==a&&(a=0),A=a,z=B,b=C,c.xMax-c.xMin>c.yMax-c.yMin&&c.xMax-c.xMin>c.zMax-c.zMin?(a=c.yMax-c.yMin,A=c.zMax-c.zMin,a=.5*(a<A?A:a),A=c.xMin+a,B=z,C=b,null==C&&(C=0),null==B&&(B=0),null==A&&(A=0),B=new I(A,B,C),A=c.xMax-a,null==b&&(b=0),null==z&&(z=0),null==A&&(A=0),b=new I(A,z,b)):c.yMax-c.yMin>c.zMax-c.zMin?(a=c.xMax-c.xMin,z=c.zMax-c.zMin,a=.5*(a<z?z:a),z=A,B=c.yMin+a,C=b,null==C&&(C=0),null==B&&(B=0),null==z&&(z=0),B=new I(z,B,C),z=A,A=c.yMax-
a,null==b&&(b=0),null==A&&(A=0),null==z&&(z=0),b=new I(z,A,b)):(a=c.xMax-c.xMin,b=c.yMax-c.yMin,a=.5*(a<b?b:a),b=A,B=z,C=c.zMin+a,null==C&&(C=0),null==B&&(B=0),null==b&&(b=0),B=new I(b,B,C),b=A,A=c.zMax-a,null==A&&(A=0),null==z&&(z=0),null==b&&(b=0),b=new I(b,z,A)),c.xMin=B.x,c.yMin=B.y,c.zMin=B.z,c.xMax=b.x,c.yMax=b.y,c.zMax=b.z,h.offsetRay=a)}},__class__:Yi};var Qd=function(a){this.i=a};z["hxd.fmt.hmd.Reader"]=Qd;Qd.__name__="hxd.fmt.hmd.Reader";Qd.prototype={readProperty:function(){var a=this.i.readByte();
switch(a){case 0:return jc.CameraFOVY(this.i.readFloat());case 1:throw u.thrown("Obsolete HasMaterialFlags");case 2:return jc.HasExtraTextures;case 3:return jc.FourBonesByVertex;case 4:return jc.HasLod;case 5:return jc.HasCollider;default:throw u.thrown("Unknown property #"+a);}},readProps:function(){if(1==this.version)return null;var a=this.i.readByte();if(0==a)return null;for(var b=[],c=0;c<a;)c++,b.push(this.readProperty());return b},readName:function(){var a=this.i.readByte();return 255==a?null:
this.i.readString(a)},readCachedName:function(){var a=this.readName();if(null==a)return null;null==Qd.HMD_STRINGS&&(Qd.HMD_STRINGS=new La);var b=Qd.HMD_STRINGS.h[a];return null!=b?b:Qd.HMD_STRINGS.h[a]=a},readPosition:function(a){null==a&&(a=!0);var b=new Ag;b.x=this.i.readFloat();b.y=this.i.readFloat();b.z=this.i.readFloat();b.qx=this.i.readFloat();b.qy=this.i.readFloat();b.qz=this.i.readFloat();a?(b.sx=this.i.readFloat(),b.sy=this.i.readFloat(),b.sz=this.i.readFloat()):(b.sx=1,b.sy=1,b.sz=1);return b},
readBounds:function(){var a=new fb;a.xMin=this.i.readFloat();a.yMin=this.i.readFloat();a.zMin=this.i.readFloat();a.xMax=this.i.readFloat();a.yMax=this.i.readFloat();a.zMax=this.i.readFloat();return a},readSkin:function(){var a;var b=this.readCachedName();if(null==b)return null;var c=new Ti;c.props=this.readProps();c.name=b;c.joints=[];b=0;for(a=this.i.readUInt16();b<a;){b++;var d=new Ri;d.props=this.readProps();d.name=this.readCachedName();var e=this.i.readUInt16(),f=0!=(e&32768);f&&(e&=32767);d.parent=
e-1;d.position=this.readPosition(f);d.bind=this.i.readUInt16()-1;0<=d.bind&&(d.transpos=this.readPosition(f));c.joints.push(d)}a=this.i.readByte();if(0<a)for(c.split=[],b=0;b<a;){b++;d=new Si;d.materialIndex=this.i.readByte();e=[];f=0;for(var g=this.i.readByte();f<g;)f++,e.push(this.i.readUInt16());d.joints=e;c.split.push(d)}return c},readLods:function(){for(var a=[],b=0,c=this.i.readInt32();b<c;)b++,a.push(this.i.readInt32());return a},readHeader:function(a){var b;null==a&&(a=!1);var c=new Ch;var d=
this.i.readString(3);if("HMD"!=d){if(59==D.cca(d,0))throw u.thrown("FBX was not converted to HMD");throw u.thrown("Invalid HMD header "+encodeURIComponent(d));}this.version=this.i.readByte();if(4<this.version)throw u.thrown("Can't read HMD v"+this.version);c.version=this.version;c.geometries=[];c.dataPosition=this.i.readInt32();a&&(this.i=new Zb(this.i.read(c.dataPosition-12)));c.props=this.readProps();a=0;for(d=this.i.readInt32();a<d;){a++;var e=new Ni;e.props=this.readProps();e.vertexCount=this.i.readInt32();
var f=this.i.readByte();var g=[];var h=0;for(b=this.i.readByte();h<b;){h++;var k=this.readCachedName();var l=this.i.readByte();g.push(new Ma(k,l&15,l>>4))}g=N.make(g);if(f!=g.stride)throw u.thrown("assert");e.vertexFormat=g;e.vertexPosition=this.i.readInt32();g=this.i.readByte();255==g&&(g=this.i.readInt32());l=[];for(f=0;f<g;)f++,l.push(this.i.readInt32());e.indexCounts=l;e.indexPosition=this.i.readInt32();e.bounds=this.readBounds();c.geometries.push(e)}c.materials=[];a=0;for(d=this.i.readInt32();a<
d;)a++,b=new Qi,b.props=this.readProps(),b.name=this.readName(),b.diffuseTexture=this.readName(),b.blendMode=Qd.BLEND[this.i.readByte()],this.i.readByte(),this.i.readFloat(),null!=b.props&&0<=b.props.indexOf(jc.HasExtraTextures)&&(b.specularTexture=this.readName(),b.normalMap=this.readName()),c.materials.push(b);c.models=[];e=!1;a=0;for(d=this.i.readInt32();a<d;)if(a++,b=new Ui,b.props=this.readProps(),b.name=this.readCachedName(),b.parent=this.i.readInt32()-1,b.follow=this.readCachedName(),b.position=
this.readPosition(),b.geometry=this.i.readInt32()-1,c.models.push(b),!(0>b.geometry)){b.materials=[];h=this.i.readByte();255==h&&(h=this.i.readInt32());for(g=0;g<h;)g++,b.materials.push(this.i.readInt32());b.skin=this.readSkin();null!=b.props&&(b.lods=-1!=b.props.indexOf(jc.HasLod)?this.readLods():null,-1!=b.props.indexOf(jc.HasCollider)&&(b.collider=this.i.readInt32(),e=!0))}c.animations=[];a=0;for(d=this.i.readInt32();a<d;){a++;k=new Xi;k.props=this.readProps();k.name=this.readName();k.frames=this.i.readInt32();
k.sampling=this.i.readFloat();k.speed=this.i.readFloat();var m=this.i.readByte();k.loop=0!=(m&1);k.dataPosition=this.i.readInt32();k.objects=[];g=0;for(h=this.i.readInt32();g<h;){g++;var p=new Vi;p.name=this.readCachedName();b=this.i.readByte();null==b&&(b=0);p.flags=b;k.objects.push(p);if(0!=(p.flags&1<<Qa.HasProps._hx_index)){b=[];l=0;for(f=this.i.readByte();l<f;)l++,b.push(this.readName());p.props=b}}if(0!=(m&2))for(k.events=[],g=0,h=this.i.readInt32();g<h;)g++,b=new Wi,b.frame=this.i.readInt32(),
b.data=this.readCachedName(),k.events.push(b);c.animations.push(k)}if(4<=c.version)for(d=this.i.readInt32(),c.shapes=[],a=0;a<d;){a++;m=new Oi;m.name=this.readName();m.geom=this.i.readInt32()-1;m.vertexCount=this.i.readInt32();f=this.i.readByte();g=[];h=0;for(b=this.i.readByte();h<b;)h++,k=this.readCachedName(),l=this.i.readByte(),g.push(new Ma(k,l&15,l>>4));g=N.make(g);if(f!=g.stride)throw u.thrown("assert");m.vertexFormat=g;m.vertexPosition=this.i.readInt32();m.indexCount=this.i.readInt32();m.remapPosition=
this.i.readInt32();c.shapes.push(m)}if(e)for(c.colliders=[],d=this.i.readInt32(),a=0;a<d;){a++;e=new Pi;k=this.i.readInt32();g=[];h=0;for(b=k;h<b;)h++,g.push(this.i.readInt32());e.vertexCounts=g;e.vertexPosition=this.i.readInt32();l=[];f=0;for(g=k;f<g;)f++,l.push(this.i.readInt32());e.indexCounts=l;e.indexPosition=this.i.readInt32();c.colliders.push(e)}return c},read:function(){var a=this.readHeader();a.data=this.i.read(this.i.readInt32());return a},__class__:Qd};var Lf=function(){};z["hxd.fs.FileEntry"]=
Lf;Lf.__name__="hxd.fs.FileEntry";Lf.prototype={getBytes:function(){return null},readBytes:function(a,b,c,d){throw u.thrown("readBytes() not implemented");},fetchBytes:function(a,b){var c=Lf.TMP_BYTES;if(null==c||c.length<b)c=new S(new ArrayBuffer(b+65535&-65536)),Lf.TMP_BYTES=c;this.readFull(c,a,b);return c},readFull:function(a,b,c){if(this.readBytes(a,0,b,c)<c)throw u.thrown(new Fc);},getSign:function(){var a=this.fetchBytes(0,4);return a.b[0]|a.b[1]<<8|a.b[2]<<16|a.b[3]<<24},getText:function(){return this.getBytes().toString()},
open:function(){return new se(this)},load:function(a){if(this.get_isAvailable())null!=a&&a();else throw u.thrown("load() not implemented");},loadBitmap:function(a){throw u.thrown("loadBitmap() not implemented");},watch:function(a){},exists:function(a){return!1},get:function(a){return null},iterator:function(){return null},get_isAvailable:function(){return!0},get_isDirectory:function(){return!1},get_size:function(){return 0},get_path:function(){throw u.thrown("path() not implemented");},get_directory:function(){var a=
this.get_path().lastIndexOf("/");return 0>a?"":D.substr(this.get_path(),0,a)},get_extension:function(){var a=this.name.lastIndexOf(".");return 0>a?"":D.substr(this.name,a+1,null).toLowerCase()},__class__:Lf};var Eh=function(a,b){this.fullPath=a;this.name=a.split("/").pop();this.bytes=b};z["hxd.fs.BytesFileEntry"]=Eh;Eh.__name__="hxd.fs.BytesFileEntry";Eh.__super__=Lf;Eh.prototype=J(Lf.prototype,{get_path:function(){return this.fullPath},getBytes:function(){return this.bytes},readBytes:function(a,
b,c,d){c+d>this.bytes.length&&(d=this.bytes.length-c);0>d&&(d=0);a.blit(b,this.bytes,c,d);return d},load:function(a){Ad.delay(a,1)},loadBitmap:function(a){switch(Sa.extension(this.fullPath).toLowerCase()){case "gif":var b="image/gif";break;case "jpeg":case "jpg":b="image/jpeg";break;case "png":b="image/png";break;default:throw u.thrown("Cannot determine image encoding, try adding an extension to the resource path");}var c=new Image;c.onload=function(){a(c)};var d=Cc.encode(this.bytes);c.src="data:"+
b+";base64,"+d},exists:function(a){return!1},get:function(a){return null},iterator:function(){return new Zi([])},get_size:function(){return this.bytes.length},__class__:Eh});var Bg=function(){};z["hxd.fs.FileSystem"]=Bg;Bg.__name__="hxd.fs.FileSystem";Bg.__isInterface__=!0;Bg.prototype={__class__:Bg};var Cg=function(){};z["hxd.fs.BytesFileSystem"]=Cg;Cg.__name__="hxd.fs.BytesFileSystem";Cg.__interfaces__=[Bg];Cg.prototype={getRoot:function(){throw u.thrown("Not implemented");},getBytes:function(a){throw u.thrown("Not implemented");
},exists:function(a){return null!=this.getBytes(a)},get:function(a){var b=this.getBytes(a);if(null==b)throw u.thrown("Resource not found '"+a+"'");return new Eh(a,b)},dispose:function(){},dir:function(a){throw u.thrown("Not implemented");},__class__:Cg};var se=function(a){this.cachePos=this.cacheLen=this.nextReadPos=0;this.entry=a};z["hxd.fs.FileInput"]=se;se.__name__="hxd.fs.FileInput";se.__super__=Jf;se.prototype=J(Jf.prototype,{fetch:function(a){null==a&&(a=256);var b=this.cache;if(null==this.cache||
this.cache.length<a)this.cache=se.PREFETCH_CACHE,null!=this.cache&&this.cache.length>=a?se.PREFETCH_CACHE=null:this.cache=new S(new ArrayBuffer(a));var c=0;0<this.cacheLen&&(c=this.cacheLen,a-=this.cacheLen,this.cache.blit(0,b,this.cachePos,this.cacheLen));a=this.entry.readBytes(this.cache,c,this.nextReadPos,a);this.cachePos=0;this.cacheLen=c+a;this.nextReadPos+=a;if(0==this.cacheLen)throw u.thrown(new Fc);},skip:function(a){if(0<this.cacheLen){var b=this.cacheLen;b=b>a?a:b;this.cachePos+=b;this.cacheLen-=
b;a-=b}this.nextReadPos+=a},readByte:function(){0==this.cacheLen&&this.fetch();var a=this.cache.b[this.cachePos++];this.cacheLen--;return a},readBytes:function(a,b,c){var d=0;256>c&&this.cacheLen<c&&this.fetch();if(0<this.cacheLen){var e=this.cacheLen;e=c>e?e:c;a.blit(b,this.cache,this.cachePos,e);this.cachePos+=e;this.cacheLen-=e;c-=e;if(0==c)return e;b+=e;d+=e}0<c&&(e=this.entry.readBytes(a,b,this.nextReadPos,c),this.nextReadPos+=e,d+=e);return d},close:function(){null!=this.cache&&(null==se.PREFETCH_CACHE||
se.PREFETCH_CACHE.length<this.cache.length)&&(se.PREFETCH_CACHE=this.cache);this.cache=null;this.cacheLen=0},__class__:se});var bk={_new:function(a){return a},toBitmap:function(a){var b=new be(a.width,a.height);b.ctx.drawImage(a,0,0);return b},toNative:function(a){return a}},$i=function(a){throw u.thrown("Local file system is not supported for this platform");};z["hxd.fs.LocalFileSystem"]=$i;$i.__name__="hxd.fs.LocalFileSystem";$i.__interfaces__=[Bg];$i.prototype={exists:function(a){return!1},get:function(a){return null},
getRoot:function(){return null},dispose:function(){},dir:function(a){return null},__class__:$i};var kg=function(a){this.path=a};z["hxd.fs.NotFound"]=kg;kg.__name__="hxd.fs.NotFound";kg.prototype={toString:function(){return"Resource file not found '"+this.path+"'"},__class__:kg};var We=function(){};z["hxd.fs.SourceLoader"]=We;We.__name__="hxd.fs.SourceLoader";We.isActive=function(){return 0<We.RELOAD_LFS.length};We.resolve=function(a){for(var b=0,c=We.RELOAD_LFS;b<c.length;){var d=c[b];++b;try{return d.get(a)}catch(e){if(!(u.caught(e).unwrap()instanceof
kg))throw e;}}return null};var rd=function(){this.stack=[];var a=Yj.callStack();a.shift();for(var b=0;b<a.length;){var c=a[b];++b;switch(c._hx_index){case 2:var d=c.file;c=c.line;var e=d.indexOf("\\std/");0<e&&(d=D.substr(d,e+5,null));c=d+":"+c;this.stack.push(c);null==this.position&&(e=d.indexOf("/"),d=0>e?"":D.substr(d,0,e),0>rd.ENGINE_PACKAGES.indexOf(d)&&(this.position=c))}}null==this.position&&(this.position=this.stack[0])};z["hxd.impl.AllocPos"]=rd;rd.__name__="hxd.impl.AllocPos";rd.make=function(){return rd.ENABLED?
new rd:null};rd.prototype={__class__:rd};var Ob=function(){};z["hxd.impl.Allocator"]=Ob;Ob.__name__="hxd.impl.Allocator";Ob.set=function(a){Ob.inst=a};Ob.get=function(){null==Ob.inst&&(Ob.inst=new Ob);return Ob.inst};Ob.prototype={toBufferFlags:function(a){switch(a){case 0:return[$a.Dynamic];case 1:return null;case 2:return[$a.UniformBuffer,$a.Dynamic];case 3:return[$a.UniformBuffer,$a.ReadWriteBuffer];case 4:return[$a.UniformBuffer]}},fromBufferFlags:function(a){if(0==a)return 1;if(a==Tj.from($a.Dynamic))return 0;
var b=1<<$a.UniformBuffer._hx_index|1<<$a.Dynamic._hx_index;null==b&&(b=0);if(a==b)return 2;b=1<<$a.UniformBuffer._hx_index|1<<$a.ReadWriteBuffer._hx_index;null==b&&(b=0);return a==b?3:a==Tj.from($a.UniformBuffer)?4:0},allocBuffer:function(a,b,c){null==c&&(c=0);return new $b(a,b,this.toBufferFlags(c))},ofFloats:function(a,b,c){null==c&&(c=0);return this.ofSubFloats(a,Math.ceil(a.pos/b.stride),b,c)},ofSubFloats:function(a,b,c,d){null==d&&(d=0);c=this.allocBuffer(b,c,d);c.uploadFloats(a,0,b);return c},
disposeBuffer:function(a){a.dispose()},allocIndexBuffer:function(a,b){null==b&&(b=!1);return $d._new(a,b)},ofIndexes:function(a,b){null==b&&(b=-1);0>b&&null!=a&&(b=a.length);var c=this.allocIndexBuffer(b);$d.uploadIndexes(c,a,0,b);return c},disposeIndexBuffer:function(a){a.dispose()},onContextLost:function(){},allocFloats:function(a){null==a&&(a=0);return Xd._new(a)},disposeFloats:function(a){},allocIndexes:function(a){null==a&&(a=0);return Array(a)},disposeIndexes:function(a){},__class__:Ob};var Fj=
function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator"]=Fj;Fj.__name__="hxd.impl.ArrayIterator";Fj.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Fj};var Rg=function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_h2d_Object"]=Rg;Rg.__name__="hxd.impl.ArrayIterator_h2d_Object";Rg.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Rg};var hi=function(a){this.i=
0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_h2d_col_IPoint"]=hi;hi.__name__="hxd.impl.ArrayIterator_h2d_col_IPoint";hi.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:hi};var Gj=function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_h2d_col_IPolygon"]=Gj;Gj.__name__="hxd.impl.ArrayIterator_h2d_col_IPolygon";Gj.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Gj};
var ji=function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_h2d_col_Point"]=ji;ji.__name__="hxd.impl.ArrayIterator_h2d_col_Point";ji.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:ji};var li=function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_h2d_col_Polygon"]=li;li.__name__="hxd.impl.ArrayIterator_h2d_col_Polygon";li.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},
__class__:li};var Hj=function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_h2d_col_Segment"]=Hj;Hj.__name__="hxd.impl.ArrayIterator_h2d_col_Segment";Hj.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Hj};var si=function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_h3d_scene_Object"]=si;si.__name__="hxd.impl.ArrayIterator_h3d_scene_Object";si.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},
__class__:si};var Zi=function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_hxd_fs_FileEntry"]=Zi;Zi.__name__="hxd.impl.ArrayIterator_hxd_fs_FileEntry";Zi.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:Zi};var aj=function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_hxd_res_Any"]=aj;aj.__name__="hxd.impl.ArrayIterator_hxd_res_Any";aj.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},
__class__:aj};var bj=function(a){this.i=0;this.a=a;this.l=this.a.length};z["hxd.impl.ArrayIterator_hxd_snd_Channel"]=bj;bj.__name__="hxd.impl.ArrayIterator_hxd_snd_Channel";bj.prototype={hasNext:function(){return this.i<this.l},next:function(){return this.a[this.i++]},__class__:bj};var cj=function(){};z["hxd.impl.AsyncLoader"]=cj;cj.__name__="hxd.impl.AsyncLoader";cj.__isInterface__=!0;cj.prototype={__class__:cj};var Oj={_new:function(a){return new S(new ArrayBuffer(a+7>>3))},get:function(a,b){return 0!=
(a.b[b>>3]&1<<(b&7))},set:function(a,b){a.b[b>>3]|=1<<(b&7)},unset:function(a,b){a.b[b>>3]&=~(1<<(b&7))},toggle:function(a,b,c){var d=b>>3,e=a.b[d];b=1<<(b&7);a.b[d]=c?e|b:e&~b},clear:function(a,b){null==b&&(b=!1);a.fill(0,a.length,b?255:0)}},ic=L["hxd.impl.MouseMode"]={__ename__:!0,__constructs__:null,Absolute:{_hx_name:"Absolute",_hx_index:0,__enum__:"hxd.impl.MouseMode",toString:v},Relative:(A=function(a,b){return{_hx_index:1,callback:a,restorePos:b,__enum__:"hxd.impl.MouseMode",toString:v}},A._hx_name=
"Relative",A.__params__=["callback","restorePos"],A),AbsoluteUnbound:(A=function(a){return{_hx_index:2,restorePos:a,__enum__:"hxd.impl.MouseMode",toString:v}},A._hx_name="AbsoluteUnbound",A.__params__=["restorePos"],A)};ic.__constructs__=[ic.Absolute,ic.Relative,ic.AbsoluteUnbound];ic.__empty_constructs__=[ic.Absolute];var Ij=function(a,b){if(null==a||null==b)throw u.thrown("Edge::new p1 or p2 is null");var c=!1;if(a.y>b.y)c=!0;else if(a.y==b.y){if(a.x==b.x)throw u.thrown("Edge::repeat points "+w.string(a));
c=a.x>b.x}c?(this.q=a,this.p=b):(this.p=a,this.q=b);this.q.get_edge_list().push(this)};z["hxd.poly2tri.Edge"]=Ij;Ij.__name__="hxd.poly2tri.Edge";Ij.prototype={toString:function(){return"Edge("+w.string(this.p)+", "+w.string(this.q)+")"},__class__:Ij};var kf=function(a,b){this.x=a;this.y=b;this.id=kf.C_ID;kf.C_ID++};z["hxd.poly2tri.Point"]=kf;kf.__name__="hxd.poly2tri.Point";kf.sortPoints=function(a){a.sort(kf.cmpPoints)};kf.cmpPoints=function(a,b){var c=a.y-b.y;0==c&&(c=a.x-b.x);return 0>c?-1:0<c?
1:0};kf.prototype={get_edge_list:function(){null==this.edge_list&&(this.edge_list=[]);return this.edge_list},equals:function(a){return this.x==a.x?this.y==a.y:!1},toString:function(){return"Point("+this.x+", "+this.y+")"},__class__:kf};var Fh=function(a,b){this.path=a;this.bytes=b};z["hxd.res._Any.SingleFileSystem"]=Fh;Fh.__name__="hxd.res._Any.SingleFileSystem";Fh.__super__=Cg;Fh.prototype=J(Cg.prototype,{getBytes:function(a){return a==this.path?this.bytes:null},__class__:Fh});var Mb=function(a){this.entry=
a};z["hxd.res.Resource"]=Mb;Mb.__name__="hxd.res.Resource";Mb.prototype={get_name:function(){return this.entry.name},toString:function(){return this.entry.get_path()},watch:function(a){Mb.LIVE_UPDATE&&this.entry.watch(a)},__class__:Mb};var jd=function(a,b){this.entry=b;this.loader=a};z["hxd.res.Any"]=jd;jd.__name__="hxd.res.Any";jd.fromBytes=function(a,b){b=new Fh(a,b);return(new bd(b)).load(a)};jd.__super__=Mb;jd.prototype=J(Mb.prototype,{toModel:function(){return this.loader.loadCache(this.entry.get_path(),
Gh)},toTexture:function(){return this.toImage().toTexture()},toTile:function(){return this.toImage().toTile()},toText:function(){return this.entry.getText()},toImage:function(){return this.loader.loadCache(this.entry.get_path(),Db)},toSound:function(){return this.loader.loadCache(this.entry.get_path(),lf)},toPrefab:function(){return this.loader.loadCache(this.entry.get_path(),Mb)},toAnimGraph:function(){return this.loader.loadCache(this.entry.get_path(),Mb)},to:function(a){return this.loader.loadCache(this.entry.get_path(),
a)},iterator:function(){for(var a=[],b=this.entry.iterator();b.i<b.l;){var c=b.a[b.i++];a.push(new jd(this.loader,c))}return new aj(a)},__class__:jd});var Hh=function(a){this.entry=a;this.loader=bd.currentInstance};z["hxd.res.BitmapFont"]=Hh;Hh.__name__="hxd.res.BitmapFont";Hh.__super__=Mb;Hh.prototype=J(Mb.prototype,{toFont:function(){null==this.font&&(this.font=Mi.parse(this.entry.getBytes(),this.entry.get_path(),M(this,this.resolveTile)));return this.font},toSdfFont:function(a,b,c,d){null==d&&
(d=-1);null==c&&(c=.5);null==b&&(b=0);null==this.sdfFonts&&(this.sdfFonts=[]);null==a&&(a=this.toFont().size);for(var e=0,f=this.sdfFonts;e<f.length;){var g=f[e];++e;var h=g.type;if(1==h._hx_index){var k=h.channel,l=h.alphaCutoff;h=h.smoothing;if(g.size==a&&k==b&&l==c&&h==d)return g}}g=Mi.parse(this.entry.getBytes(),this.entry.get_path(),M(this,this.resolveSdfTile));g.type=Wf.SignedDistanceField(b,c,d);g.resizeTo(a);this.sdfFonts.push(g);return g},resolveSdfTile:function(a){a=this.loader.load(a).toTexture();
a.set_filter(sd.Linear);return ib.fromTexture(a)},resolveTile:function(a){return this.loader.load(a).toTile()},__class__:Hh});var Ng=function(){};z["hxd.res.DefaultFont"]=Ng;Ng.__name__="hxd.res.DefaultFont";Ng.get=function(){var a=na.CURRENT,b=a.resCache.h[Ng.__id__];if(null==b){b=jd.fromBytes("hxd/res/defaultFont.png",Dc.run("s3176:iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAACPBJREFUeJztnelypDoMRp2p%:6v3PNjhrlCLX1aLIPBPlWppI03bCG0QOfn8:m0zbr8KupnS9FDqRKAzUOhAvBRfqO:tfrSZ86H:ET79o6Rhc%JzzNSD7Xn:XyEH9RPtP4X:6GDDj6ttR:Hb62d9pmX8b487StA4:DFlup5z5MSWS%tL:f6eG4BXDppGQdtApJEtPm0zkf427Oo1fAxtfO2hDIruGXCLgnAD:jNyzSsKxa18yBphyqQ1jqwBN1zHmgcU3V3jHui9xaArkS0%XzTohOX%jvGauzvjMrlUJXuqSeV07G0ekgTovWS1t61vr0CQAez7nkj7uFIELJqmdN7RWvzil7hnnXV5qLOzSMAmlcQub9ZRuEsaNoq0w5RZbN0rye1ASzplWyAiGEXQVK3kZOdRcgy9:FLoRogI02WNc7rRQw3jzsZAfWB7skR44%3jdo6Wv2qfr4rFuUCZlftrT1jjpezSih4b75ClQDMvrizz%82uA1wMCqsKvUv3YO045rxma2vjY3mpPUvuV1WKDzbLtqfNu9:AjA6tl69QM3Zn1Wfl1M8G:CUW4s6b%sWIEXWtM:omNeXrnaDRm:OyIsE1UOfQ1gCwMOLdFCqWnj8Grl5nsjVakRjHMj1DgnEcQvw%OV0AE0wGisfqTKrbBYrZ4BiB:T4ldE8dPsMxU2oEWgZZtoAyMCq2GxtLlWCFbEB%PGIYWv1kxECq0%TbDKITjpirVr9SW2zC:skqqKdUp%QwwbILKwlgZk2mkBlmUVgPPOI3IbL0GwASY2PiMdbPrfVF6:vVctIq5SoVqNdxtrvWXt1:EguYHVL:ZV4Q8F781%KVwD25r8UagTyYE4TjkllmfrU4udtI%XZdrRcm5c1T%3cPXjq9RqEYTewIrau1a%ODVSBomgeL4cLudedG%H2pah4KBQx8gSnWMC:8AvDKwS0fXU5n59Uf7gAXA1dfG1TtM1Bm2ZtKi%PCGaVlpXKrf67ngeI%uFXoW1WdvNH0ztuV3vNBvAOrC30wR0LG7kX0:p3MjoCqPYfiQNI3BK%BEhq31vfYtS5UkN5lCD%NGWMSBxAWyyeyKkAJYc2Z6JrfqpvGYF0IzxqNWoDoPrSeNJ8POMgtJg76rtSEyDNErGzUF5F3ZOq9wI2D%VtbuBsaFfkNGwBGMtUmy3BjUAtxs3x3LOk8mi7zWB6Xw7leCNlb%LRXkrk%wEOpESIlezxlvM%uSWuzQXNx1Ofjqd5Aah:qW5PGDfbjpZzRCGlbwZ5T0TqMHMVoLgCP56Nj0fqo7mhLOeMGoDPx4wE0sW64mRmXLSDaCZvxPjSeNnAGKx:hxcw8%a3Zkc7tTqjyWgbs:4d3w8wW:7AC42l3zF:dH9H9SGedwO9rmEEz4nMpCXuznFoSS5tf9x9e24ByFjqodKAQio6EjfP9C8duzLHoZ0r8oD%LzRyAZY1XN2umux8n0L3OkeygcdnDzMYTSvQvc47G7g4q3xL2EqE8jhbAN6H9YDJ6TaxBeCduJNy3AjkrghySay8QXOU84lZSQ8plj:ioYuIG%axvLUrcoRxHHGHXelgKzkTWSxtLK:7whM8UaGLzs3qJ7P5IxNI0axh%hbAgxhWMGJ01M%KVKIASXQcipVR7MEz524XboQNoKVwPZPNhkpRjD5yRdM53B0c0qKDvE4X9PVw78JYWPc7usEo9cm1TAa0%R:hh44n1UXz1sjaB0dbJATdGoB:R1Dv:c4DGktSez33TNqW96MZtVo:R53sPLQxvGseCWu7y2d7Kji70MgQRUIwM5nNb%1bc8HyK%MAHiMtq2q5ypaOS39rdTz9jMaac4kg87eDpSsp4%bx:iS3UZLOqMQPM44Y3jGuSoCVabERyaCsj:90qs7TG1soWePZbICViWharvnSgrfTwYsz0gjckvUApHcDOdwa9waDvIGjCFZ:2vwzfVeGj7W%qs4ns0ettbMASJvG:WfJ%JAGHOVvI6GSxtMEUfNENK%FH%NtNaz1qzif7B79mcC2AdbG8zVxyNqMtrGkTQqZWmHUqvJjDJg%BZ9Rf552I8qtY%a:jUMnEG3j9V1RvWgUryfqFyXql1etX2aP:vGER8JWCCLdxhME4OlMbWTdLQCRhA%qX1WegVrZEbtjCjQjsDnKM200Y8nLjDaAx%WdVgg8:zfQY%1620Q8grcxpRDcfQvwMN2ivYm7s4GSRkGZLuRvV5T3AP1tAe08q8qtY38KJo4Ejgglbxh3awCJQyL35l:AjAKwN:5CKozAqpRm7zibBBUCMDJFi:p5GlMKcJUbGAm4aIkdlPCpttK9xz1RxMhzAdVCkDmnE5H:GURPXLta7ypHcz248%GLWR6Q%cL7ZdHRVOddWHPt1VRWX6O1mERXuNt6HmBmooGXnlB178MX3vIr5nhCejkUbf7VhgyalyWwngcjqsorxxg5xy%oDeDZ:Du0Qub%2aP6M%XVfSFK90D6ihjranoC2pUgUVVe0VdUw2bmeEKyASx1OwvWfQ7dPqi1XlFe1Vd0nbu1C:%HEeEObuSH:LyRKzSW6QZKvjDXDNKxqvIsR19a:624vKKvW9Zy5nTw5swQO2zGbODmDNdmpWwBmJ%hNo7n7WAJ5L703FN4DD:Sr3RcK6uar0XVnHvHUbHeDqadawaLFA3jbTwW6tH2aC%5oqgfLXYRGcOab5SKOVvz8sY75AneZATyQd:qyt1ByFjkGoCrR6u8gXLtc2tn:51qD22s7Pwi5Z5jEryNtS6jy6U5qfS8HZwFTWp0ogWdj3Wu0nmPWJ8K3HO62gvoul:dhKbBPPWmp:fdwBXwXNGa8TY92ruBzVG%GpoqnUXtp9CeCdza4JvZLhDqyqb3hT8RRDtH5VmyavKKREn0XCW1f3WiDKWmpTpf7GTQc:F6OpCdC3guJdp5C8CzkTY9JAg8Ekh:bxaAPxVMf28WgP7XMMrWAovwhO8I2gxkC8DibAFYnC0Ai6OFgjeL4Pmm0M2L0dzAzSJY2cDNy:E8ELJ5MdsLWJwtAIuzBWBxtgAszhaAxdkCsDi:AYnqZwd25SoPAAAAAElFTkSuQmCC"));
var c=jd.fromBytes("hxd/res/defaultFont.fnt",Dc.run("s14030:PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPEZvbnQgc2l6ZT0iMTIiIGZhbWlseT0iUGl4ZWwgT3BlcmF0b3IiIGhlaWdodD0iMTYiIHN0eWxlPSJSZWd1bGFyIj4KIDxDaGFyIHdpZHRoPSI0IiBvZmZzZXQ9IjAgMTMiIHJlY3Q9IjEgMTIgMCAwIiBjb2RlPSIgIi8%CiA8Q2hhciB3aWR0aD0iMyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjIgMyAxIDkiIGNvZGU9IiEiLz4KIDxDaGFyIHdpZHRoPSI1IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNCAzIDMgMyIgY29kZT0iJnF1b3Q7Ii8%CiA8Q2hhciB3aWR0aD0iOCIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjggMyA2IDkiIGNvZGU9IiMiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgMiIgcmVjdD0iMTUgMSA1IDEzIiBjb2RlPSIkIi8%CiA8Q2hhciB3aWR0aD0iOSIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjIxIDMgNyA5IiBjb2RlPSIlIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjI5IDMgNSA5IiBjb2RlPSImYW1wOyIvPgogPENoYXIgd2lkdGg9IjMiIG9mZnNldD0iMSA0IiByZWN0PSIzNSAzIDEgMyIgY29kZT0iJyIvPgogPENoYXIgd2lkdGg9IjUiIG9mZnNldD0iMSA0IiByZWN0PSIzNyAzIDMgOSIgY29kZT0iKCIvPgogPENoYXIgd2lkdGg9IjUiIG9mZnNldD0iMSA0IiByZWN0PSI0MSAzIDMgOSIgY29kZT0iKSIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSI0NSAzIDUgNSIgY29kZT0iKiIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA2IiByZWN0PSI1MSA1IDUgNSIgY29kZT0iKyIvPgogPENoYXIgd2lkdGg9IjMiIG9mZnNldD0iMCAxMiIgcmVjdD0iNTcgMTEgMiAzIiBjb2RlPSIsIi8%CiA8Q2hhciB3aWR0aD0iNiIgb2Zmc2V0PSIxIDgiIHJlY3Q9IjYwIDcgNCAxIiBjb2RlPSItIi8%CiA8Q2hhciB3aWR0aD0iMyIgb2Zmc2V0PSIxIDEyIiByZWN0PSI2NSAxMSAxIDEiIGNvZGU9Ii4iLz4KIDxDaGFyIHdpZHRoPSI1IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNjcgMyAzIDkiIGNvZGU9Ii8iLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNzEgMyA1IDkiIGNvZGU9IjAiLz4KIDxDaGFyIHdpZHRoPSI1IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNzcgMyAzIDkiIGNvZGU9IjEiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iODEgMyA1IDkiIGNvZGU9IjIiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iODcgMyA1IDkiIGNvZGU9IjMiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iOTMgMyA1IDkiIGNvZGU9IjQiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iOTkgMyA1IDkiIGNvZGU9IjUiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMTA1IDMgNSA5IiBjb2RlPSI2Ii8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjExMSAzIDUgOSIgY29kZT0iNyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIxMTcgMyA1IDkiIGNvZGU9IjgiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMSAxNSA1IDkiIGNvZGU9IjkiLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjEgNiIgcmVjdD0iNyAxNyAxIDciIGNvZGU9IjoiLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjAgNiIgcmVjdD0iOSAxNyAyIDkiIGNvZGU9IjsiLz4KIDxDaGFyIHdpZHRoPSI1IiBvZmZzZXQ9IjEgNiIgcmVjdD0iMTIgMTcgMyA1IiBjb2RlPSImbHQ7Ii8%CiA8Q2hhciB3aWR0aD0iNiIgb2Zmc2V0PSIxIDciIHJlY3Q9IjE2IDE4IDQgMyIgY29kZT0iPSIvPgogPENoYXIgd2lkdGg9IjUiIG9mZnNldD0iMSA2IiByZWN0PSIyMSAxNyAzIDUiIGNvZGU9Ij4iLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMjUgMTUgNSA5IiBjb2RlPSI:Ii8%CiA8Q2hhciB3aWR0aD0iOSIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjMxIDE1IDcgOSIgY29kZT0iQCIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIzOSAxNSA1IDkiIGNvZGU9IkEiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNDUgMTUgNSA5IiBjb2RlPSJCIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjUxIDE1IDUgOSIgY29kZT0iQyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSI1NyAxNSA1IDkiIGNvZGU9IkQiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNjMgMTUgNSA5IiBjb2RlPSJFIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjY5IDE1IDUgOSIgY29kZT0iRiIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSI3NSAxNSA1IDkiIGNvZGU9IkciLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iODEgMTUgNSA5IiBjb2RlPSJIIi8%CiA8Q2hhciB3aWR0aD0iMyIgb2Zmc2V0PSIxIDQiIHJlY3Q9Ijg3IDE1IDEgOSIgY29kZT0iSSIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSI4OSAxNSA1IDkiIGNvZGU9IkoiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iOTUgMTUgNSA5IiBjb2RlPSJLIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjEwMSAxNSA1IDkiIGNvZGU9IkwiLz4KIDxDaGFyIHdpZHRoPSI5IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMTA3IDE1IDcgOSIgY29kZT0iTSIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIxMTUgMTUgNSA5IiBjb2RlPSJOIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjEyMSAxNSA1IDkiIGNvZGU9Ik8iLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMSAyNyA1IDkiIGNvZGU9IlAiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNyAyNyA1IDkiIGNvZGU9IlEiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMTMgMjcgNSA5IiBjb2RlPSJSIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjE5IDI3IDUgOSIgY29kZT0iUyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIyNSAyNyA1IDkiIGNvZGU9IlQiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMzEgMjcgNSA5IiBjb2RlPSJVIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjM3IDI3IDUgOSIgY29kZT0iViIvPgogPENoYXIgd2lkdGg9IjkiIG9mZnNldD0iMSA0IiByZWN0PSI0MyAyNyA3IDkiIGNvZGU9IlciLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNTEgMjcgNSA5IiBjb2RlPSJYIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjU3IDI3IDUgOSIgY29kZT0iWSIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSI2MyAyNyA1IDkiIGNvZGU9IloiLz4KIDxDaGFyIHdpZHRoPSI1IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNjkgMjcgMyA5IiBjb2RlPSJbIi8%CiA8Q2hhciB3aWR0aD0iNSIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjczIDI3IDMgOSIgY29kZT0iXCIvPgogPENoYXIgd2lkdGg9IjUiIG9mZnNldD0iMSA0IiByZWN0PSI3NyAyNyAzIDkiIGNvZGU9Il0iLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iODEgMjcgNSAzIiBjb2RlPSJeIi8%CiA8Q2hhciB3aWR0aD0iNSIgb2Zmc2V0PSIwIDE0IiByZWN0PSI4NyAzNyA1IDEiIGNvZGU9Il8iLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjAgNCIgcmVjdD0iOTMgMjcgMiAyIiBjb2RlPSJgIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDYiIHJlY3Q9Ijk2IDI5IDUgNyIgY29kZT0iYSIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIxMDIgMjcgNSA5IiBjb2RlPSJiIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjEwOCAyOSA1IDciIGNvZGU9ImMiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMTE0IDI3IDUgOSIgY29kZT0iZCIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA2IiByZWN0PSIxMjAgMjkgNSA3IiBjb2RlPSJlIi8%CiA8Q2hhciB3aWR0aD0iNiIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjEgMzkgNSA5IiBjb2RlPSJmIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjcgNDEgNSA5IiBjb2RlPSJnIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjEzIDM5IDUgOSIgY29kZT0iaCIvPgogPENoYXIgd2lkdGg9IjMiIG9mZnNldD0iMSA0IiByZWN0PSIxOSAzOSAxIDkiIGNvZGU9ImkiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMjEgMzkgNSAxMSIgY29kZT0iaiIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIyNyAzOSA1IDkiIGNvZGU9ImsiLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjEgNCIgcmVjdD0iMzMgMzkgMSA5IiBjb2RlPSJsIi8%CiA8Q2hhciB3aWR0aD0iOSIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjM1IDQxIDcgNyIgY29kZT0ibSIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA2IiByZWN0PSI0MyA0MSA1IDciIGNvZGU9Im4iLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNiIgcmVjdD0iNDkgNDEgNSA3IiBjb2RlPSJvIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjU1IDQxIDUgOSIgY29kZT0icCIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA2IiByZWN0PSI2MSA0MSA1IDkiIGNvZGU9InEiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNiIgcmVjdD0iNjcgNDEgNSA3IiBjb2RlPSJyIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjczIDQxIDUgNyIgY29kZT0icyIvPgogPENoYXIgd2lkdGg9IjYiIG9mZnNldD0iMSA1IiByZWN0PSI3OSA0MCA1IDgiIGNvZGU9InQiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNiIgcmVjdD0iODUgNDEgNSA3IiBjb2RlPSJ1Ii8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjkxIDQxIDUgNyIgY29kZT0idiIvPgogPENoYXIgd2lkdGg9IjkiIG9mZnNldD0iMSA2IiByZWN0PSI5NyA0MSA3IDciIGNvZGU9InciLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNiIgcmVjdD0iMTA1IDQxIDUgNyIgY29kZT0ieCIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA2IiByZWN0PSIxMTEgNDEgNSA5IiBjb2RlPSJ5Ii8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjExNyA0MSA1IDciIGNvZGU9InoiLz4KIDxDaGFyIHdpZHRoPSI2IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMSA1NCA0IDkiIGNvZGU9InsiLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjEgNCIgcmVjdD0iNiA1NCAxIDkiIGNvZGU9InwiLz4KIDxDaGFyIHdpZHRoPSI2IiBvZmZzZXQ9IjEgNCIgcmVjdD0iOCA1NCA0IDkiIGNvZGU9In0iLz4KIDxDaGFyIHdpZHRoPSI4IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMTMgNTQgNiAyIiBjb2RlPSJ%Ii8%CiA8Q2hhciB3aWR0aD0iMyIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjIwIDU2IDEgOSIgY29kZT0iwqEiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMjIgNTQgNSAxMSIgY29kZT0iwqIiLz4KIDxDaGFyIHdpZHRoPSI4IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMjggNTQgNiA5IiBjb2RlPSLCoyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIzNSA1NCA1IDkiIGNvZGU9IsKlIi8%CiA8Q2hhciB3aWR0aD0iMyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjQxIDU0IDEgOSIgY29kZT0iwqYiLz4KIDxDaGFyIHdpZHRoPSI1IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNDMgNTQgMyAxIiBjb2RlPSLCqCIvPgogPENoYXIgd2lkdGg9IjkiIG9mZnNldD0iMSA0IiByZWN0PSI0NyA1NCA3IDkiIGNvZGU9IsKpIi8%CiA8Q2hhciB3aWR0aD0iOCIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjU1IDU2IDYgNSIgY29kZT0iwqsiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgOCIgcmVjdD0iNjIgNTggNSAzIiBjb2RlPSLCrCIvPgogPENoYXIgd2lkdGg9IjYiIG9mZnNldD0iMSA0IiByZWN0PSI2OCA1NCA0IDQiIGNvZGU9IsKwIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjczIDU2IDUgNyIgY29kZT0iwrEiLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjEgNCIgcmVjdD0iNzkgNTQgMiAyIiBjb2RlPSLCtCIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA2IiByZWN0PSI4MiA1NiA1IDkiIGNvZGU9IsK1Ii8%CiA8Q2hhciB3aWR0aD0iOCIgb2Zmc2V0PSIxIDQiIHJlY3Q9Ijg4IDU0IDcgOSIgY29kZT0iwrYiLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjEgOCIgcmVjdD0iOTYgNTggMSAxIiBjb2RlPSLCtyIvPgogPENoYXIgd2lkdGg9IjUiIG9mZnNldD0iMCAxMyIgcmVjdD0iOTggNjMgMyAyIiBjb2RlPSLCuCIvPgogPENoYXIgd2lkdGg9IjgiIG9mZnNldD0iMSA2IiByZWN0PSIxMDIgNTYgNiA1IiBjb2RlPSLCuyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA2IiByZWN0PSIxMDkgNTYgNSA5IiBjb2RlPSLCvyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAxIiByZWN0PSIxMTUgNTEgNSAxMiIgY29kZT0iw4AiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgMSIgcmVjdD0iMTIxIDUxIDUgMTIiIGNvZGU9IsOBIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDEiIHJlY3Q9IjEgNjcgNSAxMiIgY29kZT0iw4IiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgMSIgcmVjdD0iNyA2NyA2IDEyIiBjb2RlPSLDgyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAyIiByZWN0PSIxNCA2OCA1IDExIiBjb2RlPSLDhCIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAwIiByZWN0PSIyMCA2NiA1IDEzIiBjb2RlPSLDhSIvPgogPENoYXIgd2lkdGg9IjExIiBvZmZzZXQ9IjEgNCIgcmVjdD0iMjYgNzAgOSA5IiBjb2RlPSLDhiIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIzNiA3MCA1IDExIiBjb2RlPSLDhyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAxIiByZWN0PSI0MiA2NyA1IDEyIiBjb2RlPSLDiCIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAxIiByZWN0PSI0OCA2NyA1IDEyIiBjb2RlPSLDiSIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAxIiByZWN0PSI1NCA2NyA1IDEyIiBjb2RlPSLDiiIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAyIiByZWN0PSI2MCA2OCA1IDExIiBjb2RlPSLDiyIvPgogPENoYXIgd2lkdGg9IjMiIG9mZnNldD0iMCAxIiByZWN0PSI2NiA2NyAyIDEyIiBjb2RlPSLDjCIvPgogPENoYXIgd2lkdGg9IjMiIG9mZnNldD0iMSAxIiByZWN0PSI2OSA2NyAyIDEyIiBjb2RlPSLDjSIvPgogPENoYXIgd2lkdGg9IjMiIG9mZnNldD0iMCAxIiByZWN0PSI3MiA2NyAzIDEyIiBjb2RlPSLDjiIvPgogPENoYXIgd2lkdGg9IjMiIG9mZnNldD0iMCAyIiByZWN0PSI3NiA2OCAzIDExIiBjb2RlPSLDjyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMCA0IiByZWN0PSI4MCA3MCA2IDkiIGNvZGU9IsOQIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDEiIHJlY3Q9Ijg3IDY3IDYgMTIiIGNvZGU9IsORIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDEiIHJlY3Q9Ijk0IDY3IDUgMTIiIGNvZGU9IsOSIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDEiIHJlY3Q9IjEwMCA2NyA1IDEyIiBjb2RlPSLDkyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAxIiByZWN0PSIxMDYgNjcgNSAxMiIgY29kZT0iw5QiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgMSIgcmVjdD0iMTEyIDY3IDYgMTIiIGNvZGU9IsOVIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDIiIHJlY3Q9IjExOSA2OCA1IDExIiBjb2RlPSLDliIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA2IiByZWN0PSIxIDg3IDUgNSIgY29kZT0iw5ciLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjAgNCIgcmVjdD0iNyA4NSA3IDkiIGNvZGU9IsOYIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDEiIHJlY3Q9IjE1IDgyIDUgMTIiIGNvZGU9IsOZIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDEiIHJlY3Q9IjIxIDgyIDUgMTIiIGNvZGU9IsOaIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDEiIHJlY3Q9IjI3IDgyIDUgMTIiIGNvZGU9IsObIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDIiIHJlY3Q9IjMzIDgzIDUgMTEiIGNvZGU9IsOcIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDEiIHJlY3Q9IjM5IDgyIDUgMTIiIGNvZGU9IsOdIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjQ1IDg1IDUgOSIgY29kZT0iw54iLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iNTEgODUgNSA5IiBjb2RlPSLDnyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAzIiByZWN0PSI1NyA4NCA1IDEwIiBjb2RlPSLDoCIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAzIiByZWN0PSI2MyA4NCA1IDEwIiBjb2RlPSLDoSIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAzIiByZWN0PSI2OSA4NCA1IDEwIiBjb2RlPSLDoiIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAzIiByZWN0PSI3NSA4NCA2IDEwIiBjb2RlPSLDoyIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSI4MiA4NSA1IDkiIGNvZGU9IsOkIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDIiIHJlY3Q9Ijg4IDgzIDUgMTEiIGNvZGU9IsOlIi8%CiA8Q2hhciB3aWR0aD0iMTEiIG9mZnNldD0iMSA2IiByZWN0PSI5NCA4NyA5IDciIGNvZGU9IsOmIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDYiIHJlY3Q9IjEwNCA4NyA1IDkiIGNvZGU9IsOnIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDMiIHJlY3Q9IjExMCA4NCA1IDEwIiBjb2RlPSLDqCIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSAzIiByZWN0PSIxMTYgODQgNSAxMCIgY29kZT0iw6kiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgMyIgcmVjdD0iMSA5NyA1IDEwIiBjb2RlPSLDqiIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSI3IDk4IDUgOSIgY29kZT0iw6siLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjAgMyIgcmVjdD0iMTMgOTcgMiAxMCIgY29kZT0iw6wiLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjEgMyIgcmVjdD0iMTYgOTcgMiAxMCIgY29kZT0iw60iLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjAgMyIgcmVjdD0iMTkgOTcgMyAxMCIgY29kZT0iw64iLz4KIDxDaGFyIHdpZHRoPSIzIiBvZmZzZXQ9IjAgNCIgcmVjdD0iMjMgOTggMyA5IiBjb2RlPSLDryIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIyNyA5OCA2IDkiIGNvZGU9IsOwIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDMiIHJlY3Q9IjM0IDk3IDYgMTAiIGNvZGU9IsOxIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDMiIHJlY3Q9IjQxIDk3IDUgMTAiIGNvZGU9IsOyIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDMiIHJlY3Q9IjQ3IDk3IDUgMTAiIGNvZGU9IsOzIi8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDMiIHJlY3Q9IjUzIDk3IDUgMTAiIGNvZGU9IsO0Ii8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDMiIHJlY3Q9IjU5IDk3IDYgMTAiIGNvZGU9IsO1Ii8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjY2IDk4IDUgOSIgY29kZT0iw7YiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNiIgcmVjdD0iNzIgMTAwIDUgNSIgY29kZT0iw7ciLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjAgNiIgcmVjdD0iNzggMTAwIDcgNyIgY29kZT0iw7giLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgMyIgcmVjdD0iODYgOTcgNSAxMCIgY29kZT0iw7kiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgMyIgcmVjdD0iOTIgOTcgNSAxMCIgY29kZT0iw7oiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgMyIgcmVjdD0iOTggOTcgNSAxMCIgY29kZT0iw7siLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgNCIgcmVjdD0iMTA0IDk4IDUgOSIgY29kZT0iw7wiLz4KIDxDaGFyIHdpZHRoPSI3IiBvZmZzZXQ9IjEgMyIgcmVjdD0iMTEwIDk3IDUgMTIiIGNvZGU9IsO9Ii8%CiA8Q2hhciB3aWR0aD0iNyIgb2Zmc2V0PSIxIDQiIHJlY3Q9IjExNiA5OCA1IDExIiBjb2RlPSLDviIvPgogPENoYXIgd2lkdGg9IjciIG9mZnNldD0iMSA0IiByZWN0PSIxIDExMCA1IDExIiBjb2RlPSLDvyIvPgo8L0ZvbnQ%Cg"));
c=new Hh(c.entry);c.loader=b.loader;b=c.toFont();a.resCache.set(Ng,b)}return b};var Vj=function(){};z["hxd.res.Embed"]=Vj;Vj.__name__="hxd.res.Embed";var Mf={get_useLoadBitmap:function(a){return 0==a},toInt:function(a){return a},getName:function(a){switch(a){case 0:return"JPG";case 1:return"PNG";case 2:return"GIF";case 3:return"TGA";case 4:return"DDS";case 5:return"RAW";case 6:return"HDR"}}},Nb=L["hxd.res.ImageInfoFlag"]={__ename__:!0,__constructs__:null,IsCube:{_hx_name:"IsCube",_hx_index:0,__enum__:"hxd.res.ImageInfoFlag",
toString:v},Dxt10Header:{_hx_name:"Dxt10Header",_hx_index:1,__enum__:"hxd.res.ImageInfoFlag",toString:v}};Nb.__constructs__=[Nb.IsCube,Nb.Dxt10Header];Nb.__empty_constructs__=[Nb.IsCube,Nb.Dxt10Header];var dj=function(){this.layerCount=1;this.mipOffset=0;this.mipLevels=1;this.flags=this.width=this.height=0};z["hxd.res.ImageInfo"]=dj;dj.__name__="hxd.res.ImageInfo";dj.prototype={__class__:dj};var Db=function(a){this.entry=a};z["hxd.res.Image"]=Db;Db.__name__="hxd.res.Image";Db.customCheckInfo=function(a){};
Db.setupTextureFlags=function(a){};Db.__super__=Mb;Db.prototype=J(Mb.prototype,{getFormat:function(){return this.getInfo().dataFormat},getPixelFormat:function(){return this.getInfo().pixelFormat},getSize:function(){return this.getInfo()},getInfo:function(){if(null!=this.inf)return this.inf;this.inf=new dj;var a=this.entry.open();a.fetch(256);try{var b=a.readUInt16()}catch(h){if(u.caught(h).unwrap()instanceof Fc)b=0;else throw h;}switch(b){case 16163:for(this.inf.dataFormat=6;""!=a.readLine(););b=
a.readLine().split(" ");this.inf.pixelFormat=F.RGBA32F;this.inf.height=w.parseInt(b[1]);this.inf.width=w.parseInt(b[3]);break;case 17476:this.inf.dataFormat=4;a.skip(10);this.inf.height=a.readInt32();this.inf.width=a.readInt32();a.skip(8);this.inf.mipLevels=a.readInt32();a.skip(48);a.readInt32();b=a.readInt32();var c=a.readInt32();var d=a.readInt32(),e=a.readInt32(),f=a.readInt32(),g=a.readInt32();a.readInt32();65024==(a.readInt32()&65024)&&(this.inf.flags|=1<<Nb.IsCube._hx_index);switch(b&16777215){case 0:if(808540228==
b){a.skip(12);this.inf.flags|=1<<Nb.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=F.RGBA;break;case 71:c=F.S3TC(1);break;case 74:c=F.S3TC(2);break;case 77:c=F.S3TC(3);break;case 95:c=F.S3TC(6);break;case 98:c=F.S3TC(7);break;default:throw u.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else switch(c){case 16:if(65535==d)if(0==e)if(0==f)if(0==g)this.inf.pixelFormat=F.R16U;else throw u.thrown("Unsupported RGB DDS "+
c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));else throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));else throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));else throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));break;case 32:switch(d){case 255:if(65280==e)if(16711680==f)if(-16777216==g)this.inf.pixelFormat=F.RGBA;else throw u.thrown("Unsupported RGB DDS "+
c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));else throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));else throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));break;case 65535:if(-65536==e)if(0==f)if(0==g)this.inf.pixelFormat=F.RG16U;else throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));else throw u.thrown("Unsupported RGB DDS "+c+
"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));else throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));break;case 16711680:if(65280==e)if(255==f)if(-16777216==g)this.inf.pixelFormat=F.BGRA;else throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));else throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));else throw u.thrown("Unsupported RGB DDS "+
c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));break;default:throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));}break;default:throw u.thrown("Unsupported RGB DDS "+c+"bits "+aa.hex(d)+"/"+aa.hex(e)+"/"+aa.hex(f)+"/"+aa.hex(g));}break;case 36:if(808540228==b){a.skip(12);this.inf.flags|=1<<Nb.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=F.RGBA;break;case 71:c=F.S3TC(1);break;case 74:c=F.S3TC(2);break;case 77:c=F.S3TC(3);
break;case 95:c=F.S3TC(6);break;case 98:c=F.S3TC(7);break;default:throw u.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=F.RGBA16U;break;case 111:if(808540228==b){a.skip(12);this.inf.flags|=1<<Nb.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=F.RGBA;break;case 71:c=F.S3TC(1);break;case 74:c=F.S3TC(2);break;case 77:c=F.S3TC(3);break;case 95:c=F.S3TC(6);break;case 98:c=
F.S3TC(7);break;default:throw u.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=F.R16F;break;case 112:if(808540228==b){a.skip(12);this.inf.flags|=1<<Nb.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=F.RGBA;break;case 71:c=F.S3TC(1);break;case 74:c=F.S3TC(2);break;case 77:c=F.S3TC(3);break;case 95:c=F.S3TC(6);break;case 98:c=F.S3TC(7);break;default:throw u.thrown(this.entry.get_path()+
" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=F.RG16F;break;case 113:if(808540228==b){a.skip(12);this.inf.flags|=1<<Nb.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=F.RGBA;break;case 71:c=F.S3TC(1);break;case 74:c=F.S3TC(2);break;case 77:c=F.S3TC(3);break;case 95:c=F.S3TC(6);break;case 98:c=F.S3TC(7);break;default:throw u.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=
c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=F.RGBA16F;break;case 114:if(808540228==b){a.skip(12);this.inf.flags|=1<<Nb.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=F.RGBA;break;case 71:c=F.S3TC(1);break;case 74:c=F.S3TC(2);break;case 77:c=F.S3TC(3);break;case 95:c=F.S3TC(6);break;case 98:c=F.S3TC(7);break;default:throw u.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=
a.readInt32()}else this.inf.pixelFormat=F.R32F;break;case 115:if(808540228==b){a.skip(12);this.inf.flags|=1<<Nb.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=F.RGBA;break;case 71:c=F.S3TC(1);break;case 74:c=F.S3TC(2);break;case 77:c=F.S3TC(3);break;case 95:c=F.S3TC(6);break;case 98:c=F.S3TC(7);break;default:throw u.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=
F.RG32F;break;case 116:if(808540228==b){a.skip(12);this.inf.flags|=1<<Nb.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=F.RGBA;break;case 71:c=F.S3TC(1);break;case 74:c=F.S3TC(2);break;case 77:c=F.S3TC(3);break;case 95:c=F.S3TC(6);break;case 98:c=F.S3TC(7);break;default:throw u.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}else this.inf.pixelFormat=F.RGBA32F;break;case 4805697:switch((b>>>
24)-48){case 1:c=F.S3TC(4);break;case 2:c=F.S3TC(5);break;default:c=null}this.inf.pixelFormat=c;break;case 5527620:switch((b>>>24)-48){case 1:c=F.S3TC(1);break;case 2:case 3:c=F.S3TC(2);break;case 4:case 5:c=F.S3TC(3);break;default:c=null}this.inf.pixelFormat=c;break;default:if(808540228==b){a.skip(12);this.inf.flags|=1<<Nb.Dxt10Header._hx_index;c=a.readInt32();switch(c){case 28:c=F.RGBA;break;case 71:c=F.S3TC(1);break;case 74:c=F.S3TC(2);break;case 77:c=F.S3TC(3);break;case 95:c=F.S3TC(6);break;
case 98:c=F.S3TC(7);break;default:throw u.thrown(this.entry.get_path()+" has unsupported DXGI format "+c);}this.inf.pixelFormat=c;a.readInt32();a.skip(4);this.inf.layerCount=a.readInt32()}}if(null==this.inf.pixelFormat)throw a=String.fromCodePoint(b&255)+String.fromCodePoint(b>>8&255)+String.fromCodePoint(b>>16&255)+String.fromCodePoint(b>>>24),(b&255)==b&&(a=""+b),u.thrown(this.entry.get_path()+" has unsupported 4CC "+a);break;case 18759:this.inf.dataFormat=2;this.inf.pixelFormat=F.BGRA;a.readInt32();
this.inf.width=a.readUInt16();this.inf.height=a.readUInt16();break;case 20617:this.inf.dataFormat=1;a.set_bigEndian(!0);for(a.skip(6);;){b=a.readInt32();if(1229472850==a.readInt32()){this.inf.width=a.readInt32();this.inf.height=a.readInt32();b=a.readByte();c=a.readByte();switch(b){case 8:c=F.BGRA;break;case 16:switch(c){case 0:c=F.R16U;break;case 2:c=F.RGBA16U;break;case 4:c=F.RG16U;break;case 6:c=F.RGBA16U;break;default:throw u.thrown("Unsupported png format "+b+"/"+c+"("+this.entry.get_path()+")");
}break;default:throw u.thrown("Unsupported png format "+b+"/"+c+"("+this.entry.get_path()+")");}this.inf.pixelFormat=c;break}a.skip(b+4)}break;case 55551:this.inf.dataFormat=0;this.inf.pixelFormat=F.BGRA;a.set_bigEndian(!0);a:for(;;)switch(a.readUInt16()){case 65472:case 65473:case 65474:a.readUInt16();a.readByte();this.inf.height=a.readUInt16();this.inf.width=a.readUInt16();break a;default:a.skip(a.readUInt16()-2)}break;default:if("tga"==this.entry.get_extension())this.inf.dataFormat=3,this.inf.pixelFormat=
F.ARGB,a.skip(10),this.inf.width=a.readUInt16(),this.inf.height=a.readUInt16();else if("raw"==this.entry.get_extension()){this.inf.dataFormat=5;this.inf.pixelFormat=F.R32F;b=Math.sqrt(this.entry.get_size()>>2)|0;if(this.entry.get_size()!=b*b*4)if(c=Math.sqrt(this.entry.get_size()>>1)|0,this.entry.get_size()==c*c*2)this.inf.pixelFormat=F.R16F,b=c;else throw u.thrown("RAW format does not match 32 bit per components on "+b+"x"+b);this.inf.width=this.inf.height=b}else throw u.thrown("Unsupported texture format "+
this.entry.get_path());}a.close();if(null==this.inf.pixelFormat)throw u.thrown("Unsupported internal format ("+this.entry.get_path()+")");if(0!=Db.MIPMAP_MAX_SIZE&&1<this.inf.mipLevels)for(;0==((this.inf.width|this.inf.height)&7)&&this.inf.width>>1>=Db.MIPMAP_MAX_SIZE&&this.inf.height>>1>=Db.MIPMAP_MAX_SIZE;)this.inf.width>>=1,this.inf.height>>=1,this.inf.mipLevels--,this.inf.mipOffset++;Db.customCheckInfo(this);return this.inf},getPixels:function(a,b){null==b&&(b=0);switch(this.getInfo().dataFormat){case 0:var c=
this.entry.getBytes();if(this.inf.pixelFormat!=F.BGRA)throw u.thrown("No support to decode "+w.string(this.inf.pixelFormat)+" on this platform ("+this.entry.get_path()+")");try{var d=cb.decode(c)}catch(n){throw a=u.caught(n).unwrap(),u.thrown("Failed to decode JPG "+this.entry.get_path()+" ("+w.string(a)+")");}var e=new ya(d.width,d.height,d.pixels,F.BGRA);break;case 1:c=this.entry.getBytes();b=new Zh(new Zb(c));b.checkCRC=!1;e=ya.alloc(this.inf.width,this.inf.height,this.inf.pixelFormat);var f=b.read();
switch(this.inf.pixelFormat._hx_index){case 1:Hb.extract32(f,e.bytes,!1);break;case 18:case 19:case 20:case 21:var g=e.bytes;this.inf.pixelFormat==F.RGBA16U?(b=Hb.getHeader(f).color,b=1==b._hx_index&&0==b.alpha):b=!1;Hb.extract(f,g,b);break;default:throw u.thrown("No support to decode "+w.string(this.inf.pixelFormat)+" on this platform ("+this.entry.get_path()+")");}break;case 2:c=this.entry.getBytes();b=(new Wh(new Zb(c))).read();e=a==F.RGBA?new ya(this.inf.width,this.inf.height,od.extractFullRGBA(b,
0),F.RGBA):new ya(this.inf.width,this.inf.height,od.extractFullBGRA(b,0),F.BGRA);break;case 3:c=this.entry.getBytes();var h=(new ai(new Zb(c))).read();if(h.header.imageType!=Ab.UncompressedTrueColor||32!=h.header.bitsPerPixel)throw u.thrown("Not supported TGA "+w.string(h.header.imageType)+"/"+h.header.bitsPerPixel);f=h.header.width;var k=h.header.height;if(a==F.RGBA)for(e=ya.alloc(f,k,F.RGBA),c=e.bytes,b=0,g=f*k;b<g;)d=b++,k=h.imageData[d],k=k>>>24|k<<8,c.setInt32(d<<2,k);else for(e=ya.alloc(f,k,
F.ARGB),c=ak.fromPixels(e),b=d=0,g=k;b<g;){var l=b++;for(var m=0,p=f;m<p;){var t=m++;k=h.imageData[d++];c.bytes.setInt32((t+l*c.width<<2)+c.offset,k>>>24|k>>8&65280|k<<8&16711680|k<<24)}}switch(h.header.imageOrigin._hx_index){case 0:e.flipY();break;case 2:break;default:throw u.thrown("Not supported "+w.string(h.header.imageOrigin));}break;case 4:e=128;h=0;0!=(this.inf.flags&1<<Nb.Dxt10Header._hx_index)&&(e+=20);b+=this.inf.mipOffset;if(0<b){f=this.inf.mipLevels+this.inf.mipOffset;ya.calcStride(1,
this.inf.pixelFormat);c=b/f|0;h=b%f;b=m=0;for(g=f;b<g;)if(d=b++,f=this.inf.width<<this.inf.mipOffset>>d,k=this.inf.height<<this.inf.mipOffset>>d,0==f&&(f=1),0==k&&(k=1),l=ya.calcDataSize(f,k,this.inf.pixelFormat),m+=l,d<h)e+=l;else if(0==c)break;e+=m*c}f=this.inf.width>>h-this.inf.mipOffset;k=this.inf.height>>h-this.inf.mipOffset;0==f&&(f=1);0==k&&(k=1);1==this.inf.mipLevels+this.inf.mipOffset&&0==(this.inf.flags&1<<Nb.IsCube._hx_index)?c=this.entry.getBytes():(l=ya.calcDataSize(f,k,this.inf.pixelFormat),
c=new S(new ArrayBuffer(l)),this.entry.readFull(c,e,l),e=0);e=new ya(f,k,c,this.inf.pixelFormat,e);break;case 5:c=this.entry.getBytes();e=new ya(this.inf.width,this.inf.height,c,this.inf.pixelFormat);break;case 6:b=Ej.decode(this.entry.getBytes(),!1),e=new ya(b.width,b.height,b.bytes,this.inf.pixelFormat)}null!=a&&e.convert(a);return e},toBitmap:function(){this.getInfo();var a=new be(this.inf.width,this.inf.height),b=this.getPixels();a.setPixels(b);b.dispose();return a},watchCallb:function(){var a=
this.inf;this.inf=null;try{this.getInfo()}catch(c){this.inf=a;return}var b=this.getInfo();a.width==b.width&&a.height==b.height||this.tex.resize(b.width,b.height);this.tex.realloc=null;this.loadTexture()},asyncLoad:function(a){if(null!=this.tex){var b=this.tex;b=null==b.t&&(b.isDepth()||null==b.realloc)}else b=!0;b||(this.tex.dispose(),this.tex.flags&=-1-(1<<O.Loading._hx_index),this.tex.format=this.inf.pixelFormat,this.tex.width=this.inf.width,this.tex.height=this.inf.height,this.loadTexture(a))},
loadTexture:function(a){var b=this;if(0==this.getInfo().dataFormat)this.tex.flags|=1<<O.Loading._hx_index,this.entry.loadBitmap(function(a){a=bk.toBitmap(a);b.tex.alloc();b.tex.uploadBitmap(a);a.ctx=null;a.pixel=null;b.tex.realloc=function(){b.loadTexture()};b.tex.flags&=-1-(1<<O.Loading._hx_index);if(null!=b.tex.waitLoads){a=b.tex.waitLoads;b.tex.waitLoads=null;for(var c=0;c<a.length;){var d=a[c];++c;d()}}Db.ENABLE_AUTO_WATCH&&b.watch(M(b,b.watchCallb))});else{var c=function(){var c,e;if((b.enableAsyncLoading||
0!=(b.tex.flags&1<<O.AsyncLoading._hx_index))&&null==a&&null!=Db.ASYNC_LOADER&&Db.ASYNC_LOADER.isSupported(b))b.tex.dispose(),b.tex.format=F.RGBA,b.tex.width=1,b.tex.height=1,b.tex.customMipLevels=1,b.tex.flags|=1<<O.Loading._hx_index,b.tex.alloc(),b.tex.uploadPixels(Db.BLACK_1x1),b.tex.width=b.inf.width,b.tex.height=b.inf.height,Db.ASYNC_LOADER.load(b),b.tex.realloc=function(){b.loadTexture()};else{var f=D.now()/1E3;b.tex.customMipLevels=b.inf.mipLevels;b.tex.alloc();if(4==b.inf.dataFormat){var g=
128;0!=(b.inf.flags&1<<Nb.Dxt10Header._hx_index)&&(g+=20);var h=0;for(c=b.tex.get_layerCount();h<c;){var k=h++;var l=0;for(e=b.inf.mipOffset;l<e;){var m=l++;m=ya.calcDataSize(b.inf.width<<b.inf.mipOffset>>m,b.inf.height<<b.inf.mipOffset>>m,b.inf.pixelFormat);g+=m}e=0;for(l=b.inf.mipLevels;e<l;){m=e++;var p=b.inf.width>>m,t=b.inf.height>>m;0==p&&(p=1);0==t&&(t=1);var n=ya.calcDataSize(p,t,b.inf.pixelFormat),r=null==a?b.entry.fetchBytes(g,n):a;b.tex.uploadPixels(new ya(p,t,r,b.inf.pixelFormat,null==
a?0:g),m,k);g+=n}}}else for(h=0,c=b.tex.get_layerCount();h<c;)for(k=h++,l=0,e=b.inf.mipLevels;l<e;)m=l++,g=b.getPixels(b.tex.format,k*b.inf.mipLevels+m),b.tex.uploadPixels(g,m,k),g.dispose();Db.LOG_TEXTURE_LOAD&&null==a&&(k=1E3*(D.now()/1E3-f),h=b.inf.pixelFormat,22==h._hx_index?(c=h.v,c=!0):c=!1,c=c?"DXT":Mf.getName(b.inf.dataFormat),Ka.trace(c+" "+(k|0)+"."+(10*k|0)%10+"ms "+b.inf.width+"x"+b.inf.height+" "+b.entry.get_path(),{fileName:"hxd/res/Image.hx",lineNumber:625,className:"hxd.res.Image",
methodName:"loadTexture"}));b.tex.realloc=function(){b.loadTexture()};Db.ENABLE_AUTO_WATCH&&b.watch(M(b,b.watchCallb))}};this.entry.get_isAvailable()?c():this.entry.load(c)}},toTexture:function(){var a=this;if(null!=this.tex)return this.tex;this.getInfo();var b=[O.NoAlloc],c=this.inf.pixelFormat;if(c==F.BGRA||c==F.ARGB||c==F.RGBA)c=Y.nativeFormat;0!=(this.inf.flags&1<<Nb.IsCube._hx_index)&&b.push(O.Cube);1<this.inf.mipLevels&&(b.push(O.MipMapped),b.push(O.ManualMipMapGen));this.tex=1<this.inf.layerCount?
new lg(this.inf.width,this.inf.height,this.inf.layerCount,b,c):new Y(this.inf.width,this.inf.height,b,c);Db.DEFAULT_FILTER!=sd.Linear&&this.tex.set_filter(Db.DEFAULT_FILTER);this.tex.setName(this.entry.get_path());Db.setupTextureFlags(this.tex);0!=(this.tex.flags&1<<O.IsArray._hx_index)||0==(this.tex.flags&1<<O.LazyLoading._hx_index)?this.loadTexture():this.tex.realloc=function(){a.loadTexture()};return this.tex},toTile:function(){this.getInfo();return ib.fromTexture(this.toTexture()).sub(0,0,this.inf.width,
this.inf.height)},__class__:Db});var bd=function(a){this.fs=a;this.cache=new La};z["hxd.res.Loader"]=bd;bd.__name__="hxd.res.Loader";bd.prototype={cleanCache:function(){this.cache=new La},dir:function(a){var b=[];a=this.fs.dir(a);for(var c=0;c<a.length;){var d=a[c];++c;b.push(new jd(this,d))}return b},exists:function(a){return this.fs.exists(a)},load:function(a){return new jd(this,this.fs.get(a))},loadCache:function(a,b){var c=this.cache.h[a];if(null==c){c=this.fs.get(a);var d=bd.currentInstance;
bd.currentInstance=this;c=la.createInstance(b,[c]);bd.currentInstance=d;this.cache.h[a]=c}else if(null==(Z.__downcastCheck(c,b)?c:null))throw u.thrown(a+" has been reintrepreted from "+w.string(Z.getClass(c))+" to "+w.string(b));return c},dispose:function(){this.cleanCache();this.fs.dispose()},__class__:bd};var Gh=function(a){this.entry=a};z["hxd.res.Model"]=Gh;Gh.__name__="hxd.res.Model";Gh.__super__=Mb;Gh.prototype=J(Mb.prototype,{toHmd:function(){var a=this.entry.open(),b=(new Qd(a)).readHeader();
a.close();return new Yi(this,b)},__class__:Gh});var Dg=L["hxd.res.Filter"]={__ename__:!0,__constructs__:null,Fast:{_hx_name:"Fast",_hx_index:0,__enum__:"hxd.res.Filter",toString:v},Chromatic:{_hx_name:"Chromatic",_hx_index:1,__enum__:"hxd.res.Filter",toString:v}};Dg.__constructs__=[Dg.Fast,Dg.Chromatic];Dg.__empty_constructs__=[Dg.Fast,Dg.Chromatic];var Eg=function(){};z["hxd.res._NanoJpeg.Component"]=Eg;Eg.__name__="hxd.res._NanoJpeg.Component";Eg.prototype={__class__:Eg};var cb=function(){this.comps=
[new Eg,new Eg,new Eg].slice(0);this.qtab=[Array(64),Array(64),Array(64),Array(64)].slice(0);this.counts=Array(16);this.block=Array(64);this.njZZ=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63].slice(0);this.vlctab=[null,null,null,null,null,null,null,null].slice(0)};z["hxd.res.NanoJpeg"]=cb;cb.__name__="hxd.res.NanoJpeg";cb.CF=function(a){a=a+64>>7;return 0>a?0:255<
a?255:a};cb.njClip=function(a){return 0>a?0:255<a?255:a};cb.decode=function(a,b,c,d){null==d&&(d=-1);null==c&&(c=0);null==cb.inst&&(cb.inst=new cb);cb.inst.njInit(a,c,d,b);return cb.inst.njDecode()};cb.prototype={alloc:function(a){return new S(new ArrayBuffer(a))},free:function(a){},njInit:function(a,b,c,d){this.bytes=a;this.pos=b;this.filter=null==d?Dg.Chromatic:d;0>c&&(c=a.length-b);null==this.vlctab[0]&&(this.vlctab[0]=new S(new ArrayBuffer(131072)));null==this.vlctab[1]&&(this.vlctab[1]=new S(new ArrayBuffer(131072)));
null==this.vlctab[2]&&(this.vlctab[2]=new S(new ArrayBuffer(131072)));null==this.vlctab[3]&&(this.vlctab[3]=new S(new ArrayBuffer(131072)));this.size=c;this.bufbits=this.buf=this.length=this.rstinterval=this.qtavail=this.qtused=0;this.progressive=!1;this.comps[0].dcpred=0;this.comps[1].dcpred=0;this.comps[2].dcpred=0},cleanup:function(){this.bytes=null;for(var a=0,b=this.comps;a<b.length;){var c=b[a];++a;null!=c.pixels&&(c.pixels=null)}null!=this.vlctab[0]&&(this.vlctab[0]=null);null!=this.vlctab[1]&&
(this.vlctab[1]=null);null!=this.vlctab[2]&&(this.vlctab[2]=null);null!=this.vlctab[3]&&(this.vlctab[3]=null);null!=this.vlctab[4]&&(this.vlctab[4]=null);null!=this.vlctab[5]&&(this.vlctab[5]=null);null!=this.vlctab[6]&&(this.vlctab[6]=null);null!=this.vlctab[7]&&(this.vlctab[7]=null)},njSkip:function(a){this.pos+=a;this.size-=a;this.length-=a},syntax:function(a){},get:function(a){return this.bytes.b[this.pos+a]},njDecode16:function(a){return this.bytes.b[this.pos+a]<<8|this.bytes.b[this.pos+(a+1)]},
njByteAlign:function(){this.bufbits&=248},njShowBits:function(a){if(0==a)return 0;for(;this.bufbits<a;)if(0>=this.size)this.buf=this.buf<<8|255,this.bufbits+=8;else{var b=this.bytes.b[this.pos];this.pos++;this.size--;this.bufbits+=8;this.buf=this.buf<<8|b;if(255==b)switch(b=this.bytes.b[this.pos],this.pos++,this.size--,b){case 217:this.size=0;break;case 0:case 255:break;default:this.buf=this.buf<<8|b,this.bufbits+=8}}return this.buf>>this.bufbits-a&(1<<a)-1},njSkipBits:function(a){this.bufbits<a&&
this.njShowBits(a);this.bufbits-=a},njGetBits:function(a){var b=this.njShowBits(a);this.bufbits-=a;return b},njDecodeLength:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;this.length-=2},njSkipMarker:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;var a=this.length-=2;this.pos+=a;this.size-=a;this.length-=a},njDecodeSOF:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=
2;this.size-=2;this.length-=2;8!=this.bytes.b[this.pos]&&this.notSupported();this.height=this.bytes.b[this.pos+1]<<8|this.bytes.b[this.pos+2];this.width=this.bytes.b[this.pos+3]<<8|this.bytes.b[this.pos+4];this.ncomp=this.bytes.b[this.pos+5];this.pos+=6;this.size-=6;this.length-=6;switch(this.ncomp){case 1:case 3:break;default:this.notSupported()}for(var a=0,b=0,c=0,d=this.ncomp;c<d;){var e=c++;e=this.comps[e];e.cid=this.bytes.b[this.pos];e.ssx=this.bytes.b[this.pos+1]>>4;0!=(e.ssx&e.ssx-1)&&this.notSupported();
e.ssy=this.bytes.b[this.pos+1]&15;0!=(e.ssy&e.ssy-1)&&this.notSupported();e.qtsel=this.bytes.b[this.pos+2];this.pos+=3;this.size-=3;this.length-=3;this.qtused|=1<<e.qtsel;e.ssx>a&&(a=e.ssx);e.ssy>b&&(b=e.ssy)}1==this.ncomp&&(e=this.comps[0],a=b=1,e.ssx=e.ssy=a);this.mbsizex=a<<3;this.mbsizey=b<<3;this.mbwidth=(this.width+this.mbsizex-1)/this.mbsizex|0;this.mbheight=(this.height+this.mbsizey-1)/this.mbsizey|0;c=0;for(d=this.ncomp;c<d;)e=c++,e=this.comps[e],e.width=(this.width*e.ssx+a-1)/a|0,e.stride=
e.width+7&2147483640,e.height=(this.height*e.ssy+b-1)/b|0,e.stride=this.mbwidth*this.mbsizex*e.ssx/a|0,(3>e.width&&e.ssx!=a||3>e.height&&e.ssy!=b)&&this.notSupported(),e.pixels=new S(new ArrayBuffer(e.stride*(this.mbheight*this.mbsizey*e.ssy/b|0)));a=this.length;this.pos+=a;this.size-=a;this.length-=a},njDecodeDQT:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;for(this.length-=2;65<=this.length;){var a=this.bytes.b[this.pos];this.qtavail|=1<<a;a=
this.qtab[a];for(var b=0;64>b;){var c=b++;a[c]=this.bytes.b[this.pos+(c+1)]}this.pos+=65;this.size-=65;this.length-=65}},njDecodeDHT:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;for(this.length-=2;17<=this.length;){var a=this.bytes.b[this.pos];a=a>>4&1|(a&3)<<1;this.counts[0]=this.bytes.b[this.pos+1];this.counts[1]=this.bytes.b[this.pos+2];this.counts[2]=this.bytes.b[this.pos+3];this.counts[3]=this.bytes.b[this.pos+4];this.counts[4]=this.bytes.b[this.pos+
5];this.counts[5]=this.bytes.b[this.pos+6];this.counts[6]=this.bytes.b[this.pos+7];this.counts[7]=this.bytes.b[this.pos+8];this.counts[8]=this.bytes.b[this.pos+9];this.counts[9]=this.bytes.b[this.pos+10];this.counts[10]=this.bytes.b[this.pos+11];this.counts[11]=this.bytes.b[this.pos+12];this.counts[12]=this.bytes.b[this.pos+13];this.counts[13]=this.bytes.b[this.pos+14];this.counts[14]=this.bytes.b[this.pos+15];this.counts[15]=this.bytes.b[this.pos+16];this.pos+=17;this.size-=17;this.length-=17;a=
this.vlctab[a];for(var b=0,c=65536,d=65536,e=1;17>e;){var f=e++;d>>=1;var g=this.counts[f-1];if(0!=g){c-=g<<16-f;for(var h=0,k=g;h<k;){var l=h++;l=this.bytes.b[this.pos+l];for(var m=0,p=d;m<p;)m++,a.b[b++]=f,a.b[b++]=l}this.pos+=g;this.size-=g;this.length-=g}}for(;0!=c--;)a.b[b]=0,b+=2}},njDecodeDRI:function(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;this.length-=2;this.rstinterval=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];var a=this.length;
this.pos+=a;this.size-=a;this.length-=a},njGetVLC:function(a){var b=this.njShowBits(16),c=a.b[b<<1];this.bufbits<c&&this.njShowBits(c);this.bufbits-=c;this.vlcCode=b=a.b[b<<1|1];c=b&15;if(0==c)return 0;a=this.njShowBits(c);this.bufbits-=c;b=a;b<1<<c-1&&(b+=(-1<<c)+1);return b},njRowIDCT:function(a){var b=this.block[a+4]<<11,c=this.block[a+6],d=this.block[a+2],e=this.block[a+1],f=this.block[a+7],g=this.block[a+5],h=this.block[a+3];if(0==(b|c|d|e|f|g|h))b=this.block[a+7]=this.block[a]<<3,b=this.block[a+
6]=b,b=this.block[a+5]=b,b=this.block[a+4]=b,b=this.block[a+3]=b,b=this.block[a+2]=b,b=this.block[a+1]=b,this.block[a]=b;else{var k=(this.block[a]<<11)+128,l=565*(e+f);e=l+2276*e;f=l-3406*f;l=2408*(g+h);g=l-799*g;h=l-4017*h;l=k+b;k-=b;b=1108*(d+c);c=b-3784*c;d=b+1568*d;b=e+g;e-=g;g=f+h;f-=h;h=l+d;l-=d;d=k+c;k-=c;c=181*(e+f)+128>>8;e=181*(e-f)+128>>8;this.block[a]=h+b>>8;this.block[a+1]=d+c>>8;this.block[a+2]=k+e>>8;this.block[a+3]=l+g>>8;this.block[a+4]=l-g>>8;this.block[a+5]=k-e>>8;this.block[a+
6]=d-c>>8;this.block[a+7]=h-b>>8}},njColIDCT:function(a,b,c,d){var e=this.block[a+32]<<8,f=this.block[a+48],g=this.block[a+16],h=this.block[a+8];var k=this.block[a+56];var l=this.block[a+40],m=this.block[a+24];if(0==(e|f|g|h|k|l|m))k=(this.block[a]+32>>6)+128,e=0>k?0:255<k?255:k,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,c+=d,b.b[c]=e,b.b[c+d]=e;else{a=(this.block[a]<<8)+8192;var p=565*(h+k)+4;h=p+2276*h>>3;k=p-3406*k>>3;p=2408*(l+m)+4;l=p-799*l>>3;m=p-4017*m>>
3;p=a+e;a-=e;e=1108*(g+f)+4;f=e-3784*f>>3;g=e+1568*g>>3;e=h+l;h-=l;l=k+m;k-=m;m=p+g;p-=g;g=a+f;a-=f;f=181*(h+k)+128>>8;h=181*(h-k)+128>>8;k=(m+e>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(g+f>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(a+h>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(p+l>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(p-l>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(a-h>>14)+128;b.b[c]=0>k?0:255<k?255:k;c+=d;k=(g-f>>14)+128;b.b[c]=0>k?0:255<k?255:k;k=(m-e>>14)+128;b.b[c+d]=0>k?0:255<k?255:k}},njDecodeBlock:function(a,
b){var c,d,e=a.pixels;for(d=c=0;64>d;){var f=d++;this.block[f]=0}var g=a.dcpred,h=this.vlctab[a.dctabsel];f=this.njShowBits(16);d=h.b[f<<1];this.bufbits<d&&this.njShowBits(d);this.bufbits-=d;this.vlcCode=f=h.b[f<<1|1];d=f&15;0==d?d=0:(f=this.njShowBits(d),this.bufbits-=d,f<1<<d-1&&(f+=(-1<<d)+1),d=f);a.dcpred=g+d;g=this.qtab[a.qtsel];h=this.vlctab[a.actabsel];this.block[0]=a.dcpred*g[0];do{f=this.njShowBits(16);d=h.b[f<<1];this.bufbits<d&&this.njShowBits(d);this.bufbits-=d;this.vlcCode=f=h.b[f<<1|
1];d=f&15;0==d?d=0:(f=this.njShowBits(d),this.bufbits-=d,f<1<<d-1&&(f+=(-1<<d)+1),d=f);if(0==this.vlcCode)break;c+=(this.vlcCode>>4)+1;this.block[this.njZZ[c]]=d*g[c]}while(63>c);var k=0;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];var l=this.block[k+1];var m=this.block[k+7];var p=this.block[k+5],t=this.block[k+3];0==(f|g|h|l|m|p|t)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=
c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+t),p=d-799*p,t=d-4017*t,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=t+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=t-f>>8);k=8;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+
1];m=this.block[k+7];p=this.block[k+5];t=this.block[k+3];0==(f|g|h|l|m|p|t)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+t),p=d-799*p,t=d-4017*t,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=t+f>>8,this.block[k+
1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=t-f>>8);k=16;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];t=this.block[k+3];0==(f|g|h|l|m|p|t)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,
d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+t),p=d-799*p,t=d-4017*t,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=t+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=t-f>>8);k=24;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];t=this.block[k+
3];0==(f|g|h|l|m|p|t)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+t),p=d-799*p,t=d-4017*t,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=t+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=
d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=t-f>>8);k=32;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];t=this.block[k+3];0==(f|g|h|l|m|p|t)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+t),
p=d-799*p,t=d-4017*t,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=t+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=t-f>>8);k=40;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];t=this.block[k+3];0==(f|g|h|l|m|p|t)?(c=this.block[k+
7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+t),p=d-799*p,t=d-4017*t,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=t+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+
5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=t-f>>8);k=48;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];t=this.block[k+3];0==(f|g|h|l|m|p|t)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+t),p=d-799*p,t=d-4017*t,d=c+f,c-=f,f=1108*(h+g),
g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=t+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=t-f>>8);k=56;f=this.block[k+4]<<11;g=this.block[k+6];h=this.block[k+2];l=this.block[k+1];m=this.block[k+7];p=this.block[k+5];t=this.block[k+3];0==(f|g|h|l|m|p|t)?(c=this.block[k+7]=this.block[k]<<3,c=this.block[k+6]=c,c=this.block[k+
5]=c,c=this.block[k+4]=c,c=this.block[k+3]=c,c=this.block[k+2]=c,c=this.block[k+1]=c,this.block[k]=c):(c=(this.block[k]<<11)+128,d=565*(l+m),l=d+2276*l,m=d-3406*m,d=2408*(p+t),p=d-799*p,t=d-4017*t,d=c+f,c-=f,f=1108*(h+g),g=f-3784*g,h=f+1568*h,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,this.block[k]=t+f>>8,this.block[k+1]=h+g>>8,this.block[k+2]=c+l>>8,this.block[k+3]=d+p>>8,this.block[k+4]=d-p>>8,this.block[k+5]=c-l>>8,this.block[k+6]=h-g>>8,this.block[k+7]=t-
f>>8);k=b;var n=a.stride;f=this.block[32]<<8;g=this.block[48];h=this.block[16];l=this.block[8];m=this.block[56];p=this.block[40];t=this.block[24];0==(f|g|h|l|m|p|t)?(m=(this.block[0]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[0]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+t)+4,p=d-799*p>>3,t=d-4017*t>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+t,
m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(t+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(t-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=1+b;n=a.stride;f=this.block[33]<<8;g=this.block[49];h=this.block[17];l=this.block[9];
m=this.block[57];p=this.block[41];t=this.block[25];0==(f|g|h|l|m|p|t)?(m=(this.block[1]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[1]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+t)+4,p=d-799*p>>3,t=d-4017*t>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(t+f>>14)+128,e.b[k]=0>m?0:255<
m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(t-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=2+b;n=a.stride;f=this.block[34]<<8;g=this.block[50];h=this.block[18];l=this.block[10];m=this.block[58];p=this.block[42];t=this.block[26];0==(f|g|h|l|m|p|t)?(m=(this.block[2]+
32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[2]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+t)+4,p=d-799*p>>3,t=d-4017*t>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(t+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?
0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(t-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=3+b;n=a.stride;f=this.block[35]<<8;g=this.block[51];h=this.block[19];l=this.block[11];m=this.block[59];p=this.block[43];t=this.block[27];0==(f|g|h|l|m|p|t)?(m=(this.block[3]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=
n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[3]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+t)+4,p=d-799*p>>3,t=d-4017*t>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(t+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=
0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(t-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=4+b;n=a.stride;f=this.block[36]<<8;g=this.block[52];h=this.block[20];l=this.block[12];m=this.block[60];p=this.block[44];t=this.block[28];0==(f|g|h|l|m|p|t)?(m=(this.block[4]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[4]<<8)+8192,d=565*(l+
m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+t)+4,p=d-799*p>>3,t=d-4017*t>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(t+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,
e.b[k]=0>m?0:255<m?255:m,m=(t-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=5+b;n=a.stride;f=this.block[37]<<8;g=this.block[53];h=this.block[21];l=this.block[13];m=this.block[61];p=this.block[45];t=this.block[29];0==(f|g|h|l|m|p|t)?(m=(this.block[5]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[5]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+t)+4,p=d-799*p>>3,t=d-4017*t>>3,d=c+f,c-=
f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(t+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(t-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=6+b;n=a.stride;
f=this.block[38]<<8;g=this.block[54];h=this.block[22];l=this.block[14];m=this.block[62];p=this.block[46];t=this.block[30];0==(f|g|h|l|m|p|t)?(m=(this.block[6]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[6]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+t)+4,p=d-799*p>>3,t=d-4017*t>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=
g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(t+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(t-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m);k=7+b;n=a.stride;f=this.block[39]<<8;g=this.block[55];h=this.block[23];l=this.block[15];m=this.block[63];
p=this.block[47];t=this.block[31];0==(f|g|h|l|m|p|t)?(m=(this.block[7]+32>>6)+128,f=0>m?0:255<m?255:m,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,k+=n,e.b[k]=f,e.b[k+n]=f):(c=(this.block[7]<<8)+8192,d=565*(l+m)+4,l=d+2276*l>>3,m=d-3406*m>>3,d=2408*(p+t)+4,p=d-799*p>>3,t=d-4017*t>>3,d=c+f,c-=f,f=1108*(h+g)+4,g=f-3784*g>>3,h=f+1568*h>>3,f=l+p,l-=p,p=m+t,m-=t,t=d+h,d-=h,h=c+g,c-=g,g=181*(l+m)+128>>8,l=181*(l-m)+128>>8,m=(t+f>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=
(h+g>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c+l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d+p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(d-p>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(c-l>>14)+128,e.b[k]=0>m?0:255<m?255:m,k+=n,m=(h-g>>14)+128,e.b[k]=0>m?0:255<m?255:m,m=(t-f>>14)+128,e.b[k+n]=0>m?0:255<m?255:m)},notSupported:function(){throw u.thrown("This JPG file is not supported");},njDecodeScan:function(){var a;this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=
2;this.length-=2;this.bytes.b[this.pos]!=this.ncomp&&this.notSupported();this.pos+=1;--this.size;--this.length;var b=0;for(a=this.ncomp;b<a;){var c=b++;c=this.comps[c];c.dctabsel=this.bytes.b[this.pos+1]>>4<<1;c.actabsel=(this.bytes.b[this.pos+1]&3)<<1|1;this.pos+=2;this.size-=2;this.length-=2}a=this.bytes.b[this.pos];b=this.bytes.b[this.pos+1];var d=this.bytes.b[this.pos+2];(!this.progressive&&0!=a||b!=63-a||0!=d)&&this.notSupported();b=this.length;this.pos+=b;this.size-=b;this.length-=b;for(var e=
d=0,f=this.rstinterval;;){b=0;for(a=this.ncomp;b<a;){c=b++;c=this.comps[c];for(var g=0,h=c.ssy;g<h;)for(var k=g++,l=0,m=c.ssx;l<m;){var p=l++;this.njDecodeBlock(c,(e*c.ssy+k)*c.stride+d*c.ssx+p<<3)}}if(++d>=this.mbwidth&&(d=0,++e>=this.mbheight))break;0!=this.rstinterval&&0==--f&&(this.bufbits&=248,this.njShowBits(16),this.bufbits-=16,f=this.rstinterval,this.comps[0].dcpred=0,this.comps[1].dcpred=0,this.comps[2].dcpred=0)}},njUpsampleH:function(a){for(var b=a.width-3,c=new S(new ArrayBuffer(a.width*
a.height<<1)),d=a.pixels,e=0,f=0,g=0,h=a.height;g<h;){g++;var k=139*d.b[e]+-11*d.b[e+1]+64>>7;c.b[f]=0>k?0:255<k?255:k;k=104*d.b[e]+27*d.b[e+1]+-3*d.b[e+2]+64>>7;c.b[f+1]=0>k?0:255<k?255:k;k=28*d.b[e]+109*d.b[e+1]+-9*d.b[e+2]+64>>7;c.b[f+2]=0>k?0:255<k?255:k;k=0;for(var l=b;k<l;){var m=k++,p=-9*d.b[e+m]+111*d.b[e+m+1]+29*d.b[e+m+2]+-3*d.b[e+m+3]+64>>7;c.b[f+(m<<1)+3]=0>p?0:255<p?255:p;p=-3*d.b[e+m]+29*d.b[e+m+1]+111*d.b[e+m+2]+-9*d.b[e+m+3]+64>>7;c.b[f+(m<<1)+4]=0>p?0:255<p?255:p}e+=a.stride;f+=a.width<<
1;k=28*d.b[e-1]+109*d.b[e-2]+-9*d.b[e-3]+64>>7;c.b[f-3]=0>k?0:255<k?255:k;k=104*d.b[e-1]+27*d.b[e-2]+-3*d.b[e-3]+64>>7;c.b[f-2]=0>k?0:255<k?255:k;k=139*d.b[e-1]+-11*d.b[e-2]+64>>7;c.b[f-1]=0>k?0:255<k?255:k}a.width<<=1;a.stride=a.width;a.pixels=c},njUpsampleV:function(a){for(var b=a.width,c=a.stride,d=c+c,e=new S(new ArrayBuffer(a.width*a.height<<1)),f,g,h=a.pixels,k=0;k<b;){f=g=k++;var l=139*h.b[f]+-11*h.b[f+c]+64>>7;e.b[g]=0>l?0:255<l?255:l;g+=b;l=104*h.b[f]+27*h.b[f+c]+-3*h.b[f+d]+64>>7;e.b[g]=
0>l?0:255<l?255:l;g+=b;l=28*h.b[f]+109*h.b[f+c]+-9*h.b[f+d]+64>>7;e.b[g]=0>l?0:255<l?255:l;g+=b;f+=c;l=0;for(var m=a.height-2;l<m;){l++;var p=-9*h.b[f-c]+111*h.b[f]+29*h.b[f+c]+-3*h.b[f+d]+64>>7;e.b[g]=0>p?0:255<p?255:p;g+=b;p=-3*h.b[f-c]+29*h.b[f]+111*h.b[f+c]+-9*h.b[f+d]+64>>7;e.b[g]=0>p?0:255<p?255:p;g+=b;f+=c}f+=c;l=28*h.b[f]+109*h.b[f-c]+-9*h.b[f-d]+64>>7;e.b[g]=0>l?0:255<l?255:l;g+=b;l=104*h.b[f]+27*h.b[f-c]+-3*h.b[f-d]+64>>7;e.b[g]=0>l?0:255<l?255:l;g+=b;f=139*h.b[f]+-11*h.b[f-c]+64>>7;e.b[g]=
0>f?0:255<f?255:f}a.height<<=1;a.stride=a.width;a.pixels=e},njUpsample:function(a){for(var b=0,c=0;a.width<this.width;)a.width<<=1,++b;for(;a.height<this.height;)a.height<<=1,++c;for(var d=new S(new ArrayBuffer(a.width*a.height)),e=a.pixels,f=0,g=0,h=a.height;g<h;)for(var k=(g++>>c)*a.stride,l=0,m=a.width;l<m;){var p=l++;d.b[f++]=e.b[(p>>b)+k]}a.stride=a.width;a.pixels=d},njConvert:function(){var a;var b=0;for(a=this.ncomp;b<a;){var c=b++;c=this.comps[c];switch(this.filter._hx_index){case 0:(c.width<
this.width||c.height<this.height)&&this.njUpsample(c);break;case 1:for(;c.width<this.width||c.height<this.height;)c.width<this.width&&this.njUpsampleH(c),c.height<this.height&&this.njUpsampleV(c)}if(c.width<this.width||c.height<this.height)throw u.thrown("assert");}c=new S(new ArrayBuffer(this.width*this.height*4));if(3==this.ncomp){var d=this.comps[0].pixels,e=this.comps[1].pixels,f=this.comps[2].pixels,g=0,h=0,k=0,l=0;b=0;for(a=this.height;b<a;){b++;for(var m=0,p=this.width;m<p;){m++;var t=d.b[g++]<<
8,n=e.b[h++]-128,r=f.b[k++]-128,q=t+359*r+128>>8;q=0>q?0:255<q?255:q;r=t-88*n-183*r+128>>8;r=0>r?0:255<r?255:r;t=t+454*n+128>>8;t=0>t?0:255<t?255:t;c.b[l++]=t;c.b[l++]=r;c.b[l++]=q;c.b[l++]=255}g+=this.comps[0].stride-this.width;h+=this.comps[1].stride-this.width;k+=this.comps[2].stride-this.width}}else throw u.thrown("TODO");return c},njDecode:function(){if(2>this.size||255!=this.bytes.b[this.pos]||216!=this.bytes.b[this.pos+1])throw u.thrown("This file is not a JPEG");this.pos+=2;this.size-=2;this.length-=
2;a:for(;;)switch(this.pos+=2,this.size-=2,this.length-=2,this.bytes.b[this.pos+-1]){case 192:this.njDecodeSOF();break;case 194:throw this.progressive=!0,u.thrown("Unsupported progressive JPG");null==this.vlctab[4]&&(this.vlctab[4]=new S(new ArrayBuffer(131072)));null==this.vlctab[5]&&(this.vlctab[5]=new S(new ArrayBuffer(131072)));null==this.vlctab[6]&&(this.vlctab[6]=new S(new ArrayBuffer(131072)));null==this.vlctab[7]&&(this.vlctab[7]=new S(new ArrayBuffer(131072)));this.njDecodeSOF();break;case 195:throw u.thrown("Unsupported lossless JPG");
case 196:this.njDecodeDHT();break;case 218:this.njDecodeScan();break a;case 219:this.njDecodeDQT();break;case 221:this.njDecodeDRI();break;case 254:this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];this.pos+=2;this.size-=2;var a=this.length-=2;this.pos+=a;this.size-=a;this.length-=a;break;default:switch(this.bytes.b[this.pos+-1]&240){case 192:throw u.thrown("Unsupported jpeg type "+(this.bytes.b[this.pos+-1]&15));case 224:this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];
this.pos+=2;this.size-=2;a=this.length-=2;this.pos+=a;this.size-=a;this.length-=a;break;default:throw u.thrown("Unsupported jpeg tag 0x"+aa.hex(this.bytes.b[this.pos+-1],2));}}a=this.njConvert();this.cleanup();return{pixels:a,width:this.width,height:this.height}},__class__:cb};var Nf=L["hxd.res.SoundFormat"]={__ename__:!0,__constructs__:null,Wav:{_hx_name:"Wav",_hx_index:0,__enum__:"hxd.res.SoundFormat",toString:v},Mp3:{_hx_name:"Mp3",_hx_index:1,__enum__:"hxd.res.SoundFormat",toString:v},OggVorbis:{_hx_name:"OggVorbis",
_hx_index:2,__enum__:"hxd.res.SoundFormat",toString:v}};Nf.__constructs__=[Nf.Wav,Nf.Mp3,Nf.OggVorbis];Nf.__empty_constructs__=[Nf.Wav,Nf.Mp3,Nf.OggVorbis];var lf=function(a){this.lastPlay=0;this.entry=a};z["hxd.res.Sound"]=lf;lf.__name__="hxd.res.Sound";lf.supportedFormat=function(a){switch(a._hx_index){case 0:case 1:return!0;case 2:return!1}};lf.startWorker=function(){return!1};lf.__super__=Mb;lf.prototype=J(Mb.prototype,{getData:function(){if(null!=this.data)return this.data;var a=this.entry.getBytes();
switch(a.b[0]){case 73:case 255:this.data=new Ih(a);break;case 79:throw u.thrown("OGG format requires -lib stb_ogg_sound (for "+this.entry.get_path()+")");case 82:this.data=new Fg(a)}if(null==this.data)throw u.thrown("Unsupported sound format "+this.entry.get_path());lf.ENABLE_AUTO_WATCH&&this.watch(M(this,this.watchCallb));return this.data},dispose:function(){this.stop();this.data=null},stop:function(){null!=this.channel&&(this.channel.stop(),this.channel=null)},play:function(a,b,c,d){null==b&&(b=
1);null==a&&(a=!1);this.lastPlay=D.now()/1E3;this.channel=oa.get().play(this,c,d);this.channel.loop=a;this.channel.set_volume(b);return this.channel},watchCallb:function(){var a=this.data;this.data=null;var b=this.getData();if(null!=a&&(a.channels!=b.channels||a.samples!=b.samples||a.sampleFormat!=b.sampleFormat||a.samplingRate!=b.samplingRate))for(a=oa.get().getAll(this);a.hasNext();){var c=a.next();c.duration=b.get_duration();c.set_position(c.position)}},__class__:lf});var ee=function(){this.volume=
1;this.bindedEffects=[];this.effects=[];this.mute=!1;this.priority=0};z["hxd.snd.ChannelBase"]=ee;ee.__name__="hxd.snd.ChannelBase";ee.prototype={getEffect:function(a){if(null==this.effects)return null;for(var b=0,c=this.effects;b<c.length;){var d=c[b];++b;d=Z.__downcastCheck(d,a)?d:null;if(null!=d)return d}return null},set_volume:function(a){this.currentFade=null;return this.volume=a},fadeTo:function(a,b,c){null==b&&(b=1);this.currentFade={start:D.now()/1E3,duration:b,startVolume:this.volume,targetVolume:a,
onEnd:c}},updateCurrentVolume:function(a){if(null!=this.currentFade){var b=this.currentFade;a-=b.start;if(a>=b.duration){if(this.set_volume(b.targetVolume),null!=b.onEnd)b.onEnd()}else this.set_volume(b.startVolume+a/b.duration*(b.targetVolume-b.startVolume)),this.currentFade=b}this.currentVolume=this.volume},addEffect:function(a){if(null==a)throw u.thrown("Can't add null effect");if(0<=this.effects.indexOf(a))throw u.thrown("effect already added on this channel");this.effects.push(a);return a},removeEffect:function(a){D.remove(this.effects,
a)},__class__:ee};var Of=function(){this.queue=[];this.isVirtual=this.isLoading=this.positionChanged=!1;this.lastStamp=0;this.audibleVolume=1;this.allowVirtual=!0;this.pause=this.loop=!1;this.position=0;ee.call(this);this.id=Of.ID++};z["hxd.snd.Channel"]=Of;Of.__name__="hxd.snd.Channel";Of.__super__=ee;Of.prototype=J(ee.prototype,{onEnd:function(){},set_position:function(a){this.lastStamp=D.now()/1E3;this.positionChanged=!0;a>this.duration?a=this.duration:0>a&&(a=0);return this.position=a},set_pause:function(a){a||
(this.lastStamp=D.now()/1E3);return this.pause=a},updateCurrentVolume:function(a){if(this.pause&&null!=this.currentFade){var b=this.currentFade;this.currentFade=null;this.updateCurrentVolume(a);this.currentFade=b}ee.prototype.updateCurrentVolume.call(this,a);this.channelGroup.updateCurrentVolume(a);this.currentVolume=this.currentVolume*this.channelGroup.currentVolume*this.soundGroup.volume;if(null!=this.manager){b=0;for(var c=this.channelGroup.effects;b<c.length;)a=c[b],++b,this.currentVolume*=a.getVolumeModifier();
b=0;for(c=this.effects;b<c.length;)a=c[b],++b,this.currentVolume*=a.getVolumeModifier()}},calcAudibleVolume:function(a){this.updateCurrentVolume(a);this.audibleVolume=this.currentVolume;if(null!=this.manager){for(var b=0,c=this.channelGroup.effects;b<c.length;)a=c[b],++b,this.audibleVolume=a.applyAudibleVolumeModifier(this.audibleVolume);b=0;for(c=this.effects;b<c.length;)a=c[b],++b,this.audibleVolume=a.applyAudibleVolumeModifier(this.audibleVolume)}},queueSound:function(a){this.queue.push(a)},stop:function(){null!=
this.manager&&this.manager.releaseChannel(this)},isReleased:function(){return null==this.manager},__class__:Of});var Jh=function(a){ee.call(this);this.name=a};z["hxd.snd.ChannelGroup"]=Jh;Jh.__name__="hxd.snd.ChannelGroup";Jh.__super__=ee;Jh.prototype=J(ee.prototype,{__class__:Jh});var Nc=L["hxd.snd.SampleFormat"]={__ename__:!0,__constructs__:null,UI8:{_hx_name:"UI8",_hx_index:0,__enum__:"hxd.snd.SampleFormat",toString:v},I16:{_hx_name:"I16",_hx_index:1,__enum__:"hxd.snd.SampleFormat",toString:v},
F32:{_hx_name:"F32",_hx_index:2,__enum__:"hxd.snd.SampleFormat",toString:v}};Nc.__constructs__=[Nc.UI8,Nc.I16,Nc.F32];Nc.__empty_constructs__=[Nc.UI8,Nc.I16,Nc.F32];var te=function(){};z["hxd.snd.Data"]=te;te.__name__="hxd.snd.Data";te.formatBytes=function(a){switch(a._hx_index){case 0:return 1;case 1:return 2;case 2:return 4}};te.prototype={isLoading:function(){return!1},decode:function(a,b,c,d){var e=this.getBytesPerSample();if(0>c||0>d||0>b||b+d*e>a.length)throw b="sampleStart = "+c+(" sampleCount = "+
d)+(" outPos = "+b),b+=" bpp = "+e,b+=" out.length = "+a.length,u.thrown(b);if(c+d>=this.samples){var f=0;c<this.samples&&(f=this.samples-c,this.decodeBuffer(a,b,c,f));a.fill(b+f*e,(d-f)*e,0)}else this.decodeBuffer(a,b,c,d)},resample:function(a,b,c){if(this.sampleFormat==b&&this.samplingRate==a&&this.channels==c)return this;var d=Math.ceil(a/this.samplingRate*this.samples),e=this.getBytesPerSample();e=new S(new ArrayBuffer(e*this.samples));this.decodeBuffer(e,0,0,this.samples);switch(b._hx_index){case 0:var f=
1;break;case 1:f=2;break;case 2:f=4}f=new S(new ArrayBuffer(c*d*f));this.resampleBuffer(f,0,e,0,a,b,c,this.samples);e=new Fg(null);e.channels=c;e.samples=d;e.sampleFormat=b;e.samplingRate=a;e.rawData=f;return e},resampleBuffer:function(a,b,c,d,e,f,g,h){var k=this.getBytesPerSample(),l=Math.ceil(e/this.samplingRate*h),m=h!=l;if(m||this.sampleFormat!=Nc.I16||f!=Nc.I16||1!=g||2!=this.channels){e=this.channels;var p=g<e?g:e,t=g-p,n=0,r=0;e=0;for(g=l;e<g;){var q=e++;q=q/(l-1)*(h-1);var u=q|0;q-=u;var v=
d+u*k;u==h-1&&(m=!1);u=0;for(var w=p;u<w;){u++;n=0;switch(this.sampleFormat._hx_index){case 0:var x=c.b[v]/255;m&&(n=c.b[v+k]/255);++v;break;case 1:x=c.getUInt16(v);x=(0==(x&32768)?x:x|-65536)/32768;m&&(n=c.getUInt16(v+k),n=(0==(n&32768)?n:n|-65536)/32768);v+=2;break;case 2:x=c.getFloat(v),m&&(n=c.getFloat(v+k)),v+=4}n=m?x+q*(n-x):x;switch(f._hx_index){case 0:r=128*(n+1)|0;255<r&&(r=255);a.b[b++]=r;break;case 1:r=32768*n|0;32767<r&&(r=32767);r&=65535;a.setUInt16(b,r);b+=2;break;case 2:a.setFloat(b,
n),b+=4}}q=0;for(v=t;q<v;)switch(q++,f._hx_index){case 0:a.b[b++]=r;break;case 1:a.setUInt16(b,r);b+=2;break;case 2:a.setFloat(b,n),b+=4}}}else for(e=0,g=h;e<g;)e++,h=c.getUInt16(d),d+=2,f=c.getUInt16(d),d+=2,32768<=(h^f)?(0!=(h&32768)&&(h|=-65536),0!=(f&32768)&&(f|=-65536),h=h+f>>1&65535):h=h+f>>1,a.setUInt16(b,h),b+=2},decodeBuffer:function(a,b,c,d){throw u.thrown("Not implemented");},getBytesPerSample:function(){switch(this.sampleFormat._hx_index){case 0:var a=1;break;case 1:a=2;break;case 2:a=
4}return this.channels*a},load:function(a){a()},get_duration:function(){return this.samples/this.samplingRate},__class__:te};var ue=function(){};z["hxd.snd.EffectDriver"]=ue;ue.__name__="hxd.snd.EffectDriver";ue.prototype={acquire:function(){},release:function(){},update:function(a){},bind:function(a,b){},apply:function(a,b){},unbind:function(a,b){},__class__:ue};var ej=L["hxd.snd.DriverFeature"]={__ename__:!0,__constructs__:null,MasterVolume:{_hx_name:"MasterVolume",_hx_index:0,__enum__:"hxd.snd.DriverFeature",
toString:v}};ej.__constructs__=[ej.MasterVolume];ej.__empty_constructs__=[ej.MasterVolume];var Kh=function(){};z["hxd.snd.Driver"]=Kh;Kh.__name__="hxd.snd.Driver";Kh.__isInterface__=!0;Kh.prototype={__class__:Kh};var Ec=function(a){this.lastStamp=this.retainTime=this.priority=this.refs=0;var b=oa.get().driver;null!=b&&(this.driver=b.getEffectDriver(a))};z["hxd.snd.Effect"]=Ec;Ec.__name__="hxd.snd.Effect";Ec.prototype={applyAudibleVolumeModifier:function(a){return a},getVolumeModifier:function(){return 1},
__class__:Ec};var fj=function(){this.position=new I(0,0,0);this.velocity=new I(0,0,0);var a=1,b=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.direction=new I(a,b,c);b=a=0;c=1;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.up=new I(a,b,c)};z["hxd.snd.Listener"]=fj;fj.__name__="hxd.snd.Listener";fj.prototype={syncCamera:function(a){var b=this.position,c=a.pos;b.x=c.x;b.y=c.y;b.z=c.z;b=this.direction;c=a.target.x-a.pos.x;var d=a.target.y-a.pos.y,e=a.target.z-a.pos.z;null==e&&(e=0);null==
d&&(d=0);null==c&&(c=0);b.x=c;b.y=d;b.z=e;b=this.direction;c=b.x*b.x+b.y*b.y+b.z*b.z;c=1E-20>c?0:1/Math.sqrt(c);b.x*=c;b.y*=c;b.z*=c;b=this.up;c=a.up;b.x=c.x;b.y=c.y;b.z=c.z},__class__:fj};var Gg=function(a){this.start=0;this.playing=!1;this.volume=-1;this.id=Gg.ID++;this.handle=a.createSource();this.buffers=[]};z["hxd.snd.Source"]=Gg;Gg.__name__="hxd.snd.Source";Gg.prototype={dispose:function(){oa.get().driver.destroySource(this.handle)},__class__:Gg};var Lh=function(a){this.end=0;this.handle=a.createBuffer();
this.refs=0;this.lastStop=D.now()/1E3};z["hxd.snd.Buffer"]=Lh;Lh.__name__="hxd.snd.Buffer";Lh.prototype={dispose:function(){oa.get().driver.destroyBuffer(this.handle)},__class__:Lh};var oa=function(){this.suspended=!1;this.timeOffset=0;try{this.driver=new Mh}catch(c){if("string"==typeof u.caught(c).unwrap())this.driver=null;else throw c;}this.masterVolume=1;this.hasMasterVolume=null==this.driver?!0:this.driver.hasFeature(ej.MasterVolume);this.masterSoundGroup=new gj("master");this.masterChannelGroup=
new Jh("master");this.listener=new fj;this.soundBufferMap=new La;this.soundBufferKeys=[];this.freeStreamBuffers=[];this.effectGC=[];this.soundBufferCount=0;if(null!=this.driver){this.sources=[];for(var a=0,b=oa.MAX_SOURCES;a<b;)a++,this.sources.push(new Gg(this.driver))}this.cachedBytes=new S(new ArrayBuffer(24));this.resampleBytes=new S(new ArrayBuffer(2*oa.STREAM_BUFFER_SAMPLE_COUNT))};z["hxd.snd.Manager"]=oa;oa.__name__="hxd.snd.Manager";oa.get=function(){null==oa.instance&&(oa.instance=new oa,
oa.instance.updateEvent=xc.add((A=oa.instance,M(A,A.update))),oa.instance.updateEvent.isBlocking=!1);return oa.instance};oa.regEffect=function(a,b){for(var c=a;null!=c;){if(c==b)return a;c=c.next}b.next=a;return b};oa.prototype={getTmpBytes:function(a){this.cachedBytes.length<a&&(this.cachedBytes=new S(new ArrayBuffer(a)));return this.cachedBytes},getResampleBytes:function(a){this.resampleBytes.length<a&&(this.resampleBytes=new S(new ArrayBuffer(a)));return this.resampleBytes},stopAll:function(){for(;null!=
this.channels;)this.channels.stop()},stopAllNotLooping:function(){for(var a=this.channels;null!=a;){var b=a.next;a.loop||a.stop();a=b}},stopByName:function(a){for(var b=this.channels;null!=b;){var c=b.next;null!=b.soundGroup&&b.soundGroup.name==a&&b.stop();b=c}},getAll:function(a){for(var b=this.channels,c=[];null!=b;)b.sound==a&&c.push(b),b=b.next;return new bj(c)},cleanCache:function(){for(var a=0;a<this.soundBufferKeys.length;){var b=this.soundBufferKeys[a],c=this.soundBufferMap.h[b];++a;if(!(0<
c.refs)){var d=this.soundBufferMap;Object.prototype.hasOwnProperty.call(d.h,b)&&delete d.h[b];D.remove(this.soundBufferKeys,b);--a;c.dispose();--this.soundBufferCount}}},dispose:function(){this.stopAll();if(null!=this.driver){for(var a=0,b=this.sources;a<b.length;){var c=b[a];++a;c.dispose()}a=this.soundBufferMap.h;b=Object.keys(a);for(var d=b.length,e=0;e<d;)c=a[b[e++]],c.dispose();a=0;for(b=this.freeStreamBuffers;a<b.length;)c=b[a],++a,c.dispose();a=0;for(b=this.effectGC;a<b.length;)c=b[a],++a,
c.driver.release();this.driver.dispose()}this.effectGC=this.freeStreamBuffers=this.soundBufferKeys=this.soundBufferMap=this.sources=null;this.updateEvent.stop();oa.instance=null},play:function(a,b,c){null==c&&(c=this.masterSoundGroup);null==b&&(b=this.masterChannelGroup);var d=a.getData();if(0==d.samples)throw u.thrown(w.string(a)+" has no samples");var e=new Of;e.sound=a;e.duration=d.get_duration();e.manager=this;e.soundGroup=c;e.channelGroup=b;e.next=this.channels;e.isLoading=d.isLoading();e.isVirtual=
null==this.driver;e.lastStamp=D.now()/1E3;return this.channels=e},updateVirtualChannels:function(a){for(var b=this.channels;null!=b;)if(b.pause||!b.isVirtual||b.isLoading)b=b.next;else{var c=a-b.lastStamp;b.set_position(b.position+(0>c?0:c));b.lastStamp=a;for(c=b.next;b.position>=b.duration;)if(b.set_position(b.position-b.duration),b.onEnd(),null!=c&&null==c.manager&&(c=null),0<b.queue.length)b.sound=b.queue.shift(),b.duration=b.sound.getData().get_duration();else if(!b.loop){this.releaseChannel(b);
break}b=c}},update:function(){var a,b,c,d;if(0!=this.timeOffset){for(c=this.channels;null!=c;)c.lastStamp+=this.timeOffset,null!=c.currentFade&&(c.currentFade.start+=this.timeOffset),c=c.next;var e=0;for(a=this.sources;e<a.length;){var f=a[e];++e;var g=0;for(b=f.buffers;g<b.length;){var h=b[g];++g;h.lastStop+=this.timeOffset}}this.timeOffset=0}this.now=D.now()/1E3;if(null==this.driver)this.updateVirtualChannels(this.now);else{e=0;for(a=this.sources;e<a.length;)if(f=a[e],++e,c=f.channel,null!=c)if(c.positionChanged)this.releaseSource(f);
else{var k=null;h=this.driver.getProcessedBuffers(f.handle);g=0;for(b=h;g<b;)g++,h=this.unqueueBuffer(f),null!=h&&(k=h,h.isEnd&&(c.sound=h.sound,c.duration=h.sound.getData().get_duration(),c.set_position(c.duration),c.positionChanged=!1,c.onEnd(),f.start=0));0==f.buffers.length?k.isEnd?0<c.queue.length?(c.sound=c.queue.shift(),c.duration=c.sound.getData().get_duration(),c.set_position(0),this.releaseSource(f)):c.loop?(c.set_position(0),this.releaseSource(f)):this.releaseChannel(c):(c.set_position((k.start+
k.samples)/k.sampleRate),this.releaseSource(f)):(c.sound=f.buffers[0].sound,c.duration=c.sound.getData().get_duration(),h=this.driver.getPlayedSampleCount(f.handle),0>h&&(h=0),c.set_position(f.start/this.targetRate+h/f.buffers[0].sampleRate),c.positionChanged=!1,f.buffers.length<oa.BUFFER_QUEUE_LENGTH&&(h=f.buffers[f.buffers.length-1],h.isEnd?0<c.queue.length?this.queueBuffer(f,c.queue[0],0)&&c.queue.shift():c.loop&&this.queueBuffer(f,h.sound,0):this.queueBuffer(f,h.sound,h.start+h.samples)))}for(c=
this.channels;null!=c;)c.calcAudibleVolume(this.now),c.isLoading&&!c.sound.getData().isLoading()&&(c.isLoading=!1),c.isVirtual=this.suspended||c.pause||c.mute||c.channelGroup.mute||c.allowVirtual&&c.audibleVolume<oa.VIRTUAL_VOLUME_THRESHOLD||c.isLoading,c=c.next;var l=this.channels,m=M(this,this.sortChannel);if(null==l)a=null;else{for(b=1;;){k=l;c=l=null;for(g=0;null!=k;){++g;f=k;e=d=0;for(a=b;e<a&&(e++,++d,f=f.next,null!=f););for(a=b;0<d||0<a&&null!=f;)0==d?(h=f,f=f.next,--a):0==a||null==f||0>=m(k,
f)?(h=k,k=k.next,--d):(h=f,f=f.next,--a),null!=c?c.next=h:l=h,c=h;k=f}c.next=null;if(1>=g)break;b*=2}a=l}this.channels=a;a=0;for(c=this.channels;null!=c&&!c.isVirtual;)++a>this.sources.length?c.isVirtual=!0:0<=c.soundGroup.maxAudible&&(c.soundGroup.lastUpdate!=this.now&&(c.soundGroup.lastUpdate=this.now,c.soundGroup.numAudible=0),++c.soundGroup.numAudible>c.soundGroup.maxAudible&&(c.isVirtual=!0,--a)),c=c.next;e=0;for(a=this.sources;e<a.length;)f=a[e],++e,null!=f.channel&&f.channel.isVirtual&&this.releaseSource(f);
for(c=this.channels;null!=c;){if(null==c.source&&!c.isVirtual){f=null;e=0;for(a=this.sources;e<a.length;)if(h=a[e],++e,null==h.channel){f=h;break}if(null==f)throw u.thrown("could not get a source");f.channel=c;c.source=f;this.checkTargetFormat(c.sound.getData(),c.soundGroup.mono);f.start=Math.floor(c.position*this.targetRate);0>f.start&&(f.start=0);this.queueBuffer(f,c.sound,f.start);c.positionChanged=!1}c=c.next}k=null;d=this.hasMasterVolume?1:this.masterVolume;e=0;for(a=this.sources;e<a.length;)if(f=
a[e],++e,c=f.channel,null!=c){h=c.currentVolume*d;f.volume!=h&&(0>h&&(h=0),f.volume=h,this.driver.setSourceVolume(f.handle,h));f.playing||(this.driver.playSource(f.handle),f.playing=!0);for(g=c.bindedEffects.length;0<=--g;)h=c.bindedEffects[g],0>c.effects.indexOf(h)&&0>c.channelGroup.effects.indexOf(h)&&this.unbindEffect(c,f,h);g=0;for(b=c.channelGroup.effects;g<b.length;)h=b[g],++g,0>c.bindedEffects.indexOf(h)&&this.bindEffect(c,f,h);h=0;for(g=c.effects;h<g.length;)b=g[h],++h,0>c.bindedEffects.indexOf(b)&&
this.bindEffect(c,f,b);f=0;for(c=c.bindedEffects;f<c.length;)h=c[f],++f,k=oa.regEffect(k,h)}l=k;m=M(this,this.sortEffect);if(null==l)k=null;else{for(b=1;;){k=l;c=l=null;for(g=0;null!=k;){++g;f=k;e=d=0;for(a=b;e<a&&(e++,++d,f=f.next,null!=f););for(a=b;0<d||0<a&&null!=f;)0==d?(h=f,f=f.next,--a):0==a||null==f||0>=m(k,f)?(h=k,k=k.next,--d):(h=f,f=f.next,--a),null!=c?c.next=h:l=h,c=h;k=f}c.next=null;if(1>=g)break;b*=2}k=l}for(h=k;null!=h;)h.driver.update(h),h=h.next;e=0;for(a=this.sources;e<a.length;)if(f=
a[e],++e,c=f.channel,null!=c)for(g=0,b=c.bindedEffects;g<b.length;)h=b[g],++g,h.driver.apply(h,f.handle);e=0;for(a=this.effectGC;e<a.length;)if(h=a[e],++e,this.now-h.lastStamp>h.retainTime){h.driver.release();D.remove(this.effectGC,h);break}this.updateVirtualChannels(this.now);a=this.listener.direction;e=a.x*a.x+a.y*a.y+a.z*a.z;e=1E-20>e?0:1/Math.sqrt(e);a.x*=e;a.y*=e;a.z*=e;a=this.listener.up;e=a.x*a.x+a.y*a.y+a.z*a.z;e=1E-20>e?0:1/Math.sqrt(e);a.x*=e;a.y*=e;a.z*=e;this.hasMasterVolume&&this.driver.setMasterVolume(this.masterVolume);
this.driver.setListenerParams(this.listener.position,this.listener.direction,this.listener.up,this.listener.velocity);this.driver.update();if(this.soundBufferCount>=oa.SOUND_BUFFER_CACHE_SIZE)for(c=D.now()/1E3,g=0;g<this.soundBufferKeys.length;)e=this.soundBufferKeys[g],h=this.soundBufferMap.h[e],++g,0<h.refs||h.lastStop+60>c||(a=this.soundBufferMap,Object.prototype.hasOwnProperty.call(a.h,e)&&delete a.h[e],D.remove(this.soundBufferKeys,e),--g,h.dispose(),--this.soundBufferCount)}},progressiveDecodeBuffer:function(a,
b,c){var d=b.getData(),e=Math.ceil(oa.STREAM_BUFFER_SAMPLE_COUNT/oa.BUFFER_STREAM_SPLIT);if(a.streamStart!=c||a.streamSound!=b)a.streamSound=b,a.streamStart=c,a.streamPos=c;b=c+oa.STREAM_BUFFER_SAMPLE_COUNT;if(a.streamPos==b)return!0;var f=d.getBytesPerSample(),g=oa.STREAM_BUFFER_SAMPLE_COUNT*f;if(null==a.streamBuffer||a.streamBuffer.length<g)a.streamBuffer=new S(new ArrayBuffer(g)),a.streamPos=c;g=b-a.streamPos;g>e&&(g=e);d.decode(a.streamBuffer,(a.streamPos-c)*f,a.streamPos,g);a.streamPos+=g;return a.streamPos==
b},queueBuffer:function(a,b,c){var d=b.getData(),e=a.channel.soundGroup;if(d.get_duration()<=oa.STREAM_DURATION)b=this.getSoundBuffer(b,e),this.driver.queueBuffer(a.handle,b.handle,c,!0);else{if(0<a.buffers.length&&1<oa.BUFFER_STREAM_SPLIT&&!this.progressiveDecodeBuffer(a,b,c))return!1;b=this.getStreamBuffer(a,b,e,c);this.driver.queueBuffer(a.handle,b.handle,0,b.isEnd)}a.buffers.push(b);return!0},unqueueBuffer:function(a){var b=a.buffers.shift();if(null==b)return null;this.driver.unqueueBuffer(a.handle,
b.handle);b.isStream?this.freeStreamBuffers.unshift(b):0==--b.refs&&(b.lastStop=D.now()/1E3);return b},bindEffect:function(a,b,c){0!=c.refs||D.remove(this.effectGC,c)||c.driver.acquire();++c.refs;c.driver.bind(c,b.handle);a.bindedEffects.push(c)},unbindEffect:function(a,b,c){c.driver.unbind(c,b.handle);D.remove(a.bindedEffects,c);0==--c.refs&&(c.lastStamp=this.now,this.effectGC.push(c))},releaseSource:function(a){if(null!=a.channel){for(var b=0,c=a.channel.bindedEffects.slice();b<c.length;){var d=
c[b];++b;this.unbindEffect(a.channel,a,d)}a.channel.bindedEffects=[];a.channel.source=null;a.channel=null}a.playing&&(a.playing=!1,this.driver.stopSource(a.handle),a.volume=-1);for(;0<a.buffers.length;)this.unqueueBuffer(a)},checkTargetFormat:function(a,b){null==b&&(b=!1);this.targetRate=a.samplingRate;this.targetChannels=b||1==a.channels?1:2;switch(a.sampleFormat._hx_index){case 0:var c=Nc.UI8;break;case 1:c=Nc.I16;break;case 2:c=Nc.F32}this.targetFormat=c;return this.targetChannels==a.channels&&
this.targetFormat==a.sampleFormat?this.targetRate==a.samplingRate:!1},getSoundBuffer:function(a,b){var c=this,d=a.getData(),e=b.mono;b=a.entry.get_path();e&&1!=d.channels&&(b+="mono");var f=this.soundBufferMap.h[b];null==f&&(f=new Lh(this.driver),f.isStream=!1,f.isEnd=!0,f.sound=a,d.load(function(){c.fillSoundBuffer(f,d,e)}),this.soundBufferMap.h[b]=f,this.soundBufferKeys.push(b),++this.soundBufferCount);++f.refs;return f},fillSoundBuffer:function(a,b,c){null==c&&(c=!1);this.checkTargetFormat(b,c)||
(b=b.resample(this.targetRate,this.targetFormat,this.targetChannels));c=b.samples*b.getBytesPerSample();var d=this.getTmpBytes(c);b.decode(d,0,0,b.samples);this.driver.setBufferData(a.handle,d,c,this.targetFormat,this.targetChannels,this.targetRate);a.sampleRate=this.targetRate;a.samples=b.samples},getStreamBuffer:function(a,b,c,d){var e=b.getData(),f=this.freeStreamBuffers.shift();null==f&&(f=new Lh(this.driver),f.isStream=!0);var g=oa.STREAM_BUFFER_SAMPLE_COUNT;d+g>=e.samples?(g=e.samples-d,f.isEnd=
!0):f.isEnd=!1;f.sound=b;f.samples=g;f.start=d;var h=g*e.getBytesPerSample();if(a.streamSound==b&&a.streamStart==d){for(;!this.progressiveDecodeBuffer(a,b,d););a=a.streamBuffer}else a=this.getTmpBytes(h),e.decode(a,0,d,g);if(!this.checkTargetFormat(e,c.mono)){h=Math.ceil(this.targetRate/e.samplingRate*g)*this.targetChannels;switch(this.targetFormat._hx_index){case 0:var k=1;break;case 1:k=2;break;case 2:k=4}h*=k;k=this.getResampleBytes(h);e.resampleBuffer(k,0,a,0,this.targetRate,this.targetFormat,
this.targetChannels,g);a=k}this.driver.setBufferData(f.handle,a,h,this.targetFormat,this.targetChannels,this.targetRate);f.sampleRate=this.targetRate;return f},sortChannel:function(a,b){return a.isVirtual!=b.isVirtual?a.isVirtual?1:-1:a.channelGroup.priority!=b.channelGroup.priority?a.channelGroup.priority<b.channelGroup.priority?1:-1:a.priority!=b.priority?a.priority<b.priority?1:-1:a.audibleVolume!=b.audibleVolume?a.audibleVolume<b.audibleVolume?1:-1:a.id<b.id?1:-1},sortEffect:function(a,b){return b.priority-
a.priority},releaseChannel:function(a){if(null!=a.manager){if(this.channels==a)this.channels=a.next;else{for(var b=this.channels;b.next!=a;)b=b.next;b.next=a.next}b=0;for(var c=a.effects;b<c.length;){var d=c[b];++b;a.removeEffect(d)}null!=a.source&&this.releaseSource(a.source);a.next=null;a.manager=null;a.effects=null;a.bindedEffects=null;a.currentFade=null;b=a.sound;null!=b&&b.channel==a&&(b.channel=null)}},__class__:oa};var Ih=function(a){var b=(new Yh(new Zb(a))).read();this.samples=b.sampleCount;
for(var c=b.frames[0].data,d=-1,e=0,f=c.length-24;e<f;){var g=e++;if(76==c.b[g]&&65==c.b[g+1]&&77==c.b[g+2]&&69==c.b[g+3]){d=g;break}}0<=d&&(c=c.b[d+21]<<16|c.b[d+22]<<8|c.b[d+23],this.samples-=(c>>12)+(c&4095)+1152);b=b.frames[0].header;this.sampleFormat=Nc.F32;this.samplingRate=Za.srEnum2Num(b.samplingRate);this.channels=b.channelMode==Sc.Mono?1:2;b=ca.get();null!=b&&(b.decodeAudioData(a.b.bufferValue,M(this,this.processBuffer)),a=b.sampleRate|0,this.samples=Math.ceil(this.samples*a/this.samplingRate),
this.samplingRate=a)};z["hxd.snd.Mp3Data"]=Ih;Ih.__name__="hxd.snd.Mp3Data";Ih.__super__=te;Ih.prototype=J(te.prototype,{isLoading:function(){return null==this.buffer},load:function(a){null!=this.buffer?a():this.onEnd=a},processBuffer:function(a){var b=a.getChannelData(0);this.samples=a.length;if(1==this.channels)this.buffer=S.ofData(b.buffer);else{var c=2>a.numberOfChannels?b:a.getChannelData(1),d=new Float32Array(2*b.length),e=0,f=0;for(a=a.length;f<a;){var g=f++;d[e++]=b[g];d[e++]=c[g]}this.buffer=
S.ofData(d.buffer);null!=this.onEnd&&(this.onEnd(),this.onEnd=null)}},decodeBuffer:function(a,b,c,d){null==this.buffer?a.fill(b,4*d*this.channels,0):a.blit(b,this.buffer,4*c*this.channels,4*d*this.channels)},__class__:Ih});var gj=function(a){this.name=a;this.maxAudible=-1;this.volume=1;this.mono=!1};z["hxd.snd.SoundGroup"]=gj;gj.__name__="hxd.snd.SoundGroup";gj.prototype={__class__:gj};var Fg=function(a){null!=a&&this.init((new ei(new Zb(a))).read())};z["hxd.snd.WavData"]=Fg;Fg.__name__="hxd.snd.WavData";
Fg.__super__=te;Fg.prototype=J(te.prototype,{init:function(a){var b=a.header;this.samplingRate=b.samplingRate;this.channels=b.channels;switch(b.bitsPerSample){case 8:b=Nc.UI8;break;case 16:b=Nc.I16;break;default:throw u.thrown("Unsupported WAV "+b.bitsPerSample+" bits");}this.sampleFormat=b;this.rawData=a.data;this.samples=this.rawData.length/this.getBytesPerSample()|0},decodeBuffer:function(a,b,c,d){var e=this.getBytesPerSample();a.blit(b,this.rawData,c*e,d*e)},__class__:Fg});var hj=function(){Ec.call(this,
"lowpass");this.priority=100;this.gainHF=1};z["hxd.snd.effect.LowPass"]=hj;hj.__name__="hxd.snd.effect.LowPass";hj.__super__=Ec;hj.prototype=J(Ec.prototype,{__class__:hj});var ij=function(a){null==a&&(a=1);Ec.call(this,"pitch");this.value=a};z["hxd.snd.effect.Pitch"]=ij;ij.__name__="hxd.snd.effect.Pitch";ij.__super__=Ec;ij.prototype=J(Ec.prototype,{__class__:ij});var jj=function(){Ec.call(this,"spatialization");this.position=new I(0,0,0);this.velocity=new I(0,0,0);this.direction=new I(0,0,0);this.rollOffFactor=
this.referenceDistance=1};z["hxd.snd.effect.Spatialization"]=jj;jj.__name__="hxd.snd.effect.Spatialization";jj.__super__=Ec;jj.prototype=J(Ec.prototype,{getVolumeModifier:function(){if(null==this.fadeDistance)return 1;var a=oa.get().listener.position,b=this.position,c=b.x-a.x,d=b.y-a.y;a=b.z-a.z;c=Math.sqrt(c*c+d*d+a*a);c=null!=this.maxDistance?c-this.maxDistance:c-this.referenceDistance;c=1-c/this.fadeDistance;1<c&&(c=1);0>c&&(c=0);return c},applyAudibleVolumeModifier:function(a){var b=oa.get().listener.position,
c=this.position;var d=c.x-b.x;var e=c.y-b.y;b=c.z-b.z;e=Math.sqrt(d*d+e*e+b*b);d=this.referenceDistance;e<d&&(e=d);null!=this.maxDistance&&(d=this.maxDistance,e>d&&(e=d));return this.referenceDistance/(this.referenceDistance+this.rollOffFactor*(e-this.referenceDistance))*a},__class__:jj});var kj=function(){};z["hxd.snd.webaudio.BufferHandle"]=kj;kj.__name__="hxd.snd.webaudio.BufferHandle";kj.prototype={__class__:kj};var lj=function(){this.buffers=[];this.sampleOffset=0;this.pitch=1;this.firstPlay=
!0};z["hxd.snd.webaudio.SourceHandle"]=lj;lj.__name__="hxd.snd.webaudio.SourceHandle";lj.prototype={updateDestination:function(){this.destination=this.gain;null!=this.lowPass&&(this.lowPass.connect(this.destination),this.destination=this.lowPass);null!=this.panner&&(this.panner.connect(this.destination),this.destination=this.panner);this.gain.connect(ca.destination);for(var a=0,b=this.buffers;a<b.length;){var c=b[a];++a;null!=c.node&&c.restart(this)}},applyPitch:function(){for(var a=0,b=0,c=this.buffers;b<
c.length;){var d=c[b];++b;a=d.readjust(a,this)}},__class__:lj};var Nh=function(){};z["hxd.snd.webaudio.BufferPlayback"]=Nh;Nh.__name__="hxd.snd.webaudio.BufferPlayback";Nh.prototype={get_currentSample:function(){if(this.consumed)return this.buffer.samples;if(null==this.node||!this.dirty||this.node.context.currentTime<this.lastTime)return 0;this.lastSamples+=Math.floor((this.node.context.currentTime-this.lastTime)*this.buffer.inst.sampleRate*this.node.playbackRate.value);this.lastTime=this.node.context.currentTime;
return this.lastSamples},set:function(a,b){this.buffer=a;this.offset=isNaN(b)?0:b;this.consumed=this.dirty=!1;this.ends=this.starts=0},start:function(a,b,c){this.dirty=!0;this.consumed=!1;null!=this.node&&this.stop();if(b.firstPlay&&10<this.buffer.samples){b.firstPlay=!1;for(var d=[],e=0,f=this.buffer.inst.numberOfChannels;e<f;){var g=e++;d.push(this.buffer.inst.getChannelData(g))}for(f=e=0;10>e;){for(g=0;g<d.length;)d[g][e]*=f,++g;++e;f+=.1;1<f&&(f=1)}}this.node=a.createBufferSource();this.node.buffer=
this.buffer.inst;this.node.addEventListener("ended",M(this,this.onBufferConsumed));this.node.connect(b.destination);this.node.playbackRate.value=b.pitch;this.node.start(c,this.offset);this.lastSamples=0;this.starts=this.lastTime=c;return this.ends=c+(this.buffer.inst.duration-this.offset)/b.pitch},readjust:function(a,b){if(this.consumed||null==this.node)return this.ends;var c=b.driver.ctx,d=c.currentTime;this.node.playbackRate.setValueAtTime(b.pitch,d);var e=d-this.starts;if(0>e)return this.start(c,
b,0==a?d:a);this.starts=d-e/b.pitch;return this.ends=this.starts+(this.buffer.inst.duration-this.offset)/b.pitch},restart:function(a){if(!this.consumed&&null!=this.node){var b=ca.get();b.currentTime>this.starts?(this.offset+=(b.currentTime-this.starts)*a.pitch,this.start(b,a,b.currentTime)):this.start(b,a,this.starts)}},stop:function(a){null==a&&(a=!0);null!=this.node&&(this.node.removeEventListener("ended",M(this,this.onBufferConsumed)),a?this.node.disconnect():this.node.stop(),this.node=null)},
onBufferConsumed:function(a){this.node.removeEventListener("ended",M(this,this.onBufferConsumed));this.node.disconnect();this.node=null;this.consumed=!0},clear:function(){this.node=this.buffer=null},__class__:Nh};var ca=function(){};z["hxd.snd.webaudio.Context"]=ca;ca.__name__="hxd.snd.webaudio.Context";ca.get=function(){if(null==ca.ctx){try{ca.ctx=new AudioContext}catch(a){try{ca.ctx=new window.webkitAudioContext}catch(b){ca.ctx=null}}if(null==ca.ctx)throw u.thrown("WebAudio API not available in this browser!");
"suspended"==ca.ctx.state&&ca.waitForPageInput();ca.ctx.addEventListener("statechange",function(a){"suspended"==ca.ctx.state&&ca.waitForPageInput()});ca.bufferPool=[];ca.gainPool=[];ca.masterGain=ca.ctx.createGain();ca.masterGain.connect(ca.ctx.destination);ca.destination=ca.masterGain}return ca.ctx};ca.getGain=function(){return 0!=ca.gainPool.length?ca.gainPool.pop():ca.ctx.createGain()};ca.putGain=function(a){ca.gainPool.push(a);a.gain.value=1};ca.waitForPageInput=function(){ca.suspended||(window.document.addEventListener("click",
ca.resumeContext),window.document.addEventListener("keydown",ca.resumeContext),window.document.body.addEventListener("keydown",ca.resumeContext),window.document.body.addEventListener("touchend",ca.resumeContext),ca.suspended=!0)};ca.resumeContext=function(a){ca.suspended&&(null!=ca.ctx&&ca.ctx.resume(),window.document.removeEventListener("click",ca.resumeContext),window.document.removeEventListener("keydown",ca.resumeContext),window.document.body.removeEventListener("keydown",ca.resumeContext),window.document.body.removeEventListener("touchend",
ca.resumeContext),ca.suspended=!1)};ca.getBuffer=function(a,b,c){for(var d,e=0,f=ca.bufferPool;e<f.length;)if(d=f[e],++e,d.channels==a&&d.samples==b&&d.rate==c)return 0!=d.pool.length?d.pool.pop():ca.ctx.createBuffer(a,b,c);d=new mj(a,b,c);ca.bufferPool.push(d);return ca.ctx.createBuffer(a,b,c)};ca.putBuffer=function(a){for(var b=a.sampleRate|0,c=0,d=ca.bufferPool;c<d.length;){var e=d[c];++c;if(e.channels==a.numberOfChannels&&e.samples==a.length&&e.rate==b){e.pool.push(a);break}}};var mj=function(a,
b,c){this.pool=[];this.channels=a;this.samples=b;this.rate=c};z["hxd.snd.webaudio._Context.BufferPool"]=mj;mj.__name__="hxd.snd.webaudio._Context.BufferPool";mj.prototype={__class__:mj};var Mh=function(){this.playbackPool=[];this.ctx=ca.get()};z["hxd.snd.webaudio.Driver"]=Mh;Mh.__name__="hxd.snd.webaudio.Driver";Mh.__interfaces__=[Kh];Mh.prototype={getBuffer:function(a,b,c){return ca.getBuffer(a,b,c)},putBuffer:function(a){ca.putBuffer(a)},getGain:function(){return 0!=ca.gainPool.length?ca.gainPool.pop():
ca.ctx.createGain()},putGain:function(a){ca.gainPool.push(a);a.gain.value=1},hasFeature:function(a){return!0},setMasterVolume:function(a){ca.masterGain.gain.value=a},setListenerParams:function(a,b,c,d){this.ctx.listener.setPosition(-a.x,a.y,a.z);this.ctx.listener.setOrientation(-b.x,b.y,b.z,-c.x,c.y,c.z)},createSource:function(){var a=new lj;a.driver=this;a.gain=0!=ca.gainPool.length?ca.gainPool.pop():ca.ctx.createGain();a.updateDestination();return a},playSource:function(a){if(!a.playing&&(a.playing=
!0,0!=a.buffers.length))for(var b=this.ctx.currentTime,c=0,d=a.buffers;c<d.length;){var e=d[c];++c;e.consumed||(b=e.start(this.ctx,a,b))}},stopSource:function(a){a.playing=!1;a.sampleOffset=0},setSourceVolume:function(a,b){a.gain.gain.value=b},destroySource:function(a){this.stopSource(a);a.gain.disconnect();a.driver=null;var b=a.gain;ca.gainPool.push(b);b.gain.value=1;a.gain=null;b=0;for(var c=a.buffers;b<c.length;){var d=c[b];++b;d.stop();d.clear();this.playbackPool.push(d)}a.buffers=[]},createBuffer:function(){var a=
new kj;a.samples=0;return a},setBufferData:function(a,b,c,d,e,f){switch(d._hx_index){case 0:var g=1;break;case 1:g=2;break;case 2:g=4}c=c/g/e|0;a.samples=c;if(0!=c){if(null==a.inst)a.inst=ca.getBuffer(e,c,f);else if(a.inst.sampleRate!=f||a.inst.numberOfChannels!=e||a.inst.length!=c)ca.putBuffer(a.inst),a.inst=ca.getBuffer(e,c,f);switch(d._hx_index){case 0:var h=new Uint8Array(b.b.bufferValue);if(1==e)for(e=a.inst.getChannelData(0),a=0,d=c;a<d;)c=a++,e[c]=(h[c]-128)/128;else for(b=a.inst.getChannelData(0),
g=a.inst.getChannelData(1),a=f=0,d=c;a<d;)c=a++,b[c]=(h[f]-128)/128,g[c]=(h[f+1]-128)/128,f+=e;break;case 1:h=new Int16Array(b.b.bufferValue);if(1==e)for(e=a.inst.getChannelData(0),a=0,d=c;a<d;)c=a++,e[c]=h[c]/32768;else for(b=a.inst.getChannelData(0),g=a.inst.getChannelData(1),a=f=0,d=c;a<d;)c=a++,b[c]=h[f]/32768,g[c]=h[f+1]/32768,f+=e;break;case 2:if(h=new Float32Array(b.b.bufferValue),1==e)for(e=a.inst.getChannelData(0),a=0,d=c;a<d;)c=a++,e[c]=h[c];else for(b=a.inst.getChannelData(0),g=a.inst.getChannelData(1),
a=f=0,d=c;a<d;)c=a++,b[c]=h[f],g[c]=h[f+1],f+=e}}},destroyBuffer:function(a){null!=a.inst&&ca.putBuffer(a.inst);a.inst=null},queueBuffer:function(a,b,c,d){var e=0!=this.playbackPool.length?this.playbackPool.pop():new Nh;null!=b.inst&&(e.set(b,c/b.inst.length*b.inst.duration),b.isEnd=d,a.buffers.push(e),a.playing&&(1!=a.buffers.length?(c=a.buffers[a.buffers.length-2].ends,b=this.ctx,isFinite(c)?(d=this.ctx.currentTime,c=c<d?d:c):c=this.ctx.currentTime,e.start(b,a,c)):e.start(this.ctx,a,this.ctx.currentTime)))},
unqueueBuffer:function(a,b){for(;0<a.buffers.length;){var c=a.buffers[0];if(c.buffer==b){a.buffers.splice(0,1);c.stop(!b.isEnd);c.clear();this.playbackPool.push(c);break}}a.sampleOffset=b.isEnd||!a.playing?0:a.sampleOffset+b.samples},getProcessedBuffers:function(a){var b=0,c=0;for(a=a.buffers;c<a.length;){var d=a[c];++c;d.consumed&&++b}return b},getPlayedSampleCount:function(a){for(var b=0,c=null,d=0,e=a.buffers;d<e.length;){var f=e[d];++d;if(f.consumed)b+=f.buffer.samples;else if(f.dirty){c=f;break}}return null!=
c?a.sampleOffset+b+c.get_currentSample():a.sampleOffset+b},update:function(){},dispose:function(){},getEffectDriver:function(a){switch(a){case "lowpass":return new Oh;case "pitch":return new Ph;case "spatialization":return new Qh;default:return new ue}},get_masterGain:function(){return ca.masterGain},set_destination:function(a){return ca.destination=a},get_destination:function(){return ca.destination},__class__:Mh};var Oh=function(){this.pool=[]};z["hxd.snd.webaudio.LowPassDriver"]=Oh;Oh.__name__=
"hxd.snd.webaudio.LowPassDriver";Oh.__super__=ue;Oh.prototype=J(ue.prototype,{get:function(a){if(0!=this.pool.length)return this.pool.pop();a=a.createBiquadFilter();a.type="lowpass";return a},bind:function(a,b){b.lowPass=this.get(b.driver.ctx);b.updateDestination();this.apply(a,b)},apply:function(a,b){var c=b.driver.ctx.sampleRate/2;b.lowPass.frequency.value=c*Math.pow(2,Math.log(c/40)/Math.LN2*(a.gainHF-1))},unbind:function(a,b){this.pool.push(b.lowPass);b.lowPass.disconnect();b.lowPass=null;null!=
b.driver&&b.updateDestination()},__class__:Oh});var Ph=function(){};z["hxd.snd.webaudio.PitchDriver"]=Ph;Ph.__name__="hxd.snd.webaudio.PitchDriver";Ph.__super__=ue;Ph.prototype=J(ue.prototype,{apply:function(a,b){b.pitch!=a.value&&(b.pitch=a.value,b.applyPitch())},unbind:function(a,b){b.pitch=1;b.applyPitch()},__class__:Ph});var Qh=function(){this.pool=[]};z["hxd.snd.webaudio.SpatializationDriver"]=Qh;Qh.__name__="hxd.snd.webaudio.SpatializationDriver";Qh.__super__=ue;Qh.prototype=J(ue.prototype,
{get:function(a){return 0!=this.pool.length?this.pool.pop():a.createPanner()},bind:function(a,b){b.panner=this.get(b.driver.ctx);b.updateDestination();this.apply(a,b)},apply:function(a,b){b.panner.setPosition(-a.position.x,a.position.y,a.position.z);b.panner.setOrientation(-a.direction.x,a.direction.y,a.direction.z);b.panner.rolloffFactor=a.rollOffFactor;b.panner.refDistance=a.referenceDistance;b.panner.maxDistance=null==a.maxDistance?3.40282347E38:a.maxDistance},unbind:function(a,b){this.pool.push(b.panner);
b.panner.disconnect();b.panner=null;null!=b.driver&&b.updateDestination()},__class__:Qh});var vb=L["hxsl.BufferKind"]={__ename__:!0,__constructs__:null,Uniform:{_hx_name:"Uniform",_hx_index:0,__enum__:"hxsl.BufferKind",toString:v},Storage:{_hx_name:"Storage",_hx_index:1,__enum__:"hxsl.BufferKind",toString:v},RW:{_hx_name:"RW",_hx_index:2,__enum__:"hxsl.BufferKind",toString:v},Partial:{_hx_name:"Partial",_hx_index:3,__enum__:"hxsl.BufferKind",toString:v},StoragePartial:{_hx_name:"StoragePartial",_hx_index:4,
__enum__:"hxsl.BufferKind",toString:v},RWPartial:{_hx_name:"RWPartial",_hx_index:5,__enum__:"hxsl.BufferKind",toString:v}};vb.__constructs__=[vb.Uniform,vb.Storage,vb.RW,vb.Partial,vb.StoragePartial,vb.RWPartial];vb.__empty_constructs__=[vb.Uniform,vb.Storage,vb.RW,vb.Partial,vb.StoragePartial,vb.RWPartial];var tb=L["hxsl.TexDimension"]={__ename__:!0,__constructs__:null,T1D:{_hx_name:"T1D",_hx_index:0,__enum__:"hxsl.TexDimension",toString:v},T2D:{_hx_name:"T2D",_hx_index:1,__enum__:"hxsl.TexDimension",
toString:v},T3D:{_hx_name:"T3D",_hx_index:2,__enum__:"hxsl.TexDimension",toString:v},TCube:{_hx_name:"TCube",_hx_index:3,__enum__:"hxsl.TexDimension",toString:v}};tb.__constructs__=[tb.T1D,tb.T2D,tb.T3D,tb.TCube];tb.__empty_constructs__=[tb.T1D,tb.T2D,tb.T3D,tb.TCube];var x=L["hxsl.Type"]={__ename__:!0,__constructs__:null,TVoid:{_hx_name:"TVoid",_hx_index:0,__enum__:"hxsl.Type",toString:v},TInt:{_hx_name:"TInt",_hx_index:1,__enum__:"hxsl.Type",toString:v},TBool:{_hx_name:"TBool",_hx_index:2,__enum__:"hxsl.Type",
toString:v},TFloat:{_hx_name:"TFloat",_hx_index:3,__enum__:"hxsl.Type",toString:v},TString:{_hx_name:"TString",_hx_index:4,__enum__:"hxsl.Type",toString:v},TVec:(A=function(a,b){return{_hx_index:5,size:a,t:b,__enum__:"hxsl.Type",toString:v}},A._hx_name="TVec",A.__params__=["size","t"],A),TMat3:{_hx_name:"TMat3",_hx_index:6,__enum__:"hxsl.Type",toString:v},TMat4:{_hx_name:"TMat4",_hx_index:7,__enum__:"hxsl.Type",toString:v},TMat3x4:{_hx_name:"TMat3x4",_hx_index:8,__enum__:"hxsl.Type",toString:v},TBytes:(A=
function(a){return{_hx_index:9,size:a,__enum__:"hxsl.Type",toString:v}},A._hx_name="TBytes",A.__params__=["size"],A),TSampler:(A=function(a,b){return{_hx_index:10,dim:a,isArray:b,__enum__:"hxsl.Type",toString:v}},A._hx_name="TSampler",A.__params__=["dim","isArray"],A),TRWTexture:(A=function(a,b,c){return{_hx_index:11,dim:a,isArray:b,channels:c,__enum__:"hxsl.Type",toString:v}},A._hx_name="TRWTexture",A.__params__=["dim","isArray","channels"],A),TMat2:{_hx_name:"TMat2",_hx_index:12,__enum__:"hxsl.Type",
toString:v},TStruct:(A=function(a){return{_hx_index:13,vl:a,__enum__:"hxsl.Type",toString:v}},A._hx_name="TStruct",A.__params__=["vl"],A),TFun:(A=function(a){return{_hx_index:14,variants:a,__enum__:"hxsl.Type",toString:v}},A._hx_name="TFun",A.__params__=["variants"],A),TArray:(A=function(a,b){return{_hx_index:15,t:a,size:b,__enum__:"hxsl.Type",toString:v}},A._hx_name="TArray",A.__params__=["t","size"],A),TBuffer:(A=function(a,b,c){return{_hx_index:16,t:a,size:b,kind:c,__enum__:"hxsl.Type",toString:v}},
A._hx_name="TBuffer",A.__params__=["t","size","kind"],A),TChannel:(A=function(a){return{_hx_index:17,size:a,__enum__:"hxsl.Type",toString:v}},A._hx_name="TChannel",A.__params__=["size"],A)};x.__constructs__=[x.TVoid,x.TInt,x.TBool,x.TFloat,x.TString,x.TVec,x.TMat3,x.TMat4,x.TMat3x4,x.TBytes,x.TSampler,x.TRWTexture,x.TMat2,x.TStruct,x.TFun,x.TArray,x.TBuffer,x.TChannel];x.__empty_constructs__=[x.TVoid,x.TInt,x.TBool,x.TFloat,x.TString,x.TMat3,x.TMat4,x.TMat3x4,x.TMat2];var Q=L["hxsl.VecType"]={__ename__:!0,
__constructs__:null,VInt:{_hx_name:"VInt",_hx_index:0,__enum__:"hxsl.VecType",toString:v},VFloat:{_hx_name:"VFloat",_hx_index:1,__enum__:"hxsl.VecType",toString:v},VBool:{_hx_name:"VBool",_hx_index:2,__enum__:"hxsl.VecType",toString:v}};Q.__constructs__=[Q.VInt,Q.VFloat,Q.VBool];Q.__empty_constructs__=[Q.VInt,Q.VFloat,Q.VBool];var Ya=L["hxsl.SizeDecl"]={__ename__:!0,__constructs__:null,SConst:(A=function(a){return{_hx_index:0,v:a,__enum__:"hxsl.SizeDecl",toString:v}},A._hx_name="SConst",A.__params__=
["v"],A),SVar:(A=function(a){return{_hx_index:1,v:a,__enum__:"hxsl.SizeDecl",toString:v}},A._hx_name="SVar",A.__params__=["v"],A)};Ya.__constructs__=[Ya.SConst,Ya.SVar];Ya.__empty_constructs__=[];var lb=function(a,b){this.msg=a;this.pos=b};z["hxsl.Error"]=lb;lb.__name__="hxsl.Error";lb.t=function(a,b){throw u.thrown(new lb(a,b));};lb.prototype={toString:function(){return"Error("+this.msg+")@"+w.string(this.pos)},__class__:lb};var P=L["hxsl.VarKind"]={__ename__:!0,__constructs__:null,Global:{_hx_name:"Global",
_hx_index:0,__enum__:"hxsl.VarKind",toString:v},Input:{_hx_name:"Input",_hx_index:1,__enum__:"hxsl.VarKind",toString:v},Param:{_hx_name:"Param",_hx_index:2,__enum__:"hxsl.VarKind",toString:v},Var:{_hx_name:"Var",_hx_index:3,__enum__:"hxsl.VarKind",toString:v},Local:{_hx_name:"Local",_hx_index:4,__enum__:"hxsl.VarKind",toString:v},Output:{_hx_name:"Output",_hx_index:5,__enum__:"hxsl.VarKind",toString:v},Function:{_hx_name:"Function",_hx_index:6,__enum__:"hxsl.VarKind",toString:v}};P.__constructs__=
[P.Global,P.Input,P.Param,P.Var,P.Local,P.Output,P.Function];P.__empty_constructs__=[P.Global,P.Input,P.Param,P.Var,P.Local,P.Output,P.Function];var ra=L["hxsl.VarQualifier"]={__ename__:!0,__constructs__:null,Const:(A=function(a){return{_hx_index:0,max:a,__enum__:"hxsl.VarQualifier",toString:v}},A._hx_name="Const",A.__params__=["max"],A),Private:{_hx_name:"Private",_hx_index:1,__enum__:"hxsl.VarQualifier",toString:v},Nullable:{_hx_name:"Nullable",_hx_index:2,__enum__:"hxsl.VarQualifier",toString:v},
PerObject:{_hx_name:"PerObject",_hx_index:3,__enum__:"hxsl.VarQualifier",toString:v},Name:(A=function(a){return{_hx_index:4,n:a,__enum__:"hxsl.VarQualifier",toString:v}},A._hx_name="Name",A.__params__=["n"],A),Shared:{_hx_name:"Shared",_hx_index:5,__enum__:"hxsl.VarQualifier",toString:v},Precision:(A=function(a){return{_hx_index:6,p:a,__enum__:"hxsl.VarQualifier",toString:v}},A._hx_name="Precision",A.__params__=["p"],A),Range:(A=function(a,b){return{_hx_index:7,min:a,max:b,__enum__:"hxsl.VarQualifier",
toString:v}},A._hx_name="Range",A.__params__=["min","max"],A),Ignore:{_hx_name:"Ignore",_hx_index:8,__enum__:"hxsl.VarQualifier",toString:v},PerInstance:(A=function(a){return{_hx_index:9,v:a,__enum__:"hxsl.VarQualifier",toString:v}},A._hx_name="PerInstance",A.__params__=["v"],A),Doc:(A=function(a){return{_hx_index:10,s:a,__enum__:"hxsl.VarQualifier",toString:v}},A._hx_name="Doc",A.__params__=["s"],A),Borrow:(A=function(a){return{_hx_index:11,source:a,__enum__:"hxsl.VarQualifier",toString:v}},A._hx_name=
"Borrow",A.__params__=["source"],A),Sampler:(A=function(a){return{_hx_index:12,name:a,__enum__:"hxsl.VarQualifier",toString:v}},A._hx_name="Sampler",A.__params__=["name"],A),Final:{_hx_name:"Final",_hx_index:13,__enum__:"hxsl.VarQualifier",toString:v},Flat:{_hx_name:"Flat",_hx_index:14,__enum__:"hxsl.VarQualifier",toString:v}};ra.__constructs__=[ra.Const,ra.Private,ra.Nullable,ra.PerObject,ra.Name,ra.Shared,ra.Precision,ra.Range,ra.Ignore,ra.PerInstance,ra.Doc,ra.Borrow,ra.Sampler,ra.Final,ra.Flat];
ra.__empty_constructs__=[ra.Private,ra.Nullable,ra.PerObject,ra.Shared,ra.Ignore,ra.Final,ra.Flat];var Xe=L["hxsl.Prec"]={__ename__:!0,__constructs__:null,Low:{_hx_name:"Low",_hx_index:0,__enum__:"hxsl.Prec",toString:v},Medium:{_hx_name:"Medium",_hx_index:1,__enum__:"hxsl.Prec",toString:v},High:{_hx_name:"High",_hx_index:2,__enum__:"hxsl.Prec",toString:v}};Xe.__constructs__=[Xe.Low,Xe.Medium,Xe.High];Xe.__empty_constructs__=[Xe.Low,Xe.Medium,Xe.High];var K=L["hxsl.Const"]={__ename__:!0,__constructs__:null,
CNull:{_hx_name:"CNull",_hx_index:0,__enum__:"hxsl.Const",toString:v},CBool:(A=function(a){return{_hx_index:1,b:a,__enum__:"hxsl.Const",toString:v}},A._hx_name="CBool",A.__params__=["b"],A),CInt:(A=function(a){return{_hx_index:2,v:a,__enum__:"hxsl.Const",toString:v}},A._hx_name="CInt",A.__params__=["v"],A),CFloat:(A=function(a){return{_hx_index:3,v:a,__enum__:"hxsl.Const",toString:v}},A._hx_name="CFloat",A.__params__=["v"],A),CString:(A=function(a){return{_hx_index:4,v:a,__enum__:"hxsl.Const",toString:v}},
A._hx_name="CString",A.__params__=["v"],A)};K.__constructs__=[K.CNull,K.CBool,K.CInt,K.CFloat,K.CString];K.__empty_constructs__=[K.CNull];var qb=L["hxsl.ExprDef"]={__ename__:!0,__constructs__:null,EConst:(A=function(a){return{_hx_index:0,c:a,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EConst",A.__params__=["c"],A),EIdent:(A=function(a){return{_hx_index:1,i:a,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EIdent",A.__params__=["i"],A),EParenthesis:(A=function(a){return{_hx_index:2,e:a,__enum__:"hxsl.ExprDef",
toString:v}},A._hx_name="EParenthesis",A.__params__=["e"],A),EField:(A=function(a,b){return{_hx_index:3,e:a,f:b,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EField",A.__params__=["e","f"],A),EBinop:(A=function(a,b,c){return{_hx_index:4,op:a,e1:b,e2:c,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EBinop",A.__params__=["op","e1","e2"],A),EUnop:(A=function(a,b){return{_hx_index:5,op:a,e1:b,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EUnop",A.__params__=["op","e1"],A),ECall:(A=function(a,
b){return{_hx_index:6,e:a,args:b,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="ECall",A.__params__=["e","args"],A),EBlock:(A=function(a){return{_hx_index:7,el:a,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EBlock",A.__params__=["el"],A),EVars:(A=function(a){return{_hx_index:8,v:a,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EVars",A.__params__=["v"],A),EFunction:(A=function(a){return{_hx_index:9,f:a,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EFunction",A.__params__=["f"],A),EIf:(A=
function(a,b,c){return{_hx_index:10,econd:a,eif:b,eelse:c,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EIf",A.__params__=["econd","eif","eelse"],A),EDiscard:{_hx_name:"EDiscard",_hx_index:11,__enum__:"hxsl.ExprDef",toString:v},EFor:(A=function(a,b,c){return{_hx_index:12,v:a,loop:b,block:c,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EFor",A.__params__=["v","loop","block"],A),EReturn:(A=function(a){return{_hx_index:13,e:a,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EReturn",A.__params__=
["e"],A),EBreak:{_hx_name:"EBreak",_hx_index:14,__enum__:"hxsl.ExprDef",toString:v},EContinue:{_hx_name:"EContinue",_hx_index:15,__enum__:"hxsl.ExprDef",toString:v},EArray:(A=function(a,b){return{_hx_index:16,e:a,eindex:b,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EArray",A.__params__=["e","eindex"],A),EArrayDecl:(A=function(a){return{_hx_index:17,el:a,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EArrayDecl",A.__params__=["el"],A),ESwitch:(A=function(a,b,c){return{_hx_index:18,e:a,cases:b,
def:c,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="ESwitch",A.__params__=["e","cases","def"],A),EWhile:(A=function(a,b,c){return{_hx_index:19,cond:a,loop:b,normalWhile:c,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EWhile",A.__params__=["cond","loop","normalWhile"],A),EMeta:(A=function(a,b,c){return{_hx_index:20,name:a,args:b,e:c,__enum__:"hxsl.ExprDef",toString:v}},A._hx_name="EMeta",A.__params__=["name","args","e"],A)};qb.__constructs__=[qb.EConst,qb.EIdent,qb.EParenthesis,qb.EField,qb.EBinop,
qb.EUnop,qb.ECall,qb.EBlock,qb.EVars,qb.EFunction,qb.EIf,qb.EDiscard,qb.EFor,qb.EReturn,qb.EBreak,qb.EContinue,qb.EArray,qb.EArrayDecl,qb.ESwitch,qb.EWhile,qb.EMeta];qb.__empty_constructs__=[qb.EDiscard,qb.EBreak,qb.EContinue];var q=L["hxsl.TExprDef"]={__ename__:!0,__constructs__:null,TConst:(A=function(a){return{_hx_index:0,c:a,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TConst",A.__params__=["c"],A),TVar:(A=function(a){return{_hx_index:1,v:a,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name=
"TVar",A.__params__=["v"],A),TGlobal:(A=function(a){return{_hx_index:2,g:a,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TGlobal",A.__params__=["g"],A),TParenthesis:(A=function(a){return{_hx_index:3,e:a,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TParenthesis",A.__params__=["e"],A),TBlock:(A=function(a){return{_hx_index:4,el:a,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TBlock",A.__params__=["el"],A),TBinop:(A=function(a,b,c){return{_hx_index:5,op:a,e1:b,e2:c,__enum__:"hxsl.TExprDef",
toString:v}},A._hx_name="TBinop",A.__params__=["op","e1","e2"],A),TUnop:(A=function(a,b){return{_hx_index:6,op:a,e1:b,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TUnop",A.__params__=["op","e1"],A),TVarDecl:(A=function(a,b){return{_hx_index:7,v:a,init:b,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TVarDecl",A.__params__=["v","init"],A),TCall:(A=function(a,b){return{_hx_index:8,e:a,args:b,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TCall",A.__params__=["e","args"],A),TSwiz:(A=function(a,
b){return{_hx_index:9,e:a,regs:b,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TSwiz",A.__params__=["e","regs"],A),TIf:(A=function(a,b,c){return{_hx_index:10,econd:a,eif:b,eelse:c,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TIf",A.__params__=["econd","eif","eelse"],A),TDiscard:{_hx_name:"TDiscard",_hx_index:11,__enum__:"hxsl.TExprDef",toString:v},TReturn:(A=function(a){return{_hx_index:12,e:a,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TReturn",A.__params__=["e"],A),TFor:(A=function(a,
b,c){return{_hx_index:13,v:a,it:b,loop:c,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TFor",A.__params__=["v","it","loop"],A),TContinue:{_hx_name:"TContinue",_hx_index:14,__enum__:"hxsl.TExprDef",toString:v},TBreak:{_hx_name:"TBreak",_hx_index:15,__enum__:"hxsl.TExprDef",toString:v},TArray:(A=function(a,b){return{_hx_index:16,e:a,index:b,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TArray",A.__params__=["e","index"],A),TArrayDecl:(A=function(a){return{_hx_index:17,el:a,__enum__:"hxsl.TExprDef",
toString:v}},A._hx_name="TArrayDecl",A.__params__=["el"],A),TSwitch:(A=function(a,b,c){return{_hx_index:18,e:a,cases:b,def:c,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TSwitch",A.__params__=["e","cases","def"],A),TWhile:(A=function(a,b,c){return{_hx_index:19,e:a,loop:b,normalWhile:c,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TWhile",A.__params__=["e","loop","normalWhile"],A),TMeta:(A=function(a,b,c){return{_hx_index:20,m:a,args:b,e:c,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name=
"TMeta",A.__params__=["m","args","e"],A),TField:(A=function(a,b){return{_hx_index:21,e:a,name:b,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TField",A.__params__=["e","name"],A),TSyntax:(A=function(a,b,c){return{_hx_index:22,target:a,code:b,args:c,__enum__:"hxsl.TExprDef",toString:v}},A._hx_name="TSyntax",A.__params__=["target","code","args"],A)};q.__constructs__=[q.TConst,q.TVar,q.TGlobal,q.TParenthesis,q.TBlock,q.TBinop,q.TUnop,q.TVarDecl,q.TCall,q.TSwiz,q.TIf,q.TDiscard,q.TReturn,q.TFor,q.TContinue,
q.TBreak,q.TArray,q.TArrayDecl,q.TSwitch,q.TWhile,q.TMeta,q.TField,q.TSyntax];q.__empty_constructs__=[q.TDiscard,q.TContinue,q.TBreak];var Ia=L["hxsl.FunctionKind"]={__ename__:!0,__constructs__:null,Vertex:{_hx_name:"Vertex",_hx_index:0,__enum__:"hxsl.FunctionKind",toString:v},Fragment:{_hx_name:"Fragment",_hx_index:1,__enum__:"hxsl.FunctionKind",toString:v},Init:{_hx_name:"Init",_hx_index:2,__enum__:"hxsl.FunctionKind",toString:v},Helper:{_hx_name:"Helper",_hx_index:3,__enum__:"hxsl.FunctionKind",
toString:v},Main:{_hx_name:"Main",_hx_index:4,__enum__:"hxsl.FunctionKind",toString:v}};Ia.__constructs__=[Ia.Vertex,Ia.Fragment,Ia.Init,Ia.Helper,Ia.Main];Ia.__empty_constructs__=[Ia.Vertex,Ia.Fragment,Ia.Init,Ia.Helper,Ia.Main];var C=L["hxsl.TGlobal"]={__ename__:!0,__constructs__:null,Radians:{_hx_name:"Radians",_hx_index:0,__enum__:"hxsl.TGlobal",toString:v},Degrees:{_hx_name:"Degrees",_hx_index:1,__enum__:"hxsl.TGlobal",toString:v},Sin:{_hx_name:"Sin",_hx_index:2,__enum__:"hxsl.TGlobal",toString:v},
Cos:{_hx_name:"Cos",_hx_index:3,__enum__:"hxsl.TGlobal",toString:v},Tan:{_hx_name:"Tan",_hx_index:4,__enum__:"hxsl.TGlobal",toString:v},Asin:{_hx_name:"Asin",_hx_index:5,__enum__:"hxsl.TGlobal",toString:v},Acos:{_hx_name:"Acos",_hx_index:6,__enum__:"hxsl.TGlobal",toString:v},Atan:{_hx_name:"Atan",_hx_index:7,__enum__:"hxsl.TGlobal",toString:v},Pow:{_hx_name:"Pow",_hx_index:8,__enum__:"hxsl.TGlobal",toString:v},Exp:{_hx_name:"Exp",_hx_index:9,__enum__:"hxsl.TGlobal",toString:v},Log:{_hx_name:"Log",
_hx_index:10,__enum__:"hxsl.TGlobal",toString:v},Exp2:{_hx_name:"Exp2",_hx_index:11,__enum__:"hxsl.TGlobal",toString:v},Log2:{_hx_name:"Log2",_hx_index:12,__enum__:"hxsl.TGlobal",toString:v},Sqrt:{_hx_name:"Sqrt",_hx_index:13,__enum__:"hxsl.TGlobal",toString:v},Inversesqrt:{_hx_name:"Inversesqrt",_hx_index:14,__enum__:"hxsl.TGlobal",toString:v},Abs:{_hx_name:"Abs",_hx_index:15,__enum__:"hxsl.TGlobal",toString:v},Sign:{_hx_name:"Sign",_hx_index:16,__enum__:"hxsl.TGlobal",toString:v},Floor:{_hx_name:"Floor",
_hx_index:17,__enum__:"hxsl.TGlobal",toString:v},Ceil:{_hx_name:"Ceil",_hx_index:18,__enum__:"hxsl.TGlobal",toString:v},Fract:{_hx_name:"Fract",_hx_index:19,__enum__:"hxsl.TGlobal",toString:v},Mod:{_hx_name:"Mod",_hx_index:20,__enum__:"hxsl.TGlobal",toString:v},Min:{_hx_name:"Min",_hx_index:21,__enum__:"hxsl.TGlobal",toString:v},Max:{_hx_name:"Max",_hx_index:22,__enum__:"hxsl.TGlobal",toString:v},Clamp:{_hx_name:"Clamp",_hx_index:23,__enum__:"hxsl.TGlobal",toString:v},Mix:{_hx_name:"Mix",_hx_index:24,
__enum__:"hxsl.TGlobal",toString:v},InvLerp:{_hx_name:"InvLerp",_hx_index:25,__enum__:"hxsl.TGlobal",toString:v},Step:{_hx_name:"Step",_hx_index:26,__enum__:"hxsl.TGlobal",toString:v},Smoothstep:{_hx_name:"Smoothstep",_hx_index:27,__enum__:"hxsl.TGlobal",toString:v},Length:{_hx_name:"Length",_hx_index:28,__enum__:"hxsl.TGlobal",toString:v},Distance:{_hx_name:"Distance",_hx_index:29,__enum__:"hxsl.TGlobal",toString:v},Dot:{_hx_name:"Dot",_hx_index:30,__enum__:"hxsl.TGlobal",toString:v},Cross:{_hx_name:"Cross",
_hx_index:31,__enum__:"hxsl.TGlobal",toString:v},Normalize:{_hx_name:"Normalize",_hx_index:32,__enum__:"hxsl.TGlobal",toString:v},LReflect:{_hx_name:"LReflect",_hx_index:33,__enum__:"hxsl.TGlobal",toString:v},Texture:{_hx_name:"Texture",_hx_index:34,__enum__:"hxsl.TGlobal",toString:v},TextureLod:{_hx_name:"TextureLod",_hx_index:35,__enum__:"hxsl.TGlobal",toString:v},Texel:{_hx_name:"Texel",_hx_index:36,__enum__:"hxsl.TGlobal",toString:v},TextureSize:{_hx_name:"TextureSize",_hx_index:37,__enum__:"hxsl.TGlobal",
toString:v},ToInt:{_hx_name:"ToInt",_hx_index:38,__enum__:"hxsl.TGlobal",toString:v},ToFloat:{_hx_name:"ToFloat",_hx_index:39,__enum__:"hxsl.TGlobal",toString:v},ToBool:{_hx_name:"ToBool",_hx_index:40,__enum__:"hxsl.TGlobal",toString:v},Vec2:{_hx_name:"Vec2",_hx_index:41,__enum__:"hxsl.TGlobal",toString:v},Vec3:{_hx_name:"Vec3",_hx_index:42,__enum__:"hxsl.TGlobal",toString:v},Vec4:{_hx_name:"Vec4",_hx_index:43,__enum__:"hxsl.TGlobal",toString:v},IVec2:{_hx_name:"IVec2",_hx_index:44,__enum__:"hxsl.TGlobal",
toString:v},IVec3:{_hx_name:"IVec3",_hx_index:45,__enum__:"hxsl.TGlobal",toString:v},IVec4:{_hx_name:"IVec4",_hx_index:46,__enum__:"hxsl.TGlobal",toString:v},BVec2:{_hx_name:"BVec2",_hx_index:47,__enum__:"hxsl.TGlobal",toString:v},BVec3:{_hx_name:"BVec3",_hx_index:48,__enum__:"hxsl.TGlobal",toString:v},BVec4:{_hx_name:"BVec4",_hx_index:49,__enum__:"hxsl.TGlobal",toString:v},Mat2:{_hx_name:"Mat2",_hx_index:50,__enum__:"hxsl.TGlobal",toString:v},Mat3:{_hx_name:"Mat3",_hx_index:51,__enum__:"hxsl.TGlobal",
toString:v},Mat4:{_hx_name:"Mat4",_hx_index:52,__enum__:"hxsl.TGlobal",toString:v},Mat3x4:{_hx_name:"Mat3x4",_hx_index:53,__enum__:"hxsl.TGlobal",toString:v},Saturate:{_hx_name:"Saturate",_hx_index:54,__enum__:"hxsl.TGlobal",toString:v},Pack:{_hx_name:"Pack",_hx_index:55,__enum__:"hxsl.TGlobal",toString:v},Unpack:{_hx_name:"Unpack",_hx_index:56,__enum__:"hxsl.TGlobal",toString:v},PackNormal:{_hx_name:"PackNormal",_hx_index:57,__enum__:"hxsl.TGlobal",toString:v},UnpackNormal:{_hx_name:"UnpackNormal",
_hx_index:58,__enum__:"hxsl.TGlobal",toString:v},ScreenToUv:{_hx_name:"ScreenToUv",_hx_index:59,__enum__:"hxsl.TGlobal",toString:v},UvToScreen:{_hx_name:"UvToScreen",_hx_index:60,__enum__:"hxsl.TGlobal",toString:v},DFdx:{_hx_name:"DFdx",_hx_index:61,__enum__:"hxsl.TGlobal",toString:v},DFdy:{_hx_name:"DFdy",_hx_index:62,__enum__:"hxsl.TGlobal",toString:v},Fwidth:{_hx_name:"Fwidth",_hx_index:63,__enum__:"hxsl.TGlobal",toString:v},ChannelRead:{_hx_name:"ChannelRead",_hx_index:64,__enum__:"hxsl.TGlobal",
toString:v},ChannelReadLod:{_hx_name:"ChannelReadLod",_hx_index:65,__enum__:"hxsl.TGlobal",toString:v},ChannelFetch:{_hx_name:"ChannelFetch",_hx_index:66,__enum__:"hxsl.TGlobal",toString:v},ChannelTextureSize:{_hx_name:"ChannelTextureSize",_hx_index:67,__enum__:"hxsl.TGlobal",toString:v},Trace:{_hx_name:"Trace",_hx_index:68,__enum__:"hxsl.TGlobal",toString:v},VertexID:{_hx_name:"VertexID",_hx_index:69,__enum__:"hxsl.TGlobal",toString:v},InstanceID:{_hx_name:"InstanceID",_hx_index:70,__enum__:"hxsl.TGlobal",
toString:v},FragCoord:{_hx_name:"FragCoord",_hx_index:71,__enum__:"hxsl.TGlobal",toString:v},FrontFacing:{_hx_name:"FrontFacing",_hx_index:72,__enum__:"hxsl.TGlobal",toString:v},FloatBitsToInt:{_hx_name:"FloatBitsToInt",_hx_index:73,__enum__:"hxsl.TGlobal",toString:v},FloatBitsToUint:{_hx_name:"FloatBitsToUint",_hx_index:74,__enum__:"hxsl.TGlobal",toString:v},IntBitsToFloat:{_hx_name:"IntBitsToFloat",_hx_index:75,__enum__:"hxsl.TGlobal",toString:v},UintBitsToFloat:{_hx_name:"UintBitsToFloat",_hx_index:76,
__enum__:"hxsl.TGlobal",toString:v},RoundEven:{_hx_name:"RoundEven",_hx_index:77,__enum__:"hxsl.TGlobal",toString:v},SetLayout:{_hx_name:"SetLayout",_hx_index:78,__enum__:"hxsl.TGlobal",toString:v},ImageStore:{_hx_name:"ImageStore",_hx_index:79,__enum__:"hxsl.TGlobal",toString:v},ComputeVar_GlobalInvocation:{_hx_name:"ComputeVar_GlobalInvocation",_hx_index:80,__enum__:"hxsl.TGlobal",toString:v},ComputeVar_LocalInvocation:{_hx_name:"ComputeVar_LocalInvocation",_hx_index:81,__enum__:"hxsl.TGlobal",
toString:v},ComputeVar_WorkGroup:{_hx_name:"ComputeVar_WorkGroup",_hx_index:82,__enum__:"hxsl.TGlobal",toString:v},ComputeVar_LocalInvocationIndex:{_hx_name:"ComputeVar_LocalInvocationIndex",_hx_index:83,__enum__:"hxsl.TGlobal",toString:v},AtomicAdd:{_hx_name:"AtomicAdd",_hx_index:84,__enum__:"hxsl.TGlobal",toString:v},GroupMemoryBarrier:{_hx_name:"GroupMemoryBarrier",_hx_index:85,__enum__:"hxsl.TGlobal",toString:v},UnpackSnorm4x8:{_hx_name:"UnpackSnorm4x8",_hx_index:86,__enum__:"hxsl.TGlobal",toString:v},
UnpackUnorm4x8:{_hx_name:"UnpackUnorm4x8",_hx_index:87,__enum__:"hxsl.TGlobal",toString:v}};C.__constructs__=[C.Radians,C.Degrees,C.Sin,C.Cos,C.Tan,C.Asin,C.Acos,C.Atan,C.Pow,C.Exp,C.Log,C.Exp2,C.Log2,C.Sqrt,C.Inversesqrt,C.Abs,C.Sign,C.Floor,C.Ceil,C.Fract,C.Mod,C.Min,C.Max,C.Clamp,C.Mix,C.InvLerp,C.Step,C.Smoothstep,C.Length,C.Distance,C.Dot,C.Cross,C.Normalize,C.LReflect,C.Texture,C.TextureLod,C.Texel,C.TextureSize,C.ToInt,C.ToFloat,C.ToBool,C.Vec2,C.Vec3,C.Vec4,C.IVec2,C.IVec3,C.IVec4,C.BVec2,
C.BVec3,C.BVec4,C.Mat2,C.Mat3,C.Mat4,C.Mat3x4,C.Saturate,C.Pack,C.Unpack,C.PackNormal,C.UnpackNormal,C.ScreenToUv,C.UvToScreen,C.DFdx,C.DFdy,C.Fwidth,C.ChannelRead,C.ChannelReadLod,C.ChannelFetch,C.ChannelTextureSize,C.Trace,C.VertexID,C.InstanceID,C.FragCoord,C.FrontFacing,C.FloatBitsToInt,C.FloatBitsToUint,C.IntBitsToFloat,C.UintBitsToFloat,C.RoundEven,C.SetLayout,C.ImageStore,C.ComputeVar_GlobalInvocation,C.ComputeVar_LocalInvocation,C.ComputeVar_WorkGroup,C.ComputeVar_LocalInvocationIndex,C.AtomicAdd,
C.GroupMemoryBarrier,C.UnpackSnorm4x8,C.UnpackUnorm4x8];C.__empty_constructs__=[C.Radians,C.Degrees,C.Sin,C.Cos,C.Tan,C.Asin,C.Acos,C.Atan,C.Pow,C.Exp,C.Log,C.Exp2,C.Log2,C.Sqrt,C.Inversesqrt,C.Abs,C.Sign,C.Floor,C.Ceil,C.Fract,C.Mod,C.Min,C.Max,C.Clamp,C.Mix,C.InvLerp,C.Step,C.Smoothstep,C.Length,C.Distance,C.Dot,C.Cross,C.Normalize,C.LReflect,C.Texture,C.TextureLod,C.Texel,C.TextureSize,C.ToInt,C.ToFloat,C.ToBool,C.Vec2,C.Vec3,C.Vec4,C.IVec2,C.IVec3,C.IVec4,C.BVec2,C.BVec3,C.BVec4,C.Mat2,C.Mat3,
C.Mat4,C.Mat3x4,C.Saturate,C.Pack,C.Unpack,C.PackNormal,C.UnpackNormal,C.ScreenToUv,C.UvToScreen,C.DFdx,C.DFdy,C.Fwidth,C.ChannelRead,C.ChannelReadLod,C.ChannelFetch,C.ChannelTextureSize,C.Trace,C.VertexID,C.InstanceID,C.FragCoord,C.FrontFacing,C.FloatBitsToInt,C.FloatBitsToUint,C.IntBitsToFloat,C.UintBitsToFloat,C.RoundEven,C.SetLayout,C.ImageStore,C.ComputeVar_GlobalInvocation,C.ComputeVar_LocalInvocation,C.ComputeVar_WorkGroup,C.ComputeVar_LocalInvocationIndex,C.AtomicAdd,C.GroupMemoryBarrier,
C.UnpackSnorm4x8,C.UnpackUnorm4x8];var kc=L["hxsl.SyntaxArgAccess"]={__ename__:!0,__constructs__:null,Read:{_hx_name:"Read",_hx_index:0,__enum__:"hxsl.SyntaxArgAccess",toString:v},Write:{_hx_name:"Write",_hx_index:1,__enum__:"hxsl.SyntaxArgAccess",toString:v},ReadWrite:{_hx_name:"ReadWrite",_hx_index:2,__enum__:"hxsl.SyntaxArgAccess",toString:v}};kc.__constructs__=[kc.Read,kc.Write,kc.ReadWrite];kc.__empty_constructs__=[kc.Read,kc.Write,kc.ReadWrite];var sa=L["hxsl.Component"]={__ename__:!0,__constructs__:null,
X:{_hx_name:"X",_hx_index:0,__enum__:"hxsl.Component",toString:v},Y:{_hx_name:"Y",_hx_index:1,__enum__:"hxsl.Component",toString:v},Z:{_hx_name:"Z",_hx_index:2,__enum__:"hxsl.Component",toString:v},W:{_hx_name:"W",_hx_index:3,__enum__:"hxsl.Component",toString:v}};sa.__constructs__=[sa.X,sa.Y,sa.Z,sa.W];sa.__empty_constructs__=[sa.X,sa.Y,sa.Z,sa.W];var B=function(){};z["hxsl.Tools"]=B;B.__name__="hxsl.Tools";B.allocVarId=function(){return++B.UID};B.getTexUVSize=function(a,b){null==b&&(b=!1);switch(a._hx_index){case 0:var c=
1;break;case 1:c=2;break;case 2:case 3:c=3}b&&++c;return c};B.getDimSize=function(a,b){null==b&&(b=!1);switch(a._hx_index){case 0:var c=1;break;case 2:c=3;break;case 1:case 3:c=2}b&&++c;return c};B.getName=function(a){if(null==a.qualifiers)return a.name;for(var b=0,c=a.qualifiers;b<c.length;){var d=c[b];++b;if(4==d._hx_index)return d.n}return a.name};B.getDoc=function(a){if(null==a.qualifiers)return null;var b=0;for(a=a.qualifiers;b<a.length;){var c=a[b];++b;if(10==c._hx_index)return c.s}return null};
B.getConstBits=function(a){var b=a.type;switch(b._hx_index){case 1:b=0;for(a=a.qualifiers;b<a.length;){var c=a[b];++b;if(0==c._hx_index){b=c.max;if(null!=b){for(a=0;b>=1<<a;)++a;return a}return 8}}break;case 2:return 1;case 16:switch(b.kind._hx_index){case 3:case 4:case 5:return B.MAX_PARTIAL_MAPPINGS_BITS}break;case 17:return 3+B.MAX_CHANNELS_BITS}return 0};B.isConst=function(a){var b=a.type;switch(b._hx_index){case 16:switch(b.kind._hx_index){case 3:case 4:case 5:b=!0;break;default:b=!1}break;case 17:b=
!0;break;default:b=!1}if(b)return!0;if(null!=a.qualifiers)for(b=0,a=a.qualifiers;b<a.length;){var c=a[b];++b;if(0==c._hx_index)return!0}return!1};B.isStruct=function(a){return 13==a.type._hx_index?!0:!1};B.isArray=function(a){return 15==a.type._hx_index?!0:!1};B.hasQualifier=function(a,b){if(null!=a.qualifiers){var c=0;for(a=a.qualifiers;c<a.length;){var d=a[c];++c;if(d==b)return!0}}return!1};B.hasBorrowQualifier=function(a,b){if(null!=a.qualifiers){var c=0;for(a=a.qualifiers;c<a.length;){var d=a[c];
++c;if(11==d._hx_index)return b==d.source}}return!1};B.isTexture=function(a){switch(a._hx_index){case 10:return!0;case 11:return!0;case 17:return!0;default:return!1}};B.toString=function(a){switch(a._hx_index){case 5:var b=a.size,c=a.t;switch(c._hx_index){case 0:var d="i";break;case 1:d="";break;case 2:d="b"}return d+"vec"+b;case 9:return"Bytes"+a.size;case 10:return c=a.dim,d=a.isArray,"Sampler"+D.substr(L[c.__enum__].__constructs__[c._hx_index]._hx_name,1,null)+(d?"Array":"");case 11:return c=a.dim,
d=a.isArray,a=a.channels,"RWTexture"+D.substr(L[c.__enum__].__constructs__[c._hx_index]._hx_name,1,null)+(d?"Array":"")+"<"+(1==a?"Float":"Vec"+a)+">";case 13:c=a.vl;d=[];for(b=0;b<c.length;)a=c[b],++b,d.push(a.name+" : "+B.toString(a.type));return"{"+d.join(",")+"}";case 15:c=a.t;b=a.size;c=B.toString(c)+"[";switch(b._hx_index){case 0:a=b.v;var e=""+a;break;case 1:a=b.v,e=a.name}return c+e+"]";case 16:c=a.t;b=a.size;switch(a.kind._hx_index){case 0:d="Buffer";break;case 1:d="StorageBuffer";break;
case 2:d="RWBuffer";break;case 3:d="PartialBuffer";break;case 4:d="StoragePartialBuffer";break;case 5:d="RWPartialBuffer"}c=d+" "+B.toString(c)+"[";switch(b._hx_index){case 0:a=b.v;e=""+a;break;case 1:a=b.v,e=a.name}return c+e+"]";default:return D.substr(L[a.__enum__].__constructs__[a._hx_index]._hx_name,1,null)}};B.toType=function(a){switch(a._hx_index){case 0:return x.TInt;case 1:return x.TFloat;case 2:return x.TBool}};B.hasSideEffect=function(a){var b;var c=a.e;switch(c._hx_index){case 0:return!1;
case 1:return!1;case 2:return!1;case 3:return a=c.e,B.hasSideEffect(a);case 4:var d=c.el;for(b=0;b<d.length;)if(a=d[b],++b,B.hasSideEffect(a))return!0;return!1;case 5:switch(b=c.op,d=c.e1,c=c.e2,b._hx_index){case 4:return!0;case 20:return!0;default:return a=c,B.hasSideEffect(d)?!0:B.hasSideEffect(a)}case 6:return a=c.e1,B.hasSideEffect(a);case 7:return!0;case 8:b=c.e;d=c.args;c=b.e;if(2==c._hx_index){if(78==c.g._hx_index)return!0;a=d;c=b.e;if(2==c._hx_index)switch(b=c.g,b._hx_index){case 79:case 84:case 85:return!0}else return!0;
for(c=0;c<a.length;)if(d=a[c],++c,B.hasSideEffect(d))return!0;return!1}a=d;b=b.e;if(2==b._hx_index)switch(d=b.g,d._hx_index){case 79:case 84:case 85:return!0}else return!0;for(b=0;b<a.length;)if(d=a[b],++b,B.hasSideEffect(d))return!0;return!1;case 9:return a=c.e,B.hasSideEffect(a);case 10:return a=c.eif,b=c.eelse,B.hasSideEffect(c.econd)||B.hasSideEffect(a)?!0:null!=b?B.hasSideEffect(b):!1;case 12:return!0;case 13:return b=c.loop,B.hasSideEffect(c.it)?!0:B.hasSideEffect(b);case 11:case 14:case 15:return!0;
case 16:return a=c.e,b=c.index,B.hasSideEffect(a)?!0:B.hasSideEffect(b);case 17:d=c.el;for(b=0;b<d.length;)if(a=d[b],++b,B.hasSideEffect(a))return!0;return!1;case 18:a=c.e;var e=c.cases,f=c.def;for(b=0;b<e.length;){var g=e[b];++b;d=0;for(c=g.values;d<c.length;){var h=c[d];++d;if(B.hasSideEffect(h))return!0}if(B.hasSideEffect(g.expr))return!0}return B.hasSideEffect(a)?!0:null!=f?B.hasSideEffect(f):!1;case 19:return a=c.e,b=c.loop,B.hasSideEffect(a)?!0:B.hasSideEffect(b);case 20:return a=c.e,B.hasSideEffect(a);
case 21:return a=c.e,B.hasSideEffect(a);case 22:return!0}};B.iter=function(a,b){var c=a.e;switch(c._hx_index){case 3:a=c.e;b(a);break;case 4:var d=c.el;for(c=0;c<d.length;)a=d[c],++c,b(a);break;case 5:a=c.e1;c=c.e2;b(a);b(c);break;case 6:a=c.e1;b(a);break;case 7:c=c.init;null!=c&&b(c);break;case 8:a=c.e;d=c.args;b(a);for(c=0;c<d.length;)a=d[c],++c,b(a);break;case 9:a=c.e;b(a);break;case 10:a=c.eif;d=c.eelse;b(c.econd);b(a);null!=d&&b(d);break;case 12:a=c.e;null!=a&&b(a);break;case 13:d=c.loop;b(c.it);
b(d);break;case 16:a=c.e;c=c.index;b(a);b(c);break;case 17:d=c.el;for(c=0;c<d.length;)a=d[c],++c,b(a);break;case 18:a=c.e;d=c.cases;var e=c.def;b(a);for(c=0;c<d.length;){a=d[c];++c;for(var f=0,g=a.values;f<g.length;){var h=g[f];++f;b(h)}b(a.expr)}null!=e&&b(e);break;case 19:a=c.e;d=c.loop;b(a);b(d);break;case 20:a=c.e;b(a);break;case 21:a=c.e;b(a);break;case 22:for(d=c.args,c=0;c<d.length;)a=d[c],++c,b(a.e)}};B.map=function(a,b){var c=a.e;switch(c._hx_index){case 0:var d=a.e;break;case 1:d=a.e;break;
case 2:d=a.e;break;case 3:var e=c.e;d=q.TParenthesis(b(e));break;case 4:var f=c.el;d=[];for(c=0;c<f.length;)e=f[c],++c,d.push(b(e));d=q.TBlock(d);break;case 5:d=c.op;e=c.e1;c=c.e2;d=q.TBinop(d,b(e),b(c));break;case 6:d=c.op;e=c.e1;d=q.TUnop(d,b(e));break;case 7:e=c.v;d=c.init;d=q.TVarDecl(e,null!=d?b(d):null);break;case 8:e=c.e;var g=c.args;f=b(e);d=[];for(c=0;c<g.length;)e=g[c],++c,d.push(b(e));d=q.TCall(f,d);break;case 9:e=c.e;var h=c.regs;d=q.TSwiz(b(e),h);break;case 10:d=c.eif;e=c.eelse;d=q.TIf(b(c.econd),
b(d),null!=e?b(e):null);break;case 12:e=c.e;d=q.TReturn(null!=e?b(e):null);break;case 13:e=c.v;d=c.loop;d=q.TFor(e,b(c.it),b(d));break;case 11:case 14:case 15:d=a.e;break;case 16:e=c.e;d=c.index;d=q.TArray(b(e),b(d));break;case 17:f=c.el;d=[];for(c=0;c<f.length;)e=f[c],++c,d.push(b(e));d=q.TArrayDecl(d);break;case 18:e=c.e;g=c.cases;var k=c.def;f=b(e);d=[];for(c=0;c<g.length;){h=g[c];++c;for(var l=[],m=0,p=h.values;m<p.length;)e=p[m],++m,l.push(b(e));d.push({values:l,expr:b(h.expr)})}d=q.TSwitch(f,
d,null==k?null:b(k));break;case 19:e=c.e;d=c.loop;c=c.normalWhile;d=q.TWhile(b(e),b(d),c);break;case 20:d=c.m;g=c.args;e=c.e;d=q.TMeta(d,g,b(e));break;case 21:e=c.e;d=c.name;d=q.TField(b(e),d);break;case 22:e=c.target;f=c.code;g=c.args;c=[];for(d=0;d<g.length;)h=g[d],++d,c.push({e:b(h.e),access:h.access});d=q.TSyntax(e,f,c)}return{e:d,t:a.t,p:a.p}};B.size=function(a){var b,c;switch(a._hx_index){case 0:return 0;case 1:case 3:return 1;case 2:case 4:return 0;case 5:return c=a.size;case 6:return 9;case 7:return 16;
case 8:return 12;case 9:return a=a.size;case 10:return 0;case 11:return 0;case 12:return 4;case 13:var d=a.vl;for(b=a=0;b<d.length;)c=d[b],++b,a+=B.size(c.type);return a;case 14:return 0;case 15:b=a.t;c=a.size;switch(c._hx_index){case 0:return c=c.v,B.size(b)*c;case 1:return 0}break;case 16:return b=a.size,0==b._hx_index?(c=b.v,b=a.t,B.size(b)*c):0;case 17:return c=a.size}};B.evalConst=function(a){var b=a.e;switch(b._hx_index){case 0:var c=b.c;switch(c._hx_index){case 0:return null;case 1:return c.b;
case 2:return c.v;case 3:return c.v;case 4:return c.v}break;case 8:c=b.e;var d=b.args;b=c.e;if(2==b._hx_index)switch(b.g._hx_index){case 41:case 42:b=[];for(c=0;c<d.length;)a=d[c],++c,b.push(B.evalConst(a));d=b;if(1==d.length)return a=d[0],b=d[0],c=d[0],null==c&&(c=0),null==b&&(b=0),null==a&&(a=0),new I(a,b,c);a=d[0];b=d[1];c=d[2];null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c);case 43:b=[];for(c=0;c<d.length;)a=d[c],++c,b.push(B.evalConst(a));d=b;if(1==d.length)return a=d[0],b=d[0],
c=d[0],d=d[0],null==d&&(d=1),null==c&&(c=0),null==b&&(b=0),null==a&&(a=0),new T(a,b,c,d);a=d[0];b=d[1];c=d[2];d=d[3];null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new T(a,b,c,d);default:throw u.thrown("Unhandled constant init "+pa.toString(a));}else throw u.thrown("Unhandled constant init "+pa.toString(a));default:throw u.thrown("Unhandled constant init "+pa.toString(a));}};var da=function(){};z["hxsl.Tools2"]=da;da.__name__="hxsl.Tools2";da.toString=function(a){a=L[a.__enum__].__constructs__[a._hx_index]._hx_name;
return a.charAt(0).toLowerCase()+D.substr(a,1,null)};var Pj=function(){};z["hxsl.Tools3"]=Pj;Pj.__name__="hxsl.Tools3";Pj.toString=function(a){return pa.shaderToString(a)};var Qj=function(){};z["hxsl.Tools4"]=Qj;Qj.__name__="hxsl.Tools4";Qj.toString=function(a){return pa.toString(a)};var ve=function(){this.Batch_Count__=0;ka.call(this)};z["hxsl.BatchShader"]=ve;ve.__name__="hxsl.BatchShader";ve.__super__=ka;ve.prototype=J(ka.prototype,{get_Batch_HasOffset:function(){return this.Batch_HasOffset__},
set_Batch_HasOffset:function(a){this.constModified=!0;return this.Batch_HasOffset__=a},get_Batch_UseStorage:function(){return this.Batch_UseStorage__},set_Batch_UseStorage:function(a){this.constModified=!0;return this.Batch_UseStorage__=a},get_Batch_Count:function(){return this.Batch_Count__},set_Batch_Count:function(a){this.constModified=!0;return this.Batch_Count__=a},get_Batch_Buffer:function(){return this.Batch_Buffer__},set_Batch_Buffer:function(a){return this.Batch_Buffer__=a},get_Batch_StorageBuffer:function(){return this.Batch_StorageBuffer__},
set_Batch_StorageBuffer:function(a){return this.Batch_StorageBuffer__=a},updateConstants:function(a){this.constBits=0;this.Batch_HasOffset__&&(this.constBits|=1);this.Batch_UseStorage__&&(this.constBits|=2);var b=this.Batch_Count__;if(0!=b>>>13)throw u.thrown("Batch_Count is out of range "+b+">8191, consider using @const(MAX_VALUE)");this.constBits|=b<<2;this.updateConstantsFinal(a)},getParamValue:function(a){switch(a){case 0:return this.Batch_HasOffset__;case 1:return this.Batch_UseStorage__;case 2:return this.Batch_Count__;
case 3:return this.Batch_Buffer__;case 4:return this.Batch_StorageBuffer__}return null},getParamFloatValue:function(a){return 2==a?this.Batch_Count__:0},setParamIndexValue:function(a,b){switch(a){case 0:this.Batch_HasOffset__=b;break;case 1:this.Batch_UseStorage__=b;break;case 2:this.Batch_Count__=b;break;case 3:this.Batch_Buffer__=b;break;case 4:this.Batch_StorageBuffer__=b}},setParamIndexFloatValue:function(a,b){},clone:function(){var a=Object.create(ve.prototype);a.shader=this.shader;a.Batch_HasOffset__=
this.Batch_HasOffset__;a.Batch_UseStorage__=this.Batch_UseStorage__;a.Batch_Count__=this.Batch_Count__;a.Batch_Buffer__=this.Batch_Buffer__;a.Batch_StorageBuffer__=this.Batch_StorageBuffer__;return a},__class__:ve});var Jj=function(a){this.forcedPerInstance=a};z["hxsl.BatchInstanceParams"]=Jj;Jj.__name__="hxsl.BatchInstanceParams";Jj.prototype={getSignature:function(){if(null==this.cachedSignature){for(var a=0,b=this.forcedPerInstance;a<b.length;){var c=b[a];++a;c.params.sort(ua.compare)}a=[];b=0;
for(c=this.forcedPerInstance;b<c.length;){var d=c[b];++b;a.push(d.shader+"="+d.params.join(","))}this.cachedSignature=D.substr(vd.encode(a.join(";")),0,8)}return this.cachedSignature},__class__:Jj};var Rh=function(){this.minId=0;this.nexts=[]};z["hxsl.SearchMap"]=Rh;Rh.__name__="hxsl.SearchMap";Rh.prototype={set:function(a,b){if(0==this.minId)this.minId=a,this.nexts=[b];else{a-=this.minId;if(0>a){for(var c=[],d=0,e=this.nexts.length;d<e;){var f=d++;c[f-a]=this.nexts[f]}this.nexts=c;this.minId+=a;
a=0}this.nexts[a]=b}},get:function(a){return this.nexts[a-this.minId]},__class__:Rh};var xd=function(){this.linkCache=new Rh;this.linkShaders=new La;this.batchShaders=new vc;this.batchShadersParams=new La;this.byID=new La};z["hxsl.Cache"]=xd;xd.__name__="hxsl.Cache";xd.get=function(){var a=xd.INST;null==a&&(a=new xd,xd.INST=a);return a};xd.set=function(a){xd.INST=a};xd.clear=function(){xd.INST=null};xd.prototype={getLinkShader:function(a){for(var b=[],c=0;c<a.length;){var d=a[c];++c;b.push(w.string(d))}b=
b.join(",");c=this.linkShaders.h[b];if(null!=c)return c;var e=new Qb("");c=D.substr(vd.encode(b),0,8);e.data={name:"shaderLinker_"+c,vars:[],funs:[]};var f=Object.create(null),g=0,h=x.TVec(4,Q.VFloat),k=function(a,b,c,d){for(var e=[],f=b,g=0,h=c.length;g<h;){var k=g++;k=d(c[c.length-1-k],f-(c.length-1-k));f-=B.size(k.t);e.unshift(k)}return{e:q.TCall({e:q.TGlobal(a),t:x.TVoid,p:null},e),t:x.TVec(b,Q.VFloat),p:null}},l=function(a,b,c){var d=null==c?a:B.getName(c)+"."+a,g=f[d];if(null!=g)return g;g=
{id:B.allocVarId(),name:a,type:b,kind:P.Var,parent:c};if(null==c)e.data.vars.push(g);else if(a=c.type,13==a._hx_index)a.vl.push(g);else throw u.thrown("assert");return f[d]=g},m=null;m=function(a,b){switch(a._hx_index){case 0:var c=a.v;return{e:q.TConst(K.CFloat(c)),t:x.TFloat,p:null};case 1:var d=a.v;a=a.size;c=f[d];if(null!=c)return{e:q.TVar(c),t:c.type,p:null};c=d.split(".");for(d=null;1<c.length;)d=l(c.shift(),x.TStruct([]),d);null!=a&&(b=a);c=l(c.shift(),1==b?x.TFloat:x.TVec(b,Q.VFloat),d);return{e:q.TVar(c),
t:c.type,p:null};case 2:return c=a.v,{e:q.TCall({e:q.TGlobal(C.PackNormal),t:x.TVoid,p:null},[m(c,3)]),t:h,p:null};case 3:return c=a.v,{e:q.TCall({e:q.TGlobal(C.Pack),t:x.TVoid,p:null},[m(c,1)]),t:h,p:null};case 4:return b=a.a,k(C.Vec2,2,b,m);case 5:return b=a.a,k(C.Vec3,3,b,m);case 6:return b=a.a,k(C.Vec4,4,b,m);case 7:return c=a.a,b=a.swiz,{e:q.TSwiz(m(c,4),b),t:x.TVec(b.length,Q.VFloat),p:null}}};var p=function(a){g+=1;var b={id:B.allocVarId(),type:h,name:"OUTPUT"+(g-1),kind:P.Output};e.data.vars.push(b);
return{e:q.TBinop(ha.OpAssign,{e:q.TVar(b),t:h,p:null},m(a,4)),t:x.TVoid,p:null}};c=function(a,b){for(var c={id:B.allocVarId(),type:x.TFun([]),name:(""+w.string(a)).toLowerCase(),kind:P.Function},d=[],f=0;f<b.length;){var g=b[f];++f;d.push(p(g))}a={kind:a,ref:c,args:[],ret:x.TVoid,expr:{e:q.TBlock(d),p:null,t:x.TVoid}};e.data.funs.push(a)};c(Ia.Vertex,[dc.Value("output.position")]);c(Ia.Fragment,a);c=Object.create(ka.prototype);c.shader=e;this.linkShaders.h[b]=c;c.updateConstantsFinal(null);return c},
link:function(a,b){for(var c=this.linkCache,d=a;null!=d;){var e=d.s;d=d.next;e=e.instance;var f=c.nexts[e.id-c.minId];null==f&&(f=new Rh,c.set(e.id,f));c=f}null==c.linked&&(c.linked=this.compileRuntimeShader(a,b));return c.linked},compileRuntimeShader:function(a,b){var c,d=[],e=0;var f=a;for(var g=null;f!=g;){var h=f.s;f=f.next;var k=h;var l=k.instance;d.push({inst:l,p:k.priority,index:e++})}d.reverse();xb.sort(d,function(a,b){return b.p-a.p});f=new nj(b);try{var m=[];for(c=0;c<d.length;)k=d[c],++c,
m.push(k.inst.shader);h=f.link(m)}catch(n){c=u.caught(n).unwrap();if(c instanceof lb){a=c;c=[];for(f=0;f<d.length;)k=d[f],++f,c.push(pa.shaderToString(k.inst.shader));a.msg+="\n\nin\n\n"+c.join("\n-----\n");throw u.thrown(a);}throw n;}if(b==Kb.Batch){var p=null;p=function(a){null!=a.qualifiers&&0<=a.qualifiers.indexOf(ra.PerObject)&&(1==a.qualifiers.length?a.qualifiers=null:(a.qualifiers=a.qualifiers.slice(),D.remove(a.qualifiers,ra.PerObject)),a.kind!=P.Var&&(a.kind=P.Local));var b=a.type;if(13==
b._hx_index){var c=b.vl;for(b=0;b<c.length;)a=c[b],++b,p(a)}};m=0;for(c=h.vars;m<c.length;)k=c[m],++m,p(k)}l=new oj;try{var t=l.split(h,b==Kb.Batch)}catch(n){c=u.caught(n).unwrap();if(c instanceof lb)throw a=c,a.msg+="\n\nin\n\n"+pa.shaderToString(h),u.thrown(a);throw n;}h=new Da;m=0;for(c=f.allVars;m<c.length;)k=c[m],++m,k.v.kind==P.Param&&(f=k.v.type,13!=f._hx_index&&(f=d[k.instanceIndex],g=l.varMap.h[k.v.__id__],h.h[null==g?k.id:g.id]={instance:f.index,index:f.inst.params.h[k.merged[0].id]}));
c=(new pj).dce(t);t=this.buildRuntimeShader(c,h);t.mode=b;m=[];f=a;for(g=null;f!=g;)h=f.s,f=f.next,k=h,m.push(new qj(k.shader,k.constBits));t.spec={instances:m,signature:null};m=0;for(c=d.length;m<c;)l=m++,h=d[d.length-1-l],t.spec.instances[h.index].index=l;m=[];c=0;for(f=t.spec.instances;c<f.length;)l=f[c],++c,m.push(l.shader.data.name+"_"+l.bits+"_"+l.index);d=m.join(":");t.spec.signature=vd.encode(d);m=[];c=0;for(f=t.getShaders();c<f.length;)h=f[c],++c,m.push(pa.shaderToString(h.data));t.signature=
vd.encode(m.join(""));d=this.byID.h[t.signature];null!=d?t.id=d.id:this.byID.h[t.signature]=t;return t},buildRuntimeShader:function(a,b){var c=new Hg;c.globals=new Da;for(var d=0;d<a.length;){var e=a[d];++d;switch(e.name){case "fragment":var f=Ia.Fragment;break;case "main":f=Ia.Main;break;case "vertex":f=Ia.Vertex;break;default:throw u.thrown("assert");}e=this.flattenShader(e,f,b);e.kind=f;switch(f._hx_index){case 0:c.vertex=e;break;case 1:c.fragment=e;break;case 4:c.vertex=e;break;default:throw u.thrown("assert");
}this.initGlobals(c,e)}return c},initGlobals:function(a,b){for(var c=b.globals;null!=c;)a.globals.h[c.gid]=!0,c=c.next;for(c=b.params;null!=c;)null!=c.perObjectGlobal&&(a.globals.h[c.perObjectGlobal.gid]=!0),c=c.next},getPath:function(a){return null==a.parent?a.name:this.getPath(a.parent)+"."+a.name},flattenShader:function(a,b,c){var d,e=new lc,f=new rj;a=e.flatten(a,b);var g=[],h=[];f.texturesCount=0;for(var k=e.allocData.keys();k.hasNext();){b=k.next();var l=e.allocData.h[b.__id__];switch(b.kind._hx_index){case 0:var m=
[];for(d=0;d<l.length;){var p=l[d];++d;null!=p.v&&m.push(new Ig(p.pos,this.getPath(p.v),p.v.type))}l=0;for(d=m.length-1;l<d;)p=l++,m[p].next=m[p+1];p=b.type;if(15==p._hx_index)if(b=p.t,p=p.size,5==b._hx_index)if(4==b.size)if(1==b.t._hx_index)if(0==p._hx_index)b=p.v,f.globals=m[0],f.globalsSize=b;else throw u.thrown("assert");else throw u.thrown("assert");else throw u.thrown("assert");else throw u.thrown("assert");else throw u.thrown("assert");break;case 2:m=[];for(d=p=0;d<l.length;){var t=l[d];++d;
if(null!=t.v){var n=c.h[t.v.id];if(null==n)n=new Pf(t.v.name,t.pos,-1,-1,t.v.type),n.perObjectGlobal=new Ig(-1,this.getPath(t.v),t.v.type),m.push(n),++p;else{n=new Pf(t.v.name,t.pos,n.instance,n.index,t.v.type);var r=t.v.type;15==r._hx_index?B.isTexture(r.t)?(n.pos=-t.size,p+=t.size):++p:++p;m.push(n)}}}l=0;for(d=m.length-1;l<d;)t=l++,m[t].next=m[t+1];l=b.type;if(15==l._hx_index)if(b=l.t,l=l.size,d=b,B.isTexture(d))g.push({t:d,all:m}),f.texturesCount+=p;else switch(b._hx_index){case 5:if(4==b.size)if(1==
b.t._hx_index)if(0==l._hx_index)b=l.v,f.params=m[0],f.paramsSize=b;else throw u.thrown("assert");else throw u.thrown("assert");else throw u.thrown("assert");break;case 16:b=b.kind;for(b=0;b<m.length;)p=m[b],++b,null!=p&&h.push(p);break;default:throw u.thrown("assert");}else throw u.thrown("assert");break;default:throw u.thrown("assert");}}if(0<g.length)for(g.sort(function(a,b){var c=a.t;var d=b.t;switch(c._hx_index){case 10:return 10==d._hx_index?(a=d.dim,b=d.isArray,d=c.isArray,c=c.dim,d!=b?d?1:
-1:c._hx_index-a._hx_index):a.t._hx_index-b.t._hx_index;case 11:return 11==d._hx_index?(a=d.dim,b=d.isArray,d=c.isArray,c=c.dim,d!=b?d?1:-1:c._hx_index-a._hx_index):a.t._hx_index-b.t._hx_index;default:return a.t._hx_index-b.t._hx_index}}),f.textures=g[0].all[0],m=1,d=g.length;m<d;)p=m++,c=g[p-1].all,c[c.length-1].next=g[p].all[0];0<h.length&&h.sort(function(a,b){var c=a.type,d=b.type;return 16==c._hx_index?16==d._hx_index?c.kind._hx_index-d.kind._hx_index:a.type._hx_index-b.type._hx_index:a.type._hx_index-
b.type._hx_index});n=null;for(m=0;m<h.length;)c=h[m],++m,null==f.buffers?(f.buffers=c,n=f.buffers):(n.next=c,n=n.next);f.bufferCount=h.length;null==f.globals&&(f.globalsSize=0);null==f.params&&(f.paramsSize=0);f.data=a;return f},makeBatchShader:function(a,b,c){if(null==c)var d=this.batchShaders;else{var e=this.batchShadersParams;var f=c.getSignature();d=e.h[f];null==d&&(d=new vc,e=this.batchShadersParams,f=c.getSignature(),e.h[f]=d)}f=d.h[a.__id__];null==f&&(f=this.createBatchShader(a,b,c),d.set(a,
f));a=Object.create(ve.prototype);a.shader=f.shader;a.params=f.params;a.paramsSize=f.size;return a},isPerInstance:function(a){if(null==a.qualifiers)return!1;var b=0;for(a=a.qualifiers;b<a.length;){var c=a[b];++b;switch(c._hx_index){case 3:c=!0;break;case 9:c=!0;break;default:c=!1}if(c)return!0}return!1},createBatchShader:function(a,b,c){var d=new Qb(""),e=D.substr(null==c?a.spec.signature:vd.encode(a.spec.signature+c.getSignature()),0,8),f=function(a,b,c){return{id:B.allocVarId(),type:b,name:a,kind:c}},
g=[];if(null!=c)for(var h=c.forcedPerInstance,k=1,l=h.length-1,m=b;null!=m&&0<=l;)m.s.shader.data.name==h[l].shader&&(g[k]=h[l].params,--l),++k,m=m.next;h=f("Batch_HasOffset",x.TBool,P.Param);m=f("Batch_Start",x.TFloat,P.Input);h.qualifiers=[ra.Const()];m.qualifiers=[ra.PerInstance(1)];k=f("Batch_UseStorage",x.TBool,P.Param);l=f("Batch_Count",x.TInt,P.Param);var p=f("Batch_Buffer",x.TBuffer(x.TVec(4,Q.VFloat),Ya.SVar(l),vb.Uniform),P.Param);var t=f("Batch_StorageBuffer",x.TBuffer(x.TVec(4,Q.VFloat),
Ya.SConst(0),vb.RW),P.Param);var n=f("Batch_Offset",x.TInt,P.Local),r={e:q.TVar(p),p:null,t:p.type},v={e:q.TVar(t),p:null,t:t.type},z={e:q.TVar(n),p:null,t:n.type},A=x.TVec(4,Q.VFloat);l.qualifiers=[ra.Const(65536)];k.qualifiers=[ra.Const()];d.data={name:"batchShader_"+e,vars:[l,h,k,p,t,n,m],funs:[]};var E=null;E=function(a,b,c){if(a.kind==c&&a.name==b)return a;var d=a.type;if(13==d._hx_index){var e=d.vl;for(d=0;d<e.length;)if(a=e[d],++d,a=E(a,b,c),null!=a)return a}return null};n=function(a){var c,
d=b;if(null!=a.perObjectGlobal)for(var e=a.perObjectGlobal.path.split(".");null!=d;){var f=0;for(c=d.s.shader.data.vars;f<c.length;){var g=c[f];++f;if(g.name==e[0]&&(g=E(g,a.name,P.Global),null!=g))return g}d=d.next}else{for(c=a.instance-1;0<c;)--c,d=d.next;for(e=a.name;;){f=0;for(c=d.s.shader.data.vars;f<c.length;)if(g=c[f],++f,g=E(g,e,P.Param),null!=g)return g;c=D.cca(e,e.length-1);if(48<=c&&57>=c)e=D.substr(e,0,-1);else break}}throw u.thrown("Var not found "+a.name);};c=null;var F=[],H=[],I=function(a){var b;
var d=null!=a.perObjectGlobal?-a.perObjectGlobal.gid:1024*a.instance+a.index;if(!(0<=H.indexOf(d))){H.push(d);d=a.type;switch(d._hx_index){case 3:var e=1;break;case 5:if(1==d.t._hx_index)e=d.size;else throw u.thrown("Unsupported batch var type "+w.string(a.type));break;case 7:e=16;break;default:throw u.thrown("Unsupported batch var type "+w.string(a.type));}if(4<=e){var f=F.length<<2;d=0;for(b=e>>2;d<b;)d++,F.push(15)}else if(1==e){e=-1;d=0;for(b=F.length;d<b;)f=d++,15!=F[f]&&(0>e||F[e]<F[f])&&(e=
f);0>e&&(e=F.length,F.push(0));f=e<<2;for(d=0;4>d;){var g=d++;b=3-g;if(0==(F[e]&1<<b)){F[e]|=1<<b;f+=b;break}}}else{g=2==e?3:7;e=-1;d=0;for(b=F.length;d<b;)if(f=d++,0==(F[f]&g)){F[f]|=g;e=f;break}0>e&&(e=F.length,F.push(g));f=e<<2}d=new Pf(a.name,f,a.instance,a.index,a.type);d.perObjectGlobal=a.perObjectGlobal;d.next=c;c=d}};for(e=a.vertex.params;null!=e;)t=n(e),p=g[e.instance],(null!=p&&0<=p.indexOf(t.name)||this.isPerInstance(t))&&I(e),e=e.next;for(e=a.fragment.params;null!=e;)t=n(e),p=g[e.instance],
(null!=p&&0<=p.indexOf(t.name)||this.isPerInstance(t))&&I(e),e=e.next;var J=new vc,M=[[sa.X],[sa.Y],[sa.Z],[sa.W]],L=function(a,b){return{e:q.TArray(a,{e:q.TBinop(ha.OpAdd,z,{e:q.TConst(K.CInt(b)),t:x.TInt,p:null}),t:x.TInt,p:null}),t:A,p:null}};t=function(a){var b=f(a.name,a.type,P.Local);if(null!=a.perObjectGlobal){a=a.perObjectGlobal.path.split(".");a.pop();for(var c=b;0<a.length;){a.join(".");var e=a.pop(),g=J.h[a.__id__];null==g&&(g=f(e,x.TStruct([]),P.Local),J.set(a,g));e=g.type;13==e._hx_index&&
e.vl.push(c);c=c.parent=g}}d.data.vars.push(b);return b};n=function(a,b,c){var d=c.pos>>2,e=c.type;switch(e._hx_index){case 3:b={p:null,t:c.type,e:q.TSwiz(L(b,d),M[c.pos&3])};break;case 5:var f=e.t;switch(e.size){case 2:if(1==f._hx_index){switch(c.pos&3){case 0:e=[sa.X,sa.Y];break;case 1:e=[sa.Y,sa.Z];break;default:e=[sa.Z,sa.W]}b={p:null,t:c.type,e:q.TSwiz(L(b,d),e)}}else throw u.thrown("assert");break;case 3:if(1==f._hx_index)b={p:null,t:c.type,e:q.TSwiz(L(b,d),0==(c.pos&3)?[sa.X,sa.Y,sa.Z]:[sa.Y,
sa.Z,sa.W])};else throw u.thrown("assert");break;case 4:if(1==f._hx_index)b=L(b,d);else throw u.thrown("assert");break;default:throw u.thrown("assert");}break;case 7:b={p:null,t:c.type,e:q.TCall({e:q.TGlobal(C.Mat4),t:x.TVoid,p:null},[L(b,d),L(b,d+1),L(b,d+2),L(b,d+3)])};break;default:throw u.thrown("assert");}return{p:null,e:q.TBinop(ha.OpAssign,{e:q.TVar(a),p:null,t:c.type},b),t:x.TVoid}};g=[];p=[];a=F.length;for(e=c;null!=e;)I=t(e),g.push(n(I,r,e)),p.push(n(I,v,e)),e=e.next;r=[];r.push({p:null,
e:q.TBinop(ha.OpAssign,z,{e:q.TGlobal(C.InstanceID),t:x.TInt,p:null}),t:x.TVoid});r.push({p:null,e:q.TIf({e:q.TVar(h),t:x.TBool,p:null},{p:null,e:q.TBinop(ha.OpAssignOp(ha.OpAdd),z,{e:q.TCall({e:q.TGlobal(C.ToInt),t:x.TVoid,p:null},[{p:null,t:x.TFloat,e:q.TVar(m)}]),t:x.TInt,p:null}),t:x.TVoid},null),t:x.TVoid});r.push({p:null,t:x.TInt,e:q.TBinop(ha.OpAssignOp(ha.OpMult),z,{e:q.TConst(K.CInt(a)),t:x.TInt,p:null})});r.push({p:null,e:q.TIf({e:q.TVar(k),t:x.TBool,p:null},{p:null,e:q.TBlock(p),t:x.TVoid},
{p:null,e:q.TBlock(g),t:x.TVoid}),t:x.TVoid});m=f("init",x.TFun([]),P.Function);m={kind:Ia.Init,ref:m,args:[],ret:x.TVoid,expr:{e:q.TBlock(r),p:null,t:x.TVoid}};d.data.funs.push(m);d.consts=new Qf(l,2,17);d.consts.globalId=0;d.consts.next=new Qf(h,0,1);d.consts.next.globalId=0;d.consts.next.next=new Qf(k,1,1);d.consts.next.next.globalId=0;return{shader:d,params:c,size:a}},__class__:xd};var hb=L["hxsl.Channel"]={__ename__:!0,__constructs__:null,Unknown:{_hx_name:"Unknown",_hx_index:0,__enum__:"hxsl.Channel",
toString:v},R:{_hx_name:"R",_hx_index:1,__enum__:"hxsl.Channel",toString:v},G:{_hx_name:"G",_hx_index:2,__enum__:"hxsl.Channel",toString:v},B:{_hx_name:"B",_hx_index:3,__enum__:"hxsl.Channel",toString:v},A:{_hx_name:"A",_hx_index:4,__enum__:"hxsl.Channel",toString:v},PackedFloat:{_hx_name:"PackedFloat",_hx_index:5,__enum__:"hxsl.Channel",toString:v},PackedNormal:{_hx_name:"PackedNormal",_hx_index:6,__enum__:"hxsl.Channel",toString:v}};hb.__constructs__=[hb.Unknown,hb.R,hb.G,hb.B,hb.A,hb.PackedFloat,
hb.PackedNormal];hb.__empty_constructs__=[hb.Unknown,hb.R,hb.G,hb.B,hb.A,hb.PackedFloat,hb.PackedNormal];var Rf=L["hxsl._Checker.FieldAccess"]={__ename__:!0,__constructs__:null,FField:(A=function(a){return{_hx_index:0,e:a,__enum__:"hxsl._Checker.FieldAccess",toString:v}},A._hx_name="FField",A.__params__=["e"],A),FGlobal:(A=function(a,b,c){return{_hx_index:1,g:a,arg:b,variants:c,__enum__:"hxsl._Checker.FieldAccess",toString:v}},A._hx_name="FGlobal",A.__params__=["g","arg","variants"],A)};Rf.__constructs__=
[Rf.FField,Rf.FGlobal];Rf.__empty_constructs__=[];var Ja=L["hxsl._Checker.WithType"]={__ename__:!0,__constructs__:null,NoValue:{_hx_name:"NoValue",_hx_index:0,__enum__:"hxsl._Checker.WithType",toString:v},Value:{_hx_name:"Value",_hx_index:1,__enum__:"hxsl._Checker.WithType",toString:v},InBlock:{_hx_name:"InBlock",_hx_index:2,__enum__:"hxsl._Checker.WithType",toString:v},With:(A=function(a){return{_hx_index:3,t:a,__enum__:"hxsl._Checker.WithType",toString:v}},A._hx_name="With",A.__params__=["t"],A)};
Ja.__constructs__=[Ja.NoValue,Ja.Value,Ja.InBlock,Ja.With];Ja.__empty_constructs__=[Ja.NoValue,Ja.Value,Ja.InBlock];var U=function(){this.globals=U.initGlobals()};z["hxsl.Checker"]=U;U.__name__="hxsl.Checker";U.initGlobals=function(){var a,b;if(null!=U.GLOBALS)return U.GLOBALS;var c=new La;var d=[x.TFloat,U.vec2,U.vec3,U.vec4],e=[x.TInt,U.ivec2,U.ivec3,U.ivec4],f=[x.TFloat,x.TBool,x.TInt];var g=[];for(a=0;a<d.length;){var h=d[a];++a;g.push({args:[{name:"value",type:h}],ret:h})}var k=g;g=[];for(a=
0;a<d.length;)h=d[a],++a,g.push({args:[{name:"a",type:h},{name:"b",type:h}],ret:h});var l=g;g=[];for(a=0;a<d.length;)h=d[a],++a,g.push({args:[{name:"a",type:h},{name:"b",type:x.TFloat}],ret:h});var m=g,p=[{dim:tb.T1D,arr:!1,uv:x.TFloat,iuv:x.TInt},{dim:tb.T2D,arr:!1,uv:U.vec2,iuv:U.ivec2},{dim:tb.T3D,arr:!1,uv:U.vec3,iuv:U.ivec3},{dim:tb.TCube,arr:!1,uv:U.vec3,iuv:U.ivec3},{dim:tb.T1D,arr:!0,uv:U.vec2,iuv:U.ivec2},{dim:tb.T2D,arr:!0,uv:U.vec3,iuv:U.ivec3},{dim:tb.TCube,arr:!0,uv:U.vec4,iuv:U.ivec4}],
t=Object.create(null);g=0;for(a=C.__empty_constructs__.slice();g<a.length;){var n=a[g];++g;switch(n._hx_index){case 7:var r=k.concat(l);break;case 8:r=l;break;case 20:case 21:case 22:r=l.concat(m);break;case 23:r=[{args:[{name:"value",type:x.TInt},{name:"min",type:x.TInt},{name:"max",type:x.TInt}],ret:x.TInt}];for(b=0;b<d.length;)h=d[b],++b,r.push({args:[{name:"value",type:h},{name:"min",type:h},{name:"max",type:h}],ret:h}),h!=x.TFloat&&r.push({args:[{name:"value",type:h},{name:"min",type:x.TFloat},
{name:"max",type:x.TFloat}],ret:h});break;case 24:h=[];for(r=0;r<d.length;)b=d[r],++r,h.push({args:[{name:"x",type:b},{name:"y",type:b},{name:"a",type:b}],ret:b}),b!=x.TFloat&&h.push({args:[{name:"x",type:b},{name:"y",type:b},{name:"a",type:x.TFloat}],ret:b});r=h;break;case 25:r=[{args:[{name:"a",type:x.TFloat},{name:"x",type:x.TFloat},{name:"y",type:x.TFloat}],ret:x.TFloat}];break;case 26:h=[];for(r=0;r<d.length;)b=d[r],++r,h.push({args:[{name:"edge",type:b},{name:"x",type:b}],ret:b}),b!=x.TFloat&&
h.push({args:[{name:"edge",type:x.TFloat},{name:"x",type:b}],ret:b});r=h;break;case 27:h=[];for(r=0;r<d.length;)b=d[r],++r,h.push({args:[{name:"edge0",type:b},{name:"edge1",type:b},{name:"x",type:b}],ret:b}),b!=x.TFloat&&h.push({args:[{name:"edge0",type:x.TFloat},{name:"edge1",type:x.TFloat},{name:"x",type:b}],ret:b});r=h;break;case 28:h=[];for(r=0;r<d.length;)b=d[r],++r,h.push({args:[{name:"value",type:b}],ret:x.TFloat});r=h;break;case 29:case 30:h=[];for(r=0;r<d.length;)b=d[r],++r,h.push({args:[{name:"a",
type:b},{name:"b",type:b}],ret:x.TFloat});r=h;break;case 31:r=[{args:[{name:"a",type:U.vec3},{name:"b",type:U.vec3}],ret:U.vec3}];break;case 32:r=k;break;case 33:r=l;break;case 34:h=[];for(r=0;r<p.length;)b=p[r],++r,h.push({args:[{name:"tex",type:x.TSampler(b.dim,b.arr)},{name:"uv",type:b.uv}],ret:U.vec4});r=h;break;case 35:h=[];for(r=0;r<p.length;)b=p[r],++r,h.push({args:[{name:"tex",type:x.TSampler(b.dim,b.arr)},{name:"uv",type:b.uv},{name:"lod",type:x.TFloat}],ret:U.vec4});r=h;break;case 36:h=
[];for(r=0;r<p.length;)b=p[r],++r,h.push({args:[{name:"tex",type:x.TSampler(b.dim,b.arr)},{name:"pos",type:b.iuv}],ret:U.vec4});r=h;break;case 37:r=[];break;case 38:h=[];for(r=0;r<f.length;)b=f[r],++r,h.push({args:[{name:"value",type:b}],ret:x.TInt});r=h;break;case 39:h=[];for(r=0;r<f.length;)b=f[r],++r,h.push({args:[{name:"value",type:b}],ret:x.TFloat});r=h;break;case 40:h=[];for(r=0;r<f.length;)b=f[r],++r,h.push({args:[{name:"value",type:b}],ret:x.TBool});r=h;break;case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:r=
[];break;case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 54:case 77:r=k;break;case 55:r=[{args:[{name:"value",type:x.TFloat}],ret:U.vec4}];break;case 56:r=[{args:[{name:"value",type:U.vec4}],ret:x.TFloat}];break;case 57:r=[{args:[{name:"value",type:U.vec3}],ret:U.vec4}];break;case 58:r=[{args:[{name:"value",type:U.vec4}],ret:U.vec3}];break;case 59:r=[{args:[{name:"screenPos",type:U.vec2}],ret:U.vec2}];break;
case 60:r=[{args:[{name:"uv",type:U.vec2}],ret:U.vec2}];break;case 61:case 62:case 63:r=k;break;case 64:r=[{args:[{name:"channel",type:x.TChannel(1)},{name:"uv",type:U.vec2}],ret:x.TFloat},{args:[{name:"channel",type:x.TChannel(2)},{name:"uv",type:U.vec2}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"uv",type:U.vec2}],ret:U.vec3},{args:[{name:"channel",type:x.TChannel(4)},{name:"uv",type:U.vec2}],ret:U.vec4}];break;case 65:r=[{args:[{name:"channel",type:x.TChannel(1)},{name:"uv",
type:U.vec2},{name:"lod",type:x.TFloat}],ret:x.TFloat},{args:[{name:"channel",type:x.TChannel(2)},{name:"uv",type:U.vec2},{name:"lod",type:x.TFloat}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"uv",type:U.vec2},{name:"lod",type:x.TFloat}],ret:U.vec3},{args:[{name:"channel",type:x.TChannel(4)},{name:"uv",type:U.vec2},{name:"lod",type:x.TFloat}],ret:U.vec4}];break;case 66:r=[{args:[{name:"channel",type:x.TChannel(1)},{name:"pos",type:U.ivec2}],ret:x.TFloat},{args:[{name:"channel",
type:x.TChannel(2)},{name:"pos",type:U.ivec2}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"pos",type:U.ivec2}],ret:U.vec3},{args:[{name:"channel",type:x.TChannel(4)},{name:"pos",type:U.ivec2}],ret:U.vec4},{args:[{name:"channel",type:x.TChannel(1)},{name:"pos",type:U.ivec2},{name:"lod",type:x.TInt}],ret:x.TFloat},{args:[{name:"channel",type:x.TChannel(2)},{name:"pos",type:U.ivec2},{name:"lod",type:x.TInt}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"pos",type:U.ivec2},
{name:"lod",type:x.TInt}],ret:U.vec3},{args:[{name:"channel",type:x.TChannel(4)},{name:"pos",type:U.ivec2},{name:"lod",type:x.TInt}],ret:U.vec4}];break;case 67:r=[{args:[{name:"channel",type:x.TChannel(1)}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(2)}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(4)}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(1)},{name:"lod",type:x.TInt}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(2)},
{name:"lod",type:x.TInt}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(3)},{name:"lod",type:x.TInt}],ret:U.vec2},{args:[{name:"channel",type:x.TChannel(4)},{name:"lod",type:x.TInt}],ret:U.vec2}];break;case 69:case 70:case 71:case 72:r=null;break;case 73:case 74:var q=[];r=0;for(var v=d;r<v.length;)h=v[r],b=r++,q.push({args:[{name:"x",type:h}],ret:e[b]});r=q;break;case 75:case 76:h=[];r=0;for(b=d;r<b.length;)q=b[r],v=r++,h.push({args:[{name:"x",type:e[v]}],ret:q});r=h;break;case 78:r=[{args:[{name:"x",
type:x.TInt},{name:"y",type:x.TInt},{name:"z",type:x.TInt}],ret:x.TVoid},{args:[{name:"x",type:x.TInt},{name:"y",type:x.TInt}],ret:x.TVoid},{args:[{name:"x",type:x.TInt}],ret:x.TVoid}];break;case 79:r=[];break;case 84:r=[{args:[{name:"buf",type:x.TBuffer(x.TInt,Ya.SConst(0),vb.RW)},{name:"index",type:x.TInt},{name:"data",type:x.TInt}],ret:x.TInt}];break;case 68:case 85:r=[];break;case 86:if(0<L[n.__enum__].__constructs__[n._hx_index]._hx_name.indexOf("_")){r=L[n.__enum__].__constructs__[n._hx_index]._hx_name;
b=r.indexOf("_");q=D.substr(r,0,b);q=q.charAt(0).toLowerCase()+D.substr(q,1,null);h=t[q];null==h&&(h=[],t[q]=h);switch(n._hx_index){case 80:case 81:case 82:q=U.ivec3;break;case 83:q=x.TInt;break;default:throw u.thrown("Unknown type for global var "+w.string(n));}r=D.substr(r,b+1,null);r=r.charAt(0).toLowerCase()+D.substr(r,1,null);h.push({name:r,type:q});r=null}else r=[{args:[{name:"value",type:x.TInt}],ret:U.vec4}];break;case 87:if(0<L[n.__enum__].__constructs__[n._hx_index]._hx_name.indexOf("_")){r=
L[n.__enum__].__constructs__[n._hx_index]._hx_name;b=r.indexOf("_");q=D.substr(r,0,b);q=q.charAt(0).toLowerCase()+D.substr(q,1,null);h=t[q];null==h&&(h=[],t[q]=h);switch(n._hx_index){case 80:case 81:case 82:q=U.ivec3;break;case 83:q=x.TInt;break;default:throw u.thrown("Unknown type for global var "+w.string(n));}r=D.substr(r,b+1,null);r=r.charAt(0).toLowerCase()+D.substr(r,1,null);h.push({name:r,type:q});r=null}else r=[{args:[{name:"value",type:x.TInt}],ret:U.vec4}];break;default:if(0<L[n.__enum__].__constructs__[n._hx_index]._hx_name.indexOf("_")){r=
L[n.__enum__].__constructs__[n._hx_index]._hx_name;b=r.indexOf("_");q=D.substr(r,0,b);q=q.charAt(0).toLowerCase()+D.substr(q,1,null);h=t[q];null==h&&(h=[],t[q]=h);switch(n._hx_index){case 80:case 81:case 82:q=U.ivec3;break;case 83:q=x.TInt;break;default:throw u.thrown("Unknown type for global var "+w.string(n));}r=D.substr(r,b+1,null);r=r.charAt(0).toLowerCase()+D.substr(r,1,null);h.push({name:r,type:q});r=null}else throw u.thrown("Unsupported global "+w.string(n));}null!=r&&(h=da.toString(n),c.h[h]=
{t:x.TFun(r),g:n})}c.h.vertexID={t:x.TInt,g:C.VertexID};c.h.instanceID={t:x.TInt,g:C.InstanceID};c.h.fragCoord={t:U.vec4,g:C.FragCoord};c.h.frontFacing={t:x.TBool,g:C.FrontFacing};d=Object.keys(t);e=d.length;for(r=0;r<e;){b=h=d[r++];h=t[h];f=b;g=[];for(a=0;a<h.length;)k=h[a],++a,g.push({name:k.name,kind:P.Global,type:k.type,id:0});c.h[f]={t:x.TStruct(g),g:null}}c.h["int"]=c.h.toInt;c.h["float"]=c.h.toFloat;c.h.reflect=c.h.lReflect;c.h.ivec2=c.h.iVec2;h="iVec2";Object.prototype.hasOwnProperty.call(c.h,
h)&&delete c.h[h];c.h.ivec3=c.h.iVec3;h="iVec3";Object.prototype.hasOwnProperty.call(c.h,h)&&delete c.h[h];c.h.ivec4=c.h.iVec4;h="iVec4";Object.prototype.hasOwnProperty.call(c.h,h)&&delete c.h[h];Object.prototype.hasOwnProperty.call(c.h,"lReflect")&&delete c.h.lReflect;Object.prototype.hasOwnProperty.call(c.h,"toInt")&&delete c.h.toInt;Object.prototype.hasOwnProperty.call(c.h,"toFloat")&&delete c.h.toFloat;return U.GLOBALS=c};U.prototype={error:function(a,b){return lb.t(a,b)},warning:function(a,b){},
loadShader:function(a){throw u.thrown("Not implemented");},check:function(a,b){this.vars=new La;this.inits=[];this.inWhile=this.inLoop=!1;var c=[];this.checkExpr(b,c,!1,!1);b=[];for(var d=0;d<c.length;){var e=c[d];++d;var f=e.p;e=e.f;var g=[];for(var h=0,k=e.args;h<k.length;){var l=k[h];++h;null==l.type&&this.error("Argument type required",f);null!=l.expr&&this.error("Optional argument not supported",f);null==l.kind&&(l.kind=P.Local);l.kind!=P.Local&&this.error("Argument should be local",f);0!=l.qualifiers.length&&
this.error("No qualifier allowed for argument",f);g.push({id:B.allocVarId(),name:l.name,kind:P.Local,type:l.type})}h=g;switch(e.name){case "fragment":k=Ia.Fragment;break;case "main":k=Ia.Main;break;case "vertex":k=Ia.Vertex;break;default:k=aa.startsWith(e.name,"__init__")?Ia.Init:Ia.Helper}0!=h.length&&k!=Ia.Helper&&this.error(w.string(k)+" function should have no argument",f);g=B.allocVarId();l=e.name;for(var m=[],p=0;p<h.length;){var t=h[p];++p;m.push({type:t.type,name:t.name})}g={id:g,name:l,kind:P.Function,
type:x.TFun([{args:m,ret:null==e.ret?x.TVoid:e.ret}])};e={kind:k,ref:g,args:h,ret:null==e.ret?x.TVoid:e.ret,expr:null};Object.prototype.hasOwnProperty.call(this.vars.h,g.name)&&this.error("Duplicate function name",f);this.vars.h[g.name]=g;b.push(e)}d=0;for(g=b.length;d<g;)f=d++,this.typeFun(b[f],c[f].f.expr);c=[];d=0;for(g=this.inits.slice();d<g.length;)f=g[d],++d,f.v.kind==P.Local&&(c.push({e:q.TBinop(ha.OpAssign,{e:q.TVar(f.v),p:f.e.p,t:f.v.type},f.e),p:f.e.p,t:f.v.type}),D.remove(this.inits,f));
0<c.length&&(g={id:B.allocVarId(),name:"__init__consts__",kind:P.Function,type:x.TFun([{args:[],ret:x.TVoid}])},Object.prototype.hasOwnProperty.call(this.vars.h,g.name)&&this.error("assert",c[0].p),this.vars.h[g.name]=g,b.push({kind:Ia.Init,ref:g,args:[],ret:x.TVoid,expr:{e:q.TBlock(c),p:c[0].p,t:x.TVoid}}));c=ge.array(this.vars);c.sort(function(a,b){return(0>a.id?-a.id:a.id)-(0>b.id?-b.id:b.id)});return{name:a,vars:c,funs:b}},saveVars:function(){for(var a=new La,b=Object.keys(this.vars.h),c=b.length,
d=0;d<c;){var e=b[d++];a.h[e]=this.vars.h[e]}return a},typeFun:function(a,b){for(var c=this.saveVars(),d=0,e=a.args;d<e.length;){var f=e[d];++d;this.vars.h[f.name]=f}this.curFun=a;a.expr=this.typeExpr(b,Ja.NoValue);this.vars=c},tryUnify:function(a,b){if(la.enumEq(a,b))return!0;switch(a._hx_index){case 5:if(5==b._hx_index){var c=b.size;var d=b.t;var e=a.t;if(a.size==c&&e==d)return!0}break;case 10:if(10==b._hx_index&&(e=b.dim,d=b.isArray,b=a.isArray,a=a.dim,a==e))return b==d;break;case 11:if(11==b._hx_index){e=
b.dim;d=b.isArray;c=b.channels;var f=a.channels;b=a.isArray;a=a.dim;if(a==e&&b==d)return f==c}break;case 15:if(15==b._hx_index){d=b.t;b=b.size;c=a.size;e=a.t;switch(c._hx_index){case 0:if(0==b._hx_index){if(c.v!=b.v)return!1}else return!1;break;case 1:if(1==b._hx_index){if(c.v!=b.v)return!1}else return!1;break;default:return!1}return this.tryUnify(e,d)}break;case 17:if(17==b._hx_index&&a.size==b.size)return!0}return!1},unify:function(a,b,c){this.tryUnify(a,b)||this.error(B.toString(a)+" should be "+
B.toString(b),c)},unifyExpr:function(a,b){this.tryUnify(a.t,b)||(a.t==x.TInt&&b==x.TFloat?this.toFloat(a):this.error(B.toString(a.t)+" should be "+B.toString(b),a.p))},checkWrite:function(a){var b=a.e;switch(b._hx_index){case 1:b=b.v;switch(b.kind._hx_index){case 2:b=b.type;switch(b._hx_index){case 11:b=!0;break;case 16:switch(b.kind._hx_index){case 2:case 5:b=!0;break;default:b=!1}break;default:b=!1}if(b)return;break;case 4:if(null==b.qualifiers||0>b.qualifiers.indexOf(ra.Final))return;b=b.type;
switch(b._hx_index){case 11:b=!0;break;case 16:switch(b.kind._hx_index){case 2:case 5:b=!0;break;default:b=!1}break;default:b=!1}if(b)return;break;case 3:case 5:return}break;case 9:a=b.e;this.checkWrite(a);return;case 16:a=b.e;this.checkWrite(a);return;case 21:a=b.e;this.checkWrite(a);return}this.error("This expression cannot be assigned",a.p)},typeWith:function(a,b){if(null==b)return this.typeExpr(a,Ja.Value);a=this.typeExpr(a,Ja.With(b));this.unifyExpr(a,b);return a},typeExpr:function(a,b){var c=
this,d=null;var e=a.expr;switch(e._hx_index){case 0:var f=e.c;switch(f._hx_index){case 0:d=x.TVoid;break;case 1:var g=f.b;d=x.TBool;break;case 2:var h=f.v;3==b._hx_index?3==b.t._hx_index?(f=K.CFloat(h),d=x.TFloat):d=x.TInt:d=x.TInt;break;case 3:g=f.v;d=x.TFloat;break;case 4:g=f.v,d=x.TString}var k=q.TConst(f);break;case 1:var l=e.i;k=this.vars.h[l];if(null!=k){switch(l){case "fragment":case "main":case "vertex":e=!1;break;default:e=!aa.startsWith(l,"__init__")}e||this.error("Function cannot be accessed",
a.pos);d=k.type;k=q.TVar(k)}else h=this.globals.h[l],null!=h&&null!=h.g?(d=h.t,k=q.TGlobal(h.g)):"PI"==l?(d=x.TFloat,k=q.TConst(K.CFloat(Math.PI))):k=this.error("Unknown identifier '"+l+"'",a.pos);break;case 2:var m=e.e;k=this.typeExpr(m,b);d=k.t;k=q.TParenthesis(k);break;case 3:g=e.e;var p=e.f;e=g.expr;m=g.pos;if(1==e._hx_index)if(l=e.i,m=p,null==this.vars.h[l]&&null!=this.globals.h[l]&&null==this.globals.h[l].g)if(e=this.globals.h[l].t,13==e._hx_index){g=e.vl;for(e=0;e<g.length;)if(k=g[e],++e,k.name==
m)return h=l.charAt(0).toUpperCase()+D.substr(l,1,null)+"_"+m.charAt(0).toUpperCase()+D.substr(m,1,null),{e:q.TGlobal(la.createEnum(C,h,null)),t:k.type,p:a.pos};p=l+" field should be ";e=[];for(m=0;m<g.length;)k=g[m],++m,e.push(k.name);k=this.error(p+e.join("|"),a.pos)}else throw u.thrown("assert");else switch(m=p,l=this.typeExpr(g,Ja.Value),p=this.fieldAccess(l,m,b,a.pos),null==p&&this.error(B.toString(l.t)+" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=p.e;d=e.t;k=e.e;break;case 1:e=p.g,e=
p.arg,e=p.variants,k=this.error("Global function must be called immediately",a.pos)}else switch(m=p,l=this.typeExpr(g,Ja.Value),p=this.fieldAccess(l,m,b,a.pos),null==p&&this.error(B.toString(l.t)+" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=p.e;d=e.t;k=e.e;break;case 1:g=p.g,g=p.arg,g=p.variants,k=this.error("Global function must be called immediately",a.pos)}break;case 4:b=e.op;m=e.e1;k=e.e2;l=this.typeExpr(m,Ja.Value);f=this.typeExpr(k,Ja.With(l.t));switch(b._hx_index){case 4:this.checkWrite(l);
this.unify(f.t,l.t,f.p);d=l.t;break;case 20:e=b.op;this.checkWrite(l);this.unify(this.typeBinop(e,l,f,a.pos),l.t,f.p);d=l.t;break;default:d=this.typeBinop(b,l,f,a.pos)}k=q.TBinop(b,l,f);break;case 5:b=e.op;m=e.e1;l=this.typeExpr(m,Ja.Value);switch(b._hx_index){case 0:case 1:switch(l.t._hx_index){case 1:case 3:break;default:this.error("Cannot increment "+B.toString(l.t),a.pos)}d=x.TVoid;k=q.TBinop(ha.OpAssignOp(b==gd.OpIncrement?ha.OpAdd:ha.OpSub),l,{e:q.TConst(K.CInt(1)),t:x.TInt,p:l.p});break;case 2:this.unifyExpr(l,
x.TBool);d=x.TBool;k=q.TUnop(b,l);break;case 3:g=l.t;switch(g._hx_index){case 1:case 3:break;case 5:p=g.size;switch(g.t._hx_index){case 0:case 1:break;default:this.error("Cannot negate "+B.toString(l.t),a.pos)}break;default:this.error("Cannot negate "+B.toString(l.t),a.pos)}d=l.t;k=q.TUnop(b,l);break;default:k=this.error("Operation non supported",a.pos)}break;case 6:g=e.e;p=e.args;e=g.expr;m=g.pos;if(3==e._hx_index)if(m=e.e,h=m.expr,l=m.pos,1==h._hx_index){if("Syntax"==h.i){g=e.f;var t=p;0==t.length&&
this.error("Syntax."+g+" should have a string as first argument",a.pos);e=t[0].expr;0==e._hx_index?(m=e.c,k=4==m._hx_index?m.v:this.error("Syntax."+g+" should have a string as first argument",t[0].pos)):k=this.error("Syntax."+g+" should have a string as first argument",t[0].pos);f=[];e=1;for(m=t.length;e<m;)if(h=e++,b=t[h],h=b.expr,20==h._hx_index)switch(l=h.name,p=h.e,l){case "r":case "rw":case "w":b=l;p=this.typeExpr(p,Ja.Value);switch(b){case "r":b=kc.Read;break;case "rw":b=kc.ReadWrite;break;
case "w":b=kc.Write;break;default:throw u.thrown("assert");}f.push({e:p,access:b});break;default:this.error("Syntax."+g+" arguments should have an access meta of @r, @w or @rw",b.pos)}else this.error("Syntax."+g+" arguments should have an access meta of @r, @w or @rw",b.pos);return{e:q.TSyntax(g,k,f),t:x.TVoid,p:a.pos}}m=g;t=p;g=function(b){var e=b.t;return 14==e._hx_index?(b=c.unifyCallParams(b,t,e.variants,a.pos),d=b.t,b.e):c.error(B.toString(b.t)+" cannot be called",a.pos)};e=m.expr;if(3==e._hx_index)switch(l=
e.e,m=e.f,e=this.typeExpr(l,Ja.Value),p=this.fieldAccess(e,m,b,a.pos),null==p&&this.error(B.toString(e.t)+" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=p.e;k=g(e);break;case 1:h=p.g;b=p.arg;g=p.variants;l={e:q.TGlobal(h),t:x.TFun(g),p:e.p};if(0==g.length){e=[];for(m=0;m<t.length;)k=t[m],++m,e.push(this.typeExpr(k,Ja.Value));var n=e;n.unshift(b);k=this.specialGlobal(h,l,n,a.pos)}else if(k=this.unifyCallParams(l,t,g,a.pos),e=k.e,m=l.t,8==e._hx_index)if(h=e.e,14==m._hx_index)if(h=m.variants,1==
h.length)m=h[0],n=e.args,n.unshift(b),m.args.unshift({name:"_",type:b.t});else throw u.thrown("assert");else throw u.thrown("assert");else throw u.thrown("assert");d=k.t;k=k.e}else k=g(this.typeExpr(m,Ja.Value))}else if(m=g,n=p,g=function(b){var e=b.t;return 14==e._hx_index?(b=c.unifyCallParams(b,n,e.variants,a.pos),d=b.t,b.e):c.error(B.toString(b.t)+" cannot be called",a.pos)},e=m.expr,3==e._hx_index)switch(l=e.e,m=e.f,e=this.typeExpr(l,Ja.Value),p=this.fieldAccess(e,m,b,a.pos),null==p&&this.error(B.toString(e.t)+
" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=p.e;k=g(e);break;case 1:h=p.g;b=p.arg;g=p.variants;l={e:q.TGlobal(h),t:x.TFun(g),p:e.p};if(0==g.length){e=[];for(m=0;m<n.length;)k=n[m],++m,e.push(this.typeExpr(k,Ja.Value));var r=e;r.unshift(b);k=this.specialGlobal(h,l,r,a.pos)}else if(k=this.unifyCallParams(l,n,g,a.pos),e=k.e,m=l.t,8==e._hx_index)if(h=e.e,14==m._hx_index)if(h=m.variants,1==h.length)m=h[0],r=e.args,r.unshift(b),m.args.unshift({name:"_",type:b.t});else throw u.thrown("assert");
else throw u.thrown("assert");else throw u.thrown("assert");d=k.t;k=k.e}else k=g(this.typeExpr(m,Ja.Value));else if(m=g,r=p,h=function(b){var e=b.t;return 14==e._hx_index?(b=c.unifyCallParams(b,r,e.variants,a.pos),d=b.t,b.e):c.error(B.toString(b.t)+" cannot be called",a.pos)},g=m.expr,3==g._hx_index)switch(l=g.e,m=g.f,e=this.typeExpr(l,Ja.Value),p=this.fieldAccess(e,m,b,a.pos),null==p&&this.error(B.toString(e.t)+" has no field '"+m+"'",a.pos),p._hx_index){case 0:e=p.e;k=h(e);break;case 1:h=p.g;b=
p.arg;g=p.variants;l={e:q.TGlobal(h),t:x.TFun(g),p:e.p};if(0==g.length){g=[];for(p=0;p<r.length;)k=r[p],++p,g.push(this.typeExpr(k,Ja.Value));var v=g;v.unshift(b);k=this.specialGlobal(h,l,v,a.pos)}else if(k=this.unifyCallParams(l,r,g,a.pos),g=k.e,p=l.t,8==g._hx_index)if(e=g.e,14==p._hx_index)if(e=p.variants,1==e.length)m=e[0],v=g.args,v.unshift(b),m.args.unshift({name:"_",type:b.t});else throw u.thrown("assert");else throw u.thrown("assert");else throw u.thrown("assert");d=k.t;k=k.e}else k=h(this.typeExpr(m,
Ja.Value));break;case 7:e=e.el;k=this.saveVars();h=e.slice();f=[];b=this.propagate(b);for(0==h.length&&b!=Ja.NoValue&&this.error("Value expected",a.pos);;){m=h.shift();if(null==m)break;g=m.expr;8==g._hx_index&&(g=g.v,1<g.length&&(e=g.shift(),h.unshift(m),m={expr:qb.EVars([e]),pos:m.pos}));p=m.expr;8==p._hx_index?(e=p.v,e=Ja.InBlock):e=0==h.length?b:Ja.NoValue;l=this.typeExpr(m,e);0==h.length||B.hasSideEffect(l)||this.warning("This expression has no side effect",m.pos);f.push(l)}this.vars=k;d=b==Ja.NoValue?
x.TVoid:f[f.length-1].t;k=q.TBlock(f);break;case 8:g=e.v;b!=Ja.InBlock&&this.error("Cannot declare a variable outside of a block",a.pos);if(1!=g.length)throw u.thrown("assert");k=g[0];null==k.kind&&(k.kind=P.Local);k.kind!=P.Local&&this.error("Should be local var",a.pos);0!=k.qualifiers.length&&this.error("Unexpected qualifier",a.pos);e=this.makeVar(g[0],a.pos);g=null==k.expr?null:this.typeWith(k.expr,e.type);null==e.type&&(null==g&&this.error("Type required for unitialized local var",a.pos),e.type=
g.t);this.vars.h[e.name]=e;d=x.TVoid;k=q.TVarDecl(e,g);break;case 9:throw g=e.f,u.thrown("assert");case 10:g=e.econd;m=e.eif;k=e.eelse;b=this.propagate(b);e=this.typeWith(g,x.TBool);l=this.typeExpr(m,b);f=null==k?null:this.typeExpr(k,b);b==Ja.NoValue?d=x.TVoid:(null==f&&this.error("Missing else",a.pos),this.tryUnify(l.t,f.t)?d=l.t:(this.unifyExpr(f,l.t),d=f.t));k=q.TIf(e,l,f);break;case 11:d=x.TVoid;k=q.TDiscard;break;case 12:k=e.v;g=e.loop;m=e.block;d=x.TVoid;e=this.typeExpr(g,Ja.Value);g=e.t;15==
g._hx_index?(p=g.size,b=g.t,p={id:B.allocVarId(),name:k,type:b,kind:P.Local},k=this.vars.h[p.name],this.vars.h[p.name]=p,g=this.inLoop,this.inLoop=!0,b=this.typeExpr(m,Ja.NoValue),this.inLoop=g,null==k?(g=p.name,m=this.vars,Object.prototype.hasOwnProperty.call(m.h,g)&&delete m.h[g]):this.vars.h[p.name]=k,k=q.TFor(p,e,b)):k=this.error("Cannot iterate on "+B.toString(e.t),e.p);break;case 13:m=e.e;null==m!=(this.curFun.ret==x.TVoid)&&this.error("This function should return "+B.toString(this.curFun.ret),
a.pos);k=null==m?null:this.typeWith(m,this.curFun.ret);d=x.TVoid;k=q.TReturn(k);break;case 14:this.inLoop||this.error("Break outside loop",a.pos);d=x.TVoid;k=q.TBreak;break;case 15:this.inLoop||this.error("Continue outside loop",a.pos);d=x.TVoid;k=q.TContinue;break;case 16:m=e.e;k=e.eindex;l=this.typeExpr(m,Ja.Value);f=this.typeExpr(k,Ja.With(x.TInt));this.unify(f.t,x.TInt,f.p);g=l.t;switch(g._hx_index){case 5:p=g.size;switch(g.t._hx_index){case 0:d=x.TInt;break;case 1:d=x.TFloat;break;default:this.error("Cannot index "+
B.toString(l.t)+" : should be an array",a.pos)}break;case 6:d=U.vec3;break;case 7:case 8:d=U.vec4;break;case 12:d=U.vec2;break;case 15:b=g.t;k=g.size;p=f.e;0==k._hx_index?0==p._hx_index&&(e=p.c,2==e._hx_index&&(m=e.v,k=k.v,m>=k?this.error("Indexing outside array bounds",a.pos):0>m&&this.error("Cannot index with negative value",a.pos))):0==p._hx_index&&(e=p.c,2==e._hx_index&&(h=e.v,0>h&&this.error("Cannot index with negative value",a.pos)));d=b;break;case 16:p=g.t;e=g.size;switch(g.kind._hx_index){case 0:case 3:k=
e;b=p;g=f.e;0==k._hx_index?0==g._hx_index&&(m=g.c,2==m._hx_index&&(h=m.v,k=k.v,h>=k?this.error("Indexing outside array bounds",a.pos):0>h&&this.error("Cannot index with negative value",a.pos))):0==g._hx_index&&(m=g.c,2==m._hx_index&&(h=m.v,0>h&&this.error("Cannot index with negative value",a.pos)));d=b;break;default:k=e,d=p}break;default:this.error("Cannot index "+B.toString(l.t)+" : should be an array",a.pos)}k=q.TArray(l,f);break;case 17:e=e.el;0==e.length&&this.error("Empty array not supported",
a.pos);g=[];for(p=0;p<e.length;)m=e[p],++p,g.push(this.typeExpr(m,Ja.Value));e=g;b=e[0].t;g=1;for(p=e.length;g<p;)h=g++,this.unifyExpr(e[h],b);d=x.TArray(b,Ya.SConst(e.length));k=q.TArrayDecl(e);break;case 18:m=e.e;v=e.cases;var w=e.def;l=this.typeExpr(m,Ja.Value);g=[];for(p=0;p<v.length;){f=v[p];++p;e=[];m=0;for(h=f.values;m<h.length;)k=h[m],++m,e.push(this.typeWith(k,l.t));g.push({values:e,expr:this.typeExpr(f.expr,b)})}v=g;e=null==w?null:this.typeExpr(w,b);d=x.TVoid;k=q.TSwitch(l,v,e);break;case 19:g=
e.cond;p=e.loop;b=e.normalWhile;d=x.TVoid;e=this.typeWith(g,x.TBool);g=this.inLoop;m=this.inWhile;this.inWhile=this.inLoop=!0;p=this.typeExpr(p,Ja.NoValue);this.inLoop=g;this.inWhile=m;k=q.TWhile(e,p,b);break;case 20:l=e.name;v=e.args;m=e.e;k=this.typeExpr(m,b);d=k.t;e=[];for(g=0;g<v.length;){f=v[g];++g;p=f.expr;switch(p._hx_index){case 0:p=p.c;break;case 1:h=p.i;p=K.CString(h);break;default:p=this.error("Metadata parameter should be constant",f.pos)}e.push(p)}k=q.TMeta(l,e,k)}if(null==d)throw u.thrown("assert");
return{e:k,t:d,p:a.pos}},propagate:function(a){return 2==a._hx_index?Ja.NoValue:a},checkExpr:function(a,b,c,d){var e=this;var f=a.expr;switch(f._hx_index){case 6:var g=f.e;var h=f.args;var k=g.expr;if(1==k._hx_index)switch(k.i){case "extends":if(1==h.length){f=h[0];var l=[],m=null;m=function(a){var b=a.expr;switch(b._hx_index){case 0:b=b.c;4==b._hx_index?l.push(b.v):e.error("Should be a shader type path",a.pos);break;case 1:l.push(b.i);break;case 3:a=b.f;m(b.e);l.push(a);break;default:e.error("Should be a shader type path",
a.pos)}};m(f);g=null;try{g=this.loadShader(l.join("."))}catch(n){if(k=u.caught(n).unwrap(),k instanceof lb)this.error(w.string(k),f.pos);else throw n;}null!=g&&this.checkExpr(g,b,c,!0)}else this.error("This expression is not allowed at shader declaration level",a.pos);break;case "import":if(1==h.length){f=h[0];var p=[],q=null;q=function(a){var b=a.expr;switch(b._hx_index){case 1:p.push(b.i);break;case 3:a=b.f;q(b.e);p.push(a);break;default:e.error("Should be a shader type path",a.pos)}};q(f);g=null;
try{g=this.loadShader(p.join("."))}catch(n){h=u.caught(n);k=h.unwrap();if(h instanceof vh)throw h;this.error(w.string(k),f.pos)}null!=g&&this.checkExpr(g,b,!0,d)}else this.error("This expression is not allowed at shader declaration level",a.pos);break;default:this.error("This expression is not allowed at shader declaration level",a.pos)}else this.error("This expression is not allowed at shader declaration level",a.pos);break;case 7:a=f.el;for(g=0;g<a.length;)f=a[g],++g,this.checkExpr(f,b,c,d);break;
case 8:b=f.v;for(g=0;g<b.length;){d=b[g];++g;if(null==d.kind)for(d.kind=P.Local,h=0,k=d.qualifiers;h<k.length;)f=k[h],++h,0==f._hx_index&&(d.kind=P.Param);f=null;null!=d.expr&&(d.kind!=P.Param&&d.kind!=P.Local&&this.error("Cannot initialize variable declaration if not @param or local",d.expr.pos),f=this.typeExpr(d.expr,null==d.type?Ja.Value:Ja.With(d.type)),null==d.type?d.type=f.t:this.unify(f.t,d.type,d.expr.pos),this.checkConst(f));null==d.type&&this.error("Type required for variable declaration",
a.pos);if(!c||d.kind!=P.Param){Object.prototype.hasOwnProperty.call(this.vars.h,d.name)&&this.error("Duplicate var decl '"+d.name+"'",a.pos);d=this.makeVar(d,a.pos);k=d.type;switch(k._hx_index){case 10:2==k.dim._hx_index&&1==k.isArray&&this.error("Unsupported texture type",a.pos);break;case 11:h=k.channels,2==k.dim._hx_index?1==k.isArray?this.error("Unsupported texture type",a.pos):3==h&&this.error("Unsupported texture type",a.pos):3==h&&this.error("Unsupported texture type",a.pos)}null!=f?this.inits.push({v:d,
e:f}):null!=d.qualifiers&&0<=d.qualifiers.indexOf(ra.Final)&&this.error("Final variable needs initializer",a.pos);this.vars.h[d.name]=d}}break;case 9:k=f.f;if(c&&("fragment"==k.name||"vertex"==k.name||aa.startsWith(k.name,"__init__")))break;f=0;for(g=b.slice();f<g.length;)h=g[f],++f,h.f.name==k.name&&h.inherit&&D.remove(b,h);b.push({f:k,p:a.pos,inherit:d||c});break;default:this.error("This expression is not allowed at shader declaration level",a.pos)}},checkConst:function(a){var b=a.e;switch(b._hx_index){case 0:break;
case 3:a=b.e;this.checkConst(a);break;case 8:var c=b.e;b=b.args;c=c.e;if(2==c._hx_index)switch(c.g._hx_index){case 41:case 42:case 43:case 44:case 45:case 46:for(c=0;c<b.length;)a=b[c],++c,this.checkConst(a);break;default:this.error("This expression should be constant",a.p)}else this.error("This expression should be constant",a.p);break;case 17:c=b.el;for(b=0;b<c.length;)a=c[b],++b,this.checkConst(a);break;default:this.error("This expression should be constant",a.p)}},makeVar:function(a,b,c){var d=
{id:B.allocVarId(),name:a.name,kind:a.kind,type:a.type,qualifiers:a.qualifiers};null!=c&&(d.parent=c);null==d.kind?d.kind=null==c?P.Local:c.kind:null!=c&&d.kind!=c.kind&&(0==c.kind._hx_index?3!=d.kind._hx_index&&this.error("Variable "+w.string(c.kind)+" cannot be changed to "+w.string(d.kind),b):this.error("Variable "+w.string(c.kind)+" cannot be changed to "+w.string(d.kind),b));if(0<a.qualifiers.length){d.qualifiers=a.qualifiers;for(var e=0,f=a.qualifiers;e<f.length;){var g=f[e];++e;switch(g._hx_index){case 0:for(g=
c;null!=g;)B.isStruct(g)||this.error("@const only allowed in structure",b),g=g.parent;d.kind!=P.Global&&d.kind!=P.Param&&this.error("@const only allowed on parameter or global",b);break;case 2:d.kind!=P.Param&&this.error("@nullable only allowed on parameter or global",b);break;case 3:d.kind!=P.Global&&this.error("@perObject only allowed on global",b);break;case 4:null!=c&&this.error("Cannot have an explicit name for a structure variable",b);d.kind!=P.Global&&this.error("Explicit name is only allowed for global var",
b);break;case 5:null!=c&&this.error("Cannot share a structure field",b);d.kind!=P.Param&&this.error("Can only share a @param",b);break;case 6:g=a.type;if(null==g)this.error("Precision qualifier not supported on "+w.string(a.type),b);else switch(g._hx_index){case 3:break;case 5:1!=g.t._hx_index&&this.error("Precision qualifier not supported on "+w.string(a.type),b);break;default:this.error("Precision qualifier not supported on "+w.string(a.type),b)}break;case 7:g=a.type;if(null==g)this.error("Precision qualifier not supported on "+
w.string(a.type),b);else switch(g._hx_index){case 1:case 3:break;case 5:1!=g.t._hx_index&&this.error("Precision qualifier not supported on "+w.string(a.type),b);break;default:this.error("Precision qualifier not supported on "+w.string(a.type),b)}break;case 9:d.kind!=P.Input&&d.kind!=P.Param&&(d.kind!=P.Global||0>a.qualifiers.indexOf(ra.PerObject))&&this.error("@perInstance only allowed on input/param",b);break;case 11:a.kind!=P.Local&&this.error("Borrow should not have a type qualifier",b);break;
case 12:g=a.type;if(null==g)this.error("Sampler should be on sampler type or sampler array",b);else switch(g._hx_index){case 10:break;case 15:10!=g.t._hx_index&&this.error("Sampler should be on sampler type or sampler array",b);break;default:this.error("Sampler should be on sampler type or sampler array",b)}break;case 13:d.kind!=P.Local&&this.error("final only allowed on local",b);break;case 14:d.kind!=P.Local&&this.error("flat only allowed on local",b)}}}null!=d.type&&(d.type=this.makeVarType(d.type,
d,b));return d},makeVarType:function(a,b,c){var d;switch(a._hx_index){case 13:var e=a.vl;var f=e.slice();b.type=x.TStruct(f);var g=0;for(d=f.length;g<d;){a=g++;var h=f[a];f[a]=this.makeVar({type:h.type,qualifiers:h.qualifiers,name:h.name,kind:h.kind,expr:null},c,b)}return b.type;case 15:f=a.t;h=a.size;15==f._hx_index&&this.error("Multidimentional arrays are not allowed",c);switch(h._hx_index){case 0:g=h;break;case 1:h=h.v;var k=h.name.split(".");var l=null;for(g=0;g<k.length;){var m=k[g];++g;if(null==
l){if(l=this.vars.h[m],null==l&&null!=b){for(d=b;null!=d.parent;)d=d.parent;d.name==m&&(l=d)}}else if(d=l.type,13==d._hx_index){e=d.vl;var p=null;for(l=0;l<e.length;)if(d=e[l],++l,d.name==m){p=d;break}l=p}else l=null;if(null==l)break}null==l&&this.error("Array size variable '"+h.name+"'not found",c);B.isConst(l)||this.error("Array size variable '"+h.name+"'should be a constant",c);g=Ya.SVar(l)}f=this.makeVarType(f,b,c);switch(a._hx_index){case 15:return x.TArray(f,g);case 16:return b=a.kind,x.TBuffer(f,
g,b);default:throw u.thrown("assert");}case 16:f=a.t;h=a.size;15==f._hx_index&&this.error("Multidimentional arrays are not allowed",c);switch(h._hx_index){case 0:g=h;break;case 1:h=h.v;k=h.name.split(".");l=null;for(g=0;g<k.length;){m=k[g];++g;if(null==l){if(l=this.vars.h[m],null==l&&null!=b){for(d=b;null!=d.parent;)d=d.parent;d.name==m&&(l=d)}}else if(d=l.type,13==d._hx_index){e=d.vl;p=null;for(l=0;l<e.length;)if(d=e[l],++l,d.name==m){p=d;break}l=p}else l=null;if(null==l)break}null==l&&this.error("Array size variable '"+
h.name+"'not found",c);B.isConst(l)||this.error("Array size variable '"+h.name+"'should be a constant",c);g=Ya.SVar(l)}f=this.makeVarType(f,b,c);switch(a._hx_index){case 15:return x.TArray(f,g);case 16:return b=a.kind,x.TBuffer(f,g,b);default:throw u.thrown("assert");}default:return a}},isParentArray:function(a){if(null==a.parent)return!1;switch(a.parent.type._hx_index){case 13:return this.isParentArray(a.parent);case 15:return!0;case 16:return!0;default:return!1}},fieldAccess:function(a,b,c,d){c=
a.t;if(13==c._hx_index){var e=c.vl;var f=null;for(c=0;c<e.length;){var g=e[c];++c;if(g.name==b){f=g;break}}c=null==f?null:this.isParentArray(f)?{e:q.TField(a,b),t:f.type,p:d}:{e:q.TVar(f),t:f.type,p:d}}else c=null;if(null!=c)return Rf.FField(c);e=this.globals.h[b];if(null==e){c=a.t;switch(b){case "fetch":switch(c._hx_index){case 10:c=C.Texel;break;case 17:c=C.ChannelFetch;break;default:c=null}break;case "fetchLod":switch(c._hx_index){case 10:c=C.Texel;break;case 17:c=C.ChannelFetch;break;default:c=
null}break;case "get":switch(c._hx_index){case 10:c=C.Texture;break;case 17:c=C.ChannelRead;break;default:c=null}break;case "getLod":switch(c._hx_index){case 10:c=C.TextureLod;break;case 17:c=C.ChannelReadLod;break;default:c=null}break;case "size":switch(c._hx_index){case 10:c=C.TextureSize;break;case 11:c=C.TextureSize;break;case 17:c=C.ChannelTextureSize;break;default:c=null}break;case "store":c=11==c._hx_index?C.ImageStore:null;break;default:c=null}null!=c&&("get"==b&&this.inWhile&&this.error("Cannot use .get() in while loop, use .getLod instead",
d),g=this.globals,c=da.toString(c),e=g.h[c])}if(null!=e){c=e.t;if(14==c._hx_index){f=c.variants;var h=[];for(c=0;c<f.length;)if(g=f[c],++c,0!=g.args.length&&this.tryUnify(a.t,g.args[0].type)){var k=g.args.slice();k.shift();h.push({args:k,ret:g.ret})}if(0<h.length||0==f.length)return Rf.FGlobal(e.g,a,h)}c=a.t;if(28==e.g._hx_index&&15==c._hx_index)return Rf.FField({e:q.TCall({e:q.TGlobal(C.Length),t:x.TVoid,p:d},[a]),t:x.TInt,p:d})}c=a.t;switch(c._hx_index){case 1:g=Q.VInt;f=1;break;case 2:g=Q.VBool;
f=1;break;case 3:g=Q.VFloat;f=1;break;case 5:e=c.size;g=c.t;f=e;break;case 9:e=c.size;g=Q.VFloat;f=e;break;default:g=null,f=0}if(0<f&&4>=b.length){h=[sa.X,sa.Y,sa.Z,sa.W];k=-1;var l=[];c=0;for(e=b.length;c<e;){var m=c++,p="xrsygtzbpwaq".indexOf(b.charAt(m));if(0>p)return null;var t=p%3;if(0>k)k=t;else if(t!=k)return null;p=p/3|0;p>=f&&this.error(B.toString(a.t)+" does not have component "+b.charAt(m),d);l.push(h[p])}return Rf.FField({e:q.TSwiz(a,l),t:1==l.length?B.toType(g):x.TVec(l.length,g),p:d})}return null},
getSizeType:function(a,b){switch(a){case 1:return b==Q.VInt?x.TInt:x.TFloat;case 2:return b==Q.VInt?U.ivec2:U.vec2;case 3:return b==Q.VInt?U.ivec3:U.vec3;case 4:return b==Q.VInt?U.ivec4:U.vec4;default:throw u.thrown("assert");}},specialGlobal:function(a,b,c,d){var e;var f=null;switch(a._hx_index){case 37:1!=c.length&&this.error("TextureSize() requires one single argument",d);var g=c[0].t;switch(g._hx_index){case 10:var h=g.dim;f=g.isArray;f=this.getSizeType(B.getDimSize(h,f),Q.VFloat);break;case 11:h=
g.dim;f=g.isArray;f=this.getSizeType(B.getDimSize(h,f),Q.VFloat);break;default:this.unify(c[0].t,x.TSampler(tb.T2D,!1),c[0].p),f=U.vec2}break;case 41:h=x.TFloat;var k=!1;if(1==c.length&&(h==x.TInt||h==x.TFloat)&&(g=c[0].t,5==g._hx_index)){var l=g.size;g=g.t;g!=Q.VInt&&g!=Q.VFloat||2!=l||(k=!0)}if(!k){for(g=e=0;g<c.length;)if(k=c[g],++g,l=k.t,5==l._hx_index){var m=l.size;f=l.t;B.toType(f)!=h&&this.unify(k.t,h,k.p);e+=m}else this.unifyExpr(k,h),++e;2!=e&&1<e&&this.error(da.toString(a)+" requires 2 "+
B.toString(h)+" values but has "+e,d)}f=x.TVec(2,Q.VFloat);break;case 42:h=x.TFloat;k=!1;1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||3!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,f=l.t,B.toType(f)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);3!=e&&1<e&&this.error(da.toString(a)+" requires 3 "+B.toString(h)+" values but has "+e,d)}f=x.TVec(3,Q.VFloat);break;case 43:h=x.TFloat;k=!1;1!=c.length||
h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||4!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,f=l.t,B.toType(f)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);4!=e&&1<e&&this.error(da.toString(a)+" requires 4 "+B.toString(h)+" values but has "+e,d)}f=x.TVec(4,Q.VFloat);break;case 44:case 45:case 46:switch(a._hx_index){case 44:f=2;break;case 45:f=3;break;case 46:f=4;break;default:throw u.thrown("assert");}if(1==
c.length)switch(c[0].t._hx_index){case 1:case 3:break;default:if(h=x.TInt,k=!1,1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||l!=f||(k=!0))),!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,l=l.t,B.toType(l)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);e!=f&&1<e&&this.error(da.toString(a)+" requires "+f+" "+B.toString(h)+" values but has "+e,d)}}else if(h=x.TInt,k=!1,1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,
5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||l!=f||(k=!0))),!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,l=l.t,B.toType(l)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);e!=f&&1<e&&this.error(da.toString(a)+" requires "+f+" "+B.toString(h)+" values but has "+e,d)}f=x.TVec(f,Q.VInt);break;case 47:h=x.TBool;k=!1;1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||2!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=
c[g],++g,l=k.t,5==l._hx_index?(m=l.size,f=l.t,B.toType(f)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);2!=e&&1<e&&this.error(da.toString(a)+" requires 2 "+B.toString(h)+" values but has "+e,d)}f=x.TVec(2,Q.VBool);break;case 48:h=x.TBool;k=!1;1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||3!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,f=l.t,B.toType(f)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,
h),++e);3!=e&&1<e&&this.error(da.toString(a)+" requires 3 "+B.toString(h)+" values but has "+e,d)}f=x.TVec(3,Q.VBool);break;case 49:h=x.TBool;k=!1;1!=c.length||h!=x.TInt&&h!=x.TFloat||(g=c[0].t,5==g._hx_index&&(l=g.size,g=g.t,g!=Q.VInt&&g!=Q.VFloat||4!=l||(k=!0)));if(!k){for(g=e=0;g<c.length;)k=c[g],++g,l=k.t,5==l._hx_index?(m=l.size,f=l.t,B.toType(f)!=h&&this.unify(k.t,h,k.p),e+=m):(this.unifyExpr(k,h),++e);4!=e&&1<e&&this.error(da.toString(a)+" requires 4 "+B.toString(h)+" values but has "+e,d)}f=
x.TVec(4,Q.VBool);break;case 50:g=[];for(l=0;l<c.length;)k=c[l],++l,g.push(k.t);l=g;switch(l.length){case 1:12==l[0]._hx_index?f=x.TMat2:this.error("Cannot apply "+da.toString(a)+" to these parameters",d);break;case 2:g=l[0];k=l[1];5==g._hx_index?2==g.size?1==g.t._hx_index?5==k._hx_index?2==k.size?1==k.t._hx_index?f=x.TMat2:this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+
" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d);break;case 4:3==l[0]._hx_index?3==l[1]._hx_index?3==l[2]._hx_index?3==l[3]._hx_index?f=x.TMat2:this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+
" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d);break;default:this.error("Cannot apply "+da.toString(a)+" to these parameters",d)}break;case 51:g=[];for(l=0;l<c.length;)k=c[l],++l,g.push(k.t);l=g;switch(l.length){case 1:switch(l[0]._hx_index){case 7:case 8:f=x.TMat3;break;default:this.error("Cannot apply "+da.toString(a)+" to these parameters",d)}break;case 3:g=l[0];k=l[1];h=l[2];5==g._hx_index?3==g.size?1==g.t._hx_index?5==k._hx_index?3==k.size?1==k.t._hx_index?
5==h._hx_index?3==h.size?1==h.t._hx_index?f=x.TMat3:this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+
" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d);break;case 9:3==l[0]._hx_index?3==l[1]._hx_index?3==l[2]._hx_index?3==l[3]._hx_index?3==l[4]._hx_index?3==l[5]._hx_index?3==l[6]._hx_index?3==l[7]._hx_index?3==l[8]._hx_index?f=x.TMat3:this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+
da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d);break;default:this.error("Cannot apply "+da.toString(a)+
" to these parameters",d)}break;case 52:g=[];for(l=0;l<c.length;)k=c[l],++l,g.push(k.t);l=g;switch(l.length){case 1:7==l[0]._hx_index?f=x.TMat4:this.error("Cannot apply "+da.toString(a)+" to these parameters",d);break;case 4:g=l[0];k=l[1];h=l[2];l=l[3];5==g._hx_index?4==g.size?1==g.t._hx_index?5==k._hx_index?4==k.size?1==k.t._hx_index?5==h._hx_index?4==h.size?1==h.t._hx_index?5==l._hx_index?4==l.size?1==l.t._hx_index?f=x.TMat4:this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+
da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",
d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d);break;default:this.error("Cannot apply "+da.toString(a)+" to these parameters",d)}break;case 53:g=[];for(l=0;l<c.length;)k=c[l],++l,g.push(k.t);l=g;switch(l.length){case 1:7==l[0]._hx_index?f=x.TMat3x4:this.error("Cannot apply "+da.toString(a)+" to these parameters",d);break;case 3:g=l[0];k=l[1];
h=l[2];5==g._hx_index?4==g.size?1==g.t._hx_index?5==k._hx_index?4==k.size?1==k.t._hx_index?5==h._hx_index?4==h.size?1==h.t._hx_index?f=x.TMat3x4:this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+
da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d):this.error("Cannot apply "+da.toString(a)+" to these parameters",d);break;default:this.error("Cannot apply "+da.toString(a)+" to these parameters",d)}break;case 68:f=x.TVoid;break;case 79:g=[];for(l=0;l<c.length;)k=c[l],++l,g.push(k.t);l=g;3==l.length?(g=l[0],11==g._hx_index?(h=g.dim,f=g.isArray,g=g.channels,k=l[1],l=l[2],
f=this.getSizeType(B.getDimSize(h,f),Q.VInt),this.unify(k,f,c[1].p),this.unify(l,1==g?x.TFloat:x.TVec(g,Q.VFloat),c[2].p),f=x.TVoid):this.error("Cannot apply "+da.toString(a)+" to these parameters",d)):this.error("Cannot apply "+da.toString(a)+" to these parameters",d)}if(null==f)throw u.thrown("Custom Global not supported "+w.string(a));return{e:q.TCall(b,c),t:f,p:d}},unifyCallParams:function(a,b,c,d){var e;var f=1E3;var g=-1E3;var h=[];for(e=0;e<c.length;){var k=c[e];++e;var l=k.args.length;l<f&&
(f=l);l>g&&(g=l);l==b.length&&h.push(k)}switch(h.length){case 0:if(0==c.length){e=a.e;if(2==e._hx_index){var m=e.g;e=[];for(g=0;g<b.length;)k=b[g],++g,e.push(this.typeExpr(k,Ja.Value));return this.specialGlobal(m,a,e,d)}throw u.thrown("assert");}return this.error("Function expects "+(f==g?""+f:f+"-"+g)+" arguments",d);case 1:l=h[0];m=[];e=0;for(g=b.length;e<g;){f=e++;h=l.args[f].type;k=this.typeExpr(b[f],Ja.With(h));try{this.unifyExpr(k,h)}catch(r){a=u.caught(r).unwrap();if(a instanceof lb)throw m=
a,m.msg+=" for argument '"+l.args[f].name+"'",u.thrown(m);throw r;}m.push(k)}1<c.length&&(a.t=x.TFun([l]));return{e:q.TCall(a,m),t:l.ret,p:d};default:c=null;var p=-1;for(e=0;e<h.length;){l=h[e];++e;var t=[];g=0;for(var n=b.length;g<n;){f=g++;k=this.typeExpr(b[f],Ja.With(l.args[f].type));if(!this.tryUnify(k.t,l.args[f].type))break;t.push(k)}if(t.length>p&&(c=l,p=t.length,p==b.length))return a.t=x.TFun([l]),{e:q.TCall(a,t),t:l.ret,p:d}}e=0;for(g=b.length;e<g;){f=e++;try{m=this.typeExpr(b[f],Ja.Value),
this.unify(m.t,c.args[f].type,m.p)}catch(r){a=u.caught(r).unwrap();if(a instanceof lb)throw a.msg+=" for argument '"+c.args[f].name+"'",u.thrown(a);throw r;}}throw u.thrown("assert");}},toFloat:function(a){if(a.t!=x.TInt)throw u.thrown("assert");var b=a.e;0==b._hx_index?(b=b.c,a.e=2==b._hx_index?q.TConst(K.CFloat(b.v)):q.TCall({e:q.TGlobal(C.ToFloat),t:x.TFun([]),p:a.p},[{e:a.e,t:a.t,p:a.p}])):a.e=q.TCall({e:q.TGlobal(C.ToFloat),t:x.TFun([]),p:a.p},[{e:a.e,t:a.t,p:a.p}]);a.t=x.TFloat},typeBinop:function(a,
b,c,d){switch(a._hx_index){case 4:throw u.thrown("assert");case 5:case 6:case 7:case 8:case 9:case 10:var e=b.t;switch(e._hx_index){case 2:if(a!=ha.OpEq&&a!=ha.OpNotEq||c.t==x.TVoid){var f=b.e;var g=c.e;switch(f._hx_index){case 0:return 0==f.c._hx_index&&1==g._hx_index?(c=g.v,B.hasQualifier(c,ra.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d);case 1:return 0==g._hx_index&&0==g.c._hx_index?(c=f.v,B.hasQualifier(c,
ra.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d);default:return this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d)}}else return this.unifyExpr(c,b.t),x.TBool;case 1:case 3:case 4:if(c.t!=x.TVoid)return this.unifyExpr(c,b.t),x.TBool;f=b.e;g=c.e;switch(f._hx_index){case 0:return 0==f.c._hx_index&&1==g._hx_index?(c=g.v,B.hasQualifier(c,ra.Nullable)||this.error("Variable is not declared as nullable",
b.p),x.TBool):this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d);case 1:return 0==g._hx_index&&0==g.c._hx_index?(c=f.v,B.hasQualifier(c,ra.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d);default:return this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d)}case 5:if(c.t!=x.TVoid)return this.unifyExpr(c,b.t),b.t;e=b.e;f=c.e;switch(e._hx_index){case 0:return 0==e.c._hx_index&&
1==f._hx_index?(c=f.v,B.hasQualifier(c,ra.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d);case 1:return 0==f._hx_index&&0==f.c._hx_index?(c=e.v,B.hasQualifier(c,ra.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d);default:return this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d)}default:switch(e=
b.e,f=c.e,e._hx_index){case 0:return 0==e.c._hx_index&&1==f._hx_index?(c=f.v,B.hasQualifier(c,ra.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d);case 1:return 0==f._hx_index&&0==f.c._hx_index?(c=e.v,B.hasQualifier(c,ra.Nullable)||this.error("Variable is not declared as nullable",b.p),x.TBool):this.error("Cannot compare "+B.toString(b.t)+" and "+B.toString(c.t),d);default:return this.error("Cannot compare "+
B.toString(b.t)+" and "+B.toString(c.t),d)}}case 11:case 12:case 13:case 16:case 17:case 18:return this.unifyExpr(b,x.TInt),this.unifyExpr(c,x.TInt),x.TInt;case 14:case 15:return this.unifyExpr(b,x.TBool),this.unifyExpr(c,x.TBool),x.TBool;case 0:case 1:case 2:case 3:case 19:if(e=b.t,f=c.t,1==a._hx_index)switch(e._hx_index){case 1:switch(f._hx_index){case 1:return x.TInt;case 3:return this.toFloat(b),x.TFloat;case 5:if(1==f.t._hx_index)return this.toFloat(b),c.t;switch(a._hx_index){case 0:a="add";
break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}case 3:switch(f._hx_index){case 1:return this.toFloat(c),x.TFloat;case 3:return x.TFloat;
case 5:if(1==f.t._hx_index)return c.t;switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}case 5:switch(g=
e.size,e=e.t,g){case 2:if(1==e._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,Q.VFloat);switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;
case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);case 12:return U.vec2;default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}else{switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";
break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}case 3:if(1==e._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,Q.VFloat);switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),
d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);case 6:return U.vec3;case 8:return U.vec3;default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),
d)}else{switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}case 4:if(1==e._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,Q.VFloat);switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a=
"subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);case 7:return U.vec4;default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;
default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}else{switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}default:if(1==e._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,
Q.VFloat);switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);default:switch(a._hx_index){case 0:a=
"add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}else{switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}}case 7:if(7==f._hx_index)return x.TMat4;switch(a._hx_index){case 0:a=
"add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}else switch(e._hx_index){case 1:switch(f._hx_index){case 1:return x.TInt;
case 3:return this.toFloat(b),x.TFloat;case 5:if(1==f.t._hx_index)return this.toFloat(b),c.t;switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+
a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}case 3:switch(f._hx_index){case 1:return this.toFloat(c),x.TFloat;case 3:return x.TFloat;case 5:if(1==f.t._hx_index)return c.t;switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;
case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}case 5:if(g=e.size,1==e.t._hx_index)switch(f._hx_index){case 1:return this.toFloat(c),b.t;case 3:return b.t;case 5:if(1==f.t._hx_index){f=f.size;if(g==f)return x.TVec(g,Q.VFloat);switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+
B.toString(b.t)+" and "+B.toString(c.t),d)}switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d);default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),
d)}else{switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}default:switch(a._hx_index){case 0:a="add";break;case 1:a="multiply";break;case 2:a="divide";break;case 3:a="subtract";break;default:throw u.thrown("assert");}return this.error("Cannot "+a+" "+B.toString(b.t)+" and "+B.toString(c.t),d)}case 20:throw u.thrown("assert");
case 21:return this.unifyExpr(b,x.TInt),this.unifyExpr(c,x.TInt),x.TArray(x.TInt,Ya.SConst(0));default:return this.error("Unsupported operator "+w.string(a),d)}},__class__:U};var Jg=function(){this.varMap=new Da};z["hxsl.Clone"]=Jg;Jg.__name__="hxsl.Clone";Jg.shaderData=function(a){return(new Jg).shader(a)};Jg.prototype={tvar:function(a){var b=this.varMap.h[a.id];if(null!=b)return b;b={id:B.allocVarId(),type:a.type,name:a.name,kind:a.kind};this.varMap.h[a.id]=b;null!=a.parent&&(b.parent=this.tvar(a.parent));
null!=a.qualifiers&&(b.qualifiers=a.qualifiers.slice());b.type=this.ttype(a.type);return b},tfun:function(a){for(var b=this.ttype(a.ret),c=a.kind,d=this.tvar(a.ref),e=[],f=0,g=a.args;f<g.length;){var h=g[f];++f;e.push(this.tvar(h))}return{ret:b,kind:c,ref:d,args:e,expr:this.texpr(a.expr)}},ttype:function(a){switch(a._hx_index){case 13:var b=a.vl;a=[];for(var c=0;c<b.length;){var d=b[c];++c;a.push(this.tvar(d))}return x.TStruct(a);case 14:return x.TFun(a.variants);case 15:d=a.size;a=this.ttype(a.t);
switch(d._hx_index){case 0:b=d;break;case 1:d=d.v,b=Ya.SVar(this.tvar(d))}return x.TArray(a,b);default:return a}},texpr:function(a){var b=B.map(a,M(this,this.texpr));b.t=this.ttype(a.t);var c=b.e;switch(c._hx_index){case 1:a=c.v;a=q.TVar(this.tvar(a));break;case 7:a=c.v;var d=c.init;a=q.TVarDecl(this.tvar(a),d);break;case 13:a=c.v;d=c.it;c=c.loop;a=q.TFor(this.tvar(a),d,c);break;default:a=b.e}b.e=a;return b},shader:function(a){for(var b=a.name,c=[],d=0,e=a.vars;d<e.length;){var f=e[d];++d;c.push(this.tvar(f))}f=
c;c=[];d=0;for(e=a.funs;d<e.length;)a=e[d],++d,c.push(this.tfun(a));return{name:b,vars:f,funs:c}},__class__:Jg};var Kj=function(){};z["hxsl._Dce.Exit"]=Kj;Kj.__name__="hxsl._Dce.Exit";Kj.prototype={__class__:Kj};var sj=function(a){this.fields=0;this.v=a};z["hxsl._Dce.VarRel"]=sj;sj.__name__="hxsl._Dce.VarRel";sj.prototype={__class__:sj};var tj=function(a){this.keep=this.used=0;this.v=a;this.deps=new Da;this.adeps=[]};z["hxsl._Dce.VarDeps"]=tj;tj.__name__="hxsl._Dce.VarDeps";tj.prototype={__class__:tj};
var Rd=function(){this.vars=[];this.bits=[]};z["hxsl._Dce.WriteTo"]=Rd;Rd.__name__="hxsl._Dce.WriteTo";Rd.prototype={push:function(a,b){this.vars.push(a);this.bits.push(b)},pop:function(){this.vars.pop();this.bits.pop()},append:function(a,b){for(var c=0,d=this.vars;c<d.length;){var e=d[c],f=c++;if(e==a){this.bits[f]|=b;return}}this.push(a,b)},appendTo:function(a){for(var b=0,c=this.vars;b<c.length;){var d=c[b],e=b++;a.append(d,this.bits[e])}},__class__:Rd};var pj=function(){};z["hxsl.Dce"]=pj;pj.__name__=
"hxsl.Dce";pj.prototype={dce:function(a){var b,c;this.used=new Da;this.channelVars=[];var d=[];for(b=0;b<a.length;){var e=a[b];++b;var f=0;for(c=e.vars;f<c.length;){var g=c[f];++f;var h=this.get(g);g.kind==P.Input&&d.push(h);if(g.kind!=P.Output)switch(e=g.type,e._hx_index){case 11:g=!0;break;case 16:g=2==e.kind._hx_index;break;default:g=!1}else g=!0;g&&(h.keep=15)}}for(b=0;b<a.length;)for(e=a[b],++b,f=0,c=e.funs;f<c.length;)h=c[f],++f,this.check(h.expr,new Rd,new Rd);do{sb.TRACE&&Ka.trace("DCE LOOP",
{fileName:"hxsl/Debug.hx",lineNumber:9,className:"hxsl.Dce",methodName:"dce"});for(g=this.used.iterator();g.hasNext();)c=g.next(),0!=c.keep&&this.markRec(c,c.keep);for(;1<d.length&&0==d[d.length-1].used;)d.pop();for(b=0;b<d.length;)c=d[b],++b,this.markRec(c,15);g=[];for(f=0;f<a.length;)for(e=a[f],++f,c=0,e=e.funs;c<e.length;)h=e[c],++c,g.push(this.mapExpr(h.expr,!1));this.markAsKeep=!1;for(b=0;b<g.length;)c=g[b],++b,this.checkBranches(c)}while(this.markAsKeep);for(b=0;b<a.length;)for(e=a[b],++b,f=
0,c=e.funs;f<c.length;)h=c[f],++f,h.expr=g.shift();for(g=this.used.iterator();g.hasNext();)if(c=g.next(),0==c.used&&c.v.kind!=P.Input)for(b=0;b<a.length;)e=a[b],++b,D.remove(e.vars,c.v);return a.slice()},get:function(a){var b=this.used.h[a.id];null==b&&(b=new tj(a),this.used.h[a.id]=b);return b},varName:function(a,b){null==b&&(b=15);return sb.varName(a,b)},markRec:function(a,b){if((a.used&b)!=b){b&=~a.used;sb.TRACE&&Ka.trace(this.varName(a.v,b)+" is used",{fileName:"hxsl/Debug.hx",lineNumber:9,className:"hxsl.Dce",
methodName:"markRec"});a.used|=b;var c=0;for(a=a.adeps;c<a.length;){var d=a[c];++c;var e=this.makeFieldsBits(15,b);0!=(d.fields&e)&&this.markRec(d.v,this.extractFieldsBits(d.fields,b))}}},extractFieldsBits:function(a,b){return((0==(b&1)?0:a)|(0==(b&2)?0:a>>4)|(0==(b&4)?0:a>>8)|(0==(b&8)?0:a>>12))&15},makeFieldsBits:function(a,b){return a*((b&1)+((b&2)<<3)+((b&4)<<6)+((b&8)<<9))},link:function(a,b,c){null==c&&(c=15);for(var d=this.get(a),e=0,f=b.vars;e<f.length;){var g=f[e],h=e++;if(null==g)0==d.keep&&
(sb.TRACE&&Ka.trace("Force keep "+this.varName(d.v),{fileName:"hxsl/Debug.hx",lineNumber:9,className:"hxsl.Dce",methodName:"link"}),d.keep=15,this.markAsKeep=!0);else{var k=g.deps.h[a.id];null==k&&(k=new sj(d),g.deps.h[a.id]=k,g.adeps.push(k));var l=this.makeFieldsBits(c,b.bits[h]);(k.fields&l)!=l&&(k.fields|=l,sb.TRACE&&Ka.trace(this.varName(g.v,b.bits[h])+" depends on "+this.varName(d.v,c),{fileName:"hxsl/Debug.hx",lineNumber:9,className:"hxsl.Dce",methodName:"link"}))}}},swizBits:function(a){for(var b=
0,c=0;c<a.length;){var d=a[c];++c;b|=1<<d._hx_index}return b},check:function(a,b,c){var d,e=this;var f=a.e;switch(f._hx_index){case 1:var g=f.v;this.link(g,b);break;case 4:g=f.el;a=new Rd;var h=0;for(d=g.length;h<d;){var k=h++;this.check(g[k],k<g.length-1?a:b,c)}break;case 5:h=f.op;d=f.e1;var l=f.e2;switch(h._hx_index){case 4:var m=d.e;var p=d.p;p=d.t;switch(m._hx_index){case 1:g=m.v;a=l;g=this.get(g);b.push(g,15);this.check(a,b,c);b.pop();c.append(g,15);break;case 9:p=m.e;var q=m.regs;var n=p.e;
var r=p.p;r=p.t;switch(n._hx_index){case 1:g=n.v;k=q;a=l;g=this.get(g);k=this.swizBits(k);b.push(g,k);this.check(a,b,c);b.pop();c.append(g,k);break;case 16:p=n.e;q=p.e;r=p.p;r=p.t;1==q._hx_index?(g=q.v,k=n.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(p=this,B.iter(a,function(a){p.check(a,b,c)}));break;default:q=this,B.iter(a,function(a){q.check(a,b,c)})}break;case 16:n=m.e;r=n.e;var u=n.p;u=n.t;1==r._hx_index?(g=r.v,k=m.index,a=l,g=this.get(g),
b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(n=this,B.iter(a,function(a){n.check(a,b,c)}));break;case 21:r=m.e;u=m.name;m=r.e;u=r.p;u=r.t;if(16==m._hx_index){r=m.e;u=r.e;var v=r.p;v=r.t;1==u._hx_index?(g=u.v,k=m.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(m=this,B.iter(a,function(a){m.check(a,b,c)}))}else r=this,B.iter(a,function(a){r.check(a,b,c)});break;default:u=this,B.iter(a,function(a){u.check(a,b,c)})}break;case 20:v=
h.op;h=d.e;v=d.p;v=d.t;switch(h._hx_index){case 1:g=h.v;a=l;g=this.get(g);b.push(g,15);this.check(a,b,c);b.pop();c.append(g,15);break;case 9:d=h.e;v=h.regs;var w=d.e;var x=d.p;x=d.t;switch(w._hx_index){case 1:g=w.v;k=v;a=l;g=this.get(g);k=this.swizBits(k);b.push(g,k);this.check(a,b,c);b.pop();c.append(g,k);break;case 16:d=w.e;v=d.e;x=d.p;x=d.t;1==v._hx_index?(g=v.v,k=w.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(d=this,B.iter(a,function(a){d.check(a,
b,c)}));break;default:v=this,B.iter(a,function(a){v.check(a,b,c)})}break;case 16:w=h.e;x=w.e;var z=w.p;z=w.t;1==x._hx_index?(g=x.v,k=h.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(w=this,B.iter(a,function(a){w.check(a,b,c)}));break;case 21:x=h.e;z=h.name;h=x.e;z=x.p;z=x.t;if(16==h._hx_index){x=h.e;z=x.e;var A=x.p;A=x.t;1==z._hx_index?(g=z.v,k=h.index,a=l,g=this.get(g),b.push(g,15),this.check(k,b,c),this.check(a,b,c),b.pop(),c.append(g,15)):(h=this,
B.iter(a,function(a){h.check(a,b,c)}))}else l=this,B.iter(a,function(a){l.check(a,b,c)});break;default:x=this,B.iter(a,function(a){x.check(a,b,c)})}break;default:z=this,B.iter(a,function(a){z.check(a,b,c)})}break;case 7:g=f.v;k=f.init;null!=k?(b.push(this.get(g),15),this.check(k,b,c),b.pop()):(A=this,B.iter(a,function(a){A.check(a,b,c)}));break;case 8:var C=f.e;var D=f.args;var E=C.e;var F=C.p;F=C.t;if(2==E._hx_index)switch(E.g._hx_index){case 64:if(3==D.length){C=D[0];E=D[2];F=C.e;var H=C.p;H=C.t;
1==F._hx_index?(C=E.e,H=E.p,H=E.t,0==C._hx_index?(E=C.c,2==E._hx_index?(k=E.v,a=D[1],g=F.v,this.check(a,b,c),null==this.channelVars[k]?(this.channelVars[k]=g,this.link(g,b)):this.link(this.channelVars[k],b)):(C=this,B.iter(a,function(a){C.check(a,b,c)}))):(E=this,B.iter(a,function(a){E.check(a,b,c)}))):(F=this,B.iter(a,function(a){F.check(a,b,c)}))}else H=this,B.iter(a,function(a){H.check(a,b,c)});break;case 65:if(4==D.length){var I=D[0];var J=D[3];var K=I.e;var M=I.p;M=I.t;if(1==K._hx_index)if(I=
J.e,M=J.p,M=J.t,0==I._hx_index)if(J=I.c,2==J._hx_index){k=J.v;var L=D[2];a=D[1];g=K.v;this.check(a,b,c);this.check(L,b,c);null==this.channelVars[k]?(this.channelVars[k]=g,this.link(g,b)):this.link(this.channelVars[k],b)}else I=this,B.iter(a,function(a){I.check(a,b,c)});else J=this,B.iter(a,function(a){J.check(a,b,c)});else K=this,B.iter(a,function(a){K.check(a,b,c)})}else M=this,B.iter(a,function(a){M.check(a,b,c)});break;case 79:if(3==D.length){var N=D[0];var O=N.e;var P=N.p;P=N.t;1==O._hx_index?
(g=O.v,a=D[1],k=D[2],g=this.get(g),b.push(g,15),this.check(a,b,c),this.check(k,b,c),b.pop(),c.append(g,15)):(D=this,B.iter(a,function(a){D.check(a,b,c)}))}else N=this,B.iter(a,function(a){N.check(a,b,c)});break;default:O=this,B.iter(a,function(a){O.check(a,b,c)})}else P=this,B.iter(a,function(a){P.check(a,b,c)});break;case 9:var Q=f.e;var R=Q.e;L=Q.p;L=Q.t;1==R._hx_index?(g=R.v,k=f.regs,this.link(g,b,this.swizBits(k))):(Q=this,B.iter(a,function(a){Q.check(a,b,c)}));break;case 10:a=f.econd;k=f.eif;
L=f.eelse;g=new Rd;this.check(k,b,g);null!=L&&this.check(L,b,g);g.appendTo(c);b.appendTo(g);this.check(a,g,c);break;case 13:g=f.v;a=f.it;k=f.loop;g=new Rd;this.check(k,b,g);g.appendTo(c);this.check(a,g,c);break;case 19:R=f.normalWhile;a=f.e;k=f.loop;g=new Rd;this.check(k,b,g);g.appendTo(c);b.appendTo(g);this.check(a,g,c);break;case 22:R=f.target;R=f.code;a=f.args;for(f=0;f<a.length;)if(g=a[f],++f,g.access!=kc.Read)for(k=[[]],L=[null],L[0]=function(a,b){return function(c){var d=c.e;1==d._hx_index?
b[0].push(e.get(d.v)):B.iter(c,a[0])}}(L,k),L[0](g.e),R=0;R<k[0].length;){g=k[0][R];++R;b.push(g,15);for(L=0;L<a.length;){var S=a[L];++L;S.access!=kc.Write&&this.check(S.e,b,c)}b.pop();c.append(g,15)}else this.check(g.e,b,c);break;default:f=this,B.iter(a,function(a){f.check(a,b,c)})}},checkBranches:function(a){var b=a.e;switch(b._hx_index){case 10:b=b.econd;var c=new Rd;c.append(null,0);this.check(b,c,new Rd);break;case 19:b=b.e,c=new Rd,c.append(null,0),this.check(b,c,new Rd)}B.iter(a,M(this,this.checkBranches))},
mapExpr:function(a,b){var c,d,e=this;var f=a.e;switch(f._hx_index){case 4:f=f.el;var g=[];for(c=d=0;c<f.length;){var h=f[c];++c;var k=b&&d==f.length-1;h=this.mapExpr(h,k);(B.hasSideEffect(h)||k)&&g.push(h);++d}return{e:q.TBlock(g),p:a.p,t:a.t};case 5:switch(c=f.op,b=f.e1,f=f.e2,c._hx_index){case 4:switch(d=b.e,g=b.p,g=b.t,d._hx_index){case 1:return b=d.v,h=f,0==this.get(b).used?null!=h&&B.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(K.CNull),t:a.t,p:a.p}:B.map(a,function(a){return e.mapExpr(a,
!0)});case 9:g=d.e;h=g.e;if(1==h._hx_index){g=h.v;h=f;if(0==this.get(g).used)return null!=h&&B.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(K.CNull),t:a.t,p:a.p};c=d.regs;h=f;return 0==(this.get(g).used&this.swizBits(c))?B.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(K.CNull),t:a.t,p:a.p}:B.map(a,function(a){return e.mapExpr(a,!0)})}return B.map(a,function(a){return e.mapExpr(a,!0)});case 16:return g=d.e,h=d.index,d=g.e,h=g.p,h=g.t,1==d._hx_index?(b=d.v,h=f,0==this.get(b).used?null!=h&&B.hasSideEffect(h)?
this.mapExpr(h,!1):{e:q.TConst(K.CNull),t:a.t,p:a.p}:B.map(a,function(a){return e.mapExpr(a,!0)})):B.map(a,function(a){return e.mapExpr(a,!0)});default:return B.map(a,function(a){return e.mapExpr(a,!0)})}case 20:switch(d=c.op,c=b.e,d=b.p,d=b.t,c._hx_index){case 1:return b=c.v,h=f,0==this.get(b).used?null!=h&&B.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(K.CNull),t:a.t,p:a.p}:B.map(a,function(a){return e.mapExpr(a,!0)});case 9:b=c.e;d=b.e;g=b.p;g=b.t;if(1==d._hx_index){b=d.v;h=f;if(0==this.get(b).used)return null!=
h&&B.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(K.CNull),t:a.t,p:a.p};c=c.regs;h=f;return 0==(this.get(b).used&this.swizBits(c))?B.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(K.CNull),t:a.t,p:a.p}:B.map(a,function(a){return e.mapExpr(a,!0)})}return B.map(a,function(a){return e.mapExpr(a,!0)});case 16:return b=c.e,d=c.index,c=b.e,d=b.p,d=b.t,1==c._hx_index?(b=c.v,h=f,0==this.get(b).used?null!=h&&B.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(K.CNull),t:a.t,p:a.p}:B.map(a,function(a){return e.mapExpr(a,
!0)})):B.map(a,function(a){return e.mapExpr(a,!0)});default:return B.map(a,function(a){return e.mapExpr(a,!0)})}default:return B.map(a,function(a){return e.mapExpr(a,!0)})}case 7:return b=f.v,h=f.init,0==this.get(b).used?null!=h&&B.hasSideEffect(h)?this.mapExpr(h,!1):{e:q.TConst(K.CNull),t:a.t,p:a.p}:B.map(a,function(a){return e.mapExpr(a,!0)});case 8:if(c=f.e,b=f.args,f=c.e,d=c.p,d=c.t,2==f._hx_index)switch(f.g._hx_index){case 64:return 3==b.length&&(c=b[0],c=b[2],f=c.e,d=c.p,d=c.t,0==f._hx_index&&
(c=f.c,2==c._hx_index))?(c=c.v,f=b[1],b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(C.Texture),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},this.mapExpr(f,!0)]),t:x.TVoid,p:a.p}):B.map(a,function(a){return e.mapExpr(a,!0)});case 65:return 4==b.length&&(c=b[0],c=b[3],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index))?(c=c.v,h=b[2],f=b[1],b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(C.TextureLod),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},this.mapExpr(f,!0),this.mapExpr(h,!0)]),t:x.TVoid,
p:a.p}):B.map(a,function(a){return e.mapExpr(a,!0)});case 66:switch(b.length){case 3:return c=b[0],c=b[2],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index)?(c=c.v,f=b[1],b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(C.Texel),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},this.mapExpr(f,!0)]),t:x.TVoid,p:a.p}):B.map(a,function(a){return e.mapExpr(a,!0)});case 4:return c=b[0],c=b[3],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index)?(c=c.v,h=b[2],f=b[1],b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(C.Texel),
p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},this.mapExpr(f,!0),this.mapExpr(h,!0)]),t:x.TVoid,p:a.p}):B.map(a,function(a){return e.mapExpr(a,!0)});default:return B.map(a,function(a){return e.mapExpr(a,!0)})}case 67:switch(b.length){case 2:return c=b[0],c=b[1],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index)?(c=c.v,b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(C.TextureSize),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p}]),t:x.TVoid,p:a.p}):B.map(a,function(a){return e.mapExpr(a,!0)});case 3:return c=
b[0],c=b[2],f=c.e,d=c.p,d=c.t,0==f._hx_index&&(c=f.c,2==c._hx_index)?(c=c.v,h=b[1],b=this.channelVars[c],{e:q.TCall({e:q.TGlobal(C.TextureSize),p:a.p,t:x.TVoid},[{e:q.TVar(b),t:b.type,p:a.p},this.mapExpr(h,!0)]),t:x.TVoid,p:a.p}):B.map(a,function(a){return e.mapExpr(a,!0)});default:return B.map(a,function(a){return e.mapExpr(a,!0)})}default:return B.map(a,function(a){return e.mapExpr(a,!0)})}else return B.map(a,function(a){return e.mapExpr(a,!0)});case 10:return h=f.econd,a=f.eif,c=f.eelse,h=this.mapExpr(h,
!0),a=this.mapExpr(a,b),c=null==c?null:this.mapExpr(c,b),b||B.hasSideEffect(a)||null!=c&&B.hasSideEffect(c)?{e:q.TIf(h,a,c),p:h.p,t:h.t}:{e:q.TConst(K.CNull),t:h.t,p:h.p};case 13:return b=f.v,c=f.loop,h=this.mapExpr(f.it,!0),c=this.mapExpr(c,!1),B.hasSideEffect(c)?{e:q.TFor(b,h,c),p:a.p,t:a.t}:{e:q.TConst(K.CNull),t:a.t,p:a.p};case 19:return h=f.e,c=f.loop,a=f.normalWhile,h=this.mapExpr(h,!0),c=this.mapExpr(c,b),B.hasSideEffect(c)?{e:q.TWhile(h,c,a),p:h.p,t:h.t}:{e:q.TConst(K.CNull),t:h.t,p:h.p};
case 20:return h=f.m,c=f.args,f=this.mapExpr(f.e,b),b||B.hasSideEffect(f)?{e:q.TMeta(h,c,f),t:a.t,p:a.p}:{e:q.TConst(K.CNull),t:a.t,p:a.p};default:return B.map(a,function(a){return e.mapExpr(a,!0)})}},__class__:pj};var sb=function(){};z["hxsl.Debug"]=sb;sb.__name__="hxsl.Debug";sb.varName=function(a,b){null==b&&(b=15);var c=a.name;15!=b&&(c+=sb.swizStr(b));return sb.VAR_IDS?c+"@"+a.id:c};sb.swizStr=function(a){var b=".";0!=(a&1)&&(b+="x");0!=(a&2)&&(b+="y");0!=(a&4)&&(b+="z");0!=(a&8)&&(b+="w");return b};
var uj=function(){this.mapped=[];this.varMap=new vc;this.funMap=new vc;this.constants=new Da};z["hxsl.Eval"]=uj;uj.__name__="hxsl.Eval";uj.prototype={setConstant:function(a,b){this.constants.h[a.id]=q.TConst(b)},mapVar:function(a,b){var c,d=this.varMap.h[a.__id__];if(null!=d)return d;if(null!=a.parent&&(this.mapVar(a.parent,b),d=this.varMap.h[a.__id__],null!=d))return a==d?d:this.mapVar(d,b);var e=a.type;d={id:17==e._hx_index?a.id:B.allocVarId(),name:a.name,type:a.type,kind:a.kind};null!=a.parent&&
(d.parent=this.mapVar(a.parent,b));null!=a.qualifiers&&(d.qualifiers=a.qualifiers.slice());this.varMap.set(a,d);this.varMap.set(d,d);b&&this.mapped.push(a);e=d.type;switch(e._hx_index){case 13:e=e.vl;var f=[];for(c=0;c<e.length;)a=e[c],++c,f.push(this.mapVar(a,b));d.type=x.TStruct(f);break;case 15:f=e.size;if(1==f._hx_index)if(a=f.v,c=e.t,f=this.constants.h[a.id],null!=f)if(null==f)lb.t("Integer value expected for array size constant "+a.name,null);else if(0==f._hx_index)if(f=f.c,2==f._hx_index){a=
f.v;f=d.type;switch(f._hx_index){case 15:b=x.TArray(c,Ya.SConst(a));break;case 16:f=f.kind;b=x.TBuffer(c,Ya.SConst(a),f);break;default:throw u.thrown("assert");}d.type=b}else lb.t("Integer value expected for array size constant "+a.name,null);else lb.t("Integer value expected for array size constant "+a.name,null);else{b=this.mapVar(a,b);f=d.type;switch(f._hx_index){case 15:b=x.TArray(c,Ya.SVar(b));break;case 16:f=f.kind;b=x.TBuffer(c,Ya.SVar(b),f);break;default:throw u.thrown("assert");}d.type=b}break;
case 16:if(f=e.size,1==f._hx_index)if(a=f.v,c=e.t,f=this.constants.h[a.id],null!=f)if(null==f)lb.t("Integer value expected for array size constant "+a.name,null);else if(0==f._hx_index)if(e=f.c,2==e._hx_index){a=e.v;e=d.type;switch(e._hx_index){case 15:b=x.TArray(c,Ya.SConst(a));break;case 16:f=e.kind;b=x.TBuffer(c,Ya.SConst(a),f);break;default:throw u.thrown("assert");}d.type=b}else lb.t("Integer value expected for array size constant "+a.name,null);else lb.t("Integer value expected for array size constant "+
a.name,null);else{b=this.mapVar(a,b);e=d.type;switch(e._hx_index){case 15:b=x.TArray(c,Ya.SVar(b));break;case 16:f=e.kind;b=x.TBuffer(c,Ya.SVar(b),f);break;default:throw u.thrown("assert");}d.type=b}}return d},checkTextureRec:function(a){if(B.isTexture(a))return!0;switch(a._hx_index){case 13:a=a.vl;for(var b=0;b<a.length;){var c=a[b];++b;if(this.checkTextureRec(c.type))return!0}break;case 15:return this.checkTextureRec(a.t);case 16:return!0}return!1},needsInline:function(a){var b=0;for(a=a.args;b<
a.length;){var c=a[b];++b;if(this.checkTextureRec(c.type))return!0}return!1},eval:function(a){for(var b,c=[],d=0,e=a.funs;d<e.length;){var f=e[d];++d;var g=f.kind,h=this.mapVar(f.ref,!1);b=[];for(var k=0,l=f.args;k<l.length;){var m=l[k];++k;b.push(this.mapVar(m,!1))}b={kind:g,ref:h,args:b,ret:f.ret,expr:f.expr};f.kind==Ia.Helper&&this.inlineCalls||this.needsInline(b)?this.funMap.set(b.ref,f):c.push(b)}d=0;for(e=c.length;d<e;)b=d++,this.curFun=c[b],this.curFun.expr=this.evalExpr(this.curFun.expr,!1);
f=a.name;d=[];e=0;for(b=a.vars;e<b.length;)a=b[e],++e,d.push(this.mapVar(a,!1));return{name:f,vars:d,funs:c}},hasReturn:function(a){this.markReturn=!1;this.hasReturnLoop(a);return this.markReturn},hasReturnLoop:function(a){12==a.e._hx_index?this.markReturn=!0:this.markReturn||B.iter(a,M(this,this.hasReturnLoop))},handleReturn:function(a,b){null==b&&(b=!1);var c=a.e;switch(c._hx_index){case 3:var d=c.e;b=this.handleReturn(d,b);return{e:q.TParenthesis(b),t:b.t,p:a.p};case 4:var e=c.el,f=0,g=e.length;
c=[];a:for(;f<g;){var h=e[f++];if(f==g)c.push(this.handleReturn(h,b));else{var k=h.e;switch(k._hx_index){case 10:if(null==k.eelse)if(d=k.eif,k=k.econd,b&&this.hasReturn(d)){c.push(this.handleReturn({e:q.TIf(k,d,{e:q.TBlock(e.slice(f)),t:h.t,p:h.p}),t:h.t,p:h.p}));break a}else c.push(this.handleReturn(h));else c.push(this.handleReturn(h));break;case 12:c.push(this.handleReturn(k.e,b));break a;default:c.push(this.handleReturn(h))}}}b=b?0==c.length?x.TVoid:c[c.length-1].t:a.t;return{e:q.TBlock(c),t:b,
p:a.p};case 10:return e=c.econd,d=c.eif,c=c.eelse,null!=c&&b?(e=this.handleReturn(e),d=this.handleReturn(d,b),{e:q.TIf(e,d,this.handleReturn(c,b)),t:d.t,p:a.p}):B.map(a,M(this,this.handleReturnDef));case 12:return d=c.e,b||lb.t("Cannot inline not final return",a.p),null==d?{e:q.TBlock([]),t:x.TVoid,p:a.p}:this.handleReturn(d,!0);default:return B.map(a,M(this,this.handleReturnDef))}},handleReturnDef:function(a){return this.handleReturn(a)},evalCall:function(a,b,c,d){var e;switch(a._hx_index){case 28:if(1==
b.length){var f=b[0];var g=f.e;if(1==g._hx_index&&(f=g.v,f=f.type,15==f._hx_index&&(g=f.size,0==g._hx_index)))return f=g.v,q.TConst(K.CInt(f))}return null;case 39:if(1==b.length&&(f=b[0],g=f.e,0==g._hx_index&&(f=g.c,2==f._hx_index))){var h=f.v;return q.TConst(K.CFloat(h))}return null;case 64:case 65:f=b[0].e;if(0==f._hx_index)if(g=f.c,2==g._hx_index)h=e=g.v;else throw lb.t("Cannot eval complex channel "+pa.toString(b[0],!0)+" "+this.constantsToString(),d),u.thrown("assert");else throw lb.t("Cannot eval complex channel "+
pa.toString(b[0],!0)+" "+this.constantsToString(),d),u.thrown("assert");g=c[0];f=g.e;if(1==f._hx_index)f=f.v,f=q.TVar(this.mapVar(f,!1));else throw u.thrown("assert");g={e:f,t:g.t,p:g.p};f=g.t;if(17==f._hx_index)c=e=f.size;else throw u.thrown("assert");var k=la.createEnumIndex(hb,h&7,null),l=[g];f=1;for(g=b.length;f<g;)e=f++,l.push(b[e]);l.push({e:q.TConst(K.CInt(h>>3)),t:x.TInt,p:d});b={e:q.TCall({e:q.TGlobal(a),t:x.TVoid,p:d},l),t:x.TVoid,p:d};switch(k._hx_index){case 0:return b={e:q.TConst(K.CFloat(0)),
t:x.TFloat,p:d},1==c?b.e:q.TCall({e:q.TGlobal([C.Vec2,C.Vec3,C.Vec4][c-2]),t:x.TVoid,p:d},[b]);case 1:case 2:case 3:case 4:switch(c){case 1:switch(k._hx_index){case 1:d=[sa.X];break;case 2:d=[sa.Y];break;case 3:d=[sa.Z];break;case 4:d=[sa.W];break;default:throw u.thrown("Invalid channel value "+w.string(k)+" for "+c+" channels");}break;case 2:switch(k._hx_index){case 1:d=[sa.X,sa.Y];break;case 2:d=[sa.Y,sa.Z];break;case 3:d=[sa.Z,sa.W];break;default:throw u.thrown("Invalid channel value "+w.string(k)+
" for "+c+" channels");}break;case 3:switch(k._hx_index){case 1:d=[sa.X,sa.Y,sa.Z];break;case 2:d=[sa.Y,sa.Z,sa.W];break;default:throw u.thrown("Invalid channel value "+w.string(k)+" for "+c+" channels");}break;default:throw u.thrown("Invalid channel value "+w.string(k)+" for "+c+" channels");}return q.TSwiz(b,d);case 5:return q.TCall({e:q.TGlobal(C.Unpack),t:x.TVoid,p:d},[b]);case 6:return q.TCall({e:q.TGlobal(C.UnpackNormal),t:x.TVoid,p:d},[b])}break;case 68:for(f=0;f<b.length;)d=b[f],++f,Ka.trace(pa.toString(d),
{fileName:d.p.file,lineNumber:0,className:null,methodName:null});return q.TBlock([]);default:return null}},constantsToString:function(){for(var a=[],b=this.constants.keys();b.hasNext();){var c=b.next();a.push(c+" => "+pa.toString({e:this.constants.h[c],t:x.TVoid,p:null},!0))}return a.toString()},ifBlock:function(a){return(null!=a?10!=a.e._hx_index:1)?a:{e:q.TBlock([a]),t:a.t,p:a.p}},evalExpr:function(a,b){null==b&&(b=!0);var c=this;var d=a.t;var e=a.e;switch(e._hx_index){case 0:var f=e.c;var g=a.e;
break;case 1:f=e.v;var h=this.constants.h[f.id];null!=h?g=h:(b=this.mapVar(f,!1),d=b.type,g=q.TVar(b));break;case 2:f=e.g;g=a.e;break;case 3:h=e.e;var k=this.evalExpr(h,b);f=k.e;0==f._hx_index?(e=f.c,g=k.e):g=q.TParenthesis(k);break;case 4:var l=e.el;var m=this.mapped.length;var p=[];k=l.length-1;f=0;for(e=l.length;f<e;){g=f++;var t=b&&g==k;h=this.evalExpr(l[g],t);var n=h.e;switch(n._hx_index){case 0:g=n.c;t&&p.push(h);break;case 1:var r=n.v;t&&p.push(h);break;default:p.push(h)}}for(;this.mapped.length>
m;)f=this.mapped.pop(),b=this.varMap.h[f.__id__],null!=b&&(this.varMap.remove(f),this.varMap.remove(b));g=1==p.length&&this.curFun.kind!=Ia.Init?p[0].e:q.TBlock(p);break;case 5:b=e.op;h=e.e1;k=e.e2;h=this.evalExpr(h);m=this.evalExpr(k);switch(b._hx_index){case 0:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n+e|0))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,
g=q.TConst(K.CFloat(n+e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 1:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n*e|0))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CFloat(n*e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=
h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n/e|0))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CFloat(n/e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n-
e|0))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CFloat(n-e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:case 21:g=q.TBinop(b,h,m);break;case 5:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 0:g=0==e._hx_index?0==e.c._hx_index?q.TConst(K.CBool(!0)):q.TConst(K.CBool(!1)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=
q.TConst(K.CBool(!1));break;case 1:e=g.b;g=q.TConst(K.CBool(0==(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 2:e=g.v;g=q.TConst(K.CBool(0==f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 3:e=g.v;n=f;g=q.TConst(K.CBool(0==(n>e?1:n==e?0:-1)));break;default:g=
q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 4:e=n.v;n=f;g=q.TConst(K.CBool(0==(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 6:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 0:g=0==e._hx_index?0==e.c._hx_index?q.TConst(K.CBool(!1)):q.TConst(K.CBool(!0)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=
q.TConst(K.CBool(!0));break;case 1:e=g.b;g=q.TConst(K.CBool(0!=(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!0));break;case 2:e=g.v;g=q.TConst(K.CBool(0!=f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!0));break;case 3:e=g.v;n=f;g=q.TConst(K.CBool(0!=(n>e?1:n==e?0:-1)));break;default:g=
q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(K.CBool(!0));break;case 4:e=n.v;n=f;g=q.TConst(K.CBool(0!=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 7:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 0:g=0==e._hx_index?q.TConst(K.CBool(!1)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!0));
break;case 1:e=g.b;g=q.TConst(K.CBool(0<(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!0));break;case 2:e=g.v;g=q.TConst(K.CBool(0<f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!0));break;case 3:e=g.v;n=f;g=q.TConst(K.CBool(0<(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,
h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(K.CBool(!0));break;case 4:e=n.v;n=f;g=q.TConst(K.CBool(0<(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 8:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 0:g=0==e._hx_index?0==e.c._hx_index?q.TConst(K.CBool(!0)):q.TConst(K.CBool(!1)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!0));
break;case 1:e=g.b;g=q.TConst(K.CBool(0<=(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!0));break;case 2:e=g.v;g=q.TConst(K.CBool(0<=f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!0));break;case 3:e=g.v;n=f;g=q.TConst(K.CBool(0<=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=
q.TBinop(b,h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(K.CBool(!0));break;case 4:e=n.v;n=f;g=q.TConst(K.CBool(0<=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 9:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 0:g=0==e._hx_index?0==e.c._hx_index?q.TConst(K.CBool(!1)):q.TConst(K.CBool(!0)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!1));
break;case 1:e=g.b;g=q.TConst(K.CBool(0>(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 2:e=g.v;g=q.TConst(K.CBool(0>f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 3:e=g.v;n=f;g=q.TConst(K.CBool(0>(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,
h,m);break;case 4:if(f=n.v,0==e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 4:e=n.v;n=f;g=q.TConst(K.CBool(0>(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 10:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 0:g=0==e._hx_index?q.TConst(K.CBool(!0)):q.TBinop(b,h,m);break;case 1:f=n.b;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 1:e=g.b;g=q.TConst(K.CBool(0>=
(f==e?0:1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 2:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 2:e=g.v;g=q.TConst(K.CBool(0>=f-e));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 3:f=n.v;if(0==e._hx_index)switch(g=e.c,g._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 3:e=g.v;n=f;g=q.TConst(K.CBool(0>=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 4:if(f=n.v,0==
e._hx_index)switch(n=e.c,n._hx_index){case 0:g=q.TConst(K.CBool(!1));break;case 4:e=n.v;n=f;g=q.TConst(K.CBool(0>=(n>e?1:n==e?0:-1)));break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 11:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n&e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 12:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?
(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n|e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 13:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n^e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 14:f=h.e;e=m.e;0==f._hx_index?(n=f.c,1==n._hx_index?(f=n.b,0==e._hx_index?(n=e.c,1==n._hx_index?(e=n.b,g=q.TConst(K.CBool(f&&e))):(n=f,g=0==n?q.TConst(K.CBool(n)):
m.e)):(n=f,g=0==n?q.TConst(K.CBool(n)):m.e)):0==e._hx_index?(f=e.c,1==f._hx_index?(n=f.b,g=0==n?q.TConst(K.CBool(n)):h.e):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m)):0==e._hx_index?(f=e.c,1==f._hx_index?(n=f.b,g=0==n?q.TConst(K.CBool(n)):h.e):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 15:f=h.e;e=m.e;0==f._hx_index?(n=f.c,1==n._hx_index?(f=n.b,0==e._hx_index?(n=e.c,1==n._hx_index?(e=n.b,g=q.TConst(K.CBool(f||e))):(n=f,g=1==n?q.TConst(K.CBool(n)):m.e)):(n=f,g=1==n?q.TConst(K.CBool(n)):m.e)):0==e._hx_index?
(f=e.c,1==f._hx_index?(n=f.b,g=1==n?q.TConst(K.CBool(n)):h.e):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m)):0==e._hx_index?(f=e.c,1==f._hx_index?(n=f.b,g=1==n?q.TConst(K.CBool(n)):h.e):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 16:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n<<e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 17:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?
(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n>>e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 18:f=h.e;e=m.e;0==f._hx_index?(n=f.c,2==n._hx_index?0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n>>>e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 19:f=h.e;e=m.e;if(0==f._hx_index)switch(n=f.c,n._hx_index){case 2:0==e._hx_index?(f=e.c,2==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CInt(n%e|0))):
g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;case 3:0==e._hx_index?(f=e.c,3==f._hx_index?(e=f.v,n=n.v,g=q.TConst(K.CFloat(n%e))):g=q.TBinop(b,h,m)):g=q.TBinop(b,h,m);break;default:g=q.TBinop(b,h,m)}else g=q.TBinop(b,h,m);break;case 20:f=b.op;g=q.TBinop(b,h,m);break;default:throw u.thrown("assert");}break;case 6:b=e.op;h=e.e1;k=this.evalExpr(h);f=k.e;if(0==f._hx_index)switch(h=f.c,b._hx_index){case 2:1==h._hx_index?(e=h.b,g=q.TConst(K.CBool(!e))):g=q.TUnop(b,k);break;case 3:switch(h._hx_index){case 2:g=
h.v;g=q.TConst(K.CInt(-g));break;case 3:l=h.v;g=q.TConst(K.CFloat(-l));break;default:g=q.TUnop(b,k)}break;default:g=q.TUnop(b,k)}else g=q.TUnop(b,k);break;case 7:f=e.v;e=e.init;g=q.TVarDecl(this.mapVar(f,!0),null==e?null:this.evalExpr(e));break;case 8:h=e.e;g=e.args;h=this.evalExpr(h);f=[];for(e=0;e<g.length;)n=g[e],++e,f.push(this.evalExpr(n));p=f;f=h.e;switch(f._hx_index){case 1:f=f.v;if(null!=this.funMap.h.__keys__[f.__id__]){l=this.funMap.h[f.__id__];m=[];k=[];e=0;for(n=l.args.length;e<n;)switch(g=
e++,f=[l.args[g]],h=p[g],g=h.e,g._hx_index){case 0:r=g.c;k.push(function(a,b){return function(){null==a[0]?c.constants.remove(b[0].id):c.constants.h[b[0].id]=a[0]}}([this.constants.h[f[0].id]],f));this.constants.h[f[0].id]=h.e;break;case 1:switch(g.v.kind._hx_index){case 0:case 1:case 2:k.push(function(a,b){return function(){null==a[0]?c.constants.remove(b[0].id):c.constants.h[b[0].id]=a[0]}}([this.constants.h[f[0].id]],f));this.constants.h[f[0].id]=h.e;break;default:g=[this.varMap.h[f[0].__id__]],
null==g[0]?k.push(function(a){return function(){c.varMap.remove(a[0])}}(f)):(this.varMap.remove(f[0]),k.push(function(a,b){return function(){c.varMap.set(b[0],a[0])}}(g,f))),b=this.mapVar(f[0],!1),m.push({e:q.TVarDecl(b,h),t:x.TVoid,p:h.p})}break;default:g=[this.varMap.h[f[0].__id__]],null==g[0]?k.push(function(a){return function(){c.varMap.remove(a[0])}}(f)):(this.varMap.remove(f[0]),k.push(function(a,b){return function(){c.varMap.set(b[0],a[0])}}(g,f))),f=this.mapVar(f[0],!1),m.push({e:q.TVarDecl(f,
h),t:x.TVoid,p:h.p})}h=this.handleReturn(this.evalExpr(l.expr,!1),!0);for(e=0;e<k.length;)f=k[e],++e,f();e=h.e;if(4==e._hx_index)for(l=e.el,e=0;e<l.length;)k=l[e],++e,m.push(k);else m.push(h);g=q.TBlock(m)}else g=q.TCall(h,p);break;case 2:m=this.evalCall(f.g,p,g,a.p);g=null!=m?m:q.TCall(h,p);break;default:g=lb.t("Cannot eval non-static call expresssion '"+(new pa).exprString(h)+"'",h.p)}break;case 9:h=e.e;e=e.regs;g=q.TSwiz(this.evalExpr(h),e.slice());break;case 10:n=e.eif;g=e.eelse;h=this.evalExpr(e.econd);
f=h.e;0==f._hx_index?(e=f.c,1==e._hx_index?g=(e=e.b)?this.evalExpr(n,b).e:null==g?q.TConst(K.CNull):this.evalExpr(g,b).e:b&&null!=g&&this.eliminateConditionals?g=q.TCall({e:q.TGlobal(C.Mix),t:a.t,p:a.p},[this.evalExpr(g,!0),this.evalExpr(n,!0),{e:q.TCall({e:q.TGlobal(C.ToFloat),t:x.TFun([]),p:h.p},[h]),t:x.TFloat,p:a.p}]):(n=this.evalExpr(n,b),null!=g&&(g=this.evalExpr(g,b),f=g.e,0==f._hx_index&&0==f.c._hx_index&&(g=null)),n=this.ifBlock(n),g=this.ifBlock(g),g=q.TIf(h,n,g))):b&&null!=g&&this.eliminateConditionals?
g=q.TCall({e:q.TGlobal(C.Mix),t:a.t,p:a.p},[this.evalExpr(g,!0),this.evalExpr(n,!0),{e:q.TCall({e:q.TGlobal(C.ToFloat),t:x.TFun([]),p:h.p},[h]),t:x.TFloat,p:a.p}]):(n=this.evalExpr(n,b),null!=g&&(g=this.evalExpr(g,b),f=g.e,0==f._hx_index&&0==f.c._hx_index&&(g=null)),n=this.ifBlock(n),g=this.ifBlock(g),g=q.TIf(h,n,g));break;case 11:g=q.TDiscard;break;case 12:h=e.e;g=q.TReturn(null==h?null:this.evalExpr(h));break;case 13:m=e.v;f=e.it;h=e.loop;b=this.mapVar(m,!0);p=this.evalExpr(f);f=p.e;if(5==f._hx_index)if(e=
f.e1,n=f.e2,21==f.op._hx_index)if(f=e.e,g=e.p,g=e.t,0==f._hx_index)if(e=f.c,2==e._hx_index)if(f=n.e,g=n.p,g=n.t,0==f._hx_index)if(n=f.c,2==n._hx_index)if(n=n.v,e=e.v,this.unrollLoops){p=[];f=e;for(e=n;f<e;)g=f++,this.constants.h[m.id]=q.TConst(K.CInt(g)),p.push(this.evalExpr(h,!1));this.constants.remove(m.id);h=q.TBlock(p)}else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,
this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));else h=q.TFor(b,p,this.ifBlock(this.evalExpr(h,!1)));this.varMap.remove(m);g=h;break;case 14:g=q.TContinue;break;case 15:g=q.TBreak;break;case 16:h=e.e;k=e.index;h=this.evalExpr(h);m=this.evalExpr(k);f=h.e;e=m.e;if(17==f._hx_index)if(0==e._hx_index)if(n=e.c,2==n._hx_index)if(g=n.v,l=f.el,0<=g&&g<l.length)g=l[g].e;else{f=h.t;switch(f._hx_index){case 15:e=f.size;
d=f.t;break;case 16:e=f.size,e=f.kind,d=f.t}g=q.TArray(h,m)}else{f=h.t;switch(f._hx_index){case 15:e=f.size;d=f.t;break;case 16:e=f.size,e=f.kind,d=f.t}g=q.TArray(h,m)}else{f=h.t;switch(f._hx_index){case 15:e=f.size;d=f.t;break;case 16:e=f.size,e=f.kind,d=f.t}g=q.TArray(h,m)}else{f=h.t;switch(f._hx_index){case 15:e=f.size;d=f.t;break;case 16:e=f.size,e=f.kind,d=f.t}g=q.TArray(h,m)}break;case 17:l=e.el;f=[];for(e=0;e<l.length;)h=l[e],++e,f.push(this.evalExpr(h));g=q.TArrayDecl(f);break;case 18:h=e.e;
p=e.cases;l=e.def;k=this.evalExpr(h);f=[];for(e=0;e<p.length;){h=p[e];++e;n=[];g=0;for(r=h.values;g<r.length;)m=r[g],++g,n.push(this.evalExpr(m));f.push({values:n,expr:this.evalExpr(h.expr,b)})}p=f;b=null==l?null:this.evalExpr(l,b);r=!1;f=k.e;if(0==f._hx_index)if(h=f.c,2==h._hx_index)for(l=h.v,f=0;f<p.length;)for(h=p[f],++f,e=0,n=h.values;e<n.length;)if(m=n[e],++e,g=m.e,0==g._hx_index)switch(g=g.c,g._hx_index){case 2:if(g.v==l)return h.expr;break;case 3:if(g.v==l)return h.expr}else r=!0;else throw u.thrown("Unsupported switch constant "+
w.string(h));else r=!0;g=r?q.TSwitch(k,p,b):null==b?q.TBlock([]):b.e;break;case 19:f=e.e;h=e.loop;e=e.normalWhile;f=this.evalExpr(f);n=this.evalExpr(h,!1);g=q.TWhile(f,this.ifBlock(n),e);break;case 20:f=e.m;p=e.args;h=e.e;"unroll"==f?(this.unrollLoops=!0,k=this.evalExpr(h,b),this.unrollLoops=!1):k=this.evalExpr(h,b);g=q.TMeta(f,p,k);break;case 21:h=e.e;f=e.name;g=q.TField(this.evalExpr(h),f);break;case 22:n=e.target;g=e.code;p=e.args;e=[];for(f=0;f<p.length;)h=p[f],++f,e.push({e:this.evalExpr(h.e),
access:h.access});g=q.TSyntax(n,g,e)}return{e:g,t:d,p:a.p}},__class__:uj};var fe=function(a,b,c,d){this.g=a;this.t=b;this.pos=c;this.size=d};z["hxsl._Flatten.Alloc"]=fe;fe.__name__="hxsl._Flatten.Alloc";fe.prototype={__class__:fe};var Ye=L["hxsl.ARead"]={__ename__:!0,__constructs__:null,AIndex:(A=function(a){return{_hx_index:0,a:a,__enum__:"hxsl.ARead",toString:v}},A._hx_name="AIndex",A.__params__=["a"],A),AOffset:(A=function(a,b,c){return{_hx_index:1,a:a,stride:b,delta:c,__enum__:"hxsl.ARead",toString:v}},
A._hx_name="AOffset",A.__params__=["a","stride","delta"],A)};Ye.__constructs__=[Ye.AIndex,Ye.AOffset];Ye.__empty_constructs__=[];var lc=function(){};z["hxsl.Flatten"]=lc;lc.__name__="hxsl.Flatten";lc.prototype={flatten:function(a,b){this.globals=[];this.params=[];this.outVars=[];this.textureFormats=[];this.varMap=new vc;this.allocData=new vc;for(var c=0,d=a.vars;c<d.length;){var e=d[c];++c;this.gatherVar(e)}switch(b._hx_index){case 0:b="vertex";break;case 1:b="fragment";break;case 4:b="compute";break;
default:throw u.thrown("assert");}this.pack(b+"Globals",P.Global,this.globals,Q.VFloat);this.pack(b+"Params",P.Param,this.params,Q.VFloat);e=this.globals.concat(this.params);this.textureFormats.sort(function(a,b){return a.rw!=b.rw?a.rw-b.rw:a.arr!=b.arr?a.arr?1:-1:a.dim._hx_index-b.dim._hx_index});c=0;for(d=this.textureFormats;c<d.length;){var f=d[c];++c;if(f.dim==tb.T2D)var g="";else g=f.dim,g=D.substr(L[g.__enum__].__constructs__[g._hx_index]._hx_name,1,null);0<f.rw&&(g="RW"+g+f.rw);f.arr&&(g+=
"Array");this.packTextures(b+"Textures"+g,e,0==f.rw?x.TSampler(f.dim,f.arr):x.TRWTexture(f.dim,f.arr,f.rw))}this.packBuffers("buffers",e,vb.Uniform);this.packBuffers("storagebuffers",e,vb.Storage);this.packBuffers("rwbuffers",e,vb.RW);c=[];d=0;for(b=a.funs;d<b.length;)e=b[d],++d,c.push(this.mapFun(e,M(this,this.mapExpr)));return{name:a.name,vars:this.outVars,funs:c}},mapFun:function(a,b){return{kind:a.kind,ret:a.ret,args:a.args,ref:a.ref,expr:b(a.expr)}},mkOp:function(a,b,c,d,e){var f=a.e;return 0==
f._hx_index&&(f=f.c,2==f._hx_index)?{e:q.TConst(K.CInt(c(f.v,b))),t:x.TInt,p:e}:{e:q.TBinop(d,a,{e:q.TConst(K.CInt(b)),t:x.TInt,p:e}),t:x.TInt,p:e}},mkAdd:function(a,b,c){return 0==b?a:this.mkOp(a,b,function(a,b){return a+b},ha.OpAdd,c)},mkMult:function(a,b,c){return 1==b?a:this.mkOp(a,b,function(a,b){return a*b},ha.OpMult,c)},mapExpr:function(a){var b;var c=a.e;switch(c._hx_index){case 1:var d=c.v;var e=this.varMap.h[d.__id__];null!=e&&(a=this.access(e,d.type,a.p,Ye.AIndex(e)));break;case 5:if(4==
c.op._hx_index){var f=c.e1;c=c.e2;if(7==a.t._hx_index){var g=f.e;var h=21==g._hx_index?!0:!1}else h=!1;if(h)if(g=f.e,21==g._hx_index)if(7==f.t._hx_index){h=g.name;f=g.e;e=-1;g=f.t;if(13==g._hx_index){var k=g.vl;for(g=b=0;g<k.length;){d=k[g];++g;if(d.name==h){e=b;break}b+=B.size(d.type)}}if(0>e)throw u.thrown("assert");g=e;d=this.mapExpr(f);b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(g&3)?f=b:(e=lc.SWIZ.slice(g&3,(g&3)+4),f={e:q.TSwiz(b,
e),t:x.TVec(4,Q.VFloat),p:a.p});h={e:q.TBinop(ha.OpAssign,f,{e:q.TArray(c,{e:q.TConst(K.CInt(0)),t:x.TInt,p:null}),t:x.TVec(4,Q.VFloat),p:null}),t:a.t,p:a.p};e=g+4;b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?f=b:(e=lc.SWIZ.slice(e&3,(e&3)+4),f={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});k={e:q.TBinop(ha.OpAssign,f,{e:q.TArray(c,{e:q.TConst(K.CInt(1)),t:x.TInt,p:null}),t:x.TVec(4,Q.VFloat),p:null}),t:a.t,p:a.p};e=g+8;b=this.optimize({e:q.TArray(d,
{e:q.TConst(K.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?f=b:(e=lc.SWIZ.slice(e&3,(e&3)+4),f={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});var l={e:q.TBinop(ha.OpAssign,f,{e:q.TArray(c,{e:q.TConst(K.CInt(2)),t:x.TInt,p:null}),t:x.TVec(4,Q.VFloat),p:null}),t:a.t,p:a.p};e=g+12;b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?f=b:(e=lc.SWIZ.slice(e&3,(e&3)+4),f={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});a={e:q.TBlock([h,
k,l,{e:q.TBinop(ha.OpAssign,f,{e:q.TArray(c,{e:q.TConst(K.CInt(3)),t:x.TInt,p:null}),t:x.TVec(4,Q.VFloat),p:null}),t:a.t,p:a.p}]),t:a.t,p:a.p}}else throw u.thrown("assert");else throw u.thrown("assert");else a=B.map(a,M(this,this.mapExpr))}else a=B.map(a,M(this,this.mapExpr));break;case 7:d=c.v;c=c.init;g=d.type;(f=13==g._hx_index?!0:!1)?(k=Math.ceil(B.size(d.type)/4),f={id:B.allocVarId(),name:d.name,type:x.TArray(x.TVec(4,Q.VFloat),Ya.SConst(k)),kind:d.kind,qualifiers:d.qualifiers},e=new fe(f,Q.VFloat,
0,0),e.v=d,this.varMap.set(d,e),a={e:q.TVarDecl(f,null==c?null:this.mapExpr(c)),t:x.TVoid,p:a.p}):a=B.map(a,M(this,this.mapExpr));break;case 16:g=c.e;f=g.e;if(1==f._hx_index)if(d=f.v,b=g.p,l=c.index,e=this.varMap.h[d.__id__],null!=e?(g=d.type,(c=16==g._hx_index?!0:!1)?f=!1:(g=l.e,0==g._hx_index?(f=g.c,f=2==f._hx_index?!0:!1):f=!1)):f=!0,f)a=B.map(a,M(this,this.mapExpr));else switch(g=d.type,g._hx_index){case 5:switch(g.t._hx_index){case 0:case 1:a=B.map(a,M(this,this.mapExpr));break;default:throw u.thrown("assert");
}break;case 15:h=f=g.t;if(B.isTexture(h))l=this.toInt(this.mapExpr(l)),a=this.access(e,h,b,Ye.AOffset(e,1,l));else{h=f;k=this.varSize4Bytes(h,e.t);0!=k?(f=d.type,f=(c=15==f._hx_index?!0:!1)&&0!=(k&3)):f=!0;if(f)throw u.thrown(new lb("Dynamic access to an Array which size is not 4 components-aligned is not allowed",a.p));k=k+3>>2;l=this.toInt(this.mapExpr(l));a=this.access(e,h,b,Ye.AOffset(e,k,this.mkMult(l,k,b)))}break;case 16:f=g.t;switch(f._hx_index){case 1:case 3:a=B.map(a,M(this,this.mapExpr));
break;default:h=f;k=this.varSize4Bytes(h,e.t);0!=k?(g=d.type,f=(c=15==g._hx_index?!0:!1)&&0!=(k&3)):f=!0;if(f)throw u.thrown(new lb("Dynamic access to an Array which size is not 4 components-aligned is not allowed",a.p));k=k+3>>2;l=this.toInt(this.mapExpr(l));a=this.access(e,h,b,Ye.AOffset(e,k,this.mkMult(l,k,b)))}break;default:throw u.thrown("assert");}else a=B.map(a,M(this,this.mapExpr));break;case 21:f=c.e;h=c.name;e=-1;c=f.t;if(13==c._hx_index)for(k=c.vl,c=b=0;c<k.length;){d=k[c];++c;if(d.name==
h){e=b;break}b+=B.size(d.type)}if(0>e)throw u.thrown("assert");g=e;d=this.mapExpr(f);c=a.t;switch(c._hx_index){case 3:b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});e=lc.SWIZ.slice(g&3,(g&3)+1);a={e:q.TSwiz(b,e),t:x.TFloat,p:a.p};break;case 5:if(1==c.t._hx_index)if(k=c.size,c=g+k-1>>2,g>>2==c)b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)}),4==k&&0==(g&3)?a=b:(e=lc.SWIZ.slice(g&3,(g&3)+k),a=
{e:q.TSwiz(b,e),t:1==k?x.TFloat:x.TVec(k,Q.VFloat),p:a.p});else{h=(c<<2)-g;switch(k){case 2:c=C.Vec2;break;case 3:c=C.Vec3;break;case 4:c=C.Vec4;break;default:throw u.thrown("assert");}f={e:q.TGlobal(c),p:a.p,t:x.TVoid};b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});4==h&&0==(g&3)?c=b:(e=lc.SWIZ.slice(g&3,(g&3)+h),c={e:q.TSwiz(b,e),t:1==h?x.TFloat:x.TVec(h,Q.VFloat),p:a.p});e=g+h;g=k-h;b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(e>>2)),p:a.p,
t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});4==g&&0==(e&3)?h=b:(e=lc.SWIZ.slice(e&3,(e&3)+g),h={e:q.TSwiz(b,e),t:1==g?x.TFloat:x.TVec(g,Q.VFloat),p:a.p});a={e:q.TCall(f,[c,h]),t:a.t,p:a.p}}else throw u.thrown("Unsupported type "+B.toString(a.t));break;case 7:f={e:q.TGlobal(C.Mat4),p:a.p,t:x.TVoid};b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(g&3)?c=b:(e=lc.SWIZ.slice(g&3,(g&3)+4),c={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+4;b=this.optimize({e:q.TArray(d,
{e:q.TConst(K.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?h=b:(e=lc.SWIZ.slice(e&3,(e&3)+4),h={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+8;b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?k=b:(e=lc.SWIZ.slice(e&3,(e&3)+4),k={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+12;b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?l=b:(e=lc.SWIZ.slice(e&
3,(e&3)+4),l={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});a={e:q.TCall(f,[c,h,k,l]),t:a.t,p:a.p};break;case 8:f={e:q.TGlobal(C.Mat3x4),p:a.p,t:x.TVoid};b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(g&3)?c=b:(e=lc.SWIZ.slice(g&3,(g&3)+4),c={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+4;b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?h=b:(e=lc.SWIZ.slice(e&3,(e&3)+4),h={e:q.TSwiz(b,
e),t:x.TVec(4,Q.VFloat),p:a.p});e=g+8;b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(e>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});0==(e&3)?k=b:(e=lc.SWIZ.slice(e&3,(e&3)+4),k={e:q.TSwiz(b,e),t:x.TVec(4,Q.VFloat),p:a.p});a={e:q.TCall(f,[c,h,k]),t:a.t,p:a.p};break;case 9:k=c.size;f={e:q.TGlobal(C.UnpackSnorm4x8),p:a.p,t:x.TVec(k,Q.VFloat)};b=this.optimize({e:q.TArray(d,{e:q.TConst(K.CInt(g>>2)),p:a.p,t:x.TInt}),p:a.p,t:x.TVec(4,Q.VFloat)});e=lc.SWIZ.slice(g&3,(g&3)+1);a={e:q.TCall(f,[this.floatBitsToUint({e:q.TSwiz(b,
e),t:x.TFloat,p:a.p})]),t:a.t,p:a.p};break;default:throw u.thrown("Unsupported type "+B.toString(a.t));}break;default:a=B.map(a,M(this,this.mapExpr))}return this.optimize(a)},mkInt:function(a,b){return{e:q.TConst(K.CInt(a)),t:x.TInt,p:b}},readIndex:function(a,b,c){var d=null==a.t?a.pos:a.pos>>2;return{e:q.TArray({e:q.TVar(a.g),t:a.g.type,p:c},{e:q.TConst(K.CInt(d+b)),t:x.TInt,p:c}),t:x.TVec(4,a.t),p:c}},readOffset:function(a,b,c,d,e){b=this.mkAdd(c,16==a.g.type._hx_index?d:(null==a.t?a.pos:a.pos>>
2)+d,e);return{e:q.TArray({e:q.TVar(a.g),t:a.g.type,p:e},b),t:x.TVec(4,a.t),p:e}},access:function(a,b,c,d){switch(b._hx_index){case 6:var e=this.access(a,x.TMat3x4,c,d);return{e:q.TCall({e:q.TGlobal(C.Mat3),t:x.TFun([]),p:c},[e]),t:x.TMat3,p:c};case 7:e={e:q.TGlobal(C.Mat4),t:x.TFun([]),p:c};switch(d._hx_index){case 0:var f=d.a;var g=null==f.t?f.pos:f.pos>>2;var h={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a;g=d.delta;var k=
f.g.type;var l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2;g=this.mkAdd(g,l,c);h={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;var m={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g+1)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?1:(null==f.t?f.pos:f.pos>>2)+1,g=this.mkAdd(g,l,c),m={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=
d.a;g=null==f.t?f.pos:f.pos>>2;var p={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g+2)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?2:(null==f.t?f.pos:f.pos>>2)+2,g=this.mkAdd(g,l,c),p={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;var t={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g+3)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=
d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?3:(null==f.t?f.pos:f.pos>>2)+3,g=this.mkAdd(g,l,c),t={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}return{e:q.TCall(e,[h,m,p,t]),t:x.TMat4,p:c};case 8:e={e:q.TGlobal(C.Mat3x4),t:x.TFun([]),p:c};switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;h={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>
2,g=this.mkAdd(g,l,c),h={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;m={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g+1)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?1:(null==f.t?f.pos:f.pos>>2)+1,g=this.mkAdd(g,l,c),m={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;p={e:q.TArray({e:q.TVar(f.g),
t:f.g.type,p:c},{e:q.TConst(K.CInt(g+2)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?2:(null==f.t?f.pos:f.pos>>2)+2,g=this.mkAdd(g,l,c),p={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}return{e:q.TCall(e,[h,m,p]),t:x.TMat3x4,p:c};case 13:b=b.vl;for(k=h=0;k<b.length;)f=b[k],++k,h+=this.varSize(f.type,a.t);b=Math.ceil(h/4);k=[];h=0;for(m=b;h<m;){l=h++;switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;e={e:q.TArray({e:q.TVar(f.g),
t:f.g.type,p:c},{e:q.TConst(K.CInt(g+l)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:a=d.a,g=d.delta,l=16==a.g.type._hx_index?l:(null==a.t?a.pos:a.pos>>2)+l,g=this.mkAdd(g,l,c),e={e:q.TArray({e:q.TVar(a.g),t:a.g.type,p:c},g),t:x.TVec(4,a.t),p:c}}k.push(e)}return{e:q.TArrayDecl(k),t:x.TArray(x.TVec(4,Q.VFloat),Ya.SConst(b)),p:c};case 15:k=b.size;if(0==k._hx_index){d=k.v;e=b.t;b=a.size/d|0;k=[];h=0;for(m=d;h<m;)l=h++,f=new fe(a.g,a.t,a.pos+b*l,b),k.push(this.access(f,e,c,Ye.AIndex(f)));return{e:q.TArrayDecl(k),
t:e,p:c}}e=b;if(B.isTexture(e)){switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2,g=this.mkAdd(g,l,c),f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}f.t=e}else{h=this.varSize(b,a.t);if(4<h)return lb.t("Access not supported for "+B.toString(b),null);switch(d._hx_index){case 0:f=d.a;
g=null==f.t?f.pos:f.pos>>2;f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2,g=this.mkAdd(g,l,c),f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}if(4==h){if(-1==a.pos)return{e:q.TCall({e:q.TGlobal(C.Vec4),t:x.TFun([]),p:c},[{e:q.TConst(K.CFloat(0)),t:x.TFloat,p:c}]),t:x.TVec(4,Q.VFloat),p:c}}else{d=[];for(k=0;k<h;)l=k++,d.push(B.SWIZ[l+(a.pos&
3)]);f={e:q.TSwiz(f,d),t:b,p:c}}switch(b._hx_index){case 1:f.t=x.TFloat;f=this.toInt(f);break;case 5:0==b.t._hx_index&&(h=b.size,f.t=x.TVec(h,Q.VFloat),f={e:q.TCall({e:q.TGlobal([C.IVec2,C.IVec3,C.IVec4][h-2]),t:x.TFun([]),p:c},[f]),t:b,p:c})}}return f;case 16:return{e:q.TVar(a.g),t:b,p:c};default:e=b;if(B.isTexture(e)){switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=
d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>2,g=this.mkAdd(g,l,c),f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}f.t=e}else{h=this.varSize(b,a.t);if(4<h)return lb.t("Access not supported for "+B.toString(b),null);switch(d._hx_index){case 0:f=d.a;g=null==f.t?f.pos:f.pos>>2;f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},{e:q.TConst(K.CInt(g)),t:x.TInt,p:c}),t:x.TVec(4,f.t),p:c};break;case 1:f=d.a,g=d.delta,k=f.g.type,l=16==k._hx_index?0:null==f.t?f.pos:f.pos>>
2,g=this.mkAdd(g,l,c),f={e:q.TArray({e:q.TVar(f.g),t:f.g.type,p:c},g),t:x.TVec(4,f.t),p:c}}if(4==h){if(-1==a.pos)return{e:q.TCall({e:q.TGlobal(C.Vec4),t:x.TFun([]),p:c},[{e:q.TConst(K.CFloat(0)),t:x.TFloat,p:c}]),t:x.TVec(4,Q.VFloat),p:c}}else{d=[];for(k=0;k<h;)l=k++,d.push(B.SWIZ[l+(a.pos&3)]);f={e:q.TSwiz(f,d),t:b,p:c}}switch(b._hx_index){case 1:f.t=x.TFloat;f=this.toInt(f);break;case 5:0==b.t._hx_index&&(h=b.size,f.t=x.TVec(h,Q.VFloat),f={e:q.TCall({e:q.TGlobal([C.IVec2,C.IVec3,C.IVec4][h-2]),
t:x.TFun([]),p:c},[f]),t:b,p:c})}}return f}},floatBitsToUint:function(a){return{e:q.TCall({e:q.TGlobal(C.FloatBitsToUint),t:x.TFun([]),p:a.p},[a]),t:x.TInt,p:a.p}},toInt:function(a){return a.t==x.TInt?a:{e:q.TCall({e:q.TGlobal(C.ToInt),t:x.TFun([]),p:a.p},[a]),t:x.TInt,p:a.p}},optimize:function(a){var b=a.e;switch(b._hx_index){case 8:var c=b.e;var d=b.args;b=c.e;if(2==b._hx_index&&53==b.g._hx_index&&1==d.length&&(c=d[0],d=c.e,8==d._hx_index&&(c=d.e,b=c.e,2==b._hx_index&&52==b.g._hx_index))){b=d.args;
for(c=d=0;4>c;)c+=this.varSize(b[b.length-1-d].t,Q.VFloat),++d;if(4==c){for(c=0;c<d;)c++,b.pop();c=a.e;if(8==c._hx_index)d=c.e;else throw u.thrown("assert");return{e:q.TCall(d,b),t:a.t,p:a.p}}}break;case 16:if(c=b.e,d=b.index,b=c.e,17==b._hx_index&&(c=d.e,0==c._hx_index&&(d=c.c,2==d._hx_index))){d=d.v;b=b.el;if(0<=d&&d<b.length)return b[d];lb.t("Reading outside array bounds",a.p)}}return a},packTextures:function(a,b,c){var d,e=[],f={id:B.allocVarId(),name:a,type:c,kind:P.Param},g=0,h=[];for(d=0;d<
b.length;){var k=b[d];++d;var l=1;if(!la.enumEq(k.type,c)){var m=k.type;switch(m._hx_index){case 15:l=m.size;if(0==l._hx_index){if(l=l.v,!la.enumEq(m.t,c))continue}else continue;break;case 17:if(10!=c._hx_index||1!=c.dim._hx_index||0!=c.isArray)continue;break;default:continue}}m=new fe(f,null,g,l);m.v=k;if(null!=k.qualifiers)for(var p=0,q=k.qualifiers;p<q.length;){var n=q[p];++p;if(12==n._hx_index){a=n.name;for(var r=0,u=l;r<u;)n=r++,h[g+n]=a}}this.varMap.set(k,m);e.push(m);g+=l}f.type=x.TArray(c,
Ya.SConst(g));if(0<h.length){d=0;for(m=g;d<m;)n=d++,null==h[n]&&(h[n]="");null==f.qualifiers&&(f.qualifiers=[]);f.qualifiers.push(ra.Sampler(h.join(",")))}0<e.length&&(this.outVars.push(f),this.allocData.set(f,e));return e},packBuffers:function(a,b,c){var d=[];a={id:B.allocVarId(),name:a,type:x.TVoid,kind:P.Param};for(var e=0;e<b.length;){var f=b[e];++e;var g=f.type;if(16==g._hx_index){var h=g.size;if(0==h._hx_index){h=h.v;var k=g.t;g=g.kind;if(c==g){var l=Math.ceil(B.size(k)/4);switch(k._hx_index){case 1:case 3:switch(c._hx_index){case 1:case 2:case 4:case 5:k=
!0;break;default:k=!1}h=k?f.type:x.TBuffer(x.TVec(4,Q.VFloat),Ya.SConst(h*l),g);break;default:h=x.TBuffer(x.TVec(4,Q.VFloat),Ya.SConst(h*l),g)}h={id:B.allocVarId(),name:f.name,type:h,kind:P.Param};k=new fe(h,null,d.length,1);k.t=Q.VFloat;k.v=f;d.push(k);this.varMap.set(f,k);this.outVars.push(h)}}}}a.type=x.TArray(x.TBuffer(x.TVoid,Ya.SConst(0),c),Ya.SConst(d.length));this.allocData.set(a,d)},pack:function(a,b,c,d){var e=[],f=0;a={id:B.allocVarId(),name:a,type:x.TVec(0,d),kind:b};for(b=0;b<c.length;){var g=
c[b];++b;if(!B.isTexture(g.type)&&16!=g.type._hx_index){var h=g.type;if(15!=h._hx_index||!B.isTexture(h.t))if(h=this.varSize(g.type,d),0==h)h=new fe(a,d,-1,h),h.v=g,this.varMap.set(g,h);else{for(var k=null,l=0;l<e.length;){var m=e[l];++l;null==m.v&&m.size>=h&&(null==k||k.size>m.size)&&(k=m)}null!=k?(m=k.size-h,0<m&&(l=e.indexOf(k),m=new fe(a,d,k.pos+h,m),e.splice(l+1,0,m),k.size=h),k.v=g,this.varMap.set(g,k)):(k=new fe(a,d,f,h),f+=h,k.v=g,this.varMap.set(g,k),e.push(k),g=(4-h%4)%4,0<g&&(h=new fe(a,
d,f,g),f+=g,e.push(h)))}}}a.type=x.TArray(x.TVec(4,d),Ya.SConst(f>>2));0<f&&(this.outVars.push(a),this.allocData.set(a,e));return a},varSize:function(a,b){switch(a._hx_index){case 1:case 3:if(b==Q.VFloat)return 1;throw u.thrown(B.toString(a)+" size unknown for type "+w.string(b));case 5:var c=a.size;if(b==a.t)return c;throw u.thrown(B.toString(a)+" size unknown for type "+w.string(b));case 7:if(b==Q.VFloat)return 16;throw u.thrown(B.toString(a)+" size unknown for type "+w.string(b));case 6:case 8:if(b==
Q.VFloat)return 12;throw u.thrown(B.toString(a)+" size unknown for type "+w.string(b));case 9:return c=a.size;case 13:a=a.vl;var d=0;for(c=0;c<a.length;){var e=a[c];++c;d+=this.varSize(e.type,b)}return d;case 15:c=a.size;if(0==c._hx_index)return c=c.v,this.varSize(a.t,b)*c;throw u.thrown(B.toString(a)+" size unknown for type "+w.string(b));default:throw u.thrown(B.toString(a)+" size unknown for type "+w.string(b));}},varSize4Bytes:function(a,b){switch(a._hx_index){case 9:if(4==a.size)return 1;throw u.thrown(B.toString(a)+
" 4 bytes size unknown for type"+w.string(b));case 13:a=a.vl;for(var c=0,d=0;d<a.length;){var e=a[d];++d;c+=this.varSize4Bytes(e.type,b)}return c;case 15:return d=a.size,0==d._hx_index?(d=d.v,this.varSize4Bytes(a.t,b)*d):this.varSize(a,b);default:return this.varSize(a,b)}},addTextureFormat:function(a,b,c){null==c&&(c=0);for(var d=0,e=this.textureFormats;d<e.length;){var f=e[d];++d;if(f.dim==a&&f.arr==b&&f.rw==c)return}this.textureFormats.push({dim:a,arr:b,rw:c})},gatherVar:function(a){var b=a.type;
switch(b._hx_index){case 10:var c=b.dim;b=b.isArray;var d=a.type;d=11==d._hx_index?d.channels:0;this.addTextureFormat(c,b,d);break;case 11:c=b.dim;b=b.isArray;d=a.type;d=11==d._hx_index?d.channels:0;this.addTextureFormat(c,b,d);break;case 13:a=b.vl;for(d=0;d<a.length;)c=a[d],++d,this.gatherVar(c);return;case 15:d=b.t;switch(d._hx_index){case 10:c=d.dim;b=d.isArray;this.addTextureFormat(c,b,0);break;case 11:c=d.dim,b=d.isArray,d=d.channels,this.addTextureFormat(c,b,d)}break;case 17:this.addTextureFormat(tb.T2D,
!1)}switch(a.kind._hx_index){case 0:B.hasQualifier(a,ra.PerObject)?this.params.push(a):this.globals.push(a);break;case 2:this.params.push(a);break;default:this.outVars.push(a)}},__class__:lc};var za=function(){this.channels=[];this.map=new Da};z["hxsl.Globals"]=za;za.__name__="hxsl.Globals";za.allocID=function(a){null==za.MAP&&(za.MAP=new La,za.ALL=[]);var b=za.MAP.h[a];null==b&&(b=za.ALL.length,za.ALL.push(a),za.MAP.h[a]=b);return b};za.getIDName=function(a){return za.ALL[a]};za.prototype={set:function(a,
b){var c=this.map;a=za.allocID(a);c.h[a]=b},get:function(a){var b=this.map;a=za.allocID(a);return b.h[a]},fastSet:function(a,b){this.map.h[a]=b},fastGet:function(a){return this.map.h[a]},resetChannels:function(){this.maxChannels=0},allocChannelID:function(a){for(var b,c=0,d=this.maxChannels;c<d;)if(b=c++,this.channels[b]==a)return b;if(this.maxChannels==1<<B.MAX_CHANNELS_BITS)throw u.thrown("Too many unique channels");b=this.maxChannels++;this.channels[b]=a;return b},__class__:za};var Z=function(){};
z["js.Boot"]=Z;Z.__name__="js.Boot";Z.getClass=function(a){if(null==a)return null;if(a instanceof Array)return Array;var b=a.__class__;if(null!=b)return b;a=Z.__nativeClassName(a);return null!=a?Z.__resolveNativeClass(a):null};Z.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "function":return"<function>";case "object":if(a.__enum__){var d=L[a.__enum__].__constructs__[a._hx_index];
c=d._hx_name;if(d.__params__){b+="\t";var e=[],f=0;for(d=d.__params__;f<d.length;){var g=d[f];f+=1;e.push(Z.__string_rec(a[g],b))}return c+"("+e.join(",")+")"}return c}if(a instanceof Array){c="[";b+="\t";e=0;for(f=a.length;e<f;)d=e++,c+=(0<d?",":"")+Z.__string_rec(a[d],b);return c+"]"}try{e=a.toString}catch(h){return"???"}if(null!=e&&e!=Object.toString&&"function"==typeof e&&(c=a.toString(),"[object Object]"!=c))return c;c="{\n";b+="\t";e=null!=a.hasOwnProperty;f=null;for(f in a)e&&!a.hasOwnProperty(f)||
"prototype"==f||"__class__"==f||"__super__"==f||"__interfaces__"==f||"__properties__"==f||(2!=c.length&&(c+=", \n"),c+=b+f+" : "+Z.__string_rec(a[f],b));b=b.substring(1);return c+("\n"+b+"}");case "string":return a;default:return String(a)}};Z.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;if(null!=c)for(var d=0,e=c.length;d<e;){var f=d++;f=c[f];if(f==b||Z.__interfLoop(f,b))return!0}return Z.__interfLoop(a.__super__,b)};Z.__instanceof=function(a,b){if(null==
b)return!1;switch(b){case Array:return a instanceof Array;case ck:return"boolean"==typeof a;case dk:return null!=a;case ek:return"number"==typeof a;case cc:return"number"==typeof a?(a|0)===a:!1;case String:return"string"==typeof a;default:if(null!=a)if("function"==typeof b){if(Z.__downcastCheck(a,b))return!0}else{if("object"==typeof b&&Z.__isNativeObj(b)&&a instanceof b)return!0}else return!1;return b==fk&&null!=a.__name__||b==gk&&null!=a.__ename__?!0:null!=a.__enum__?L[a.__enum__]==b:!1}};Z.__downcastCheck=
function(a,b){return a instanceof b?!0:b.__isInterface__?Z.__interfLoop(Z.getClass(a),b):!1};Z.__cast=function(a,b){if(null==a||Z.__instanceof(a,b))return a;throw u.thrown("Cannot cast "+w.string(a)+" to "+w.string(b));};Z.__nativeClassName=function(a){a=Z.__toStr.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};Z.__isNativeObj=function(a){return null!=Z.__nativeClassName(a)};Z.__resolveNativeClass=function(a){return W[a]};var Xb=function(){this.computeLayout=[1,
1,1];this.exprIds=this.uniformBuffer=this.outIndex=0;this.varNames=new Da;this.allNames=new La};z["hxsl.GlslOut"]=Xb;Xb.__name__="hxsl.GlslOut";Xb.compile=function(a){var b=new Xb;b.glES=1;b.version=100;return b.run(a)};Xb.prototype={get_isES:function(){return null!=this.glES},get_isES2:function(){return null!=this.glES?2>=this.glES:!1},add:function(a){this.buf.b+=w.string(a)},ident:function(a){a=this.varName(a);this.buf.b+=w.string(a)},decl:function(a){for(var b=0,c=this.decls;b<c.length;){var d=
c[b];++b;if(d==a)return}35==D.cca(a,0)?this.decls.unshift(a):this.decls.push(a)},getSamplerType:function(a,b){a="sampler"+D.substr(L[a.__enum__].__constructs__[a._hx_index]._hx_name,1,null);b&&(a+="Array");return a},addType:function(a){switch(a._hx_index){case 0:this.buf.b+=w.string("void");break;case 1:this.buf.b+=w.string("int");break;case 2:this.buf.b+=w.string("bool");break;case 3:this.buf.b+=w.string("float");break;case 4:this.buf.b+=w.string("string");break;case 5:var b=a.size;switch(a.t._hx_index){case 0:this.buf.b+=
w.string("i");break;case 2:this.buf.b+=w.string("b")}this.buf.b+=w.string("vec");this.buf.b+=w.string(b);break;case 6:this.buf.b+=w.string("mat3");break;case 7:this.buf.b+=w.string("mat4");break;case 8:this.decl(Xb.MAT34);this.buf.b+=w.string("_mat3x4");break;case 9:a=a.size;this.buf.b+=w.string("vec");this.buf.b+=w.string(a);break;case 10:b=a.dim;a=a.isArray;var c=this.getSamplerType(b,a);this.buf.b+=w.string(c);null==this.glES||!a&&b!=tb.T3D||this.decl("precision lowp "+c+";");break;case 11:b=a.dim;
a=a.isArray;this.buf.b+=w.string("image"+D.substr(L[b.__enum__].__constructs__[b._hx_index]._hx_name,1,null)+(a?"Array":""));break;case 12:this.buf.b+=w.string("mat2");break;case 13:c=a.vl;this.buf.b+=w.string("struct { ");for(a=0;a<c.length;)b=c[a],++a,this.addVar(b),this.buf.b+=w.string(";");this.buf.b+=w.string(" }");break;case 14:this.buf.b+=w.string("function");break;case 15:c=a.t;b=a.size;this.addType(c);this.buf.b+=w.string("[");switch(b._hx_index){case 0:a=b.v;switch(a){case 0:break;case 1:this.buf.b=
this.intelDriverFix?this.buf.b+w.string(2):this.buf.b+w.string(a);break;default:this.buf.b+=w.string(a)}break;case 1:b=b.v,a=this.varName(b),this.buf.b+=w.string(a)}this.buf.b+=w.string("]");break;case 16:throw u.thrown("assert");case 17:a=a.size,this.buf.b+=w.string("channel"+a)}},addVar:function(a){var b=a.type;switch(b._hx_index){case 15:var c=b.t,d=b.size;b=a.type;a.type=c;this.addVar(a);a.type=b;this.buf.b+=w.string("[");switch(d._hx_index){case 0:a=d.v;switch(a){case 0:break;case 1:this.buf.b=
this.intelDriverFix?this.buf.b+w.string(2):this.buf.b+w.string(a);break;default:this.buf.b+=w.string(a)}break;case 1:a=d.v,a=this.varName(a),this.buf.b+=w.string(a)}this.buf.b+=w.string("]");break;case 16:c=b.t;d=b.size;b=b.kind;switch(b._hx_index){case 1:case 4:this.buf.b+=w.string("storage_");break;case 2:case 5:this.buf.b+=w.string("rw_")}this.buf.b+=w.string((this.isVertex?"vertex_":"")+"uniform_buffer"+this.uniformBuffer++);this.buf.b+=w.string(" { ");a.type=x.TArray(c,d);this.addVar(a);a.type=
x.TBuffer(c,d,b);this.buf.b+=w.string("; }");break;default:this.addType(a.type),this.buf.b+=w.string(" "),a=this.varName(a),this.buf.b+=w.string(a)}},addValue:function(a,b){var c=a.e;switch(c._hx_index){case 4:var d=c.el;b="_val"+this.exprIds++;c=this.buf;this.buf=new Pc;this.addType(a.t);this.buf.b+=w.string(" ");this.buf.b+=w.string(b);this.buf.b+=w.string("(void)");d=d.slice();var e=d[d.length-1];d[d.length-1]={e:q.TReturn(e),t:a.t,p:e.p};a={t:x.TVoid,e:q.TBlock(d),p:a.p};this.addExpr(a,"");this.exprValues.push(this.buf.b);
this.buf=c;this.buf.b+=w.string(b);this.buf.b+=w.string("()");break;case 10:a=c.econd;d=c.eif;c=c.eelse;this.buf.b+=w.string("( ");this.addValue(a,b);this.buf.b+=w.string(" ) ? ");this.addValue(d,b);this.buf.b+=w.string(" : ");this.addValue(c,b);break;case 20:this.addValue(c.e,b);break;default:this.addExpr(a,b)}},addBlock:function(a,b){this.addExpr(a,b)},getFunName:function(a,b,c){switch(a._hx_index){case 20:if(c==x.TInt&&null!=this.glES)return this.decl("int _imod( int x, int y ) { return int(mod(float(x),float(y))); }"),
"_imod";break;case 25:this.decl("float invLerp(float v, float a, float b) { return clamp((v - a) / (b - a), 0.0, 1.0); }");break;case 34:c=b[0].t;switch(c._hx_index){case 10:switch(c.dim._hx_index){case 1:if(null!=this.glES&&2>=this.glES)return"texture2D";break;case 3:if(null!=this.glES&&2>=this.glES)return"textureCube"}break;case 17:if(null!=this.glES&&2>=this.glES)return"texture2D"}break;case 35:c=b[0].t;switch(c._hx_index){case 10:switch(c.dim._hx_index){case 1:if(null!=this.glES&&2>=this.glES)return this.decl("#extension GL_EXT_shader_texture_lod : enable"),
"texture2DLodEXT";break;case 3:if(null!=this.glES&&2>=this.glES)return this.decl("#extension GL_EXT_shader_texture_lod : enable"),"textureCubeLodEXT"}break;case 17:if(null!=this.glES&&2>=this.glES)return this.decl("#extension GL_EXT_shader_texture_lod : enable"),"texture2DLodEXT"}break;case 36:return"texelFetch";case 37:a="";c=b[0].t;switch(c._hx_index){case 10:b=c.dim;a=c.isArray;c=B.getDimSize(b,a);a=a?"Array":"";b="sampler"+D.substr(L[b.__enum__].__constructs__[b._hx_index]._hx_name,1,null)+a;
this.decl("vec"+c+" _texture"+a+"Size("+b+" sampler, int lod) { return vec"+c+"(textureSize(sampler, lod)); }");break;case 11:return b=c.dim,a=c.isArray,c=B.getDimSize(b,a),"vec"+c+"(imageSize";case 17:this.decl("vec2 _textureSize(sampler2D sampler, int lod) { return vec2(textureSize(sampler, lod)); }")}return"_texture"+a+"Size";case 51:if(b[0].t==x.TMat3x4)return this.decl(Xb.MAT34),this.decl("mat3 _mat3( _mat3x4 v ) { return mat3(v.a.xyz,v.b.xyz,v.c.xyz); }"),"_mat3";break;case 53:this.decl(Xb.MAT34);
if(1==b.length)return this.decl("_mat3x4 mat_to_34( mat4 m ) { return _mat3x4(m[0],m[1],m[2]); }"),"mat_to_34";break;case 55:this.decl("vec4 pack( float v ) { vec4 color = fract(v * vec4(1, 255, 255.*255., 255.*255.*255.)); return color - color.yzww * vec4(1. / 255., 1. / 255., 1. / 255., 0.); }");break;case 56:this.decl("float unpack( vec4 color ) { return dot(color,vec4(1., 1. / 255., 1. / (255. * 255.), 1. / (255. * 255. * 255.))); }");break;case 57:this.decl("vec4 packNormal( vec3 v ) { return vec4((v + vec3(1.)) * vec3(0.5),1.); }");
break;case 58:this.decl("vec3 unpackNormal( vec4 v ) { return normalize((v.xyz - vec3(0.5)) * vec3(2.)); }");break;case 59:this.decl("vec2 screenToUv( vec2 v ) { return v * vec2(0.5,-0.5) + vec2(0.5,0.5); }");break;case 60:this.decl("vec2 uvToScreen( vec2 v ) { return v * vec2(2.,-2.) + vec2(-1., 1.); }");break;case 61:case 62:case 63:if(this.isVertex)throw u.thrown("Can't use "+w.string(a)+" in vertex shader");300>this.version&&this.decl("#extension GL_OES_standard_derivatives:enable");break;case 74:330>
this.version&&this.decl("#extension GL_ARB_shader_bit_encoding :enable");this.decl("int _floatBitsToUint( float v) { return int(floatBitsToUint(v)); }");this.decl("ivec2 _floatBitsToUint( vec2 v ) { return ivec2(floatBitsToUint(v)); }");this.decl("ivec3 _floatBitsToUint( vec3 v ) { return ivec3(floatBitsToUint(v)); }");this.decl("ivec4 _floatBitsToUint( vec4 v ) { return ivec4(floatBitsToUint(v)); }");break;case 73:case 75:330>this.version&&this.decl("#extension GL_ARB_shader_bit_encoding :enable");
break;case 76:330>this.version&&this.decl("#extension GL_ARB_shader_bit_encoding :enable"),this.decl("float _uintBitsToFloat( int v ) { return uintBitsToFloat(uint(v)); }"),this.decl("vec2 _uintBitsToFloat( ivec2 v ) { return uintBitsToFloat(uvec2(v)); }"),this.decl("vec3 _uintBitsToFloat( ivec3 v ) { return uintBitsToFloat(uvec3(v)); }"),this.decl("vec4 _uintBitsToFloat( ivec4 v ) { return uintBitsToFloat(uvec4(v)); }")}return Xb.GLOBALS[a._hx_index]},addExpr:function(a,b){var c=a.e;switch(c._hx_index){case 0:b=
c.c;switch(b._hx_index){case 0:this.buf.b+=w.string("null");break;case 1:this.buf.b+=w.string(b.b);break;case 2:var d=b.v;this.buf.b+=w.string(d);break;case 3:b=""+b.v;this.buf.b+=w.string(b);-1==b.indexOf(".")&&-1==b.indexOf("e")&&(this.buf.b+=w.string("."));break;case 4:d=b.v,this.buf.b+=w.string('"'+d+'"')}break;case 1:d=c.v;var e=this.varName(d);this.buf.b+=w.string(e);break;case 2:e=c.g;this.buf.b+=w.string(Xb.GLOBALS[e._hx_index]);break;case 3:var f=c.e;this.buf.b+=w.string("(");this.addValue(f,
b);this.buf.b+=w.string(")");break;case 4:var g=c.el;this.buf.b+=w.string("{\n");a=b+"\t";for(e=0;e<g.length;)f=g[e],++e,this.buf.b+=w.string(a),this.addExpr(f,a),this.newLine(f);this.buf.b+=w.string(b);this.buf.b+=w.string("}");break;case 5:d=c.op;f=c.e1;c=c.e2;e=f.t;g=c.t;switch(d._hx_index){case 1:if(5==e._hx_index)if(3==e.size)if(1==e.t._hx_index)if(8==g._hx_index){this.decl(Xb.MAT34);this.decl("vec3 m3x4mult( vec3 v, _mat3x4 m) { vec4 ve = vec4(v,1.0); return vec3(dot(m.a,ve),dot(m.b,ve),dot(m.c,ve)); }");
if(g=20==d._hx_index?!0:!1)this.addValue(f,b),this.buf.b+=w.string(" = ");this.buf.b+=w.string("m3x4mult(");this.addValue(f,b);this.buf.b+=w.string(",");this.addValue(c,b);this.buf.b+=w.string(")")}else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),
d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);break;case 5:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=w.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw u.thrown("assert");
}this.buf.b+=w.string(d);this.buf.b+=w.string("(");this.addValue(f,b);this.buf.b+=w.string(",");this.addValue(c,b);this.buf.b+=w.string("))")}else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);break;case 6:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=w.string("vec"+e+"(");
switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw u.thrown("assert");}this.buf.b+=w.string(d);this.buf.b+=w.string("(");this.addValue(f,b);this.buf.b+=w.string(",");this.addValue(c,b);this.buf.b+=w.string("))")}else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,
b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);break;case 7:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=w.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw u.thrown("assert");}this.buf.b+=w.string(d);this.buf.b+=w.string("(");this.addValue(f,b);this.buf.b+=
w.string(",");this.addValue(c,b);this.buf.b+=w.string("))")}else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);break;case 8:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=w.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";
break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw u.thrown("assert");}this.buf.b+=w.string(d);this.buf.b+=w.string("(");this.addValue(f,b);this.buf.b+=w.string(",");this.addValue(c,b);this.buf.b+=w.string("))")}else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=
w.string(" "),this.addValue(c,b);break;case 9:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=w.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d="lessThanEqual";break;default:throw u.thrown("assert");}this.buf.b+=w.string(d);this.buf.b+=w.string("(");this.addValue(f,b);this.buf.b+=w.string(",");this.addValue(c,b);this.buf.b+=w.string("))")}else this.addValue(f,
b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);break;case 10:if(5==e._hx_index)if(5==g._hx_index){e=e.size;this.buf.b+=w.string("vec"+e+"(");switch(d._hx_index){case 5:d="equal";break;case 6:d="notEqual";break;case 7:d="greaterThan";break;case 8:d="greaterThanEqual";break;case 9:d="lessThan";break;case 10:d=
"lessThanEqual";break;default:throw u.thrown("assert");}this.buf.b+=w.string(d);this.buf.b+=w.string("(");this.addValue(f,b);this.buf.b+=w.string(",");this.addValue(c,b);this.buf.b+=w.string("))")}else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);break;case 18:this.decl("int _ushr( int i, int j ) { return int(uint(i) >> uint(j)); }");
this.buf.b+=w.string("_ushr(");this.addValue(f,b);this.buf.b+=w.string(",");this.addValue(c,b);this.buf.b+=w.string(")");break;case 19:if(a.t!=x.TInt){if(g=20==d._hx_index?!0:!1)this.addValue(f,b),this.buf.b+=w.string(" = ");this.addExpr({e:q.TCall({e:q.TGlobal(C.Mod),t:x.TFun([]),p:a.p},[f,c]),t:a.t,p:a.p},b)}else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);break;case 20:switch(d.op._hx_index){case 1:if(5==e._hx_index)if(3==
e.size)if(1==e.t._hx_index)if(8==g._hx_index){this.decl(Xb.MAT34);this.decl("vec3 m3x4mult( vec3 v, _mat3x4 m) { vec4 ve = vec4(v,1.0); return vec3(dot(m.a,ve),dot(m.b,ve),dot(m.c,ve)); }");if(g=20==d._hx_index?!0:!1)this.addValue(f,b),this.buf.b+=w.string(" = ");this.buf.b+=w.string("m3x4mult(");this.addValue(f,b);this.buf.b+=w.string(",");this.addValue(c,b);this.buf.b+=w.string(")")}else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),
this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);break;case 19:if(a.t!=x.TInt){if(g=20==d._hx_index?!0:!1)this.addValue(f,b),this.buf.b+=
w.string(" = ");this.addExpr({e:q.TCall({e:q.TGlobal(C.Mod),t:x.TFun([]),p:a.p},[f,c]),t:a.t,p:a.p},b)}else this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b);break;default:this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),this.addValue(c,b)}break;default:this.addValue(f,b),this.buf.b+=w.string(" "),d=pa.opStr(d),this.buf.b+=w.string(d),this.buf.b+=w.string(" "),
this.addValue(c,b)}break;case 6:d=c.op;f=c.e1;switch(d._hx_index){case 0:d="++";break;case 1:d="--";break;case 2:d="!";break;case 3:d="-";break;case 4:d="~";break;default:throw u.thrown("assert");}this.buf.b+=w.string(d);this.addValue(f,b);break;case 7:d=c.v;f=c.init;this.locals.h[d.id]=d;null!=f?(e=this.varName(d),this.buf.b+=w.string(e),this.buf.b+=w.string(" = "),this.addValue(f,b)):this.buf.b+=w.string("/*var*/");break;case 8:e=c.e;g=c.args;c=e.e;if(2==c._hx_index)switch(f=c.g,f._hx_index){case 36:d=
this.getFunName(f,g,a.t);this.buf.b+=w.string(d);this.buf.b+=w.string("(");this.addValue(g[0],b);this.buf.b+=w.string(", ");this.addValue(g[1],b);2!=g.length?(this.buf.b+=w.string(", "),this.addValue(g[2],b),this.buf.b+=w.string(")")):this.buf.b+=w.string(", 0)");break;case 37:d=this.getFunName(f,g,a.t);this.buf.b+=w.string(d);this.buf.b+=w.string("(");this.addValue(g[0],b);1!=g.length?(this.buf.b+=w.string(", "),this.addValue(g[1],b),this.buf.b+=w.string(")")):(c=g[0].t,g=11==c._hx_index?!0:!1,this.buf.b=
g?this.buf.b+w.string("))"):this.buf.b+w.string(", 0)"));break;case 54:if(1==g.length)f=g[0],this.buf.b+=w.string("clamp("),this.addValue(f,b),this.buf.b+=w.string(", 0., 1.)");else{d=e;c=d.e;2==c._hx_index?(e=c.g,e=this.getFunName(e,g,a.t),this.buf.b+=w.string(e)):this.addValue(d,b);this.buf.b+=w.string("(");d=!0;for(c=0;c<g.length;)f=g[c],++c,d?d=!1:this.buf.b+=w.string(", "),this.addValue(f,b);this.buf.b+=w.string(")")}break;case 78:break;case 79:if(3==g.length){e=g[0];f=g[1];a=g[2];c=e.t;if(11==
c._hx_index)g=c.channels;else throw u.thrown("assert");this.buf.b+=w.string("imageStore(");this.addValue(e,b);this.buf.b+=w.string(",");this.addValue(f,b);this.buf.b+=w.string(",");4!=g&&(this.buf.b+=w.string("("));this.addValue(a,b);4!=g&&(this.buf.b+=w.string(")"+(1==g?".xx":".xyyy")))}else for(d=e,c=d.e,2==c._hx_index?(e=c.g,e=this.getFunName(e,g,a.t),this.buf.b+=w.string(e)):this.addValue(d,b),this.buf.b+=w.string("("),d=!0,c=0;c<g.length;)f=g[c],++c,d?d=!1:this.buf.b+=w.string(", "),this.addValue(f,
b);this.buf.b+=w.string(")");break;case 84:this.buf.b+=w.string("atomicAdd(");this.addValue(g[0],b);this.buf.b+=w.string("[");this.addValue(g[1],b);this.buf.b+=w.string("],");this.addValue(g[2],b);this.buf.b+=w.string(")");break;default:d=e;c=d.e;2==c._hx_index?(e=c.g,e=this.getFunName(e,g,a.t),this.buf.b+=w.string(e)):this.addValue(d,b);this.buf.b+=w.string("(");d=!0;for(c=0;c<g.length;)f=g[c],++c,d?d=!1:this.buf.b+=w.string(", "),this.addValue(f,b);this.buf.b+=w.string(")")}else{d=e;e=d.e;2==e._hx_index?
(e=e.g,e=this.getFunName(e,g,a.t),this.buf.b+=w.string(e)):this.addValue(d,b);this.buf.b+=w.string("(");d=!0;for(e=0;e<g.length;)f=g[e],++e,d?d=!1:this.buf.b+=w.string(", "),this.addValue(f,b);this.buf.b+=w.string(")")}break;case 9:f=c.e;d=c.regs;if(3==f.t._hx_index){for(e=0;e<d.length;)if(a=d[e],++e,a!=sa.X)throw u.thrown("assert");switch(d.length){case 1:this.addValue(f,b);break;case 2:this.decl("vec2 _vec2( float v ) { return vec2(v,v); }");this.buf.b+=w.string("_vec2(");this.addValue(f,b);this.buf.b+=
w.string(")");break;case 3:this.decl("vec3 _vec3( float v ) { return vec3(v,v,v); }");this.buf.b+=w.string("_vec3(");this.addValue(f,b);this.buf.b+=w.string(")");break;case 4:this.decl("vec4 _vec4( float v ) { return vec4(v,v,v,v); }");this.buf.b+=w.string("_vec4(");this.addValue(f,b);this.buf.b+=w.string(")");break;default:throw u.thrown("assert");}}else for(this.addValue(f,b),this.buf.b+=w.string("."),e=0;e<d.length;){a=d[e];++e;b=this.buf;f=b.b;switch(a._hx_index){case 0:g="x";break;case 1:g="y";
break;case 2:g="z";break;case 3:g="w"}b.b=f+w.string(g)}break;case 10:e=c.econd;f=c.eif;a=c.eelse;this.buf.b+=w.string("if( ");this.addValue(e,b);this.buf.b+=w.string(") ");this.addExpr(f,b);null!=a&&(this.isBlock(f)||(this.buf.b+=w.string(";")),this.buf.b+=w.string(" else "),this.addExpr(a,b));break;case 11:this.buf.b+=w.string("discard");break;case 12:f=c.e;null==f?this.buf.b+=w.string("return"):(this.buf.b+=w.string("return "),this.addValue(f,b));break;case 13:d=c.v;e=c.it;g=c.loop;this.locals.h[d.id]=
d;e=e.e;if(5==e._hx_index)if(21==e.op._hx_index)f=e.e1,c=e.e2,this.buf.b+=w.string("for("),this.buf.b+=w.string(d.name+"="),this.addValue(f,b),this.buf.b+=w.string(";"+d.name+"<"),this.addValue(c,b),this.buf.b+=w.string(";"+d.name+"++) "),this.addBlock(g,b);else throw u.thrown("assert");else throw u.thrown("assert");break;case 14:this.buf.b+=w.string("continue");break;case 15:this.buf.b+=w.string("break");break;case 16:f=c.e;a=c.index;this.addValue(f,b);this.buf.b+=w.string("[");this.addValue(a,b);
this.buf.b+=w.string("]");break;case 17:g=c.el;e=a.t;if(15==e._hx_index)this.addType(e.t);else throw u.thrown("assert");this.buf.b+=w.string("["+g.length+"]");this.buf.b+=w.string("(");d=!0;for(e=0;e<g.length;)a=g[e],++e,d?d=!1:this.buf.b+=w.string(", "),this.addValue(a,b);this.buf.b+=w.string(")");break;case 18:this.buf.b+=w.string("switch(...)");break;case 19:e=c.e;g=c.loop;0==c.normalWhile?(a=e,b+="\t",this.buf.b+=w.string("do "),this.addBlock(g,b),this.buf.b+=w.string(" while( "),this.addValue(a,
b),this.buf.b+=w.string(" )")):(a=e,this.buf.b+=w.string("while( "),this.addValue(a,b),this.buf.b+=w.string(" ) "),this.addBlock(g,b));break;case 20:a=c.e;this.addExpr(a,b);break;case 21:e=c.name;this.addExpr(c.e,b);this.buf.b+=w.string(".");this.buf.b+=w.string(e);break;case 22:switch(e=c.code,g=c.args,c.target){case "code":case "glsl":a=0;for(f=new nf("{(\\d+)}","g");f.matchSub(e,a);)d=f.matchedPos(),this.buf.b+=w.string(e.substring(a,d.pos)),a=w.parseInt(f.matched(1)),a<g.length&&this.addValue(g[a].e,
b),a=d.pos+d.len;this.buf.b+=w.string(D.substr(e,a,null))}}},varName:function(a){if(a.kind==P.Output){if(this.isVertex)return"gl_Position";if(null!=this.glES&&2>=this.glES)return null==this.outIndexes?"gl_FragColor":"gl_FragData["+this.outIndexes.h[a.id]+"]"}var b=this.varNames.h[a.id];if(null!=b)return b;b=a.name;a.kind==P.Var&&(b+="_varying");Object.prototype.hasOwnProperty.call(Xb.KWDS.h,b)&&(b="_"+b);if(Object.prototype.hasOwnProperty.call(this.allNames.h,b)){var c=2;for(b+="_";Object.prototype.hasOwnProperty.call(this.allNames.h,
b+c);)++c;b+=c}this.varNames.h[a.id]=b;this.allNames.h[b]=a.id;return b},newLine:function(a){this.isBlock(a)?this.buf.b+=w.string("\n"):this.buf.b+=w.string(";\n")},isBlock:function(a){a=a.e;switch(a._hx_index){case 4:return!0;case 13:return a=a.loop,this.isBlock(a);case 19:return 1==a.normalWhile?(a=a.loop,this.isBlock(a)):!1;default:return!1}},initVar:function(a){switch(a.kind._hx_index){case 0:case 2:var b=a.type;switch(b._hx_index){case 15:var c=b.t;11==c._hx_index?(c=D.substr("rgba",0,c.channels),
this.buf.b+=w.string("layout("+c+"32f) uniform ")):this.buf.b+=w.string("uniform ");break;case 16:c=b.kind;switch(c._hx_index){case 1:case 4:if(430>this.version)throw u.thrown("SSBO are available since version 4.3");this.buf.b+=w.string("layout(std430) readonly buffer ");break;case 2:case 5:if(430>this.version)throw u.thrown("SSBO are available since version 4.3");this.buf.b+=w.string("layout(std430) buffer ");break;default:switch(this.buf.b+=w.string("layout(std140) "),c._hx_index){case 0:case 3:this.buf.b+=
w.string("uniform ");break;default:throw u.thrown("assert");}}break;default:this.buf.b+=w.string("uniform ")}break;case 1:this.buf.b+=w.string(null!=this.glES&&2>=this.glES?"attribute ":"in ");break;case 3:B.hasQualifier(a,ra.Flat)&&(this.buf.b+=w.string("flat "));this.buf.b+=w.string(null!=this.glES&&2>=this.glES?"varying ":this.isVertex?"out ":"in ");break;case 5:if(null!=this.glES&&2>=this.glES){this.outIndexes.h[a.id]=this.outIndex++;return}if(this.isVertex)return;null!=this.glES&&(this.buf.b+=
w.string("layout(location="+this.outIndex++ +") "));this.buf.b+=w.string("out ");break;case 6:return}if(null!=a.qualifiers)for(b=0,c=a.qualifiers;b<c.length;){var d=c[b];++b;if(6==d._hx_index)switch(d.p._hx_index){case 0:this.buf.b+=w.string("lowp ");break;case 1:this.buf.b+=w.string("mediump ");break;case 2:this.buf.b+=w.string("highp ")}}this.addVar(a);this.buf.b+=w.string(";\n")},initVars:function(a){this.uniformBuffer=this.outIndex=0;this.outIndexes=new Da;var b=0;for(a=a.vars;b<a.length;){var c=
a[b];++b;this.initVar(c)}this.buf.b+=w.string("\n");2>this.outIndex?this.outIndexes=null:!this.isVertex&&null!=this.glES&&2>=this.glES&&this.decl("#extension GL_EXT_draw_buffers : enable")},collectGlobals:function(a,b){var c=b.e;switch(c._hx_index){case 2:a.set(c.g,!0);break;case 8:var d=c.e;var e=c.args;c=d.e;var f=d.p;f=d.t;if(2==c._hx_index)if(78==c.g._hx_index)switch(e.length){case 1:c=e[0];d=c.e;f=c.p;f=c.t;if(0==d._hx_index)if(c=d.c,2==c._hx_index){var g=c.v;this.computeLayout=[g,1,1]}else c=
this,B.iter(b,function(b){c.collectGlobals(a,b)});else d=this,B.iter(b,function(b){d.collectGlobals(a,b)});break;case 2:f=e[0];var h=e[1];var k=f.e;var l=f.p;l=f.t;0==k._hx_index?(f=k.c,2==f._hx_index?(k=h.e,l=h.p,l=h.t,0==k._hx_index?(h=k.c,2==h._hx_index?(b=h.v,g=f.v,this.computeLayout=[g,b,1]):(f=this,B.iter(b,function(b){f.collectGlobals(a,b)}))):(h=this,B.iter(b,function(b){h.collectGlobals(a,b)}))):(k=this,B.iter(b,function(b){k.collectGlobals(a,b)}))):(l=this,B.iter(b,function(b){l.collectGlobals(a,
b)}));break;case 3:var m=e[0];var p=e[1];var q=e[2];e=m.e;var n=m.p;n=m.t;if(0==e._hx_index)if(m=e.c,2==m._hx_index)if(e=p.e,n=p.p,n=p.t,0==e._hx_index)if(p=e.c,2==p._hx_index)if(e=q.e,n=q.p,n=q.t,0==e._hx_index)if(q=e.c,2==q._hx_index){var r=q.v;g=m.v;b=p.v;this.computeLayout=[g,b,r]}else e=this,B.iter(b,function(b){e.collectGlobals(a,b)});else m=this,B.iter(b,function(b){m.collectGlobals(a,b)});else p=this,B.iter(b,function(b){p.collectGlobals(a,b)});else q=this,B.iter(b,function(b){q.collectGlobals(a,
b)});else n=this,B.iter(b,function(b){n.collectGlobals(a,b)});else{var u=this;B.iter(b,function(b){u.collectGlobals(a,b)})}break;default:var v=this;B.iter(b,function(b){v.collectGlobals(a,b)})}else{var w=this;B.iter(b,function(b){w.collectGlobals(a,b)})}else{var x=this;B.iter(b,function(b){x.collectGlobals(a,b)})}break;default:var z=this;B.iter(b,function(b){z.collectGlobals(a,b)})}},run:function(a){var b=new Le;var c=0;for(var d=a.funs;c<d.length;){var e=d[c];++c;this.collectGlobals(b,e.expr)}this.locals=
new Da;this.decls=[];this.buf=new Pc;this.exprValues=[];if(1!=a.funs.length)throw u.thrown("assert");e=a.funs[0];this.isVertex=e.kind==Ia.Vertex;(this.isCompute=e.kind==Ia.Main)||(this.isVertex?this.decl("precision highp float;"):this.decl("precision mediump float;"));this.initVars(a);this.isCompute&&this.decl("layout(local_size_x = "+this.computeLayout[0]+", local_size_y = "+this.computeLayout[1]+", local_size_z = "+this.computeLayout[2]+") in;");d=this.buf;this.buf=new Pc;this.buf.b+=w.string("void main(void) {\n");
c=e.expr.e;if(4==c._hx_index)for(a=c.el,c=0;c<a.length;)e=a[c],++c,this.buf.b+=w.string("\t"),this.addExpr(e,"\t"),this.newLine(e);else this.addExpr(e.expr,"");this.isVertex&&(this.buf.b+=w.string("\tgl_Position.z += gl_Position.z - gl_Position.w;\n"));this.buf.b+=w.string("}");this.exprValues.push(this.buf.b);this.buf=d;e=ge.array(this.locals);e.sort(function(a,b){return ua.compare(a.name,b.name)});for(c=0;c<e.length;)d=e[c],++c,this.addVar(d),this.buf.b+=w.string(";\n");this.buf.b+=w.string("\n");
c=0;for(d=this.exprValues;c<d.length;)e=d[c],++c,this.buf.b+=w.string(e),this.buf.b+=w.string("\n\n");null!=this.glES?this.decl("#version "+(100>this.version?100:this.version)+(150<this.version?" es":"")):this.isCompute||430<=this.version?this.decl("#version 430"):null!=this.version?this.decl("#version "+(150<this.version?150:this.version)):this.decl("#version 130");this.decls.push(this.buf.b);this.buf=null;return this.decls.join("\n")},__class__:Xb};var vj=function(){};z["hxsl._Linker.AllocatedVar"]=
vj;vj.__name__="hxsl._Linker.AllocatedVar";vj.prototype={__class__:vj};var Sf=function(a,b){this.name=a;this.uid=Sf.UID++;this.vertex=b;this.processed=new Da;this.usedFunctions=[];this.readMap=new Da;this.readVars=[];this.writeMap=new Da;this.writeVars=[]};z["hxsl._Linker.ShaderInfos"]=Sf;Sf.__name__="hxsl._Linker.ShaderInfos";Sf.prototype={__class__:Sf};var nj=function(a){this.debugDepth=0;this.mode=a};z["hxsl.Linker"]=nj;nj.__name__="hxsl.Linker";nj.prototype={error:function(a,b){return lb.t(a,
b)},mergeVar:function(a,b,c,d,e){switch(b.kind._hx_index){case 2:if(null==e||!B.hasBorrowQualifier(c,e))throw u.thrown("assert");break;case 6:throw u.thrown("assert");}b.kind!=c.kind&&b.kind!=P.Local&&c.kind!=P.Local&&this.error("'"+a+"' kind does not match : "+w.string(b.kind)+" should be "+w.string(c.kind),d);var f=b.type;var g=c.type;if(13==f._hx_index)if(13==g._hx_index)for(b=g.vl,c=f.vl,f=0;f<c.length;){var h=c[f];++f;var k=null;for(g=0;g<b.length;){var l=b[g];++g;if(h.name==l.name){k=l;break}}null==
k?b.push(this.allocVar(h,d,e).v):this.mergeVar(a+"."+k.name,h,k,d,e)}else la.enumEq(b.type,c.type)||this.error("'"+a+"' type does not match : "+B.toString(b.type)+" should be "+B.toString(c.type),d);else la.enumEq(b.type,c.type)||this.error("'"+a+"' type does not match : "+B.toString(b.type)+" should be "+B.toString(c.type),d)},allocVar:function(a,b,c,d,e){var f;if(null!=a.parent&&null==e){e=this.allocVar(a.parent,b,c);var g=e.v;d=g.name;for(g=g.parent;null!=g;)d=g.name+"."+d,g=g.parent}d=null==d?
a.name:d+"."+a.name;if(null!=a.qualifiers){var h=0;for(f=a.qualifiers;h<f.length;)g=f[h],++h,4==g._hx_index&&(d=g.n)}var k=d.toLowerCase();g=this.varMap.h[k];var l=a.name;if(null!=g){h=0;for(f=g.merged;h<f.length;){var m=f[h];++h;if(m==a)return g}f=B.hasBorrowQualifier(g.v,c);(a.kind!=P.Param||f||B.hasQualifier(a,ra.Shared)||this.isBatchShader)&&a.kind!=P.Function&&(a.kind!=P.Var&&a.kind!=P.Local||!B.hasQualifier(a,ra.Private))?(h=g.v,f=B.hasBorrowQualifier(a,g.rootShaderName),f=h.kind==P.Param&&
!f&&!B.hasQualifier(h,ra.Shared)&&!this.isBatchShader||h.kind==P.Function||(h.kind==P.Var||h.kind==P.Local)&&B.hasQualifier(h,ra.Private)):f=!0;if(f||a.kind==P.Param&&g.v.kind==P.Param){for(var p=2;;){var q=this.varMap.h[k+p];if(null==q)break;h=0;for(f=q.merged;h<f.length;)if(m=f[h],++h,m==a)return q;++p}a.kind==P.Input?(f=this.varMap,Object.prototype.hasOwnProperty.call(f.h,k)&&delete f.h[k],this.varMap.h[k+p]=g,g.v.name+=p,g.path+=p):(l+=p,d+=p,k+=p)}else return g.merged.push(a),this.mergeVar(d,
a,g.v,b,g.rootShaderName),this.varIdMap.h[a.id]=g.id,g}g={id:B.allocVarId(),name:l,type:a.type,kind:a.kind,qualifiers:a.qualifiers,parent:null==e?null:e.v};q=new vj;q.v=g;q.merged=[a];q.path=d;q.id=g.id;q.parent=e;q.instanceIndex=this.curInstance;q.rootShaderName=c;this.allVars.push(q);this.varMap.h[k]=q;h=g.type;if(13==h._hx_index){e=h.vl;h=[];for(f=0;f<e.length;)a=e[f],++f,h.push(this.allocVar(a,b,c,d,q).v);g.type=x.TStruct(h)}return q},mapExprVar:function(a){var b=a.e;switch(b._hx_index){case 1:var c=
b.v;if(!this.locals.h.hasOwnProperty(c.id)){var d=this.allocVar(c,a.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(sb.TRACE){var e=this.curShader.name+" read "+d.path;c=0;for(b=this.debugDepth;c<b;)c++,e="    "+e;Ka.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.readMap.h.hasOwnProperty(d.id)||(this.curShader.readMap.h[d.id]=d,this.curShader.readVars.push(d));if(null==this.curShader.vertex&&d.v.kind==
P.Var){if(sb.TRACE){e="Force "+this.curShader.name+" into fragment (use varying)";c=0;for(b=this.debugDepth;c<b;)c++,e="    "+e;Ka.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.vertex=!1}}return{e:q.TVar(d.v),t:d.v.type,p:a.p}}break;case 5:var f=b.op;var g=b.e1;var h=b.e2;c=g.e;switch(f._hx_index){case 4:switch(c._hx_index){case 1:c=b=c.v;if(this.locals.h.hasOwnProperty(c.id)){if(c=b,!this.locals.h.hasOwnProperty(c.id)){g=this.mapExprVar(g);
h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(sb.TRACE){e=this.curShader.name+" write "+d.path;b=0;for(c=this.debugDepth;b<c;)b++,e="    "+e;Ka.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,g,h),t:a.t,p:a.p}}}else{h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(sb.TRACE){e=
this.curShader.name+" write "+d.path;c=0;for(g=this.debugDepth;c<g;)c++,e="    "+e;Ka.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,{e:q.TVar(d.v),t:d.v.type,p:a.p},h),t:a.t,p:a.p}}break;case 9:if(b=c.e,c=b.e,1==c._hx_index&&(c=c.v,!this.locals.h.hasOwnProperty(c.id))){g=this.mapExprVar(g);h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(sb.TRACE){e=
this.curShader.name+" write "+d.path;b=0;for(c=this.debugDepth;b<c;)b++,e="    "+e;Ka.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,g,h),t:a.t,p:a.p}}}break;case 20:switch(c._hx_index){case 1:c=c.v;if(!this.locals.h.hasOwnProperty(c.id)){g=this.mapExprVar(g);h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(sb.TRACE){e=
this.curShader.name+" write "+d.path;b=0;for(c=this.debugDepth;b<c;)b++,e="    "+e;Ka.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,g,h),t:a.t,p:a.p}}break;case 9:if(b=c.e,c=b.e,1==c._hx_index&&(c=c.v,!this.locals.h.hasOwnProperty(c.id))){g=this.mapExprVar(g);h=this.mapExprVar(h);d=this.allocVar(c,g.p);if(null!=this.curShader&&!this.curShader.writeMap.h.hasOwnProperty(d.id)){if(sb.TRACE){e=
this.curShader.name+" write "+d.path;c=0;for(b=this.debugDepth;c<b;)c++,e="    "+e;Ka.trace(e,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapExprVar"})}this.curShader.writeMap.h[d.id]=d;this.curShader.writeVars.push(d)}return{e:q.TBinop(f,g,h),t:a.t,p:a.p}}}}break;case 7:c=b.v;this.locals.h[c.id]=!0;break;case 11:null!=this.curShader&&(this.curShader.vertex=!1,this.curShader.hasDiscard=!0);break;case 13:c=b.v;this.locals.h[c.id]=!0;break;case 22:f=b.target;c=b.code;
e=b.args;d=[];for(b=0;b<e.length;){var k=e[b];++b;switch(k.access._hx_index){case 0:g=this.mapExprVar(k.e);break;case 1:h=null!=this.curShader?this.mapSyntaxWrite(k.e):k.e;g=this.mapExprVar(h);break;case 2:h=this.mapExprVar(k.e),null!=this.curShader&&(h=this.mapSyntaxWrite(h)),g=h}d.push({e:g,access:k.access})}null!=this.curShader&&(this.curShader.hasSyntax=!0);return{e:q.TSyntax(f,c,d),t:a.t,p:a.p}}return B.map(a,M(this,this.mapExprVar))},mapSyntaxWrite:function(a){var b=a.e;if(1==b._hx_index){var c=
this.allocVar(b.v,a.p);if(!this.curShader.writeMap.h.hasOwnProperty(c.id)){if(sb.TRACE){var d=this.curShader.name+" syntax write "+c.path;b=0;for(var e=this.debugDepth;b<e;)b++,d="    "+d;Ka.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"mapSyntaxWrite"})}this.curShader.writeMap.h[c.id]=c;this.curShader.writeVars.push(c)}return{e:q.TVar(c.v),t:c.v.type,p:a.p}}return B.map(a,M(this,this.mapSyntaxWrite))},addShader:function(a,b,c,d){this.curShader=b=new Sf(a,b);
b.priority=d;b.body=this.mapExprVar(c);this.shaders.push(b);this.curShader=null;if(sb.TRACE){a="Adding shader "+a+" with priority "+d;c=0;for(d=this.debugDepth;c<d;)c++,a="    "+a;Ka.trace(a,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"addShader"})}return b},sortByPriorityDesc:function(a,b){return a.priority==b.priority?a.uid-b.uid:b.priority-a.priority},buildDependency:function(a,b,c){c=!c;for(var d=0,e=this.shaders;d<e.length;){var f=e[d];++d;if(f==a)c=!0;else if(c&&
f.writeMap.h.hasOwnProperty(b.id)){if(a.vertex){if(0==f.vertex)continue;null==f.vertex&&(f.vertex=!0)}if(sb.TRACE){for(var g=a.name+" => "+f.name+" ("+b.path+")",h=0,k=this.debugDepth;h<k;)h++,g="    "+g;Ka.trace(g,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"buildDependency"})}a.deps.set(f,!0);this.debugDepth++;this.initDependencies(f);this.debugDepth--;if(!f.readMap.h.hasOwnProperty(b.id))return}}b.v.kind==P.Var&&this.error("Variable "+b.path+" required by "+a.name+
" is missing initializer",null)},initDependencies:function(a){if(null==a.deps){a.deps=new vc;for(var b=0,c=a.readVars;b<c.length;){var d=c[b];++b;this.buildDependency(a,d,a.writeMap.h.hasOwnProperty(d.id))}}},collect:function(a,b,c){var d;a.onStack&&this.error("Loop in shader dependencies ("+a.name+")",null);if(a.marked!=c){a.marked=c;a.onStack=!0;var e=[];for(d=a.deps.keys();d.hasNext();){var f=d.next();e.push(f)}f=e;f.sort(M(this,this.sortByPriorityDesc));for(e=0;e<f.length;)d=f[e],++e,this.collect(d,
b,c);if(null==a.vertex){if(sb.TRACE){f="MARK "+a.name+" "+(c?"vertex":"fragment");e=0;for(d=this.debugDepth;e<d;)e++,f="    "+f;Ka.trace(f,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"collect"})}a.vertex=c}if(a.vertex==c){if(sb.TRACE){f="COLLECT "+a.name+" "+(c?"vertex":"fragment");e=0;for(d=this.debugDepth;e<d;)e++,f="    "+f;Ka.trace(f,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"collect"})}b.push(a)}a.onStack=!1}},link:function(a){var b,
c;if(sb.TRACE){var d="---------------------- LINKING -----------------------";var e=0;for(c=this.debugDepth;e<c;){var f=e++;d="    "+d}Ka.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"link"})}this.varMap=new La;this.varIdMap=new Da;this.allVars=[];this.shaders=[];this.locals=new Da;var g=[];e=[];c=0;for(b=a;c<b.length;){var h=b[c];f=c++;if(a.indexOf(h)<f){var k=Jg.shaderData(h);g.push({origin:h,cloned:k});e.push(k)}else e.push(h)}a=e;this.curInstance=0;var l=
[];for(e=0;e<a.length;){h=a[e];++e;this.isBatchShader=this.mode==Kb.Batch&&aa.startsWith(h.name,"batchShader_");c=0;for(b=h.vars;c<b.length;){d=b[c];++c;var m=this.allocVar(d,null,h.name);this.isBatchShader&&m.v.kind==P.Param&&!aa.startsWith(m.path,"Batch_")&&(m.v.kind=P.Local,null==m.v.qualifiers&&(m.v.qualifiers=[]),m.v.qualifiers.push(ra.Flat));d.kind==P.Output&&l.push(d)}m=0;for(k=h.funs;m<k.length;){f=k[m];++m;var p=this.allocVar(f.ref,f.expr.p);p.kind=f.kind}this.curInstance++}p=0;var t=[-3E3],
n=[-2E3],r=[-1E3],v=[-2500];for(e=0;e<a.length;){h=a[e];++e;c=0;for(b=h.funs;c<b.length;){f=b[c];++c;d=this.allocVar(f.ref,f.expr.p);if(null==d.kind)throw u.thrown("assert");switch(d.kind._hx_index){case 0:case 1:if(this.mode==Kb.Compute)throw g=d.kind,u.thrown("Unexpected "+L[g.__enum__].__constructs__[g._hx_index]._hx_name.toLowerCase()+"() function in compute shader");this.addShader(h.name+"."+(d.kind==Ia.Vertex?"vertex":"fragment"),d.kind==Ia.Vertex,f.expr,p+(d.kind==Ia.Vertex?-1500:-500));break;
case 2:switch(f.ref.name){case "__init__fragment":d=r;var w=!1;break;case "__init__main":d=v;w=!1;break;case "__init__vertex":d=n;w=!0;break;default:d=t,w=null}m=f.expr.e;if(4==m._hx_index){m=m.el;var z=0;for(k=0;k<m.length;){var A=m[k];++k;this.addShader(h.name+"."+f.ref.name+z++,w,A,d[0]++)}}else this.addShader(h.name+"."+f.ref.name,w,f.expr,d[0]++);break;case 3:throw u.thrown("Unexpected helper function in linker "+d.v.name);case 4:if(this.mode!=Kb.Compute)throw u.thrown("Unexpected main() outside compute shader");
this.addShader(h.name,!0,f.expr,p).isCompute=!0}}++p}this.shaders.sort(M(this,this.sortByPriorityDesc));e=b=0;for(c=this.shaders;e<c.length;)h=c[e],++e,h.uid=b++;a=new Sf("<entry>",!1);a.deps=new vc;for(e=0;e<l.length;)d=l[e],++e,this.buildDependency(a,this.allocVar(d,null),!1);e=0;for(c=this.shaders;e<c.length;)if(h=c[e],++e,h.hasDiscard||h.isCompute||h.hasSyntax)this.initDependencies(h),a.deps.set(h,!0);e=0;for(c=this.shaders;e<c.length;)if(h=c[e],++e,null==h.vertex){k=!0;b=0;for(m=h.readVars;b<
m.length;)if(f=m[b],++b,f.v.kind!=P.Param){k=!1;break}if(k){if(sb.TRACE){d="Force "+h.name+" into fragment since it only reads params";k=0;for(b=this.debugDepth;k<b;)f=k++,d="    "+d;Ka.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"link"})}h.vertex=!1}}e=0;for(c=this.shaders;e<c.length;)if(h=c[e],++e,null!=h.deps){if(null==h.vertex)for(k=h.deps.keys();k.hasNext();)if(b=k.next(),0==b.vertex){if(sb.TRACE){d=h.name+" marked as fragment because of "+b.name;b=0;for(m=
this.debugDepth;b<m;)f=b++,d="    "+d;Ka.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"link"})}h.vertex=!1;break}if(h.vertex)for(f=h.deps.keys();f.hasNext();)if(m=f.next(),null==m.vertex){if(sb.TRACE){d=m.name+" marked as vertex because of "+h.name;k=0;for(b=this.debugDepth;k<b;)k++,d="    "+d;Ka.trace(d,{fileName:"hxsl/Debug.hx",lineNumber:31,className:"hxsl.Linker",methodName:"link"})}m.vertex=!0}}d=[];f=[];this.collect(a,d,!0);this.collect(a,f,!1);if(f.pop()!=
a)throw u.thrown("assert");e=0;for(c=this.shaders;e<c.length;)h=c[e],++e,h.marked=null;e=0;for(c=d.concat(f);e<c.length;){h=c[e];++e;for(k=h.deps.keys();k.hasNext();)b=k.next(),null==b.marked&&this.error(b.name+" needed by "+h.name+" is unreachable",null);h.marked=!0}l=[];var C={},D=null;D=function(a){C.hasOwnProperty(a.id)||(C[a.id]=!0,null!=a.v.parent?D(a.parent):l.push(a.v))};e=0;for(c=d.concat(f);e<c.length;){h=c[e];++e;b=0;for(m=h.readVars;b<m.length;)p=m[b],++b,D(p);k=0;for(b=h.writeVars;k<
b.length;)m=b[k],++k,D(m)}var E=null;E=function(a){var b=a.type;if(13==b._hx_index){var c=b.vl;if(a.kind!=P.Input){var d=[];for(b=0;b<c.length;){var e=c[b];++b;C.hasOwnProperty(e.id)&&(E(e),d.push(e))}a.type=x.TStruct(d)}}};for(e=0;e<l.length;)p=l[e],++e,E(p);e=function(a,b,c){b={id:B.allocVarId(),name:b,type:x.TFun([{ret:x.TVoid,args:[]}]),kind:P.Function};l.push(b);for(var d=[],e=0;e<c.length;){var f=c[e];++e;var g=f.body.e;if(4==g._hx_index)for(f=g.el,g=0;g<f.length;){var h=f[g];++g;d.push(h)}else d.push(f.body)}c=
{e:q.TBlock(d),t:x.TVoid,p:0==d.length?null:d[0].p};return{kind:a,ref:b,ret:x.TVoid,args:[],expr:c}};h=this.mode==Kb.Compute?[e(Ia.Main,"main",d)]:[e(Ia.Vertex,"vertex",d),e(Ia.Fragment,"fragment",f)];for(e=0;e<g.length;)for(k=g[e],++e,c=0,b=k.cloned.vars.length;c<b;)f=c++,this.allocVar(k.cloned.vars[f],null).merged.unshift(k.origin.vars[f]);return{name:"out",vars:l,funs:h}},__class__:nj};var dc=L["hxsl.Output"]={__ename__:!0,__constructs__:null,Const:(A=function(a){return{_hx_index:0,v:a,__enum__:"hxsl.Output",
toString:v}},A._hx_name="Const",A.__params__=["v"],A),Value:(A=function(a,b){return{_hx_index:1,v:a,size:b,__enum__:"hxsl.Output",toString:v}},A._hx_name="Value",A.__params__=["v","size"],A),PackNormal:(A=function(a){return{_hx_index:2,v:a,__enum__:"hxsl.Output",toString:v}},A._hx_name="PackNormal",A.__params__=["v"],A),PackFloat:(A=function(a){return{_hx_index:3,v:a,__enum__:"hxsl.Output",toString:v}},A._hx_name="PackFloat",A.__params__=["v"],A),Vec2:(A=function(a){return{_hx_index:4,a:a,__enum__:"hxsl.Output",
toString:v}},A._hx_name="Vec2",A.__params__=["a"],A),Vec3:(A=function(a){return{_hx_index:5,a:a,__enum__:"hxsl.Output",toString:v}},A._hx_name="Vec3",A.__params__=["a"],A),Vec4:(A=function(a){return{_hx_index:6,a:a,__enum__:"hxsl.Output",toString:v}},A._hx_name="Vec4",A.__params__=["a"],A),Swiz:(A=function(a,b){return{_hx_index:7,a:a,swiz:b,__enum__:"hxsl.Output",toString:v}},A._hx_name="Swiz",A.__params__=["a","swiz"],A)};dc.__constructs__=[dc.Const,dc.Value,dc.PackNormal,dc.PackFloat,dc.Vec2,dc.Vec3,
dc.Vec4,dc.Swiz];dc.__empty_constructs__=[];var pa=function(a){null==a&&(a=!1);this.varId=a};z["hxsl.Printer"]=pa;pa.__name__="hxsl.Printer";pa.opStr=function(a){switch(a._hx_index){case 0:return"+";case 1:return"*";case 2:return"/";case 3:return"-";case 4:return"=";case 5:return"==";case 6:return"!=";case 7:return">";case 8:return">=";case 9:return"<";case 10:return"<=";case 11:return"&";case 12:return"|";case 13:return"^";case 14:return"&&";case 15:return"||";case 16:return"<<";case 17:return">>";
case 18:return">>>";case 19:return"%";case 20:return pa.opStr(a.op)+"=";case 21:return"...";case 22:return"=>";default:return"??"+w.string(a)}};pa.toString=function(a,b){null==b&&(b=!1);return(new pa(b)).exprString(a)};pa.shaderToString=function(a,b){null==b&&(b=!1);return(new pa(b)).shaderString(a)};pa.check=function(a,b){var c;try{var d=new Da,e=[],f=null;f=function(a,b){if(b){if(d.h.hasOwnProperty(a.id))throw u.thrown("Duplicate var "+a.id);d.h[a.id]=a;e.push(a)}else d.remove(a.id);var c=a.type;
if(13==c._hx_index){var g=c.vl;for(c=0;c<g.length;)a=g[c],++c,f(a,b)}};var g=null;g=function(a){var b=a.e;switch(b._hx_index){case 1:a=b.v;if(!d.h.hasOwnProperty(a.id))throw u.thrown("Unbound var "+a.name+"@"+a.id);break;case 4:a=b.el;b=e;e=[];for(var c=0;c<a.length;){var h=a[c];++c;g(h)}for(c=0;c<e.length;)a=e[c],++c,f(a,!1);e=b;break;case 7:a=b.v;b=b.init;null!=b&&g(b);f(a,!0);break;case 13:a=b.v;c=b.loop;g(b.it);f(a,!0);g(c);f(a,!1);break;default:B.iter(a,g)}};var h=0;for(c=a.vars;h<c.length;){var k=
c[h];++h;f(k,!0)}h=0;for(c=a.funs;h<c.length;){var l=c[h];++h;var m=0;for(var p=l.args;m<p.length;)k=p[m],++m,f(k,!0);g(l.expr);for(var q=0,n=l.args;q<n.length;){var r=n[q];++q;f(r,!1)}}}catch(y){c=u.caught(y).unwrap();if("string"==typeof c){k=c+"\n    in\n"+pa.shaderToString(a,!0);if(null!=b){c=[];for(m=0;m<b.length;)a=b[m],++m,c.push(pa.shaderToString(a,!0));k+="\n    from\n\n"+c.join("\n\n")}throw u.thrown(k);}throw y;}};pa.prototype={add:function(a){this.buffer.b+=w.string(a)},shaderString:function(a){this.buffer=
new Pc;for(var b=0,c=a.vars;b<c.length;){var d=c[b];++b;this.addVar(d,null);this.buffer.b+=w.string(";\n")}0<a.vars.length&&(this.buffer.b+=w.string("\n"));b=0;for(c=a.funs;b<c.length;)a=c[b],++b,this.addFun(a),this.buffer.b+=w.string("\n\n");return this.buffer.b},varString:function(a){this.buffer=new Pc;this.addVar(a,null);return this.buffer.b},funString:function(a){this.buffer=new Pc;this.addFun(a);return this.buffer.b},exprString:function(a){this.buffer=new Pc;this.addExpr(a,"");return this.buffer.b},
addVar:function(a,b,c,d){null==c&&(c="");if(null!=a.qualifiers){var e=0;for(var f=a.qualifiers;e<f.length;){var g=f[e];++e;switch(g._hx_index){case 0:var h=g.max;h="const"+(null==h?"":"("+h+")");break;case 1:h="private";break;case 2:h="nullable";break;case 3:h="perObject";break;case 4:h="name('"+g.n+"')";break;case 5:h="shared";break;case 6:h=g.p;h=L[h.__enum__].__constructs__[h._hx_index]._hx_name.toLowerCase()+"p";break;case 7:h="range("+g.min+","+g.max+")";break;case 8:h="ignore";break;case 9:h=
"perInstance("+g.v+")";break;case 10:h='doc("'+aa.replace(g.s,'"','\\"')+'")';break;case 11:h="borrow("+g.source+")";break;case 12:h="sampler("+g.name+")";break;case 13:h="final";break;case 14:h="flat"}this.buffer.b+=w.string("@"+h+" ")}}if(a.kind!=b)switch(a.kind._hx_index){case 0:this.buffer.b+=w.string("@global ");break;case 1:this.buffer.b+=w.string("@input ");break;case 2:this.buffer.b+=w.string("@param ");break;case 3:this.buffer.b+=w.string("@varying ");break;case 4:this.buffer.b+=w.string("@local ");
break;case 5:this.buffer.b+=w.string("@output ");break;case 6:this.buffer.b+=w.string("@function ")}this.buffer.b+=w.string("var ");a.parent==d?this.buffer.b+=w.string(a.name+(this.varId?"@"+a.id:"")):this.addVarName(a);this.buffer.b+=w.string(" : ");e=a.type;if(13==e._hx_index){a=e.vl;this.buffer.b+=w.string("{");b=!0;for(e=0;e<a.length;)h=a[e],++e,b?b=!1:this.buffer.b+=w.string(", "),this.addVar(h,h.kind,c,h);this.buffer.b+=w.string("}")}else h=B.toString(a.type),this.buffer.b+=w.string(h)},addFun:function(a){this.buffer.b+=
w.string("function "+a.ref.name+"(");for(var b=!0,c=0,d=a.args;c<d.length;){var e=d[c];++c;b?(this.buffer.b+=w.string(" "),b=!1):this.buffer.b+=w.string(", ");this.addVar(e,P.Local)}0<a.args.length&&(this.buffer.b+=w.string(" "));b=") : "+B.toString(a.ret)+" ";this.buffer.b+=w.string(b);this.addExpr(a.expr,"")},addVarName:function(a){null!=a.parent&&(this.addVarName(a.parent),this.buffer.b+=w.string("."));this.buffer.b+=w.string(a.name);this.varId&&(this.buffer.b+=w.string("@"+a.id))},addConst:function(a){var b=
this.buffer,c=b.b;switch(a._hx_index){case 0:var d="null";break;case 1:d=a.b;break;case 2:d=a.v;break;case 3:d=a.v;break;case 4:d='"'+a.v+'"'}b.b=c+w.string(d)},addExpr:function(a,b){var c;var d=a.e;switch(d._hx_index){case 0:var e=d.c;this.addConst(e);break;case 1:var f=d.v;this.addVarName(f);break;case 2:f=da.toString(d.g);this.buffer.b+=w.string(f);break;case 3:a=d.e;this.buffer.b+=w.string("(");this.addExpr(a,b);this.buffer.b+=w.string(")");break;case 4:f=d.el;this.buffer.b+=w.string("{");b+=
"\t";for(c=0;c<f.length;)a=f[c],++c,this.buffer.b+=w.string("\n"+b),this.addExpr(a,b),this.buffer.b+=w.string(";");b=D.substr(b,1,null);0<f.length&&(this.buffer.b+=w.string("\n"+b));this.buffer.b+=w.string("}");break;case 5:c=d.op;a=d.e1;d=d.e2;this.addExpr(a,b);f=" "+pa.opStr(c)+" ";this.buffer.b+=w.string(f);this.addExpr(d,b);break;case 6:c=d.op;a=d.e1;switch(c._hx_index){case 0:f="++";break;case 1:f="--";break;case 2:f="!";break;case 3:f="-";break;case 4:f="~";break;default:throw u.thrown("assert");
}this.buffer.b+=w.string(f);this.addExpr(a,b);break;case 7:f=d.v;a=d.init;this.addVar(f,P.Local,b);null!=a&&(this.buffer.b+=w.string(" = "),this.addExpr(a,b));break;case 8:a=d.e;f=d.args;this.addExpr(a,b);this.buffer.b+=w.string("(");d=!0;for(c=0;c<f.length;)a=f[c],++c,d?d=!1:this.buffer.b+=w.string(", "),this.addExpr(a,b);this.buffer.b+=w.string(")");break;case 9:a=d.e;d=d.regs;this.addExpr(a,b);this.buffer.b+=w.string(".");for(c=0;c<d.length;)b=d[c],++c,this.buffer.b+=w.string(pa.SWIZ[b._hx_index]);
break;case 10:a=d.econd;c=d.eif;d=d.eelse;this.buffer.b+=w.string("if( ");this.addExpr(a,b);this.buffer.b+=w.string(" ) ");this.addExpr(c,b);null!=d&&(this.buffer.b+=w.string(" else "),this.addExpr(d,b));break;case 11:this.buffer.b+=w.string("discard");break;case 12:a=d.e;this.buffer.b+=w.string("return");null!=a&&(this.buffer.b+=w.string(" "),this.addExpr(a,b));break;case 13:f=d.v;a=d.it;d=d.loop;this.buffer.b+=w.string("for( ");this.addVarName(f);this.buffer.b+=w.string(" in ");this.addExpr(a,b);
this.buffer.b+=w.string(" ) ");this.addExpr(d,b);break;case 14:this.buffer.b+=w.string("continue");break;case 15:this.buffer.b+=w.string("break");break;case 16:a=d.e;d=d.index;this.addExpr(a,b);this.buffer.b+=w.string("[");this.addExpr(d,b);this.buffer.b+=w.string("]");break;case 17:f=d.el;this.buffer.b+=w.string("[");d=!0;for(c=0;c<f.length;)a=f[c],++c,d?d=!1:this.buffer.b+=w.string(", "),this.addExpr(a,b);this.buffer.b+=w.string("]");break;case 18:a=d.e;var g=d.cases,h=d.def;this.buffer.b+=w.string("switch( ");
this.addExpr(a,b);this.buffer.b+=w.string(") {");var k=b;for(c=0;c<g.length;){e=g[c];++c;this.buffer.b+=w.string("\n"+b);this.buffer.b+=w.string("case ");d=!0;a=0;for(var l=e.values;a<l.length;)f=l[a],++a,d?d=!1:this.buffer.b+=w.string(", "),this.addExpr(f,b);b+="\t";this.buffer.b+=w.string(":\n"+b);this.addExpr(e.expr,b);b=k}null!=h&&(this.buffer.b+=w.string("\n"+b),b+="\t",this.buffer.b+=w.string("default:\n"+b),this.addExpr(h,b),b=k);this.buffer.b+=w.string("\n"+b+"}");break;case 19:c=d.e;a=d.loop;
0==d.normalWhile?(d=a,a=c,k=b,b+="\t",this.buffer.b+=w.string("do {\n"+b),this.addExpr(d,b),b=k,this.buffer.b+=w.string("\n"+b+"} while( "),this.addExpr(a,b),this.buffer.b+=w.string(" )")):(d=a,a=c,this.buffer.b+=w.string("while( "),this.addExpr(a,b),k=b,b+="\t",this.buffer.b+=w.string(" ) {\n"+b),this.addExpr(d,b),this.buffer.b+=w.string("\n"+k+"}"));break;case 20:c=d.m;f=d.args;a=d.e;this.buffer.b+=w.string("@");this.buffer.b+=w.string(c);if(0<f.length){this.buffer.b+=w.string("(");d=!0;for(c=0;c<
f.length;)e=f[c],++c,d?d=!1:this.buffer.b+=w.string(", "),this.addConst(e);this.buffer.b+=w.string(")")}this.buffer.b+=w.string(" ");this.addExpr(a,b);break;case 21:a=d.e;d=d.name;this.addExpr(a,b);this.buffer.b+=w.string(".");this.buffer.b+=w.string(d);break;case 22:a=d.target;c=d.code;f=d.args;this.buffer.b+=w.string("Syntax.");this.buffer.b+=w.string(a);this.buffer.b+=w.string("(");this.addConst(K.CString(c));for(d=0;d<f.length;){a=f[d];++d;switch(a.access._hx_index){case 0:this.buffer.b+=w.string(", @r ");
break;case 1:this.buffer.b+=w.string(", @w ");break;case 2:this.buffer.b+=w.string(", @rw ")}this.addExpr(a.e,b)}this.buffer.b+=w.string(")")}},__class__:pa};var Kb=L["hxsl.LinkMode"]={__ename__:!0,__constructs__:null,Default:{_hx_name:"Default",_hx_index:0,__enum__:"hxsl.LinkMode",toString:v},Batch:{_hx_name:"Batch",_hx_index:1,__enum__:"hxsl.LinkMode",toString:v},Compute:{_hx_name:"Compute",_hx_index:2,__enum__:"hxsl.LinkMode",toString:v}};Kb.__constructs__=[Kb.Default,Kb.Batch,Kb.Compute];Kb.__empty_constructs__=
[Kb.Default,Kb.Batch,Kb.Compute];var Pf=function(a,b,c,d,e){this.name=a;this.pos=b;this.instance=c;this.index=d;this.type=e};z["hxsl.AllocParam"]=Pf;Pf.__name__="hxsl.AllocParam";Pf.prototype={clone:function(a){null==a&&(a=!1);var b=new Pf(this.name,this.pos,this.instance,this.index,this.type);null!=this.perObjectGlobal&&(b.perObjectGlobal=this.perObjectGlobal.clone(a));null!=this.next&&(b.next=this.next.clone(a));return b},__class__:Pf};var Ig=function(a,b,c){this.pos=a;this.path=b;this.gid=za.allocID(b);
this.type=c};z["hxsl.AllocGlobal"]=Ig;Ig.__name__="hxsl.AllocGlobal";Ig.prototype={clone:function(a){null==a&&(a=!1);var b=new Ig(this.pos,this.path,this.type);null!=this.next&&(b.next=this.next.clone(a));a&&(b.gid=0);return b},__class__:Ig};var rj=function(){};z["hxsl.RuntimeShaderData"]=rj;rj.__name__="hxsl.RuntimeShaderData";rj.prototype={__class__:rj};var qj=function(a,b){this.shader=a;this.bits=b};z["hxsl.ShaderInstanceDesc"]=qj;qj.__name__="hxsl.ShaderInstanceDesc";qj.prototype={__class__:qj};
var Hg=function(){this.id=Hg.UID++};z["hxsl.RuntimeShader"]=Hg;Hg.__name__="hxsl.RuntimeShader";Hg.prototype={get_compute:function(){return this.vertex},set_compute:function(a){return this.vertex=a},hasGlobal:function(a){return this.globals.h.hasOwnProperty(a)},getShaders:function(){return this.mode==Kb.Compute?[this.vertex]:[this.vertex,this.fragment]},__class__:Hg};var Na=function(){this.uid=this.tid=1};z["hxsl.Serializer"]=Na;Na.__name__="hxsl.Serializer";Na.run=function(a){return(new Na).serialize(a)};
Na.prototype={writeArr:function(a,b){this.writeVarInt(a.length);for(var c=0;c<a.length;){var d=a[c];++c;b(d)}},readArr:function(a){for(var b=[],c=0,d=this.readVarInt();c<d;)c++,b.push(a());return b},readVarInt:function(){var a=this.input.readByte();return 128>a?a:255==a?this.input.readInt32():(a&127)<<8|this.input.readByte()},writeVarInt:function(a){if(128>a)this.out.addByte(a);else{var b=a>>8;127<=b?(this.out.addByte(255),this.out.addInt32(b)):(this.out.addByte(b|128),this.out.addByte(a&255))}},
writeID:function(a){var b=this.idMap.h[a];null==b&&(b=this.uid++,this.idMap.h[a]=b);this.writeVarInt(b)},readID:function(){return this.readVarInt()},writeTID:function(a){var b=this.typeIdMap.get(a);if(null!=b)return this.writeVarInt(b),!1;b=this.tid++;this.typeIdMap.set(a,b);this.writeVarInt(b);return!0},writeType:function(a){this.out.addByte(a._hx_index);switch(a._hx_index){case 5:var b=a.size;var c=a.t;this.out.addByte(b|c._hx_index<<3);break;case 9:b=a.size;this.out.addInt32(b);break;case 10:c=
a.dim;b=a.isArray;this.out.addByte(c._hx_index<<1|(b?1:0));break;case 11:c=a.dim;b=a.isArray;this.out.addByte(c._hx_index<<3|(b?1:0)|a.channels-1<<1);break;case 13:b=a.vl;if(this.writeTID(a)){var d=M(this,this.writeVar);this.writeVarInt(b.length);for(c=0;c<b.length;)a=b[c],++c,d(a)}break;case 15:c=a.t;b=a.size;this.writeType(c);switch(b._hx_index){case 0:a=b.v;this.out.addByte(0);this.writeVarInt(a);break;case 1:a=b.v,this.writeVar(a)}break;case 16:c=a.t;b=a.size;a=a.kind;0!=a._hx_index&&this.out.addByte(a._hx_index+
128);this.writeType(c);switch(b._hx_index){case 0:a=b.v;this.out.addByte(0);this.writeVarInt(a);break;case 1:a=b.v,this.writeVar(a)}break;case 17:b=a.size,this.out.addByte(b)}},readType:function(){switch(this.input.readByte()){case 0:return x.TVoid;case 1:return x.TInt;case 2:return x.TBool;case 3:return x.TFloat;case 4:return x.TString;case 5:var a=this.input.readByte();var b=Na.TVECS.h[a];null==b&&(b=x.TVec(a&7,la.createEnumIndex(Q,a>>3,null)),Na.TVECS.h[a]=b);return b;case 6:return x.TMat3;case 7:return x.TMat4;
case 8:return x.TMat3x4;case 9:return x.TBytes(this.input.readInt32());case 10:if(0==this.version)return x.TSampler(tb.T2D,!1);b=this.input.readByte();a=Na.TDIMS[b>>1];return x.TSampler(a,0!=(b&1));case 11:if(0==this.version)return x.TSampler(tb.T2D,!0);b=this.input.readByte();a=Na.TDIMS[b>>3];return x.TRWTexture(a,0!=(b&1),(b>>1&3)+1);case 12:return 0==this.version?x.TSampler(tb.TCube,!1):x.TMat2;case 13:a=this.readVarInt();var c=this.types[a];if(null!=c)return c;b=M(this,this.readVar);c=[];for(var d=
0,e=this.readVarInt();d<e;)d++,c.push(b());c=x.TStruct(c);return this.types[a]=c;case 14:return x.TFun(null);case 15:return c=this.readType(),b=this.readVar(),x.TArray(c,null==b?Ya.SConst(this.readVarInt()):Ya.SVar(b));case 16:return b=this.input.readByte(),a=vb.Uniform,0==(b&128)?(b=this.input,b.set_position(b.pos-1)):a=la.createEnumIndex(vb,b&127,null),c=this.readType(),b=this.readVar(),x.TBuffer(c,null==b?Ya.SConst(this.readVarInt()):Ya.SVar(b),a);case 17:return x.TChannel(this.input.readByte());
case 18:if(0==this.version)return x.TMat2;throw u.thrown("assert");default:throw u.thrown("assert");}},writeString:function(a){a=S.ofString(a);this.writeVarInt(a.length);this.out.add(a)},readString:function(){var a=this.readVarInt();return this.input.read(a).getString(0,a)},writeVar:function(a){if(null==a)this.out.addByte(0);else if(this.writeID(a.id),!this.varMap.h.hasOwnProperty(a.id))if(this.varMap.h[a.id]=a,this.writeString(a.name),this.writeType(a.type),this.out.addByte(a.kind._hx_index),this.writeVar(a.parent),
null==a.qualifiers)this.out.addByte(0);else{this.out.addByte(a.qualifiers.length);for(var b=0,c=a.qualifiers;b<c.length;)switch(a=c[b],++b,this.out.addByte(a._hx_index),a._hx_index){case 0:a=a.max;this.out.addInt32(null==a?0:a);break;case 4:this.writeString(a.n);break;case 6:this.out.addByte(a.p._hx_index);break;case 7:var d=a.max;this.out.addDouble(a.min);this.out.addDouble(d);break;case 9:a=a.v;this.out.addInt32(a);break;case 10:this.writeString(a.s);break;case 11:this.writeString(a.source);break;
case 12:this.writeString(a.name)}}},writeFun:function(a){this.out.addByte(a.kind._hx_index);this.writeVar(a.ref);var b=a.args,c=M(this,this.writeVar);this.writeVarInt(b.length);for(var d=0;d<b.length;){var e=b[d];++d;c(e)}this.writeType(a.ret);this.writeExpr(a.expr)},writeConst:function(a){this.out.addByte(a._hx_index);switch(a._hx_index){case 1:this.out.addByte(a.b?1:0);break;case 2:a=a.v;this.out.addInt32(a);break;case 3:a=a.v;this.out.addDouble(a);break;case 4:a=a.v,this.writeString(a)}},writeExpr:function(a){if(null==
a)this.out.addByte(0);else{this.out.addByte(a.e._hx_index+1);var b=a.e;switch(b._hx_index){case 0:this.writeConst(b.c);break;case 1:var c=b.v;this.writeVar(c);break;case 2:this.out.addByte(b.g._hx_index);break;case 3:var d=b.e;this.writeExpr(d);break;case 4:d=b.el;var e=M(this,this.writeExpr);this.writeVarInt(d.length);for(b=0;b<d.length;)c=d[b],++b,e(c);break;case 5:c=b.op;d=b.e1;b=b.e2;20==c._hx_index?this.out.addByte(c.op._hx_index|128):this.out.addByte(c._hx_index);this.writeExpr(d);this.writeExpr(b);
break;case 6:c=b.op;d=b.e1;this.out.addByte(c._hx_index);this.writeExpr(d);break;case 7:c=b.v;d=b.init;this.writeVar(c);this.writeExpr(d);break;case 8:d=b.e;var f=b.args;this.writeExpr(d);e=M(this,this.writeExpr);this.writeVarInt(f.length);for(b=0;b<f.length;)c=f[b],++b,e(c);break;case 9:d=b.e;c=b.regs;this.writeExpr(d);if(0==c.length)throw u.thrown("assert");d=c.length-1;e=2;for(b=0;b<c.length;)f=c[b],++b,d|=f._hx_index<<e,e+=2;this.out.addByte(d&255);this.out.addByte(d>>8);break;case 10:d=b.eif;
c=b.eelse;this.writeExpr(b.econd);this.writeExpr(d);this.writeExpr(c);break;case 12:d=b.e;this.writeExpr(d);break;case 13:c=b.v;d=b.it;e=b.loop;this.writeVar(c);this.writeExpr(d);this.writeExpr(e);break;case 16:d=b.e;c=b.index;this.writeExpr(d);this.writeExpr(c);break;case 17:d=b.el;e=M(this,this.writeExpr);this.writeVarInt(d.length);for(b=0;b<d.length;)c=d[b],++b,e(c);break;case 18:d=b.e;f=b.cases;var g=b.def;this.writeExpr(d);this.writeVarInt(f.length);for(b=0;b<f.length;){c=f[b];++b;d=c.values;
e=M(this,this.writeExpr);this.writeVarInt(d.length);for(var h=0;h<d.length;){var k=d[h];++h;e(k)}this.writeExpr(c.expr)}this.writeExpr(g);break;case 19:d=b.e;e=b.loop;c=b.normalWhile;this.writeExpr(d);this.writeExpr(e);this.out.addByte(c?1:0);break;case 20:c=b.m;f=b.args;d=b.e;this.writeString(c);e=M(this,this.writeConst);this.writeVarInt(f.length);for(b=0;b<f.length;)c=f[b],++b,e(c);this.writeExpr(d);break;case 21:d=b.e;c=b.name;this.writeExpr(d);this.writeString(c);break;case 22:for(d=b.target,
c=b.code,f=b.args,this.writeString(d),this.writeString(c),this.writeVarInt(f.length),b=0;b<f.length;)c=f[b],++b,this.writeExpr(c.e),this.out.addByte(c.access._hx_index)}this.writeType(a.t)}},readConst:function(){switch(this.input.readByte()){case 0:return K.CNull;case 1:return K.CBool(0!=this.input.readByte());case 2:return K.CInt(this.input.readInt32());case 3:return K.CFloat(this.input.readDouble());case 4:return K.CString(this.readString());default:throw u.thrown("assert");}},readExpr:function(){var a,
b=this.input.readByte();if(0==b--)return null;switch(b){case 0:b=q.TConst(this.readConst());break;case 1:b=q.TVar(this.readVar());break;case 2:b=q.TGlobal(Na.TGLOBALS[this.input.readByte()]);break;case 3:b=q.TParenthesis(this.readExpr());break;case 4:var c=M(this,this.readExpr);var d=[];var e=0;for(a=this.readVarInt();e<a;)e++,d.push(c());b=q.TBlock(d);break;case 5:b=this.input.readByte();b=q.TBinop(128<=b?ha.OpAssignOp(Na.BOPS[b&127]):Na.BOPS[b],this.readExpr(),this.readExpr());break;case 6:b=q.TUnop(Na.UNOPS[this.input.readByte()],
this.readExpr());break;case 7:b=q.TVarDecl(this.readVar(),this.readExpr());break;case 8:b=this.readExpr();c=M(this,this.readExpr);d=[];e=0;for(a=this.readVarInt();e<a;)e++,d.push(c());b=q.TCall(b,d);break;case 9:b=this.readExpr();c=this.input.readUInt16();a=Na.TSWIZ.h[c];if(null==a){d=[];e=0;for(a=(c&3)+1;e<a;){var f=e++;d.push(Na.REGS[c>>2*f+2&3])}a=d;Na.TSWIZ.h[c]=a}b=q.TSwiz(b,a);break;case 10:b=q.TIf(this.readExpr(),this.readExpr(),this.readExpr());break;case 11:b=q.TDiscard;break;case 12:b=q.TReturn(this.readExpr());
break;case 13:b=q.TFor(this.readVar(),this.readExpr(),this.readExpr());break;case 14:b=q.TContinue;break;case 15:b=q.TBreak;break;case 16:b=q.TArray(this.readExpr(),this.readExpr());break;case 17:c=M(this,this.readExpr);d=[];e=0;for(a=this.readVarInt();e<a;)e++,d.push(c());b=q.TArrayDecl(d);break;case 18:b=this.readExpr();d=[];e=0;for(a=this.readVarInt();e<a;){e++;c=M(this,this.readExpr);f=[];for(var g=0,h=this.readVarInt();g<h;)g++,f.push(c());d.push({values:f,expr:this.readExpr()})}b=q.TSwitch(b,
d,this.readExpr());break;case 19:b=q.TWhile(this.readExpr(),this.readExpr(),0!=this.input.readByte());break;case 20:b=this.readString();c=M(this,this.readConst);d=[];e=0;for(a=this.readVarInt();e<a;)e++,d.push(c());b=q.TMeta(b,d,this.readExpr());break;case 21:b=q.TField(this.readExpr(),this.readString());break;case 22:b=this.readString();c=this.readString();d=[];e=0;for(a=this.readVarInt();e<a;)e++,d.push({e:this.readExpr(),access:la.createEnumIndex(kc,this.input.readByte(),null),read:!1,write:!1});
b=q.TSyntax(b,c,d);break;default:throw u.thrown("assert");}return{e:b,t:this.readType(),p:null}},readVar:function(){var a=this.readVarInt();if(0==a)return null;var b=this.varMap.h[a];if(null!=b)return b;b={id:B.allocVarId(),name:this.readString(),type:null,kind:null};this.varMap.h[a]=b;b.type=this.readType();b.kind=Na.VKINDS[this.input.readByte()];b.parent=this.readVar();a=this.input.readByte();if(0<a){b.qualifiers=[];for(var c=0;c<a;){c++;switch(this.input.readByte()){case 0:var d=this.input.readInt32();
d=ra.Const(0==d?null:d);break;case 1:d=ra.Private;break;case 2:d=ra.Nullable;break;case 3:d=ra.PerObject;break;case 4:d=ra.Name(this.readString());break;case 5:d=ra.Shared;break;case 6:d=ra.Precision(Na.PRECS[this.input.readByte()]);break;case 7:d=ra.Range(this.input.readDouble(),this.input.readDouble());break;case 8:d=ra.Ignore;break;case 9:d=ra.PerInstance(this.input.readInt32());break;case 10:d=ra.Doc(this.readString());break;case 11:d=ra.Borrow(this.readString());break;case 12:d=ra.Sampler(this.readString());
break;case 13:d=ra.Final;break;case 14:d=ra.Flat;break;default:throw u.thrown("assert");}b.qualifiers.push(d)}}return b},readFun:function(){for(var a=Na.FKIND[this.input.readByte()],b=this.readVar(),c=M(this,this.readVar),d=[],e=0,f=this.readVarInt();e<f;)e++,d.push(c());return{kind:a,ref:b,args:d,ret:this.readType(),expr:this.readExpr()}},unserialize:function(a){this.input=new Zb(Cc.decode(a,!1));if(this.input.readByte()!=(Na.SIGN&255)||this.input.readByte()!=(Na.SIGN>>8&255))throw u.thrown("Invalid HXSL data");
this.version=this.input.readByte()-139;if(0>this.version||1<this.version)throw u.thrown("Invalid HXSL data");this.varMap=new Da;this.types=[];a=this.readString();for(var b=M(this,this.readVar),c=[],d=0,e=this.readVarInt();d<e;)d++,c.push(b());var f=c;b=M(this,this.readFun);c=[];d=0;for(e=this.readVarInt();d<e;)d++,c.push(b());return{name:a,vars:f,funs:c}},serialize:function(a){this.varMap=new Da;this.idMap=new Da;this.typeIdMap=new Le;this.out=new Vd;this.out.addByte(Na.SIGN&255);this.out.addByte(Na.SIGN>>
8&255);this.out.addByte(Na.SIGN>>16&255);this.writeString(a.name);var b=a.vars,c=M(this,this.writeVar);this.writeVarInt(b.length);for(var d=0;d<b.length;){var e=b[d];++d;c(e)}b=a.funs;c=M(this,this.writeFun);this.writeVarInt(b.length);for(d=0;d<b.length;)e=b[d],++d,c(e);return Cc.encode(this.out.getBytes(),!1)},__class__:Na};var Fb=function(a,b){this.s=a;this.next=b};z["hxsl.ShaderList"]=Fb;Fb.__name__="hxsl.ShaderList";Fb.addSort=function(a,b){for(var c=null,d=b;null!=d&&d.s.priority<a.priority;)c=
d,d=d.next;if(null==c)return a=new Fb(a,b),Fb.checkSize(a),a;c.next=new Fb(a,c.next);Fb.checkSize(b);return b};Fb.checkSize=function(a){if(!(0>=Fb.MAX_LIST_SIZE)){for(var b=0;null!=a;){if(!Fb.ALLOW_DUPLICATES&&null!=a.next&&a.next.s==a.s)throw u.thrown("Duplicate shader "+w.string(a.s));++b;a=a.next}if(b>Fb.MAX_LIST_SIZE)throw u.thrown("Too many shaders");}};Fb.prototype={clone:function(){return new Fb(this.s.clone(),null==this.next?null:this.next.clone())},iterator:function(){return new pf(this,
null)},iterateTo:function(a){return new pf(this,a)},__class__:Fb};var pf=function(a,b){this.l=a;this.last=b};z["hxsl._ShaderList.ShaderIterator"]=pf;pf.__name__="hxsl._ShaderList.ShaderIterator";pf.prototype={hasNext:function(){return this.l!=this.last},next:function(){var a=this.l.s;this.l=this.l.next;return a},__class__:pf};var Kg=function(a){this.id=++Kg.UID;this.shader=a;this.params=new Da};z["hxsl.ShaderInstance"]=Kg;Kg.__name__="hxsl.ShaderInstance";Kg.prototype={__class__:Kg};var wj=function(a,
b){this.v=a;this.globalId=b};z["hxsl.ShaderGlobal"]=wj;wj.__name__="hxsl.ShaderGlobal";wj.prototype={__class__:wj};var Qf=function(a,b,c){this.v=a;this.pos=b;this.bits=c};z["hxsl.ShaderConst"]=Qf;Qf.__name__="hxsl.ShaderConst";Qf.prototype={__class__:Qf};var Qb=function(a,b){this.instanceCache=new Da;this.consts=null;this.globals=[];if(""!=a){this.module=b;this.data=(new Na).unserialize(a);a=0;for(b=this.data.vars;a<b.length;){var c=b[a];++a;this.initVarId(c)}this.data=Qb.compactMem(this.data);this.initialize();
this.initLiveReload()}};z["hxsl.SharedShader"]=Qb;Qb.__name__="hxsl.SharedShader";Qb.mergeVars=function(a,b){if(a.length!=b.length)return!1;for(var c=0,d=a;c<d.length;){var e=d[c];a=c++;var f=b[a];if(e.name!=f.name)return!1;f.id=e.id;a=e.type;e=f.type;if(13==a._hx_index&&13==e._hx_index&&(e=e.vl,a=a.vl,a.length!=e.length||!Qb.mergeVars(a,e)))return!1}return!0};Qb.loadShader=function(a,b){a.getText();throw u.thrown("Shader live reload requires --library hscript");};Qb.compactMem=function(a){return a};
Qb.prototype={initialize:function(){for(var a=0,b=this.data.vars;a<b.length;){var c=b[a];++a;this.browseVar(c)}},getInstance:function(a){var b=this.instanceCache.h[a];return null==b?this.makeInstance(a):b},makeBufferType:function(a,b,c){if(13==b._hx_index){b=b.vl;for(var d=[],e=0,f=c.inputs;e<f.length;)c=f[e++],d.push(c);e=[];for(f=0;f<d.length;){c=d[f++];var g=c.name;switch(c.type){case 1:var h=x.TFloat;break;case 2:h=x.TVec(2,Q.VFloat);break;case 3:h=x.TVec(3,Q.VFloat);break;case 4:h=x.TVec(4,Q.VFloat);
break;case 9:h=x.TBytes(4);break;case 16:h=x.TMat4}if(aa.endsWith(c.name,"__m0")){h=c.type;h=h==Z.__cast(9,cc)?1:h;for(var k=2;null!=d[f+k-1]&&aa.endsWith(d[f+k-1].name,"__m"+k);)++k;switch(k){case 2:if(2==h)h=x.TMat2;else throw u.thrown("Unsupported matrix format");break;case 3:switch(h){case 3:h=x.TMat3;break;case 4:h=x.TMat3x4;break;default:throw u.thrown("Unsupported matrix format");}break;case 4:if(4==h)h=x.TMat4;else throw u.thrown("Unsupported matrix format");break;default:throw u.thrown("Unsupported matrix format");
}g=D.substr(c.name,0,-4);f+=k-1}e.push({id:B.allocVarId(),name:g,type:h,kind:a.kind,parent:a})}for(d=0;d<b.length;){a=b[d];++d;h=!1;for(f=0;f<e.length;)if(c=e[f],++f,a.name==c.name){h=a.type;f=c.type;switch(h._hx_index){case 3:if(3!=f._hx_index&&!la.enumEq(a.type,c.type))throw u.thrown("Buffer "+this.data.name+"."+a.name+":"+B.toString(a.type)+" should be "+B.toString(c.type));break;case 5:if(1==h.t._hx_index)if(5==f._hx_index)if(1==f.t._hx_index){if(h.size>f.size&&!la.enumEq(a.type,c.type))throw u.thrown("Buffer "+
this.data.name+"."+a.name+":"+B.toString(a.type)+" should be "+B.toString(c.type));}else{if(!la.enumEq(a.type,c.type))throw u.thrown("Buffer "+this.data.name+"."+a.name+":"+B.toString(a.type)+" should be "+B.toString(c.type));}else{if(!la.enumEq(a.type,c.type))throw u.thrown("Buffer "+this.data.name+"."+a.name+":"+B.toString(a.type)+" should be "+B.toString(c.type));}else if(!la.enumEq(a.type,c.type))throw u.thrown("Buffer "+this.data.name+"."+a.name+":"+B.toString(a.type)+" should be "+B.toString(c.type));
break;default:if(!la.enumEq(a.type,c.type))throw u.thrown("Buffer "+this.data.name+"."+a.name+":"+B.toString(a.type)+" should be "+B.toString(c.type));}h=!0;break}if(!h)throw u.thrown("Buffer is missing "+this.data.name+"."+a.name+":"+B.toString(a.type));}return x.TStruct(e)}throw u.thrown("assert");},makeInstance:function(a){var b=new uj;var c=this.consts;for(var d=[];null!=c;){var e=c.v.type;switch(e._hx_index){case 1:b.setConstant(c.v,K.CInt(a>>>c.pos&(1<<c.bits)-1));break;case 2:b.setConstant(c.v,
K.CBool(0!=(a>>>c.pos&1)));break;case 16:var f=e.t;var g=e.size;var h=e.kind;e=N.fromID(a>>>c.pos&(1<<c.bits)-1);var k={id:c.v.id,name:c.v.name,kind:c.v.kind,type:null};f=this.makeBufferType(k,f,e);switch(h._hx_index){case 3:h=vb.Uniform;break;case 4:h=vb.Storage;break;case 5:h=vb.RW;break;default:throw u.thrown("assert");}k.type=x.TBuffer(f,g,h);b.varMap.set(c.v,k);d.push(k);break;case 17:b.setConstant(c.v,K.CInt(a>>>c.pos&(1<<c.bits)-1));break;default:throw u.thrown("assert");}c=c.next}for(e=0;e<
d.length;)k=d[e],++e,h=k.type,16==h._hx_index&&(f=h.size,1==f._hx_index&&(c=f.v,f=h.t,h=h.kind,c=b.constants.h[c.id],null!=c&&null!=c&&0==c._hx_index&&(c=c.c,2==c._hx_index&&(c=c.v,k.type=x.TBuffer(f,Ya.SConst(c),h)))));b.inlineCalls=!0;b.unrollLoops=Qb.UNROLL_LOOPS;k=b.eval(this.data);k=Qb.compactMem(k);c=new Kg(k);e=this.paramsCount=0;for(h=this.data.vars;e<h.length;)k=h[e],++e,this.addParam(b,c,k);return this.instanceCache.h[a]=c},addSelfParam:function(a,b){var c=b.type;if(13==c._hx_index)for(b=
c.vl,c=0;c<b.length;){var d=b[c];++c;this.addSelfParam(a,d)}else b.kind==P.Param&&(a.params.h[b.id]=this.paramsCount,this.paramsCount++)},addParam:function(a,b,c){var d=c.type;if(13==d._hx_index)for(c=d.vl,d=0;d<c.length;){var e=c[d];++d;this.addParam(a,b,e)}else c.kind==P.Param&&(b.params.h[a.varMap.h[c.__id__].id]=this.paramsCount,this.paramsCount++)},initVarId:function(a){a.id=B.allocVarId();var b=a.type;if(13==b._hx_index){var c=b.vl;for(b=0;b<c.length;)a=c[b],++b,this.initVarId(a)}},browseVar:function(a,
b){b=null==b?B.getName(a):b+("."+a.name);var c=a.type;if(13==c._hx_index)for(a=c.vl,c=0;c<a.length;){var d=a[c];++c;this.browseVar(d,b)}else c=0,a.kind==P.Global&&(c=za.allocID(b),this.globals.push(new wj(a,c))),B.isConst(a)&&(b=B.getConstBits(a),0<b&&(b=new Qf(a,null==this.consts?0:this.consts.pos+this.consts.bits,b),b.globalId=c,b.next=this.consts,this.consts=b))},initLiveReload:function(){if(null!=this.module&&We.isActive()){Qb.SHADER_RESOLVE.h[this.data.name]=this;var a=this.module.split(".").join("/")+
".hx";this.file=We.resolve(a);null!=this.file&&this.file.watch(M(this,this.onFileReload))}},onFileReload:function(){for(var a=Qb.SHADER_RESOLVE.h,b=Object.keys(a),c=b.length,d=0;d<c;){var e=a[b[d++]];e.file==this.file&&e.reloadShader()}},reloadShader:function(){try{var a=Qb.loadShader(this.file,this.data.name);if(null!=a){var b=new U;b.loadShader=function(a){var b=Qb.SHADER_RESOLVE.h[a];if(null==b)throw u.thrown("Could not resolve shader "+a);if(null==b.file)throw u.thrown("Shader "+a+" can't be live reload because of missing live path");
return Qb.loadShader(b.file,b.data.name)};var c=b.check(this.data.name,a);this.applyChanges(c)}}catch(d){if(a=u.caught(d).unwrap(),a instanceof lb)b=D.substr(this.file.getText(),0,a.pos.min).split("\n").length,Ka.trace(a.msg,{methodName:null,className:null,fileName:a.pos.file,lineNumber:b});else throw d;}},applyChanges:function(a){if(!Qb.mergeVars(this.data.vars,a.vars))return!1;this.data=Qb.compactMem(a);this.instanceCache=new Da;return!0},__class__:Qb};var Tf=function(a){this.v=a;this.write=this.read=
0};z["hxsl._Splitter.VarProps"]=Tf;Tf.__name__="hxsl._Splitter.VarProps";Tf.prototype={__class__:Tf};var oj=function(){};z["hxsl.Splitter"]=oj;oj.__name__="hxsl.Splitter";oj.prototype={split:function(a,b){var c=this;this.isBatchShader=b;var d=null,e=new Da;var f=[];var g=null,h=new Da;var k=[];var l=!1;this.varNames=new La;this.varMap=new vc;b=0;for(a=a.funs;b<a.length;){var m=a[b];++b;switch(m.kind._hx_index){case 1:this.vars=h;this.avars=k;g=m;this.checkExpr(m.expr);break;case 0:case 4:this.vars=
e;this.avars=f;d=m;this.checkExpr(m.expr);m.kind==Ia.Main&&(l=!0);break;default:throw u.thrown("assert");}}var p=[];a=f.length;for(b=0;b<a;){var t=b++;var n=[f[t]],r=[n[0].v];if(!n[0].local){switch(r[0].kind._hx_index){case 3:case 4:m=h.h[n[0].origin.id],r[0].kind=null!=m&&0<m.read?P.Var:P.Local}switch(r[0].kind._hx_index){case 3:case 5:if(0<n[0].read||1<n[0].write)m={id:B.allocVarId(),name:r[0].name,kind:P.Local,type:r[0].type},this.uniqueName(m),this.varMap.set(n[0].origin,m),t=new Tf(m),t.read++,
e.h[m.id]=t,t=d.expr.p,m=[{e:q.TBinop(ha.OpAssign,{e:q.TVar(r[0]),t:m.type,p:t},{e:q.TVar(m),t:r[0].type,p:t}),t:m.type,p:t}],p.push(function(a){return function(){c.addExpr(d,a[0])}}(m)),r[0].kind==P.Var&&p.push(function(a,b){return function(){c.varMap.set(b[0].origin,a[0])}}(r,n))}}}d={ret:d.ret,ref:d.ref,kind:d.kind,args:d.args,expr:this.mapVars(d.expr)};for(b=0;b<p.length;)m=p[b],++b,m();a=[];for(b=0;b<k.length;)switch(p=k[b],++b,f=p.v,f.kind._hx_index){case 1:m={id:B.allocVarId(),name:f.name,
kind:P.Var,type:f.type};this.uniqueName(m);t=e.h[p.origin.id];null==t&&(t=new Tf(f),e.h[p.origin.id]=t);t.read++;this.varMap.set(p.origin,m);t=new Tf(m);t.origin=p.origin;h.h[p.origin.id]=t;e.h[m.id]=t;this.addExpr(d,{e:q.TBinop(ha.OpAssign,{e:q.TVar(m),t:f.type,p:d.expr.p},{e:q.TVar(f),t:f.type,p:d.expr.p}),t:f.type,p:d.expr.p});break;case 3:0<p.write&&(m={id:B.allocVarId(),name:f.name,kind:P.Local,type:f.type},this.uniqueName(m),a.push({e:q.TVarDecl(m,{e:q.TVar(f),t:f.type,p:g.expr.p}),t:x.TVoid,
p:g.expr.p}),this.varMap.set(p.origin,m))}for(f=e.iterator();f.hasNext();)k=f.next(),this.checkVar(k,!0,e,d.expr.p);for(f=h.iterator();f.hasNext();)k=f.next(),this.checkVar(k,!1,e,g.expr.p);if(null!=g)if(g={ret:g.ret,ref:g.ref,kind:g.kind,args:g.args,expr:this.mapVars(g.expr)},b=g.expr.e,4==b._hx_index)for(k=b.el,b=0;b<a.length;)f=a[b],++b,k.unshift(f);else a.push(g.expr),g.expr={e:q.TBlock(a),t:x.TVoid,p:g.expr.p};b=[];for(f=e.iterator();f.hasNext();)k=f.next(),k.local||b.push(k);e=b;b=[];for(f=
h.iterator();f.hasNext();)k=f.next(),k.local||b.push(k);h=b;e.sort(function(a,b){var c=(null==a.origin?a.v.id:a.origin.id)-(null==b.origin?b.v.id:b.origin.id);return 0!=c?c:a.v.id-b.v.id});h.sort(function(a,b){var c=(null==a.origin?a.v.id:a.origin.id)-(null==b.origin?b.v.id:b.origin.id);return 0!=c?c:a.v.id-b.v.id});if(l){b=[];for(a=0;a<e.length;)f=e[a],++a,b.push(f.v);return[{name:"main",vars:b,funs:[d]}]}b=[];for(a=0;a<e.length;)f=e[a],++a,b.push(f.v);e={name:"vertex",vars:b,funs:[d]};b=[];for(a=
0;a<h.length;)f=h[a],++a,b.push(f.v);return[e,{name:"fragment",vars:b,funs:[g]}]},addExpr:function(a,b){var c=a.expr.e;4==c._hx_index?c.el.push(b):a.expr={e:q.TBlock([a.expr,b]),t:x.TVoid,p:a.expr.p}},checkVar:function(a,b,c,d){switch(a.v.kind._hx_index){case 3:if(!(b||(b=c.h[a.origin.id],null!=b&&b.v.kind==P.Input||!a.requireInit||null!=b&&0!=b.write)))throw u.thrown(new lb("Varying "+a.v.name+" is not written by vertex shader",d));break;case 4:if(a.requireInit&&(null==a.origin.parent||"global"!=
a.origin.parent.name&&!this.isBatchShader))throw u.thrown(new lb("Variable "+a.v.name+" is used without being initialized",d));}},mapVars:function(a){var b=a.e;switch(b._hx_index){case 1:var c=b.v;c=this.varMap.h[c.__id__];return null==c?a:{e:q.TVar(c),t:a.t,p:a.p};case 7:c=b.v;var d=b.init;c=this.varMap.h[c.__id__];return null==c?B.map(a,M(this,this.mapVars)):{e:q.TVarDecl(c,null==d?null:this.mapVars(d)),t:a.t,p:a.p};case 13:return c=b.v,d=b.it,b=b.loop,c=this.varMap.h[c.__id__],null==c?B.map(a,
M(this,this.mapVars)):{e:q.TFor(c,this.mapVars(d),this.mapVars(b)),t:a.t,p:a.p};default:return B.map(a,M(this,this.mapVars))}},get:function(a){var b=this.vars.h[a.id];if(null==b){b=this.varMap.h[a.__id__];if(null==b){if(a.kind==P.Global||a.kind==P.Output||a.kind==P.Input)b=a;else{b={id:B.allocVarId(),name:a.name,kind:a.kind,type:a.type};if(null!=a.qualifiers)for(var c=0,d=a.qualifiers;c<d.length;){var e=d[c];++c;switch(e._hx_index){case 13:case 14:null==b.qualifiers&&(b.qualifiers=[]),b.qualifiers.push(e)}}this.uniqueName(b)}this.varMap.set(a,
b)}b=new Tf(b);b.origin=a;this.vars.h[a.id]=b;this.avars.push(b)}return b},uniqueName:function(a){if(a.kind!=P.Global&&a.kind!=P.Output&&a.kind!=P.Input){var b=this.varNames.h[a.name];if(null!=b&&b!=a){for(b=a.name;48<=D.cca(b,b.length-1)&&57>=D.cca(b,b.length-1);)b=D.substr(b,0,-1);for(var c=b==a.name?2:w.parseInt(D.substr(a.name,b.length,null));Object.prototype.hasOwnProperty.call(this.varNames.h,b+c);)++c;a.name=b+c}this.varNames.h[a.name]=a}},checkExpr:function(a){var b=this;var c=a.e;switch(c._hx_index){case 1:var d=
c.v;d=this.get(d);0==d.write&&(d.requireInit=!0);d.read++;break;case 5:d=c.op;var e=c.e1;c=c.e2;switch(d._hx_index){case 4:var f=e.e;d=e.p;d=e.t;switch(f._hx_index){case 1:d=f.v;d=this.get(d);d.write++;this.checkExpr(c);break;case 9:d=f.e;f=d.e;1==f._hx_index?(d=f.v,d=this.get(d),d.write++,this.checkExpr(c)):B.iter(a,M(this,this.checkExpr));break;default:B.iter(a,M(this,this.checkExpr))}break;case 20:f=d.op;d=e.e;f=e.p;f=e.t;switch(d._hx_index){case 1:d=d.v;d=this.get(d);0==d.write&&(d.requireInit=
!0);d.read++;d.write++;this.checkExpr(c);break;case 9:e=d.e;f=d.regs;d=e.e;f=e.p;f=e.t;1==d._hx_index?(d=d.v,d=this.get(d),0==d.write&&(d.requireInit=!0),d.read++,d.write++,this.checkExpr(c)):B.iter(a,M(this,this.checkExpr));break;default:B.iter(a,M(this,this.checkExpr))}break;default:B.iter(a,M(this,this.checkExpr))}break;case 7:d=c.v;c=c.init;d=this.get(d);d.local=!0;null!=c&&(this.checkExpr(c),d.write++);break;case 13:d=c.v;a=c.loop;this.checkExpr(c.it);d=this.get(d);d.local=!0;d.write++;this.checkExpr(a);
break;case 22:d=c.target;d=c.code;a=c.args;var g=null,h=null;h=function(a){var c=a.e;if(1==c._hx_index)switch(a=b.get(c.v),g.access._hx_index){case 0:a.read--;break;case 1:a.write++;break;case 2:a.read--,a.write++}else B.iter(a,h)};c=0;for(d=a.length;c<d;)e=c++,g=a[e],h(g.e),this.checkExpr(g.e);break;default:B.iter(a,M(this,this.checkExpr))}},__class__:oj};var Rj=function(){};z["hxsl.ChannelTools"]=Rj;Rj.__name__="hxsl.ChannelTools";Rj.isPackedFormat=function(a){return a.format==Y.nativeFormat};var yj=
function(){};z["js.html._CanvasElement.CanvasUtil"]=yj;yj.__name__="js.html._CanvasElement.CanvasUtil";yj.getContextWebGL=function(a,b){var c=a.getContext("webgl",b);if(null!=c)return c;c=a.getContext("experimental-webgl",b);return null!=c?c:null};var Lj=function(){};z["js.lib._ArrayBuffer.ArrayBufferCompat"]=Lj;Lj.__name__="js.lib._ArrayBuffer.ArrayBufferCompat";Lj.sliceImpl=function(a,b){a=new Uint8Array(this,a,null==b?null:b-a);b=new Uint8Array(a.byteLength);b.set(a);return b.buffer};Math.__name__=
"Math";var we=L["org.msgpack.DecodeOption"]={__ename__:!0,__constructs__:null,AsMap:{_hx_name:"AsMap",_hx_index:0,__enum__:"org.msgpack.DecodeOption",toString:v},AsObject:{_hx_name:"AsObject",_hx_index:1,__enum__:"org.msgpack.DecodeOption",toString:v}};we.__constructs__=[we.AsMap,we.AsObject];we.__empty_constructs__=[we.AsMap,we.AsObject];var xj=function(a,b){this.k=a;this.v=b};z["org.msgpack._Decoder.Pair"]=xj;xj.__name__="org.msgpack._Decoder.Pair";xj.prototype={__class__:xj};var Lg=function(a,
b){a=new Zb(a);a.set_bigEndian(!0);this.o=this.decode(a,b)};z["org.msgpack.Decoder"]=Lg;Lg.__name__="org.msgpack.Decoder";Lg.prototype={decode:function(a,b){try{var c=a.readByte();switch(c){case 192:break;case 194:return!1;case 195:return!0;case 196:return a.read(a.readByte());case 197:return a.read(a.readUInt16());case 198:return a.read(a.readInt32());case 202:return a.readFloat();case 203:return a.readDouble();case 204:return a.readByte();case 205:return a.readUInt16();case 206:return a.readInt32();
case 207:throw u.thrown("UInt64 not supported");case 208:return a.readInt8();case 209:return a.readInt16();case 210:return a.readInt32();case 211:return this.readInt64(a);case 217:return a.readString(a.readByte());case 218:return a.readString(a.readUInt16());case 219:return a.readString(a.readInt32());case 220:return this.readArray(a,a.readUInt16(),b);case 221:return this.readArray(a,a.readInt32(),b);case 222:return this.readMap(a,a.readUInt16(),b);case 223:return this.readMap(a,a.readInt32(),b);
default:if(128>c)return c;if(144>c)return this.readMap(a,15&c,b);if(160>c)return this.readArray(a,15&c,b);if(192>c)return a.readString(31&c);if(223<c)return-256|c}}catch(d){if(!(u.caught(d).unwrap()instanceof Fc))throw d;}return null},readInt64:function(a){var b=a.readInt32();a=a.readInt32();return new qh(b,a)},readArray:function(a,b,c){for(var d=[],e=0;e<b;)e++,d.push(this.decode(a,c));return d},readMap:function(a,b,c){var d;switch(c._hx_index){case 0:var e=[];for(d=0;d<b;){d++;var f=this.decode(a,
c);var g=this.decode(a,c);e.push(new xj(f,g))}if(0==e.length)return new La;d=la.typeof(e[0].k);switch(d._hx_index){case 1:var h=new Da;for(b=0;b<e.length;){a=e[b];++b;if(1!=la.typeof(a.k)._hx_index)throw u.thrown("Error: Mixed key type when decoding IntMap");if(h.h.hasOwnProperty(a.k))throw u.thrown("Error: Duplicate keys found => "+w.string(a.k));h.h[a.k]=a.v}return h;case 6:c=d.c;if("String"==c.__name__){h=new La;for(d=0;d<e.length;){a=e[d];++d;b=la.typeof(a.k);if(6==b._hx_index){if(c=b.c,"String"!=
c.__name__)throw u.thrown("Error: Mixed key type when decoding StringMap");}else throw u.thrown("Error: Mixed key type when decoding StringMap");if(Object.prototype.hasOwnProperty.call(h.h,a.k))throw u.thrown("Error: Duplicate keys found => "+w.string(a.k));h.h[a.k]=a.v}return h}throw u.thrown("Error: Unsupported key Type");default:throw u.thrown("Error: Unsupported key Type");}case 1:h={};for(d=0;d<b;)d++,f=this.decode(a,c),g=this.decode(a,c),h[w.string(f)]=g;return h}},getResult:function(){return this.o},
__class__:Lg};var kd=function(a){this.o=new Rc;this.o.set_bigEndian(!0);this.encode(a)};z["org.msgpack.Encoder"]=kd;kd.__name__="org.msgpack.Encoder";kd.prototype={encode:function(a){var b=la.typeof(a);switch(b._hx_index){case 0:this.o.writeByte(192);break;case 1:-32>a?-32768>a?(this.o.writeByte(210),this.o.writeInt32(a)):-128>a?(this.o.writeByte(209),this.o.writeInt16(a)):(this.o.writeByte(208),this.o.writeInt8(a)):128>a?this.o.writeByte(a&255):256>a?(this.o.writeByte(204),this.o.writeByte(a)):65536>
a?(this.o.writeByte(205),this.o.writeUInt16(a)):(this.o.writeByte(206),this.o.writeInt32(a));break;case 2:b=Math.abs(a);1.401298464324817E-45<b&&3.4028234663852886E38>b?(this.o.writeByte(202),this.o.writeFloat(a)):(this.o.writeByte(203),this.o.writeDouble(a));break;case 3:this.o.writeByte(a?195:194);break;case 4:var c=ua.fields(a);var d=ge.count(c);16>d?this.o.writeByte(128|d):65536>d?(this.o.writeByte(222),this.o.writeUInt16(d)):(this.o.writeByte(223),this.o.writeInt32(d));for(d=0;d<c.length;)b=
c[d],++d,this.encode(b),this.encode(ua.field(a,b));break;case 5:throw u.thrown("Error: Function not supported");case 6:b=b.c;switch(b.__name__){case "Array":d=a.length;16>d?this.o.writeByte(144|d):65536>d?(this.o.writeByte(220),this.o.writeUInt16(d)):(this.o.writeByte(221),this.o.writeInt32(d));for(d=0;d<a.length;)b=a[d],++d,this.encode(b);break;case "String":d=a.length;32>d?this.o.writeByte(160|d):256>d?(this.o.writeByte(217),this.o.writeByte(d)):65536>d?(this.o.writeByte(218),this.o.writeUInt16(d)):
(this.o.writeByte(219),this.o.writeInt32(d));this.o.writeString(a);break;case "haxe._Int64.___Int64":this.o.writeByte(211);this.o.writeInt32(a.high);this.o.writeInt32(a.low);break;case "haxe.ds.IntMap":case "haxe.ds.StringMap":case "haxe.ds.UnsafeStringMap":d=0;for(b=a.keys();b.hasNext();)b.next(),++d;16>d?this.o.writeByte(128|d):65536>d?(this.o.writeByte(222),this.o.writeUInt16(d)):(this.o.writeByte(223),this.o.writeInt32(d));for(b=a.keys();b.hasNext();)d=b.next(),this.encode(d),this.encode(a.get(d));
break;case "haxe.io.Bytes":d=a.length;256>d?(this.o.writeByte(196),this.o.writeByte(d)):65536>d?(this.o.writeByte(197),this.o.writeUInt16(d)):(this.o.writeByte(198),this.o.writeInt32(d));this.o.write(a);break;default:throw u.thrown("Error: "+b.__name__+" not supported");}break;case 7:throw u.thrown("Error: Enum not supported");case 8:throw u.thrown("Error: Unknown Data Type");}},writeInt64:function(a){this.o.writeByte(211);this.o.writeInt32(a.high);this.o.writeInt32(a.low)},writeInt:function(a){-32>
a?-32768>a?(this.o.writeByte(210),this.o.writeInt32(a)):-128>a?(this.o.writeByte(209),this.o.writeInt16(a)):(this.o.writeByte(208),this.o.writeInt8(a)):128>a?this.o.writeByte(a&255):256>a?(this.o.writeByte(204),this.o.writeByte(a)):65536>a?(this.o.writeByte(205),this.o.writeUInt16(a)):(this.o.writeByte(206),this.o.writeInt32(a))},writeFloat:function(a){var b=Math.abs(a);1.401298464324817E-45<b&&3.4028234663852886E38>b?(this.o.writeByte(202),this.o.writeFloat(a)):(this.o.writeByte(203),this.o.writeDouble(a))},
writeBinary:function(a){var b=a.length;256>b?(this.o.writeByte(196),this.o.writeByte(b)):65536>b?(this.o.writeByte(197),this.o.writeUInt16(b)):(this.o.writeByte(198),this.o.writeInt32(b));this.o.write(a)},writeString:function(a){var b=a.length;32>b?this.o.writeByte(160|b):256>b?(this.o.writeByte(217),this.o.writeByte(b)):65536>b?(this.o.writeByte(218),this.o.writeUInt16(b)):(this.o.writeByte(219),this.o.writeInt32(b));this.o.writeString(a)},writeArray:function(a){var b=a.length;16>b?this.o.writeByte(144|
b):65536>b?(this.o.writeByte(220),this.o.writeUInt16(b)):(this.o.writeByte(221),this.o.writeInt32(b));for(b=0;b<a.length;){var c=a[b];++b;this.encode(c)}},writeMapLength:function(a){16>a?this.o.writeByte(128|a):65536>a?(this.o.writeByte(222),this.o.writeUInt16(a)):(this.o.writeByte(223),this.o.writeInt32(a))},writeMap:function(a){var b=0;for(var c=a.keys();c.hasNext();)c.next(),++b;16>b?this.o.writeByte(128|b):65536>b?(this.o.writeByte(222),this.o.writeUInt16(b)):(this.o.writeByte(223),this.o.writeInt32(b));
for(c=a.keys();c.hasNext();)b=c.next(),this.encode(b),this.encode(a.get(b))},writeObject:function(a){var b=ua.fields(a),c=ge.count(b);16>c?this.o.writeByte(128|c):65536>c?(this.o.writeByte(222),this.o.writeUInt16(c)):(this.o.writeByte(223),this.o.writeInt32(c));for(c=0;c<b.length;){var d=b[c];++c;this.encode(d);this.encode(ua.field(a,d))}},getBytes:function(){return this.o.getBytes()},__class__:kd};var Mj=function(){};z["org.msgpack.MsgPack"]=Mj;Mj.__name__="org.msgpack.MsgPack";Mj.encode=function(a){return(new kd(a)).o.getBytes()};
Mj.decode=function(a,b){null==b&&(b=we.AsObject);return(new Lg(a,b)).o};var Oc=L["packets.IncomingPackets"]={__ename__:!0,__constructs__:null,AddPlayer:(A=function(a){return{_hx_index:0,data:a,__enum__:"packets.IncomingPackets",toString:v}},A._hx_name="AddPlayer",A.__params__=["data"],A),AddBuilding:(A=function(a){return{_hx_index:1,data:a,__enum__:"packets.IncomingPackets",toString:v}},A._hx_name="AddBuilding",A.__params__=["data"],A),UpdatePlayers:(A=function(a){return{_hx_index:2,data:a,__enum__:"packets.IncomingPackets",
toString:v}},A._hx_name="UpdatePlayers",A.__params__=["data"],A),Ping:{_hx_name:"Ping",_hx_index:3,__enum__:"packets.IncomingPackets",toString:v}};Oc.__constructs__=[Oc.AddPlayer,Oc.AddBuilding,Oc.UpdatePlayers,Oc.Ping];Oc.__empty_constructs__=[Oc.Ping];var Nj=function(){};z["packets.PacketData"]=Nj;Nj.__name__="packets.PacketData";Nj.prototype={__class__:Nj};var Qc=L["packets.OutgoingPackets"]={__ename__:!0,__constructs__:null,Spawn:{_hx_name:"Spawn",_hx_index:0,__enum__:"packets.OutgoingPackets",
toString:v},ChatMessage:(A=function(a){return{_hx_index:1,data:a,__enum__:"packets.OutgoingPackets",toString:v}},A._hx_name="ChatMessage",A.__params__=["data"],A),Aim:(A=function(a){return{_hx_index:2,data:a,__enum__:"packets.OutgoingPackets",toString:v}},A._hx_name="Aim",A.__params__=["data"],A),Move:(A=function(a){return{_hx_index:3,data:a,__enum__:"packets.OutgoingPackets",toString:v}},A._hx_name="Move",A.__params__=["data"],A),Ping:{_hx_name:"Ping",_hx_index:4,__enum__:"packets.OutgoingPackets",
toString:v}};Qc.__constructs__=[Qc.Spawn,Qc.ChatMessage,Qc.Aim,Qc.Move,Qc.Ping];Qc.__empty_constructs__=[Qc.Spawn,Qc.Ping];W.$haxeUID|=0;"undefined"!=typeof performance&&"function"==typeof performance.now&&(D.now=performance.now.bind(performance));z.Math=Math;null==String.fromCodePoint&&(String.fromCodePoint=function(a){return 65536>a?String.fromCharCode(a):String.fromCharCode((a>>10)+55232)+String.fromCharCode((a&1023)+56320)});Object.defineProperty(String.prototype,"__class__",{value:z.String=String,
enumerable:!1,writable:!0});String.__name__="String";z.Array=Array;Array.__name__="Array";Date.prototype.__class__=z.Date=Date;Date.__name__="Date";var cc={},dk={},ek=Number,ck=Boolean,fk={},gk={};xc.add(ia.updateCursor,-1);Z.__toStr={}.toString;null==ArrayBuffer.prototype.slice&&(ArrayBuffer.prototype.slice=Lj.sliceImpl);R.Element=0;R.PCData=1;R.CData=2;R.Comment=3;R.DocType=4;R.ProcessingInstruction=5;R.Document=6;od.LN2=Math.log(2);Za.V1=3;Za.V2=2;Za.V25=0;Za.Reserved=1;Za.V1_Bitrates=[[E.BR_Bad,
E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad],[E.BR_Free,E.BR_32,E.BR_40,E.BR_48,E.BR_56,E.BR_64,E.BR_80,E.BR_96,E.BR_112,E.BR_128,E.BR_160,E.BR_192,E.BR_224,E.BR_256,E.BR_320,E.BR_Bad],[E.BR_Free,E.BR_32,E.BR_48,E.BR_56,E.BR_64,E.BR_80,E.BR_96,E.BR_112,E.BR_128,E.BR_160,E.BR_192,E.BR_224,E.BR_256,E.BR_320,E.BR_384,E.BR_Bad],[E.BR_Free,E.BR_32,E.BR_64,E.BR_96,E.BR_128,E.BR_160,E.BR_192,E.BR_224,E.BR_256,E.BR_288,
E.BR_320,E.BR_352,E.BR_384,E.BR_416,E.BR_448,E.BR_Bad]];Za.V2_Bitrates=[[E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad,E.BR_Bad],[E.BR_Free,E.BR_8,E.BR_16,E.BR_24,E.BR_32,E.BR_40,E.BR_48,E.BR_56,E.BR_64,E.BR_80,E.BR_96,E.BR_112,E.BR_128,E.BR_144,E.BR_160,E.BR_Bad],[E.BR_Free,E.BR_8,E.BR_16,E.BR_24,E.BR_32,E.BR_40,E.BR_48,E.BR_56,E.BR_64,E.BR_80,E.BR_96,E.BR_112,E.BR_128,E.BR_144,E.BR_160,E.BR_Bad],[E.BR_Free,
E.BR_32,E.BR_48,E.BR_56,E.BR_64,E.BR_80,E.BR_96,E.BR_112,E.BR_128,E.BR_144,E.BR_160,E.BR_176,E.BR_192,E.BR_224,E.BR_256,E.BR_Bad]];Za.SamplingRates=[[Ba.SR_11025,Ba.SR_12000,Ba.SR_8000,Ba.SR_Bad],[Ba.SR_Bad,Ba.SR_Bad,Ba.SR_Bad,Ba.SR_Bad],[Ba.SR_22050,Ba.SR_24000,Ba.SR_12000,Ba.SR_Bad],[Ba.SR_44100,Ba.SR_48000,Ba.SR_32000,Ba.SR_Bad]];Yb.LReserved=0;Yb.LLayer3=1;Yb.LLayer2=2;Yb.LLayer1=3;$e.CStereo=0;$e.CJointStereo=1;$e.CDualChannel=2;$e.CMono=3;Bd.ENone=0;Bd.EMs50_15=1;Bd.EReserved=2;Bd.ECCIT_J17=
3;Ra.tmpPoint=new ta(0,0);jb.STRICT=!0;cg.BUFFERING=!1;yc.tmp=new yc;Yg.defaultUseScreenResolution=!1;$b.GUID=0;na.SOFTWARE_DRIVER=!1;na.ANTIALIASING=0;ma.tmp=new ma;ma.lumR=.212671;ma.lumG=.71516;ma.lumB=.072169;ma.SQ13=.5773502691896257;Ac.IDENTITY_DECOMPOSED=Ac.L([1,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1]);Ic.EPSILON=1E-6;ae.SLEEP_THRESHOLD=1E-4;ae.MAX_THRESHOLD=1E6;Bc.TMP_RAY=new Pb;Bc.TMP_MAT=new ma;Aa.ROT2RAD=-.017453292519943295;Aa.NO_VELOCITY=-1;Aa.VELOCITY=0;Aa.tmpMat=new ma;fa.UID=0;fa.ALLOW_WEBGL2=
!0;fa.hasMultiIndirectCount=!1;fa.BLACK=function(a){var b=a=0,c=0,d=0;null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new T(a,b,c,d)}(this);fa.outOfMemoryCheck=!1;fa.STREAM_POS=1;fa.TFILTERS=[[[9728,9728],[9729,9729]],[[9728,9984],[9729,9985]],[[9728,9986],[9729,9987]]];fa.TWRAP=[33071,10497];fa.FACES=[0,1028,1029,1032];fa.BLEND=[1,0,770,768,772,774,771,769,773,775,32769,32771,32770,32772,776];fa.COMPARE=[519,512,514,517,516,518,513,515];fa.STENCIL_OP=[7680,0,7681,7682,34055,7683,
34056,5386];fa.OP=[32774,32778,32779,32775,32776];fa.CUBE_FACES=[34069,34070,34071,34072,34073,34074];fa.CBUFFERS=function(a){a=[];for(var b=0;32>b;){for(var c=[],d=0,e=b++;d<e;){var f=d++;c.push(36064+f)}a.push(c)}return a}(this);jg.ELEMENT_SIZE=20;bf.MAX_MEMORY=4294967296;bf.SIZE=65532;bf.ALL_FLAGS=$a.__empty_constructs__.slice();Wc.checkFlags=-1;ad.defaultKillAlphaThreshold=.5;ad.loadingTextureColor=-65281;Od.current=new Od("Default");ja.enableLights_bits=1;ja.enableLights_offset=0;ja.enableLights_mask=
1;ja.dynamicParameters_bits=1;ja.dynamicParameters_offset=1;ja.dynamicParameters_mask=2;ja.isStatic_bits=1;ja.isStatic_offset=2;ja.isStatic_mask=4;ja.batchMode_bits=1;ja.batchMode_offset=3;ja.batchMode_mask=8;ja.culling_bits=2;ja.culling_offset=0;ja.culling_mask=3;ja.depthWrite_bits=1;ja.depthWrite_offset=2;ja.depthWrite_mask=4;ja.depthTest_bits=3;ja.depthTest_offset=3;ja.depthTest_mask=56;ja.blendSrc_bits=4;ja.blendSrc_offset=6;ja.blendSrc_mask=960;ja.blendDst_bits=4;ja.blendDst_offset=10;ja.blendDst_mask=
15360;ja.blendAlphaSrc_bits=4;ja.blendAlphaSrc_offset=14;ja.blendAlphaSrc_mask=245760;ja.blendAlphaDst_bits=4;ja.blendAlphaDst_offset=18;ja.blendAlphaDst_mask=3932160;ja.blendOp_bits=3;ja.blendOp_offset=22;ja.blendOp_mask=29360128;ja.blendAlphaOp_bits=3;ja.blendAlphaOp_offset=25;ja.blendAlphaOp_mask=234881024;ja.wireframe_bits=1;ja.wireframe_offset=28;ja.wireframe_mask=268435456;ja.culled_bits=1;ja.culled_offset=29;ja.culled_mask=536870912;ja.reserved_bits=1;ja.reserved_offset=30;ja.reserved_mask=
1073741824;wa.readMask_bits=8;wa.readMask_offset=0;wa.readMask_mask=255;wa.writeMask_bits=8;wa.writeMask_offset=8;wa.writeMask_mask=65280;wa.reference_bits=8;wa.reference_offset=16;wa.reference_mask=16711680;wa.frontTest_bits=3;wa.frontTest_offset=0;wa.frontTest_mask=7;wa.frontPass_bits=3;wa.frontPass_offset=3;wa.frontPass_mask=56;wa.frontSTfail_bits=3;wa.frontSTfail_offset=6;wa.frontSTfail_mask=448;wa.frontDPfail_bits=3;wa.frontDPfail_offset=9;wa.frontDPfail_mask=3584;wa.backTest_bits=3;wa.backTest_offset=
12;wa.backTest_mask=28672;wa.backPass_bits=3;wa.backPass_offset=15;wa.backPass_mask=229376;wa.backSTfail_bits=3;wa.backSTfail_offset=18;wa.backSTfail_mask=1835008;wa.backDPfail_bits=3;wa.backDPfail_offset=21;wa.backDPfail_mask=14680064;Y.UID=0;Y.PREVENT_AUTO_DISPOSE=2147483647;Y.PREVENT_FORCED_DISPOSE=-1;Y.nativeFormat=F.RGBA;Y.TRILINEAR_FILTERING_ENABLED=!0;Y.DEFAULT_WRAP=Fe.Clamp;Y.checkerTextureKeys=new Da;Y.noiseTextureKeys=new Da;Y.genTextureKeys=new La;mg.__meta__={obj:{ignore:["shader"]}};
Xa.SRC="HXSMF2gzZC5zaGFkZXIuU2NyZWVuU2hhZGVyBwEFaW5wdXQNAQICCHBvc2l0aW9uBQoBAQADAnV2BQoBAQABAAAEBWZsaXBZAwIAAAUGb3V0cHV0DQICBghwb3NpdGlvbgUMBAUABwVjb2xvcgUMBAUABAAACApwaXhlbENvbG9yBQwEAAAJDGNhbGN1bGF0ZWRVVgUKBAAACghfX2luaXRfXw4GAAALBnZlcnRleA4GAAACAgoAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAALAAAFAQYEAgYFDAkDKw4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAA";Xa._MODULE="h3d.shader.ScreenShader";Id.SRC="HXSMHWgzZC5wYXNzLl9Cb3JkZXIuQm9yZGVyU2hhZGVyCQEFaW5wdXQNAQICCHBvc2l0aW9uBQoBAQADAnV2BQoBAQABAAAEBWZsaXBZAwIAAAUGb3V0cHV0DQICBghwb3NpdGlvbgUMBAUABwVjb2xvcgUMBAUABAAACApwaXhlbENvbG9yBQwEAAAJDGNhbGN1bGF0ZWRVVgUKBAAACgVjb2xvcgUMAgAACwhfX2luaXRfXw4GAAAMBnZlcnRleA4GAAANCGZyYWdtZW50DgYAAAMCCwAABQIGBAIHBQwCCAUMBQwGBAIJBQoCAwUKBQoAAAwAAAUBBgQCBgUMCQMrDgQKAgIFCgAAAwYBCgICBQoEAAMCBAMDAQMAAAAAAAAAAAMBAwAAAAAAAPA/AwUMBQwAAQ0AAAUBBgQCCAUMAgoFDAUMAA";
Id._MODULE="h3d.pass.Border";Qe.SRC="HXSMHmgzZC5wYXNzLl9Db3B5LkFycmF5Q29weVNoYWRlcgoBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoHdGV4dHVyZQoDAgAACwVsYXllcgECAAAMCF9faW5pdF9fDgYAAA0GdmVydGV4DgYAAA4IZnJhZ21lbnQOBgAAAwIMAAAFAgYEAgcFDAIIBQwFDAYEAgkFCgIDBQoFCgAADQAABQEGBAIGBQwJAysOBAoCAgUKAAADBgEKAgIFCgQAAwIEAwMBAwAAAAAAAAAAAwEDAAAAAAAA8D8DBQwFDAABDgAABQEGBAIIBQwJAyIOAgIKCgMJAyoOAgIJBQoJAycOAQILAQMFCwUMBQwA";
Qe._MODULE="h3d.pass.Copy";Re.SRC="HXSMGWgzZC5wYXNzLl9Db3B5LkNvcHlTaGFkZXIJAQVpbnB1dA0BAgIIcG9zaXRpb24FCgEBAAMCdXYFCgEBAAEAAAQFZmxpcFkDAgAABQZvdXRwdXQNAgIGCHBvc2l0aW9uBQwEBQAHBWNvbG9yBQwEBQAEAAAICnBpeGVsQ29sb3IFDAQAAAkMY2FsY3VsYXRlZFVWBQoEAAAKB3RleHR1cmUKAgIAAAsIX19pbml0X18OBgAADAZ2ZXJ0ZXgOBgAADQhmcmFnbWVudA4GAAADAgsAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAAMAAAFAQYEAgYFDAkDKw4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAAENAAAFAQYEAggFDAkDIg4CAgoKAgIJBQoFDAUMAA";Re._MODULE="h3d.pass.Copy";
me.SRC="HXSMIWgzZC5wYXNzLl9DdWJlQ29weS5DdWJlQ29weVNoYWRlcgoBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoHdGV4dHVyZQoGAgAACwNtYXQGAgAADAhfX2luaXRfXw4GAAANBnZlcnRleA4GAAAOCGZyYWdtZW50DgYAAAMCDAAABQIGBAIHBQwCCAUMBQwGBAIJBQoCAwUKBQoAAA0AAAUBBgQCBgUMCQMrDgQKAgIFCgAAAwYBCgICBQoEAAMCBAMDAQMAAAAAAAAAAAMBAwAAAAAAAPA/AwUMBQwAAQ4AAAUCCA8CdXYFCgQAAAYDBgECCQUKAQMAAAAAAAAAQAMFCgEDAAAAAAAA8D8DBQoABgQCCAUMCQMiDgICCgoGCQMgDgEGAQkDKg4CAg8FCgEDAAAAAAAA8D8DBQsCCwYFCwULBQwFDAA";
me._MODULE="h3d.pass.CubeCopy";Pa.db=new La;Pa.FILE_NAME="model.props";Pa.LOD_CONFIG="lodConfig";Pa.DYN_BONES_CONFIG="dynamicBones";Pa.defaultLodConfigs=new La;Pa.baseLodConfig=[.5,.2,.01];Pa.current=new Pa;Ua.tmpMat=new ma;qg.__meta__={fields:{cameraView:{global:["camera.view"]},cameraNear:{global:["camera.zNear"]},cameraFar:{global:["camera.zFar"]},cameraProj:{global:["camera.proj"]},cameraPos:{global:["camera.position"]},cameraProjDiag:{global:["camera.projDiag"]},cameraProjFlip:{global:["camera.projFlip"]},
cameraViewProj:{global:["camera.viewProj"]},cameraInverseViewProj:{global:["camera.inverseViewProj"]},cameraPreviousViewProj:{global:["camera.previousViewProj"]},cameraJitterOffsets:{global:["camera.jitterOffsets"]},globalTime:{global:["global.time"]},pixelSize:{global:["global.pixelSize"]},globalModelView:{global:["global.modelView"]},globalModelViewInverse:{global:["global.modelViewInverse"]},globalPreviousModelView:{global:["global.previousModelView"]}}};Fa.newWorldPos=function(a){var b=a=0,c=
0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)}(this);Fa.expectedPos=function(a){var b=a=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)}(this);Fa.tmpVec=function(a){var b=a=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)}(this);Fa.tmpVec2=function(a){var b=a=0,c=0;null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);return new I(a,b,c)}(this);Fa.tmpQ=new Hc;fc.TMP_MAT=new ma;dd.SRC="HXSMF2gzZC5zaGFkZXIuQW1iaWVudExpZ2h0CgEGZ2xvYmFsDQECAgxhbWJpZW50TGlnaHQFCwABAAMQcGVyUGl4ZWxMaWdodGluZwIAAQEAAAAAAAAAAAQKcGl4ZWxDb2xvcgUMBAAABQ9saWdodFBpeGVsQ29sb3IFCwQAAAYKbGlnaHRDb2xvcgULBAAABwhhZGRpdGl2ZQICAAEAAAAAAAgIX19pbml0X18OBgAACRBfX2luaXRfX2ZyYWdtZW50DgYAAAoJY2FsY0xpZ2h0DgYAAAsGdmVydGV4DgYAAAwIZnJhZ21lbnQOBgAABQIIAAAFAQYEAgYFCwsCBwICAgULCQMqDgEBAwAAAAAAAAAAAwULBQsFCwACCQAABQEGBAIFBQsLAgcCAgIFCwkDKg4BAQMAAAAAAAAAAAMFCwULBQsAAwoBDQpsaWdodENvbG9yBQsEAAAFCwUBDQsCBwICDQULBAYAAgIFCwYBCQMWDgIEBgMBAwAAAAAAAPA/AwICBQsFCwULAQMAAAAAAAAAAAMFCwINBQsFCwULBQsFCwAAAAsAAAUBCwcCAgMCAgaBCgIEBQySAAULCQIKDgECBgULBQsFCwAAAAEMAAAFAQsCAwIGgQoCBAUMkgAFCwkCCg4BAgUFCwULBQsAAAA";
dd._MODULE="h3d.shader.AmbientLight";af.SRC="HXSMEWgzZC5zaGFkZXIuQmFzZTJkGwEFaW5wdXQNAQMCCHBvc2l0aW9uBQoBAQADAnV2BQoBAQAEBWNvbG9yBQwBAQABAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgEdGltZQMAAAAJBnpWYWx1ZQMCAAAKB3RleHR1cmUKAgIAAAsOc3ByaXRlUG9zaXRpb24FDAQAAAwQYWJzb2x1dGVQb3NpdGlvbgUMBAAADQpwaXhlbENvbG9yBQwEAAAODHRleHR1cmVDb2xvcgUMBAAADwxjYWxjdWxhdGVkVVYFCgMAABAKaXNSZWxhdGl2ZQICAAEAAAAAABEFY29sb3IFDAIAABIPYWJzb2x1dGVNYXRyaXhBBQsCAAATD2Fic29sdXRlTWF0cml4QgULAgAAFA1maWx0ZXJNYXRyaXhBBQsCAAAVDWZpbHRlck1hdHJpeEIFCwIAABYIaGFzVVZQb3MCAgABAAAAAAAXBXV2UG9zBQwCAAAYCWtpbGxBbHBoYQICAAEAAAAAABkKcGl4ZWxBbGlnbgICAAEAAAAAABoQaGFsZlBpeGVsSW52ZXJzZQUKAgAAGwl2aWV3cG9ydEEFCwIAABwJdmlld3BvcnRCBQsCAAAdDm91dHB1dFBvc2l0aW9uBQwEAAAeCF9faW5pdF9fDgYAAB8GdmVydGV4DgYAACAIZnJhZ21lbnQOBgAAAwIeAAAFBgYEAgsFDAkDKw4DAgIFCgIJAwEDAAAAAAAA8D8DBQwFDAsCEAIFAwYECgIMBQwAAAMJAx4OAgkDKg4CCgILBQwRAAUKAQMAAAAAAADwPwMFCwISBQsDAwYECgIMBQwEAAMJAx4OAgkDKg4CCgILBQwRAAUKAQMAAAAAAADwPwMFCwITBQsDAwYECgIMBQw5AAUKCgILBQw5AAUKBQoABgQCDAUMAgsFDAUMAAYEAg8FCgsCFgIGAAYBAgMFCgoCFwUMOQAFCgUKCgIXBQwRAAUKBQoCAwUKBQoFCgYEAg0FDAsCEAIGAQIRBQwCBAUMBQwCBAUMBQwFDAYEAg4FDAkDIg4CAgoKAgIPBQoFDAUMBoECDQUMAg4FDAUMAAAfAAAFBQghA3RtcAULBAAACQMqDgIKAgwFDBEABQoBAwAAAAAAAPA/AwULAAYEAiEFCwkDKg4DCQMeDgICIQULAhQFCwMJAx4OAgIhBQsCFQULAwEDAAAAAAAA8D8DBQsFCwYEAh0FDAkDKw4DCQMeDgICIQULAhsFCwMJAx4OAgIhBQsCHAULAwoCDAUMOQAFCgUMBQwLAhkCBoMKAh0FDBEABQoCGgUKBQoAAAYEAgYFDAIdBQwFDAABIAAABQILBg4CGAIGCQoCDQUMDAADAQP8qfHSTWJQPwMCAgwAAAAGBAIHBQwCDQUMBQwA";
af._MODULE="h3d.shader.Base2d";Gd.SRC="HXSME2gzZC5zaGFkZXIuQmFzZU1lc2gcAQZjYW1lcmENAQwCBHZpZXcHAAEAAwRwcm9qBwABAAQIcG9zaXRpb24FCwABAAUIcHJvakZsaXADAAEABghwcm9qRGlhZwULAAEABwh2aWV3UHJvagcAAQAIEHByZXZpb3VzVmlld1Byb2oHAAEACQ9pbnZlcnNlVmlld1Byb2oHAAEACgV6TmVhcgMAAQALBHpGYXIDAAEADANkaXIFCwMBAA0Naml0dGVyT2Zmc2V0cwUMAAEAAAAADgZnbG9iYWwNAgUPBHRpbWUDAA4AEAlwaXhlbFNpemUFCgAOABEJbW9kZWxWaWV3BwAOAQMSEG1vZGVsVmlld0ludmVyc2UHAA4BAxMRcHJldmlvdXNNb2RlbFZpZXcHAA4BAwAAABQFaW5wdXQNAwIVCHBvc2l0aW9uBQsBFAAWBm5vcm1hbAULARQAAQAAFwZvdXRwdXQNBAYYCHBvc2l0aW9uBQwEFwAZBWNvbG9yBQwEFwAaBWRlcHRoAwQXABsGbm9ybWFsBQsEFwAcCXdvcmxkRGlzdAMEFwAdCHZlbG9jaXR5BQoEFwAEAAAeEHJlbGF0aXZlUG9zaXRpb24FCwQAAB8TdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAIBtwcmV2aW91c1RyYW5zZm9ybWVkUG9zaXRpb24FCwQAACEYcGl4ZWxUcmFuc2Zvcm1lZFBvc2l0aW9uBQsEAAAiEXRyYW5zZm9ybWVkTm9ybWFsBQsEAAAjEXByb2plY3RlZFBvc2l0aW9uBQwEAAAkGXByZXZpb3VzUHJvamVjdGVkUG9zaXRpb24FDAQAACUKcGl4ZWxDb2xvcgUMBAAAJgVkZXB0aAMEAAAnC25kY1Bvc2l0aW9uBQoEAAAoE3ByZXZpb3VzTmRjUG9zaXRpb24FCgQAACkIc2NyZWVuVVYFCgQAACoJc3BlY1Bvd2VyAwQAACsJc3BlY0NvbG9yBQsEAAAsCXdvcmxkRGlzdAMEAAAtDXBpeGVsVmVsb2NpdHkFCgQAAC4FY29sb3IFDAIAAC8Nc3BlY3VsYXJQb3dlcgMCAAEHAAAAAAAAAAAAAAAAAABZQDAOc3BlY3VsYXJBbW91bnQDAgABBwAAAAAAAAAAAAAAAAAAJEAxDXNwZWN1bGFyQ29sb3IFCwIAADIIX19pbml0X18OBgAAMxBfX2luaXRfX2ZyYWdtZW50DgYAADQGdmVydGV4DgYAADUIZnJhZ21lbnQOBgAABAIyAAAFDQYEAh4FCwIVBQsFCwYEAh8FCwYBAh4FCwkDNQ4BAhEHCAULBQsGBAIjBQwGAQkDKw4CAh8FCwEDAAAAAAAA8D8DBQwCBwcFDAUMBgQCIAULBgECHgULCQM1DgECEwcIBQsFCwYEAiQFDAYBCQMrDgICIAULAQMAAAAAAADwPwMFDAIIBwUMBQwGBAIiBQsJAyAOAQQGAQIWBQsJAzMOAQIRBwYFCwULBQsFCwYEAgwFCwkDIA4BBAYDAgQFCwIfBQsFCwULBQsFCwYEAiUFDAIuBQwFDAYEAioDAi8DAwYEAisFCwYBAjEFCwIwAwULBQsGBAIpBQoJAzsOAQYCCgIjBQwRAAUKCgIjBQwMAAMFCgUKBQoGBAImAwYCCgIjBQwIAAMKAiMFDAwAAwMDBgQCLAMGAgkDHA4BBgMCHwULAgQFCwULAwILAwMDAAIzAAAFCgYEAiIFCwkDIA4BAiIFCwULBQsGBAInBQoGAgoCIwUMEQAFCgoCIwUMDAADBQoFCgYEAigFCgYCCgIkBQwRAAUKCgIkBQwMAAMFCgUKBgQCKQUKCQM7DgECJwUKBQoFCgYEAiYDBgIKAiMFDAgAAwoCIwUMDAADAwMGBAIqAwIvAwMGBAIrBQsGAQIxBQsCMAMFCwULBoMCJwUKCgINBQwRAAUKBQoGgwIoBQoKAg0FDDkABQoFCgYEAi0FCgYBBAYDAigFCgInBQoFCgUKCQMpDgIBAwAAAAAAAOA/AwEDAAAAAAAA4L8DBQoFCgUKAAA0AAAFAgYEAhgFDAYBAiMFDAkDKw4EAQMAAAAAAADwPwMCBQMBAwAAAAAAAPA/AwEDAAAAAAAA8D8DBQwFDAUMBgQCIQULAh8FCwULAAE1AAAFBQYEAhkFDAIlBQwFDAYEAhoDAiYDAwYEAhsFCwIiBQsFCwYEAhwDAiwDAwYEAh0FCgItBQoFCgA";
Gd._MODULE="h3d.shader.BaseMesh";ff.SRC="HXSMD2gzZC5zaGFkZXIuQmx1chsBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoLaW52ZXJzZVByb2oHAgAACwd0ZXh0dXJlCgICAAAMDGRlcHRoVGV4dHVyZQoCAgAADQdRdWFsaXR5AQIAAQAAAAAADgdpc0RlcHRoAgIAAQAAAAAADwZ2YWx1ZXMPAw0CAAAQB29mZnNldHMPAw0CAAARBXBpeGVsBQoCAAASDWhhc0ZpeGVkQ29sb3ICAgABAAAAAAATEHNtb290aEZpeGVkQ29sb3ICAgABAAAAAAAUCmZpeGVkQ29sb3IFDAIAABUQaXNEZXB0aERlcGVuZGFudAICAAEAAAAAABYOZGVwdGhUaHJlc2hvbGQDAgAAFxVkZXB0aFRocmVzaG9sZE1heERpc3QDAgAAGAZpc0N1YmUCAgABAAAAAAAZC2N1YmVUZXh0dXJlCgYCAAAaB2N1YmVEaXIGAgAAGwhfX2luaXRfXw4GAAAcBnZlcnRleA4GAAAdDnNjYWxlVGhyZXNob2xkDgYAAB4IZnJhZ21lbnQOBgAAHw9nZXRWaWV3UG9zaXRpb24OBgAABQIbAAAFAgYEAgcFDAIIBQwFDAYEAgkFCgIDBQoFCgAAHAAABQEGBAIGBQwJAysOBAoCAgUKAAADBgEKAgIFCgQAAwIEAwMBAwAAAAAAAAAAAwEDAAAAAAAA8D8DBQwFDAADHQEgAXoDBAAAAwUDCCEBdAMEAAACFgMACwYHAhcDAQMAAAAAAAAAAAMCBoECIQMGAAEDAAAAAAAA8D8DCQMWDgIGAwIgAwIXAwMBAwAAAAAAAAAAAwMDAwAADQIhAwAAAR4AAAUCCwIVAgUMCCIKZGltZW5zaW9ucwUKBAAACQMlDgECCwoCBQoACCMNaW52RGltZW5zaW9ucwUKBAAABgIBAwAAAAAAAPA/AwIiBQoFCgAIJAVjb29yZAUKBAAACgNHBQwRAAUKAAglBmZyYWdVVgUKBAAABgEKAiQFChEABQoCIwUKBQoACCYBcAULBAAACQIfDgECJQUKBQsACCcEbWluWgMEAAAKAiYFCwgAAwAIKAFjBQwEAAAJAyIOAgILCgICJQUKBQwACCkFY29sb3IFDAQAAAkDKw4EAQMAAAAAAAAAAAMBAwAAAAAAAAAAAwEDAAAAAAAAAAADAQMAAAAAAAAAAAMFDAAIKgZpc0VkZ2UCBAAAAQEAAgAVBnVucm9sbAAOKwFpAQQAAAYVBwMCDQEBBgACDQEBAgEAAAABAQ8BAAAFBQgsCGN1ckNvb3JkBQoEAAAGAAkDEQ4BBgACJAUKBgEGAQQGAQIRBQoCIgUKBQoFCgkDKQ4BAQMAAAAAAADwPwMFCgUKCQMnDgECKwEDBQoFCgUKCQMpDgEBAwAAAAAAAOA/AwUKBQoACC0JbmVhcmVzdFVWBQoEAAAGAQIsBQoCIwUKBQoACC4EcGN1cgULBAAACQIfDgECLQUKBQsACC8BZAMEAAAJAw8OAQYDCgIuBQsIAAMKAiYFCwgAAwMDAAYEAioCBg8CKgIEBgcCLwMJAh0OAQkDFQ4CCgIuBQsIAAMKAiYFCwgAAwMDAgICAgAAABUGdW5yb2xsAA4wAWkBBAAABhUGAAcDAg0BAQECAQAAAAEBAg0BDwEAAAUICDEIY3VyQ29vcmQFCgQAAAYACQMRDgEGAAIkBQoGAQYBBAYBAhEFCgIiBQoFCgUKEQIQDwMNCwYJAjABAQIAAAAAAQIHAwIwAQECMAEBAwUKCQMnDgECMAEDBQoFCgUKCQMpDgEBAwAAAAAAAOA/AwUKBQoACDIJbmVhcmVzdFVWBQoEAAAGAQIxBQoCIwUKBQoACDMCdXYFCgQAAAYAAiUFCgYBBgECEQUKEQIQDwMNCwYJAjABAQIAAAAAAQIHAwIwAQECMAEBAwUKCQMnDgECMAEDBQoFCgAINARjY3VyBQwEAAAJAyIOAgILCgILBAIqAgICMgUKAjMFCgUKBQwACDUEcGN1cgULBAAACQIfDgECMgUKBQsACDYBZAMEAAAJAw8OAQYDCgI1BQsIAAMKAiYFCwgAAwMDAAYEAigFDAsEBgcCNgMJAh0OAQkDFQ4CCgI1BQsIAAMKAiYFCwgAAwMDAgICKAUMAjQFDAUMBQwGgAIpBQwGAQIoBQwRAg8PAw0LBgkCMAEBAgAAAAABAgcDAjABAQIwAQEDBQwFDAAAAAYEAggFDAIpBQwFDAALAg4CBQMINwN2YWwDBAAAAQMAAAAAAAAAAAMAFQZ1bnJvbGwADjgBaQEEAAAGFQYABwMCDQEBAQIBAAAAAQECDQEPAQAABQELAhgCBoACNwMGAQkDOA4BCQMiDgICGQoGBgEJAyoOAgYDBgEEBgACAwUKBgEGAQIRBQoRAhAPAw0LBgkCOAEBAgAAAAABAgcDAjgBAQI4AQEDBQoJAycOAQI4AQMFCgUKBQoBAwAAAAAAAABAAwUKAQMAAAAAAADwPwMFCgEDAAAAAAAA8D8DBQsCGgYFCwUMAxECDw8DDQsGCQI4AQECAAAAAAECBwMCOAEBAjgBAQMDAwaAAjcDBgEJAzgOAQkDIg4CAgsKAgYAAgMFCgYBBgECEQUKEQIQDwMNCwYJAjgBAQIAAAAAAQIHAwI4AQECOAEBAwUKCQMnDgECOAEDBQoFCgUMAxECDw8DDQsGCQI4AQECAAAAAAECBwMCOAEBAjgBAQMDAwAAAAAGBAIIBQwJAzcOAQkDFQ4CAjcDAQPLGlDK///vPwMDBQwFDAAFAwg5BWNvbG9yBQwEAAAJAysOBAEDAAAAAAAAAAADAQMAAAAAAAAAAAMBAwAAAAAAAAAAAwEDAAAAAAAAAAADBQwAFQZ1bnJvbGwADjoBaQEEAAAGFQYABwMCDQEBAQIBAAAAAQECDQEPAQAABQELAhgCBoACOQUMBgEJAyIOAgIZCgYGAQkDKg4CBgMGAQQGAAIDBQoGAQYBAhEFChECEA8DDQsGCQI6AQECAAAAAAECBwMCOgEBAjoBAQMFCgkDJw4BAjoBAwUKBQoFCgEDAAAAAAAAAEADBQoBAwAAAAAAAPA/AwUKAQMAAAAAAADwPwMFCwIaBgULBQwRAg8PAw0LBgkCOgEBAgAAAAABAgcDAjoBAQI6AQEDBQwFDAaAAjkFDAYBCQMiDgICCwoCBgACAwUKBgEGAQIRBQoRAhAPAw0LBgkCOgEBAgAAAAABAgcDAjoBAQI6AQEDBQoJAycOAQI6AQMFCgUKBQwRAg8PAw0LBgkCOgEBAgAAAAABAgcDAjoBAQI6AQEDBQwFDAAAAAAGBAIIBQwCOQUMBQwAAAALAhICBQILAhMCBoEKAggFDAwAAwoCFAUMDAADAwYECgIIBQwMAAMGAQoCFAUMDAADCQMnDgEGBwoCCAUMDAADAQMAAAAAAAAAAAMCAwMDAAYECgIIBQySAAULBgEKAhQFDJIABQsKAggFDAwAAwULBQsAAAAAAx8BOwJ1dgUKBAAABQsFBAg8BWRlcHRoAwQAAAoJAyIOAgIMCgICOwUKBQwAAAMACD0EdGVtcAUMBAAABgEJAysOAwkDPA4BAjsFCgUKAjwDAQMAAAAAAADwPwMFDAIKBwUMAAg+CG9yaWdpbldTBQsEAAAGAgoCPQUMkgAFCwoCPQUMDAADBQsADQI+BQsAAA";
ff._MODULE="h3d.shader.Blur";Be.SRC="HXSME2gzZC5zaGFkZXIuQ29sb3JBZGQDAQpwaXhlbENvbG9yBQwEAAACBWNvbG9yBQsCAAADCGZyYWdtZW50DgYAAAEBAwAABQEGgAoCAQUMkgAFCwICBQsFCwA";Be._MODULE="h3d.shader.ColorAdd";Ce.SRC="HXSME2gzZC5zaGFkZXIuQ29sb3JLZXkDAQhjb2xvcktleQUMAgAAAgx0ZXh0dXJlQ29sb3IFDAQAAAMIZnJhZ21lbnQOBgAAAQEDAAAFAggEBWNkaWZmBQwEAAAGAwICBQwCAQUMBQwACwYJCQMeDgICBAUMAgQFDAMBA/Fo44i1+OQ+AwIMAAAAAA";Ce._MODULE="h3d.shader.ColorKey";De.SRC="HXSMFmgzZC5zaGFkZXIuQ29sb3JNYXRyaXgEAQpwaXhlbENvbG9yBQwEAAACBm1hdHJpeAcCAAADB2VuYWJsZWQCAgABAAAAAAAECGZyYWdtZW50DgYAAAEBBAAABQELAgMCBgQCAQUMCQMrDgIKBAYBCQMrDgIKAgEFDJIABQsBAwAAAAAAAPA/AwUMAgIHBQwFDJIABQsKBAYBAgEFDAICBwUMBQwMAAMFDAUMAAAA";
De._MODULE="h3d.shader.ColorMatrix";oe.SRC="HXSMFGgzZC5zaGFkZXIuRGlyU2hhZG93EAEGZW5hYmxlAgIAAQAAAAAAAgdVU0VfRVNNAgIAAQAAAAAAAwtzaGFkb3dQb3dlcgMCAAAEB1VTRV9QQ0YCAgABAAAAAAAFC1BDRl9TQU1QTEVTAQIAAQAAAAAABghwY2ZTY2FsZQMCAAAHCXNoYWRvd1JlcwUKAgAACAlzaGFkb3dNYXARAQIAAAkKc2hhZG93UHJvaggCAAAKCnNoYWRvd0JpYXMDAgAACxN0cmFuc2Zvcm1lZFBvc2l0aW9uBQsEAAAMBnNoYWRvdwMEAAANCWRpclNoYWRvdwMEAAAOC3BvaXNzb25EaXNrDwUMBQIAAA8EcmFuZA4GAAAQCGZyYWdtZW50DgYAAAIDDwERAXYDBAAAAwUCCBICZHADBAAACQMeDgIJAysOAQIRAwUMCQMrDgQBA18pyxDH+ilAAwED9P3UeOmOU0ADAQOiRbbz/ZRGQAMBA1CNl24Sq1dAAwUMAwANCQMTDgEGAQkDAg4BAhIDAwEDUPwYc9Fd5UADAwMAAAEQAAAFAgsCAQIFAQsCBAIFCwYEAgwDAQMAAAAAAADwPwMDCBMJdGV4ZWxTaXplBQoEAAAGAgEDAAAAAAAA8D8DAgcFCgUKAAgUCXNoYWRvd1BvcwULBAAABgECCwULAgkIBQsACBUIc2hhZG93VXYFCgQAAAkDOw4BCgIUBQsRAAUKBQoACBYEek1heAMEAAAJAzYOAQoCFAULCAADAwAIFwNyb3QDBAAABgEGAQkCDw4BBgAGAAoCCwULAAADCgILBQsEAAMDCgILBQsIAAMDAwEDH4XrUbgeCUADAwEDAAAAAAAAAEADAwAIGARjb3NSAwQAAAkDAw4BAhcDAwAIGQRzaW5SAwQAAAkDAg4BAhcDAwAIGg5zYW1wbGVTdHJlbmd0aAMEAAAGAgEDAAAAAAAA8D8DCQMnDgECBQEDAwAIGwhvZmZTY2FsZQUKBAAABgECEwUKAgYDBQoADhwBaQEEAAAGFQECAAAAAAECBQEPAQAABQQIHQZvZmZzZXQFCgQAAAYBChECDg8FDAUCHAEFDBEABQoCGwUKBQoABgQCHQUKCQMpDgIGAwYBAhgDCgIdBQoAAAMDBgECGQMKAh0FCgQAAwMDBgAGAQIYAwoCHQUKBAADAwYBAhkDCgIdBQoAAAMDAwUKBQoIHgVkZXB0aAMEAAAJA0EOAwIIEQEGAAIVBQoCHQUKBQoBAwAAAAAAAAAAAwMABoMCDAMLBAYHBgMCFgMCCgMDAh4DAgICGgMBAwAAAAAAAAAAAwMDAAAACwICAgUFCB8Jc2hhZG93UG9zBQsEAAAGAQILBQsCCQgFCwAIIAVkZXB0aAMEAAAJA0AOAgIIEQEJAzsOAQoCHwULEQAFCgUKAwAIIQR6TWF4AwQAAAkDNg4BCgIfBQsIAAMDAAgiBWRlbHRhAwQAAAYDCQMVDgIEBgACIAMCCgMDAwIhAwMCIQMDAAYEAgwDCQM2DgEJAwkOAQYBAgMDAiIDAwMDAwAFBAgjCXNoYWRvd1BvcwULBAAABgECCwULAgkIBQsACCQIc2hhZG93VXYFCgQAAAkDOw4BCgIjBQsRAAUKBQoACCUFZGVwdGgDBAAACQNADgICCBEBCgIkBQoRAAUKAwAGBAIMAwsGBwYDCQM2DgEKAiMFCwgAAwMCCgMDAiUDAgEDAAAAAAAAAAADAQMAAAAAAADwPwMDAwAAAAAAAAYEAg0DAgwDAwA";
oe._MODULE="h3d.shader.DirShadow";Oe.SRC="HXSMFWgzZC5zaGFkZXIuR2VuVGV4dHVyZQoBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoEbW9kZQECAAEAAAAAAAsFY29sb3IFDAIAAAwIX19pbml0X18OBgAADQZ2ZXJ0ZXgOBgAADghmcmFnbWVudA4GAAADAgwAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAANAAAFAQYEAgYFDAkDKw4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAAEOAAAFARMEAgoBAQEBAQIAAAAAAQUBBgQCCAUMCwYHCQMcDgEKAgYFDBEABQoDAQMAAAAAAADwPwMCCQMrDgEBAwAAAAAAAAAAAwUMAgsFDAUMBQwAAAAA";
Oe._MODULE="h3d.shader.GenTexture";Ue.SRC="HXSMFWgzZC5zaGFkZXIuTGluZVNoYWRlcgwBBmNhbWVyYQ0BAwIEdmlldwcAAQADBHByb2oHAAEABAh2aWV3UHJvagcAAQAAAAAFBmdsb2JhbA0CAgYJcGl4ZWxTaXplBQoABQAHCW1vZGVsVmlldwcABQEDAAAACAVpbnB1dA0DAwkIcG9zaXRpb24FCwEIAAoGbm9ybWFsBQsBCAALAnV2BQoBCAABAAAMBm91dHB1dA0EAQ0IcG9zaXRpb24FDAQMAAQAAA4RdHJhbnNmb3JtZWROb3JtYWwFCwQAAA8TdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAEBFwcm9qZWN0ZWRQb3NpdGlvbgUMBAAAEQtsZW5ndGhTY2FsZQMCAAASBXdpZHRoAwIAABMEcGRpcgUMBAAAFAhfX2luaXRfXw4GAAAVBnZlcnRleA4GAAACAhQAAAUBBQUIFgNkaXIFCwQAAAYBAgoFCwkDMw4BAgcHBgULAAYEAhMFDAYBCQMrDgIGAQIWBQsJAzMOAQICBwYFCwEDAAAAAAAA8D8DBQwCAwcFDAUMBoEKAhMFDBEABQoGAgEDAAAAAAAA8D8DCQMNDgEGAAYBCgITBQwAAAMKAhMFDAAAAwMGAQoCEwUMBAADCgITBQwEAAMDAwMDBQoGgAIPBQsGAQYBAhYFCwoCCwUKAAADBQsCEQMFCwULBgQCDgULCQMgDgECFgULBQsFCwAAABUAAAUBBoAKAhAFDBEABQoGAQYBBgEGAQQGAQoCEwUMBQAFCgkDKQ4CAQMAAAAAAADwPwMBAwAAAAAAAPC/AwUKBQoFCgQGAwoCCwUKBAADAQMAAAAAAADgPwMDAwUKCgIQBQwIAAMFCgIGBQoFCgISAwUKBQoA";
Ue._MODULE="h3d.shader.LineShader";Se.SRC="HXSMF2gzZC5zaGFkZXIuTWluTWF4U2hhZGVyCwEFaW5wdXQNAQICCHBvc2l0aW9uBQoBAQADAnV2BQoBAQABAAAEBWZsaXBZAwIAAAUGb3V0cHV0DQICBghwb3NpdGlvbgUMBAUABwVjb2xvcgUMBAUABAAACApwaXhlbENvbG9yBQwEAAAJDGNhbGN1bGF0ZWRVVgUKBAAACgR0ZXhBCgICAAALBHRleEIKAgIAAAwFaXNNYXgCAgABAAAAAAANCF9faW5pdF9fDgYAAA4GdmVydGV4DgYAAA8IZnJhZ21lbnQOBgAAAwINAAAFAgYEAgcFDAIIBQwFDAYEAgkFCgIDBQoFCgAADgAABQEGBAIGBQwJAysOBAoCAgUKAAADBgEKAgIFCgQAAwIEAwMBAwAAAAAAAAAAAwEDAAAAAAAA8D8DBQwFDAABDwAABQMIEAFhBQwEAAAJAyIOAgIKCgICCQUKBQwACBEBYgUMBAAACQMiDgICCwoCAgkFCgUMAAYEAggFDAsCDAIJAxYOAgIQBQwCEQUMBQwJAxUOAgIQBQwCEQUMBQwFDAUMAA";
Se._MODULE="h3d.shader.MinMaxShader";Ef.SRC="HXSMG2gzZC5zaGFkZXIuQ3ViZU1pbk1heFNoYWRlcgwBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoEdGV4QQoGAgAACwR0ZXhCCgYCAAAMBWlzTWF4AgIAAQAAAAAADQNtYXQGAgAADghfX2luaXRfXw4GAAAPBnZlcnRleA4GAAAQCGZyYWdtZW50DgYAAAMCDgAABQIGBAIHBQwCCAUMBQwGBAIJBQoCAwUKBQoAAA8AAAUBBgQCBgUMCQMrDgQKAgIFCgAAAwYBCgICBQoEAAMCBAMDAQMAAAAAAAAAAAMBAwAAAAAAAPA/AwUMBQwAARAAAAUFCBECdXYFCgQAAAYDBgECCQUKAQMAAAAAAAAAQAMFCgEDAAAAAAAA8D8DBQoACBIDZGlyBQsEAAAGAQkDKg4CAhEFCgEDAAAAAAAA8D8DBQsCDQYFCwAIEwFhBQwEAAAJAyIOAgIKCgYCEgULBQwACBQBYgUMBAAACQMiDgICCwoGAhIFCwUMAAYEAggFDAsCDAIJAxYOAgITBQwCFAUMBQwJAxUOAgITBQwCFAUMBQwFDAUMAA";
Ef._MODULE="h3d.shader.MinMaxShader";ef.SRC="HXSMFGgzZC5zaGFkZXIuTm9ybWFsTWFwCgEGY2FtZXJhDQECAghwb3NpdGlvbgULAAEAAwNkaXIFCwMBAAAAAAQGZ2xvYmFsDQIBBQltb2RlbFZpZXcHAAQBAwAAAAYFaW5wdXQNAwIHBm5vcm1hbAULAQYACAd0YW5nZW50BQsBBgABAAAJB3RleHR1cmUKAgIAAAoMY2FsY3VsYXRlZFVWBQoEAAALE3RyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAwRdHJhbnNmb3JtZWROb3JtYWwFCwQAAA0SdHJhbnNmb3JtZWRUYW5nZW50BQwDAAAODl9faW5pdF9fdmVydGV4DgYAAA8IZnJhZ21lbnQOBgAAAgIOAAAFAQYEAg0FDAkDKw4CBgECCAULCQMzDgECBQcGBQsLBgcJAx4OAgIIBQsCCAULAwEDAAAAAAAA4D8DAgEDAAAAAAAA8D8DAQMAAAAAAADwvwMDBQwFDAABDwAABQUIEAFuBQsEAAACDAULAAgRAm5mBQsEAAAJAzoOAQkDIg4CAgkKAgIKBQoFDAULAAgSBHRhblgFCwQAAAkDIA4BCgINBQySAAULBQsACBMEdGFuWQULBAAABgEJAx8OAgIQBQsCEgULBQsHAwoCDQUMDAADAwULAAYEAgwFCwkDIA4BBAYABgAGAQoCEQULAAADAhIFCwULBgEKAhEFCwQAAwITBQsFCwULBgEKAhEFCwgAAwIQBQsFCwULBQsFCwULAA";
ef._MODULE="h3d.shader.NormalMap";zf.SRC="HXSMEWgzZC5zaGFkZXIuU2hhZG93BgEGc2hhZG93DQEFAgNtYXARAQABAAMEcHJvaggAAQAEBWNvbG9yBQsAAQAFBXBvd2VyAwABAAYEYmlhcwMAAQAAAAAHCnBpeGVsQ29sb3IFDAQAAAgTdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAACRhwaXhlbFRyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAoJc2hhZG93UG9zBQsEAAEBCwhmcmFnbWVudA4GAAABAQsAAAUGCAwJc2hhZG93UG9zBQsEAAAGAQIJBQsCAwgFCwAIDQVkZXB0aAMEAAAJA0AOAgICEQEJAzsOAQoCDAULEQAFCgUKAwAIDgR6TWF4AwQAAAkDNg4BCgIMBQsIAAMDAAgPBWRlbHRhAwQAAAYDCQMVDgIEBgACDQMCBgMDAwIOAwMCDgMDAAgQBXNoYWRlAwQAAAkDNg4BCQMJDgEGAQIFAwIPAwMDAwAGgQoCBwUMkgAFCwYABgEEBgMBAwAAAAAAAPA/AwIQAwMDCgIEBQuSAAULBQsCEAMFCwULAA";
zf._MODULE="h3d.shader.Shadow";Cd.SRC="HXSMHmgzZC5zaGFkZXIuU2lnbmVkRGlzdGFuY2VGaWVsZA8BBWlucHV0DQEDAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEABAVjb2xvcgUMAQEAAQAABQZvdXRwdXQNAgIGCHBvc2l0aW9uBQwEBQAHBWNvbG9yBQwEBQAEAAAIBHRpbWUDAAAACQ5zcHJpdGVQb3NpdGlvbgUMBAAAChBhYnNvbHV0ZVBvc2l0aW9uBQwEAAALCnBpeGVsQ29sb3IFDAQAAAwMdGV4dHVyZUNvbG9yBQwEAAANDGNhbGN1bGF0ZWRVVgUKAwAADg5vdXRwdXRQb3NpdGlvbgUMBAAADwdjaGFubmVsAQIAAQAAAAAAEA1hdXRvU21vb3RoaW5nAgIAAQAAAAAAEQthbHBoYUN1dG9mZgMCAAASCXNtb290aGluZwMCAAATBm1lZGlhbg4GAAAUCGZyYWdtZW50DgYAAAIDEwMVAXIDBAAAFgFnAwQAABcBYgMEAAADBQENCQMWDgIJAxUOAgIVAwIWAwMJAxUOAgkDFg4CAhUDAhYDAwIXAwMDAAABFAAABQUIGA10ZXh0dXJlU2FtcGxlBQwEAAACDAUMAAgZCGRpc3RhbmNlAwQAAAAABgQCGQMLBgUCDwEBAgAAAAABAgoCGAUMAAADCwYFAg8BAQIBAAAAAQIKAhgFDAQAAwsGBQIPAQECAgAAAAECCgIYBQwIAAMLBgUCDwEBAgMAAAABAgoCGAUMDAADCQITDgMKAhgFDAAAAwoCGAUMBAADCgIYBQwIAAMDAwMDAwMIGglzbW9vdGhWYWwDBAAACwIQAgkDDw4BBgEJAz8OAQIZAwMBAwAAAAAAAOA/AwMDAhIDAwAGBAIMBQwJAysOBAEDAAAAAAAA8D8DAQMAAAAAAADwPwMBAwAAAAAAAPA/AwkDGw4DBgMCEQMCGgMDBgACEQMCGgMDAhkDAwUMBQwA";
Cd._MODULE="h3d.shader.SignedDistanceField";tg.SRC="HXSMEGgzZC5zaGFkZXIuVXRpbHMHAQtib25lTWF0cml4WAgEAAACC2JvbmVNYXRyaXhZCAQAAAMLYm9uZU1hdHJpeFoIBAAABAtib25lTWF0cml4VwgEAAAFC3NraW5XZWlnaHRzBQwEAAAGDmFwcGx5U2tpblBvaW50DgYAAAcMYXBwbHlTa2luVmVjDgYAAAIDBgEIAXAFCwQAAAULBQMICQt0cmFuc2Zvcm1lZAULBAAABgAGAAYBBAYBAggFCwIBCAULBQsKAgUFDAAAAwULBgEEBgECCAULAgIIBQsFCwoCBQUMBAADBQsFCwYBBAYBAggFCwIDCAULBQsKAgUFDAgAAwULBQsACwYHCgIFBQwMAAMBAwAAAAAAAAAAAwIFAQaAAgkFCwYBBAYBAggFCwIECAULBQsKAgUFDAwAAwULBQsAAAANAgkFCwAAAwcBCgF2BQsEAAAFCwUDCAsLdHJhbnNmb3JtZWQFCwQAAAYABgAGAQQGAQIKBQsJAzMOAQIBCAYFCwULCgIFBQwAAAMFCwYBBAYBAgoFCwkDMw4BAgIIBgULBQsKAgUFDAQAAwULBQsGAQQGAQIKBQsJAzMOAQIDCAYFCwULCgIFBQwIAAMFCwULAAsGBwoCBQUMDAADAQMAAAAAAAAAAAMCBQEGgAILBQsGAQQGAQIKBQsJAzMOAQIECAYFCwULCgIFBQwMAAMFCwULAAAADQILBQsAAA";
tg._MODULE="h3d.shader.Skin";yd.SRC="HXSME2gzZC5zaGFkZXIuU2tpbkJhc2UIARByZWxhdGl2ZVBvc2l0aW9uBQsEAAACE3RyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAMRdHJhbnNmb3JtZWROb3JtYWwFCwQAAAQITWF4Qm9uZXMBAgABAAAAAAAFEWZvdXJCb25lc0J5VmVydGV4AgIAAQAAAAAABgtjYWxjUHJldlBvcwICAAEAAAAAAAcNYm9uZXNNYXRyaXhlcw8IBAIAAQgIEXByZXZCb25lc01hdHJpeGVzDwgEAgABCAA";yd._MODULE="h3d.shader.SkinBase";Ve.SRC="HXSMD2gzZC5zaGFkZXIuU2tpbhIBEHJlbGF0aXZlUG9zaXRpb24FCwQAAAITdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAAxF0cmFuc2Zvcm1lZE5vcm1hbAULBAAABAhNYXhCb25lcwECAAEAAAAAAAURZm91ckJvbmVzQnlWZXJ0ZXgCAgABAAAAAAAGC2NhbGNQcmV2UG9zAgIAAQAAAAAABw1ib25lc01hdHJpeGVzDwgEAgABCAgRcHJldkJvbmVzTWF0cml4ZXMPCAQCAAEICQtib25lTWF0cml4WAgEAAAKC2JvbmVNYXRyaXhZCAQAAAsLYm9uZU1hdHJpeFoIBAAADAtib25lTWF0cml4VwgEAAANC3NraW5XZWlnaHRzBQwEAAAOBWlucHV0DQEEDwhwb3NpdGlvbgULAQ4AEAZub3JtYWwFCwEOABEHd2VpZ2h0cwULAQ4AEgdpbmRleGVzCQQAAAABDgABAAATG3ByZXZpb3VzVHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAFA5hcHBseVNraW5Qb2ludA4GAAAVDGFwcGx5U2tpblZlYw4GAAAWBnZlcnRleA4GAAADAxQBFwFwBQsEAAAFCwUDCBgLdHJhbnNmb3JtZWQFCwQAAAYABgAGAQQGAQIXBQsCCQgFCwULCgINBQwAAAMFCwYBBAYBAhcFCwIKCAULBQsKAg0FDAQAAwULBQsGAQQGAQIXBQsCCwgFCwULCgINBQwIAAMFCwULAAsGBwoCDQUMDAADAQMAAAAAAAAAAAMCBQEGgAIYBQsGAQQGAQIXBQsCDAgFCwULCgINBQwMAAMFCwULAAAADQIYBQsAAAMVARkBdgULBAAABQsFAwgaC3RyYW5zZm9ybWVkBQsEAAAGAAYABgEEBgECGQULCQMzDgECCQgGBQsFCwoCDQUMAAADBQsGAQQGAQIZBQsJAzMOAQIKCAYFCwULCgINBQwEAAMFCwULBgEEBgECGQULCQMzDgECCwgGBQsFCwoCDQUMCAADBQsFCwALBgcKAg0FDAwAAwEDAAAAAAAAAAADAgUBBoACGgULBgEEBgECGQULCQMzDgECDAgGBQsFCwoCDQUMDAADBQsFCwAAAA0CGgULAAAAFgAABQsLAgYCBQcGBAIJCBECCA8IBAkDJg4BCgISCQQAAAAAAAMBCAgGBAIKCBECCA8IBAkDJg4BCgISCQQAAAAEAAMBCAgGBAILCBECCA8IBAkDJg4BCgISCQQAAAAIAAMBCAgGBAIMCBECCA8IBAkDJg4BCgISCQQAAAAMAAMBCAgGBAINBQwJAysOAgIRBQsBAwAAAAAAAAAAAwUMBQwLAgUCBgQKAg0FDAwAAwYDAQMAAAAAAADwPwMEBgAGAAoCEQULAAADCgIRBQsEAAMDCgIRBQsIAAMDAwMDAAAGBAITBQsJAhQOAQIBBQsFCwULAAAABgQCCQgRAgcPCAQJAyYOAQoCEgkEAAAAAAADAQgIBgQCCggRAgcPCAQJAyYOAQoCEgkEAAAABAADAQgIBgQCCwgRAgcPCAQJAyYOAQoCEgkEAAAACAADAQgIBgQCDAgRAgcPCAQJAyYOAQoCEgkEAAAADAADAQgIBgQCDQUMCQMrDgICEQULAQMAAAAAAAAAAAMFDAUMCwIFAgYECgINBQwMAAMGAwEDAAAAAAAA8D8DBAYABgAKAhEFCwAAAwoCEQULBAADAwoCEQULCAADAwMDAwAABgQCAgULCQIUDgECAQULBQsFCwYEAgMFCwkCFQ4BAhAFCwULBQsGBAIDBQsJAyAOAQIDBQsFCwULCwcCAgYCAgYEAhMFCwICBQsFCwAAAA";
Ve._MODULE="h3d.shader.Skin";hf.SRC="HXSMFmgzZC5zaGFkZXIuU2tpblRhbmdlbnQTARByZWxhdGl2ZVBvc2l0aW9uBQsEAAACE3RyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAMRdHJhbnNmb3JtZWROb3JtYWwFCwQAAAQITWF4Qm9uZXMBAgABAAAAAAAFEWZvdXJCb25lc0J5VmVydGV4AgIAAQAAAAAABgtjYWxjUHJldlBvcwICAAEAAAAAAAcNYm9uZXNNYXRyaXhlcw8IBAIAAQgIEXByZXZCb25lc01hdHJpeGVzDwgEAgABCAkLYm9uZU1hdHJpeFgIBAAACgtib25lTWF0cml4WQgEAAALC2JvbmVNYXRyaXhaCAQAAAwLYm9uZU1hdHJpeFcIBAAADQtza2luV2VpZ2h0cwUMBAAADgVpbnB1dA0BBQ8IcG9zaXRpb24FCwEOABAGbm9ybWFsBQsBDgARB3RhbmdlbnQFCwEOABIHd2VpZ2h0cwULAQ4AEwdpbmRleGVzCQQAAAABDgABAAAUEnRyYW5zZm9ybWVkVGFuZ2VudAUMBAAAFRtwcmV2aW91c1RyYW5zZm9ybWVkUG9zaXRpb24FCwQAABYOYXBwbHlTa2luUG9pbnQOBgAAFwxhcHBseVNraW5WZWMOBgAAGAZ2ZXJ0ZXgOBgAAAwMWARkBcAULBAAABQsFAwgaC3RyYW5zZm9ybWVkBQsEAAAGAAYABgEEBgECGQULAgkIBQsFCwoCDQUMAAADBQsGAQQGAQIZBQsCCggFCwULCgINBQwEAAMFCwULBgEEBgECGQULAgsIBQsFCwoCDQUMCAADBQsFCwALBgcKAg0FDAwAAwEDAAAAAAAAAAADAgUBBoACGgULBgEEBgECGQULAgwIBQsFCwoCDQUMDAADBQsFCwAAAA0CGgULAAADFwEbAXYFCwQAAAULBQMIHAt0cmFuc2Zvcm1lZAULBAAABgAGAAYBBAYBAhsFCwkDMw4BAgkIBgULBQsKAg0FDAAAAwULBgEEBgECGwULCQMzDgECCggGBQsFCwoCDQUMBAADBQsFCwYBBAYBAhsFCwkDMw4BAgsIBgULBQsKAg0FDAgAAwULBQsACwYHCgINBQwMAAMBAwAAAAAAAAAAAwIFAQaAAhwFCwYBBAYBAhsFCwkDMw4BAgwIBgULBQsKAg0FDAwAAwULBQsAAAANAhwFCwAAABgAAAUNCwIGAgUHBgQCCQgRAggPCAQJAyYOAQoCEwkEAAAAAAADAQgIBgQCCggRAggPCAQJAyYOAQoCEwkEAAAABAADAQgIBgQCCwgRAggPCAQJAyYOAQoCEwkEAAAACAADAQgIBgQCDAgRAggPCAQJAyYOAQoCEwkEAAAADAADAQgIBgQCDQUMCQMrDgICEgULAQMAAAAAAAAAAAMFDAUMCwIFAgYECgINBQwMAAMGAwEDAAAAAAAA8D8DBAYABgAKAhIFCwAAAwoCEgULBAADAwoCEgULCAADAwMDAwAABgQCFQULCQIWDgECAQULBQsFCwAAAAYEAgkIEQIHDwgECQMmDgEKAhMJBAAAAAAAAwEICAYEAgoIEQIHDwgECQMmDgEKAhMJBAAAAAQAAwEICAYEAgsIEQIHDwgECQMmDgEKAhMJBAAAAAgAAwEICAYEAgwIEQIHDwgECQMmDgEKAhMJBAAAAAwAAwEICAYEAg0FDAkDKw4CAhIFCwEDAAAAAAAAAAADBQwFDAsCBQIGBAoCDQUMDAADBgMBAwAAAAAAAPA/AwQGAAYACgISBQsAAAMKAhIFCwQAAwMKAhIFCwgAAwMDAwMAAAYEAgIFCwkCFg4BAgEFCwULBQsGBAIDBQsJAhcOAQIQBQsFCwULBgQKAhQFDJIABQsJAhcOAQoCEQULkgAFCwULBQsGBAIDBQsJAyAOAQIDBQsFCwULBgQKAhQFDJIABQsJAyAOAQoCFAUMkgAFCwULBQsLBwICBgICBgQCFQULAgIFCwULAAAA";
hf._MODULE="h3d.shader.SkinTangent";Hd.SRC="HXSMGmgzZC5zaGFkZXIuU3BlY3VsYXJUZXh0dXJlBAEHdGV4dHVyZQoCAgAAAgxjYWxjdWxhdGVkVVYFCgQAAAMJc3BlY0NvbG9yBQsEAAAECGZyYWdtZW50DgYAAAEBBAAABQEGgQIDBQsKCQMiDgICAQoCAgIFCgUMkgAFCwULAA";Hd._MODULE="h3d.shader.SpecularTexture";Ne.SRC="HXSMEmgzZC5zaGFkZXIuVGV4dHVyZQsBBWlucHV0DQEBAgJ1dgUKAQEAAQAAAwhhZGRpdGl2ZQICAAEAAAAAAAQJa2lsbEFscGhhAgIAAQAAAAAABQ1zcGVjdWxhckFscGhhAgIAAQAAAAAABhJraWxsQWxwaGFUaHJlc2hvbGQDAgABBwAAAAAAAAAAAAAAAAAA8D8HB3RleHR1cmUKAgIAAAgMY2FsY3VsYXRlZFVWBQoEAAAJCnBpeGVsQ29sb3IFDAQAAAoJc3BlY0NvbG9yBQsEAAALBnZlcnRleA4GAAAMCGZyYWdtZW50DgYAAAIACwAABQEGBAIIBQoCAgUKBQoAAQwAAAUECA0BYwUMBAAACQMiDgICBwoCAggFCgUMAAsGDgIEAgYJBgMKAg0FDAwAAwIGAwMBAwAAAAAAAAAAAwICDAAAAAsCAwIGgAIJBQwCDQUMBQwGgQIJBQwCDQUMBQwACwIFAgaBAgoFCwoCDQUM/gAFCwULAAAA";
Ne._MODULE="h3d.shader.Texture";Md.SRC="HXSMEmgzZC5zaGFkZXIuVVZEZWx0YQQBB3V2RGVsdGEFCgIAAAIHdXZTY2FsZQUKAgAAAwxjYWxjdWxhdGVkVVYFCgQAAAQGdmVydGV4DgYAAAEABAAABQEGBAIDBQoGAAYBAgMFCgICBQoFCgIBBQoFCgUKAA";Md._MODULE="h3d.shader.UVDelta";qe.SRC="HXSMG2gzZC5zaGFkZXIuVmVydGV4Q29sb3JBbHBoYQQBBWlucHV0DQEBAgVjb2xvcgUMAQEAAQAAAwpwaXhlbENvbG9yBQwEAAAECGFkZGl0aXZlAgIAAQAAAAAABQhmcmFnbWVudA4GAAABAQUAAAUBCwIEAgaAAgMFDAICBQwFDAaBAgMFDAICBQwFDAAA";qe._MODULE="h3d.shader.VertexColorAlpha";df.SRC="HXSMFmgzZC5zaGFkZXIuVm9sdW1lRGVjYWwdAQZjYW1lcmENAQwCBHZpZXcHAAEAAwRwcm9qBwABAAQIcG9zaXRpb24FCwABAAUIcHJvakZsaXADAAEABghwcm9qRGlhZwULAAEABwh2aWV3UHJvagcAAQAIEHByZXZpb3VzVmlld1Byb2oHAAEACQ9pbnZlcnNlVmlld1Byb2oHAAEACgV6TmVhcgMAAQALBHpGYXIDAAEADANkaXIFCwMBAA0Naml0dGVyT2Zmc2V0cwUMAAEAAAAADgZnbG9iYWwNAgUPBHRpbWUDAA4AEAlwaXhlbFNpemUFCgAOABEJbW9kZWxWaWV3BwAOAQMSEG1vZGVsVmlld0ludmVyc2UHAA4BAxMRcHJldmlvdXNNb2RlbFZpZXcHAA4BAwAAABQFaW5wdXQNAwIVCHBvc2l0aW9uBQsBFAAWBm5vcm1hbAULARQAAQAAFwZvdXRwdXQNBAYYCHBvc2l0aW9uBQwEFwAZBWNvbG9yBQwEFwAaBWRlcHRoAwQXABsGbm9ybWFsBQsEFwAcCXdvcmxkRGlzdAMEFwAdCHZlbG9jaXR5BQoEFwAEAAAeEHJlbGF0aXZlUG9zaXRpb24FCwQAAB8TdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAIBtwcmV2aW91c1RyYW5zZm9ybWVkUG9zaXRpb24FCwQAACEYcGl4ZWxUcmFuc2Zvcm1lZFBvc2l0aW9uBQsEAAAiEXRyYW5zZm9ybWVkTm9ybWFsBQsEAAAjEXByb2plY3RlZFBvc2l0aW9uBQwEAAAkGXByZXZpb3VzUHJvamVjdGVkUG9zaXRpb24FDAQAACUKcGl4ZWxDb2xvcgUMBAAAJgVkZXB0aAMEAAAnC25kY1Bvc2l0aW9uBQoEAAAoE3ByZXZpb3VzTmRjUG9zaXRpb24FCgQAACkIc2NyZWVuVVYFCgQAACoJc3BlY1Bvd2VyAwQAACsJc3BlY0NvbG9yBQsEAAAsCXdvcmxkRGlzdAMEAAAtDXBpeGVsVmVsb2NpdHkFCgQAAC4IZGVwdGhNYXARAQAAAC8Fc2NhbGUFCgIAADAGbm9ybWFsBQsCAAAxB3RhbmdlbnQFCwIAADIKaXNDZW50ZXJlZAICAAEAAAAAADMMY2FsY3VsYXRlZFVWBQoEAAA0EnRyYW5zZm9ybWVkVGFuZ2VudAUMBAAANQ5fX2luaXRfX3ZlcnRleA4GAAA2CGZyYWdtZW50DgYAAAICNQAABQIGBAIiBQsJAyAOAQQGAQIwBQsJAzMOAQIRBwYFCwULBQsFCwYEAjQFDAkDKw4CCQMgDgEEBgECMQULCQMzDgECEQcGBQsFCwULAQMAAAAAAADwPwMFDAUMAAE2AAAFCQg3Bm1hdHJpeAcEAAAGAQIJBwISBwcACDgJc2NyZWVuUG9zBQoEAAAGAgoCIwUMEQAFCgoCIwUMDAADBQoACDkDcnV2BQwEAAAJAysOAwI4BQoJA0AOAgIuEQEJAzsOAQI4BQoFCgMBAwAAAAAAAPA/AwUMAAg6BHdwb3MFDAQAAAYBAjkFDAI3BwUMAAg7BHBwb3MFDAQAAAYBAjkFDAIJBwUMAAYEAiEFCwYCCgI7BQySAAULCgI7BQwMAAMFCwULBgQCMwUKBgECLwUKBAYCCgI6BQwRAAUKCgI6BQwMAAMFCgUKBQoFCgsCMgIGgAIzBQoBAwAAAAAAAOA/AwUKAAALBgkJAxUOAgkDFQ4CCgIzBQoAAAMKAjMFCgQAAwMJAxUOAgYDAQMAAAAAAADwPwMKAjMFCgAAAwMGAwEDAAAAAAAA8D8DCgIzBQoEAAMDAwMBAwAAAAAAAAAAAwIMAAAAAA";
df._MODULE="h3d.shader.VolumeDecal";Jd.pending=[];Jd.threadCount=0;Dc.DEFAULT_RESOLVER=new rh;Dc.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:";Cc.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";Cc.BYTES=S.ofString(Cc.CHARS);ob.i64tmp=new qh(0,0);ob.helper=new DataView(new ArrayBuffer(8));xe.escapes=function(a){a=new La;a.h.lt="<";a.h.gt=">";a.h.amp="&";a.h.quot='"';a.h.apos="'";return a}(this);gc.LEN_EXTRA_BITS_TBL=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,
2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1];gc.LEN_BASE_VAL_TBL=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];gc.DIST_EXTRA_BITS_TBL=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1];gc.DIST_BASE_VAL_TBL=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];gc.CODE_LENGTHS_POS=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];Bb.INFO=1;Bb.DEBUG=16;Bb.DATA=256;Bb.mask=0;Bb.logFn=
console.log;qc.F32=0;qc.F16=1;qc.U8=2;qc.S8=3;qc.SIZES=[4,2,1,1];Jc.DFloat=1;Jc.DVec2=2;Jc.DVec3=3;Jc.DVec4=4;Jc.DMat4=16;Jc.DBytes4=9;N._UID=0;N.ALL_FORMATS=new La;cd.UID=0;cd.CACHE=new Da;cd._UID=0;cd.MAX_FORMATS=16;wb.ASCII=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";wb.LATIN1="\u00a1\u00a2\u00a3\u00a4\u00a5\u00a6\u00a7\u00a8\u00a9\u00aa\u00ab\u00ac-\u00ae\u00af\u00b0\u00b1\u00b2\u00b3\u00b4\u00b5\u00b6\u00b7\u00b8\u00b9\u00ba\u00bb\u00bc\u00bd\u00be\u00bf\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00c6\u00c7\u00c8\u00c9\u00ca\u00cb\u00cc\u00cd\u00ce\u00cf\u00d0\u00d1\u00d2\u00d3\u00d4\u00d5\u00d6\u00d7\u00d8\u00d9\u00da\u00db\u00dc\u00dd\u00de\u00df\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u00e6\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f0\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u00f7\u00f8\u00f9\u00fa\u00fb\u00fc\u00fd\u00fe\u00ff\u0153\u00e6\u0152\u00c6\u20ac";
wb.CYRILLIC="\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042a\u042b\u042c\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f\u2014";wb.POLISH="\u0104\u0106\u0118\u0141\u0143\u00d3\u015a\u0179\u017b\u0105\u0107\u0119\u0142\u0144\u00f3\u015b\u017a\u017c";
wb.TURKISH="\u00c2\u00c7\u011eI\u0130\u00ce\u00d6\u015e\u00dc\u00db\u00e2\u00e7\u011f\u0131\u0130\u00ee\u00f6\u015f\u00fc\u00fb";wb.JP_KANA="\u3000\u3042\u3044\u3046\u3048\u304a\u304b\u304d\u304f\u3051\u3053\u3055\u3057\u3059\u305b\u305d\u305f\u3061\u3064\u3066\u3068\u306a\u306b\u306c\u306d\u306e\u306f\u3072\u3075\u3078\u307b\u307e\u307f\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308a\u308b\u308c\u308d\u308f\u3090\u3091\u3092\u3093\u304c\u304e\u3050\u3052\u3054\u3056\u3058\u305a\u305c\u305e\u3060\u3062\u3065\u3067\u3069\u3070\u3073\u3076\u3079\u307c\u3071\u3074\u3077\u307a\u307d\u3083\u3085\u3087\u30a2\u30a4\u30a6\u30a8\u30aa\u30ab\u30ad\u30af\u30b1\u30b3\u30b5\u30b7\u30b9\u30bb\u30bd\u30bf\u30c1\u30c4\u30c6\u30c8\u30ca\u30cb\u30cc\u30cd\u30ce\u30cf\u30d2\u30d5\u30d8\u30db\u30de\u30df\u30e0\u30e1\u30e2\u30e4\u30e6\u30e8\u30e9\u30ea\u30eb\u30ec\u30ed\u30ef\u30f0\u30f1\u30f2\u30f3\u30ac\u30ae\u30b0\u30b2\u30b4\u30b6\u30b8\u30ba\u30bc\u30be\u30c0\u30c2\u30c5\u30c7\u30c9\u30d0\u30d3\u30d6\u30d9\u30dc\u30d1\u30d4\u30d7\u30da\u30dd\u30f4\u30e3\u3047\u3063\u30c3\u30e5\u30e7\u30a1\u30a3\u30a5\u30a7\u30a9\u30fb\u30fc\u300c\u300d\u3001\u3002\u300e\u300f\u201c\u201d\uff01\uff1a\uff1f\uff05\uff06\uff08\uff09\uff0d\uff10\uff11\uff12\uff13\uff14\uff15\uff16\uff17\uff18\uff19";
wb.UNICODE_SPECIALS="\ufffd\u25a1";wb.DEFAULT_CHARS=wb.ASCII+wb.LATIN1;wb.complementChars=function(a){a=new Da;for(var b=0;47>b;){var c=b++;a.h[D.cca("\u30fd\u30fe\u30fc\u30a1\u30a3\u30a5\u30a7\u30a9\u30c3\u30e3\u30e5\u30e7\u30ee\u30f5\u30f6\u3041\u3043\u3045\u3047\u3049\u3063\u3083\u3085\u3087\u308e\u3095\u3096\u31f0\u31f1\u31f2\u31f3\u31f4\u31f5\u31f6\u31f7\u31f8\u31f9\u31fa\u31fb\u31fc\u31fd\u31fe\u31ff\u3005\u303b\u3002\uff0c",c)]=!0}return a}(this);H.BACKSPACE=8;H.TAB=9;H.ENTER=13;H.SHIFT=16;
H.CTRL=17;H.ALT=18;H.ESCAPE=27;H.SPACE=32;H.PGUP=33;H.PGDOWN=34;H.END=35;H.HOME=36;H.LEFT=37;H.UP=38;H.RIGHT=39;H.DOWN=40;H.INSERT=45;H.DELETE=46;H.QWERTY_EQUALS=187;H.QWERTY_MINUS=189;H.QWERTY_TILDE=192;H.QWERTY_BRACKET_LEFT=219;H.QWERTY_BRACKET_RIGHT=221;H.QWERTY_SEMICOLON=186;H.QWERTY_QUOTE=222;H.QWERTY_BACKSLASH=220;H.QWERTY_COMMA=188;H.QWERTY_PERIOD=190;H.QWERTY_SLASH=191;H.INTL_BACKSLASH=226;H.LEFT_WINDOW_KEY=91;H.RIGHT_WINDOW_KEY=92;H.CONTEXT_MENU=93;H.PAUSE_BREAK=19;H.CAPS_LOCK=20;H.NUM_LOCK=
144;H.SCROLL_LOCK=145;H.NUMBER_0=48;H.NUMBER_1=49;H.NUMBER_2=50;H.NUMBER_3=51;H.NUMBER_4=52;H.NUMBER_5=53;H.NUMBER_6=54;H.NUMBER_7=55;H.NUMBER_8=56;H.NUMBER_9=57;H.NUMPAD_0=96;H.NUMPAD_1=97;H.NUMPAD_2=98;H.NUMPAD_3=99;H.NUMPAD_4=100;H.NUMPAD_5=101;H.NUMPAD_6=102;H.NUMPAD_7=103;H.NUMPAD_8=104;H.NUMPAD_9=105;H.A=65;H.B=66;H.C=67;H.D=68;H.E=69;H.F=70;H.G=71;H.H=72;H.I=73;H.J=74;H.K=75;H.L=76;H.M=77;H.N=78;H.O=79;H.P=80;H.Q=81;H.R=82;H.S=83;H.T=84;H.U=85;H.V=86;H.W=87;H.X=88;H.Y=89;H.Z=90;H.F1=112;H.F2=
113;H.F3=114;H.F4=115;H.F5=116;H.F6=117;H.F7=118;H.F8=119;H.F9=120;H.F10=121;H.F11=122;H.F12=123;H.F13=124;H.F14=125;H.F15=126;H.F16=127;H.F17=128;H.F18=129;H.F19=130;H.F20=131;H.F21=132;H.F22=133;H.F23=134;H.F24=135;H.NUMPAD_MULT=106;H.NUMPAD_ADD=107;H.NUMPAD_ENTER=108;H.NUMPAD_SUB=109;H.NUMPAD_DOT=110;H.NUMPAD_DIV=111;H.MOUSE_LEFT=0;H.MOUSE_RIGHT=1;H.MOUSE_MIDDLE=2;H.MOUSE_BACK=3;H.MOUSE_FORWARD=4;H.MOUSE_WHEEL_UP=5;H.MOUSE_WHEEL_DOWN=6;H.LOC_LEFT=256;H.LOC_RIGHT=512;H.LSHIFT=272;H.RSHIFT=528;H.LCTRL=
273;H.RCTRL=529;H.LALT=274;H.RALT=530;H.initDone=!1;H.keyPressed=[];H.ALLOW_KEY_REPEAT=!1;X.PI=3.141592653589793;X.EPSILON=1E-10;X.EPSILON2=1E-20;ba.wantedFPS=60;ba.maxDeltaTime=.5;ba.smoothFactor=.95;ba.lastTimeStamp=D.now()/1E3;ba.elapsedTime=0;ba.frameCount=0;ba.dt=1/ba.wantedFPS;ba.currentDT=1/ba.wantedFPS;ia.setCursor=ia.setNativeCursor;ia.loopInit=!1;ia.fpsLimit=-1;id.HORIZONTAL=-9007199254740992;id.TOLERANCE=1E-20;id.SKIP=-2;id.UNASSIGNED=-1;Ag.QTMP=new Hc;Ch.CURRENT_VERSION=4;Qd.BLEND=xa.__empty_constructs__.slice();
Qd.CULLING=Ib.__empty_constructs__.slice();We.RELOAD_LFS=[];rd.ENABLED=!1;rd.ENGINE_PACKAGES="h3d hxd h2d haxe sys hrt".split(" ");kf.C_ID=0;Mb.LIVE_UPDATE=!1;Mf.Jpg=0;Mf.Png=1;Mf.Gif=2;Mf.Tga=3;Mf.Dds=4;Mf.Raw=5;Mf.Hdr=6;Db.DEFAULT_FILTER=sd.Linear;Db.MIPMAP_MAX_SIZE=0;Db.ENABLE_AUTO_WATCH=!0;Db.BLACK_1x1=ya.alloc(1,1,F.RGBA);Db.LOG_TEXTURE_LOAD=!1;cb.BLOCKSIZE=64;cb.W1=2841;cb.W2=2676;cb.W3=2408;cb.W5=1609;cb.W6=1108;cb.W7=565;cb.CF4A=-9;cb.CF4B=111;cb.CF4C=29;cb.CF4D=-3;cb.CF3A=28;cb.CF3B=109;
cb.CF3C=-9;cb.CF3X=104;cb.CF3Y=27;cb.CF3Z=-3;cb.CF2A=139;cb.CF2B=-11;lf.ENABLE_AUTO_WATCH=!0;Of.ID=0;Gg.ID=0;oa.STREAM_DURATION=5;oa.STREAM_BUFFER_SAMPLE_COUNT=44100;oa.BUFFER_QUEUE_LENGTH=2;oa.MAX_SOURCES=16;oa.SOUND_BUFFER_CACHE_SIZE=256;oa.VIRTUAL_VOLUME_THRESHOLD=1E-5;oa.BUFFER_STREAM_SPLIT=16;Nh.FADE_SAMPLES=10;B.UID=0;B.SWIZ=sa.__empty_constructs__.slice();B.MAX_CHANNELS_BITS=3;B.MAX_PARTIAL_MAPPINGS_BITS=7;ve.SRC="HXSMEGh4c2wuQmF0Y2hTaGFkZXIFAQ9CYXRjaF9IYXNPZmZzZXQCAgABAAAAAAACEEJhdGNoX1VzZVN0b3JhZ2UCAgABAAAAAAADC0JhdGNoX0NvdW50AQIAAQAAEAAABAxCYXRjaF9CdWZmZXIQBQwDAgAABRNCYXRjaF9TdG9yYWdlQnVmZmVyEIIFDAAAAgAAAA";
ve._MODULE="hxsl.BatchShader";U.vec2=x.TVec(2,Q.VFloat);U.vec3=x.TVec(3,Q.VFloat);U.vec4=x.TVec(4,Q.VFloat);U.ivec2=x.TVec(2,Q.VInt);U.ivec3=x.TVec(3,Q.VInt);U.ivec4=x.TVec(4,Q.VInt);sb.VAR_IDS=!1;sb.TRACE=!1;lc.SWIZ=[sa.X,sa.Y,sa.Z,sa.W];Xb.KWD_LIST="attribute const uniform varying buffer shared\r\n\tcoherent volatile restrict readonly writeonly\r\n\tatomic_uint\r\n\tlayout\r\n\tcentroid flat smooth noperspective\r\n\tpatch sample\r\n\tbreak continue do for while switch case default\r\n\tif else\r\n\tsubroutine\r\n\tin out inout\r\n\tfloat double int void bool true false\r\n\tinvariant precise\r\n\tdiscard return\r\n\tmat2 mat3 mat4 dmat2 dmat3 dmat4\r\n\tmat2x2 mat2x3 mat2x4 dmat2x2 dmat2x3 dmat2x4\r\n\tmat3x2 mat3x3 mat3x4 dmat3x2 dmat3x3 dmat3x4\r\n\tmat4x2 mat4x3 mat4x4 dmat4x2 dmat4x3 dmat4x4\r\n\tvec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 dvec2 dvec3 dvec4\r\n\tuint uvec2 uvec3 uvec4\r\n\tlowp mediump highp precision\r\n\timage1D iimage1D uimage1D\r\n\timage2D iimage2D uimage2D\r\n\timage3D iimage3D uimage3D\r\n\tstruct\r\n\tcommon partition active\r\n\tasm\r\n\tclass union enum typedef template this packed\r\n\tresource\r\n\tgoto\r\n\tinline noinline public static extern external interface\r\n\tlong short half fixed unsigned superp\r\n\tinput output\r\n\thvec2 hvec3 hvec4 fvec2 fvec3 fvec4\r\n\tsampler3DRect\r\n\tfilter\r\n\tsizeof cast\r\n\tnamespace using\r\n\trow_major";
Xb.KWDS=function(a){a=new La;for(var b=0,c=(new nf("[ \t\r\n]+","g")).split(Xb.KWD_LIST);b<c.length;){var d=c[b];++b;a.h[d]=!0}return a}(this);Xb.GLOBALS=function(a){var b=[];var c=0;for(var d=C.__empty_constructs__.slice();c<d.length;){a=d[c];++c;var e=""+w.string(a);e=e.charAt(0).toLowerCase()+D.substr(e,1,null);b[a._hx_index]=e}b[C.ToInt._hx_index]="int";b[C.ToFloat._hx_index]="float";b[C.ToBool._hx_index]="bool";b[C.LReflect._hx_index]="reflect";b[C.Mat3x4._hx_index]="_mat3x4";b[C.VertexID._hx_index]=
"gl_VertexID";b[C.InstanceID._hx_index]="gl_InstanceID";b[C.IVec2._hx_index]="ivec2";b[C.IVec3._hx_index]="ivec3";b[C.IVec4._hx_index]="ivec4";b[C.BVec2._hx_index]="bvec2";b[C.BVec3._hx_index]="bvec3";b[C.BVec4._hx_index]="bvec4";b[C.FragCoord._hx_index]="gl_FragCoord";b[C.FrontFacing._hx_index]="gl_FrontFacing";b[C.FloatBitsToUint._hx_index]="_floatBitsToUint";b[C.UintBitsToFloat._hx_index]="_uintBitsToFloat";b[C.ComputeVar_LocalInvocation._hx_index]="ivec3(gl_LocalInvocationID)";b[C.ComputeVar_GlobalInvocation._hx_index]=
"ivec3(gl_GlobalInvocationID)";b[C.ComputeVar_LocalInvocationIndex._hx_index]="int(gl_LocalInvocationIndex)";b[C.ComputeVar_WorkGroup._hx_index]="ivec3(gl_WorkGroupID)";for(c=0;c<b.length;)a=b[c],++c,Xb.KWDS.h[a]=!0;return b}(this);Xb.MAT34="struct _mat3x4 { vec4 a; vec4 b; vec4 c; };";Sf.UID=0;pa.SWIZ=["x","y","z","w"];Hg.UID=0;Na.TVECS=new Da;Na.TDIMS=tb.__empty_constructs__.slice();Na.BOPS=function(a){a=ha.__empty_constructs__.slice();a.splice(ha.OpAssignOp(null)._hx_index,0,null);return a}(this);
Na.UNOPS=gd.__empty_constructs__.slice();Na.TGLOBALS=C.__empty_constructs__.slice();Na.TSWIZ=new Da;Na.REGS=[sa.X,sa.Y,sa.Z,sa.W];Na.VKINDS=P.__empty_constructs__.slice();Na.PRECS=Xe.__empty_constructs__.slice();Na.FKIND=Ia.__empty_constructs__.slice();Na.SIGN=9204765;Fb.MAX_LIST_SIZE=0;Fb.ALLOW_DUPLICATES=!0;Kg.UID=0;Qb.UNROLL_LOOPS=!1;Qb.SHADER_RESOLVE=new La;kd.FLOAT_SINGLE_MIN=1.401298464324817E-45;kd.FLOAT_SINGLE_MAX=3.4028234663852886E38;kd.FLOAT_DOUBLE_MIN=4.9E-324;kd.FLOAT_DOUBLE_MAX=1.7976931348623157E308;
var md={PlayerBaseHealth:100,ServerUpdateRate:100,MapSize:16384,SnowBiomeY:5461.333333333333,GridBoxSize:64,PlayerDeceleration:.993,PlayerBaseSpeed:55.55555555555556,ShapePositionOrbitSpeed:20};mf.main();Jd.run()})("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
